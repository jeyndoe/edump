<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Как программно увеличить размер уже выделенной области памяти - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Вопрос для знающих. При загрузке программы в память машины, с помощью функции VirtualAlloc выделяется какая-то область памяти (например, по адресу 00F10000, и размером - 1000h байтов). Эта область имеет доступ - чтение, запись и">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=55995'>tyns777</a>, <a target='_blank' href='?action=userinfo&amp;user=55802'>JustLife</a>, <a target='_blank' href='?action=userinfo&amp;user=31361'>zds</a>, <a target='_blank' href='?action=userinfo&amp;user=2094'>2nd</a>, <a target='_blank' href='?action=userinfo&amp;user=33192'>morgot</a>, <a target='_blank' href='?action=userinfo&amp;user=8605'>Rio</a>, <a target='_blank' href='?action=userinfo&amp;user=27081'>CDK123</a>, <a target='_blank' href='?action=userinfo&amp;user=10534'>tihiy_grom</a> (+4 невидимых)</b></span>
</td>
</tr>
</table>

 

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Как программно увеличить размер уже выделенной области памяти</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]vnekrilov[/b]','')">vnekrilov</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 329.6 (мудрец), 192thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.08'>Активность: 0.14<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=5173">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 16 февраля 2009 16:20 &middot; Поправил: vnekrilov <br><script type="text/javascript">QU('vnekrilov','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=vnekrilov" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13799.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Вопрос для знающих. При загрузке программы в память машины, с помощью функции VirtualAlloc выделяется какая-то область памяти (например, по адресу 00F10000, и размером - 1000h байтов). Эта область имеет доступ - чтение, запись и исполнение (RWE). Нужно увеличить размер этой области памяти, например, до 3000h байтов. Подскажите, как это можно программно сделать?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=221478&amp;user=5173&amp;forum_n=6&amp;topic=13799.html&amp;page=0&amp;anchor=1" class="addthx" data-post="221478"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]Veliant[/b]','')">Veliant</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 301.4 (мудрец), 194thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.62'>Активность: 0.17<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=3136">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 16 февраля 2009 16:53 <br><script type="text/javascript">QU('Veliant','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Veliant" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13799.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
в стандартном C есть realloc
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=221481&amp;user=3136&amp;forum_n=6&amp;topic=13799.html&amp;page=0&amp;anchor=2" class="addthx" data-post="221481"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]tihiy_grom[/b]','')">tihiy_grom</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 441.3 (мудрец), 297thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.33'>Активность: 0.41<span style='color:red'>&searr;</span>0.04</span><br>Статус: <a href="action=userinfo&amp;user=10534">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 16 февраля 2009 16:56 <br><script type="text/javascript">QU('tihiy_grom','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=tihiy_grom" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13799.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
<b>vnekrilov</b><br>Вроде бы таких API нет. Единственное что приходит на ум - это освободить этот диапазон и выделить новый. Если в нём содержатся какие-то данные - предварительно скопировать их, и после расширения диапазона вставить обратно
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=221482&amp;user=10534&amp;forum_n=6&amp;topic=13799.html&amp;page=0&amp;anchor=3" class="addthx" data-post="221482"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]-= ALEX =-[/b]','')">-= ALEX =-</a></b><br></div>
<img src="img/s6.gif" alt=""><br><img style="padding-top:3px;" src="av/220.jpg" alt=""><br><span class=txtSm>Ранг: 260.3 (наставник), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.89'>Активность: 0.12<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=220">Участник</a><br><font color=blue>PPC-PROTECT author</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 16 февраля 2009 17:11 <br><script type="text/javascript">QU('-= ALEX =-','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=-= ALEX =-" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13799.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
а если после этого куска памяти лежит сразу другой, и размер предыдущего будет перекрывать его? наверное никак. только выделить в другом месте буфер большего размера...
<br><br><font size="1"><i>-----<br>Пиво, сиськи, транс</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=221485&amp;user=220&amp;forum_n=6&amp;topic=13799.html&amp;page=0&amp;anchor=4" class="addthx" data-post="221485"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]Clerk[/b]','')">Clerk</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 255.8 (наставник), 19thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.86'>Активность: 0.15<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=17964">Участник</a><br><font color=blue>vx</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 16 февраля 2009 17:14 <br><script type="text/javascript">QU('Clerk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Clerk" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13799.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
&gt; Резервируешь область памяти максимального размера, резервирование не выделяет память, а помечает диапазон адресов как занятый. Это делоется посредством <b>NtAllocateVirtualMemory</b> с флагом <b>MEM_RESERVE</b>.<br>&gt; При необходимости выделяешь область памяти с помощью тогоже сервиса в зарезервированном регионе, указав флаг <b>MEM_COMMIT.</b><br>Для каждой страницы из зарезервированного диапазона адресов <b>MEMORY_BASIC_INFORMATION.AllocationBase</b> будет одинакова.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=221487&amp;user=17964&amp;forum_n=6&amp;topic=13799.html&amp;page=0&amp;anchor=5" class="addthx" data-post="221487"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]mak[/b]','')">mak</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3520.jpg" alt=""><br><span class=txtSm>Ранг: 673.3 <font color=magenta>(<b>! !</b>)</font>, 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.48'>Активность: 0.4<span style='color:red'>&searr;</span>0.31</span><br>Статус: <a href="action=userinfo&amp;user=3520">Участник</a><br><font color=blue>CyberMonk</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 16 февраля 2009 21:51 <br><script type="text/javascript">QU('mak','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=mak" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13799.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
Пример <br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_char">.</span>686</li><li class="hl_l1"></li><li class="hl_l0"><span class="hl_char">.</span><span class="hl_function"><b>model</b></span>&nbsp;<span class="hl_function">flat</span><span class="hl_char">,</span>stdcall</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>option</b></span>&nbsp;casemap&nbsp;<span class="hl_char">:</span><span class="hl_function"><b>none</b></span>&nbsp;&nbsp;&nbsp;<span class="hl_comment">; case sensitive</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>include</b></span>&nbsp;D<span class="hl_char">:</span><span class="hl_char">\</span>masm32<span class="hl_char">\</span>include<span class="hl_char">\</span>windows<span class="hl_char">.</span>inc</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>include</b></span>&nbsp;D<span class="hl_char">:</span><span class="hl_char">\</span>masm32<span class="hl_char">\</span>include<span class="hl_char">\</span>user32<span class="hl_char">.</span>inc</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>include</b></span>&nbsp;D<span class="hl_char">:</span><span class="hl_char">\</span>masm32<span class="hl_char">\</span>include<span class="hl_char">\</span>kernel32<span class="hl_char">.</span>inc</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>includelib</b></span>&nbsp;D<span class="hl_char">:</span><span class="hl_char">\</span>masm32<span class="hl_char">\</span>lib<span class="hl_char">\</span>user32<span class="hl_char">.</span>lib</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>includelib</b></span>&nbsp;D<span class="hl_char">:</span><span class="hl_char">\</span>masm32<span class="hl_char">\</span>lib<span class="hl_char">\</span>kernel32<span class="hl_char">.</span>lib</li><li class="hl_l1"></li><li class="hl_l0"><span class="hl_comment">; --- удобные ммкросы ---</span></li><li class="hl_l1"><span class="hl_comment">; для определения строк по ходу кода</span></li><li class="hl_l0">zSTR&nbsp;<span class="hl_function"><b>MACRO</b></span>&nbsp;MyStr</li><li class="hl_l1"><span class="hl_function"><b>LOCAL</b></span>&nbsp;addrMyStr&nbsp;</li><li class="hl_l0"><span class="hl_char">.</span>data</li><li class="hl_l1">&nbsp;&nbsp;addrMyStr&nbsp;<span class="hl_function"><b>db</b></span>&nbsp;MyStr<span class="hl_char">,</span>&nbsp;0</li><li class="hl_l0"><span class="hl_char">.</span>code</li><li class="hl_l1">EXITM&nbsp;<span class="hl_char">&lt;</span><span class="hl_function"><b>offset</b></span>&nbsp;addrMyStr<span class="hl_char">&gt;</span></li><li class="hl_l0">ENDM</li><li class="hl_l1"><span class="hl_comment">; ---</span></li><li class="hl_l0"><span class="hl_comment">; для вызова подпрограмм как функций</span></li><li class="hl_l1">FUNC&nbsp;<span class="hl_function"><b>MACRO</b></span>&nbsp;ListArgs<span class="hl_char">:</span>VARARG</li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;ListArgs</li><li class="hl_l1">&nbsp;&nbsp;EXITM&nbsp;<span class="hl_char">&lt;</span><span class="hl_registr">eax</span><span class="hl_char">&gt;</span></li><li class="hl_l0">ENDM</li><li class="hl_l1"></li><li class="hl_l0"><span class="hl_comment">; --- Собственно программа ---</span></li><li class="hl_l1"><span class="hl_char">.</span><span class="hl_function">data</span><span class="hl_char">?</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;AddrArray&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span>&nbsp;<span class="hl_comment">; Адрес размещения массива в памяти</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;zsResult&nbsp;&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_number">1024</span>&nbsp;<span class="hl_function"><b>dup</b></span>&nbsp;<span class="hl_char">(</span><span class="hl_char">?</span><span class="hl_char">)</span>&nbsp;<span class="hl_comment">; статический массив &quot;для компании к динамическому&quot; ;)</span></li><li class="hl_l0"><span class="hl_char">.</span>code</li><li class="hl_l1"></li><li class="hl_l0">start<span class="hl_char">:</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;<span class="hl_comment">; Резервируем 1Гб в адресном пространстве нашего процесса </span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_char">[</span>AddrArray<span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;FUNC<span class="hl_char">(</span>VirtualAlloc<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">1024</span><span class="hl_char">*</span><span class="hl_number">1024</span><span class="hl_char">*</span><span class="hl_number">1024</span><span class="hl_char">,</span>&nbsp;MEM_RESERVE<span class="hl_char">,</span>&nbsp;PAGE_READWRITE<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;<span class="hl_comment">; 0 означает, что Win сама определит по какому стартовому адресу разместить </span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;<span class="hl_comment">; запрашиваемый блок зарезервированных адресов</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;<span class="hl_comment">; Размещаем в нём 10кБ реальной памяти</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;VirtualAlloc<span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span>AddrArray<span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">10</span><span class="hl_char">*</span><span class="hl_number">1024</span><span class="hl_char">,</span>&nbsp;MEM_COMMIT<span class="hl_char">,</span>&nbsp;PAGE_READWRITE</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;<span class="hl_comment">; записываем в неё данные:</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;wsprintf<span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span>AddrArray<span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;zSTR<span class="hl_char">(</span><span class="hl_quote">'Первый блок данных'</span><span class="hl_char">)</span>&nbsp;</li><li class="hl_l0"></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;<span class="hl_comment">; Увеличиваем размер массива до 10Мб</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;VirtualAlloc<span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span>AddrArray<span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">10</span><span class="hl_char">*</span><span class="hl_number">1024</span><span class="hl_char">*</span><span class="hl_number">1024</span><span class="hl_char">,</span>&nbsp;MEM_COMMIT<span class="hl_char">,</span>&nbsp;PAGE_READWRITE</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;<span class="hl_comment">; записываем данные за пределы первоначальных 10кБ:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span>AddrArray<span class="hl_char">]</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">50</span><span class="hl_char">*</span><span class="hl_number">1024</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; смещение в 50кБ</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;wsprintf<span class="hl_char">,</span>&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span>&nbsp;zSTR<span class="hl_char">(</span><span class="hl_quote">'Второй блок данных'</span><span class="hl_char">)</span>&nbsp;</li><li class="hl_l1"></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;<span class="hl_comment">; Выделяем &quot;оторванный&quot; кусок реальной памяти в середине зарезервированного адресного пространства</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span>AddrArray<span class="hl_char">]</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">500</span><span class="hl_char">*</span><span class="hl_number">1024</span><span class="hl_char">*</span><span class="hl_number">1024</span>&nbsp;<span class="hl_comment">; смещение в 500 Мб</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;VirtualAlloc<span class="hl_char">,</span>&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">4</span><span class="hl_char">*</span><span class="hl_number">1024</span><span class="hl_char">,</span>&nbsp;MEM_COMMIT<span class="hl_char">,</span>&nbsp;PAGE_READWRITE</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;<span class="hl_comment">; записываем данные в этот кусок памяти:</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;wsprintf<span class="hl_char">,</span>&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span>&nbsp;zSTR<span class="hl_char">(</span><span class="hl_quote">'Демонстрация работы с разреженными массивами'</span><span class="hl_char">)</span>&nbsp;</li><li class="hl_l0"></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;<span class="hl_comment">; Объединяем разрозненные строки для вывода их на экран</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span>AddrArray<span class="hl_char">]</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">esi</span><span class="hl_char">,</span>&nbsp;edi</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">50</span><span class="hl_char">*</span><span class="hl_number">1024</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; смещение в 50кБ</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">esi</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">500</span><span class="hl_char">*</span><span class="hl_number">1024</span><span class="hl_char">*</span><span class="hl_number">1024</span>&nbsp;<span class="hl_comment">; смещение в 500 Мб</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;wsprintf<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;zsResult<span class="hl_char">,</span>&nbsp;zSTR<span class="hl_char">(</span><span class="hl_char">&lt;</span><span class="hl_quote">'%s'</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">13</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">10</span><span class="hl_char">,</span>&nbsp;<span class="hl_quote">'%s'</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">13</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">10</span><span class="hl_char">,</span>&nbsp;<span class="hl_quote">'%s'</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">13</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">10</span><span class="hl_char">&gt;</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span>AddrArray<span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span>&nbsp;esi</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;MessageBox<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;zsResult<span class="hl_char">,</span>&nbsp;zSTR<span class="hl_char">(</span><span class="hl_char">&lt;</span><span class="hl_quote">'Я изучаю ассемблер'</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">21h</span><span class="hl_char">&gt;</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;MB_OK</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;<span class="hl_comment">; Освобождаем ВСЁ адресной пространство</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;VirtualFree<span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span>AddrArray<span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;MEM_RELEASE</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;ExitProcess<span class="hl_char">,</span>&nbsp;NULL</li><li class="hl_l0"></li><li class="hl_l1"><span class="hl_function"><b>end</b></span>&nbsp;start</li>        </ol>
    </div>
</div></div><br><br><font size="1"><i>-----<br>RE In Progress [!] Coding Hazard [!] Stay Clear of this Cube</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=221515&amp;user=3520&amp;forum_n=6&amp;topic=13799.html&amp;page=0&amp;anchor=6" class="addthx" data-post="221515"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]Clerk[/b]','')">Clerk</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 255.8 (наставник), 19thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.86'>Активность: 0.15<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=17964">Участник</a><br><font color=blue>vx</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 16 февраля 2009 22:25 &middot; Поправил: Clerk <br><script type="text/javascript">QU('Clerk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Clerk" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13799.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
<b>mak</b><br>Ога, тока ты не показал главного - два смежные(страницы рядом) региона памяти обьеденяются в один, это и есть расширение области памяти <img src="img/smilies/s2.gif" alt=""><br>Если автору необходима расширяемая память не большого размера, то оптимально использовать стек - в нём создатся пограничная траница и если происходит к ней обращение ядро автоматически выделит есчо память.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=221518&amp;user=17964&amp;forum_n=6&amp;topic=13799.html&amp;page=0&amp;anchor=7" class="addthx" data-post="221518"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]mak[/b]','')">mak</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3520.jpg" alt=""><br><span class=txtSm>Ранг: 673.3 <font color=magenta>(<b>! !</b>)</font>, 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.48'>Активность: 0.4<span style='color:red'>&searr;</span>0.31</span><br>Статус: <a href="action=userinfo&amp;user=3520">Участник</a><br><font color=blue>CyberMonk</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 16 февраля 2009 22:52 <br><script type="text/javascript">QU('mak','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=mak" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13799.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
Вопрос стоял не конкретно, поэтому как вариант спокойно <img src="img/smilies/s1.gif" alt=""> <br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_char">.</span>686p</li><li class="hl_l1"><span class="hl_char">.</span>mmx</li><li class="hl_l0"><span class="hl_char">.</span><span class="hl_function"><b>model</b></span>&nbsp;<span class="hl_function">flat</span><span class="hl_char">,</span>stdcall</li><li class="hl_l1"><span class="hl_function"><b>option</b></span>&nbsp;casemap<span class="hl_char">:</span>none</li><li class="hl_l0"></li><li class="hl_l1"><span class="hl_function"><b>include</b></span>&nbsp;<span class="hl_char">\</span>masm32<span class="hl_char">\</span>include<span class="hl_char">\</span>ntdll<span class="hl_char">.</span>inc</li><li class="hl_l0"><span class="hl_function"><b>includelib</b></span>&nbsp;<span class="hl_char">\</span>masm32<span class="hl_char">\</span>lib<span class="hl_char">\</span>ntdll<span class="hl_char">.</span>lib</li><li class="hl_l1"><span class="hl_function"><b>include</b></span>&nbsp;<span class="hl_char">\</span>masm32<span class="hl_char">\</span>include<span class="hl_char">\</span>kernel32<span class="hl_char">.</span>inc</li><li class="hl_l0"><span class="hl_function"><b>includelib</b></span>&nbsp;<span class="hl_char">\</span>masm32<span class="hl_char">\</span>lib<span class="hl_char">\</span>kernel32<span class="hl_char">.</span>lib</li><li class="hl_l1"><span class="hl_function"><b>include</b></span>&nbsp;<span class="hl_char">\</span>masm32<span class="hl_char">\</span>include<span class="hl_char">\</span>user32<span class="hl_char">.</span>inc</li><li class="hl_l0"><span class="hl_function"><b>includelib</b></span>&nbsp;<span class="hl_char">\</span>masm32<span class="hl_char">\</span>lib<span class="hl_char">\</span>user32<span class="hl_char">.</span>lib</li><li class="hl_l1"></li><li class="hl_l0"><span class="hl_char">.</span>data</li><li class="hl_l1">szString&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>db</b></span>&nbsp;<span class="hl_quote">&quot;строка которую нужно изменить&quot;</span><span class="hl_char">,</span>0</li><li class="hl_l0">szNewString&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>db</b></span>&nbsp;<span class="hl_quote">&quot;новая строка с той  же длиной&quot;</span><span class="hl_char">,</span>0</li><li class="hl_l1"></li><li class="hl_l0"><span class="hl_char">.</span>code</li><li class="hl_l1">FindWriteMemory&nbsp;<span class="hl_function"><b>proc</b></span>&nbsp;<span class="hl_function"><b>uses</b></span>&nbsp;<span class="hl_registr"><b>esi</b></span>&nbsp;<span class="hl_registr"><b>edi</b></span>&nbsp;<span class="hl_registr"><b>ebx</b></span>&nbsp;ProcessHandle<span class="hl_char">:</span><span class="hl_function">dword</span><span class="hl_char">,</span>lpString<span class="hl_char">:</span><span class="hl_function">dword</span><span class="hl_char">,</span>lpNewString<span class="hl_char">:</span><span class="hl_function">dword</span><span class="hl_char">,</span>lpStringsLen<span class="hl_char">:</span>dwor&nbsp;d</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>local</b></span>&nbsp;ReturnLength<span class="hl_char">:</span>dword</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>local</b></span>&nbsp;SystemInformation<span class="hl_char">:</span>SYSTEM_BASIC_INFORMATION</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>local</b></span>&nbsp;AllocationBase<span class="hl_char">:</span>dword</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>local</b></span>&nbsp;AllocationSize<span class="hl_char">:</span>dword</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>local</b></span>&nbsp;MemoryInformation<span class="hl_char">:</span>MEMORY_BASIC_INFORMATION</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>local</b></span>&nbsp;RegionLenght<span class="hl_char">:</span>dword</li><li class="hl_l0"></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;ZwQuerySystemInformation<span class="hl_char">,</span>SystemBasicInformation<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;SystemInformation<span class="hl_char">,</span><span class="hl_function"><b>sizeof</b></span>&nbsp;SYSTEM_BASIC_INFORMATION<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;ReturnLength</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_registr"><b>eax</b></span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;0</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;AllocationSize<span class="hl_char">,</span><span class="hl_number">1024</span><span class="hl_char">*</span>2024</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;AllocationBase<span class="hl_char">,</span>0</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;ZwAllocateVirtualMemory<span class="hl_char">,</span><span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;AllocationBase<span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;AllocationSize<span class="hl_char">,</span>MEM_COMMIT<span class="hl_char">,</span>PAGE_READWRITE</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_registr"><b>eax</b></span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;0</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span>AllocationBase</li><li class="hl_l0">NextRegionMemory<span class="hl_char">:</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;ZwQueryVirtualMemory<span class="hl_char">,</span>ProcessHandle<span class="hl_char">,</span>SystemInformation<span class="hl_char">.</span>LowestUserAddress&nbsp;<span class="hl_char">,</span>MemoryBasicInformation<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;&nbsp;MemoryInformation<span class="hl_char">,</span><span class="hl_function"><b>sizeof</b></span>&nbsp;MEMORY_BASIC_INFORMATION<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;ReturnLength</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_registr"><b>eax</b></span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;0</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cmp</b></span>&nbsp;MemoryInformation<span class="hl_char">.</span>State<span class="hl_char">,</span>MEM_COMMIT&nbsp;<span class="hl_function"><b>or</b></span>&nbsp;MEM_RESERVE</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jz</b></span>&nbsp;NextRegionMemory</li><li class="hl_l1">NextFragmentMemory<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;MemoryInformation<span class="hl_char">.</span>RegionSize&nbsp;<span class="hl_char">&lt;</span><span class="hl_char">=</span>&nbsp;<span class="hl_number">1024</span><span class="hl_char">*</span>2024</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>MemoryInformation<span class="hl_char">.</span>RegionSize</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span>else</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_number">1024</span><span class="hl_char">*</span>2024</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span>endif</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;RegionLenght<span class="hl_char">,</span>eax</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;ZwReadVirtualMemory<span class="hl_char">,</span>ProcessHandle<span class="hl_char">,</span>MemoryInformation<span class="hl_char">.</span>BaseAddress<span class="hl_char">,</span><span class="hl_registr">edi</span><span class="hl_char">,</span>Re&nbsp;gionLenght<span class="hl_char">,</span>0</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_registr"><b>eax</b></span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;0</li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">esi</span><span class="hl_char">,</span>RegionLenght</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span>esi</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@@<span class="hl_char">:</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>invoke</b></span>&nbsp;memcmp<span class="hl_char">,</span><span class="hl_registr">edi</span><span class="hl_char">,</span>lpString<span class="hl_char">,</span>lpStringsLen</li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_registr"><b>eax</b></span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;0</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>MemoryInformation<span class="hl_char">.</span>BaseAddress</li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>sub</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>RegionLenght</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr"><b>ebx</b></span>&nbsp;<span class="hl_comment">;определяем адрес</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>invoke</b></span>&nbsp;ZwWriteVirtualMemory<span class="hl_char">,</span>ProcessHandle<span class="hl_char">,</span><span class="hl_registr">eax</span><span class="hl_char">,</span>lpNewString<span class="hl_char">,</span>lpStringsLen<span class="hl_char">,</span>0</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_char">.</span>endif</li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>inc</b></span>&nbsp;edi</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>inc</b></span>&nbsp;ebx</li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>dec</b></span>&nbsp;esi</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>jnz</b></span>&nbsp;@B</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span>endif</li><li class="hl_l1"></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;MemoryInformation<span class="hl_char">.</span>RegionSize&nbsp;<span class="hl_char">&lt;</span><span class="hl_char">=</span>&nbsp;<span class="hl_number">1024</span><span class="hl_char">*</span>2024</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>MemoryInformation<span class="hl_char">.</span>BaseAddress</li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>MemoryInformation<span class="hl_char">.</span>RegionSize</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>mov</b></span>&nbsp;SystemInformation<span class="hl_char">.</span>LowestUserAddress<span class="hl_char">,</span>eax</li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>cmp</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>SystemInformation<span class="hl_char">.</span>HighestUserAddress</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>jc</b></span>&nbsp;NextRegionMemory</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span>else</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_number">1024</span><span class="hl_char">*</span>2024</li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>sub</b></span>&nbsp;MemoryInformation<span class="hl_char">.</span>RegionSize<span class="hl_char">,</span>eax</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>add</b></span>&nbsp;MemoryInformation<span class="hl_char">.</span>BaseAddress<span class="hl_char">,</span>eax</li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>jmp</b></span>&nbsp;NextFragmentMemory</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span>endif</li><li class="hl_l0"></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span>endif</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;ZwFreeVirtualMemory<span class="hl_char">,</span><span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;AllocationBase<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;AllocationSize<span class="hl_char">,</span>MEM_RELEASE</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span>endif</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>endif</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret</li><li class="hl_l0">FindWriteMemory&nbsp;endp</li><li class="hl_l1">start&nbsp;proc</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>local</b></span>&nbsp;Buffer<span class="hl_char">[</span><span class="hl_number">1024</span><span class="hl_char">]</span><span class="hl_char">:</span>byte</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;lstrcpy<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;Buffer<span class="hl_char">,</span><span class="hl_function"><b>offset</b></span>&nbsp;szString</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;FindWriteMemory<span class="hl_char">,</span><span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">,</span><span class="hl_function"><b>offset</b></span>&nbsp;szString<span class="hl_char">,</span><span class="hl_function"><b>offset</b></span>&nbsp;szNewString<span class="hl_char">,</span><span class="hl_function"><b>sizeof</b></span>&nbsp;szString</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;MessageBox<span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span><span class="hl_function"><b>offset</b></span>&nbsp;szString<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;Buffer<span class="hl_char">,</span>0</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;ExitProcess<span class="hl_char">,</span>0</li><li class="hl_l1">start&nbsp;endp</li><li class="hl_l0"><span class="hl_function"><b>end</b></span>&nbsp;start</li>        </ol>
    </div>
</div></div><br><br><font size="1"><i>-----<br>RE In Progress [!] Coding Hazard [!] Stay Clear of this Cube</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=221524&amp;user=3520&amp;forum_n=6&amp;topic=13799.html&amp;page=0&amp;anchor=8" class="addthx" data-post="221524"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]Clerk[/b]','')">Clerk</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 255.8 (наставник), 19thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.86'>Активность: 0.15<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=17964">Участник</a><br><font color=blue>vx</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 февраля 2009 00:39 <br><script type="text/javascript">QU('Clerk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Clerk" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13799.html&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
<b>mak</b><br>Хоть один кодес нормальный тут увидел, спасибо <img src="img/smilies/s3.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=221541&amp;user=17964&amp;forum_n=6&amp;topic=13799.html&amp;page=0&amp;anchor=9" class="addthx" data-post="221541"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]vnekrilov[/b]','')">vnekrilov</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 329.6 (мудрец), 192thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.08'>Активность: 0.14<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=5173">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 февраля 2009 08:04 <br><script type="text/javascript">QU('vnekrilov','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=vnekrilov" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13799.html&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
<I>mak пишет:<br>Вопрос стоял не конкретно, поэтому как вариант спокойно </I><br><br>Уточню вопрос. Имеется такая ситуация. Протектор Asprotect, при запуске программы, создает области памяти, куда помещает украденный код. На эти области памяти имеются прыжки в главной области программы. При восстановлении эмулированных инструкций в этих областях памяти, восстановленные инструкции записываются в конец конкретной области памяти. В некоторых случаях свободного места в конце области памяти - недостаточно. Нужно добавить 500 - 1000 КБ памяти, и все становится ОК. Скрипт, который я пишу для этих целей, должен увеличить размер той области памяти, в которой не хватает свободного места. Сама проверка размера свободного места - тривиальная, но после выполнения этой проверки, если места мало, то его нужно добавить. В предыдущих моих скриптах, там, где не хватало свободного места, я дописывал восстановленные инструкции в последней секции распаковываемого файла, но мне встречаются программы, где не хватает этой 1000h байтов. Пока я это делал так. Находил место в коде Asprotect.dll, где создается область памяти с недостающим размером, и вручную исправлял параметр размера создаваемой области памяти. Однако - это гемморно. Вот почему и возник этот вопрос. Хочется, чтобы все было красиво.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=221561&amp;user=5173&amp;forum_n=6&amp;topic=13799.html&amp;page=0&amp;anchor=10" class="addthx" data-post="221561"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]mak[/b]','')">mak</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3520.jpg" alt=""><br><span class=txtSm>Ранг: 673.3 <font color=magenta>(<b>! !</b>)</font>, 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.48'>Активность: 0.4<span style='color:red'>&searr;</span>0.31</span><br>Статус: <a href="action=userinfo&amp;user=3520">Участник</a><br><font color=blue>CyberMonk</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 февраля 2009 15:03 <br><script type="text/javascript">QU('mak','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=mak" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13799.html&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
Это другой вопрос тогда , а как ты правил размер ? скриптом самим имеется ввиду вручную ? Если память динамическая , то в какой промежуток создается буффер ? Что приходит на голову так это наверное полностью убирать аллокацию памяти скриптом или пропускать , и алокацию самому делать со своими параметрами , играясь как те вздумается с памятью. Я так пологаю колы в область тоже динамические , поэтому сьедят и твои буфера с памятью. Подставной буфер короче будет. С одной стоороны тож геморойно а с другой ок .. <img src="img/smilies/s1.gif" alt="">
<br><br><font size="1"><i>-----<br>RE In Progress [!] Coding Hazard [!] Stay Clear of this Cube</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=221593&amp;user=3520&amp;forum_n=6&amp;topic=13799.html&amp;page=0&amp;anchor=11" class="addthx" data-post="221593"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]Clerk[/b]','')">Clerk</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 255.8 (наставник), 19thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.86'>Активность: 0.15<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=17964">Участник</a><br><font color=blue>vx</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 февраля 2009 15:53 <br><script type="text/javascript">QU('Clerk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Clerk" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13799.html&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
&gt; Скрипт, который я пишу для этих целей, должен увеличить размер той области памяти, в которой не хватает свободного места.<br>Ну так просто выдели страниц скока нужно и всё.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=221599&amp;user=17964&amp;forum_n=6&amp;topic=13799.html&amp;page=0&amp;anchor=12" class="addthx" data-post="221599"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]Smon[/b]','')">Smon</a></b><br></div>
<img src="img/s8.gif" alt=""><br><span class=txtSm>Ранг: 500.5 (<b>!</b>), 8thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.33'>Активность: 0.23<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1449">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 февраля 2009 16:32 &middot; Поправил: Smon <br><script type="text/javascript">QU('Smon','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Smon" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13799.html&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
<I>vnekrilov пишет:<br>Пока я это делал так. Находил место в коде Asprotect.dll, где создается область памяти с недостающим размером, и вручную исправлял параметр размера создаваемой области памяти </I><br>Единственное верное решение для этого случая имхо, только искать и править не вручную а скриптом по сигне, расширить по другому уже выделенный аспром регион не выйдет (сам он ничего не резервирует, копирование кода в больший регион и смена значения адреса в переменных аспра тоже вызовет глюки если код не базонезависисимый, поэтому лучшее решение - искать по сигне скриптом ту точку в библиотеке и править её на нужную до выделения. Можно и хук поставить на саму процедуру (если заранее неизвестен нужный размер) после распаковки аспр.длл, можно и просто в 10 раз больше выделять сразу и всё <img src="img/smilies/s1.gif" alt="">
<br><br><font size="1"><i>-----<br>&quotПусть видят, что мы не шутим. Стволы для понта, ножи для дела&quot Lock, Stock &amp Two Smoking Barrels</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=221602&amp;user=1449&amp;forum_n=6&amp;topic=13799.html&amp;page=0&amp;anchor=13" class="addthx" data-post="221602"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]Demon666[/b]','')">Demon666</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 213.5 (наставник)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.21'>Активность: 0.12<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=4551">Участник</a><br><font color=blue>забанен</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 февраля 2009 02:10 <br><script type="text/javascript">QU('Demon666','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Demon666" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13799.html&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
А можно мне - мну в вопросе сабжа не шаред %)), но..<br><I>Smon пишет:<br>поэтому лучшее решение - искать по сигне скриптом ту точку в библиотеке и править её на нужную до выделения </I> <br>А че мешает грамотно захучить <b>&quot;по-условию&quot;</b> VirtualAlloc и когда условие становиццо истеным.. – подменить 1000h байтов на 3000h байтов(при передаче параметров), мну лично так и сделал бы тупо с разбегу (в лучших традициях дзена %) вроде как,  да универсальность имеецца), а вообще хз может эти олькины скрипты такую задачу и не асилят? Тогда ф топку их нах %))) шучу!<br>При этом выделять память больше всегда(тут и тривиальные проверки в скрипте уже нах не нужны будут), а потом когда выделилось 3000h байтов просто снимать/килять хук(если больше не нужен) да и фсе..<br>ЗЫ: К примеру ставим бряк на &quot;волшебную точку&quot; после нее(как сработает) на VirtualAlloc и как только сработает бряк на VirtualAlloc удаляем его и в стеке меняем параметр 1000h на 3000h и далее RUN<br>И че-то подобное, где-то уже в ахренено здоровой теме по аспру обсуждалось, только там вообще ПЕ заголовок расширить надо было чтоли, если память не изменяет...<br>Короче как-то так наверное <img src="img/smilies/s6.gif" alt="">
<br><br><font size="1"><i>-----<br>ЗЫ: истЕна где-то рядом, Welcome@Google.com</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=221686&amp;user=4551&amp;forum_n=6&amp;topic=13799.html&amp;page=0&amp;anchor=14" class="addthx" data-post="221686"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]Smon[/b]','')">Smon</a></b><br></div>
<img src="img/s8.gif" alt=""><br><span class=txtSm>Ранг: 500.5 (<b>!</b>), 8thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.33'>Активность: 0.23<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1449">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 февраля 2009 07:53 <br><script type="text/javascript">QU('Smon','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Smon" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13799.html&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
<I>Demon666 пишет:<br>А че мешает грамотно захучить &quot;по-условию&quot; VirtualAlloc и когда условие становиццо истеным.. – подменить 1000h байтов на 3000h </I><br>Можно еще проще сделать тогда - захучить VA и все 1000h подменять на 3000h без дополнительных проверок <img src="img/smilies/s1.gif" alt="">
<br><br><font size="1"><i>-----<br>&quotПусть видят, что мы не шутим. Стволы для понта, ножи для дела&quot Lock, Stock &amp Two Smoking Barrels</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=221700&amp;user=1449&amp;forum_n=6&amp;topic=13799.html&amp;page=0&amp;anchor=15" class="addthx" data-post="221700"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]vnekrilov[/b]','')">vnekrilov</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 329.6 (мудрец), 192thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.08'>Активность: 0.14<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=5173">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 февраля 2009 09:19 &middot; Поправил: vnekrilov <br><script type="text/javascript">QU('vnekrilov','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=vnekrilov" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13799.html&amp;page=0#16');return false;">#16</a> </span><div align=left><br>
<I>Demon666 пишет:<br>VirtualAlloc удаляем его и в стеке меняем параметр 1000h на 3000h и далее RUN  </I><br><br>Я кстати так и делал. Только делал это вручную. Кстати, в одной программе у меня было 28 областей памяти со спертыми байтами. Во всех областях хватало свободного места, чтобы записать туда восстановленные инструкции. А вот в одной области памяти - НЕТ. Кроме того, размеры все областей памяти были разными - от 1000h байтов до 6000h байтов. Поэтому все-таки есть резон выполнять проверку свободного места в конце области памяти (оно должно быть примерно 30% от размера этой области памяти), т.е.нужно каждую такую область памяти увеличивать в 1,3 раза. Но дело еще обстоит в том, что протектор создает много разных областей памяти, но для стыренных байтов их всего лишь несколько, остальные такие области памяти создаются для других целей (например, для записи кода подпрограмм, которые извлекают информацию из массивов данных), где увеличивать размер области памяти нет необходимости.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=221710&amp;user=5173&amp;forum_n=6&amp;topic=13799.html&amp;page=0&amp;anchor=16" class="addthx" data-post="221710"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]Demon666[/b]','')">Demon666</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 213.5 (наставник)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.21'>Активность: 0.12<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=4551">Участник</a><br><font color=blue>забанен</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 февраля 2009 11:42 &middot; Поправил: Demon666 <br><script type="text/javascript">QU('Demon666','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Demon666" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13799.html&amp;page=0#17');return false;">#17</a> </span><div align=left><br>
<b>Smon</b><br>Если честно, то у моего бота crackrss было в логах<br><I>Smon пишет:<br>Единственное верное решение для этого случая имхо</I> ;)<br>Хз. остальная часть мессаги где-то в сети потом значит отламилась <img src="img/smilies/s1.gif" alt=""> <br>Мну написал постенг - когда зашел.. вижу, а у тебя считай что тоже самое написано <img src="img/smilies/s5.gif" alt=""><br>Но я все равно, взял да и отпостил ;)<br><br><b>vnekrilov</b><br>Но ты же должен понимать что это я так для примера написал ;) <br>написать можно что хочеццо, а тебе уже потом решать что юзать или вообще не юзать ;)<br><I>vnekrilov пишет:<br>Поэтому все-таки есть резон выполнять проверку свободного места в конце области памяти (оно должно быть примерно 30% от размера этой области памяти), т.е.нужно каждую такую область памяти увеличивать в 1,3 раза </I><br>Ну можно просто - узнаем длину выделяемой памяти и умножаем ее на(ну к примеру) 1,5<br><I>vnekrilov пишет:<br>Однако - это гемморно. Вот почему и возник этот вопрос. Хочется, чтобы все было красиво </I><br>Хз просто в кодинге(чтобы было красиво) всегда такие весчи заворачивают в тег <b>try</b> и если уже когда конкретно не хватило памяти(произошло исключение), дополнительно ее выделяют в except, finally, etc..<br>Я хз есть ли у оли механизм обработки исключений, но во всех скриптовых движках, которые я знаю - он присутствует, если нет - то его надо дописывать(если юзаешь часто этот скриптовый двиг)<br>Механизм обработчика исключений в скриптовом двиге позволяет значительно сократить объемы написания скриптого кодеса(до 50%) и упростить понимание логики скрипта третьим лицам ;) – ИМХО..
<br><br><font size="1"><i>-----<br>ЗЫ: истЕна где-то рядом, Welcome@Google.com</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=221729&amp;user=4551&amp;forum_n=6&amp;topic=13799.html&amp;page=0&amp;anchor=17" class="addthx" data-post="221729"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]int_256[/b]','')">int_256</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 20.8 (новичок), 7thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.69'>Активность: 0.01<span style='color:green'>&nearr;</span>0.02</span><br>Статус: <a href="action=userinfo&amp;user=18773">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 февраля 2009 13:24 <br><script type="text/javascript">QU('int_256','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=int_256" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13799.html&amp;page=0#18');return false;">#18</a> </span><div align=left><br>
я аспр ломал т.о. - в virtualloc в кернел32.длл вставляется джамп на мой код в библе, котрый эмулировал вызовы virtualloc из аспра, а другие пропускал, и создавал кучу в предварительно добавленной дополнительной секции. при этом весь распакованный и сворованный код уже оказывается в экзешнике )) который дампишь потом и все<br>При запуске подгружается моя длл, далее вызывается heapcreate, в то месте где HeapCreate вызывает zwallocatevirtualmemory надо подсунуть адрес дополнительной секции<br>далее вызовы аспром virtualalloc переделываешь в heapalloc
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=221740&amp;user=18773&amp;forum_n=6&amp;topic=13799.html&amp;page=0&amp;anchor=18" class="addthx" data-post="221740"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Как программно увеличить размер уже выделенной области памяти</span></td>
</tr></table>
</div>
<a name=newreply></a>
<div align=center>
<table class=forums>
<tr>
<td class=caption4 width="100%"><span class=header>Эта тема закрыта. Ответы больше не принимаются.</span></td>
</tr>
</table>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=13799" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
