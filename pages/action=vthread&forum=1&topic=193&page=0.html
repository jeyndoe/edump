<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>проблемы с ZwQuerySystemInformation - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="здраствуйте. вот захотелось мне написать маленький мониторчик, чтобы мониторил память фаил покачки процессор и сетевые подключения. все это уже реализовано кроме мониторинга загруженности процессора. я узнал что эту инфу можно">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=3756'>==DJ==[ZLO]</a>, <a target='_blank' href='?action=userinfo&amp;user=21426'>Dart Raiden</a>, <a target='_blank' href='?action=userinfo&amp;user=242'>Alf</a> (+6 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/green.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=1&sortBy=0&page=0.html"><b>Основной форум</b></a> <b class=bulletHead>&#8212;&#8250;</b> проблемы с ZwQuerySystemInformation</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]Blow[/b]','')">Blow</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.2 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.9'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=194">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 августа 2004 03:43 <br><script type="text/javascript">QU('Blow','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Blow" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=193.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
здраствуйте.
<br>вот захотелось мне написать маленький мониторчик, чтобы мониторил память фаил покачки процессор и сетевые подключения. все это уже реализовано кроме мониторинга загруженности процессора. 
<br>я узнал что эту инфу можно получить вызвав ZwQuerySystemInformation, но эта функия недокументирована.
<br>собственно вопрос:  что я делаю не так  ? <img src="img/smilies/s6.gif" alt="">
<br>
<br>вот код:
<br>STATUS_SUCCESS		         equ 0
<br>SystemProcessorTimes		equ 8
<br>.data?
<br>SYSTEM_PROCESSOR_TIMES STRUCT
<br> IdleTime QWORD ?
<br> KernelTime QWORD ?
<br> UserTime QWORD ?
<br> DpcTime QWORD ?
<br> InterruptTime QWORD ?
<br> InterruptCount QWORD ?
<br>SYSTEM_PROCESSOR_TIMES ENDS
<br>ZwQuerySystemInformation dd ?
<br>P PVOID ?
<br>.data
<br>NtDll    db &quot;NTDLL.DLL&quot;,0
<br>ZQSI    db &quot;ZwQuerySystemInformation&quot;,0
<br>CPU     db &quot;загрузка CPU: %u&quot;,0
<br>.code
<br>invoke GetModuleHandleA,ADDR NtDll
<br>invoke GetProcAddress,eax,ADDR ZQSI
<br>mov ZwQuerySystemInformation,eax
<br>mov Temp, 0	    
<br>push offset Temp
<br>push 0
<br>push offset P
<br>push SystemProcessorTimes
<br>call ZwQuerySystemInformation
<br>.if Temp != 0
<br>   invoke GlobalAlloc,GMEM_MOVEABLE,Temp
<br>   mov [tcphand],eax
<br>   invoke GlobalLock,eax
<br>   mov [tcpmem],eax   
<br>   push offset Temp
<br>   push [tcpmem]
<br>   push Temp
<br>   push SystemProcessorTimes
<br>   call ZwQuerySystemInformation
<br>   .if eax==STATUS_SUCCESS
<br>      mov esi,[tcpmem]
<br>      assume esi:PTR SYSTEM_PROCESSOR_TIMES
<br>      invoke wsprintf,addr Buffer,addr CPU,[esi].IdleTime
<br>      invoke MessageBox,0,addr Buffer,0,0
<br>      assume esi:nothing
<br>   .endif
<br>  invoke GlobalFree,[tcphand]
<br>.endif
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=1830&amp;user=194&amp;forum_n=1&amp;topic=193.html&amp;page=0&amp;anchor=1" class="addthx" data-post="1830"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]dragon[/b]','')">dragon</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 40.0 (посетитель), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.93'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=91">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 августа 2004 05:18 <br><script type="text/javascript">QU('dragon','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=dragon" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=193.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
Эта функция документирована, есть справочник по native api. Вот работающий код:
<br>
<br>.686p
<br>.MMX
<br>.XMM
<br>.model flat, stdcall
<br>option casemap:none
<br>
<br>include &#92;masm32&#92;include&#92;windows.inc
<br>include &#92;masm32&#92;include&#92;kernel32.inc
<br>include &#92;masm32&#92;include&#92;user32.inc
<br>
<br>includelib	&#92;masm32&#92;lib&#92;kernel32.lib
<br>includelib	&#92;masm32&#92;lib&#92;user32.lib
<br>
<br>STATUS_SUCCESS equ 0 
<br>SystemProcessorTimes equ 8 
<br>
<br>SYSTEM_PROCESSOR_TIMES STRUCT 
<br>IdleTime QWORD ? 
<br>KernelTime QWORD ? 
<br>UserTime QWORD ? 
<br>DpcTime QWORD ? 
<br>InterruptTime QWORD ? 
<br>InterruptCount QWORD ? 
<br>SYSTEM_PROCESSOR_TIMES ENDS 
<br>
<br>.data 
<br>NtDll db &quot;NTDLL.DLL&quot;,0 
<br>ZQSI db &quot;ZwQuerySystemInformation&quot;,0 
<br>CPU db &quot;&#231;&#224;&#227;&#240;&#243;&#231;&#234;&#224; CPU: %u&quot;,0
<br>
<br>
<br>.data? 
<br>ZwQuerySystemInformation dd ? 
<br>Temp dd ?
<br>tcphand dd ?
<br>tcpmem dd ?
<br>
<br>processors	SYSTEM_PROCESSOR_TIMES	MAXIMUM_PROCESSORS dup(&lt;&gt;)
<br>Buffer db	512 dup(?)
<br>
<br>.code 
<br> start:
<br>invoke GetModuleHandleA,ADDR NtDll 
<br>invoke GetProcAddress,eax,ADDR ZQSI
<br>mov ZwQuerySystemInformation, eax
<br>push offset Temp
<br>push offset MAXIMUM_PROCESSORS*sizeof SYSTEM_PROCESSOR_TIMES
<br>push offset processors 
<br>push SystemProcessorTimes 
<br>call ZwQuerySystemInformation 
<br>
<br>invoke wsprintf,addr Buffer,addr CPU, DWORD PTR processors[0*sizeof SYSTEM_PROCESSOR_TIMES].InterruptCount
<br>invoke MessageBox,0,addr Buffer,0,0 
<br>
<br>invoke	ExitProcess, NULL
<br>end start
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=1835&amp;user=91&amp;forum_n=1&amp;topic=193.html&amp;page=0&amp;anchor=2" class="addthx" data-post="1835"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]Blow[/b]','')">Blow</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.2 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.9'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=194">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 августа 2004 05:34 &middot; Поправил: Blow <br><script type="text/javascript">QU('Blow','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Blow" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=193.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
от спасибки! 
<br>есть же еще хорошие люди на белом свете... <img src="img/smilies/s6.gif" alt="">
<br>но я наверно чето недогоняю.. Оно мне выдает большущее число , а мнеб проценты <img src="img/smilies/s4.gif" alt=""> неподскажите ли как оно собственно делается, я вижу тут люди умные... <img src="img/smilies/s2.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=1838&amp;user=194&amp;forum_n=1&amp;topic=193.html&amp;page=0&amp;anchor=3" class="addthx" data-post="1838"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]dragon[/b]','')">dragon</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 40.0 (посетитель), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.93'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=91">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 августа 2004 12:21 <br><script type="text/javascript">QU('dragon','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=dragon" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=193.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
А в этой структуре никак загруженность процессора не получить, может другой тип информации получать надо, а не SystemProcessorTimes, сразу не могу сказать.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=1874&amp;user=91&amp;forum_n=1&amp;topic=193.html&amp;page=0&amp;anchor=4" class="addthx" data-post="1874"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]Mario555[/b]','')">Mario555</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/15.jpg" alt=""><br><span class=txtSm>Ранг: 332.0 (мудрец)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.97'>Активность: 0.18<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=15">Участник</a><br><font color=blue>•Pr0tEcToRs KiLLeR•</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 августа 2004 15:13 <br><script type="text/javascript">QU('Mario555','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Mario555" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=193.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
<i>dragon пишет:
<br>есть справочник по native api</i>
<br>ссылочку можно ?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=1884&amp;user=15&amp;forum_n=1&amp;topic=193.html&amp;page=0&amp;anchor=5" class="addthx" data-post="1884"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]Blow[/b]','')">Blow</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.2 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.9'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=194">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 августа 2004 19:10 &middot; Поправил: Blow <br><script type="text/javascript">QU('Blow','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Blow" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=193.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
да мне бы тоже ссылочку на этот справочник
<br>блин <img src="img/smilies/s4.gif" alt="">, ну неужто никто не занимался этим вопросом?
<br>пол интернета перепахал а ненашел практически ничего <img src="img/smilies/s4.gif" alt="">
<br>ну может хоть ктонибудь а? 
<br>буду примного благодарен!
<br>вот тут вот нашел пример на делфях, dragon, глянь пожалуста может что поймешь..
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=1893&amp;user=194&amp;forum_n=1&amp;topic=193.html&amp;page=0&amp;anchor=6" class="addthx" data-post="1893"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]Blow[/b]','')">Blow</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.2 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.9'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=194">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 августа 2004 19:16 <br><script type="text/javascript">QU('Blow','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Blow" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=193.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
вот примерчик<br><br><img src="img/attach.gif"> <a href="files/_2029832181__cpuload.rar">_2029832181__cpuload.rar</a><!--file-->
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=1894&amp;user=194&amp;forum_n=1&amp;topic=193.html&amp;page=0&amp;anchor=7" class="addthx" data-post="1894"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]dragon[/b]','')">dragon</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 40.0 (посетитель), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.93'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=91">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 20 августа 2004 01:34 <br><script type="text/javascript">QU('dragon','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=dragon" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=193.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
Я не знаю, где сейчас лежит, могу только на мыло кинуть, это 1.5Mb занимает.
<br>
<br>Я delphi не знаю, мало что я там пойму..
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=1900&amp;user=91&amp;forum_n=1&amp;topic=193.html&amp;page=0&amp;anchor=8" class="addthx" data-post="1900"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]Blow[/b]','')">Blow</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.2 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.9'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=194">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 20 августа 2004 04:00 <br><script type="text/javascript">QU('Blow','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Blow" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=193.html&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
блин жаль, ну кинь если можешь на blowfish бобик mail333.com
<br>
<br>ну может еще тут кто сталкивался? народ ну помогите неужто никто не знает?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=1911&amp;user=194&amp;forum_n=1&amp;topic=193.html&amp;page=0&amp;anchor=9" class="addthx" data-post="1911"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]Blow[/b]','')">Blow</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.2 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.9'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=194">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 20 августа 2004 05:48 &middot; Поправил: Blow <br><script type="text/javascript">QU('Blow','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Blow" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=193.html&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
ладно люди подскажите хотябы как вот такую функцию реализовать на MASM :
<br>Li2Double(x) ((double)((x).HighPart) * 4.294967296E9 + (double)((x).LowPart)) , где х -LARGEINTEGER
<br>в виде макроса, или если уже реализовано то линку киньте
<br>зараннее спасибо
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=1915&amp;user=194&amp;forum_n=1&amp;topic=193.html&amp;page=0&amp;anchor=10" class="addthx" data-post="1915"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]Mario555[/b]','')">Mario555</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/15.jpg" alt=""><br><span class=txtSm>Ранг: 332.0 (мудрец)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.97'>Активность: 0.18<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=15">Участник</a><br><font color=blue>•Pr0tEcToRs KiLLeR•</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 20 августа 2004 12:10 <br><script type="text/javascript">QU('Mario555','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Mario555" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=193.html&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
<b>dragon</b>
<br>кидай на mario555[dog]pisem.net, или просто выложи где-нить...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=1953&amp;user=15&amp;forum_n=1&amp;topic=193.html&amp;page=0&amp;anchor=11" class="addthx" data-post="1953"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]dragon[/b]','')">dragon</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 40.0 (посетитель), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.93'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=91">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 20 августа 2004 12:41 <br><script type="text/javascript">QU('dragon','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=dragon" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=193.html&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
Я обоим кинул файл.
<br>
<br><b>Blow</b>
<br>вот код, макрос сам напиши
<br>
<br>n0 dq 4.294967296E9
<br>
<br>...
<br>
<br>FILD DWORD PTR x.HighPart
<br>FLD QWORD PTR n0
<br>FMULP ST(1), ST(0)
<br>FILD DWORD PTR x.LowPart
<br>FADDP ST(1), ST(0)
<br>
<br>в ST0 результат.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=1956&amp;user=91&amp;forum_n=1&amp;topic=193.html&amp;page=0&amp;anchor=12" class="addthx" data-post="1956"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]Mario555[/b]','')">Mario555</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/15.jpg" alt=""><br><span class=txtSm>Ранг: 332.0 (мудрец)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.97'>Активность: 0.18<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=15">Участник</a><br><font color=blue>•Pr0tEcToRs KiLLeR•</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 20 августа 2004 13:07 <br><script type="text/javascript">QU('Mario555','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Mario555" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=193.html&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
<b>dragon</b>
<br>письмо получил, пасибо.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=1960&amp;user=15&amp;forum_n=1&amp;topic=193.html&amp;page=0&amp;anchor=13" class="addthx" data-post="1960"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]Blow[/b]','')">Blow</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.2 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.9'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=194">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 20 августа 2004 19:12 <br><script type="text/javascript">QU('Blow','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Blow" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=193.html&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
<b>dragon</b>
<br>Спасибо! компонейский ты человек <img src="img/smilies/s3.gif" alt="">!
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=1992&amp;user=194&amp;forum_n=1&amp;topic=193.html&amp;page=0&amp;anchor=14" class="addthx" data-post="1992"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]gloom[/b]','')">gloom</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 192.3 (ветеран), 18thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.97'>Активность: 0.12<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=11">Участник</a><br><font color=blue>stoned machine-gunner</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 21 августа 2004 19:01 <br><script type="text/javascript">QU('gloom','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=gloom" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=193.html&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
блин, я тоже этот справочник хочу... <img src="img/smilies/s1.gif" alt="">
<br>gl00m-crk#@#yandex.ru
<br><br><font size="1"><i>-----<br>once you have tried it, you will never want anything else</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=2047&amp;user=11&amp;forum_n=1&amp;topic=193.html&amp;page=0&amp;anchor=15" class="addthx" data-post="2047"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]dragon[/b]','')">dragon</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 40.0 (посетитель), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.93'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=91">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 22 августа 2004 04:30 <br><script type="text/javascript">QU('dragon','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=dragon" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=193.html&amp;page=0#16');return false;">#16</a> </span><div align=left><br>
<b>gloom</b>
<br>Выслал.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=2054&amp;user=91&amp;forum_n=1&amp;topic=193.html&amp;page=0&amp;anchor=16" class="addthx" data-post="2054"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]Inferno[mteam][/b]','')">Inferno[mteam]</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 0.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.92'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=148">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 22 августа 2004 05:06 <br><script type="text/javascript">QU('Inferno[mteam]','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Inferno[mteam]" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=193.html&amp;page=0#17');return false;">#17</a> </span><div align=left><br>
<b>dragon</b>
<br>И мне, если не затруднит
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=2057&amp;user=148&amp;forum_n=1&amp;topic=193.html&amp;page=0&amp;anchor=17" class="addthx" data-post="2057"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]Spiteful[/b]','')">Spiteful</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 18.1 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.92'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=154">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 22 августа 2004 05:32 <br><script type="text/javascript">QU('Spiteful','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Spiteful" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=193.html&amp;page=0#18');return false;">#18</a> </span><div align=left><br>
хм, по размеру напоминает книжку Гари Неббета, которую успешно можно слить с этого сайта http://www.volynkin.com/references.htm
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=2060&amp;user=154&amp;forum_n=1&amp;topic=193.html&amp;page=0&amp;anchor=18" class="addthx" data-post="2060"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]dragon[/b]','')">dragon</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 40.0 (посетитель), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.93'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=91">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 22 августа 2004 06:00 <br><script type="text/javascript">QU('dragon','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=dragon" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=193.html&amp;page=0#19');return false;">#19</a> </span><div align=left><br>
Ага, точно, там есть:
<br>
<br>h**p://www.volynkin.com/Files/Windows.NT.2000.Native.API.Reference.rar
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=2061&amp;user=91&amp;forum_n=1&amp;topic=193.html&amp;page=0&amp;anchor=19" class="addthx" data-post="2061"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="20" onfocus="this.blur()" href="JavaScript:di('[b]gloom[/b]','')">gloom</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 192.3 (ветеран), 18thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.97'>Активность: 0.12<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=11">Участник</a><br><font color=blue>stoned machine-gunner</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 22 августа 2004 08:23 <br><script type="text/javascript">QU('gloom','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=gloom" target="_blank">Личное сообщение</a> &middot;  <a href="#20" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=193.html&amp;page=0#20');return false;">#20</a> </span><div align=left><br>
спасибо dragon!
<br><br><font size="1"><i>-----<br>once you have tried it, you will never want anything else</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=2062&amp;user=11&amp;forum_n=1&amp;topic=193.html&amp;page=0&amp;anchor=20" class="addthx" data-post="2062"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="21" onfocus="this.blur()" href="JavaScript:di('[b]DDA[/b]','')">DDA</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 54.2 (постоянный)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.97'>Активность: 0.04<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=9">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 22 августа 2004 08:32 <br><script type="text/javascript">QU('DDA','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DDA" target="_blank">Личное сообщение</a> &middot;  <a href="#21" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=193.html&amp;page=0#21');return false;">#21</a> </span><div align=left><br>
могу подкинуть примерчик только на Delphi
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=2065&amp;user=9&amp;forum_n=1&amp;topic=193.html&amp;page=0&amp;anchor=21" class="addthx" data-post="2065"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="22" onfocus="this.blur()" href="JavaScript:di('[b]Blow[/b]','')">Blow</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.2 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.9'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=194">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 22 августа 2004 18:59 <br><script type="text/javascript">QU('Blow','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Blow" target="_blank">Личное сообщение</a> &middot;  <a href="#22" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=193.html&amp;page=0#22');return false;">#22</a> </span><div align=left><br>
ну подкинь сюда если можешь
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=2102&amp;user=194&amp;forum_n=1&amp;topic=193.html&amp;page=0&amp;anchor=22" class="addthx" data-post="2102"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="23" onfocus="this.blur()" href="JavaScript:di('[b]DDA[/b]','')">DDA</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 54.2 (постоянный)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.97'>Активность: 0.04<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=9">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 августа 2004 07:02 <br><script type="text/javascript">QU('DDA','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DDA" target="_blank">Личное сообщение</a> &middot;  <a href="#23" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=193.html&amp;page=0#23');return false;">#23</a> </span><div align=left><br>
unit adCpuUsage;
<br>
<br>{* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
<br>CPU Usage Measurement routines for Delphi and C++ Builder
<br>
<br>Author:       Alexey A. Dynnikov
<br>EMail:        aldyn@chat.ru
<br>WebSite:      www.aldyn.ru/
<br>Support:      Use the e-mail aldyn@chat.ru
<br>                          or support@aldyn.ru
<br>
<br>Creation:     Jul 8, 2000
<br>Version:      1.02
<br>
<br>Legal issues: Copyright (C) 2000 by Alexey A. Dynnikov &lt;aldyn@chat.ru&gt;
<br>
<br>              This software is provided &#039;as-is&#039;, without any express or
<br>              implied warranty.  In no event will the author be held liable
<br>              for any  damages arising from the use of this software.
<br>
<br>              Permission is granted to anyone to use this software for any
<br>              purpose, including commercial applications, and to alter it
<br>              and redistribute it freely, subject to the following
<br>              restrictions:
<br>
<br>              1. The origin of this software must not be misrepresented,
<br>                 you must not claim that you wrote the original software.
<br>                 If you use this software in a product, an acknowledgment
<br>                 in the product documentation would be appreciated but is
<br>                 not required.
<br>
<br>              2. Altered source versions must be plainly marked as such, and
<br>                 must not be misrepresented as being the original software.
<br>
<br>              3. This notice may not be removed or altered from any source
<br>                 distribution.
<br>
<br>++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ ++++++++++
<br>USAGE:
<br>
<br>1. Include this unit into project.
<br>
<br>2. Call GetCPUCount to obtain the numbr of processors in the system
<br>
<br>3. Each time you need to know the value of CPU usage call the CollectCPUData
<br>   to refresh the CPU usage information. Then call the GetCPUUsage to obtain
<br>   the CPU usage for given processor. Note that succesive calls of GetCPUUsage
<br>   without calling CollectCPUData will return the same CPU usage value.
<br>
<br>Example:
<br>
<br>procedure TTestForm.TimerTimer(Sender: TObject);
<br>var i: Integer;
<br>begin
<br>    CollectCPUData; // Get the data for all processors
<br>
<br>    for i:=0 to GetCPUCount-1 do // Show data for each processor
<br>        MInfo.Lines[i]:=Format(&#039;CPU #%d - %5.2f%%&#039;,[i,GetCPUUsage(i)*100]);
<br>end;
<br>* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *}
<br>
<br>interface
<br>
<br>uses
<br>    Windows, SysUtils;
<br>
<br>// Call CollectCPUData to refresh information about CPU usage
<br>procedure CollectCPUData;
<br>
<br>// Call it to obtain the number of CPU&#039;s in the system
<br>function GetCPUCount: Integer;
<br>
<br>// Call it to obtain the % of usage for given CPU
<br>function GetCPUUsage(Index: Integer): Double;
<br>
<br>// For Win9x only: call it to stop CPU usage monitoring and free system resources
<br>procedure ReleaseCPUData;
<br>
<br>implementation
<br>
<br>{&#036;ifndef ver110}
<br>
<br>    {&#036;ifndef ver90}
<br>    {&#036;ifndef ver100}
<br>    {&#036;define UseInt64}
<br>    {&#036;endif}
<br>    {&#036;endif}
<br>
<br>
<br>    {&#036;ifdef UseInt64}
<br>    type TInt64 = Int64;
<br>    {&#036;else}
<br>    type TInt64 = Comp;
<br>    {&#036;endif}
<br>
<br>{&#036;else}
<br>
<br>    type TInt64 = TLargeInteger;
<br>
<br>{&#036;endif}
<br>
<br>type
<br>    PInt64 = ^TInt64;
<br>
<br>type
<br>    TPERF_DATA_BLOCK = record
<br>        Signature : array[0..4 - 1] of WCHAR;
<br>        LittleEndian : DWORD;
<br>        Version : DWORD;
<br>        Revision : DWORD;
<br>        TotalByteLength : DWORD;
<br>        HeaderLength : DWORD;
<br>        NumObjectTypes : DWORD;
<br>        DefaultObject : Longint;
<br>        SystemTime : TSystemTime;
<br>        Reserved: DWORD;
<br>        PerfTime : TInt64;
<br>        PerfFreq : TInt64;
<br>        PerfTime100nSec : TInt64;
<br>        SystemNameLength : DWORD;
<br>        SystemNameOffset : DWORD;
<br>    end;
<br>
<br>    PPERF_DATA_BLOCK = ^TPERF_DATA_BLOCK;
<br>
<br>    TPERF_OBJECT_TYPE = record
<br>        TotalByteLength : DWORD;
<br>        DefinitionLength : DWORD;
<br>        HeaderLength : DWORD;
<br>        ObjectNameTitleIndex : DWORD;
<br>        ObjectNameTitle : LPWSTR;
<br>        ObjectHelpTitleIndex : DWORD;
<br>        ObjectHelpTitle : LPWSTR;
<br>        DetailLevel : DWORD;
<br>        NumCounters : DWORD;
<br>        DefaultCounter : Longint;
<br>        NumInstances : Longint;
<br>        CodePage : DWORD;
<br>        PerfTime : TInt64;
<br>        PerfFreq : TInt64;
<br>    end;
<br>
<br>    PPERF_OBJECT_TYPE = ^TPERF_OBJECT_TYPE;
<br>
<br>type
<br>    TPERF_COUNTER_DEFINITION = record
<br>        ByteLength : DWORD;
<br>        CounterNameTitleIndex : DWORD;
<br>        CounterNameTitle : LPWSTR;
<br>        CounterHelpTitleIndex : DWORD;
<br>        CounterHelpTitle : LPWSTR;
<br>        DefaultScale : Longint;
<br>        DetailLevel : DWORD;
<br>        CounterType : DWORD;
<br>        CounterSize : DWORD;
<br>        CounterOffset : DWORD;
<br>    end;
<br>
<br>    PPERF_COUNTER_DEFINITION = ^TPERF_COUNTER_DEFINITION;
<br>
<br>    TPERF_COUNTER_BLOCK = record
<br>        ByteLength : DWORD;
<br>    end;
<br>
<br>    PPERF_COUNTER_BLOCK = ^TPERF_COUNTER_BLOCK;
<br>
<br>    TPERF_INSTANCE_DEFINITION = record
<br>        ByteLength : DWORD;
<br>        ParentObjectTitleIndex : DWORD;
<br>        ParentObjectInstance : DWORD;
<br>        UniqueID : Longint;
<br>        NameOffset : DWORD;
<br>        NameLength : DWORD;
<br>    end;
<br>
<br>    PPERF_INSTANCE_DEFINITION = ^TPERF_INSTANCE_DEFINITION;
<br>
<br>//-------------------------------------------------------------------- ----------
<br>{&#036;ifdef ver130}
<br>{&#036;L-}         // The L+ causes internal error in Delphi 5 compiler
<br>{&#036;O-}         // The O+ causes internal error in Delphi 5 compiler
<br>{&#036;Y-}         // The Y+ causes internal error in Delphi 5 compiler
<br>{&#036;endif}
<br>
<br>{&#036;ifndef ver110}
<br>type
<br>    TInt64F = TInt64;
<br>{&#036;else}
<br>type
<br>    TInt64F = Extended;
<br>{&#036;endif}
<br>
<br>{&#036;ifdef ver110}
<br>function FInt64(Value: TInt64): TInt64F;
<br>function Int64D(Value: DWORD): TInt64;
<br>{&#036;else}
<br>type
<br>    FInt64 = TInt64F;
<br>    Int64D = TInt64;
<br>{&#036;endif}
<br>
<br>{&#036;ifdef ver110}
<br>function FInt64(Value: TInt64): TInt64F;
<br>var V: TInt64;
<br>begin
<br>    if (Value.HighPart and &#036;80000000) = 0 then // positive value
<br>    begin
<br>        result:=Value.HighPart;
<br>        result:=result*&#036;10000*&#036;10000;
<br>        result:=result+Value.LowPart;
<br>    end else
<br>    begin
<br>        V.HighPart:=Value.HighPart xor &#036;FFFFFFFF;
<br>        V.LowPart:=Value.LowPart xor &#036;FFFFFFFF;
<br>        result:= -1 - FInt64(V);
<br>    end;
<br>end;
<br>
<br>function Int64D(Value: DWORD): TInt64;
<br>begin
<br>    result.LowPart:=Value;
<br>    result.HighPart := 0; // positive only
<br>end;
<br>{&#036;endif}
<br>
<br>//-------------------------------------------------------------------- ----------
<br>
<br>const
<br>    Processor_IDX_Str = &#039;238&#039;;
<br>    Processor_IDX = 238;
<br>    CPUUsageIDX = 6;
<br>
<br>type
<br>    AInt64F = array[0..&#036;FFFF] of TInt64F;
<br>    PAInt64F = ^AInt64F;
<br>
<br>var
<br>    _PerfData : PPERF_DATA_BLOCK;
<br>    _BufferSize: Integer;
<br>    _POT : PPERF_OBJECT_TYPE;
<br>    _PCD: PPerf_Counter_Definition;
<br>    _ProcessorsCount: Integer;
<br>    _Counters: PAInt64F;
<br>    _PrevCounters: PAInt64F;
<br>    _SysTime: TInt64F;
<br>    _PrevSysTime: TInt64F;
<br>    _IsWinNT: Boolean;
<br>
<br>    _W9xCollecting: Boolean;
<br>    _W9xCpuUsage: DWORD;
<br>    _W9xCpuKey: HKEY;
<br>
<br>
<br>//-------------------------------------------------------------------- ----------
<br>function GetCPUCount: Integer;
<br>begin
<br>    if _IsWinNT then
<br>    begin
<br>        if _ProcessorsCount &lt; 0 then CollectCPUData;
<br>        result:=_ProcessorsCount;
<br>    end else
<br>    begin
<br>        result:=1;
<br>    end;
<br>
<br>end;
<br>
<br>//-------------------------------------------------------------------- ----------
<br>procedure ReleaseCPUData;
<br>var H: HKEY;
<br>    R: DWORD;
<br>    dwDataSize, dwType: DWORD;
<br>begin
<br>    if _IsWinNT then exit;
<br>    if not _W9xCollecting then exit;
<br>    _W9xCollecting:=False;
<br>
<br>    RegCloseKey(_W9xCpuKey);
<br>
<br>    R:=RegOpenKeyEx( HKEY_DYN_DATA, &#039;PerfStats&#92;StopStat&#039;, 0, KEY_ALL_ACCESS, H );
<br>
<br>    if R &lt;&gt; ERROR_SUCCESS then exit;
<br>
<br>    dwDataSize:=sizeof(DWORD);
<br>
<br>    RegQueryValueEx ( H, &#039;KERNEL&#92;CPUUsage&#039;, nil, @dwType, PBYTE(@_W9xCpuUsage), @dwDataSize);
<br>
<br>    RegCloseKey(H);
<br>
<br>end;
<br>
<br>//-------------------------------------------------------------------- ----------
<br>function GetCPUUsage(Index: Integer): Double;
<br>begin
<br>    if _IsWinNT then
<br>    begin
<br>        if _ProcessorsCount &lt; 0 then CollectCPUData;
<br>        if (Index &gt;= _ProcessorsCount) or (Index &lt; 0) then
<br>            raise Exception.Create(&#039;CPU index out of bounds&#039;);
<br>        if _PrevSysTime = _SysTime then result:=0 else
<br>        result:=1-(_Counters[index] - _PrevCounters[index])/(_SysTime-_PrevSysTime);
<br>    end else
<br>    begin
<br>        if Index &lt;&gt; 0 then
<br>            raise Exception.Create(&#039;CPU index out of bounds&#039;);
<br>        if not _W9xCollecting then CollectCPUData;
<br>        result:=_W9xCpuUsage / 100;
<br>    end;
<br>end;
<br>
<br>var VI: TOSVERSIONINFO;
<br>
<br>//-------------------------------------------------------------------- ----------
<br>procedure CollectCPUData;
<br>var BS: integer;
<br>    i: Integer;
<br>    _PCB_Instance: PPERF_COUNTER_BLOCK;
<br>    _PID_Instance: PPERF_INSTANCE_DEFINITION;
<br>    ST: TFileTime;
<br>
<br>var H: HKEY;
<br>    R: DWORD;
<br>    dwDataSize, dwType: DWORD;
<br>begin
<br>    if _IsWinNT then
<br>    begin
<br>        BS:=_BufferSize;
<br>        while RegQueryValueEx( HKEY_PERFORMANCE_DATA, Processor_IDX_Str, nil, nil,
<br>                PByte(_PerfData), @BS ) = ERROR_MORE_DATA do
<br>        begin
<br>            // Get a buffer that is big enough.
<br>            INC(_BufferSize,&#036;1000);
<br>            BS:=_BufferSize;
<br>            ReallocMem( _PerfData, _BufferSize );
<br>        end;
<br>
<br>        // Locate the performance object
<br>        _POT := PPERF_OBJECT_TYPE(DWORD(_PerfData) + _PerfData.HeaderLength);
<br>        for i := 1 to _PerfData.NumObjectTypes do
<br>        begin
<br>            if _POT.ObjectNameTitleIndex = Processor_IDX then Break;
<br>            _POT := PPERF_OBJECT_TYPE(DWORD(_POT) + _POT.TotalByteLength);
<br>        end;
<br>
<br>        // Check for success
<br>        if _POT.ObjectNameTitleIndex &lt;&gt; Processor_IDX then
<br>            raise Exception.Create(&#039;Unable to locate the &quot;Proce
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=2122&amp;user=9&amp;forum_n=1&amp;topic=193.html&amp;page=0&amp;anchor=23" class="addthx" data-post="2122"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/green.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=1&sortBy=0&page=0.html"><b>Основной форум</b></a> <b class=bulletHead>&#8212;&#8250;</b> проблемы с ZwQuerySystemInformation</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#24" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="1">
<input type="hidden" name="topic" value="193">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=193" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
