<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 9">
<meta name=Originator content="Microsoft Word 9">
<link rel=File-List href="./xtreamlokru.files/filelist.xml">
<title>Распаковка xtreamlok by Spiteful</title>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>Spiteful</o:Author>
  <o:LastAuthor>Spiteful</o:LastAuthor>
  <o:Revision>2</o:Revision>
  <o:TotalTime>88</o:TotalTime>
  <o:Created>2005-06-03T13:25:00Z</o:Created>
  <o:LastSaved>2005-06-03T13:25:00Z</o:LastSaved>
  <o:Pages>4</o:Pages>
  <o:Words>988</o:Words>
  <o:Characters>5632</o:Characters>
  <o:Company> </o:Company>
  <o:Lines>46</o:Lines>
  <o:Paragraphs>11</o:Paragraphs>
  <o:CharactersWithSpaces>6916</o:CharactersWithSpaces>
  <o:Version>9.2812</o:Version>
 </o:DocumentProperties>
</xml><![endif]-->
<style>
<!--
 /* Font Definitions */
@font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;
	mso-font-charset:2;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:0 268435456 0 0 -2147483648 0;}
 /* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;
	text-underline:single;}
@page Section1
	{size:595.3pt 841.9pt;
	margin:2.0cm 42.5pt 2.0cm 3.0cm;
	mso-header-margin:35.4pt;
	mso-footer-margin:35.4pt;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
-->
</style>
</head>

<body lang=RU link=blue vlink=purple style='tab-interval:35.4pt'>

<div class=Section1>

<p class=MsoNormal align=center style='text-align:center'><span
style='font-size:14.0pt;mso-bidi-font-size:12.0pt'>Распаковка</span><span
lang=EN-US style='font-size:14.0pt;mso-bidi-font-size:12.0pt;mso-ansi-language:
EN-US'> xtreamlok by Spiteful<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:14.0pt;mso-bidi-font-size:
12.0pt;mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal>Как-то прослушивая музончик блэковой <span lang=EN-US
style='mso-ansi-language:EN-US'>Dimmu</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>Borgir</span>, я задался вопросом, а
что же такое они там ревут… вроде б по-английски, но как-то неразборчиво %) и
тут решил я опробовать программку <span lang=EN-US style='mso-ansi-language:
EN-US'><a href="h++p://www.lyricsgrabber.com/install_lyricsgrabber.exe">LyricsGrabber</a></span>,
которая неожиданно оказалась <span lang=EN-US style='mso-ansi-language:EN-US'>shareware</span>.<span
style="mso-spacerun: yes">  </span><span lang=EN-US style='mso-ansi-language:
EN-US'>Peid </span>показал<span lang=EN-US style='mso-ansi-language:EN-US'>
Softwrap (encrypted) main stub / Xlok. </span>Информации по данной штуке в сети
оказалось мало, поэтому я решил написать маленький туториал по отковыриванию этого
чуда. <span lang=EN-US style='font-family:Wingdings;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";mso-ansi-language:EN-US;mso-char-type:
symbol;mso-symbol-font-family:Wingdings'><span style='mso-char-type:symbol;
mso-symbol-font-family:Wingdings'>J</span></span></p>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoNormal>Инструменты<span lang=EN-US style='mso-ansi-language:EN-US'>:<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>OllyDbg<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>LordPE<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>Hiew<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>Imprec<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal>Как видно при запуске программы, она защищена продуктом
фирмы <span lang=EN-US style='mso-ansi-language:EN-US'>Softwrap</span>, и
триальное окошко предлагает <span lang=EN-US style='mso-ansi-language:EN-US'>Try</span>
,<span lang=EN-US style='mso-ansi-language:EN-US'>Buy</span>, <span lang=EN-US
style='mso-ansi-language:EN-US'>Reinstall</span>… чтобы не очень трепать себе
нервы с реализованным в этом продукте антитрейсом, проще всего приаттачить <span
lang=EN-US style='mso-ansi-language:EN-US'>Olly</span> к процессу как раз когда
появляется это триальное окошко. После того как <span lang=EN-US
style='mso-ansi-language:EN-US'>olly</span> подключится к процессу надо
поставить в <span lang=EN-US style='mso-ansi-language:EN-US'>Memory</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>Window</span>
бряк на доступ к секции .<span lang=EN-US style='mso-ansi-language:EN-US'>text</span>,
так можно довольно быстро отловить прыжок на <span lang=EN-US style='mso-ansi-language:
EN-US'>OEP</span>, ну и нажать кнопу <span lang=EN-US style='mso-ansi-language:
EN-US'>Try</span>. У меня <span lang=EN-US style='mso-ansi-language:EN-US'>Olly</span>
останавливается на инструкции <span lang=EN-US style='mso-ansi-language:EN-US'>UD</span>2,
но это вообще-то не важно, <span lang=EN-US style='mso-ansi-language:EN-US'>Shift</span>+<span
lang=EN-US style='mso-ansi-language:EN-US'>F</span>9 и оказываемся на таком
коде:</p>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00443E1B<span
style="mso-spacerun: yes">    </span>XOR AL,BYTE PTR DS:[ESI]<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00443E1D<span
style="mso-spacerun: yes">    </span>MOV BL,AL<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00443E1F<span
style="mso-spacerun: yes">    </span>SHR EAX,8<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00443E22<span
style="mso-spacerun: yes">    </span>XOR EAX,DWORD PTR DS:[EBX*4+E10000]<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00443E29<span
style="mso-spacerun: yes">    </span>INC ESI<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00443E2A<span
style="mso-spacerun: yes">   </span>DEC DWORD PTR SS:[ESP+10]<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00443E2E<span
style="mso-spacerun: yes">    </span>JNZ SHORT LyricsGr.00443E19<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00443E30<span
style="mso-spacerun: yes">    </span>POP ESI<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00443E31<span
style="mso-spacerun: yes">    </span>POP EBX<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00443E32<span
style="mso-spacerun: yes">    </span>ADD DWORD PTR SS:[ESP],8<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00443E36<span
style="mso-spacerun: yes">    </span>RETN 8<o:p></o:p></span></p>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoNormal>Ставим брикпоинт на 443<span lang=EN-US style='mso-ansi-language:
EN-US'>E</span>36, т.к. особо интересного в этом подсчете <span lang=EN-US
style='mso-ansi-language:EN-US'>CRC</span>32 от секции кода нет. Остановившись
на бряке надо опять поставить бряк на секцию .<span lang=EN-US
style='mso-ansi-language:EN-US'>text</span>, после <span lang=EN-US
style='mso-ansi-language:EN-US'>F</span>9 и мы снова окажемся на этом коде…
повторим операцию с установкой бряка на секцию <span style='font-family:Wingdings;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
mso-char-type:symbol;mso-symbol-font-family:Wingdings'><span style='mso-char-type:
symbol;mso-symbol-font-family:Wingdings'>J</span></span></p>

<p class=MsoNormal>(во вкладке <span lang=EN-US style='mso-ansi-language:EN-US'>Options</span>-&gt;<span
lang=EN-US style='mso-ansi-language:EN-US'>Debugging</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>Options</span> -&gt;<span
lang=EN-US style='mso-ansi-language:EN-US'>Exceptions</span> надо чтоб стояла
галка напротив <span lang=EN-US style='mso-ansi-language:EN-US'>Single</span>-<span
lang=EN-US style='mso-ansi-language:EN-US'>Step</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>Event</span>), чтоб не отвлекаться
на всякую ерунду…</p>

<p class=MsoNormal>И мы попадаем на код :</p>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00441F3F<span
style="mso-spacerun: yes">    </span>MOV EDX,DWORD PTR DS:[EAX]<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00441F41<span
style="mso-spacerun: yes">    </span>JNS SHORT LyricsGr.00441F51<o:p></o:p></span></p>

<p class=MsoNormal>00441F43<span style="mso-spacerun: yes">    </span>PUSH EAX</p>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoNormal>Если посмотреть содержимое <span lang=EN-US
style='mso-ansi-language:EN-US'>EAX</span>, то там как раз лежит <span
lang=EN-US style='mso-ansi-language:EN-US'>OEP</span> нашей программы. Можно
поставить или <span lang=EN-US style='mso-ansi-language:EN-US'>HW</span> бряк
на выполнение кода по этому адресу, либо еще раз бряк на секцию .<span
lang=EN-US style='mso-ansi-language:EN-US'>text</span><span lang=EN-US> </span><span
lang=EN-US style='font-family:Wingdings;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";mso-ansi-language:EN-US;mso-char-type:
symbol;mso-symbol-font-family:Wingdings'><span style='mso-char-type:symbol;
mso-symbol-font-family:Wingdings'>J</span></span>(в последнем случае надо
пройти инструкцию по адресу 441<span lang=EN-US style='mso-ansi-language:EN-US'>F</span>3<span
lang=EN-US style='mso-ansi-language:EN-US'>F</span>). Отпускаем программу и
оказываемся</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><span
style="mso-spacerun: yes"> </span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>004023EC<span
style="mso-spacerun: yes">    </span>PUSH LyricsGr.0040B7D4<span
style="mso-spacerun: yes">            </span><span style="mso-spacerun:
yes">       </span>; ASCII &quot;VB5!6&amp;*&quot;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>004023F1<span
style="mso-spacerun: yes">    </span>CALL LyricsGr.004023E4<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal>Прекрасно… программа написана на бейсике, что-ж можно смело
делать дамп программы.</p>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoNormal><span style="mso-spacerun: yes">  </span>А теперь самое
интересное, это <span lang=EN-US style='mso-ansi-language:EN-US'>xtreamlok</span>
использует замангленый импорт, чтобы обойти это сделаем следующее, посмотрим
куда ведет <span lang=EN-US style='mso-ansi-language:EN-US'>CALL</span> по 4023<span
lang=EN-US style='mso-ansi-language:EN-US'>E</span>4 то увидим </p>

<p class=MsoNormal>004023<span lang=EN-US style='mso-ansi-language:EN-US'>E</span>4<span
style="mso-spacerun: yes">    </span><span lang=EN-US style='mso-ansi-language:
EN-US'>CALL</span><span lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:
EN-US'>DWORD</span><span lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:
EN-US'>PTR</span><span lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:
EN-US'>DS</span>:[441298] и до этого идет очень много аналогичных вызовов.
Зайдем и в этот <span lang=EN-US style='mso-ansi-language:EN-US'>CALL</span>,
видим следующее:</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00443E39<span
style="mso-spacerun: yes">    </span></span><span lang=EN-US><span
style="mso-spacerun: yes"> </span></span><span lang=EN-US style='mso-ansi-language:
EN-US'>PUSHFD<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00443E3A<span
style="mso-spacerun: yes">    </span>PUSH EAX<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00443E3B<span
style="mso-spacerun: yes">    </span>PUSH EBX<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00443E3C<span
style="mso-spacerun: yes">    </span>MOV EBX,DWORD PTR SS:[ESP+C]<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00443E40<span
style="mso-spacerun: yes">    </span>PUSH EBX<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00443E41<span
style="mso-spacerun: yes">    </span>SUB EBX,6<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00443E44<span
style="mso-spacerun: yes">    </span>PUSH 2711<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00443E49<span
style="mso-spacerun: yes">    </span>PUSH <span style='background:yellow;
mso-highlight:yellow'>0E40000</span><o:p></o:p></span></p>

<p class=MsoNormal>00443E4E<span style="mso-spacerun: yes">    </span>C3<span
style="mso-spacerun: yes">              </span>RETN</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>===================================================================<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00443E5F<span
style="mso-spacerun: yes">    </span>PUSH 0<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00443E61<span
style="mso-spacerun: yes">    </span>PUSHFD<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00443E62<span
style="mso-spacerun: yes">    </span>PUSH EAX<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00443E63<span
style="mso-spacerun: yes">    </span>PUSH EBX<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00443E64<span
style="mso-spacerun: yes">    </span>MOV EBX,DWORD PTR SS:[ESP+10]<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00443E68<span
style="mso-spacerun: yes">    </span>PUSH EBX<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00443E69<span
style="mso-spacerun: yes">    </span>SUB EBX,6<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00443E6C<span
style="mso-spacerun: yes">    </span>PUSH 26E9<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00443E71<span
style="mso-spacerun: yes">    </span>PUSH <span style='background:yellow;
mso-highlight:yellow'>0E40000</span><o:p></o:p></span></p>

<p class=MsoNormal>00443<span lang=EN-US style='mso-ansi-language:EN-US'>E</span>76<span
style="mso-spacerun: yes">    </span><span lang=EN-US style='mso-ansi-language:
EN-US'>RETN</span></p>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoNormal>Выделенные адреса могут отличатся, протрассируем что же за
процедура расположена по этом адресу</p>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E40000<span
style="mso-spacerun: yes">    </span>PUSH EBP<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E40001<span
style="mso-spacerun: yes">    </span>PUSH ESI<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E40002<span
style="mso-spacerun: yes">    </span>PUSH EDI<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E40003<span
style="mso-spacerun: yes">    </span>PUSH ECX<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E40004<span
style="mso-spacerun: yes">    </span>PUSH EDX<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E40005<span
style="mso-spacerun: yes">    </span>PUSH EAX<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E40006<span
style="mso-spacerun: yes">    </span>MOV EBP,441766<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E4000B<span
style="mso-spacerun: yes">    </span>ADD DWORD PTR SS:[ESP+18],EBP<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E4000F<span
style="mso-spacerun: yes">    </span>SUB EBX,DWORD PTR SS:[EBP+2A96]<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:lime;mso-highlight:lime;
mso-ansi-language:EN-US'>00E40015<span style="mso-spacerun: yes">    </span>MOV
EDI,DWORD PTR SS:[EBP+2ADE]</span><span lang=EN-US style='mso-ansi-language:
EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E4001B<span
style="mso-spacerun: yes">    </span>MOV ECX,DWORD PTR SS:[EBP+2ADA]<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E40021<span
style="mso-spacerun: yes">    </span>MOV EAX,EBX<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E40023<span
style="mso-spacerun: yes">    </span>SUB EAX,DWORD PTR SS:[EBP+2AD2]<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E40029<span
style="mso-spacerun: yes">    </span>SHR EAX,CL<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E4002B<span
style="mso-spacerun: yes">    </span>MOV EAX,DWORD PTR DS:[EDI+EAX*4]<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E4002E<span
style="mso-spacerun: yes">    </span>MOV ESI,EAX<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E40030<span
style="mso-spacerun: yes">    </span>AND ESI,0FFFF<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E40036<span
style="mso-spacerun: yes">    </span>SHR EAX,10<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E40039<span
style="mso-spacerun: yes">    </span>MOV EDI,EAX<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E4003B<span
style="mso-spacerun: yes">    </span>LEA EAX,DWORD PTR DS:[ESI+EDI]<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E4003E<span
style="mso-spacerun: yes">    </span>MOV EDX,2D8774B2<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E40043<span
style="mso-spacerun: yes">    </span>SHR EAX,1<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E40045<span
style="mso-spacerun: yes">    </span>MOV ECX,EAX<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E40047<span
style="mso-spacerun: yes">    </span>IMUL ECX,ECX,44DA6684<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E4004D<span
style="mso-spacerun: yes">    </span>SUB EDX,ECX<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E4004F<span
style="mso-spacerun: yes">    </span>MOV ECX,DWORD PTR SS:[EBP+2AFA]<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E40055<span
style="mso-spacerun: yes">    </span>PUSH ECX<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E40056<span
style="mso-spacerun: yes">    </span>MOV ECX,DWORD PTR DS:[ECX+EAX*8]<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E40059<span
style="mso-spacerun: yes">    </span>XOR ECX,EDX<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E4005B<span
style="mso-spacerun: yes">    </span>CMP ECX,EBX<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E4005D<span
style="mso-spacerun: yes">    </span>POP ECX<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E4005E<span
style="mso-spacerun: yes">    </span>JE SHORT 00E4006C<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E40060<span
style="mso-spacerun: yes">    </span>JA SHORT 00E40067<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E40062<span
style="mso-spacerun: yes">    </span>LEA EDI,DWORD PTR DS:[EAX+1]<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E40065<span
style="mso-spacerun: yes">    </span>JMP SHORT 00E4003B<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E40067<span
style="mso-spacerun: yes">    </span>LEA ESI,DWORD PTR DS:[EAX-1]<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E4006A<span
style="mso-spacerun: yes">   </span>JMP SHORT 00E4003B<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E4006C<span
style="mso-spacerun: yes">    </span>MOV EBX,DWORD PTR SS:[ESP+1C]<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E40070<span
style="mso-spacerun: yes">    </span>XOR EDX,DWORD PTR DS:[ECX+EAX*8+4]<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E40074<span
style="mso-spacerun: yes">    </span>MOVZX EBX,BYTE PTR DS:[EBX]<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E40077<span
style="mso-spacerun: yes">    </span>SUB EDX,EBX<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>00E40079<span
style="mso-spacerun: yes">    </span><span style='background:lime;mso-highlight:
lime'>MOV ESI,DWORD PTR SS:[EBP+2AEA]</span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal>Следует обратить внимание на выделенные строки , точнее
посмотреть, что содержится в памяти </p>

<p class=MsoNormal><span style='background:lime;mso-highlight:lime'>[</span><span
lang=EN-US style='background:lime;mso-highlight:lime;mso-ansi-language:EN-US'>EBP</span><span
style='background:lime;mso-highlight:lime'>+2</span><span lang=EN-US
style='background:lime;mso-highlight:lime;mso-ansi-language:EN-US'>ADE</span><span
style='background:lime;mso-highlight:lime'>]</span>=[00444244]=00<span
lang=EN-US style='mso-ansi-language:EN-US'>E</span>60000</p>

<p class=MsoNormal><span lang=EN-US style='background:lime;mso-highlight:lime;
mso-ansi-language:EN-US'>[EBP+2AEA]</span>=<span lang=EN-US style='mso-ansi-language:
EN-US'>[00444250]=00E30000</span></p>

<p class=MsoNormal>Судя по всему указатели на динамически выделенные участки
памяти.</p>

<p class=MsoNormal>(значения в памяти могут отличаться)</p>

<p class=MsoNormal>С помощью <span lang=EN-US style='mso-ansi-language:EN-US'>LordPE</span>
делаем последовательный <span lang=EN-US style='mso-ansi-language:EN-US'>Dump</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>Regions</span>
адресов 00<span lang=EN-US style='mso-ansi-language:EN-US'>E</span>40000, 00<span
lang=EN-US style='mso-ansi-language:EN-US'>E</span>60000,00<span lang=EN-US
style='mso-ansi-language:EN-US'>E</span>30000, назовем файлы <span lang=EN-US
style='mso-ansi-language:EN-US'>mang</span>1,<span lang=EN-US style='mso-ansi-language:
EN-US'>mang</span>2,<span lang=EN-US style='mso-ansi-language:EN-US'>mang</span>3.</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal>Теперь в том же <span lang=EN-US style='mso-ansi-language:
EN-US'>LordPE</span> приклеим эти файлы как новые секции к дампу, <span
lang=EN-US style='mso-ansi-language:EN-US'>load</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>section</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>from</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>disk</span>… Запоминаем (записываем
) <span lang=EN-US style='mso-ansi-language:EN-US'>Voffset</span> этих секций <span
style='background:red;mso-highlight:red'>4</span><span lang=EN-US
style='background:red;mso-highlight:red;mso-ansi-language:EN-US'>C</span><span
style='background:red;mso-highlight:red'>000, 4</span><span lang=EN-US
style='background:red;mso-highlight:red;mso-ansi-language:EN-US'>D</span><span
style='background:red;mso-highlight:red'>000, 89000.</span> </p>

<p class=MsoNormal>Так же необходимо чтобы загрузчик подгрузил нам бейсиковскую
библиотеку к процессу, для чего в <span lang=EN-US style='mso-ansi-language:
EN-US'>imprec</span>’<span lang=EN-US style='mso-ansi-language:EN-US'>e</span>
вводим в окно <span lang=EN-US style='mso-ansi-language:EN-US'>RVA</span>
000447<span lang=EN-US style='mso-ansi-language:EN-US'>AC</span> и <span
lang=EN-US style='mso-ansi-language:EN-US'>size</span> 00000004 (можно в том же
<span lang=EN-US style='mso-ansi-language:EN-US'>Peid</span> подглядеть, где у
оригинального <span lang=EN-US style='mso-ansi-language:EN-US'>exe</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>msvbvm</span>60.<span
lang=EN-US style='mso-ansi-language:EN-US'>dll</span> прописано), будет найдена
одна функция чего нам вполне достаточно <span style='font-family:Wingdings;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
mso-char-type:symbol;mso-symbol-font-family:Wingdings'><span style='mso-char-type:
symbol;mso-symbol-font-family:Wingdings'>J</span></span></p>

<p class=MsoNormal>Только при добавлении импорта не забудьте указать <span
lang=EN-US style='mso-ansi-language:EN-US'>OEP</span> = 23<span lang=EN-US
style='mso-ansi-language:EN-US'>EC</span></p>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoNormal>Осталось чуть-чуть – подправить ячейки где хранятся
указатели на те адреса 0<span lang=EN-US style='mso-ansi-language:EN-US'>E</span>40000,
00<span lang=EN-US style='mso-ansi-language:EN-US'>E</span>60000…</p>

<p class=MsoNormal>А хранятся они по адресам 444244, 444250, 00443<span
lang=EN-US style='mso-ansi-language:EN-US'>E</span>4<span lang=EN-US
style='mso-ansi-language:EN-US'>A</span>, 00443<span lang=EN-US
style='mso-ansi-language:EN-US'>E</span>72 последние два адреса взяты как
адреса инструкций (<span lang=EN-US style='mso-ansi-language:EN-US'>PUSH</span><span
lang=EN-US> </span><span style='background:yellow;mso-highlight:yellow'>0</span><span
lang=EN-US style='background:yellow;mso-highlight:yellow;mso-ansi-language:
EN-US'>E</span><span style='background:yellow;mso-highlight:yellow'>40000</span>)
+ 1. В <span lang=EN-US style='mso-ansi-language:EN-US'>Hiew</span> меняем
значения следующим образом </p>

<p class=MsoNormal>[444244]=<span style='background:red;mso-highlight:red'>44</span><span
lang=EN-US style='background:red;mso-highlight:red;mso-ansi-language:EN-US'>D</span><span
style='background:red;mso-highlight:red'>000</span></p>

<p class=MsoNormal>[444250]=<span style='background:red;mso-highlight:red'>489000</span>
</p>

<p class=MsoNormal>[443<span lang=EN-US style='mso-ansi-language:EN-US'>E4A</span>]=<span
style='background:red;mso-highlight:red'>44</span><span lang=EN-US
style='background:red;mso-highlight:red;mso-ansi-language:EN-US'>C</span><span
style='background:red;mso-highlight:red'>000</span></p>

<p class=MsoNormal>[443<span lang=EN-US style='mso-ansi-language:EN-US'>E</span>72]=<span
style='background:red;mso-highlight:red'>44</span><span lang=EN-US
style='background:red;mso-highlight:red;mso-ansi-language:EN-US'>C</span><span
style='background:red;mso-highlight:red'>000</span> , т.е. к <span lang=EN-US
style='mso-ansi-language:EN-US'>Voffset</span> добаленых секций прибавили <span
lang=EN-US style='mso-ansi-language:EN-US'>ImageBase</span> модуля<span
lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal>После внесенных изменений попробуем запустить программу( под
<span lang=EN-US style='mso-ansi-language:EN-US'>Olly</span> ;) )…загружается
и… <span lang=EN-US style='mso-ansi-language:EN-US'>Access</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>violation</span>
по [0<span lang=EN-US style='mso-ansi-language:EN-US'>E</span>40000], если глянуть
<span lang=EN-US style='mso-ansi-language:EN-US'>EIP</span> то он как раз
указывает на этот самый адрес. Видимо в программе есть еще места где
используется комбинация <span lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>push</span>
0<span lang=EN-US style='mso-ansi-language:EN-US'>e</span>40000<span
lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>ret<o:p></o:p></span></p>

<p class=MsoNormal>Поищем эти команды в той же секции где располагались
предыдущие - .xlok<span lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal>В <span lang=EN-US style='mso-ansi-language:EN-US'>olly</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>Search</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>for</span>
-&gt; <span lang=EN-US style='mso-ansi-language:EN-US'>Sequence</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>of</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>commands</span>,
вводим интересующие нас команды и обнаруживаем следующие адреса</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>004437AE<span
style="mso-spacerun: yes">    </span>68 0000E400<span style="mso-spacerun:
yes">     </span>PUSH 0E40000<o:p></o:p></span></p>

<p class=MsoNormal>004437B3<span style="mso-spacerun: yes">    </span>C3<span
style="mso-spacerun: yes">              </span>RETN</p>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>004437C6<span
style="mso-spacerun: yes">    </span>68 0000E400<span style="mso-spacerun:
yes">     </span>PUSH 0E40000<o:p></o:p></span></p>

<p class=MsoNormal>004437CB<span style="mso-spacerun: yes">    </span>C3<span
style="mso-spacerun: yes">              </span>RETN</p>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoNormal>Опять же в <span lang=EN-US style='mso-ansi-language:EN-US'>hiew</span>
правим </p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>[4437AF]=<span
style='background:red;mso-highlight:red'>44C000</span>, [4437C7]=<span
style='background:red;mso-highlight:red'>44C000</span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal>Запускаем программу… вроде работает <span style='font-family:
Wingdings;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
mso-char-type:symbol;mso-symbol-font-family:Wingdings'><span style='mso-char-type:
symbol;mso-symbol-font-family:Wingdings'>J</span></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>P</span>.<span
lang=EN-US style='mso-ansi-language:EN-US'>S</span>. если вам не понравился
туториал или вы можете сделать лучше, то меня это совершенно не волнует <span
style='font-family:Wingdings;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";mso-char-type:symbol;mso-symbol-font-family:
Wingdings'><span style='mso-char-type:symbol;mso-symbol-font-family:Wingdings'>J</span></span></p>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>Greets fly
out to TSRh, ICU, SnD, Gelios, Noble Ghost, gloom, AvAtAr и всем кто меня знает
</span><span style='font-family:Wingdings;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";mso-char-type:symbol;mso-symbol-font-family:
Wingdings'><span style='mso-char-type:symbol;mso-symbol-font-family:Wingdings'>J</span></span><span
lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

</div>

</body>

</html>
