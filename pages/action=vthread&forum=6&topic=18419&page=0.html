<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>инжект в процесс, подмена функции - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="re у меня получилось инжектироваться в процесс найти нужную функцию и подменить ее, но не получается в моей функции обратно вызвать оригинальную функцию, что бы программа продолжила работать обьявление указателя на функцию Code: ">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=1288'>UniSoft</a>, <a target='_blank' href='?action=userinfo&amp;user=41701'>_MBK_</a>, <a target='_blank' href='?action=userinfo&amp;user=55953'>laslo</a> (+7 невидимых)</b></span>
</td>
</tr>
</table>

 

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> инжект в процесс, подмена функции</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]CodeIgniter[/b]','')">CodeIgniter</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 3.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.05'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=29476">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 июля 2011 10:39 <br><script type="text/javascript">QU('CodeIgniter','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=CodeIgniter" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=18419.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
re<br>у меня получилось инжектироваться в процесс найти нужную функцию и подменить ее, но не получается в моей функции обратно вызвать оригинальную функцию, что бы программа продолжила работать<br><br>обьявление указателя на функцию<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">typedef&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_char">(</span>&nbsp;WINAPI&nbsp;original_PR_Write<span class="hl_char">)</span><span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">DWORD</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">DWORD</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">original_PR_Write<span class="hl_char">*</span>&nbsp;r_PR_Write<span class="hl_char">=</span><span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div>
<br><br>записиь адреса оригинала<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">r_PR_Write<span class="hl_char">=</span><span class="hl_char">(</span>original_PR_Write<span class="hl_char">*</span><span class="hl_char">)</span>ImportAddress<span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div>
<br><br>вызов<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_char">(</span><span class="hl_char">*</span>r_PR_Write<span class="hl_char">)</span><span class="hl_char">(</span>fd<span class="hl_char">,</span>&nbsp;buf<span class="hl_char">,</span>&nbsp;amount<span class="hl_char">)</span><span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div>
<br><br>может я не верно получаю адрес PR_Write? но как тогда происходит подмена?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=286738&amp;user=29476&amp;forum_n=6&amp;topic=18419.html&amp;page=0&amp;anchor=1" class="addthx" data-post="286738"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]Airenikus[/b]','')">Airenikus</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/26065.png" alt=""><br><span class=txtSm>Ранг: 88.2 (постоянный), 111thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.94'>Активность: 0.07<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=26065">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 июля 2011 11:17 <br><script type="text/javascript">QU('Airenikus','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Airenikus" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=18419.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
А как инжектишься? Если инжектишь длл, то там просто фильтруешь данные через свою функцию (прототип от оригинальной). <img src="img/smilies/s3.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=286739&amp;user=26065&amp;forum_n=6&amp;topic=18419.html&amp;page=0&amp;anchor=2" class="addthx" data-post="286739"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]CodeIgniter[/b]','')">CodeIgniter</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 3.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.05'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=29476">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 июля 2011 11:46 <br><script type="text/javascript">QU('CodeIgniter','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=CodeIgniter" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=18419.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
именно через длл, а пример можно? или более подробно обьяснить<br>как я писал выше, данные я получаю в свою функцию, т.е. подменить получается, но после вернуть все обратно нет, я не могу вызвать оригинальную функцию PR_Write
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=286744&amp;user=29476&amp;forum_n=6&amp;topic=18419.html&amp;page=0&amp;anchor=3" class="addthx" data-post="286744"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]ARCHANGEL[/b]','')">ARCHANGEL</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/6336.png" alt=""><br><span class=txtSm>Ранг: 681.5 <font color=magenta>(<b>! !</b>)</font>, 405thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.85'>Активность: 0.42<span style='color:red'>&searr;</span>0.21</span><br>Статус: <a href="action=userinfo&amp;user=6336">Участник</a><br><font color=blue>ALIEN Hack Team</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 июля 2011 14:32 &middot; Поправил: ARCHANGEL <br><script type="text/javascript">QU('ARCHANGEL','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ARCHANGEL" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=18419.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
Ха, а хук как делается? Если сплайсингом - то вполне понятны причины происходящего))<br><br>В аттаче - пример перехвата путём подмены адресов в таблице импорта. Думаю, ясно и понятно, зачем он использовался ранее.<br><br><img src="img/attach.gif" alt=""> <a href="./files/a548_01.07.2011_EXELAB.rU.tgz">a548_01.07.2011_EXELAB.rU.tgz</a> - Extreme_Parser.rar
<br><br><font size="1"><i>-----<br>Stuck to the plan, always think that we would stand up, never ran.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=286760&amp;user=6336&amp;forum_n=6&amp;topic=18419.html&amp;page=0&amp;anchor=4" class="addthx" data-post="286760"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]50Hz_220B_1200W[/b]','')">50Hz_220B_1200W</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 16.9 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.36'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=20096">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 июля 2011 18:27 <br><script type="text/javascript">QU('50Hz_220B_1200W','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=50Hz_220B_1200W" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=18419.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
Подмена адресов таблицы импорта. 1: Перехват с помощью библиотеки, перехвачиваем MessageBox (в инете куча такого), 2: Немножко модефицированный пример перехвата GetSystemMenu уже без библиотеки (на Дельфях). Если пригодиться, то пожалуста:<br><br><img src="img/attach.gif" alt=""> <a href="./files/6014_01.07.2011_EXELAB.rU.tgz">6014_01.07.2011_EXELAB.rU.tgz</a> - перехват API изменения таблицы импорта.rar
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=286770&amp;user=20096&amp;forum_n=6&amp;topic=18419.html&amp;page=0&amp;anchor=5" class="addthx" data-post="286770"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]MasterSoft[/b]','')">MasterSoft</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 281.8 (наставник), 272thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.16'>Активность: 0.25<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=16624">Участник</a><br><font color=blue>Destroyer of protectors</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 июля 2011 19:30 &middot; Поправил: MasterSoft <br><script type="text/javascript">QU('MasterSoft','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=MasterSoft" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=18419.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
<I>ARCHANGEL пишет:<br>Ха, а хук как делается? Если сплайсингом - то вполне понятны причины происходящего)) </I><br>во-во. подразумеваю, что байты с начала апи спёр, а анхук сделать и вернуть всё назад забыл<br><br><b>CodeIgniter</b><br>скинь кусок кодеса по-более.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=286773&amp;user=16624&amp;forum_n=6&amp;topic=18419.html&amp;page=0&amp;anchor=6" class="addthx" data-post="286773"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]CodeIgniter[/b]','')">CodeIgniter</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 3.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.05'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=29476">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 июля 2011 07:37 &middot; Поправил: CodeIgniter <br><script type="text/javascript">QU('CodeIgniter','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=CodeIgniter" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=18419.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
разобрался) не в той dll искал функцию
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=286799&amp;user=29476&amp;forum_n=6&amp;topic=18419.html&amp;page=0&amp;anchor=7" class="addthx" data-post="286799"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 июля 2011 10:29 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=18419.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
Тогда можно закрыть, видимо.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=286803&amp;user=1556&amp;forum_n=6&amp;topic=18419.html&amp;page=0&amp;anchor=8" class="addthx" data-post="286803"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> инжект в процесс, подмена функции</span></td>
</tr></table>
</div>
<a name=newreply></a>
<div align=center>
<table class=forums>
<tr>
<td class=caption4 width="100%"><span class=header>Эта тема закрыта. Ответы больше не принимаются.</span></td>
</tr>
</table>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=18419" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
