<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>энумерация USB-устройств в драйвере - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Собственно возникла задача из кода драйвера определять наличие подключенных юсб-устройств и получить от них для начала хоть дескрипторы. Познания в написании драйверов ближе к начальному уровню, поэтому прошу сильно не пинать.">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=26261'>bartolomeo</a>, <a target='_blank' href='?action=userinfo&amp;user=55995'>tyns777</a> (+5 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> энумерация USB-устройств в драйвере</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> .  <b>1</b> . <a href="action=vthread&amp;forum=6&amp;topic=17838&amp;page=1.html">2</a> . <a href="action=vthread&amp;forum=6&amp;topic=17838&amp;page=1.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]Tolkin[/b]','')">Tolkin</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 64.0 (постоянный), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.92'>Активность: 0.04<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=131">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 марта 2011 00:50 <br><script type="text/javascript">QU('Tolkin','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Tolkin" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17838&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Собственно возникла задача из кода драйвера определять наличие подключенных юсб-устройств и получить от них для начала хоть дескрипторы. Познания в написании драйверов ближе к начальному уровню, поэтому прошу сильно не пинать. Как вариант решения вижу (слыхал) нужно опросить хабы на наличие подключенных к портам устройств, но вот как это реализовать в коде ring0 не знаю. Подскажите, с чего начинать, а может есть готовые примеры? Или юсб-устройства можно тоже получить по перебору типа phisicalDevice?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=278290&amp;user=131&amp;forum_n=6&amp;topic=17838&amp;page=0&amp;anchor=1" class="addthx" data-post="278290"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]Tolkin[/b]','')">Tolkin</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 64.0 (постоянный), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.92'>Активность: 0.04<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=131">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 марта 2011 01:10 <br><script type="text/javascript">QU('Tolkin','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Tolkin" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17838&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
Попробую немного уточнить детали, если  перебирать например phisicalDevice в ринг3, то юсб-флеха обнаруживается, а юсб хасп ключ нет, почему? надо находить именно все устройства юсб
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=278292&amp;user=131&amp;forum_n=6&amp;topic=17838&amp;page=0&amp;anchor=2" class="addthx" data-post="278292"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]NikolayD[/b]','')">NikolayD</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 189.9 (ветеран), 334thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.36'>Активность: 0.3<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=24529">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 марта 2011 01:34 <br><script type="text/javascript">QU('NikolayD','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=NikolayD" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17838&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
<I>Tolkin пишет:<br><br>Попробую немного уточнить детали, если перебирать например phisicalDevice в ринг3, то юсб-флеха обнаруживается, а юсб хасп ключ нет, почему? </I><br><br>скорее всего не обнаруживается потому, что в ринг3 перебираете
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=278294&amp;user=24529&amp;forum_n=6&amp;topic=17838&amp;page=0&amp;anchor=3" class="addthx" data-post="278294"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]Tolkin[/b]','')">Tolkin</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 64.0 (постоянный), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.92'>Активность: 0.04<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=131">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 марта 2011 01:55 <br><script type="text/javascript">QU('Tolkin','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Tolkin" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17838&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
не, не думаю что это зависит от уровня перебора, ибо все PhysicalDrive мы видим в проводнике хотя-бы, а хасп ключи там никогда не появляются, это видимо определяется свойствами подключаемого девайса(дескрипторами например или еще как-то). Поэтому думаю перебор по PhysicalDrive не подходит, ибо инетересуют в основном то ключи.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=278295&amp;user=131&amp;forum_n=6&amp;topic=17838&amp;page=0&amp;anchor=4" class="addthx" data-post="278295"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]PE_Kill[/b]','')">PE_Kill</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3232.gif" alt=""><br><span class=txtSm>Ранг: 793.4 <font color=magenta>(<b>! !</b>)</font>, 568thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.59'>Активность: 0.74<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3232">Участник</a><br><font color=blue>Шаман</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 марта 2011 05:24 &middot; Поправил: PE_Kill <br><script type="text/javascript">QU('PE_Kill','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=PE_Kill" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17838&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
<I>NikolayD пишет:<br>скорее всего не обнаруживается потому, что в ринг3 перебираете  </I><br>Потому что интерфейсы устройств разные, соответственно и CLASS GUID другой. Это то же самое что искать клавиатуру в мониторах.<br><br>ЗЫ Из ring3 нужно работать с PnP<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;Get&nbsp;a&nbsp;handle&nbsp;for&nbsp;the&nbsp;Plug&nbsp;<span class="hl_function"><b>and</b></span>&nbsp;Play&nbsp;node&nbsp;<span class="hl_function"><b>and</b></span>&nbsp;request&nbsp;currently&nbsp;active&nbsp;HID&nbsp;devices</li><li class="hl_l1">&nbsp;&nbsp;PnPHandle&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;SetupDiGetClassDevsA<span class="hl_char">(</span>@НУЖНЫЙ_ГУИД_КЛАССА<span class="hl_char">,</span>&nbsp;nil<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;DIGCF_PRESENT&nbsp;<span class="hl_function"><b>or</b></span>&nbsp;DIGCF_DEVICEINTERFACE<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;PnPHandle&nbsp;<span class="hl_char">=</span>&nbsp;Pointer<span class="hl_char">(</span>INVALID_HANDLE_VALUE<span class="hl_char">)</span>&nbsp;then&nbsp;&nbsp;Exit<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;Devn&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;repeat</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;DeviceInterfaceData<span class="hl_char">.</span>cbSize&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;<span class="hl_function">SizeOf</span><span class="hl_char">(</span>TSPDeviceInterfaceData<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;Is&nbsp;there&nbsp;a&nbsp;HID&nbsp;device&nbsp;at&nbsp;<span class="hl_function"><b>this</b></span>&nbsp;table&nbsp;<span class="hl_function">entry</span><span class="hl_char">?</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;Success&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;SetupDiEnumDeviceInterfaces<span class="hl_char">(</span>PnPHandle<span class="hl_char">,</span>&nbsp;nil<span class="hl_char">,</span>&nbsp;НУЖНЫЙ_ГУИД_КЛАССА<span class="hl_char">,</span>&nbsp;Devn<span class="hl_char">,</span>&nbsp;DeviceInterfaceData<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span></li>        </ol>
    </div>
</div></div><br><br><font size="1"><i>-----<br>Yann Tiersen best and do not fuck</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=278304&amp;user=3232&amp;forum_n=6&amp;topic=17838&amp;page=0&amp;anchor=5" class="addthx" data-post="278304"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=6336" title="03-03-2011 06:44, ранг:283.1" target="_blank">ARCHANGEL</a>, <a href="action=userinfo&user=24529" title="03-03-2011 14:27, ранг:66.7" target="_blank">NikolayD</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]ARCHANGEL[/b]','')">ARCHANGEL</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/6336.png" alt=""><br><span class=txtSm>Ранг: 681.5 <font color=magenta>(<b>! !</b>)</font>, 405thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.85'>Активность: 0.42<span style='color:red'>&searr;</span>0.21</span><br>Статус: <a href="action=userinfo&amp;user=6336">Участник</a><br><font color=blue>ALIEN Hack Team</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 марта 2011 09:49 <br><script type="text/javascript">QU('ARCHANGEL','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ARCHANGEL" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17838&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
<b>Tolkin</b><br><br>Даже когда вот так обходите, то не видите хасп?<br><noindex><a href="http://www.wasm.ru/article.php?article=usb_eject" rel="nofollow" target="_blank">--&gt; Тутор &lt;--</a></noindex>
<br><br><font size="1"><i>-----<br>Stuck to the plan, always think that we would stand up, never ran.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=278318&amp;user=6336&amp;forum_n=6&amp;topic=17838&amp;page=0&amp;anchor=6" class="addthx" data-post="278318"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 222thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 марта 2011 11:35 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17838&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
Тутор грамотный, но я об этом уже давно смекнул... Как в продолжение мысли, в подразделе Services можно найти службу хаспа, где в подразделе Enum можно найти ключ Count, а за ним нужный подключ в root!!! <img src="img/smilies/s1.gif" alt="">
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=278339&amp;user=24257&amp;forum_n=6&amp;topic=17838&amp;page=0&amp;anchor=7" class="addthx" data-post="278339"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]r_e[/b]','')">r_e</a></b><br></div>
<img src="img/s8.gif" alt=""><br><span class=txtSm>Ранг: 590.6 (<b>!</b>), 408thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.08'>Активность: 0.36<span style='color:red'>&searr;</span>0.18</span><br>Статус: <a href="action=userinfo&amp;user=11966">Модератор</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 марта 2011 11:56 <br><script type="text/javascript">QU('r_e','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=r_e" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17838&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
Нужно проенумить хабы, а затем послать им запрос на подключенные устройства.
<br><br><font size="1"><i>-----<br>старый пень</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=278340&amp;user=11966&amp;forum_n=6&amp;topic=17838&amp;page=0&amp;anchor=8" class="addthx" data-post="278340"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 222thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 марта 2011 12:17 <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17838&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
И раз уж нужно реализовывать в р0, то без виртуальных машин не обойтись. А раз так, то ставьте WMware нпример, создавайте вм, ставьте ось, ставьте WinDbg подключайтесь к вм через виртуальный com-порт или usb и дебажьте, должно во мнгом помочь.<br><br>Для работы с реестром обычно используют сервисы nt!ZwQueryKey, nt!ZwCreateKey, nt!ZwOpenKey... Для получения хендла хаспа можно использовать nt!ZwCreateFile.
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=278341&amp;user=24257&amp;forum_n=6&amp;topic=17838&amp;page=0&amp;anchor=9" class="addthx" data-post="278341"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]ARCHANGEL[/b]','')">ARCHANGEL</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/6336.png" alt=""><br><span class=txtSm>Ранг: 681.5 <font color=magenta>(<b>! !</b>)</font>, 405thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.85'>Активность: 0.42<span style='color:red'>&searr;</span>0.21</span><br>Статус: <a href="action=userinfo&amp;user=6336">Участник</a><br><font color=blue>ALIEN Hack Team</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 марта 2011 12:41 <br><script type="text/javascript">QU('ARCHANGEL','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ARCHANGEL" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17838&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
Какова конечная цель всего этого? Ну, вот, допустим, опросили хабы, получили список девайсов, а что дальше?
<br><br><font size="1"><i>-----<br>Stuck to the plan, always think that we would stand up, never ran.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=278343&amp;user=6336&amp;forum_n=6&amp;topic=17838&amp;page=0&amp;anchor=10" class="addthx" data-post="278343"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]PE_Kill[/b]','')">PE_Kill</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3232.gif" alt=""><br><span class=txtSm>Ранг: 793.4 <font color=magenta>(<b>! !</b>)</font>, 568thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.59'>Активность: 0.74<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3232">Участник</a><br><font color=blue>Шаман</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 марта 2011 12:44 <br><script type="text/javascript">QU('PE_Kill','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=PE_Kill" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17838&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
Драйвер/Фильтр/Сниффер <img src="img/smilies/s1.gif" alt="">
<br><br><font size="1"><i>-----<br>Yann Tiersen best and do not fuck</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=278344&amp;user=3232&amp;forum_n=6&amp;topic=17838&amp;page=0&amp;anchor=11" class="addthx" data-post="278344"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]Tolkin[/b]','')">Tolkin</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 64.0 (постоянный), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.92'>Активность: 0.04<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=131">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 марта 2011 12:57 <br><script type="text/javascript">QU('Tolkin','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Tolkin" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17838&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
Ринг3 варианты как-бы не нужны, ибо там все намного проще(через те же CLASS GUID) и есть реализовано.<br><br>- По поводу парсинга реестра из драйвера - вполне приемлимый вариант, т.е. ищем символьные имена типа    \??\USB#VID_0529&amp;PID_0001#5&amp;22a20d61&amp;0&amp;1#{a5dcbf10-6530-11d2-901f-00c04fb951ed}, а дальше через ZwCreateFile пробуем открыть устройство, и если все нормально то можно слать IOCTL. Недостаток такого способа - мы будем также нумеровать и все виртуальные юсб мули, а они в даной задаче не нужны.<br><br>- <I>r_e пишет:<br>Нужно проенумить хабы, а затем послать им запрос на подключенные устройства. </I><br>можно этот способ поподробней? т.е. опять же какие имена перебирать для открытия хабов и какие потом запросы слать. Но если я правильно знаю через информацию с порта хаба можно получить только дескрипторы устройства? можно ли через опрос хаба получить символьное имя присоединенного устройства(или какое другое), чтоб открыть его потом через ZwCreateFile, или надо идти какими другими обходными путями?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=278345&amp;user=131&amp;forum_n=6&amp;topic=17838&amp;page=0&amp;anchor=12" class="addthx" data-post="278345"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]Tolkin[/b]','')">Tolkin</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 64.0 (постоянный), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.92'>Активность: 0.04<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=131">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 марта 2011 12:59 &middot; Поправил: Tolkin <br><script type="text/javascript">QU('Tolkin','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Tolkin" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17838&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
<I>ARCHANGEL пишет:<br>Какова конечная цель всего этого? </I><br>Конечная цель - работать из драйвера с реальным донглом (т.е. вызывать его функи)<br>т.е.<br>1. найти необходимое имя реального девайса для его открытия.<br>2. пробовать работать с донглом минуя его родные дрова (только куда надо слать запросы в таком случае и то ли устройство мы открываем, чтоб (пример хаспа) слать уже сам пакет URB_FUNCTION_VENDOR_DEVICE)<br>ЗЫ. хотя после открытия устройства и посыла ему IOCTL хз как он пойдет, через родные дрова хаспа или нет.<br>Кстати тот же хасп имеет типа 3 разных символьных имени, соответственно вероятно и пути следования пакетов будут разные.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=278346&amp;user=131&amp;forum_n=6&amp;topic=17838&amp;page=0&amp;anchor=13" class="addthx" data-post="278346"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]r_e[/b]','')">r_e</a></b><br></div>
<img src="img/s8.gif" alt=""><br><span class=txtSm>Ранг: 590.6 (<b>!</b>), 408thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.08'>Активность: 0.36<span style='color:red'>&searr;</span>0.18</span><br>Статус: <a href="action=userinfo&amp;user=11966">Модератор</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 марта 2011 13:38 <br><script type="text/javascript">QU('r_e','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=r_e" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17838&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
<b>Tolkin</b><br>Можете попробовать usb_lib для реализации своих фантазий.<br>Для каждого найденного через реестр устройства отсылаете GET_DESCRIPTOR с нужным типом и получаете символьное имя.<br><br>Работать с усб устройствами мимо их родных дров - не самый надежный способ. И если вы таким образом собираетесь обойти эмуляторы могу вас огорчить - ничего не выйдет.
<br><br><font size="1"><i>-----<br>старый пень</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=278347&amp;user=11966&amp;forum_n=6&amp;topic=17838&amp;page=0&amp;anchor=14" class="addthx" data-post="278347"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]Tolkin[/b]','')">Tolkin</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 64.0 (постоянный), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.92'>Активность: 0.04<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=131">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 марта 2011 15:19 <br><script type="text/javascript">QU('Tolkin','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Tolkin" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17838&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
<I>r_e пишет:<br>И если вы таким образом собираетесь обойти эмуляторы </I><br>Не, у меня суть не в этом, да пусть себе будут, мне нужен сам механизм, открыть нужной девайс и иметь возможность слать в него ioctl из драйвера
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=278354&amp;user=131&amp;forum_n=6&amp;topic=17838&amp;page=0&amp;anchor=15" class="addthx" data-post="278354"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]Hugo Chaves[/b]','')">Hugo Chaves</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 128.8 (ветеран), 21thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.64'>Активность: 0.06<span style='color:red'>&searr;</span>0.05</span><br>Статус: <a href="action=userinfo&amp;user=7963">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 марта 2011 18:59 <br><script type="text/javascript">QU('Hugo Chaves','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Hugo Chaves" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17838&amp;page=0#16');return false;">#16</a> </span><div align=left><br>
<b>Tolkin</b><br><br>А чем не нравится ответ <b>r_e</b> ?<br><br><I>Можете попробовать usb_lib для реализации своих фантазий.<br>Для каждого найденного через реестр устройства отсылаете GET_DESCRIPTOR с нужным типом и получаете символьное имя. </I>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=278363&amp;user=7963&amp;forum_n=6&amp;topic=17838&amp;page=0&amp;anchor=16" class="addthx" data-post="278363"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 222thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 марта 2011 20:40 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17838&amp;page=0#17');return false;">#17</a> </span><div align=left><br>
<I>Tolkin пишет:<br>т.е. ищем символьные имена типа    \??\USB#VID_0529&amp;PID_0001#5&amp;22a20d61&amp;0&amp;1#{a5dcbf10-6530-11d2-901f-00c04fb951ed} </I><br><br><I>DenCoder пишет:<br>в подразделе Services можно найти службу хаспа, где в подразделе Enum можно найти ключ Count, а за ним нужный подключ в root!!! </I><br>служба хаспа - одно, служба эмуля - другое, другими словами они в разных ветках!<br><br><I>Tolkin пишет:<br>Подскажите, с чего начинать </I><br>Прочитать все про kernel services, порядок загрузки драйверов... Ключом к поиску может служить EnumServicesStatusEx, например.<br><br><I>Tolkin пишет:<br>а может есть готовые примеры? </I><br>Должны быть. Но не рекомендую изучать kernel-простанство по исходникам, лучше сначала подготовиться теоретически. Только в &quot;экстренных&quot; случаях можно по кодам дров учиться, но и то параллельно долбить теоретическую часть! Хотя бы, связанную с используемыми сервисами.
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=278367&amp;user=24257&amp;forum_n=6&amp;topic=17838&amp;page=0&amp;anchor=17" class="addthx" data-post="278367"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]Tolkin[/b]','')">Tolkin</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 64.0 (постоянный), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.92'>Активность: 0.04<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=131">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 марта 2011 01:53 <br><script type="text/javascript">QU('Tolkin','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Tolkin" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17838&amp;page=0#18');return false;">#18</a> </span><div align=left><br>
Нашел пример (в драйвере от программы) где идет энумерация через хабы, кода там не много, так что думаю разберусь.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=278384&amp;user=131&amp;forum_n=6&amp;topic=17838&amp;page=0&amp;anchor=18" class="addthx" data-post="278384"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]Hexxx[/b]','')">Hexxx</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 481.4 (мудрец), 109thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.37'>Активность: 0.18<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=10168">Участник</a><br><font color=blue>Тот самый :)</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 марта 2011 14:23 &middot; Поправил: Hexxx <br><script type="text/javascript">QU('Hexxx','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Hexxx" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17838&amp;page=0#19');return false;">#19</a> </span><div align=left><br>
Если хочется общаться на самом низком уровне то через UsbBuildGetDescriptorRequest UsbBuildInterruptOrBulkTransferRequest и дальше фигачить в пайп хаба. Как найти пайп хаба не знаю, не пробовал. Обычно хватало энумерации девайсов более высокоуровневыми методами.
<br><br><font size="1"><i>-----<br>Реверсивная инженерия - написание кода идентичного натуральному</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=278406&amp;user=10168&amp;forum_n=6&amp;topic=17838&amp;page=0&amp;anchor=19" class="addthx" data-post="278406"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="20" onfocus="this.blur()" href="JavaScript:di('[b]Tolkin[/b]','')">Tolkin</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 64.0 (постоянный), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.92'>Активность: 0.04<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=131">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 марта 2011 15:29 <br><script type="text/javascript">QU('Tolkin','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Tolkin" target="_blank">Личное сообщение</a> &middot;  <a href="#20" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17838&amp;page=0#20');return false;">#20</a> </span><div align=left><br>
Нарыл еще полезный материал по этой теме. Оказывается, полезный и рабочий код режима ядра можно найти только в сорсах например руткитов <img src="img/smilies/s1.gif" alt="">) Вот один такой мне попался, там реализована работа (кроме всего прочего) с файлами через Irp пакеты, на примере которых все становится намного понятней.<br>А код энумерации хабов с получением обьектов донглов нашел в одной проге с драйвером - код используется для детектирования эмуляторов.<br>Вообщем вот такой винегрет )
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=278413&amp;user=131&amp;forum_n=6&amp;topic=17838&amp;page=0&amp;anchor=20" class="addthx" data-post="278413"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="21" onfocus="this.blur()" href="JavaScript:di('[b]Tolkin[/b]','')">Tolkin</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 64.0 (постоянный), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.92'>Активность: 0.04<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=131">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 марта 2011 21:29 <br><script type="text/javascript">QU('Tolkin','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Tolkin" target="_blank">Личное сообщение</a> &middot;  <a href="#21" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17838&amp;page=0#21');return false;">#21</a> </span><div align=left><br>
Пример, нписанный под х32 бсодит при х64.<br>Подозрение что структуры IRP пакетов для х32 и 64 разные? (например та же URB_CONTROL_DESCRIPTOR_REQUEST в иде имеют разные длины)<br>ну структуры я поменяю, вопрос вот в чем.<br>1. Формируем новый IRP через IoBuildDeviceIoControlRequest<br>2. Отдельно формируем нужный нам URB_CONTROL_DESCRIPTOR_REQUEST<br>3. Подставляем указатель на наш URB в сам IRP. Вот здесь я немного запутался, куда именно его подставить в х64. в моем варианте в х32 ставится сюда<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_char">*</span><span class="hl_char">(</span><span class="hl_char">(</span>_DWORD&nbsp;<span class="hl_char">*</span><span class="hl_char">)</span>irp<span class="hl_char">-</span><span class="hl_char">&gt;</span>Tail<span class="hl_char">.</span>Overlay<span class="hl_char">.</span>CurrentStackLocation&nbsp;<span class="hl_char">-</span>&nbsp;<span class="hl_number">8</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">=</span>&nbsp;Pnew_data<span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div>
<br>меняется ли эта точка входа в х64? и может есть имя этого параметра без смещения как тут (-8) ?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=278504&amp;user=131&amp;forum_n=6&amp;topic=17838&amp;page=0&amp;anchor=21" class="addthx" data-post="278504"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="22" onfocus="this.blur()" href="JavaScript:di('[b]r_e[/b]','')">r_e</a></b><br></div>
<img src="img/s8.gif" alt=""><br><span class=txtSm>Ранг: 590.6 (<b>!</b>), 408thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.08'>Активность: 0.36<span style='color:red'>&searr;</span>0.18</span><br>Статус: <a href="action=userinfo&amp;user=11966">Модератор</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 06 марта 2011 00:12 <br><script type="text/javascript">QU('r_e','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=r_e" target="_blank">Личное сообщение</a> &middot;  <a href="#22" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17838&amp;page=0#22');return false;">#22</a> </span><div align=left><br>
<b>Tolkin</b><br>Почитайте для начала книжки, что ли.<br>Данные URB должны быть в irpStack-&gt;Parameters.Others.Argument1<br>А игры с (CurrentStackLocation - 8) - это все от лешего.
<br><br><font size="1"><i>-----<br>старый пень</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=278511&amp;user=11966&amp;forum_n=6&amp;topic=17838&amp;page=0&amp;anchor=22" class="addthx" data-post="278511"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="23" onfocus="this.blur()" href="JavaScript:di('[b]Tolkin[/b]','')">Tolkin</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 64.0 (постоянный), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.92'>Активность: 0.04<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=131">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 06 марта 2011 01:08 <br><script type="text/javascript">QU('Tolkin','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Tolkin" target="_blank">Личное сообщение</a> &middot;  <a href="#23" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17838&amp;page=0#23');return false;">#23</a> </span><div align=left><br>
<b>r_e</b><br>Спасибо, уже тоже наткнулся что urb идет оттуда.<br>А вот эту строку (CurrentStackLocation - 8) выдала ИДА, почему так - хз, но работает. Проверю новое.<br>А книги я бы с удовольствием почитал бы, были бы только они толковые и было бы время ;)
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=278512&amp;user=131&amp;forum_n=6&amp;topic=17838&amp;page=0&amp;anchor=23" class="addthx" data-post="278512"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="24" onfocus="this.blur()" href="JavaScript:di('[b]r_e[/b]','')">r_e</a></b><br></div>
<img src="img/s8.gif" alt=""><br><span class=txtSm>Ранг: 590.6 (<b>!</b>), 408thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.08'>Активность: 0.36<span style='color:red'>&searr;</span>0.18</span><br>Статус: <a href="action=userinfo&amp;user=11966">Модератор</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 06 марта 2011 01:17 <br><script type="text/javascript">QU('r_e','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=r_e" target="_blank">Личное сообщение</a> &middot;  <a href="#24" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17838&amp;page=0#24');return false;">#24</a> </span><div align=left><br>
<b>Tolkin</b><br>Есть такая классическая книга Уолтера Они. Программирование Windows Driver Model. 2-е издание.<br>То что вам ида выдала - это что-то типа заинлайненного IoSkipCurrentStackLocation. Не помню уж точно.
<br><br><font size="1"><i>-----<br>старый пень</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=278513&amp;user=11966&amp;forum_n=6&amp;topic=17838&amp;page=0&amp;anchor=24" class="addthx" data-post="278513"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="25" onfocus="this.blur()" href="JavaScript:di('[b]ARCHANGEL[/b]','')">ARCHANGEL</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/6336.png" alt=""><br><span class=txtSm>Ранг: 681.5 <font color=magenta>(<b>! !</b>)</font>, 405thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.85'>Активность: 0.42<span style='color:red'>&searr;</span>0.21</span><br>Статус: <a href="action=userinfo&amp;user=6336">Участник</a><br><font color=blue>ALIEN Hack Team</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 06 марта 2011 09:15 <br><script type="text/javascript">QU('ARCHANGEL','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ARCHANGEL" target="_blank">Личное сообщение</a> &middot;  <a href="#25" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17838&amp;page=0#25');return false;">#25</a> </span><div align=left><br>
<b>r_e</b><br>Нет такого макроса IoSkipCurrentStackLocation, есть IoSkipCurrentIrpStackLocation
<br><br><font size="1"><i>-----<br>Stuck to the plan, always think that we would stand up, never ran.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=278517&amp;user=6336&amp;forum_n=6&amp;topic=17838&amp;page=0&amp;anchor=25" class="addthx" data-post="278517"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="26" onfocus="this.blur()" href="JavaScript:di('[b]Tolkin[/b]','')">Tolkin</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 64.0 (постоянный), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.92'>Активность: 0.04<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=131">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 06 марта 2011 11:23 &middot; Поправил: Tolkin <br><script type="text/javascript">QU('Tolkin','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Tolkin" target="_blank">Личное сообщение</a> &middot;  <a href="#26" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17838&amp;page=0#26');return false;">#26</a> </span><div align=left><br>
<b>ARCHANGEL</b><br>да этот есть<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">FORCEINLINE</li><li class="hl_l1"><span class="hl_function">VOID</span></li><li class="hl_l0">IoSkipCurrentIrpStackLocation&nbsp;<span class="hl_char">(</span>&nbsp;&nbsp;__inout&nbsp;PIRP&nbsp;Irp<span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT<span class="hl_char">(</span>Irp<span class="hl_char">-</span><span class="hl_char">&gt;</span>CurrentLocation&nbsp;<span class="hl_char">&lt;</span><span class="hl_char">=</span>&nbsp;Irp<span class="hl_char">-</span><span class="hl_char">&gt;</span>StackCount<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;Irp<span class="hl_char">-</span><span class="hl_char">&gt;</span>CurrentLocation<span class="hl_char">+</span><span class="hl_char">+</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;Irp<span class="hl_char">-</span><span class="hl_char">&gt;</span>Tail<span class="hl_char">.</span>Overlay<span class="hl_char">.</span>CurrentStackLocation<span class="hl_char">+</span><span class="hl_char">+</span><span class="hl_comment">;</span></li><li class="hl_l1">}</li>        </ol>
    </div>
</div></div>
<br>но по сути вроде не то, а похоже на<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">FORCEINLINE</li><li class="hl_l1"><span class="hl_function">VOID</span></li><li class="hl_l0">IoSetNextIrpStackLocation&nbsp;<span class="hl_char">(</span>&nbsp;__inout&nbsp;PIRP&nbsp;Irp&nbsp;<span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0"><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_function"><b>This</b></span>&nbsp;routine&nbsp;is&nbsp;invoked&nbsp;to&nbsp;set&nbsp;the&nbsp;current&nbsp;IRP&nbsp;stack&nbsp;location&nbsp;to</li><li class="hl_l1"><span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;the&nbsp;next&nbsp;stack&nbsp;location<span class="hl_char">,</span>&nbsp;i<span class="hl_char">.</span>e<span class="hl_char">.</span>&nbsp;it&nbsp;<span class="hl_quote">&quot;pushes&quot;</span>&nbsp;the&nbsp;stack<span class="hl_char">.</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT<span class="hl_char">(</span>Irp<span class="hl_char">-</span><span class="hl_char">&gt;</span>CurrentLocation&nbsp;<span class="hl_char">&gt;</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;Irp<span class="hl_char">-</span><span class="hl_char">&gt;</span>CurrentLocation<span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;Irp<span class="hl_char">-</span><span class="hl_char">&gt;</span>Tail<span class="hl_char">.</span>Overlay<span class="hl_char">.</span>CurrentStackLocation<span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_comment">;</span></li><li class="hl_l1">}</li>        </ol>
    </div>
</div></div>
<br>только непонятно зачем нужно это<br>ЗЫ. И если это точно вызов IoSetNextIrpStackLocation, то (-8) значит что вызываем дважды ?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=278523&amp;user=131&amp;forum_n=6&amp;topic=17838&amp;page=0&amp;anchor=26" class="addthx" data-post="278523"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="27" onfocus="this.blur()" href="JavaScript:di('[b]r_e[/b]','')">r_e</a></b><br></div>
<img src="img/s8.gif" alt=""><br><span class=txtSm>Ранг: 590.6 (<b>!</b>), 408thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.08'>Активность: 0.36<span style='color:red'>&searr;</span>0.18</span><br>Статус: <a href="action=userinfo&amp;user=11966">Модератор</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 06 марта 2011 11:58 <br><script type="text/javascript">QU('r_e','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=r_e" target="_blank">Личное сообщение</a> &middot;  <a href="#27" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17838&amp;page=0#27');return false;">#27</a> </span><div align=left><br>
Я написал фигню, а вы давай поддерживать. Вяснили ж уже куда URB пихать.
<br><br><font size="1"><i>-----<br>старый пень</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=278526&amp;user=11966&amp;forum_n=6&amp;topic=17838&amp;page=0&amp;anchor=27" class="addthx" data-post="278526"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="28" onfocus="this.blur()" href="JavaScript:di('[b]Tolkin[/b]','')">Tolkin</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 64.0 (постоянный), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.92'>Активность: 0.04<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=131">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 06 марта 2011 12:16 <br><script type="text/javascript">QU('Tolkin','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Tolkin" target="_blank">Личное сообщение</a> &middot;  <a href="#28" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17838&amp;page=0#28');return false;">#28</a> </span><div align=left><br>
<b>r_e</b><br>мож и не фигня, я проверю.<br>ведь проходя по цепочке драйверов стек irp пополняется их IO_STACK_LOCATION, мы же по сути начинаем с середины этого процесса, мож поэтому и надо поставить наш IO_STACK_LOCATION типа на свое место
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=278528&amp;user=131&amp;forum_n=6&amp;topic=17838&amp;page=0&amp;anchor=28" class="addthx" data-post="278528"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="29" onfocus="this.blur()" href="JavaScript:di('[b]Tolkin[/b]','')">Tolkin</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 64.0 (постоянный), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.92'>Активность: 0.04<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=131">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 06 марта 2011 15:17 <br><script type="text/javascript">QU('Tolkin','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Tolkin" target="_blank">Личное сообщение</a> &middot;  <a href="#29" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17838&amp;page=0#29');return false;">#29</a> </span><div align=left><br>
Что-то уперся я в структуру_IRP, не понять.<br>что там по смещению 0xE0 (смотрю в отладчике на XP SP3)? подскажите.<br>А то указатель на URB_CONTROL_DESCRIPTOR_REQUEST записывается именно туда, в область URB ничего не пишется, она располагается дальше.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=278533&amp;user=131&amp;forum_n=6&amp;topic=17838&amp;page=0&amp;anchor=29" class="addthx" data-post="278533"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="30" onfocus="this.blur()" href="JavaScript:di('[b]r_e[/b]','')">r_e</a></b><br></div>
<img src="img/s8.gif" alt=""><br><span class=txtSm>Ранг: 590.6 (<b>!</b>), 408thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.08'>Активность: 0.36<span style='color:red'>&searr;</span>0.18</span><br>Статус: <a href="action=userinfo&amp;user=11966">Модератор</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 06 марта 2011 17:41 <br><script type="text/javascript">QU('r_e','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=r_e" target="_blank">Личное сообщение</a> &middot;  <a href="#30" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17838&amp;page=0#30');return false;">#30</a> </span><div align=left><br>
Смотри команду dt в WinDbg
<br><br><font size="1"><i>-----<br>старый пень</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=278545&amp;user=11966&amp;forum_n=6&amp;topic=17838&amp;page=0&amp;anchor=30" class="addthx" data-post="278545"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> .  <b>1</b> . <a href="action=vthread&amp;forum=6&amp;topic=17838&amp;page=1.html">2</a> . <a href="action=vthread&amp;forum=6&amp;topic=17838&amp;page=1.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> энумерация USB-устройств в драйвере</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#31" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="6">
<input type="hidden" name="topic" value="17838">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=17838" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
