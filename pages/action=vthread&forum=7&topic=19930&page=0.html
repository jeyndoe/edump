<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Запуск программы из службы с правами админа, а не system. - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Здравствуйте! Суть проблемы такова, что есть служба из которой я запускаю некое приложение и оно автоматически запускается от SYSTEM. Мне необходимо запустить от пользователя, админа (без пароля) либо текущего на компе у которого">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=44014'>user99</a> (+2 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/mod.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=7&sortBy=0&page=0.html"><b>Оффтоп</b></a> <b class=bulletHead>&#8212;&#8250;</b> Запуск программы из службы с правами админа, а не system.</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]ToBad[/b]','')">ToBad</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/702.gif" alt=""><br><span class=txtSm>Ранг: 450.3 (мудрец), 13thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.67'>Активность: 0.2<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=702">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 24 мая 2012 23:46 <br><script type="text/javascript">QU('ToBad','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ToBad" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=19930.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Здравствуйте!<br>Суть проблемы такова, что есть служба из которой я запускаю некое приложение и оно автоматически запускается от SYSTEM. <br>Мне необходимо запустить от пользователя, админа (без пароля) либо текущего на компе у которого будут права админа. Система XP.<br>Запускал из службы FAR, а из него пытался запускать что-нибудь с правами админа с помощью runas или PsExec. На разных компьютерах с этим геморрой, то пустые пароли нельзя, то отказано в доступе, то вторичный вход в службах отключен...<br>Пишу на DELPHI, буду очень благодарен за подсказку или ссылку на пример.<br>Спасибо!
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=305907&amp;user=702&amp;forum_n=7&amp;topic=19930.html&amp;page=0&amp;anchor=1" class="addthx" data-post="305907"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]drone[/b]','')">drone</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 85.4 (постоянный), 51thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 8.79'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=30304">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 мая 2012 09:14 <br><script type="text/javascript">QU('drone','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=drone" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=19930.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
как делает служба обновления nvidia, касперского и другие, создают юзера с рандомным известным паролем, потом службу запускают от имени этого юзера
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=305915&amp;user=30304&amp;forum_n=7&amp;topic=19930.html&amp;page=0&amp;anchor=2" class="addthx" data-post="305915"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=702" title="28-05-2012 11:38, ранг:422.1" target="_blank">ToBad</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]drone[/b]','')">drone</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 85.4 (постоянный), 51thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 8.79'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=30304">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 мая 2012 09:20 <br><script type="text/javascript">QU('drone','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=drone" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=19930.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
вот тут есть все нужные примеры (только на си)<br>http://msdn.microsoft.com/en-us/library/windows/desktop/bb540476%28v=vs.85%29.aspx
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=305916&amp;user=30304&amp;forum_n=7&amp;topic=19930.html&amp;page=0&amp;anchor=3" class="addthx" data-post="305916"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]ToBad[/b]','')">ToBad</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/702.gif" alt=""><br><span class=txtSm>Ранг: 450.3 (мудрец), 13thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.67'>Активность: 0.2<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=702">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 мая 2012 13:13 <br><script type="text/javascript">QU('ToBad','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ToBad" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=19930.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
<b>drone</b> Спасибо! Нашёл примеры и на delphi через NetUserAdd, но тогда всё равно придется делать Runas, а с ним как я писал выше на определённых компах возникают сложности.<br><br>Я так понимаю что system по привилегиям стоит выше админа, неужели породить процесс от его имени такая сложная задача для винды, я же не пытаюсь от имени гостя создать что-то с админ правами?...<br><br>У меня из службы налажено взаимодействие с программой через файлмаппинг, так вот, что бы это начало нормально работать, мне тут подсказали делать подобным образом:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">sa<span class="hl_char">.</span>nLength&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>sa<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">sa<span class="hl_char">.</span>bInheritHandle&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;<span class="hl_function"><b>false</b></span><span class="hl_comment">;</span></li><li class="hl_l0">sa<span class="hl_char">.</span>lpSecurityDescriptor&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;@sd<span class="hl_comment">;</span></li><li class="hl_l1"><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_function"><b>not</b></span>&nbsp;InitializeSecurityDescriptor<span class="hl_char">(</span>@sd<span class="hl_char">,</span>SECURITY_DESCRIPTOR_REVISION<span class="hl_char">)</span>&nbsp;then</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;raise&nbsp;Exception<span class="hl_char">.</span>Create<span class="hl_char">(</span><span class="hl_quote">'InitializeSecurityDescriptor'</span>#13#10<span class="hl_char">+</span>SysErrorMessage<span class="hl_char">(</span>GetLastError<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_function"><b>not</b></span>&nbsp;SetSecurityDescriptorDacl<span class="hl_char">(</span>@sd<span class="hl_char">,</span><span class="hl_function">True</span><span class="hl_char">,</span>nil<span class="hl_char">,</span><span class="hl_function">False</span><span class="hl_char">)</span>&nbsp;then</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;raise&nbsp;Exception<span class="hl_char">.</span>Create<span class="hl_char">(</span><span class="hl_quote">'SetSecurityDescriptorDacl'</span>#13#10<span class="hl_char">+</span>SysErrorMessage<span class="hl_char">(</span>GetLastError<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">hFileMapObj<span class="hl_char">:</span><span class="hl_char">=</span>CreateFileMapping<span class="hl_char">(</span><span class="hl_char">$</span>FFFFFFFF<span class="hl_char">,</span>@sa<span class="hl_char">,</span>PAGE_READWRITE<span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span><span class="hl_number">6</span><span class="hl_char">,</span><span class="hl_quote">'xxxx'</span><span class="hl_char">)</span><span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div>
<br><br>Может подобным образом через установку SECURITY_ATTRIBUTES можно и с CreateProcess поступить, что бы она создавала от имени админа?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=305926&amp;user=702&amp;forum_n=7&amp;topic=19930.html&amp;page=0&amp;anchor=4" class="addthx" data-post="305926"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]ToBad[/b]','')">ToBad</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/702.gif" alt=""><br><span class=txtSm>Ранг: 450.3 (мудрец), 13thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.67'>Активность: 0.2<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=702">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 мая 2012 14:10 <br><script type="text/javascript">QU('ToBad','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ToBad" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=19930.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
Нашёл целую <noindex><a href="http://social.msdn.microsoft.com/Forums/en-US/windowssecurity/thread/31bfa13d-982b-4b1a-bff3-2761ade5214f/" rel="nofollow" target="_blank">ветку</a></noindex> посвящённую этой проблеме, к сожалению всё на английском и примеры на Си . Вот что мне показалось полезным: <i class=x>I am trying to start an application from the a windows service it&#039;s working fine on XP but not on Vista. The application is always started in session 0,but I want it in session 1 because it can show a UI.<br>Further more it needs to start when windows start and run either the interactive user is logged in or not, it does not need admin rights though.<br>Here is the entire code I am using, I also tried &quot;winlogon&quot; desktop but I got the same result.</i><br><br>Этот код может помочь мне или это другой случай?:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>int</b></span>&nbsp;res&nbsp;<span class="hl_char">=</span>&nbsp;LogonUser<span class="hl_char">(</span>User<span class="hl_char">,</span>Dom<span class="hl_char">,</span>Pwd<span class="hl_char">,</span>LOGON32_LOGON_INTERACTIVE<span class="hl_char">,</span>&nbsp;LOGON32_PROVIDER_DEFAULT<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>hToken<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">DuplicateTokenEx<span class="hl_char">(</span>hToken<span class="hl_char">,</span>&nbsp;MAXIMUM_ALLOWED<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;SecurityDelegation<span class="hl_char">,</span>&nbsp;TokenPrimary<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>hDToken<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">hwinstaSave&nbsp;<span class="hl_char">=</span>&nbsp;GetProcessWindowStation<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">hwinsta&nbsp;<span class="hl_char">=</span>&nbsp;OpenWindowStation<span class="hl_char">(</span><span class="hl_quote">&quot;winsta0&quot;</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">FALSE</span><span class="hl_char">,</span>&nbsp;READ_CONTROL&nbsp;<span class="hl_char">|</span>&nbsp;WRITE_DAC<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">res&nbsp;<span class="hl_char">=</span>&nbsp;SetProcessWindowStation<span class="hl_char">(</span>hwinsta<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">hdesk&nbsp;<span class="hl_char">=</span>&nbsp;OpenDesktop<span class="hl_char">(</span><span class="hl_quote">&quot;default&quot;</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">FALSE</span><span class="hl_char">,</span>&nbsp;READ_CONTROL&nbsp;<span class="hl_char">|</span>&nbsp;WRITE_DAC&nbsp;<span class="hl_char">|</span>&nbsp;DESKTOP_WRITEOBJECTS&nbsp;<span class="hl_char">|</span></li><li class="hl_l0">DESKTOP_READOBJECTS<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">res&nbsp;<span class="hl_char">=</span>&nbsp;SetProcessWindowStation<span class="hl_char">(</span>hwinstaSave<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">res&nbsp;<span class="hl_char">=</span>&nbsp;GetLogonSID<span class="hl_char">(</span>hDToken<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>pSid<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">res&nbsp;<span class="hl_char">=</span>&nbsp;AddAceToWindowStation<span class="hl_char">(</span>hwinsta<span class="hl_char">,</span>&nbsp;pSid<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">res&nbsp;<span class="hl_char">=</span>&nbsp;AddAceToDesktop<span class="hl_char">(</span>hdesk<span class="hl_char">,</span>&nbsp;pSid<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">res&nbsp;<span class="hl_char">=</span>&nbsp;ImpersonateLoggedOnUser<span class="hl_char">(</span>hDToken<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">ZeroMemory<span class="hl_char">(</span><span class="hl_char">&amp;</span><span class="hl_registr">si</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>STARTUPINFO<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span class="hl_registr">si</span><span class="hl_char">.</span>cb<span class="hl_char">=</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>STARTUPINFO<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_registr">si</span><span class="hl_char">.</span>lpDesktop&nbsp;<span class="hl_char">=</span>&nbsp;TEXT<span class="hl_char">(</span><span class="hl_quote">&quot;winsta0\default&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">bResult&nbsp;<span class="hl_char">=</span>&nbsp;CreateProcessAsUser<span class="hl_char">(</span>hDToken<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;lpCommandLine<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">FALSE</span><span class="hl_char">,</span>&nbsp;NORMAL_PRIORITY_CLASS&nbsp;<span class="hl_char">|</span>&nbsp;CREATE_NEW_CONSOLE<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;currentDirectory<span class="hl_char">.</span>c_str<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span><span class="hl_registr">si</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>pi&nbsp;<span class="hl_char">)</span><span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=305930&amp;user=702&amp;forum_n=7&amp;topic=19930.html&amp;page=0&amp;anchor=5" class="addthx" data-post="305930"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 мая 2012 14:19 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=19930.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
А зачем имперсонация, если процесс и так запускается от другого токена? Код похож на помойку, куда свалено всё подряд.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=305931&amp;user=1556&amp;forum_n=7&amp;topic=19930.html&amp;page=0&amp;anchor=6" class="addthx" data-post="305931"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]ToBad[/b]','')">ToBad</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/702.gif" alt=""><br><span class=txtSm>Ранг: 450.3 (мудрец), 13thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.67'>Активность: 0.2<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=702">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 мая 2012 14:36 <br><script type="text/javascript">QU('ToBad','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ToBad" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=19930.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
<I>Archer пишет:<br>А зачем имперсонация, если процесс и так запускается от другого токена? </I><br><br>Не знаю, перебираю все возможности для достижения цели, гуглю уже который день, но безрезультатно....<br>Сейчас <noindex><a href="http://www.wasm.ru/forum/viewtopic.php?id=37880" rel="nofollow" target="_blank">этот</a></noindex> вариант прорабатываю. Это может мне помочь?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=305932&amp;user=702&amp;forum_n=7&amp;topic=19930.html&amp;page=0&amp;anchor=7" class="addthx" data-post="305932"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]ClockMan[/b]','')">ClockMan</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/17432.jpg" alt=""><br><span class=txtSm>Ранг: 568.2 (<b>!</b>), 465thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.99'>Активность: 0.55<span style='color:green'>&nearr;</span>0.57</span><br>Статус: <a href="action=userinfo&amp;user=17432">Участник</a><br><font color=blue>оптимист</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 мая 2012 16:01 <br><script type="text/javascript">QU('ClockMan','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ClockMan" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=19930.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
Запуск и изминение сервисов из коммандной строки <noindex><a href="http://technet.microsoft.com/ru-RU/library/807191da-4a33-4149-addf-c11ded938b5f" rel="nofollow" target="_blank">--&gt; <b>sc config /</b> &lt;--</a></noindex>
<br><br><font size="1"><i>-----<br>Чтобы правильно задать вопрос, нужно знать большую часть  ответа. Р.Шекли.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=305936&amp;user=17432&amp;forum_n=7&amp;topic=19930.html&amp;page=0&amp;anchor=8" class="addthx" data-post="305936"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]F_a_u_s_t[/b]','')">F_a_u_s_t</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 0.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 16.12'>Активность: 0.25<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=6">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 мая 2012 16:15 <br><script type="text/javascript">QU('F_a_u_s_t','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=F_a_u_s_t" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=19930.html&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
<b>ToBad</b><br>Смотри примеры на delphi и да права System выше прав админа.<br><br><br><img src="img/attach.gif" alt=""> <a href="./files/468d_25.05.2012_EXELAB.rU.tgz">468d_25.05.2012_EXELAB.rU.tgz</a> - sample.rar
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=305941&amp;user=6&amp;forum_n=7&amp;topic=19930.html&amp;page=0&amp;anchor=9" class="addthx" data-post="305941"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]ToBad[/b]','')">ToBad</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/702.gif" alt=""><br><span class=txtSm>Ранг: 450.3 (мудрец), 13thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.67'>Активность: 0.2<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=702">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 мая 2012 16:22 <br><script type="text/javascript">QU('ToBad','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ToBad" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=19930.html&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
<b>ClockMan</b> не, я не сервис от админа с привилегиями system хочу запустить, а из запущенного сервиса программу от имени админа...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=305943&amp;user=702&amp;forum_n=7&amp;topic=19930.html&amp;page=0&amp;anchor=10" class="addthx" data-post="305943"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]ToBad[/b]','')">ToBad</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/702.gif" alt=""><br><span class=txtSm>Ранг: 450.3 (мудрец), 13thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.67'>Активность: 0.2<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=702">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 мая 2012 17:03 <br><script type="text/javascript">QU('ToBad','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ToBad" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=19930.html&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
<b>F_a_u_s_t</b> Спасибо за код, очень полезный будет, хотя результата я пока не достиг.<br><br>run-ass - вроде как то, что нужно, под админом выбираю учётку админа и пустой пароль, запускает под админом. Под системой запускаю, выбираю тоже самое, не запускает, выдаёт ошибку Logon failure: unknown user name or bad password.<br>То есть CreateProcessWithLogonW выполняется с ошибкой...<br><br>run-as-system - работает хорошо для своих задач, то есть под админом запускает программы от system, но это не то, что нужно, нужно наоборот...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=305948&amp;user=702&amp;forum_n=7&amp;topic=19930.html&amp;page=0&amp;anchor=11" class="addthx" data-post="305948"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]F_a_u_s_t[/b]','')">F_a_u_s_t</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 0.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 16.12'>Активность: 0.25<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=6">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 мая 2012 17:30 <br><script type="text/javascript">QU('F_a_u_s_t','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=F_a_u_s_t" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=19930.html&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
<b>ToBad</b><br>Так код я привел что бы было на что опираться, а так гугли теперь функи и параметры к ним и кода будет чуть меньше чем докуя.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=305951&amp;user=6&amp;forum_n=7&amp;topic=19930.html&amp;page=0&amp;anchor=12" class="addthx" data-post="305951"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]ntldr[/b]','')">ntldr</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 369.8 (мудрец), 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.89'>Активность: 0.39<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=12867">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 мая 2012 07:01 <br><script type="text/javascript">QU('ntldr','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ntldr" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=19930.html&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
<b>ToBad</b><br>Недавно ковырял тему runas чуть более чем плотно. В сервисе нужно использовать LogonUser и CreateProcessAsUser, естественно сервису откуда-то нужно знать пароль пользователя. Запустить от пользователя не зная пароля тоже можно, но это будут глюкавые неполноценные хаки.
<br><br><font size="1"><i>-----<br>PGP key <noindex><a href="https://diskcryptor.net/storage/new_key.asc" rel="nofollow" target="_blank">&lt0x1B6A24550F33E44A&gt</a></noindex></i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=306031&amp;user=12867&amp;forum_n=7&amp;topic=19930.html&amp;page=0&amp;anchor=13" class="addthx" data-post="306031"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=702" title="28-05-2012 11:31, ранг:422.1" target="_blank">ToBad</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]ToBad[/b]','')">ToBad</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/702.gif" alt=""><br><span class=txtSm>Ранг: 450.3 (мудрец), 13thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.67'>Активность: 0.2<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=702">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 мая 2012 03:14 <br><script type="text/javascript">QU('ToBad','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ToBad" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=19930.html&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
<I>ntldr пишет:<br>В сервисе нужно использовать LogonUser и CreateProcessAsUser </I><br><br>Спасибо за наводку!<br><br><I>ntldr пишет:<br>нужно знать пароль пользователя </I><br><br>Это не проблема, там где собираюсь применять паролей нет.<br><br>Испытал много разных примеров, ничего не работало как нужно, в итоге нашёл код, который у кого-то не работал, а у меня заработал отлично:<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">function&nbsp;RunProcessAsCurrentUser<span class="hl_char">(</span>FileName<span class="hl_char">:</span>&nbsp;string<span class="hl_char">)</span><span class="hl_char">:</span>&nbsp;Boolean<span class="hl_comment">;</span></li><li class="hl_l1">var</li><li class="hl_l0">&nbsp;ProcessId<span class="hl_char">:</span>&nbsp;Integer<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;hWindow<span class="hl_char">,</span>&nbsp;hProcess<span class="hl_char">,</span>&nbsp;TokenHandle<span class="hl_char">:</span>&nbsp;THandle<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;<span class="hl_registr">si</span><span class="hl_char">:</span>&nbsp;Tstartupinfo<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;p<span class="hl_char">:</span>&nbsp;Tprocessinformation<span class="hl_comment">;</span></li><li class="hl_l0">begin</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;Result<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;<span class="hl_function"><b>False</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;hWindow<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;FindWindow<span class="hl_char">(</span><span class="hl_quote">'Progman'</span><span class="hl_char">,</span>&nbsp;<span class="hl_quote">'Program Manager'</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;GetWindowThreadProcessID<span class="hl_char">(</span>hWindow<span class="hl_char">,</span>&nbsp;@ProcessID<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;hProcess<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;OpenProcess&nbsp;<span class="hl_char">(</span>PROCESS_ALL_ACCESS<span class="hl_char">,</span>&nbsp;<span class="hl_function">FALSE</span><span class="hl_char">,</span>&nbsp;ProcessID<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;OpenProcessToken<span class="hl_char">(</span>hProcess<span class="hl_char">,</span>&nbsp;TOKEN_ALL_ACCESS<span class="hl_char">,</span>&nbsp;TokenHandle<span class="hl_char">)</span>&nbsp;then</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;begin</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FillChar<span class="hl_char">(</span><span class="hl_registr">si</span><span class="hl_char">,</span><span class="hl_function">SizeOf</span><span class="hl_char">(</span><span class="hl_registr">si</span><span class="hl_char">)</span><span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;<span class="hl_registr"><b>Si</b></span>&nbsp;do&nbsp;begin</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cb&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;<span class="hl_function">SizeOf</span><span class="hl_char">(</span>&nbsp;<span class="hl_registr">Si</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwFlags&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;startf_UseShowWindow<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wShowWindow&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;SW_NORMAL<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lpDesktop&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;PChar<span class="hl_char">(</span><span class="hl_quote">'winsta0\default'</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Result<span class="hl_char">:</span><span class="hl_char">=</span>CreateProcessAsUser<span class="hl_char">(</span>TokenHandle<span class="hl_char">,</span>&nbsp;nil<span class="hl_char">,</span>&nbsp;PChar<span class="hl_char">(</span>FileName<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;nil<span class="hl_char">,</span>&nbsp;nil<span class="hl_char">,</span>&nbsp;<span class="hl_function">false</span><span class="hl_char">,</span>&nbsp;Create_default_error_mode<span class="hl_char">,</span>&nbsp;nil<span class="hl_char">,</span>&nbsp;nil<span class="hl_char">,</span>&nbsp;<span class="hl_registr">si</span><span class="hl_char">,</span>&nbsp;p<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div>
<br><br>Напомню, только XP, паролей нет, хотя мне кажется или тут и с паролями сработало бы?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=306082&amp;user=702&amp;forum_n=7&amp;topic=19930.html&amp;page=0&amp;anchor=14" class="addthx" data-post="306082"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]ntldr[/b]','')">ntldr</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 369.8 (мудрец), 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.89'>Активность: 0.39<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=12867">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 мая 2012 11:07 <br><script type="text/javascript">QU('ntldr','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ntldr" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=19930.html&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
<I>ToBad пишет:<br>паролей нет. </I><br>Пароль <b>длджен</b> быть. Вход с пустым паролем чаще всего запрещен.<br><br><I>ToBad пишет:<br>в итоге нашёл код, который у кого-то не работал, а у меня заработал отлично: </I><br>Это как раз из серии глюкавых неполноценных хаков. Почему - не буду даже комментировать, думаю это очевидно. Будет работать непредсказуемо или вообще никак в более чем 100500 случаях.
<br><br><font size="1"><i>-----<br>PGP key <noindex><a href="https://diskcryptor.net/storage/new_key.asc" rel="nofollow" target="_blank">&lt0x1B6A24550F33E44A&gt</a></noindex></i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=306093&amp;user=12867&amp;forum_n=7&amp;topic=19930.html&amp;page=0&amp;anchor=15" class="addthx" data-post="306093"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]F_a_u_s_t[/b]','')">F_a_u_s_t</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 0.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 16.12'>Активность: 0.25<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=6">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 мая 2012 15:03 &middot; Поправил: F_a_u_s_t <br><script type="text/javascript">QU('F_a_u_s_t','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=F_a_u_s_t" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=19930.html&amp;page=0#16');return false;">#16</a> </span><div align=left><br>
<b>ToBad</b><br>Семпл Run_as_System рабочий, только для твоей задачи нужно поменять две строчки, но опять же там хак.<br><br>if (LowerCase(ProcessEntry32.szExeFile) = &#039;winlogon.exe&#039;) then<br>заменить на<br>if (LowerCase(ProcessEntry32.szExeFile) = &#039;explorer.exe&#039;) then<br><br>if UserName = &#039;SYSTEM&#039; then<br>заменить на<br>if UserName = GetUserName then<br><br>Где GetUserName  имя текущего пользователя.<br><br>Без хаков, чистое решение, создать пользователя с паролем и по окончанию его удалить, так делают большинство, ну или сделать текущему пользователю пароль, но за это надо руки отрывать, при каком нибудь ахтунге учетка может полететь.<br><br>Ps. Семпл проверял на трех осях, работало стабильно.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=306114&amp;user=6&amp;forum_n=7&amp;topic=19930.html&amp;page=0&amp;anchor=16" class="addthx" data-post="306114"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=702" title="28-05-2012 11:31, ранг:422.1" target="_blank">ToBad</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]ToBad[/b]','')">ToBad</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/702.gif" alt=""><br><span class=txtSm>Ранг: 450.3 (мудрец), 13thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.67'>Активность: 0.2<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=702">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 мая 2012 16:09 <br><script type="text/javascript">QU('ToBad','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ToBad" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=19930.html&amp;page=0#17');return false;">#17</a> </span><div align=left><br>
<b>F_a_u_s_t</b> - спасибо за то, что всё разжевали! Я тоже пытался вместо SYSTEM вписывать пользователя, но про замену первой строчки не догадался...<br><br><I>ntldr пишет:<br>Вход с пустым паролем чаще всего запрещен. </I><br><br>Да, это может оказаться проблемой, по этому как посоветовали буду делать LogonUser и CreateProcessAsUser, для созданного пользователя с установленным паролем.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=306122&amp;user=702&amp;forum_n=7&amp;topic=19930.html&amp;page=0&amp;anchor=17" class="addthx" data-post="306122"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]F_a_u_s_t[/b]','')">F_a_u_s_t</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 0.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 16.12'>Активность: 0.25<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=6">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 мая 2012 17:17 &middot; Поправил: F_a_u_s_t <br><script type="text/javascript">QU('F_a_u_s_t','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=F_a_u_s_t" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=19930.html&amp;page=0#18');return false;">#18</a> </span><div align=left><br>
<b>ToBad</b><br>Не за что.<img src="img/smilies/s1.gif" alt=""><br>И еще один маленький хинт, что бы не было хардкора на explorer можешь сделать проверку на тип прав, если не SYSTEM то значит юзер и в самом сервисе проверяй, если процесс исчез, то ищи любой другой процесс юзера, а так вполне рабочее решение.<br>Add:<br>Правильно что выбрал второй вариант, первый только годный запускать к к примеру консоль из своей прожки с нужными правами, для использования где то не годится ибо аверы и вирусы, а есчо куча шелов.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=306130&amp;user=6&amp;forum_n=7&amp;topic=19930.html&amp;page=0&amp;anchor=18" class="addthx" data-post="306130"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/mod.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=7&sortBy=0&page=0.html"><b>Оффтоп</b></a> <b class=bulletHead>&#8212;&#8250;</b> Запуск программы из службы с правами админа, а не system.</span></td>
</tr></table>
</div>
<a name=newreply></a>
<center><h3>У вас должно быть 20 пунктов ранга, чтобы оставлять сообщения в  этом подфоруме, но у вас только 0</h3></center><script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=19930" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
