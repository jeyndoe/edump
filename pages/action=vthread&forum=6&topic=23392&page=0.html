<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Посоветуйте как лучше сделать перехват функции - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Добрый день! Посоветуйте, пожалуйста, оптимальное решение данной задачи. Есть процесс, который ломится в сеть по определенному адресу (пакеты идут по UDP). Этот адрес нужно подменить на свой. Файл Hosts не подходит потому что">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=8605'>Rio</a>, <a target='_blank' href='?action=userinfo&amp;user=55995'>tyns777</a>, <a target='_blank' href='?action=userinfo&amp;user=42072'>zombi-vadim</a> (+7 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Посоветуйте как лучше сделать перехват функции</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]Hellrider[/b]','')">Hellrider</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 3.6 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.43'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=36776">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 февраля 2015 13:53 <br><script type="text/javascript">QU('Hellrider','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Hellrider" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=23392.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Добрый день!<br>Посоветуйте, пожалуйста, оптимальное решение данной задачи.<br><br>Есть процесс, который ломится в сеть по определенному адресу (пакеты идут по UDP). Этот адрес нужно подменить на свой. Файл Hosts не подходит потому что запрос идет на IP.<br>Сделал внедрение своей DLL в память этого процесса, в главном потоке библиотеки нахожу адрес:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">Orig_addr&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;GetProcAddress<span class="hl_char">(</span>hWinsock<span class="hl_char">,</span>&nbsp;<span class="hl_quote">'sendto'</span><span class="hl_char">)</span><span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div>
<br>Далее обычный сплайсинг - по этому адресу считываю 6 байт оригинального кода и прописываю туда PUSH ADDR + RET. Работает все с точностью до многопоточности - при ней часто вылетает из-за нарушения последовательности чтения-записи этих байт.<br><br><b>Вариант 1</b> каждый раз при вызове моей функции sendto входить в CriticalSection, но мне кажется что это лишняя нагрузка на машину и тормоза при большом количестве пакетов. Или я не прав, делать так и не париться?<br><br><br><b>Вариант 2</b> зная что нужные мне вызовы функции sendto() происходят только НЕ из главного потока программы, а большинство пакетов отправляются как раз из главного (выяснил опытным путем логирования GetCurrentThreadId() и дампа данных) каким-то образом пройтись по памяти нужных потоков и позаменять адрес Orig_addr на адрес моей новой функции. Таким образом, при вызове каждый раз не будет писаться/возвращаться патч оригинальной функции, будет сразу идти моя функция.<br>Возникают 2 нубских вопроса:<br>1) имеет ли этот вариант право на жизнь?<br>2) как определить начальный и конечный адрес памяти, в которой находится машинный код того или иного потока процесса?<br>3) поиск-замена 4 байт памяти (адрес) чревата коллизиями, лучше искать инструкцию call + нужный адрес и подобные. Где взять полный список этих сигнатур (опкодов)? в АСМе я, к сожалению, не силен.<br><br>Спасибо.<br><br>P.S. за Delphi прошу не троллить <img src="img/smilies/s1.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=351632&amp;user=36776&amp;forum_n=6&amp;topic=23392.html&amp;page=0&amp;anchor=1" class="addthx" data-post="351632"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]reversecode[/b]','')">reversecode</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/15381.gif" alt=""><br><span class=txtSm>Ранг: 1053.6 <b><u>(!!!!)</u></b>, 1078thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.43'>Активность: 1.06<span style='color:red'>&searr;</span>0.81</span><br>Статус: <a href="action=userinfo&amp;user=15381">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 февраля 2015 13:58 <br><script type="text/javascript">QU('reversecode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=reversecode" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=23392.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
в гугле вбей<br>delphi splacing<br>и читай
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=351633&amp;user=15381&amp;forum_n=6&amp;topic=23392.html&amp;page=0&amp;anchor=2" class="addthx" data-post="351633"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]Hellrider[/b]','')">Hellrider</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 3.6 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.43'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=36776">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 февраля 2015 14:10 &middot; Поправил: Hellrider <br><script type="text/javascript">QU('Hellrider','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Hellrider" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=23392.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
Ну я ж не настолько нуб, сделано по примерам, найденным в гугле. Только инжект чуть по-другому.<br><br>Вопрос будет ли EnterCriticalSection / LeaveCriticalSection сильно нагружать систему и реально ли сделать второе.<br>Я работал с памятью процесса (поиск-замена значения переменной (hwid) для привязки ключа от другого ПК) через VirtualQueryEx(), но там память процесса, и передавать надо хендл процесса, как получить для отдельного потока не знаю.<br><br>P.S. Splicing или splacing? все говорят сплайсинг а не сплэйсинг. Или я ошибаюсь?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=351634&amp;user=36776&amp;forum_n=6&amp;topic=23392.html&amp;page=0&amp;anchor=3" class="addthx" data-post="351634"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]ELF_7719116[/b]','')">ELF_7719116</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 419.0 (мудрец), 647thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.73'>Активность: 0.46<span style='color:green'>&nearr;</span>0.51</span><br>Статус: <a href="action=userinfo&amp;user=26651">Участник</a><br><font color=blue>&quotТибериумный реверсинг&quot</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 февраля 2015 14:41 &middot; Поправил: ELF_7719116 <br><script type="text/javascript">QU('ELF_7719116','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ELF_7719116" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=23392.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
<b>Hellrider</b><br>давайте попробуем зайти еще с другой стороны!<br>программа(процесс, которые имеете ввиду) проверяет свою целостность? навешаны ли какие либо пакеры? <br>если ничего подобного нет, можно спокойно подправить функционал внутри самой целевой проги, тем самым решив проблему многопоточности (все изначально будет в рабочем состоянии). тут несколько вариантов:<br>1. Исправить непосредственно в самом exe файле. Придется выучить немного асм и знать принципы отладки. <br>2. Написать свой аналог winsock библиотеки на том-же Delphi и подправить таблицу импорта exe - редирект на Вашу библиотеку. Тут достаточно знания работы утилиты PeTools и понимания, что именно нужно править.<br><I>Hellrider пишет:<br>Работает все с точностью до многопоточности - при ней часто вылетает из-за нарушения последовательности чтения-записи этих байт. </I><br>Вообще же, по идеи, нужно остановить все потоки в программе, перед тем как писать через WriteProcessmemory. К тому же может стоять какая-то защита(протектор).
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=351635&amp;user=26651&amp;forum_n=6&amp;topic=23392.html&amp;page=0&amp;anchor=4" class="addthx" data-post="351635"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]Hellrider[/b]','')">Hellrider</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 3.6 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.43'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=36776">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 февраля 2015 15:52 &middot; Поправил: Hellrider <br><script type="text/javascript">QU('Hellrider','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Hellrider" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=23392.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
Спасибо за ответ. На самом деле все несколько сложнее.<br>В самой программе защиты нет никакой, целостность не проверяется. Есть 2 библиотеки - одна ответственная за отправку нужного мне запроса (пакета данных), но за сам адрес хоста отвечает другая библиотека, а прямой связи между ними я не нашел (делается через основную программу или еще одну библиотеку). Там много мистики и все слишком запутано. Они тоже не зашифрованы. НО ip адрес ни в виде строки, ни в виде integer я нигде не нашел. В древних версиях этой библиотеки он был прямым текстом и патчился HEX-редактором. Они не совместимы с новыми версиями основной программы, которая мне и нужна, более того у более новых версий они не совместимы между собой (краш). Именно поэтому я и решил делать универсальный перехват вызова.<br><br>Сделать фейковый клон Winsock и подправить таблицу импорта в HEX я чего-то не подумал, хотя именно через фейк и внедряюсь в процесс чтобы не возникало лишних вопросов у конечных пользователей. В библиотеке, из которой идет запрос, действительно есть в таблице импорта WSOCK32.dll и 15 функций по индексу, без имен. Думаю, достаточно сделать именно их и это будет решением, которое, скорее всего, не повлияет на работу основной программы. Пошел делать, сложность низкая, если что будет для каждой версии свой патч.<br><br>Но решением только для самой последней версии софта. На предыдущей (она тоже нужна) не прокатит т.к. из WSOCK32 импортируется только 3 функции (htonl, ntohl, gethostbyname), а это явно не достаточно для отправки пакета, в тексте упоминание sendto отсутствует, следовательно фиг я смогу разобраться где его искать и подменять. Winsock2 там вообще не используется, хотя ИМХО уже должны были на него перейти т.к. последние версии переделаны капитально относительно старой линейки.<br><br>Список потоков получить можно, останавливать не пробовал но это решаемо. Тогда еще вопрос к опытным специалистам - это не будет тормозить? EnterCriticalSection по сути будет выполнять ту же функцию - не давать другим потокам одновременно выполнять этот же участок кода. Что будет меньше нагружать систему?<br><br>=====<br>Сделал фейковый WSOCK32 - облом. Вызовы идут исключительно из одного потока, хотя в &quot;исправляемой&quot; библиотеке их два. Это второй, он не нужен. Получается, что из этой библиотеки нужный мне пакет отправляется одним методом, не использующим таблицу импорта, а другой поток уже ее использует. С учетом этого и того что в других версиях импорта нужных функций вообще нет - метод не катит.<br>Нужно возвращаться к предыдущему:<br><br>- EnterCriticalSection<br>- Остановка потоков<br>- Патч адреса функции во всех местах откуда она вызывается<br><br>Что из первых 2х лучше и реально ли сделать третье?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=351637&amp;user=36776&amp;forum_n=6&amp;topic=23392.html&amp;page=0&amp;anchor=5" class="addthx" data-post="351637"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]ajax[/b]','')">ajax</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/8830.gif" alt=""><br><span class=txtSm>Ранг: 337.6 (мудрец), 224thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.53'>Активность: 0.21<span style='color:red'>&searr;</span>0.1</span><br>Статус: <a href="action=userinfo&amp;user=8830">Участник</a><br><font color=blue>born to be evil</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 февраля 2015 18:12 <br><script type="text/javascript">QU('ajax','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ajax" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=23392.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
<I>Hellrider пишет:<br>- EnterCriticalSection<br>- Остановка потоков<br>- Патч адреса функции во всех местах откуда она вызывается</I><br>- есть доля истины. тормоза хз, насколько критичны<br>- как оно работать будет?<br>- те же яйки, ломиться они все равно будут в новую функу всеми<br><br>а если кода нет в функции, а сразу прыжок на оригинальную - не валится?
<br><br><font size="1"><i>-----<br>От многой мудрости много скорби, и умножающий знание умножает печаль</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=351640&amp;user=8830&amp;forum_n=6&amp;topic=23392.html&amp;page=0&amp;anchor=6" class="addthx" data-post="351640"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]Hellrider[/b]','')">Hellrider</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 3.6 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.43'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=36776">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 февраля 2015 18:52 <br><script type="text/javascript">QU('Hellrider','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Hellrider" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=23392.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
Остановка потоков - все потоки стоят кроме текущего чтобы никто не заменял первые 6 байт функции в то время когда ее заменяет текущий поток. Я никогда так не делал но приблизительно понимаю как оно должно работать, только сейчас начинаю думать что остановка потоков все равно должна быть через критическую сессию или семафор, а это больше команд чем просто вход-выход из критической сессии.<br><br>Если кода нет вылеты тоже есть, на первой минуте работы когда трафик наиболее интенсивный. Я уже проверял это - вызывается именно наложением записей первых байт кода функции
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=351641&amp;user=36776&amp;forum_n=6&amp;topic=23392.html&amp;page=0&amp;anchor=7" class="addthx" data-post="351641"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]ajax[/b]','')">ajax</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/8830.gif" alt=""><br><span class=txtSm>Ранг: 337.6 (мудрец), 224thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.53'>Активность: 0.21<span style='color:red'>&searr;</span>0.1</span><br>Статус: <a href="action=userinfo&amp;user=8830">Участник</a><br><font color=blue>born to be evil</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 февраля 2015 20:23 <br><script type="text/javascript">QU('ajax','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ajax" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=23392.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
<I>Hellrider пишет:<br>чтобы никто не заменял первые 6 байт </I><br>ее еще кто-то подменяет?  остановка потоков имеет смысл, когда хук идет в процессе выполнения многопоточной проги. при старте или типа того - смысла нет. мне не попадались такие случаи, чтоб фрозить потоки<br><I>Hellrider пишет:<br>вызывается именно наложением записей первых байт кода функции </I><br>приведите код. гадать не хочу
<br><br><font size="1"><i>-----<br>От многой мудрости много скорби, и умножающий знание умножает печаль</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=351647&amp;user=8830&amp;forum_n=6&amp;topic=23392.html&amp;page=0&amp;anchor=8" class="addthx" data-post="351647"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 222thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 февраля 2015 20:31 <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=23392.html&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
<I>Hellrider пишет:<br>Остановка потоков - все потоки стоят кроме текущего чтобы никто не заменял первые 6 байт функции </I><br>Бред! Изменил один раз и больше не надо, перехватывай...<br><br><I>Hellrider пишет:<br>остановка потоков все равно должна быть через критическую сессию или семафор </I><br>Ещё один бред...
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=351648&amp;user=24257&amp;forum_n=6&amp;topic=23392.html&amp;page=0&amp;anchor=9" class="addthx" data-post="351648"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]Hellrider[/b]','')">Hellrider</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 3.6 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.43'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=36776">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 февраля 2015 20:38 <br><script type="text/javascript">QU('Hellrider','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Hellrider" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=23392.html&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
<b>Бред! Изменил один раз и больше не надо</b><br>Это как? восстановил - запустил - вернул подмену! Это же сплайсинг.<br>Пока такой рабочий вариант<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">function&nbsp;NewSendto<span class="hl_char">(</span>s<span class="hl_char">:</span>&nbsp;TSocket<span class="hl_comment">; var Buf; len, flags: Integer; var addrto: TSockAddr; tolen: Integer): Integer; stdcall;</span></li><li class="hl_l1">var</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Written<span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>dword</b></span><span class="hl_comment">;</span></li><li class="hl_l1">begin</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EnterCriticalSection<span class="hl_char">(</span>CriticalSection<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WriteProcessMemory<span class="hl_char">(</span>INVALID_HANDLE_VALUE<span class="hl_char">,</span>&nbsp;SToAdr<span class="hl_char">,</span>&nbsp;@OldSTo<span class="hl_char">,</span>&nbsp;<span class="hl_function">SizeOf</span><span class="hl_char">(</span>OldCode<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;Written<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Result&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;Sendto<span class="hl_char">(</span>s<span class="hl_char">,</span>&nbsp;Buf<span class="hl_char">,</span>&nbsp;len<span class="hl_char">,</span>&nbsp;flags<span class="hl_char">,</span>&nbsp;addrto<span class="hl_char">,</span>&nbsp;tolen<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="hl_char">$</span>IFDEF&nbsp;DEBUG}log<span class="hl_char">(</span><span class="hl_quote">'SendTo LEN= '</span><span class="hl_char">+</span>inttostr<span class="hl_char">(</span>len<span class="hl_char">)</span><span class="hl_char">+</span><span class="hl_quote">' ADDR='</span><span class="hl_char">+</span>inet_ntoa<span class="hl_char">(</span>addrto<span class="hl_char">.</span>sin_addr<span class="hl_char">)</span><span class="hl_char">+</span><span class="hl_quote">':'</span><span class="hl_char">+</span>inttostr<span class="hl_char">(</span>ntohs<span class="hl_char">(</span>addrto<span class="hl_char">.</span>sin_port<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_char">+</span><span class="hl_quote">' returned '</span><span class="hl_char">+</span>inttostr<span class="hl_char">(</span>Result<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;{$ENDIF}</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WriteProcessMemory<span class="hl_char">(</span>INVALID_HANDLE_VALUE<span class="hl_char">,</span>&nbsp;SToAdr<span class="hl_char">,</span>&nbsp;@JmpSTo<span class="hl_char">,</span>&nbsp;<span class="hl_function">SizeOf</span><span class="hl_char">(</span>far_jmp<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;Written<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LeaveCriticalSection<span class="hl_char">(</span>CriticalSection<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div>
<br>Надо бы конечно на тестовом приложении замерить время отправки 1000 пакетов по 1кб на 127.0.0.1 с CriticalSection и без нее...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=351650&amp;user=36776&amp;forum_n=6&amp;topic=23392.html&amp;page=0&amp;anchor=10" class="addthx" data-post="351650"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]ajax[/b]','')">ajax</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/8830.gif" alt=""><br><span class=txtSm>Ранг: 337.6 (мудрец), 224thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.53'>Активность: 0.21<span style='color:red'>&searr;</span>0.1</span><br>Статус: <a href="action=userinfo&amp;user=8830">Участник</a><br><font color=blue>born to be evil</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 февраля 2015 20:44 &middot; Поправил: ajax <br><script type="text/javascript">QU('ajax','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ajax" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=23392.html&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
<b>Hellrider</b><br>даже на ум _такое_ не могло прийти <img src="img/smilies/s16.gif" alt=""> курите гугль, хуков на дельфи полно
<br><br><font size="1"><i>-----<br>От многой мудрости много скорби, и умножающий знание умножает печаль</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=351651&amp;user=8830&amp;forum_n=6&amp;topic=23392.html&amp;page=0&amp;anchor=11" class="addthx" data-post="351651"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 222thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 февраля 2015 21:55 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=23392.html&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
<I>Hellrider пишет:<br>восстановил - запустил - вернул подмену! </I><br>Зачем возвращать подмену? Это только тормозит процесс, лишняя последовательность действий! Так конечно, при таком подходе тормозить треды надо. Но зачем?<br><br>Перехватил - передал управление в свой код - обработал сиутацию - выполнил оригинальные инструкции - передал управление обратно
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=351652&amp;user=24257&amp;forum_n=6&amp;topic=23392.html&amp;page=0&amp;anchor=12" class="addthx" data-post="351652"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]Hellrider[/b]','')">Hellrider</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 3.6 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.43'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=36776">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 февраля 2015 22:10 <br><script type="text/javascript">QU('Hellrider','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Hellrider" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=23392.html&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
<I>DenCoder пишет:<br>Перехватил - передал управление в свой код - обработал сиутацию - выполнил оригинальные инструкции - передал управление обратно  </I><br>Исходное приложение вызывает исходную функцию SendTo() в которой прописан переход в мою функцию.<br>Моя функция не может выполнить исходную функцию как есть потому что будет зацикливание - надо туда вернуть исходные байты. Я это делаю, потом вызываю исходную, она возвращает результат. Если я просто выйду - при следующем вызове sendto() из программы там уже не будет перехода на мою функцию. Мне не надо разово, надо хватать определенные пакеты за все время работы программы, потому в конце туда (обратно) прописывается переход на мою функцию. Во всех примерах так вроде, только было 2 способа - с абсолютным адресом и относительным
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=351653&amp;user=36776&amp;forum_n=6&amp;topic=23392.html&amp;page=0&amp;anchor=13" class="addthx" data-post="351653"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]kid[/b]','')">kid</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 42.2 (посетитель), 42thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.46'>Активность: 0.04<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=27711">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 февраля 2015 23:37 <br><script type="text/javascript">QU('kid','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=kid" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=23392.html&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
вы поглядите в сорцы любой либы для хуков , поглядите что происходит с оригинальными байтами при хуке функи , и как вызвать оригинальную функу не снимаю своего джампа . <br><br>Угадайте почему там используется дизассемблер длины инструкций?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=351656&amp;user=27711&amp;forum_n=6&amp;topic=23392.html&amp;page=0&amp;anchor=14" class="addthx" data-post="351656"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 222thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 февраля 2015 08:37 <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=23392.html&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
<I>Hellrider пишет:<br>Моя функция не может выполнить исходную функцию как есть потому что будет зацикливание </I><br>Разве кто-нибудь говорил, что передать управление обратно надо на начало? Распространённый случай, когда перехватываемая функция начинается с<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">func1<span class="hl_char">:</span></li><li class="hl_l1"><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">edi</span></li><li class="hl_l0"><span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">ebp</span></li><li class="hl_l1"><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ebp</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">esp</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">func1_entry_from_hook<span class="hl_char">:</span></li><li class="hl_l0"><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span></li><li class="hl_l1"><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span></li>        </ol>
    </div>
</div></div>
<br>Перед заменой этих байт всего лишь надо их вставить в конец обработчика<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">func1_hook<span class="hl_char">:</span></li><li class="hl_l1"><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">func1_hook_end<span class="hl_char">:</span></li><li class="hl_l0"><span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">ebp</span></li><li class="hl_l1"><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ebp</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">esp</span></li><li class="hl_l0"><span class="hl_function"><b>jmp</b></span>&nbsp;func1_entry_from_hook</li>        </ol>
    </div>
</div></div>
<br><br>Конечно, как сказал <b>kid</b>, можно сделать более универсально, использовав дизассеблер длин, поскольку не всегда функция начинается с этих байт.
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=351664&amp;user=24257&amp;forum_n=6&amp;topic=23392.html&amp;page=0&amp;anchor=15" class="addthx" data-post="351664"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Посоветуйте как лучше сделать перехват функции</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#16" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="6">
<input type="hidden" name="topic" value="23392">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=23392" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
