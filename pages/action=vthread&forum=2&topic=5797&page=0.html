<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Filemon не справляется - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Впервые такое вижу. В общем есть приложение, которое в несколько потоков дерет один файл, причем всяко разно (гуляет по оффсетам, собирает инфу, преобразует, гуляет +).  Короче нужна помощь - Filemon не справляется с задачей">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=31361'>zds</a>, <a target='_blank' href='?action=userinfo&amp;user=55991'>kris_sexy</a>, <a target='_blank' href='?action=userinfo&amp;user=3756'>==DJ==[ZLO]</a> (+7 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/red.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=2&sortBy=0&page=0.html"><b>Крэки, обсуждения</b></a> <b class=bulletHead>&#8212;&#8250;</b> Filemon не справляется</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]NaumLeNet[/b]','')">NaumLeNet</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/2212.gif" alt=""><br><span class=txtSm>Ранг: 103.3 (ветеран), 8thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.99'>Активность: 0.06<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2212">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 июля 2006 23:59 <br><script type="text/javascript">QU('NaumLeNet','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=NaumLeNet" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=2&amp;topic=5797.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Впервые такое вижу. В общем есть приложение, которое в несколько потоков дерет один файл, причем всяко разно (гуляет по оффсетам, собирает инфу, преобразует, гуляет +). 
<br>
<br>Короче нужна помощь - Filemon не справляется с задачей явно, многие моменты чтения явно упускает (под явно имеется в виду, что инфа в ехе не зашите, 100% есть в файле, но чтение ее не происходит (т.е. она не попадает ни в один прочтенный блок). В фильтр стоит лишь имя файла, поэтому все равно должно быть сколько потоков и как что делают. То ли дело в каком то внутреннем таймауте филимона, то ли у мну крыша едит.
<br>
<br>Как сделан филимон? Хук на функции работы с файлами? или иным макаром? Вот думаю может имеет смысл чиркануть небольщую утиль, которая бы хучила CreateFile, ReadFile? Или же все-таки дело не в филимоне?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=85556&amp;user=2212&amp;forum_n=2&amp;topic=5797.html&amp;page=0&amp;anchor=1" class="addthx" data-post="85556"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]Generic[/b]','')">Generic</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 32.8 (посетитель), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.09'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=5120">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 июля 2006 01:00 &middot; Поправил: Generic <br><script type="text/javascript">QU('Generic','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Generic" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=2&amp;topic=5797.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
я как ламер могу сказать своё мнение.
<br>FileMon наверное направлен больше на общую картину, нежели на точное измерение каждого байта. возможно, если он действительно &quot;пропускает&quot; потоки, то интервалы его проверок выше чем интервалы приложения, которое дерёт этот файл...
<br>ну ещё можно попробовать изменить настройки FileMon. например, вдруг вы по чистой случайности не заметили пункт меню Avanced Output. или какой-то глюк, например у меня одна из предпоследних версий FileMon и RegMon иногда отказывалась фильтровать проессы и выводила сразу все. всякое может быть, даже учитывая то что это одна из самых распростанённых программ такого плана.
<br>
<br>сорри если туплю, я уже сказал что я ламер.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=85560&amp;user=5120&amp;forum_n=2&amp;topic=5797.html&amp;page=0&amp;anchor=2" class="addthx" data-post="85560"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]tundra37[/b]','')">tundra37</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 310.8 (мудрец), 29thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.32'>Активность: 0.43<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=4072">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 июля 2006 10:52 <br><script type="text/javascript">QU('tundra37','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=tundra37" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=2&amp;topic=5797.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
<I>NaumLeNet пишет:
<br>То ли дело в каком то внутреннем таймауте филимона, то ли у мну крыша едит.  </I>
<br> Работа с файлами гораздо больше времени занимает,чем работа с памятью. У филимона есть только вывод протокола - поэтому он должен успевать и никаких таймаутов у него нет, скорее всего.
<br> Проверь, может отключил перехват каких-то дисков - я тут для экономии отключил один раз и потом долго удивлялся.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=85615&amp;user=4072&amp;forum_n=2&amp;topic=5797.html&amp;page=0&amp;anchor=3" class="addthx" data-post="85615"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]NaumLeNet[/b]','')">NaumLeNet</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/2212.gif" alt=""><br><span class=txtSm>Ранг: 103.3 (ветеран), 8thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.99'>Активность: 0.06<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2212">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 июля 2006 11:00 <br><script type="text/javascript">QU('NaumLeNet','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=NaumLeNet" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=2&amp;topic=5797.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
<b>tundra37</b>
<br>фишка в том, что чтение файла я вижу, но оно явно не полное. т.е. филимон контролит обращение к этому файлу, но не до конца. либо у меня паранойя и надо пересматривать все что накопал до этого +))
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=85621&amp;user=2212&amp;forum_n=2&amp;topic=5797.html&amp;page=0&amp;anchor=4" class="addthx" data-post="85621"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]soho[/b]','')">soho</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 30.6 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.61'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3174">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 июля 2006 11:15 <br><script type="text/javascript">QU('soho','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=soho" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=2&amp;topic=5797.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
Насколько я помню, филимон не ловит обращения к Memory Mapped файлам. Т.е. само открытие и закрытие он ловит, а вот все что происходит с ним в то время, когда он спроецирован в память пропускает.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=85624&amp;user=3174&amp;forum_n=2&amp;topic=5797.html&amp;page=0&amp;anchor=5" class="addthx" data-post="85624"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]MiraclE[/b]','')">MiraclE</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 5.6 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.82'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=2623">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 июля 2006 14:40 <br><script type="text/javascript">QU('MiraclE','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=MiraclE" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=2&amp;topic=5797.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
filemon содержит драйвер фильтер фс,точно не из-за интервалов поскольку драйвер filemon&#039;a собирает все запросы в буфер, а потом отдает по запросу приложения ,скорее тогда из за переполнения буфера
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=85676&amp;user=2623&amp;forum_n=2&amp;topic=5797.html&amp;page=0&amp;anchor=6" class="addthx" data-post="85676"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]NaumLeNet[/b]','')">NaumLeNet</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/2212.gif" alt=""><br><span class=txtSm>Ранг: 103.3 (ветеран), 8thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.99'>Активность: 0.06<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2212">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 июля 2006 15:20 &middot; Поправил: NaumLeNet <br><script type="text/javascript">QU('NaumLeNet','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=NaumLeNet" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=2&amp;topic=5797.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
С тем как филимон работает разобрался. в итоге плюнул на него и сделал все на уровне хуков. Прохучил CreateFileA/W, ReadFile, CreateFileMapping, SetFilePointer - получил потрясную картину ) Все просто как надо.
<br>
<br>Только вот вопрос один к отцам появился. Открытие файла ловлю спокойно, закрытие файла происходит через CloseHandle(hObject: THandle); stdcall; (kernel32.dll, понятное дело). Но сами понимаете, что вызовов CloseHandle своим хуком ловлю туеву хучу на протяжении работы программы. Как бы еще в момент хука определить что за хэндл пытаются закрыть? Уже у себя в программе, вне хук-либы, я могу сравнить его с хэндлом открытого файла и фильтрануть, а вот в хук-либе как быть =( Нету ли какого-нить API для определения принадлежности?
<br>
<br><I>edited</I>
<br>если хреново выразился и не ясно - то я говорю о том что CloseHandle&#039;ов туева хуча в самых разных моментах работы, там даже когда Pen / Brush или еще что-либо создается и то CloseHandle в итоге вызывается )
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=85688&amp;user=2212&amp;forum_n=2&amp;topic=5797.html&amp;page=0&amp;anchor=7" class="addthx" data-post="85688"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]tundra37[/b]','')">tundra37</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 310.8 (мудрец), 29thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.32'>Активность: 0.43<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=4072">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 июля 2006 15:34 <br><script type="text/javascript">QU('tundra37','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=tundra37" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=2&amp;topic=5797.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
<I>MiraclE пишет:
<br>тогда из за переполнения буфера </I>
<br> Но тогда информация пропадала бы случайно. Тогда надо смотреть/задавать время запроса, чтобы оценить загрузку. Да и переполнить буфер могут только асинхронные запросы - это тоже можно проследить. Обмен с ожиданием будет сам себя тормозить.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=85691&amp;user=4072&amp;forum_n=2&amp;topic=5797.html&amp;page=0&amp;anchor=8" class="addthx" data-post="85691"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]f0ma[/b]','')">f0ma</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 17.8 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.66'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3003">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 июля 2006 23:12 <br><script type="text/javascript">QU('f0ma','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=f0ma" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=2&amp;topic=5797.html&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
<I>NaumLeNet пишет:
<br>CloseHandle&#039;ов туева хуча в самых разных моментах работы </I>
<br>Из чисто теоритических соображений (допускаю, что несу полный бред):
<br>в stdio растет функция FILE * _fdopen(int handle,char * mode), наверное можно попробовать после захучивания CloseHandle сокрмить handle этой функции (если после хука можно выполнить левую функцию в контексте процесса) и что-то я сомневаюсь, чтобы Brush какой-нить в структуру не NULL возвратит.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=85786&amp;user=3003&amp;forum_n=2&amp;topic=5797.html&amp;page=0&amp;anchor=9" class="addthx" data-post="85786"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]NaumLeNet[/b]','')">NaumLeNet</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/2212.gif" alt=""><br><span class=txtSm>Ранг: 103.3 (ветеран), 8thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.99'>Активность: 0.06<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2212">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 июля 2006 23:19 <br><script type="text/javascript">QU('NaumLeNet','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=NaumLeNet" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=2&amp;topic=5797.html&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
проблема в том, что надо минимизировать временные затраты внутрях хука ) конечно можно попробывать, спасибо за задумку. как вариант сейчас думаю все-таки передать список валидных хэндлов с проинжекченную либу, чтобы прямо там проверять.
<br>
<br>тут есть специалисты по хукам? еще пара вопросов висит в воздухе. чтобы не заграмождать крякерский форум подобной чепухой - в личку, если есть возможность проконсултировать.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=85789&amp;user=2212&amp;forum_n=2&amp;topic=5797.html&amp;page=0&amp;anchor=10" class="addthx" data-post="85789"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]deNULL[/b]','')">deNULL</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 174.2 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.83'>Активность: 0.07<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=321">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 июля 2006 23:48 <br><script type="text/javascript">QU('deNULL','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=deNULL" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=2&amp;topic=5797.html&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
<I>NaumLeNet пишет:
<br>Нету ли какого-нить API для определения принадлежности? </I>
<br>OllyDebug в своем окошке Handles как-то это определяет. Покопался в нем, в соответствующем месте обнаружил использование функций ZwQuerySystemInformation, ZwDuplicateObject и ZwQueryObject. С ними попробуй поразбираться.
<br>
<br><I>NaumLeNet пишет:
<br>тут есть специалисты по хукам? еще пара вопросов висит в воздухе. чтобы не заграмождать крякерский форум подобной чепухой - в личку, если есть возможность проконсултировать. </I>
<br>Специалистом я себя не назову, но недавно с хуками пришлось возиться, так что можешь попробовать мне свои вопросы задать.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=85794&amp;user=321&amp;forum_n=2&amp;topic=5797.html&amp;page=0&amp;anchor=11" class="addthx" data-post="85794"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]NaumLeNet[/b]','')">NaumLeNet</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/2212.gif" alt=""><br><span class=txtSm>Ранг: 103.3 (ветеран), 8thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.99'>Активность: 0.06<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2212">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 июля 2006 00:08 <br><script type="text/javascript">QU('NaumLeNet','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=NaumLeNet" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=2&amp;topic=5797.html&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
<b>deNULL</b>
<br>более спасибо за наводку с хэндлами. оказывается все просто более менее ) чтобы работать с хэндлом, созданным в чужом процессе, мы копируем его с помощью ZwDuplicateObject в наш ) ну а дальше связка Query Object / SysInfo. щас реализую.
<br>
<br>вопросы по хукам оформлю более менее, пока оформляю может сам пойму как решить )
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=85797&amp;user=2212&amp;forum_n=2&amp;topic=5797.html&amp;page=0&amp;anchor=12" class="addthx" data-post="85797"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]tundra37[/b]','')">tundra37</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 310.8 (мудрец), 29thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.32'>Активность: 0.43<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=4072">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 июля 2006 08:31 <br><script type="text/javascript">QU('tundra37','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=tundra37" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=2&amp;topic=5797.html&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
<b>NaumLeNet</b>
<br> Наконец-то, вспомнил. С Консультант+ была похожая песня. Там в файле есть хвостик - zip запароленный.
<br>Тоже филимоном проверял отсутствие доступа, но мне не поверили и тоже ссылались на маппинг. Тогда я взял и просто &quot;затер&quot; это место нулями.  Программа ничего не &quot;заметила&quot;. Попробуй такой метод <img src="img/smilies/s1.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=85823&amp;user=4072&amp;forum_n=2&amp;topic=5797.html&amp;page=0&amp;anchor=13" class="addthx" data-post="85823"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]NaumLeNet[/b]','')">NaumLeNet</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/2212.gif" alt=""><br><span class=txtSm>Ранг: 103.3 (ветеран), 8thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.99'>Активность: 0.06<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2212">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 июля 2006 09:05 <br><script type="text/javascript">QU('NaumLeNet','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=NaumLeNet" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=2&amp;topic=5797.html&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
<img src="img/smilies/s1.gif" alt=""> попробовал. заметила )
<br>
<br>самое главное, что я уже вроде отписался - когда повесил хуки и все сам обработал - выявились те самые переходы и чтения в &quot;белых&quot; пятнах (даже специально построил file map как в IDA с бегунком и раскрасками +)
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=85832&amp;user=2212&amp;forum_n=2&amp;topic=5797.html&amp;page=0&amp;anchor=14" class="addthx" data-post="85832"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/red.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=2&sortBy=0&page=0.html"><b>Крэки, обсуждения</b></a> <b class=bulletHead>&#8212;&#8250;</b> Filemon не справляется</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#15" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="2">
<input type="hidden" name="topic" value="5797">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=5797" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
