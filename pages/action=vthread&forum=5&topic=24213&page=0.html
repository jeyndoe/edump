<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Как при цепочечном копировании секции, байты могут измениться дважды? - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Работаю в Олли-дебагере. У меня есть такой код, который побайтно копирует из секции 0x07340000 в секцию 0x00401000 код, размером 0x01456000 байт. Code:       046C5F25&nbsp;&nbsp;&nbsp;&nbsp;89D7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=6859'>cppasm</a>, <a target='_blank' href='?action=userinfo&amp;user=28016'>asfa</a> (+6 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/nub.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=5&sortBy=0&page=0.html"><b>Вопросы новичков</b></a> <b class=bulletHead>&#8212;&#8250;</b> Как при цепочечном копировании секции, байты могут измениться дважды?</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]Kuzya69[/b]','')">Kuzya69</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 30.1 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.16'>Активность: 0.07<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29098">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 июля 2016 02:06 <br><script type="text/javascript">QU('Kuzya69','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Kuzya69" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24213.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Работаю в Олли-дебагере.<br>У меня есть такой код, который побайтно копирует из секции 0x07340000 в секцию 0x00401000 код, размером 0x01456000 байт.<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_number">046C5F25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">89D7</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>MOV</b></span>&nbsp;<span class="hl_registr">EDI</span><span class="hl_char">,</span><span class="hl_registr"><b>EDX</b></span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; edx=00401000</span></li><li class="hl_l1"><span class="hl_number">046C5F27</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">89CE</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>MOV</b></span>&nbsp;<span class="hl_registr">ESI</span><span class="hl_char">,</span><span class="hl_registr"><b>ECX</b></span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; ecx=07340000</span></li><li class="hl_l0"><span class="hl_number">046C5F29</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">89C1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>MOV</b></span>&nbsp;<span class="hl_registr">ECX</span><span class="hl_char">,</span><span class="hl_registr"><b>EAX</b></span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; eax=01456000,(Pered Copy section)</span></li><li class="hl_l1"><span class="hl_number">046C5F2B</span>&nbsp;&nbsp;&nbsp;&nbsp;F3<span class="hl_char">:</span>A4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>REP</b></span>&nbsp;<span class="hl_function"><b>MOVS</b></span>&nbsp;<span class="hl_function"><b>BYTE</b></span>&nbsp;<span class="hl_function"><b>PTR</b></span>&nbsp;<span class="hl_registr">ES</span><span class="hl_char">:</span><span class="hl_char">[</span><span class="hl_registr">EDI</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_function"><b>BYTE</b></span>&nbsp;<span class="hl_function"><b>PTR</b></span>&nbsp;<span class="hl_registr">DS</span><span class="hl_char">:</span><span class="hl_char">[</span><span class="hl_registr">ESI</span><span class="hl_char">]</span></li><li class="hl_l0"><span class="hl_number">046C5F2D</span>&nbsp;&nbsp;&nbsp;&nbsp;C685&nbsp;<span class="hl_number">5C1C2B1C</span>&nbsp;<span class="hl_number">56</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>MOV</b></span>&nbsp;<span class="hl_function"><b>BYTE</b></span>&nbsp;<span class="hl_function"><b>PTR</b></span>&nbsp;<span class="hl_registr">SS</span><span class="hl_char">:</span><span class="hl_char">[</span><span class="hl_registr">EBP</span><span class="hl_char">+</span>0x1B1C2D4B<span class="hl_char">]</span><span class="hl_char">,</span>0x34&nbsp;&nbsp;<span class="hl_comment">; (Posle Copy section)</span></li>        </ol>
    </div>
</div></div>
<br>Ставлю железный брейкпоинт на запись дворда по адресу 0x00492540 (База+смещение = 0x00400000+0x00092540). Когда выполнение останавливается на записи в этот адрес, то при помощи F7 прослеживаю записываемые байты. Они такие-же как по такому-же смещению в исходной секции. (Ну тут все верно, цепочечная операция скопировала байты). Далее ставлю железный брейкпоинт на исполнение кода, на адрес 0х046C5F2D (следующий за цепочечной операцией адрес) . Жму кнопку Play (F9).<br>Выполнение останавливается после копирования, но тот дворд почему-то изменился. Причем брейкпоинт на повторную запись не сработал. <br>Экспериментальным путем выяснил:<br>1) Копируемая секция вначале, на одну десятую часть забита значащими байтами, остальное нулевые байты.<br>2) Повторное изменение контроллируемого дворда происходит после копирования примерно половины всей секции. Точное количество скопированных байт, перед повторным изменением дворда, вычислить не получается, оно всегда разное (скорее всего зависит от времени копирования нулевых байт).<br>Вопрос в том, как отловить эту повторную перезапись, моего дворда? То-есть как в отладчике попасть в этот код, который перезаписывает мой дворд? Если я даже примерно не знаю где он находится.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=365896&amp;user=29098&amp;forum_n=5&amp;topic=24213.html&amp;page=0&amp;anchor=1" class="addthx" data-post="365896"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]-=AkaBOSS=-[/b]','')">-=AkaBOSS=-</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/26242.png" alt=""><br><span class=txtSm>Ранг: 150.3 (ветеран), 175thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.88'>Активность: 0.16<span style='color:red'>&searr;</span>0.07</span><br>Статус: <a href="action=userinfo&amp;user=26242">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 июля 2016 02:58 &middot; Поправил: -=AkaBOSS=- <br><script type="text/javascript">QU('-=AkaBOSS=-','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=-=AkaBOSS=-" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24213.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
<I>Kuzya69 пишет:<br>но тот дворд почему-то изменился. Причем брейкпоинт на повторную запись не сработал.  </I><br>изменился на что конкретно? на то что копировал, или на что? а окружающие его данные изменились?<br>и вообще - проблема состоит в том что бряк не работает, или в том, что дворд откуда-то меняется и неясно кто это сделал?<br><br>на каком этапе загрузки модуля выполняется упомянутое копирование?<br><br><br><I>Kuzya69 пишет:<br>Точное количество скопированных байт, перед повторным изменением дворда, вычислить не получается, оно всегда разное </I><br>без тестового модуля сложно вкурить тему, но вероятней всего это процессорная оптимизация блочной операции.<br>проц посмотрел на побайтовое копирование такого блока <strike>как на говно</strike>, посмотрел на счётчик байт, и малость ускорил дело чтоб гору чайной ложкой не черпать.<br><br>у интела сказано так:<br><i class=x>P6 family processors are unable to report data breakpoints exactly for the REP MOVS <br>and REP STOS instructions until the completion of the iteration after the iteration in <br>which the breakpoint occurred.</i><br><br>говоря по-русски -  пока блок не докопирует, брейкпоинты идут лесом<br><br><br><I>Kuzya69 пишет:<br>Жму кнопку Play (F9). </I><br>..и раздаётся музыка <img src="img/smilies/s5.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=365898&amp;user=26242&amp;forum_n=5&amp;topic=24213.html&amp;page=0&amp;anchor=2" class="addthx" data-post="365898"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]Kuzya69[/b]','')">Kuzya69</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 30.1 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.16'>Активность: 0.07<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29098">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 июля 2016 12:53 &middot; Поправил: Kuzya69 <br><script type="text/javascript">QU('Kuzya69','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Kuzya69" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24213.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
<I>-=AkaBOSS=- пишет:<br>изменился на что конкретно?на то что копировал, или на что? </I><br>Программа ломанная, поэтому это второе изменение дворда, происходит только в ломанной программе. В оригинальной проге один jmp, а в ломанной другой. Первое изменение дворда в jmp-е, происходит за счет цепочечной операции, как это и задумано в оригинале, а вот второе изменение делается каким-то непонятным мне способом. Как-бы на это можно и забить. Я уже понял как другой хакер сломал программу. Но любопытство не дает покоя. Как он умудрился прервать цепочечную команду, изменить дворд, и потом опять запустить цепочечную команду?<br><I>-=AkaBOSS=- пишет:<br>а окружающие его данные изменились? </I><br>Нет. изменились только 4 байта в одном jmp-е.<br><I>-=AkaBOSS=- пишет:<br>и вообще - проблема состоит в том что бряк не работает, или в том, что дворд откуда-то меняется и неясно кто это сделал? </I><br>Ну, что бряк не сработал, как-бы важно, но во вторую очередь. А вот как отловить код, который делает эту вторую подмену?<br><I>-=AkaBOSS=- пишет:<br>на каком этапе загрузки модуля выполняется упомянутое копирование? </I><br>Я не очень сильный реверсер, но на сколько я понимаю это последний этап распаковки, перед выходом на OEP.<br><I>-=AkaBOSS=- пишет:<br>говоря по-русски - пока блок не докопирует, брейкпоинты идут лесом </I><br>Так ведь первое изменение ловится на брейкпоинт, не ловится только второе.<br><I>-=AkaBOSS=- пишет:<br>Жму кнопку Play (F9). <br>..и раздаётся музыка  </I><br>Ну если она на обозначение кнопки Play в бытовой аппаратуре похожа. Так проще объяснить, что делаю. <img src="img/smilies/s1.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=365909&amp;user=29098&amp;forum_n=5&amp;topic=24213.html&amp;page=0&amp;anchor=3" class="addthx" data-post="365909"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]-=AkaBOSS=-[/b]','')">-=AkaBOSS=-</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/26242.png" alt=""><br><span class=txtSm>Ранг: 150.3 (ветеран), 175thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.88'>Активность: 0.16<span style='color:red'>&searr;</span>0.07</span><br>Статус: <a href="action=userinfo&amp;user=26242">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 июля 2016 14:16 <br><script type="text/javascript">QU('-=AkaBOSS=-','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=-=AkaBOSS=-" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24213.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
<I>Kuzya69 пишет:<br>А вот как отловить код, который делает эту вторую подмену? </I><br>как вариант - поставь запрет на запись на всю страницу и жди где упадёт.<br><br>Кстати, насколько я знаю, WriteProcessMemory пишет память через ядрёные функции напрямую, и отловить её из перезаписываемого процесса хрен получится. Мож так оно и сделано?<br><br>и еще -  <I>Kuzya69 пишет:<br>Ставлю железный брейкпоинт на запись дворда </I><br>железные бряки зависят от отладочных регистров, которые хранятся в контексте, а контекст у каждого треда свой. Запись может из другого треда вестись, попробуй memory breakpoint ставить.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=365913&amp;user=26242&amp;forum_n=5&amp;topic=24213.html&amp;page=0&amp;anchor=4" class="addthx" data-post="365913"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]Kuzya69[/b]','')">Kuzya69</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 30.1 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.16'>Активность: 0.07<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29098">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 июля 2016 14:56 &middot; Поправил: Kuzya69 <br><script type="text/javascript">QU('Kuzya69','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Kuzya69" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24213.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
<I>-=AkaBOSS=- пишет:<br>как вариант - поставь запрет на запись на всю страницу и жди где упадёт. </I><br>Дык упадет сразу-же, ведь цепочечная операция сама пишет в эту страницу.<br><I>-=AkaBOSS=- пишет:<br>...попробуй memory breakpoint ставить.  </I><br>Ставил и memory breakpoint, то-же самое, не ловится.<br><I>-=AkaBOSS=- пишет:<br>WriteProcessMemory пишет память через ядрёные функции напрямую, и отловить её из перезаписываемого процесса хрен получится </I><br>Жаль, а так хотелось код посмотреть, чтоб понять как там адрес фикса определяется.<br><br>Кстати, только-что трейс этой цепочечной операции закончился, второй перезаписи дворда не произошло. Оно произошло где-то позже, после того как запустил прогу на дальнейшее исполнение. Может это быть реализовано с помощью Wait-функций? Может код ждет какого-то события, типа бездействия, или долгой работы не в 3-м кольце, и сразу включается обработчик события?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=365915&amp;user=29098&amp;forum_n=5&amp;topic=24213.html&amp;page=0&amp;anchor=5" class="addthx" data-post="365915"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]-=AkaBOSS=-[/b]','')">-=AkaBOSS=-</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/26242.png" alt=""><br><span class=txtSm>Ранг: 150.3 (ветеран), 175thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.88'>Активность: 0.16<span style='color:red'>&searr;</span>0.07</span><br>Статус: <a href="action=userinfo&amp;user=26242">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 июля 2016 19:47 &middot; Поправил: -=AkaBOSS=- <br><script type="text/javascript">QU('-=AkaBOSS=-','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=-=AkaBOSS=-" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24213.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
<I>Kuzya69 пишет:<br>Дык упадет сразу-же, ведь цепочечная операция сама пишет в эту страницу. </I><br>ну дык теста ради - не пиши ничего туда. пока просто лови обращения к адресу. коль прога уже ломаная, то оно и так перезапишется.<br><br><I>Kuzya69 пишет:<br>второй перезаписи дворда не произошло. Оно произошло где-то позже </I><br><I>Kuzya69 пишет:<br>на сколько я понимаю это последний этап распаковки, перед выходом на OEP </I><br>а модули какие-нибудь грузятся в это время? мож прога импорт настраивала, а в какой-то её длл инжект патча висит?  в принципе, удобный вариант, так как заранее можно знать состояние проги в момент загрузки длл.<br><br>вообще, если всё так сложно и неясно - сделай свой инжект кода <b>перед</b> этим злоедучим двордом, и выполни нужный тебе код в другом месте.<br><br>ну или как я уже подсказывал - попробуй софт бряки на выполнение WriteProcessMemory/NtWriteVirtualMemory, авось сработает<br><br> <I>Kuzya69 пишет:<br>понять как там адрес фикса определяется </I><br>чи ни высшая математика - hModule+rva. попробуй кстати тупой вариант - поищи адрес/рва своего дворда через CheatEngine/Artmoney. авось и выловишь чего умное.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=365917&amp;user=26242&amp;forum_n=5&amp;topic=24213.html&amp;page=0&amp;anchor=6" class="addthx" data-post="365917"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/nub.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=5&sortBy=0&page=0.html"><b>Вопросы новичков</b></a> <b class=bulletHead>&#8212;&#8250;</b> Как при цепочечном копировании секции, байты могут измениться дважды?</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#7" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="5">
<input type="hidden" name="topic" value="24213">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=24213" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
