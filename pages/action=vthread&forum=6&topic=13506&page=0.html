<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>GetMessage. Отрисовка окна. - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Столкнулся с такой проблемой. Как-то заметил, что откомпилированная программа жрет много памяти. Зашел в процессы (у меня через TaskInfo) и вот, что увидел на закладке Thread: Thread Stack::                       Symbol:         ">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=2094'>2nd</a>, <a target='_blank' href='?action=userinfo&amp;user=33192'>morgot</a>, <a target='_blank' href='?action=userinfo&amp;user=8605'>Rio</a>, <a target='_blank' href='?action=userinfo&amp;user=27081'>CDK123</a>, <a target='_blank' href='?action=userinfo&amp;user=31361'>zds</a>, <a target='_blank' href='?action=userinfo&amp;user=55995'>tyns777</a>, <a target='_blank' href='?action=userinfo&amp;user=10534'>tihiy_grom</a> (+5 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> GetMessage. Отрисовка окна.</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]Mavlyudov[/b]','')">Mavlyudov</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/3355.jpg" alt=""><br><span class=txtSm>Ранг: 156.2 (ветеран), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.53'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3355">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 января 2009 01:08 &middot; Поправил: Mavlyudov <br><script type="text/javascript">QU('Mavlyudov','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Mavlyudov" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13506.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Столкнулся с такой проблемой.<br>Как-то заметил, что откомпилированная программа <br>жрет много памяти. Зашел в процессы (у меня через TaskInfo)<br>и вот, что увидел на закладке Thread:<br><br>Thread Stack::                                             <br>Symbol:                        <br>user32 ! PeekMessageA() + 0xa5   <br>a + 16A3                        <br>a + 16F6                         <br>a + 2466                        <br><br>По разным адресам(или смещениям? например 0xa5,0x95,..) все время<br>появляется и исчезает PeekMessageA и еще какая-то процедура.<br>причем загрузка процессора до 80%.<br><br>Посмотрел, например, для блокнота. Там(в стеке) висит TranslateMEssage.<br>И не меняется.<br>Программа, которую компилирую, использует модуль WinCrt.<br>В этом модуле прорисовка окна происходит как-то не совсем понятно.<br>Всем изветно, что создавать окно нужно примено так(последовательность):<br><br>Заполнение структуры WinClass (типа TWndClass);<br><br>RegisterClass(WinClass);<br><br>Handle := CreateWindowEx(0, &#039;Class&#039;, &#039;Form&#039;,<br>WS_OVERLAPPEDWINDOW or<br>WS_VISIBLE, ....);<br><br>while(GetMessage(Msg, Handle, 0, 0)) do<br>begin<br> TranslateMessage(Msg); //прием сообщений<br> DispatchMessage(Msg); //удаление сообщений из очереди<br>end;<br><br>Но в модуле WinCrt это сделано иначе(см. листинг1). Там создание окна происходит<br>в отдельной процедуре InitWinCrt, а обработка сообщений в другой процедуре (KeyPressed).<br>Причем не через GetMessage, а через PeekMessage. Поэтому-о я и думаю, что PeekMessage,<br>который вск время воявляется в стеке в диспетчере процессов это и есть тот, что <br>крутится в цикле в процедуре ReadKey.<br><br><br>Далее я создаю программу (листинг2). И в этой программе мне нужно сделать, чтобы<br>программа ожидала от пользователя нажатие клавиши, что я и делаю(CH:=READKEY;).<br><br>Но при запуске, сразу видно, чо загрузка процессора очень большая.<br>Вот теперь и возникает вопрос: можно ли как-то оптимизировать программу<br>(точнее модуль wincrt) так, чтобы использовать минимум ресурсов и не загружать<br>так сильно процессор? Возможно(как один из вариантов) даже использовать<br>вместо readkey что-то другое(альтернативную процедуру), только я не знаю что.<br>бУду рад советам. Модуль и программу прикрепляю.<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"></li><li class="hl_l1"><span class="hl_char">&lt;</span>b<span class="hl_char">&gt;</span>Листинг1<span class="hl_char">&lt;</span><span class="hl_char">/</span>b<span class="hl_char">&gt;</span></li><li class="hl_l0">var</li><li class="hl_l1">CrtWindow<span class="hl_char">:</span>&nbsp;HWnd<span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span></li><li class="hl_l1"></li><li class="hl_l0">procedure&nbsp;InitWinCrt<span class="hl_comment">;</span></li><li class="hl_l1">begin</li><li class="hl_l0"><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span></li><li class="hl_l1">&nbsp;CrtWindow&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;CreateWindow<span class="hl_char">(</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"></li><li class="hl_l1">&nbsp;ShowWindow<span class="hl_char">(</span>CrtWindow<span class="hl_char">,</span>&nbsp;CmdShow<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;UpdateWindow<span class="hl_char">(</span>CrtWindow<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l0"></li><li class="hl_l1"></li><li class="hl_l0">function&nbsp;KeyPressed<span class="hl_char">:</span>&nbsp;Boolean<span class="hl_comment">;</span></li><li class="hl_l1">var</li><li class="hl_l0">&nbsp;&nbsp;M<span class="hl_char">:</span>&nbsp;TMsg<span class="hl_comment">;</span></li><li class="hl_l1">begin</li><li class="hl_l0">&nbsp;&nbsp;InitWinCrt<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>while</b></span>&nbsp;PeekMessage<span class="hl_char">(</span>M<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span>&nbsp;<span class="hl_char">,</span>pm_Remove<span class="hl_char">)</span>&nbsp;do</li><li class="hl_l0">&nbsp;&nbsp;begin</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;M<span class="hl_char">.</span>Message&nbsp;<span class="hl_char">=</span>&nbsp;wm_Quit&nbsp;then&nbsp;Terminate<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;TranslateMessage<span class="hl_char">(</span>M<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;DispatchMessage<span class="hl_char">(</span>M<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;KeyPressed&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;KeyCount&nbsp;<span class="hl_char">&gt;</span>&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l1"></li><li class="hl_l0"></li><li class="hl_l1">function&nbsp;ReadKey<span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>Char</b></span><span class="hl_comment">;</span></li><li class="hl_l0">begin</li><li class="hl_l1">&nbsp;&nbsp;TrackCursor<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_function"><b>not</b></span>&nbsp;KeyPressed&nbsp;then</li><li class="hl_l1">&nbsp;&nbsp;begin</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;Reading&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;<span class="hl_function"><b>True</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;Focused&nbsp;then&nbsp;ShowCursor<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;until&nbsp;KeyPressed<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;Focused&nbsp;then&nbsp;HideCursor<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;Reading&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;<span class="hl_function"><b>False</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;ReadKey&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;KeyBuffer<span class="hl_char">[</span><span class="hl_number">0</span><span class="hl_char">]</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function">Dec</span><span class="hl_char">(</span>KeyCount<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;Move<span class="hl_char">(</span>KeyBuffer<span class="hl_char">[</span><span class="hl_number">1</span><span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;KeyBuffer<span class="hl_char">[</span><span class="hl_number">0</span><span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;KeyCount<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div>
<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"></li><li class="hl_l1"><span class="hl_char">&lt;</span>b<span class="hl_char">&gt;</span>Листинг2<span class="hl_char">&lt;</span><span class="hl_char">/</span>b<span class="hl_char">&gt;</span></li><li class="hl_l0"><span class="hl_function"><b>uses</b></span>&nbsp;wincrt<span class="hl_comment">;</span></li><li class="hl_l1">VAR</li><li class="hl_l0"><span class="hl_registr">CH</span><span class="hl_char">:</span><span class="hl_function"><b>CHAR</b></span><span class="hl_comment">;</span></li><li class="hl_l1">BEGIN</li><li class="hl_l0">INITWINCRT<span class="hl_comment">;</span></li><li class="hl_l1"><span class="hl_registr">CH</span><span class="hl_char">:</span><span class="hl_char">=</span>READKEY<span class="hl_comment">;</span></li><li class="hl_l0">DONEWINCRT<span class="hl_comment">;</span></li><li class="hl_l1"><span class="hl_function">END</span><span class="hl_char">.</span></li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=216298&amp;user=3355&amp;forum_n=6&amp;topic=13506.html&amp;page=0&amp;anchor=1" class="addthx" data-post="216298"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]AlexZ[/b]','')">AlexZ</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 203.3 (наставник)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.9'>Активность: 0.22<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=175">Участник</a><br><font color=blue>UPX Killer -d</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 января 2009 13:32 &middot; Поправил: AlexZ <br><script type="text/javascript">QU('AlexZ','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=AlexZ" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13506.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
Или я не понимаю новых технологий, или листинг 1 - чушь.<br><br>Строка 20 - при каждом обращении к <b>KeyPressed</b> вызывается <b>InitWinCrt</b>.<br><br>Потом, происходит постоянная дрючка <b>PeekMessage</b>, вот её описание:<br><I>function PeekMessage(var Msg: TMsg; Wnd: HWnd; MsgFilterMin, MsgFilterMax: Word): Bool;<br><br>Пpовеpяет очеpедь пpикладной задачи на сообщение и копиpует его в Msg. Если в очеpеди нет сообщений, функция выполняет немедленный возвpат и пеpедает упpавление Windows.<br><br>Параметры:<br>Msg: Пpинимающая стpуктуpа TMsg.<br>Wnd: Окно назначения сообщения, или 0 для любого окна в пpикладной задаче, или -1 для сообщений, напpавленных функцией PostMessage.<br>MsgFilterMin: Наименьший идентификатоp сообщения или 0, если пpедел отсутствует.<br>MsgFilterMax: Наибольший идентификатоp сообщения или 0, если пpедел отсутствует.<br>RemoveMsg: Один или несколько паpаметpов: pm_NoRemove, pm_NoYield или pm_Remove. См. pаздел &quot;Паpаметpы сообщений, pm_&quot; в главе 1.<br><br>Возвpащаемое значение:<br>Не нуль, если сообщение имеется; 0 - если нет.<br><br>См. также: GetMessage, WaitMessage</I><br><br><br>Функцией <b>ReadKey</b> вы снова продрючиваете весь клубок хитрозадых вызовов... Ну кто же так пишет?
<br><br><font size="1"><i>-----<br>Я медленно снимаю с неё UPX... *FF_User*</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=216329&amp;user=175&amp;forum_n=6&amp;topic=13506.html&amp;page=0&amp;anchor=2" class="addthx" data-post="216329"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]AlexZ[/b]','')">AlexZ</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 203.3 (наставник)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.9'>Активность: 0.22<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=175">Участник</a><br><font color=blue>UPX Killer -d</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 января 2009 13:42 <br><script type="text/javascript">QU('AlexZ','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=AlexZ" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13506.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
Можно поставить где-нибудь в функции READKEY задержку по Sleep(1) - юзер не заметит тормозов, а сообщения из очереди никуда не денутся.
<br><br><font size="1"><i>-----<br>Я медленно снимаю с неё UPX... *FF_User*</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=216331&amp;user=175&amp;forum_n=6&amp;topic=13506.html&amp;page=0&amp;anchor=3" class="addthx" data-post="216331"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]Mavlyudov[/b]','')">Mavlyudov</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/3355.jpg" alt=""><br><span class=txtSm>Ранг: 156.2 (ветеран), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.53'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3355">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 января 2009 18:04 &middot; Поправил: Mavlyudov <br><script type="text/javascript">QU('Mavlyudov','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Mavlyudov" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13506.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
<I>AlexZ пишет:<br>Или я не понимаю новых технологий, или листинг 1 - чушь.  </I><br>Исходниу WinCrt.pas щел вместе с Borland Pascal или TPW - не помню точно<br><br>Пробовал откомпилировать на делфи(смысла нет, но все же), компилирует, но не работает программа.<br>Думаю, нужно как-то разобраться с отрисовкой окна.<br>А также как-то переделать процедуру READKEY, потому что мне в моей программе эта процедура нужна.<br>Программа должна ожидать от пользователя нажатия клавиш все время.<br><br>В архиве a.exe и исходники (a.PAS, wincrt.PAS) <br><br><img src="img/attach.gif" alt=""> <a href="./files/ce52_05.01.2009_CRACKLAB.rU.tgz">ce52_05.01.2009_CRACKLAB.rU.tgz</a> - CRT.rar
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=216360&amp;user=3355&amp;forum_n=6&amp;topic=13506.html&amp;page=0&amp;anchor=4" class="addthx" data-post="216360"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]Mavlyudov[/b]','')">Mavlyudov</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/3355.jpg" alt=""><br><span class=txtSm>Ранг: 156.2 (ветеран), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.53'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3355">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 марта 2009 22:22 <br><script type="text/javascript">QU('Mavlyudov','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Mavlyudov" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13506.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
<b>AlexZ</b><br>Вот, ты был прав по поводу Sleep(1). Вот, куда я вставил:<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"></li><li class="hl_l1">function&nbsp;ReadKey<span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>Char</b></span><span class="hl_comment">; </span></li><li class="hl_l0">begin&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;TrackCursor<span class="hl_comment">; </span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_function"><b>not</b></span>&nbsp;KeyPressed&nbsp;then&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;begin&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;Reading&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;<span class="hl_function"><b>True</b></span><span class="hl_comment">; </span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;Focused&nbsp;then&nbsp;ShowCursor<span class="hl_comment">; </span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;</li><li class="hl_l1">SLEEP<span class="hl_char">(</span><span class="hl_number">1</span><span class="hl_char">)</span><span class="hl_comment">; </span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;until&nbsp;KeyPressed<span class="hl_comment">; </span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;Focused&nbsp;then&nbsp;HideCursor<span class="hl_comment">; </span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;Reading&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;<span class="hl_function"><b>False</b></span><span class="hl_comment">; </span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>end</b></span><span class="hl_comment">; </span></li><li class="hl_l0">&nbsp;&nbsp;ReadKey&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;KeyBuffer<span class="hl_char">[</span><span class="hl_number">0</span><span class="hl_char">]</span><span class="hl_comment">; </span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function">Dec</span><span class="hl_char">(</span>KeyCount<span class="hl_char">)</span><span class="hl_comment">; </span></li><li class="hl_l0">&nbsp;&nbsp;Move<span class="hl_char">(</span>KeyBuffer<span class="hl_char">[</span><span class="hl_number">1</span><span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;KeyBuffer<span class="hl_char">[</span><span class="hl_number">0</span><span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;KeyCount<span class="hl_char">)</span><span class="hl_comment">; </span></li><li class="hl_l1"><span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div>
<br><br>Хм..Получается, что &quot;приостанавливает выполнение текущей нити&quot; на 1 мс.<br>Но все-таки заметны задержки. Например, при масштабировании или повороте изображения в программе, задержка чувствуется.<br>Может быть можно добиться лучшего результата какой-то другой функцией?<br>Думаю, что функция MsgWaitForMultipleObjects особо ничего нового не даст по сравнению со sleep.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=224621&amp;user=3355&amp;forum_n=6&amp;topic=13506.html&amp;page=0&amp;anchor=5" class="addthx" data-post="224621"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]Valemox[/b]','')">Valemox</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 116.5 (ветеран), 3thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.8'>Активность: 0.07<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=18198">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 марта 2009 22:47 &middot; Поправил: Valemox <br><script type="text/javascript">QU('Valemox','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Valemox" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13506.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
<I>Mavlyudov пишет:<br>Думаю, что функция MsgWaitForMultipleObjects особо ничего нового не даст по сравнению со sleep. </I><br>Думаю, что здесь ты всеж не прав, т.к. MsgWaitForMultipleObjects, способна &quot;просыпаться&quot;, когда в очереди потока появляется новое сообщение и это значительнее луче, чем убогий Sleep.<br><b>вличко</b>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=224627&amp;user=18198&amp;forum_n=6&amp;topic=13506.html&amp;page=0&amp;anchor=6" class="addthx" data-post="224627"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]Mavlyudov[/b]','')">Mavlyudov</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/3355.jpg" alt=""><br><span class=txtSm>Ранг: 156.2 (ветеран), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.53'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3355">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 марта 2009 00:27 &middot; Поправил: Mavlyudov <br><script type="text/javascript">QU('Mavlyudov','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Mavlyudov" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13506.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
<b>Valemox</b><br>Т.к. без sleep прога загружает процессор всё время, то логично предположить, что сообщения приходят в очередь постоянно. Подскажи, как правильно заюзать MsgWaitForMultipleObjects, чтобы не обломаться.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=224651&amp;user=3355&amp;forum_n=6&amp;topic=13506.html&amp;page=0&amp;anchor=7" class="addthx" data-post="224651"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> GetMessage. Отрисовка окна.</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#8" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="6">
<input type="hidden" name="topic" value="13506">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=13506" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
