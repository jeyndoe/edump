<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Перехват прерываний и исключений - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Руководствуясь Хоглундом и Батлером на тему перехват прерываний и исключений , написать и запустить драйвер получается но перехват не выходит, пытался перехватить как 0x04 OF так и 0x13 ошибки доступа к памяти, запускал на VB xp">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=40382'>jinoweb</a>, <a target='_blank' href='?action=userinfo&amp;user=26261'>bartolomeo</a>, <a target='_blank' href='?action=userinfo&amp;user=1533'>rmn</a> (+5 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Перехват прерываний и исключений</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> .  <b>1</b> . <a href="action=vthread&amp;forum=6&amp;topic=22388&amp;page=1.html">2</a> . <a href="action=vthread&amp;forum=6&amp;topic=22388&amp;page=2.html">3</a> . <a href="action=vthread&amp;forum=6&amp;topic=22388&amp;page=3.html">4</a> . <a href="action=vthread&amp;forum=6&amp;topic=22388&amp;page=4.html">5</a> . <a href="action=vthread&amp;forum=6&amp;topic=22388&amp;page=5.html">6</a> . <a href="action=vthread&amp;forum=6&amp;topic=22388&amp;page=6.html">7</a> . <a href="action=vthread&amp;forum=6&amp;topic=22388&amp;page=1.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]MickeyBlueEyes[/b]','')">MickeyBlueEyes</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 51.6 (постоянный), 3thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.7'>Активность: 0.04<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=36083">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 декабря 2013 15:35 <br><script type="text/javascript">QU('MickeyBlueEyes','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=MickeyBlueEyes" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22388&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Руководствуясь Хоглундом и Батлером на тему перехват прерываний и исключений , написать и запустить драйвер получается но перехват не выходит, пытался перехватить как 0x04 OF так и 0x13 ошибки доступа к памяти, запускал на VB xp 32 с одним процессором, но увы, не опытность даёт знать, вот код на Си который вышел:<br><br>init.c:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">#include&nbsp;<span class="hl_char">&lt;</span>ntddk<span class="hl_char">.</span>h<span class="hl_char">&gt;</span></li><li class="hl_l1">#include&nbsp;<span class="hl_quote">&quot;IDT.c&quot;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">#define&nbsp;MAKELONG<span class="hl_char">(</span>&nbsp;a&nbsp;<span class="hl_char">,</span>&nbsp;b&nbsp;<span class="hl_char">)</span><span class="hl_char">(</span>&nbsp;<span class="hl_char">(</span>&nbsp;LONG&nbsp;<span class="hl_char">)</span>&nbsp;<span class="hl_char">(</span>&nbsp;<span class="hl_char">(</span>&nbsp;<span class="hl_char">(</span>&nbsp;USHORT&nbsp;<span class="hl_char">)</span>&nbsp;<span class="hl_char">(</span>&nbsp;a&nbsp;<span class="hl_char">)</span>&nbsp;<span class="hl_char">)</span>&nbsp;<span class="hl_char">|</span>&nbsp;<span class="hl_char">(</span>&nbsp;<span class="hl_char">(</span>&nbsp;ULONG&nbsp;<span class="hl_char">)</span>&nbsp;<span class="hl_char">(</span>&nbsp;<span class="hl_char">(</span>&nbsp;USHORT&nbsp;<span class="hl_char">)</span>&nbsp;<span class="hl_char">(</span>&nbsp;b&nbsp;<span class="hl_char">)</span>&nbsp;<span class="hl_char">)</span>&nbsp;<span class="hl_char">)</span>&nbsp;<span class="hl_char">&lt;</span><span class="hl_char">&lt;</span>&nbsp;<span class="hl_number">16</span>&nbsp;<span class="hl_char">)</span>&nbsp;<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">#define&nbsp;NT_SYSTEM_SERVICE_INT&nbsp;0x13</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">ULONG&nbsp;RealSystemPtr<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>void</b></span>&nbsp;MyInt<span class="hl_char">(</span><span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__asm</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">pushad</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">pushfd</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">fs</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr"><b>bx</b></span>&nbsp;<span class="hl_char">,</span>&nbsp;0x30</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr"><b>fs</b></span>&nbsp;<span class="hl_char">,</span>&nbsp;<span class="hl_registr">bx</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">ds</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">es</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DbgPrint<span class="hl_char">(</span><span class="hl_quote">&quot;Is MyInt&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__asm</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_registr">es</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_registr">ds</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_registr">fs</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">popfd</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">popad</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jmp</b></span>&nbsp;RealSystemPtr<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">}</li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>void</b></span>&nbsp;Hook<span class="hl_char">(</span><span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IDTINFO&nbsp;idt_info<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IDTENTRY&nbsp;<span class="hl_char">*</span>&nbsp;idt_entries<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IDTENTRY&nbsp;<span class="hl_char">*</span>&nbsp;int2_entry<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__asm&nbsp;<span class="hl_function"><b>sidt</b></span>&nbsp;idt_info</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idt_entries&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">(</span>&nbsp;IDTENTRY&nbsp;<span class="hl_char">*</span>&nbsp;<span class="hl_char">)</span>&nbsp;MAKELONG<span class="hl_char">(</span>&nbsp;idt_info<span class="hl_char">.</span>LowIDTbase&nbsp;<span class="hl_char">,</span>&nbsp;idt_info<span class="hl_char">.</span>HiIDTbase&nbsp;<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RealSystemPtr&nbsp;<span class="hl_char">=</span>&nbsp;MAKELONG<span class="hl_char">(</span>&nbsp;idt_entries<span class="hl_char">[</span>&nbsp;NT_SYSTEM_SERVICE_INT&nbsp;<span class="hl_char">]</span><span class="hl_char">.</span>LowOffset&nbsp;<span class="hl_char">,</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idt_entries</span><span class="hl_char">[</span>&nbsp;NT_SYSTEM_SERVICE_INT&nbsp;<span class="hl_char">]</span><span class="hl_char">.</span>HiOffset&nbsp;<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int2_entry&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">&amp;</span>idt_entries<span class="hl_char">[</span>&nbsp;NT_SYSTEM_SERVICE_INT&nbsp;<span class="hl_char">]</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__asm</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">cli</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lea</b></span>&nbsp;<span class="hl_registr"><b>eax</b></span>&nbsp;<span class="hl_char">,</span>&nbsp;MyInt</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr"><b>ebx</b></span>&nbsp;<span class="hl_char">,</span>&nbsp;int2_entry</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_char">[</span>&nbsp;<span class="hl_registr"><b>ebx</b></span>&nbsp;<span class="hl_char">]</span>&nbsp;<span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>ax</b></span>&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>shr</b></span>&nbsp;<span class="hl_registr"><b>eax</b></span>&nbsp;<span class="hl_char">,</span>&nbsp;<span class="hl_number">16</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_char">[</span>&nbsp;<span class="hl_registr"><b>ebx</b></span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">6</span>&nbsp;<span class="hl_char">]</span>&nbsp;<span class="hl_char">,</span>&nbsp;<span class="hl_registr">ax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">sti</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">}&nbsp;</li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_function"><b>void</b></span>&nbsp;DriverUnload<span class="hl_char">(</span>&nbsp;<span class="hl_function"><b>IN</b></span>&nbsp;PDRIVER_OBJECT&nbsp;DriverObject&nbsp;<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">NTSTATUS&nbsp;DriverEntry<span class="hl_char">(</span>&nbsp;<span class="hl_function"><b>IN</b></span>&nbsp;PDRIVER_OBJECT&nbsp;DriverObject&nbsp;<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>IN</b></span>&nbsp;PUNICODE_STRING&nbsp;RegPath&nbsp;<span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DriverObject&nbsp;<span class="hl_char">-</span><span class="hl_char">&gt;</span>&nbsp;DriverUnload&nbsp;<span class="hl_char">=</span>&nbsp;DriverUnload<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Hook<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;STATUS_SUCCESS<span class="hl_comment">;</span></li><li class="hl_l1">}</li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>void</b></span>&nbsp;DriverUnload<span class="hl_char">(</span>&nbsp;<span class="hl_function"><b>IN</b></span>&nbsp;PDRIVER_OBJECT&nbsp;DriverObject&nbsp;<span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DbgPrint<span class="hl_char">(</span><span class="hl_quote">&quot;Bye!\n&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">}</li>        </ol>
    </div>
</div></div>
<br><br>IDT.c<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">typedef&nbsp;struct</li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USHORT&nbsp;IDTLimit<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USHORT&nbsp;LowIDTbase<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USHORT&nbsp;HiIDTbase<span class="hl_comment">;</span></li><li class="hl_l1">}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IDTINFO&nbsp;<span class="hl_comment">; </span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">#pragma&nbsp;pack<span class="hl_char">(</span>&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_char">,</span>&nbsp;<span class="hl_number">1</span>&nbsp;<span class="hl_char">)</span></li><li class="hl_l0">typedef&nbsp;struct</li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USHORT&nbsp;LowOffset<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USHORT&nbsp;selector<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UCHAR&nbsp;&nbsp;&nbsp;unused_lo<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;<span class="hl_function"><b>char</b></span>&nbsp;unused_hi&nbsp;<span class="hl_char">:</span>&nbsp;<span class="hl_number">5</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;<span class="hl_function"><b>char</b></span>&nbsp;DPL&nbsp;<span class="hl_char">:</span>&nbsp;<span class="hl_number">2</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;<span class="hl_function"><b>char</b></span>&nbsp;P&nbsp;<span class="hl_char">:</span>&nbsp;<span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USHORT&nbsp;HiOffset<span class="hl_comment">;</span></li><li class="hl_l1">}&nbsp;IDTENTRY&nbsp;<span class="hl_comment">;</span></li><li class="hl_l0">#pragma&nbsp;pack<span class="hl_char">(</span>&nbsp;<span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_char">)</span></li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=334944&amp;user=36083&amp;forum_n=6&amp;topic=22388&amp;page=0&amp;anchor=1" class="addthx" data-post="334944"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]SegFault[/b]','')">SegFault</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 44.8 (посетитель), 19thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 8.95'>Активность: 0.04<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29820">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 декабря 2013 16:15 <br><script type="text/javascript">QU('SegFault','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=SegFault" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22388&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
погугли, кода перехвата ISR в инете валом<br>на первый взгляд не вижу iretd
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=334947&amp;user=29820&amp;forum_n=6&amp;topic=22388&amp;page=0&amp;anchor=2" class="addthx" data-post="334947"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=36083" title="09-12-2013 12:23, ранг:4.2" target="_blank">MickeyBlueEyes</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]MickeyBlueEyes[/b]','')">MickeyBlueEyes</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 51.6 (постоянный), 3thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.7'>Активность: 0.04<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=36083">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 декабря 2013 16:25 <br><script type="text/javascript">QU('MickeyBlueEyes','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=MickeyBlueEyes" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22388&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
Ну функция перехвата как минимум не срабатывает.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=334948&amp;user=36083&amp;forum_n=6&amp;topic=22388&amp;page=0&amp;anchor=3" class="addthx" data-post="334948"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]ARCHANGEL[/b]','')">ARCHANGEL</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/6336.png" alt=""><br><span class=txtSm>Ранг: 681.5 <font color=magenta>(<b>! !</b>)</font>, 405thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.85'>Активность: 0.42<span style='color:red'>&searr;</span>0.21</span><br>Статус: <a href="action=userinfo&amp;user=6336">Участник</a><br><font color=blue>ALIEN Hack Team</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 декабря 2013 16:29 &middot; Поправил: ARCHANGEL <br><script type="text/javascript">QU('ARCHANGEL','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ARCHANGEL" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22388&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
<b>MickeyBlueEyes</b><br>Проверьте, правильно ли установился перехват. Например, через RKU посмотрите, каков теперь адрес у перехваченного обработчика. Далее каждый процессор имеет свою idt, вы уверены, что перехватили её на том, на котором исполняете код и ждёте срабатывания? <br><br><b>SegFault пишет:</b><br><i class=x>на первый взгляд не вижу iretd</i><br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__asm</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_registr">es</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_registr">ds</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_registr">fs</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">popfd</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">popad</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jmp</b></span>&nbsp;RealSystemPtr<span class="hl_comment">; // какбэ намекает</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li>        </ol>
    </div>
</div></div><br><br><font size="1"><i>-----<br>Stuck to the plan, always think that we would stand up, never ran.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=334949&amp;user=6336&amp;forum_n=6&amp;topic=22388&amp;page=0&amp;anchor=4" class="addthx" data-post="334949"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=36083" title="09-12-2013 12:57, ранг:4.2" target="_blank">MickeyBlueEyes</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]Dr0p[/b]','')">Dr0p</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33727.png" alt=""><br><span class=txtSm>Ранг: 72.3 (постоянный), 133thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.5'>Активность: 0.38<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33727">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 декабря 2013 16:29 &middot; Поправил: Dr0p <br><script type="text/javascript">QU('Dr0p','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Dr0p" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22388&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
<b>MickeyBlueEyes</b><br><br>1. Каждый камень имеет свои таблицы IDT, GDT, TSS, KPCR(софтверная). Посему нужно на всех камнях их изменить. Тут есть множество методов, основные:<br>IDT.<br> o В цикле енум аффинитета(KeQueryActiveProcessors() -&gt; KAFFINITY), установка его для текущего потока(KeSetSystemAffinityThread()). Затем модификация IDT.<br> o Посылка межпроцессорных прерываний(IPI). KeIpiGenericCall etc. Выполняется в синхронной манере, но не универсально(нет экспорта в младших версиях). Это использует ядро для загрузки например msr.<br> o Получение списка IDT. Тут метод тоже несколько, из GDT, из PCR, из массивов HAL или KiAbiosGdt[]. Во всех случаях нужен парсер кода.<br> o Ожидание свича на новый камень. Где то в произвольном коде ожидается переключение потока на новый камень и блокировка переключения(raise irql/cli).<br><br>Используйте первый метод, так как он прост.<br><br>2. т-процессинг:<br> - На стеке IRET-фрейм. Для трапов сохраняется код ошибки. Посему необходимо выделить поле на стеке для приведения к одной структуре.<br> - Сохраняем RGP.<br> - Сохраняем селекторы.<br> - Загружаем ссылку на KPCR(Fs: KGDT_R0_PCR).<br> - Выравниваем стек. Если происходит переключение мода(r3 -&gt; r0), стек загружается из KTSSS.Esp0. Если свича нет(фолт/интеррапт в кернел), то стек используется текущий. А он может быть не выравнен. Что далее может вызвать проблемы.<br> - Заканчиваем список SEH-фреймов: PCR.ExceptionList -&gt; -1, иначе фолт может быть развёрнут вне текущего кода. Также сех не будет обработан если стек не выравнен(r0).<br><br>Следует использовать структуру KTRAP_FRAME, это системный контекст. Её даже необходимо использовать, так например окончание обработки(Kei386EoiHelper()) потребует эту структуру. Да и нельзя вне её юзать системный функционал.<br><br>Также нужно сохранить предыдущий вектор.<br><br>Для #PF бессмысленно юзать дбгпринт, система захлебнётся в лучшем случае, в хучшем будет синь из за оверфлова стека, память отгружаема.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=334950&amp;user=33727&amp;forum_n=6&amp;topic=22388&amp;page=0&amp;anchor=5" class="addthx" data-post="334950"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=36083" title="09-12-2013 12:58, ранг:4.2" target="_blank">MickeyBlueEyes</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]MickeyBlueEyes[/b]','')">MickeyBlueEyes</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 51.6 (постоянный), 3thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.7'>Активность: 0.04<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=36083">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 декабря 2013 17:01 <br><script type="text/javascript">QU('MickeyBlueEyes','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=MickeyBlueEyes" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22388&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
<I>Dr0p пишет:<br>Для #PF бессмысленно юзать дбгпринт, система захлебнётся в лучшем случае, в хучшем будет синь из за оверфлова стека, память отгружаема.  </I><br>А если своя обёртка для записи в файл типа LogWrite , так можно?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=334959&amp;user=36083&amp;forum_n=6&amp;topic=22388&amp;page=0&amp;anchor=6" class="addthx" data-post="334959"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]Dr0p[/b]','')">Dr0p</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33727.png" alt=""><br><span class=txtSm>Ранг: 72.3 (постоянный), 133thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.5'>Активность: 0.38<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33727">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 декабря 2013 17:04 <br><script type="text/javascript">QU('Dr0p','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Dr0p" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22388&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
<b>MickeyBlueEyes</b><br><br>Для этого вектора - нет.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=334962&amp;user=33727&amp;forum_n=6&amp;topic=22388&amp;page=0&amp;anchor=7" class="addthx" data-post="334962"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]MickeyBlueEyes[/b]','')">MickeyBlueEyes</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 51.6 (постоянный), 3thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.7'>Активность: 0.04<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=36083">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 декабря 2013 17:05 <br><script type="text/javascript">QU('MickeyBlueEyes','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=MickeyBlueEyes" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22388&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
<b>ARCHANGEL пишет:</b><br><I> Далее каждый процессор имеет свою шidt, вы уверены, что перехватили её на том, на котором исполняете код и ждёте срабатывания?  </I><br>Ну запускаю VM с одним процессором, проверял в kernel mode , то всегда доступен только 1 процессор.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=334963&amp;user=36083&amp;forum_n=6&amp;topic=22388&amp;page=0&amp;anchor=8" class="addthx" data-post="334963"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]MickeyBlueEyes[/b]','')">MickeyBlueEyes</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 51.6 (постоянный), 3thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.7'>Активность: 0.04<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=36083">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 декабря 2013 17:07 <br><script type="text/javascript">QU('MickeyBlueEyes','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=MickeyBlueEyes" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22388&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
<b>Dr0p </b><br>Понял, спасибо.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=334964&amp;user=36083&amp;forum_n=6&amp;topic=22388&amp;page=0&amp;anchor=9" class="addthx" data-post="334964"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 декабря 2013 17:14 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22388&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
XP x86, что мешает взять отладчик и посмотреть свой же кодес?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=334965&amp;user=1556&amp;forum_n=6&amp;topic=22388&amp;page=0&amp;anchor=10" class="addthx" data-post="334965"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]MickeyBlueEyes[/b]','')">MickeyBlueEyes</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 51.6 (постоянный), 3thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.7'>Активность: 0.04<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=36083">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 декабря 2013 17:24 <br><script type="text/javascript">QU('MickeyBlueEyes','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=MickeyBlueEyes" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22388&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
<b>Archer</b><br>Нету навыков отладки ядра.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=334966&amp;user=36083&amp;forum_n=6&amp;topic=22388&amp;page=0&amp;anchor=11" class="addthx" data-post="334966"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]Dr0p[/b]','')">Dr0p</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33727.png" alt=""><br><span class=txtSm>Ранг: 72.3 (постоянный), 133thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.5'>Активность: 0.38<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33727">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 декабря 2013 17:25 &middot; Поправил: Dr0p <br><script type="text/javascript">QU('Dr0p','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Dr0p" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22388&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
<b>Archer</b><br><br>Так а что смотреть то, дескриптор не корректный. 1000111X должны быть i[15%8]. Либо его адрес(IDT_BASE[N*8], база через sidt/pcr получается).
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=334967&amp;user=33727&amp;forum_n=6&amp;topic=22388&amp;page=0&amp;anchor=12" class="addthx" data-post="334967"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]MickeyBlueEyes[/b]','')">MickeyBlueEyes</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 51.6 (постоянный), 3thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.7'>Активность: 0.04<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=36083">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 декабря 2013 19:56 <br><script type="text/javascript">QU('MickeyBlueEyes','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=MickeyBlueEyes" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22388&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
Пока начал ковырять этот же вариант, испробывал перехватывать прерывания от клавиатуры, то тут перехват получается, а с 0x04 нет, с вызовом фций в перехватчике то виснет виртуалка, не БСОД. Короче да вызывать ничего не получится, если только фильтр какойто. <br>Упростил код, вышло щас так так:<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">#define&nbsp;NT_SYSTEM_SERVICE_INT&nbsp;0x31</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">#define&nbsp;MAKELONG<span class="hl_char">(</span>&nbsp;a&nbsp;<span class="hl_char">,</span>&nbsp;b&nbsp;<span class="hl_char">)</span><span class="hl_char">(</span>&nbsp;<span class="hl_char">(</span>&nbsp;LONG&nbsp;<span class="hl_char">)</span>&nbsp;<span class="hl_char">(</span>&nbsp;<span class="hl_char">(</span>&nbsp;<span class="hl_char">(</span>&nbsp;USHORT&nbsp;<span class="hl_char">)</span>&nbsp;<span class="hl_char">(</span>&nbsp;a&nbsp;<span class="hl_char">)</span>&nbsp;<span class="hl_char">)</span>&nbsp;<span class="hl_char">|</span>&nbsp;<span class="hl_char">(</span>&nbsp;<span class="hl_char">(</span>&nbsp;ULONG&nbsp;<span class="hl_char">)</span>&nbsp;<span class="hl_char">(</span>&nbsp;<span class="hl_char">(</span>&nbsp;USHORT&nbsp;<span class="hl_char">)</span>&nbsp;<span class="hl_char">(</span>&nbsp;b&nbsp;<span class="hl_char">)</span>&nbsp;<span class="hl_char">)</span>&nbsp;<span class="hl_char">)</span>&nbsp;<span class="hl_char">&lt;</span><span class="hl_char">&lt;</span>&nbsp;<span class="hl_number">16</span>&nbsp;<span class="hl_char">)</span>&nbsp;<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">ULONG&nbsp;RealSystemPtr<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">typedef&nbsp;struct</li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USHORT&nbsp;IDTLimit<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USHORT&nbsp;LowIDTbase<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USHORT&nbsp;HiIDTbase<span class="hl_comment">;</span></li><li class="hl_l1">}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IDTINFO&nbsp;<span class="hl_comment">; </span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">#pragma&nbsp;pack<span class="hl_char">(</span>&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_char">,</span>&nbsp;<span class="hl_number">1</span>&nbsp;<span class="hl_char">)</span></li><li class="hl_l0">typedef&nbsp;struct</li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USHORT&nbsp;LowOffset<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USHORT&nbsp;selector<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UCHAR&nbsp;&nbsp;&nbsp;unused_lo<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;<span class="hl_function"><b>char</b></span>&nbsp;unused_hi&nbsp;<span class="hl_char">:</span>&nbsp;<span class="hl_number">5</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;<span class="hl_function"><b>char</b></span>&nbsp;DPL&nbsp;<span class="hl_char">:</span>&nbsp;<span class="hl_number">2</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;<span class="hl_function"><b>char</b></span>&nbsp;P&nbsp;<span class="hl_char">:</span>&nbsp;<span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USHORT&nbsp;HiOffset<span class="hl_comment">;</span></li><li class="hl_l1">}&nbsp;IDTENTRY&nbsp;<span class="hl_comment">;</span></li><li class="hl_l0">#pragma&nbsp;pack<span class="hl_char">(</span>&nbsp;<span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">__declspec<span class="hl_char">(</span>&nbsp;naked&nbsp;<span class="hl_char">)</span>&nbsp;MyInt<span class="hl_char">(</span><span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__asm</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">pushad</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">pushfd</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>Тута&nbsp;код</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">popfd</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">popad</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jmp</b></span>&nbsp;RealSystemPtr<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">}</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>void</b></span>&nbsp;UnHook<span class="hl_char">(</span><span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IDTINFO&nbsp;info<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IDTENTRY&nbsp;<span class="hl_char">*</span>&nbsp;entries<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__asm&nbsp;<span class="hl_function"><b>sidt</b></span>&nbsp;info</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;entries&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">(</span>&nbsp;IDTENTRY&nbsp;<span class="hl_char">*</span>&nbsp;<span class="hl_char">)</span>&nbsp;MAKELONG<span class="hl_char">(</span>&nbsp;info<span class="hl_char">.</span>LowIDTbase&nbsp;<span class="hl_char">,</span>info<span class="hl_char">.</span>HiIDTbase&nbsp;<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__asm&nbsp;<span class="hl_function">cli</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;entries<span class="hl_char">[</span>&nbsp;NT_SYSTEM_SERVICE_INT&nbsp;<span class="hl_char">]</span><span class="hl_char">.</span>LowOffset&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">(</span>&nbsp;USHORT&nbsp;<span class="hl_char">)</span>RealSystemPtr<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;entries<span class="hl_char">[</span>&nbsp;NT_SYSTEM_SERVICE_INT&nbsp;<span class="hl_char">]</span><span class="hl_char">.</span>HiOffset&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">(</span>&nbsp;USHORT&nbsp;<span class="hl_char">)</span><span class="hl_char">(</span>&nbsp;<span class="hl_char">(</span>&nbsp;ULONG&nbsp;<span class="hl_char">)</span>RealSystemPtr&nbsp;<span class="hl_char">&gt;</span><span class="hl_char">&gt;</span>&nbsp;<span class="hl_number">16</span>&nbsp;<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__asm&nbsp;<span class="hl_function">sti</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">}</li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>void</b></span>&nbsp;Hook<span class="hl_char">(</span><span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IDTINFO&nbsp;idt_info<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IDTENTRY&nbsp;<span class="hl_char">*</span>&nbsp;idt_entries<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__asm&nbsp;<span class="hl_function"><b>sidt</b></span>&nbsp;idt_info</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idt_entries&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">(</span>&nbsp;IDTENTRY&nbsp;<span class="hl_char">*</span>&nbsp;<span class="hl_char">)</span>&nbsp;MAKELONG<span class="hl_char">(</span>&nbsp;idt_info<span class="hl_char">.</span>LowIDTbase&nbsp;<span class="hl_char">,</span>&nbsp;idt_info<span class="hl_char">.</span>HiIDTbase&nbsp;<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RealSystemPtr&nbsp;<span class="hl_char">=</span>&nbsp;MAKELONG<span class="hl_char">(</span>&nbsp;idt_entries<span class="hl_char">[</span>&nbsp;NT_SYSTEM_SERVICE_INT&nbsp;<span class="hl_char">]</span><span class="hl_char">.</span>LowOffset&nbsp;<span class="hl_char">,</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idt_entries</span><span class="hl_char">[</span>&nbsp;NT_SYSTEM_SERVICE_INT&nbsp;<span class="hl_char">]</span><span class="hl_char">.</span>HiOffset&nbsp;<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DbgPrint<span class="hl_char">(</span><span class="hl_quote">&quot;%u&quot;</span><span class="hl_char">,</span>&nbsp;RealSystemPtr<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__asm&nbsp;<span class="hl_function">cli</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idt_entries<span class="hl_char">[</span>&nbsp;NT_SYSTEM_SERVICE_INT&nbsp;<span class="hl_char">]</span><span class="hl_char">.</span>LowOffset&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">(</span>&nbsp;USHORT&nbsp;<span class="hl_char">)</span>MyInt<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idt_entries<span class="hl_char">[</span>&nbsp;NT_SYSTEM_SERVICE_INT&nbsp;<span class="hl_char">]</span><span class="hl_char">.</span>HiOffset&nbsp;<span class="hl_char">=</span>&nbsp;&nbsp;<span class="hl_char">(</span>&nbsp;USHORT&nbsp;<span class="hl_char">)</span><span class="hl_char">(</span>&nbsp;<span class="hl_char">(</span>&nbsp;ULONG&nbsp;<span class="hl_char">)</span>MyInt&nbsp;<span class="hl_char">&gt;</span><span class="hl_char">&gt;</span>&nbsp;<span class="hl_number">16</span>&nbsp;<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__asm&nbsp;<span class="hl_function">sti</span></li><li class="hl_l1">}&nbsp;</li>        </ol>
    </div>
</div></div>
<br><br>Мне нужно обратывать исключения 0x04, наверное есть же специальная ф-ция ? Может кто знает её index в STD , буду признателен, или подскажите пжл отладчик ядра ( Syser loader? или есть ищё что то?).<br>0x04 должна же обрабатывать такое как если я в UserMode установил в програме определёный участок памяти VirtualProctect - PAGE_NOACCESS , и к нему попытаюься обратится.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=334975&amp;user=36083&amp;forum_n=6&amp;topic=22388&amp;page=0&amp;anchor=13" class="addthx" data-post="334975"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]Dr0p[/b]','')">Dr0p</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33727.png" alt=""><br><span class=txtSm>Ранг: 72.3 (постоянный), 133thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.5'>Активность: 0.38<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33727">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 декабря 2013 23:59 &middot; Поправил: Dr0p <br><script type="text/javascript">QU('Dr0p','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Dr0p" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22388&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
<b>MickeyBlueEyes</b><br><br>&gt; Короче да вызывать ничего не получится<br><br>Получится после формирования тфрейма. Тогда можно даже размаскировать прерыванья.<br><br>&gt; Мне нужно обратывать исключения 0x04, наверное есть же специальная ф-ция ? Может кто знает её index в STD<br><br>Что значит обрабатывать, это ловушка для Into.<br><br>&gt; подскажите пжл отладчик ядра<br><br>Виндбг на виртуалке, я например его очень редко использую, обычно хватает сиськи.<br><br>&gt; VirtualProctect - PAGE_NOACCESS<br><br>Нет, это не тот вектор. Вам нужен #PF(14-й дескриптор).<br><br>Лучше задачу огласите, что это вы делаете ?<br><br>Если вы хотите отслеживать в юзермодной памяти пэйджфолт, то универсальный способ для этого - в юзермоде обработать в VEH. Это и недетект и совместимо с x64, да и ядро трогать не нужно <img src="img/smilies/s3.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=334989&amp;user=33727&amp;forum_n=6&amp;topic=22388&amp;page=0&amp;anchor=14" class="addthx" data-post="334989"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]MickeyBlueEyes[/b]','')">MickeyBlueEyes</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 51.6 (постоянный), 3thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.7'>Активность: 0.04<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=36083">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 декабря 2013 11:58 <br><script type="text/javascript">QU('MickeyBlueEyes','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=MickeyBlueEyes" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22388&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
Да 0x14 , то уже путаться начал. Ну таким способом хочу установить перехват необходимых ф-ций нужного мне процесса, не затрагивая сам процесс , ну чтобы без палева ) Не знаю пока, реально ли )
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=334994&amp;user=36083&amp;forum_n=6&amp;topic=22388&amp;page=0&amp;anchor=15" class="addthx" data-post="334994"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]Veliant[/b]','')">Veliant</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 301.4 (мудрец), 194thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.62'>Активность: 0.17<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=3136">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 декабря 2013 12:52 <br><script type="text/javascript">QU('Veliant','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Veliant" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22388&amp;page=0#16');return false;">#16</a> </span><div align=left><br>
<I>MickeyBlueEyes пишет:<br>установить перехват необходимых ф-ций нужного мне процесса </I><br><br><I>MickeyBlueEyes пишет:<br>PAGE_NOACCESS  </I><br><br>Быстродействие процесса сильно просядет, особенно если функция частоиспользуемая, или будет находиться на одной странице с таковой.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=334996&amp;user=3136&amp;forum_n=6&amp;topic=22388&amp;page=0&amp;anchor=16" class="addthx" data-post="334996"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]MickeyBlueEyes[/b]','')">MickeyBlueEyes</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 51.6 (постоянный), 3thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.7'>Активность: 0.04<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=36083">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 декабря 2013 13:01 <br><script type="text/javascript">QU('MickeyBlueEyes','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=MickeyBlueEyes" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22388&amp;page=0#17');return false;">#17</a> </span><div align=left><br>
<I>Veliant пишет:<br>Быстродействие процесса сильно просядет, особенно если функция частоиспользуемая, или будет находиться на одной странице с таковой.  </I><br>Используется примерно 1-2 раза в секунду.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=334997&amp;user=36083&amp;forum_n=6&amp;topic=22388&amp;page=0&amp;anchor=17" class="addthx" data-post="334997"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]Dr0p[/b]','')">Dr0p</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33727.png" alt=""><br><span class=txtSm>Ранг: 72.3 (постоянный), 133thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.5'>Активность: 0.38<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33727">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 декабря 2013 13:11 <br><script type="text/javascript">QU('Dr0p','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Dr0p" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22388&amp;page=0#18');return false;">#18</a> </span><div align=left><br>
<b>Veliant</b><br><br>Никак на быстродействии не скажется если маршрутизировать.<br><br><b>MickeyBlueEyes</b><br><br>Что за функа ?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=334998&amp;user=33727&amp;forum_n=6&amp;topic=22388&amp;page=0&amp;anchor=18" class="addthx" data-post="334998"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]MickeyBlueEyes[/b]','')">MickeyBlueEyes</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 51.6 (постоянный), 3thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.7'>Активность: 0.04<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=36083">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 декабря 2013 13:16 &middot; Поправил: MickeyBlueEyes <br><script type="text/javascript">QU('MickeyBlueEyes','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=MickeyBlueEyes" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22388&amp;page=0#19');return false;">#19</a> </span><div align=left><br>
.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=334999&amp;user=36083&amp;forum_n=6&amp;topic=22388&amp;page=0&amp;anchor=19" class="addthx" data-post="334999"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="20" onfocus="this.blur()" href="JavaScript:di('[b]MickeyBlueEyes[/b]','')">MickeyBlueEyes</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 51.6 (постоянный), 3thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.7'>Активность: 0.04<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=36083">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 декабря 2013 22:56 <br><script type="text/javascript">QU('MickeyBlueEyes','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=MickeyBlueEyes" target="_blank">Личное сообщение</a> &middot;  <a href="#20" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22388&amp;page=0#20');return false;">#20</a> </span><div align=left><br>
Ошибка была в невнимательности ))) Вместо того чтобы использовать 14, я сунул 0x14 )))) Итого потратил 2 дня, зато многое познаётся в таких вот банальных и смешных ошибках ))) Лучше руководства как потратить 2 дня и не придумаешь ) Сейчас всё работает, всем спасибо ) Будьте внимательны )
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=335023&amp;user=36083&amp;forum_n=6&amp;topic=22388&amp;page=0&amp;anchor=20" class="addthx" data-post="335023"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="21" onfocus="this.blur()" href="JavaScript:di('[b]Dr0p[/b]','')">Dr0p</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33727.png" alt=""><br><span class=txtSm>Ранг: 72.3 (постоянный), 133thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.5'>Активность: 0.38<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33727">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 декабря 2013 00:36 &middot; Поправил: Dr0p <br><script type="text/javascript">QU('Dr0p','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Dr0p" target="_blank">Личное сообщение</a> &middot;  <a href="#21" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22388&amp;page=0#21');return false;">#21</a> </span><div align=left><br>
<b>MickeyBlueEyes</b><br><br>И как вы планируете выполнять код в N/A памяти, трассировать и снимать/ставить атрибуты страницы ?<br><br>Как быть с многопоточностью ?<br><br>Извращенье полнейшее, не нужно в ядро лезть для сей задачи. Поточная маршрутизация рулит, один экспорт - один фолт.<br><br>И си у вас ну никак не катит для реализации.<br><br><img src="img/attach.gif" alt=""> <a href="./files/df92_11.12.2013_EXELAB.rU.tgz">df92_11.12.2013_EXELAB.rU.tgz</a> - Reloc.zip
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=335028&amp;user=33727&amp;forum_n=6&amp;topic=22388&amp;page=0&amp;anchor=21" class="addthx" data-post="335028"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=36083" title="11-12-2013 06:31, ранг:8.2" target="_blank">MickeyBlueEyes</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="22" onfocus="this.blur()" href="JavaScript:di('[b]MickeyBlueEyes[/b]','')">MickeyBlueEyes</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 51.6 (постоянный), 3thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.7'>Активность: 0.04<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=36083">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 декабря 2013 10:30 <br><script type="text/javascript">QU('MickeyBlueEyes','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=MickeyBlueEyes" target="_blank">Личное сообщение</a> &middot;  <a href="#22" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22388&amp;page=0#22');return false;">#22</a> </span><div align=left><br>
<I>Dr0p пишет:<br>И как вы планируете выполнять код в N/A памяти, трассировать и снимать/ставить атрибуты страницы ? </I><br>Пока не знаю )<br><I>Dr0p пишет:<br>Поточная маршрутизация рулит, один экспорт - один фолт. </I><br>В двух словах, если не сложно )<br><I>Dr0p пишет:<br>И си у вас ну никак не катит для реализации. </I><br>Значить будет asm )
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=335041&amp;user=36083&amp;forum_n=6&amp;topic=22388&amp;page=0&amp;anchor=22" class="addthx" data-post="335041"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="23" onfocus="this.blur()" href="JavaScript:di('[b]Veliant[/b]','')">Veliant</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 301.4 (мудрец), 194thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.62'>Активность: 0.17<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=3136">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 декабря 2013 11:03 <br><script type="text/javascript">QU('Veliant','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Veliant" target="_blank">Личное сообщение</a> &middot;  <a href="#23" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22388&amp;page=0#23');return false;">#23</a> </span><div align=left><br>
<I>MickeyBlueEyes пишет:<br>В двух словах, если не сложно ) </I><br>Если в кратце посмотреть приложенные сорцы, то предлагается сделать в памяти копию модуля в котором находится функция, установить VEH обработчик, поставить N/A на страницу памяти с функцией и при срабатывании сравнивать адрес в VEH. Если совпало - менять адрес EIP на копию, для того чтоб выполнялось дальше без срабатывания N/A.<br><br>Вообще проще тогда хардварный бряк+VEH сделать. Или если это API-функция, то подменить адрес в таблице импорта на свой обработчик.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=335042&amp;user=3136&amp;forum_n=6&amp;topic=22388&amp;page=0&amp;anchor=23" class="addthx" data-post="335042"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=33727" title="11-12-2013 07:19, ранг:61.1" target="_blank">Dr0p</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="24" onfocus="this.blur()" href="JavaScript:di('[b]MickeyBlueEyes[/b]','')">MickeyBlueEyes</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 51.6 (постоянный), 3thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.7'>Активность: 0.04<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=36083">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 декабря 2013 11:21 <br><script type="text/javascript">QU('MickeyBlueEyes','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=MickeyBlueEyes" target="_blank">Личное сообщение</a> &middot;  <a href="#24" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22388&amp;page=0#24');return false;">#24</a> </span><div align=left><br>
<I>Veliant пишет:<br>Или если это API-функция, то подменить адрес в таблице импорта на свой обработчик.  </I><br>Да, но нельзя,  авер запалит.  <br>Попробую для начала с бряком так как проще.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=335043&amp;user=36083&amp;forum_n=6&amp;topic=22388&amp;page=0&amp;anchor=24" class="addthx" data-post="335043"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="25" onfocus="this.blur()" href="JavaScript:di('[b]Dr0p[/b]','')">Dr0p</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33727.png" alt=""><br><span class=txtSm>Ранг: 72.3 (постоянный), 133thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.5'>Активность: 0.38<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33727">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 декабря 2013 11:22 &middot; Поправил: Dr0p <br><script type="text/javascript">QU('Dr0p','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Dr0p" target="_blank">Личное сообщение</a> &middot;  <a href="#25" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22388&amp;page=0#25');return false;">#25</a> </span><div align=left><br>
<b>Veliant</b><br><br>В целом так, но код избыточен - обычно нет необходимости релоцировать модуль, можно просто как строку в буфер всю секцию кода скопировать(так как нет относительных ветвлений за пределы проекции; IAT в той же секции. Для нтдлл так не желательно, есть очень большая вероятность что код модифицирован относительным ветвлением. Так же user32 и kernel32 не релокабельны, лодер выведет сообщение о фейле).
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=335044&amp;user=33727&amp;forum_n=6&amp;topic=22388&amp;page=0&amp;anchor=25" class="addthx" data-post="335044"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="26" onfocus="this.blur()" href="JavaScript:di('[b]Dr0p[/b]','')">Dr0p</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33727.png" alt=""><br><span class=txtSm>Ранг: 72.3 (постоянный), 133thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.5'>Активность: 0.38<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33727">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 декабря 2013 11:30 <br><script type="text/javascript">QU('Dr0p','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Dr0p" target="_blank">Личное сообщение</a> &middot;  <a href="#26" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22388&amp;page=0#26');return false;">#26</a> </span><div align=left><br>
<b>MickeyBlueEyes</b><br><br>Железячные точки останова - нестабильность. Хотя бы потому, что их EMET юзает, они уже используются для защиты.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=335045&amp;user=33727&amp;forum_n=6&amp;topic=22388&amp;page=0&amp;anchor=26" class="addthx" data-post="335045"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="27" onfocus="this.blur()" href="JavaScript:di('[b]MickeyBlueEyes[/b]','')">MickeyBlueEyes</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 51.6 (постоянный), 3thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.7'>Активность: 0.04<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=36083">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 декабря 2013 11:41 <br><script type="text/javascript">QU('MickeyBlueEyes','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=MickeyBlueEyes" target="_blank">Личное сообщение</a> &middot;  <a href="#27" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22388&amp;page=0#27');return false;">#27</a> </span><div align=left><br>
<b>Dr0p</b><br><i class=x>Железячные точки останова - нестабильность. Хотя бы потому, что их EMET юзает, они уже используются для защиты.  </i><br>Тогда всё таки лучше в этой теме разобраться?<br><i class=x> Если в кратце посмотреть приложенные сорцы, то предлагается сделать в памяти копию модуля в котором находится функция, установить VEH обработчик, поставить N/A на страницу памяти с функцией и при срабатывании сравнивать адрес в VEH. Если совпало - менять адрес EIP на копию, для того чтоб выполнялось дальше без срабатывания N/A. </i>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=335046&amp;user=36083&amp;forum_n=6&amp;topic=22388&amp;page=0&amp;anchor=27" class="addthx" data-post="335046"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="28" onfocus="this.blur()" href="JavaScript:di('[b]Dr0p[/b]','')">Dr0p</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33727.png" alt=""><br><span class=txtSm>Ранг: 72.3 (постоянный), 133thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.5'>Активность: 0.38<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33727">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 декабря 2013 11:44 &middot; Поправил: Dr0p <br><script type="text/javascript">QU('Dr0p','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Dr0p" target="_blank">Личное сообщение</a> &middot;  <a href="#28" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22388&amp;page=0#28');return false;">#28</a> </span><div align=left><br>
<b>MickeyBlueEyes</b><br><br>Поточная маршрутизация в этом случае самый норм метод. Если фолт в диапазоне адресов N/A страницы, то корректируем rEip на дельту адресов. Это просто, быстро и недетект.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=335047&amp;user=33727&amp;forum_n=6&amp;topic=22388&amp;page=0&amp;anchor=28" class="addthx" data-post="335047"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="29" onfocus="this.blur()" href="JavaScript:di('[b]Veliant[/b]','')">Veliant</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 301.4 (мудрец), 194thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.62'>Активность: 0.17<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=3136">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 декабря 2013 11:51 &middot; Поправил: Veliant <br><script type="text/javascript">QU('Veliant','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Veliant" target="_blank">Личное сообщение</a> &middot;  <a href="#29" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22388&amp;page=0#29');return false;">#29</a> </span><div align=left><br>
<I>Dr0p пишет:<br>Это просто, быстро </I><br>Что-то у меня большие сомнения по этому поводу. Архитектурно права доступа ставятся на всю страницу (как правило 4кб) и если в этой странице будут еще какие-нибудь функции для работы с памятью/файлами, которые часто дергаются, то у тебя просядет все же быстродействие из-за постоянных переключений в ядро/обратно и проверки адреса.<br><br>Хотя признаю, идея передавать управление копии страницы гениальна, и это значительно разгрузит процессор.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=335049&amp;user=3136&amp;forum_n=6&amp;topic=22388&amp;page=0&amp;anchor=29" class="addthx" data-post="335049"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=36083" title="11-12-2013 07:54, ранг:8.2" target="_blank">MickeyBlueEyes</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="30" onfocus="this.blur()" href="JavaScript:di('[b]MickeyBlueEyes[/b]','')">MickeyBlueEyes</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 51.6 (постоянный), 3thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.7'>Активность: 0.04<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=36083">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 декабря 2013 11:54 <br><script type="text/javascript">QU('MickeyBlueEyes','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=MickeyBlueEyes" target="_blank">Личное сообщение</a> &middot;  <a href="#30" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22388&amp;page=0#30');return false;">#30</a> </span><div align=left><br>
<b>Dr0p</b><br>Спасибо, буду пробовать.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=335050&amp;user=36083&amp;forum_n=6&amp;topic=22388&amp;page=0&amp;anchor=30" class="addthx" data-post="335050"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> .  <b>1</b> . <a href="action=vthread&amp;forum=6&amp;topic=22388&amp;page=1.html">2</a> . <a href="action=vthread&amp;forum=6&amp;topic=22388&amp;page=2.html">3</a> . <a href="action=vthread&amp;forum=6&amp;topic=22388&amp;page=3.html">4</a> . <a href="action=vthread&amp;forum=6&amp;topic=22388&amp;page=4.html">5</a> . <a href="action=vthread&amp;forum=6&amp;topic=22388&amp;page=5.html">6</a> . <a href="action=vthread&amp;forum=6&amp;topic=22388&amp;page=6.html">7</a> . <a href="action=vthread&amp;forum=6&amp;topic=22388&amp;page=1.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Перехват прерываний и исключений</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#31" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="6">
<input type="hidden" name="topic" value="22388">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=22388" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
