<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Как потокобезопасно подменить стек не трогая стек исходного потока - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Задача такая:Делаю перехват Api путем инжекта jmp на тело своего обработчика. В обработчике нужно потокобезопасно сохранить регистры исходного потока, подменить стек на свой, выполнить действия по обработке, восстановить стек и">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=39467'>hgdagon</a>, <a target='_blank' href='?action=userinfo&amp;user=28016'>asfa</a>, <a target='_blank' href='?action=userinfo&amp;user=26261'>bartolomeo</a> (+4 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Как потокобезопасно подменить стек не трогая стек исходного потока</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]Goldy[/b]','')">Goldy</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 4.1 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.83'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=6451">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 января 2007 10:47 <br><script type="text/javascript">QU('Goldy','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Goldy" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7503.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Задача такая:Делаю перехват Api путем инжекта jmp на тело своего обработчика.<br>В обработчике нужно потокобезопасно сохранить регистры исходного потока, подменить стек на свой, <br>выполнить действия по обработке, восстановить стек и регистры.<br>Более подробно алгоритм представляется следующим: <br>1)потокобезопасно запоминаем регистры использующиеся для подмены стека,<br>2)меняем стек (StackBase,StackLimit,Esp)<br>3)pusha<br>4)тело основного обработчика<br>5)popa<br>6)восстанавливаем старый стек<br>7)восстанавливаем используемые регистры при подмене стека<br>8)jmp на api.<br>Сообственно интересует конкретная реализация пунктов 1,2,6,7, причем главное условие сделать это нужно не трогая <br>вообще стек исходного потока (любые операции со стеком исходного потока запрещены!).<br>Естественно заранее еще до установки перехвата выделена память в обьеме достаточном для хранения потоковых данных и своих стеков?<br>Собственно этот вопрос тоже задавался на wasm.ru но пока по subj ответов не получил.<br>Может у кого будут мысли по данному поводу. Заранее спасибо.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=116097&amp;user=6451&amp;forum_n=6&amp;topic=7503.html&amp;page=0&amp;anchor=1" class="addthx" data-post="116097"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]HoBleen[/b]','')">HoBleen</a></b><br></div>
<img src="img/s6.gif" alt=""><br><img style="padding-top:3px;" src="av/5110.jpg" alt=""><br><span class=txtSm>Ранг: 240.5 (наставник)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.09'>Активность: 0.19<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=5110">Участник</a><br><font color=blue>Author of ACKiller </font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 января 2007 11:07 <br><script type="text/javascript">QU('HoBleen','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=HoBleen" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7503.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
Сохранение регистров и старого esp в таком случае должно происходить в новый стек.<br>Вообще инфы в инете должно быть достаточно по этой теме.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=116100&amp;user=5110&amp;forum_n=6&amp;topic=7503.html&amp;page=0&amp;anchor=2" class="addthx" data-post="116100"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]Xserg[/b]','')">Xserg</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 24.9 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.7'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=7451">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 января 2007 11:26 <br><script type="text/javascript">QU('Xserg','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Xserg" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7503.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
<b>Goldy</b><br><br>Много раз подменял АПИ подобным, образом , ни разу стек не подменял, т.к. не было необходимости. Все и так работает.<br><br>Что за программа такая?  Почему, любые операции со стеком исходного потока запрещены!? <br>(АПИ стек не бережет, использует на лево и направо)
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=116107&amp;user=7451&amp;forum_n=6&amp;topic=7503.html&amp;page=0&amp;anchor=3" class="addthx" data-post="116107"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]seeq[/b]','')">seeq</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/3067.jpg" alt=""><br><span class=txtSm>Ранг: 105.9 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.64'>Активность: 0.06<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3067">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 января 2007 11:36 <br><script type="text/javascript">QU('seeq','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=seeq" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7503.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
Что-то не совсем понятно написано. Нахера менять стек? Делаешь инжект на свою процедуру, в ней ты спокойно можешь определить локальные переменные, которые будут &quot;потокобезопасны&quot;. Если не хватает памяти то выделяешь еще через VirtualAlloc. Вот и все.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=116109&amp;user=3067&amp;forum_n=6&amp;topic=7503.html&amp;page=0&amp;anchor=4" class="addthx" data-post="116109"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]Goldy[/b]','')">Goldy</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 4.1 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.83'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=6451">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 января 2007 12:38 <br><script type="text/javascript">QU('Goldy','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Goldy" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7503.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
Тут главная задача не перехват АПИ а перехват взаимодействия длл модулей программы между собой, подсчет статистики вызовов анализ параметров и т.д.  А данный сабж нужен чтоб свести к нулю воздействие на исполняемую программу (программа может отслеживать модификацию стека, можно вызвать переполнение и т.д.)
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=116124&amp;user=6451&amp;forum_n=6&amp;topic=7503.html&amp;page=0&amp;anchor=5" class="addthx" data-post="116124"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]s0larian[/b]','')">s0larian</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/1737.jpg" alt=""><br><span class=txtSm>Ранг: 387.4 (мудрец)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.19'>Активность: 0.17<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1737">Участник</a><br><font color=blue>системщик</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 января 2007 14:31 &middot; Поправил: s0larian <br><script type="text/javascript">QU('s0larian','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=s0larian" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7503.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
<I>Goldy пишет:<br>А данный сабж нужен чтоб свести к нулю воздействие на исполняемую программу </I><br>Не.... ты зря морочешь себе яйца. Если софтина вызывает API, то гарантия только в том, что когда-нить EIP будет показывать на след. инструкцию, стек будет подчищен от аргументов, и твоя часть стека (более высокие адреса) не будет попорчена. Что и как происходит с оставшимся местом на стеке - не известно и не важно. Более того, что б это проверить надо задекларировать char stack[1024]; и это читать - что есть бред - это ведь зависит от версии винды, версии SP, версии IE, MFC и т.д.<br><br>Ну а по поводу потоков - то что на стеке - уже само собой видимо только потоку. Твой код перехвата будет работать в контексте (то есть на стеке) вызывающего потока.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=116139&amp;user=1737&amp;forum_n=6&amp;topic=7503.html&amp;page=0&amp;anchor=6" class="addthx" data-post="116139"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]seeq[/b]','')">seeq</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/3067.jpg" alt=""><br><span class=txtSm>Ранг: 105.9 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.64'>Активность: 0.06<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3067">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 января 2007 14:49 <br><script type="text/javascript">QU('seeq','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=seeq" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7503.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
<b>Goldy</b><br>По поводу затруднительных пунктов 1,2,6,7  - тут все очень просто. Выкинь их вообще.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=116143&amp;user=3067&amp;forum_n=6&amp;topic=7503.html&amp;page=0&amp;anchor=7" class="addthx" data-post="116143"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 20 января 2007 00:00 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7503.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
Можешь попытаться объявить массив двордов, после получения управления запомнить в своей переменной esp, поменять esp на свой массив, потом уже 3-5, восстанавливать esp. При необходимости копировать сзначения изначального стека в свой.<br>Второй вариант-копировать изначальный стек в свой массив, работать в общем стеке, а потом скопировать из массива обратно в общий.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=116188&amp;user=1556&amp;forum_n=6&amp;topic=7503.html&amp;page=0&amp;anchor=8" class="addthx" data-post="116188"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]S_T_A_S_[/b]','')">S_T_A_S_</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 163.7 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.87'>Активность: 0.07<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=251">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 20 января 2007 00:40 <br><script type="text/javascript">QU('S_T_A_S_','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=S_T_A_S_" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7503.html&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
rsdn.ru/article/baseserv/stack.xml
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=116191&amp;user=251&amp;forum_n=6&amp;topic=7503.html&amp;page=0&amp;anchor=9" class="addthx" data-post="116191"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]asd[/b]','')">asd</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 162.2 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.58'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3241">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 20 января 2007 03:04 <br><script type="text/javascript">QU('asd','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=asd" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7503.html&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
<I>Goldy пишет:<br>3)pusha <br>4)тело основного обработчика <br>5)popa </I><br>pushad/popad только. Сам один раз часа 3 из-за этого баг искал.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=116220&amp;user=3241&amp;forum_n=6&amp;topic=7503.html&amp;page=0&amp;anchor=10" class="addthx" data-post="116220"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]Goldy[/b]','')">Goldy</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 4.1 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.83'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=6451">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 20 января 2007 10:40 <br><script type="text/javascript">QU('Goldy','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Goldy" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7503.html&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
Archer-&gt;Главный вопрос был как это сделать потокобезопасно! В твоем варианте это не проходит!<br>S_T_A_S_-&gt;Это я уже давно прочел <img src="img/smilies/s1.gif" alt=""><br>Вобще мне нужно 4 байта для сохранения одного регистра и это место должно быть или в TLS или вычисляться динамически в моем куске памяти в зависемости от того под каким потоком мы работаем.<br>Остальной процесс подмены стека и т.д. понятен.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=116296&amp;user=6451&amp;forum_n=6&amp;topic=7503.html&amp;page=0&amp;anchor=11" class="addthx" data-post="116296"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]HoBleen[/b]','')">HoBleen</a></b><br></div>
<img src="img/s6.gif" alt=""><br><img style="padding-top:3px;" src="av/5110.jpg" alt=""><br><span class=txtSm>Ранг: 240.5 (наставник)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.09'>Активность: 0.19<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=5110">Участник</a><br><font color=blue>Author of ACKiller </font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 20 января 2007 10:48 <br><script type="text/javascript">QU('HoBleen','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=HoBleen" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7503.html&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
<I>Goldy пишет:<br>Вобще мне нужно 4 байта для сохранения одного регистра и это место должно быть или в TLS или вычисляться динамически в моем куске памяти в зависемости от того под каким потоком мы работаем. </I><br>А в чем проблема? ESP для каждого потока свой, новый стек ведь тоже - так и сохраняй старый esp в новом стеке. Или я чего-то не понял?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=116297&amp;user=5110&amp;forum_n=6&amp;topic=7503.html&amp;page=0&amp;anchor=12" class="addthx" data-post="116297"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]Goldy[/b]','')">Goldy</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 4.1 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.83'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=6451">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 20 января 2007 12:43 <br><script type="text/javascript">QU('Goldy','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Goldy" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7503.html&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
Проблема в том как не используя регистров вычислить динамически в зависемости от индефикатора потока нужный кусок памяти для сохранения регистра, причем нужно это сделать не меняя ни одного регистра так как стек текущего потока  по условию трогать нельзя тоесть push отпадает. Или можно воспользоваться местом в TLS потока но для этого нужно знать какой элемент структуры можно безопасно затереть без потери функционала (пока еще не нашел).<br>Условно ситуция:<br>   Поток A-вызывает функцию F<br>   Поток В-вызывает функцию F<br>Что получается если в момент вызова A если мы используем статический адрес для сохранения esp например<br>   mov [Addr],esp<br>   выполнили команду<br>   переключились на поток B<br>   опять выполнили команду mov [Addr],esp<br>   в результате работа потока A нарушена так как восстановление esp будет из другого адреса.<br>Для исключения этой ситуации поток A должен сохранять esp в Addr1,B в Addr2 и т.д. Тоесть адрес <br>должен меняться взависемости от потока под которым работает функция. <br>Теперь надеюсь смысл понятен?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=116353&amp;user=6451&amp;forum_n=6&amp;topic=7503.html&amp;page=0&amp;anchor=13" class="addthx" data-post="116353"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]HoBleen[/b]','')">HoBleen</a></b><br></div>
<img src="img/s6.gif" alt=""><br><img style="padding-top:3px;" src="av/5110.jpg" alt=""><br><span class=txtSm>Ранг: 240.5 (наставник)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.09'>Активность: 0.19<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=5110">Участник</a><br><font color=blue>Author of ACKiller </font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 20 января 2007 12:58 <br><script type="text/javascript">QU('HoBleen','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=HoBleen" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7503.html&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
Ну тогда <br><I>HoBleen пишет:<br>ESP для каждого потока свой, новый стек ведь тоже - так и сохраняй старый esp в новом стеке. </I><br>Стек надо формировать динамически, тогда проблемма с конкретным адресом для разных потоков отпадет.<br><br>А вообще как-то слабо вериться что такое извращение необходимо ИМХО.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=116359&amp;user=5110&amp;forum_n=6&amp;topic=7503.html&amp;page=0&amp;anchor=14" class="addthx" data-post="116359"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]S_T_A_S_[/b]','')">S_T_A_S_</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 163.7 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.87'>Активность: 0.07<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=251">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 20 января 2007 18:22 &middot; Поправил: S_T_A_S_ <br><script type="text/javascript">QU('S_T_A_S_','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=S_T_A_S_" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7503.html&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
<b>Goldy</b><br>А создание процесса ты можешь контроллировать? Впринципе, твою задачу можно заметно упростить, если место под запасной стек резервировать непосредственно ниже стека треда. Тогда в хуке нужно быдет лишь отнять от esp некоторую константу. Хотя вся эта затея с подменой стека ИМХО довольно сомнительна, там что, реально есть серьёзные проверки? Скорее всего достаточно закоммитить нижнюю половину стека треда и подправить лимит, что бы ОС туда не намусорила (а часто на стеке юзается не больше нескольких десятков К, хотя в хзаголовке PE стоит 1M)
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=116387&amp;user=251&amp;forum_n=6&amp;topic=7503.html&amp;page=0&amp;anchor=15" class="addthx" data-post="116387"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]entusiast[/b]','')">entusiast</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 4.6 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.44'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1179">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 февраля 2007 02:02 &middot; Поправил: entusiast <br><script type="text/javascript">QU('entusiast','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=entusiast" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7503.html&amp;page=0#16');return false;">#16</a> </span><div align=left><br>
<b>HoBleen</b>, иногда по непонятным причинам перестает работать Win32 API в перехватчиках. У меня такое было, когда я перехватом распаковывал Ил-2. Пришлось динамически менять стек.<br><br><b>Goldy</b>,<br>примерно так. Приблизительно (!), ибо исходник сдох с переноской. <img src="img/smilies/s9.gif" alt=""><br>pushad<br>VirtualAlloc(NULL,1000h,MEM_COMMIT,PAGE_READWRITE)<br>push eax<br>add eax,1000h<br>pop dword ptr [eax] // &#039;remember&#039; buffer for furhter VirtualFree<br>sub eax,4<br>mov [eax],esp<br>sub eax,4 // &#039;remember&#039; old stack<br>Это подготовка буфера к юзу в качестве стека.<br>Дальше, если тебе нужны параметры исходной ф-ции,надо скопировать кус стека в буфер от eax вниз. <br>или же иными словами, при SZ=4+sizeof Parameters от eax-SZ вверх. Исходный вычислить от текущего esp<br>т.е. что-то вроде<br>mov esi,esp<br>add esi,0x1C // skip pushad if unneeded<br>mov edi,eax<br>mov ecx,50h // 50h байт может оказаться достаточно. Если мало - увеличь<br>sub edi,ecx<br>shr ecx,2<br>rep movsd // скопировали кусок старого стека.<br>sub edi,50h // откатили edi обратно вниз. (***)<br>mov esp,edi // все. Стек переадресован.<br>Call  OurAPIReplaceFunction// получит первым параметром RetAddress вызванной, далее, как положено.<br>После возврата, стек указывает в наш буфер. Надо восстановить.<br>mov esi,esp<br>and esi,1000h<br>add esi,0FF8h<br>mov esp,[esi]// по идее, если нет ошибок, стек должен восстановиться.<br>push eax // сохраняем результат<br>add esi,4<br>push MEM_RELEASE<br>push  0<br>push dword ptr[esi]<br>call VirtualFree<br>pop eax // взяли в еах рензультат<br>mov [esp+....],eax // вместо .... смещение в стеке такое, чтоб после popad eax попал в еах.<br>popad<br>retn<br>(***) - Надо уточнять смещения. Я постоянно промахиваюсь на +/-1 после блочных операций, мог слажать.<br>Идея понятна?<br><br>PS. Это работает для __stdcall &amp; __cdecl, где параметры передаются только стеком. для __фастколл надо передавать и контекст и стек.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=119140&amp;user=1179&amp;forum_n=6&amp;topic=7503.html&amp;page=0&amp;anchor=16" class="addthx" data-post="119140"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]Goldy[/b]','')">Goldy</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 4.1 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.83'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=6451">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 февраля 2007 03:50 <br><script type="text/javascript">QU('Goldy','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Goldy" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7503.html&amp;page=0#17');return false;">#17</a> </span><div align=left><br>
Хех сам алгоритм переадресации стека у меня и так давно написан и работает. Ты лучше скажи как это сделать вобще не трогая стека исследуемой программы. А у тебя первой же командой pushad затирается нижний байты старого стека, которые могут отслеживаться программой <img src="img/smilies/s1.gif" alt=""><br>Идея S_T_A_S_ наиболее предпочтительна, но при этом приходится жертвовать большим кол-вом памяти в случае большого числа потоков.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=119164&amp;user=6451&amp;forum_n=6&amp;topic=7503.html&amp;page=0&amp;anchor=17" class="addthx" data-post="119164"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]entusiast[/b]','')">entusiast</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 4.6 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.44'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1179">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 февраля 2007 08:14 <br><script type="text/javascript">QU('entusiast','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=entusiast" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7503.html&amp;page=0#18');return false;">#18</a> </span><div align=left><br>
<b>Goldy</b>, понятно, сорри. Я не углядел условия о неизменности стека.  но, кстати, даже обращение к TLS все-таки требует &quot;порчи&quot; стека регистров... Т.е. даже если ты знаешь индекс, то TLSSetValue все равно через стек работает....<br>А насчет идеи S_T_A_S, то вопрос-  как не трогая ничего определить ThreadID? Даже, если есть обходной путь без вызовов АПИ (а он, кстати, есть?), то.... а что.... можно попробовать ковырнуть TEB, если я, конечно, правильно понял эту структуру. Там есть поля Spare2-Spare4 ULONG каждый. Может, так выйдет..... <br>Смотрю ntundoc, структуры TEB и NT_TIB - похоже, все-таки, это оно доступно через селектор fs:....<br>Попробуй, может, выйдет чего...... Тогда можно в Spare записать нужный адрес при создании потока.... <br>Но тут у меня практики никакой - с этими структами я только в области SEH и IsDebuggerPresent общался.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=119235&amp;user=1179&amp;forum_n=6&amp;topic=7503.html&amp;page=0&amp;anchor=18" class="addthx" data-post="119235"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]HoBleen[/b]','')">HoBleen</a></b><br></div>
<img src="img/s6.gif" alt=""><br><img style="padding-top:3px;" src="av/5110.jpg" alt=""><br><span class=txtSm>Ранг: 240.5 (наставник)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.09'>Активность: 0.19<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=5110">Участник</a><br><font color=blue>Author of ACKiller </font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 февраля 2007 08:32 <br><script type="text/javascript">QU('HoBleen','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=HoBleen" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7503.html&amp;page=0#19');return false;">#19</a> </span><div align=left><br>
<b>Goldy</b><br>Можешь с помощью эмуляции RtlEnterCriticalSection (Через Lock inc без использования стека) использовать способ и для многопоточного приложения - статическая область памяти используется как временный стек для создания нового стека. После xxxAlloc заменяешь стек и освобождаешь этот временный, после этого другой поток может использовать его для создания своего стека.<br><br>Думаю, основной момент понятен?<img src="img/smilies/s1.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=119240&amp;user=5110&amp;forum_n=6&amp;topic=7503.html&amp;page=0&amp;anchor=19" class="addthx" data-post="119240"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Как потокобезопасно подменить стек не трогая стек исходного потока</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#20" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="6">
<input type="hidden" name="topic" value="7503">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=7503" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
