<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Лоадер -  отладчик на ассме - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Нужно создать лоадер в виде мини отладчика: сабж должен тормознуть отлаживаемый процесс, когда у того в EIP будет определенный адрес. Как сие заюзать? Начальный код на MASM-е: .486              .model flat, stdcall     option">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=26261'>bartolomeo</a>, <a target='_blank' href='?action=userinfo&amp;user=39467'>hgdagon</a> (+7 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Лоадер -  отладчик на ассме</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]YDS[/b]','')">YDS</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/132.jpg" alt=""><br><span class=txtSm>Ранг: 199.9 (ветеран), 4thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.92'>Активность: 0.12<span style='color:red'>&searr;</span>0.02</span><br>Статус: <a href="action=userinfo&amp;user=132">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 марта 2006 19:49 &middot; Поправил: YDS <br><script type="text/javascript">QU('YDS','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=YDS" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=4365.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Нужно создать лоадер в виде мини отладчика: сабж должен тормознуть отлаживаемый процесс, когда у того в EIP будет определенный адрес. Как сие заюзать?
<br>
<br>Начальный код на MASM-е:
<br>
<br>.486                           
<br>.model flat, stdcall
<br>       
<br>option casemap :none
<br>
<br>include &#92;masm32&#92;include&#92;windows.inc
<br>include &#92;masm32&#92;include&#92;masm32.inc
<br>include &#92;masm32&#92;include&#92;user32.inc
<br>include &#92;masm32&#92;include&#92;kernel32.inc
<br>include &#92;masm32&#92;include&#92;shell32.inc
<br>includelib &#92;masm32&#92;lib&#92;masm32.lib     
<br>includelib &#92;masm32&#92;lib&#92;user32.lib
<br>includelib &#92;masm32&#92;lib&#92;kernel32.lib
<br>includelib &#92;masm32&#92;lib&#92;shell32.lib
<br>
<br>.data  
<br>App   db    &quot;Proga&quot;,0
<br>Err1  db    &quot;Program not found <img src="img/smilies/s9.gif" alt="">&quot;,0  ; Обломов  
<br>prog  db    &quot;programm.exe&quot;,0           ; Имя проги   
<br>bufwr DWORD 00h                       ; Мне нужно байт 00 поменять на 01
<br>va    DWORD 415E12h                 ; Это адрес, при обращении к оторому надо тормознуть процесс ипроизвести запись  
<br>
<br>.data?  
<br>bufr dw ?                             ; Байт, в который производится чтение   
<br>pinfo PROCESS_INFORMATION &lt;&gt;          ; Инфа о процессе  
<br>sinfo STARTUPINFO &lt;&gt;                  ; инфа о запуске  
<br>n DWORD ?                             ; Кол-во байтов .code  
<br>
<br>.code
<br>
<br>start:
<br>
<br>invoke CreateProcess,addr prog,NULL,NULL,NULL,FALSE, CREATE_NEW_CONSOLE OR NORMAL_PRIORITY_CLASS,NULL,NULL,addr sinfo,addr pinfo ; Создаем процесс
<br>
<br>.IF eax == 0                           ; Если прога не запустилась
<br>    invoke MessageBox,NULL,addr Err1,addr App,MB_OK
<br>    invoke ExitProcess,0
<br>.ENDIF 
<br>
<br>.WHILE TRUE
<br>        .IF eip == va ; ВОТ ТУТ КАК ЗАДАТЬ ПРОВЕРКУ ОТЛАЖИВАЕМОГО ПРОЦЕССА (регистра eip MASM не знает)
<br>           invoke Sleep,300
<br>           mov byte ptr [eax+20], bufwr ; из-за чего весь сыр-бор - править приходится память по ссылке
<br>           invoke CloseHandle,pinfo.hThread 
<br>           invoke ExitProcess,0
<br>     .ENDIF 
<br>.ENDW  
<br>
<br>end start
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=59339&amp;user=132&amp;forum_n=6&amp;topic=4365.html&amp;page=0&amp;anchor=1" class="addthx" data-post="59339"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]Ara[/b]','')">Ara</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/24.jpg" alt=""><br><span class=txtSm>Ранг: 1288.1 <b><u>(!!!!)</u></b>, 273thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.96'>Активность: 1.29<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=24">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 марта 2006 20:08 <br><script type="text/javascript">QU('Ara','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Ara" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=4365.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
<I>YDS пишет:
<br>ВОТ ТУТ КАК ЗАДАТЬ ПРОВЕРКУ ОТЛАЖИВАЕМОГО ПРОЦЕССА (регистра eip MASM не знает) </I>
<br>Вообще отладчик изначально написан неверно. Тебе нужен контекст отлаживаемого процесса, а у тебя процесс вообще не отлаживается, а просто тупо запускается. Почитал бы теорию чтоли...
<br>
<br><a href="http://exelab.ru/art/?action=view&amp;id=75
" target="_new">http://exelab.ru/art/?action=view&amp;id=75
</a><br><a href="http://exelab.ru/art/?action=view&amp;id=74" target="_new">http://exelab.ru/art/?action=view&amp;id=74</a>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=59343&amp;user=24&amp;forum_n=6&amp;topic=4365.html&amp;page=0&amp;anchor=2" class="addthx" data-post="59343"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]YDS[/b]','')">YDS</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/132.jpg" alt=""><br><span class=txtSm>Ранг: 199.9 (ветеран), 4thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.92'>Активность: 0.12<span style='color:red'>&searr;</span>0.02</span><br>Статус: <a href="action=userinfo&amp;user=132">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 марта 2006 20:21 &middot; Поправил: YDS <br><script type="text/javascript">QU('YDS','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=YDS" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=4365.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
<I>Ara </I>
<br>
<br>Спасибо!
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=59349&amp;user=132&amp;forum_n=6&amp;topic=4365.html&amp;page=0&amp;anchor=3" class="addthx" data-post="59349"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]YDS[/b]','')">YDS</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/132.jpg" alt=""><br><span class=txtSm>Ранг: 199.9 (ветеран), 4thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.92'>Активность: 0.12<span style='color:red'>&searr;</span>0.02</span><br>Статус: <a href="action=userinfo&amp;user=132">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 марта 2006 22:09 <br><script type="text/javascript">QU('YDS','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=YDS" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=4365.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
М-да, вот тут <a href="http://exelab.ru/art/?action=view&amp;id=75" target="_new">http://exelab.ru/art/?action=view&amp;id=75</a> код весьма интересный, только под XP не рабочий (под Win98 и не пробовал). Полазив, нашел продолжение: <a href="http://xtin.km.ru/view.shtml?id=129." target="_new">http://xtin.km.ru/view.shtml?id=129.</a> Доработал с учетом последнего до такого состояния:
<br>
<br>unit Unit1;
<br>
<br>interface
<br>
<br>uses
<br>  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
<br>  Dialogs, StdCtrls;
<br>
<br>type
<br>  TForm1 = class(TForm)
<br>    Edit1: TEdit;
<br>    Memo1: TMemo;
<br>    Button1: TButton;
<br>    procedure Button1Click(Sender: TObject);
<br>  private
<br>    { Private declarations }
<br>  public
<br>    { Public declarations }
<br>  end;
<br>
<br>function OpenThread(dwDesiredAccess: DWord; bInheritHandle: Bool;
<br>  dwThreadId: DWord): DWord; stdcall; external &#039;kernel32.dll&#039;;
<br>
<br>var
<br>Form1: TForm1;
<br>sti:tstartupinfo;
<br>lpPi:tprocessinformation;
<br>DE:_Debug_event;
<br>Cont:_Context;
<br>hProc : dword;
<br>
<br>implementation
<br>
<br>{&#036;R *.dfm}
<br>
<br>procedure TForm1.Button1Click(Sender: TObject);
<br>begin
<br>
<br>if not CreateProcess(nil,&#039;c:&#92;Windows&#92;notepad.exe&#039;,nil,nil,false,DEBUG_PROCESS  or DEBUG_ONLY_THIS_PROCESS,nil,nil,StI,lpPI) then
<br>        begin
<br>                messageboxa(0,&#039;Процесс не создан!&#039;,&#039;Error&#039;,MB_ICONQUESTION);
<br>                halt;
<br>        end;
<br>
<br>hproc := 0;
<br>While true do
<br>Begin
<br> if WaitForDebugEvent(de,INFINITE) then
<br> Begin
<br>  hProc := OpenThread(&#036;1F03FF,False,DE.dwThreadid);
<br>  if de.dwDebugEventCode=EXCEPTION_DEBUG_EVENT then
<br>  if DE.Exception.ExceptionRecord.ExceptionCode=EXCEPTION_BREAKPOINT then
<br>  Begin
<br>   cont.ContextFlags:=CONTEXT_CONTROL;
<br>   GetThreadContext(hProc,cont);
<br>   cont.EFlags:=cont.EFlags or &#036;100;
<br>   setThreadContext(hProc,cont);
<br>  end
<br>  Else
<br>  if DE.Exception.ExceptionRecord.ExceptionCode=EXCEPTION_SINGLE_STEP then
<br>  Begin
<br>   GetThreadContext(hProc,cont);
<br>   cont.EFlags:=cont.EFlags or &#036;100;
<br>   setThreadContext(hProc,cont);
<br>//   if (cont.eip&gt;&#036;400000) and (cont.eip&lt;&#036;600000) then
<br>   Begin
<br>    Memo1.Lines.Add(inttohex(cont.eip,8));
<br>//   Showmessage(&#039;OEP=&#039;+inttohex(cont.eip,8));
<br>//   halt;
<br>   end;
<br>  end;
<br>  ContinueDebugEvent(DE.dwProcessId, DE.dwThreadid,DBG_CONTINUE);
<br> end;
<br>
<br> application.ProcessMessages;
<br>end; //конец бесконечного цикла
<br>
<br>end;
<br>
<br>end.
<br>
<br>Но все равно: вместо адресов запущенного процесса получаю EIP-ы выполняемых API<img src="img/smilies/s13.gif" alt="">. Что тут не так?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=59374&amp;user=132&amp;forum_n=6&amp;topic=4365.html&amp;page=0&amp;anchor=4" class="addthx" data-post="59374"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]DillerInc[/b]','')">DillerInc</a></b><br></div>
<img src="img/s6.gif" alt=""><br><img style="padding-top:3px;" src="av/1613.gif" alt=""><br><span class=txtSm>Ранг: 283.6 (наставник), 56thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.25'>Активность: 0.13<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1613">Участник</a><br><font color=blue>Author of GeTaOEP</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 марта 2006 00:09 &middot; Поправил: DillerInc <br><script type="text/javascript">QU('DillerInc','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DillerInc" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=4365.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
<b>YDS</b>
<br>Точно не могу сказать,но первое,что бросается в глаза -- это функция OpenThread.
<br>За чем она тебе?Ты же создал процесс,ты в нём хозяин.И обращаться к основному потоку можно с лёгкостью через структуру TProcessInformation,которая у тебя заполнится после вызова CreateProcess:
<br>lpPi.hThread
<br>GetThreadContext(lpPi.hThread, cont);
<br>...а не через одно место,используя функцию OpenThread <img src="img/smilies/s11.gif" alt=""> .
<br>
<br>Далее мне не совсем понятно,что ты хочешь сделать с помощью команд:
<br>cont.EFlags:=cont.EFlags or &#036;100;
<br>setThreadContext(hProc,cont);
<br><img src="img/smilies/s11.gif" alt="">
<br>______________
<br>
<br>Посмотрел тот пример,указанный по ссылке -- второй пункт отпал <img src="img/smilies/s1.gif" alt=""> .
<br><br><font size="1"><i>-----<br>the Power of Reversing team</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=59391&amp;user=1613&amp;forum_n=6&amp;topic=4365.html&amp;page=0&amp;anchor=5" class="addthx" data-post="59391"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]AlexZ[/b]','')">AlexZ</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 203.3 (наставник)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.9'>Активность: 0.22<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=175">Участник</a><br><font color=blue>UPX Killer -d</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 марта 2006 09:46 &middot; Поправил: AlexZ <br><script type="text/javascript">QU('AlexZ','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=AlexZ" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=4365.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
<b>YDS</b> читай тутор icezelion&#039;a. Он есть на wasm.ru
<br>Сам делал трейсер - в ринг-3 нельзя проходить с флажком TF команду SYSENTER в XP SP-1
<br>
<br>+1 структра контекста должна быть выровнена хотяб по dword
<br><code>align dword</code>
<br>Откопал свой сорц. Только он тормозит прогу на EIP чуть иначе - это чтоб на ХП СП-1 работало. Я уже говорил что бага не то с SYSCALL не то с SYSENTER есть на SP-1.
<br><br><font size="1"><i>-----<br>Я медленно снимаю с неё UPX... *FF_User*</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=59439&amp;user=175&amp;forum_n=6&amp;topic=4365.html&amp;page=0&amp;anchor=6" class="addthx" data-post="59439"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]AlexZ[/b]','')">AlexZ</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 203.3 (наставник)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.9'>Активность: 0.22<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=175">Участник</a><br><font color=blue>UPX Killer -d</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 марта 2006 10:07 <br><script type="text/javascript">QU('AlexZ','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=AlexZ" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=4365.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
//Если поправить пост и вложить файл - то он не цепляется.<br><br><img src="img/attach.gif" alt=""> <a href="./files/331f_traicer+by+AlexZ.zip.zip">331f_traicer+by+AlexZ.zip.zip</a>
<br><br><font size="1"><i>-----<br>Я медленно снимаю с неё UPX... *FF_User*</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=59444&amp;user=175&amp;forum_n=6&amp;topic=4365.html&amp;page=0&amp;anchor=7" class="addthx" data-post="59444"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]YDS[/b]','')">YDS</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/132.jpg" alt=""><br><span class=txtSm>Ранг: 199.9 (ветеран), 4thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.92'>Активность: 0.12<span style='color:red'>&searr;</span>0.02</span><br>Статус: <a href="action=userinfo&amp;user=132">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 марта 2006 10:14 <br><script type="text/javascript">QU('YDS','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=YDS" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=4365.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
<I>AlexZ </I>
<br>Файл дейстивтельно не цепляется. Выложи еще разок, plz
<br>
<br><I>DillerInc</I>
<br>А если процесс многопоточный?? Вот тут: xtin.km.ru/view.shtml?id=129 HEX про это и пишет.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=59446&amp;user=132&amp;forum_n=6&amp;topic=4365.html&amp;page=0&amp;anchor=8" class="addthx" data-post="59446"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]PE_Kill[/b]','')">PE_Kill</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3232.gif" alt=""><br><span class=txtSm>Ранг: 793.4 <font color=magenta>(<b>! !</b>)</font>, 568thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.59'>Активность: 0.74<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3232">Участник</a><br><font color=blue>Шаман</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 марта 2006 12:04 <br><script type="text/javascript">QU('PE_Kill','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=PE_Kill" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=4365.html&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
<I>DillerInc пишет:
<br>OpenThread. За чем она тебе? </I>
<br>Если процесс многопоточный, то, при exception&#039;е в одном из побочных потоков, трейсер, который использует только структуру TProcessInformation, не сможет считать структуру Context, так как не будет иметь его указателя.
<br>
<br>И вообще в современных многомегабайтовых прогах окончание работы трейсера не дождешься. Надо юзать бряки. Хардварные конечно сложновато с их битовыми масками, но все же можно, тем более, что инфы сейчас много всякой. Самое простое - это вставлять байт CC (INT3) и при срабатывании вставлять оригинальный байт на место. Можно юзать также флажок PAGE_GUARD у атрибутов страницы памяти. При добавлении этого флага при обращении к странице памяти генерируется исключение EXCEPTION_GUARD_PAGE и флажок сбрасывается. А еще... Да много чего еще <img src="img/smilies/s1.gif" alt="">
<br><br><font size="1"><i>-----<br>Yann Tiersen best and do not fuck</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=59465&amp;user=3232&amp;forum_n=6&amp;topic=4365.html&amp;page=0&amp;anchor=9" class="addthx" data-post="59465"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]PE_Kill[/b]','')">PE_Kill</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3232.gif" alt=""><br><span class=txtSm>Ранг: 793.4 <font color=magenta>(<b>! !</b>)</font>, 568thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.59'>Активность: 0.74<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3232">Участник</a><br><font color=blue>Шаман</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 марта 2006 12:08 <br><script type="text/javascript">QU('PE_Kill','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=PE_Kill" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=4365.html&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
<I>DillerInc пишет:
<br>Далее мне не совсем понятно,что ты хочешь сделать с помощью команд: 
<br>cont.EFlags:=cont.EFlags or &#036;100; 
<br>setThreadContext(hProc,cont);  </I>
<br>
<br>А это установка режима пошаговой трассировки кода. (Выставляется флаг TF)
<br><br><font size="1"><i>-----<br>Yann Tiersen best and do not fuck</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=59468&amp;user=3232&amp;forum_n=6&amp;topic=4365.html&amp;page=0&amp;anchor=10" class="addthx" data-post="59468"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]PE_Kill[/b]','')">PE_Kill</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3232.gif" alt=""><br><span class=txtSm>Ранг: 793.4 <font color=magenta>(<b>! !</b>)</font>, 568thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.59'>Активность: 0.74<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3232">Участник</a><br><font color=blue>Шаман</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 марта 2006 12:19 <br><script type="text/javascript">QU('PE_Kill','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=PE_Kill" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=4365.html&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
<I>YDS пишет:
<br>Но все равно: вместо адресов запущенного процесса получаю EIP-ы выполняемых API </I>
<br>После создания процесса прога тормозится в виндовом лоадере и ты по сути начинаешь трассировать именно его. Если очень очень долго подождешь, то увидишь адреса проги. Ты пишешь трейсер по первой статье, а тебе нужна вторая про бряки. Там сначала ожидается пока прога тормознет на EP а потом можно делать все что угодно.
<br><br><font size="1"><i>-----<br>Yann Tiersen best and do not fuck</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=59469&amp;user=3232&amp;forum_n=6&amp;topic=4365.html&amp;page=0&amp;anchor=11" class="addthx" data-post="59469"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]AlexZ[/b]','')">AlexZ</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 203.3 (наставник)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.9'>Активность: 0.22<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=175">Участник</a><br><font color=blue>UPX Killer -d</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 марта 2006 13:36 <br><script type="text/javascript">QU('AlexZ','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=AlexZ" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=4365.html&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
по просьбам цепляю файл ещё раз<br><br><img src="img/attach.gif" alt=""> <a href="./files/9a99_Traicer_by_AlexZ.zip.zip">9a99_Traicer_by_AlexZ.zip.zip</a>
<br><br><font size="1"><i>-----<br>Я медленно снимаю с неё UPX... *FF_User*</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=59482&amp;user=175&amp;forum_n=6&amp;topic=4365.html&amp;page=0&amp;anchor=12" class="addthx" data-post="59482"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]Mixa[/b]','')">Mixa</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 9.2 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.6'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=3178">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 марта 2006 13:49 <br><script type="text/javascript">QU('Mixa','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Mixa" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=4365.html&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
<b>PE_Kill</b> 
<br>Скажи пожалуйста, а ты можешь сделать простенький пример - трейсер с бряками на БилдерС++ ?
<br>А то я асм недавно учу, С++ знаю лучше. Хотел посмотреть, а то народ хвалит.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=59483&amp;user=3178&amp;forum_n=6&amp;topic=4365.html&amp;page=0&amp;anchor=13" class="addthx" data-post="59483"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]PE_Kill[/b]','')">PE_Kill</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3232.gif" alt=""><br><span class=txtSm>Ранг: 793.4 <font color=magenta>(<b>! !</b>)</font>, 568thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.59'>Активность: 0.74<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3232">Участник</a><br><font color=blue>Шаман</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 марта 2006 14:04 <br><script type="text/javascript">QU('PE_Kill','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=PE_Kill" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=4365.html&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
<I>Mixa пишет:
<br>Хотел посмотреть, а то народ хвалит </I>
<br>Что народ хвалит? Я только Delphi знаю и немного асм (минимум реверсера). На Delphi могу накидать. Хотя нет, вспомнил. Есть у меня и на C++ пример дебагера. Завтра приатачу.
<br><br><font size="1"><i>-----<br>Yann Tiersen best and do not fuck</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=59487&amp;user=3232&amp;forum_n=6&amp;topic=4365.html&amp;page=0&amp;anchor=14" class="addthx" data-post="59487"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]YDS[/b]','')">YDS</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/132.jpg" alt=""><br><span class=txtSm>Ранг: 199.9 (ветеран), 4thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.92'>Активность: 0.12<span style='color:red'>&searr;</span>0.02</span><br>Статус: <a href="action=userinfo&amp;user=132">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 марта 2006 14:23 &middot; Поправил: YDS <br><script type="text/javascript">QU('YDS','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=YDS" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=4365.html&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
И снова х-мм! <img src="img/smilies/s1.gif" alt="">
<br>Второй пример от <b>HEX-а</b> и трейсер от <b>AlexZ</b> работают, но только с однопотоковыми приложениями. У меня же на разборе тулза, которая при своем запуске создает три потока: первые 2 отладочных (в момент запуска оба пустых), третий - основной. Нужно перейти в конктекст последнего и вправлять мозги ему. Вопрос как это сделать.
<br>
<br>Код такой. Начало имеем стандартное:
<br>
<br>CreateProcess(nil,&#039;c:&#92;Tulza.exe,nil,nil,false,DEBUG_PROCESS or DEBUG_ONLY_THIS_PROCESS or Create_suspended,nil,nil,StI,lpPI)
<br>
<br>Потом пробую перебирать все триды в поисках того, у которого по адресу EP что-то есть:
<br>
<br>hproc := 0; // хэндл потока
<br>While true do
<br>Begin
<br> if WaitForDebugEvent(de,INFINITE) then
<br>    begin
<br>    hProc := OpenThread(&#036;1F03FF,False,DE.dwThreadid); // читаем хэндл потока
<br>    readprocessmemory(hProc,pointer(x),@b[0],1,i); //читаем байт по EP - x
<br>    if b[0] &lt;&gt; &#036;0 then break; // там не пусто - выходим из цикла для продолжения.
<br>    end;
<br>  ContinueDebugEvent(DE.dwProcessId, DE.dwThreadid,DBG_CONTINUE);
<br>end;
<br>
<br>В теории вроде все как надо. На деле поток не находится. Чего делаю не так.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=59493&amp;user=132&amp;forum_n=6&amp;topic=4365.html&amp;page=0&amp;anchor=15" class="addthx" data-post="59493"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]DillerInc[/b]','')">DillerInc</a></b><br></div>
<img src="img/s6.gif" alt=""><br><img style="padding-top:3px;" src="av/1613.gif" alt=""><br><span class=txtSm>Ранг: 283.6 (наставник), 56thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.25'>Активность: 0.13<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1613">Участник</a><br><font color=blue>Author of GeTaOEP</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 марта 2006 18:17 <br><script type="text/javascript">QU('DillerInc','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DillerInc" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=4365.html&amp;page=0#16');return false;">#16</a> </span><div align=left><br>
<I>PE_Kill пишет:
<br>Если процесс многопоточный, то, при exception&#039;е в одном из побочных потоков, трейсер, который использует только структуру TProcessInformation, не сможет считать структуру Context, так как не будет иметь его указателя.</I>
<br>...спасибо,будем иметь в виду <img src="img/smilies/s1.gif" alt=""> .
<br><br><font size="1"><i>-----<br>the Power of Reversing team</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=59519&amp;user=1613&amp;forum_n=6&amp;topic=4365.html&amp;page=0&amp;anchor=16" class="addthx" data-post="59519"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]AlexZ[/b]','')">AlexZ</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 203.3 (наставник)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.9'>Активность: 0.22<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=175">Участник</a><br><font color=blue>UPX Killer -d</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 марта 2006 19:33 &middot; Поправил: AlexZ <br><script type="text/javascript">QU('AlexZ','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=AlexZ" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=4365.html&amp;page=0#17');return false;">#17</a> </span><div align=left><br>
<I>YDS пишет:
<br>DEBUG_ONLY_THIS_PROCESS </I>
<br>Ну, это не дело - этот флажок убрать. А если с ним, то будет дебужиццо только главный трэд.
<br><b>YDS</b>
<br>Вообще знаешь, я не думаю что этот код является верным подходом к отладке многопоточных приложений.
<br><br><font size="1"><i>-----<br>Я медленно снимаю с неё UPX... *FF_User*</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=59537&amp;user=175&amp;forum_n=6&amp;topic=4365.html&amp;page=0&amp;anchor=17" class="addthx" data-post="59537"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]YDS[/b]','')">YDS</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/132.jpg" alt=""><br><span class=txtSm>Ранг: 199.9 (ветеран), 4thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.92'>Активность: 0.12<span style='color:red'>&searr;</span>0.02</span><br>Статус: <a href="action=userinfo&amp;user=132">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 марта 2006 20:14 <br><script type="text/javascript">QU('YDS','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=YDS" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=4365.html&amp;page=0#18');return false;">#18</a> </span><div align=left><br>
<I>AlexZ пишет:
<br>я не думаю что этот код является верным подходом к отладке многопоточных приложений </I>
<br>
<br>Я это и сам вижу, поскольку не пашет ничего <img src="img/smilies/s5.gif" alt=""> А каков верный подход <img src="img/smilies/s3.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=59551&amp;user=132&amp;forum_n=6&amp;topic=4365.html&amp;page=0&amp;anchor=18" class="addthx" data-post="59551"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]PE_Kill[/b]','')">PE_Kill</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3232.gif" alt=""><br><span class=txtSm>Ранг: 793.4 <font color=magenta>(<b>! !</b>)</font>, 568thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.59'>Активность: 0.74<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3232">Участник</a><br><font color=blue>Шаман</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 марта 2006 13:14 <br><script type="text/javascript">QU('PE_Kill','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=PE_Kill" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=4365.html&amp;page=0#19');return false;">#19</a> </span><div align=left><br>
<I>AlexZ пишет:
<br>Вообще знаешь, я не думаю что этот код является верным подходом к отладке многопоточных приложений </I>
<br>У меня все нормально работает. Доказателство - прога, пакованая ExeCryptor&#039;ом запускается и нормально работает. А в ExeCryptor&#039;е потоки каждую секунду создаются,убиваются и флудят исключениями, что и фиксирует мой трейсер.
<br>
<br><I>AlexZ пишет:
<br>DEBUG_ONLY_THIS_PROCESS. Ну, это не дело - этот флажок убрать  </I>
<br>Мой трейсер работает с этим флажком, и насколько я понял из MSDN дебажица будет не главный тред, а процесс, который ты запустил, а иначе будет дебужится и процесс, который был создан процессом - жертвой.
<br><br><font size="1"><i>-----<br>Yann Tiersen best and do not fuck</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=59703&amp;user=3232&amp;forum_n=6&amp;topic=4365.html&amp;page=0&amp;anchor=19" class="addthx" data-post="59703"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="20" onfocus="this.blur()" href="JavaScript:di('[b]PE_Kill[/b]','')">PE_Kill</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3232.gif" alt=""><br><span class=txtSm>Ранг: 793.4 <font color=magenta>(<b>! !</b>)</font>, 568thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.59'>Активность: 0.74<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3232">Участник</a><br><font color=blue>Шаман</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 марта 2006 13:20 <br><script type="text/javascript">QU('PE_Kill','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=PE_Kill" target="_blank">Личное сообщение</a> &middot;  <a href="#20" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=4365.html&amp;page=0#20');return false;">#20</a> </span><div align=left><br>
to <b>YDS</b>
<br>&gt; CreateProcess(nil,&#039;c:&#92;Tulza.exe,nil,nil,false,DEBUG_PROCESS or DEBUG_ONLY_THIS_PROCESS or <b>Create_suspended</b>,nil,nil,StI,lpPI)
<br>Ты создаешь замороженый процесс и я не вижу, где ты его размораживаешь. (ResumeThread)
<br><br><font size="1"><i>-----<br>Yann Tiersen best and do not fuck</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=59704&amp;user=3232&amp;forum_n=6&amp;topic=4365.html&amp;page=0&amp;anchor=20" class="addthx" data-post="59704"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="21" onfocus="this.blur()" href="JavaScript:di('[b]PE_Kill[/b]','')">PE_Kill</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3232.gif" alt=""><br><span class=txtSm>Ранг: 793.4 <font color=magenta>(<b>! !</b>)</font>, 568thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.59'>Активность: 0.74<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3232">Участник</a><br><font color=blue>Шаман</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 марта 2006 15:03 <br><script type="text/javascript">QU('PE_Kill','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=PE_Kill" target="_blank">Личное сообщение</a> &middot;  <a href="#21" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=4365.html&amp;page=0#21');return false;">#21</a> </span><div align=left><br>
Перечитал мануалы:
<br>DEBUG_ONLY_THIS_PROCESS не влияет на потоки, а влияет только на количество одновременно отлаживаемых прцессов.
<br>
<br>Приаттачиваю доки, с которых я начинал писать свой отладчик, а затем полностью перешел на MSDN.
<br>Там есть пример на С и Delphi юнит из трейнера (не моего).<br><br><img src="img/attach.gif" alt=""> <a href="./files/141b_debuggers.rar.zip">141b_debuggers.rar.zip</a>
<br><br><font size="1"><i>-----<br>Yann Tiersen best and do not fuck</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=59717&amp;user=3232&amp;forum_n=6&amp;topic=4365.html&amp;page=0&amp;anchor=21" class="addthx" data-post="59717"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="22" onfocus="this.blur()" href="JavaScript:di('[b]seeq[/b]','')">seeq</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/3067.jpg" alt=""><br><span class=txtSm>Ранг: 105.9 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.64'>Активность: 0.06<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3067">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 марта 2006 18:51 <br><script type="text/javascript">QU('seeq','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=seeq" target="_blank">Личное сообщение</a> &middot;  <a href="#22" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=4365.html&amp;page=0#22');return false;">#22</a> </span><div align=left><br>
Debugger template for Masm (BPX BPM BPR)
<br>drizz.has.it/
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=59764&amp;user=3067&amp;forum_n=6&amp;topic=4365.html&amp;page=0&amp;anchor=22" class="addthx" data-post="59764"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="23" onfocus="this.blur()" href="JavaScript:di('[b]diamondz[/b]','')">diamondz</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 3.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.89'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=2442">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 марта 2006 18:52 <br><script type="text/javascript">QU('diamondz','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=diamondz" target="_blank">Личное сообщение</a> &middot;  <a href="#23" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=4365.html&amp;page=0#23');return false;">#23</a> </span><div align=left><br>
При создании нового потока отладчику приходит соответствующее сообщение, в котором, в частности, указан хэндл этого потока. За подробностями - MSDN, структура DEBUG_EVENT.
<br>Флаг DEBUG_ONLY_THIS_PROCESS означает всего лишь, что если отлаживаемый процесс создаст новый (CreateProcess(...)), то отладчик не становится отладчиком еще и этого нового процесса (по умолчанию - становится).
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=59765&amp;user=2442&amp;forum_n=6&amp;topic=4365.html&amp;page=0&amp;anchor=23" class="addthx" data-post="59765"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="24" onfocus="this.blur()" href="JavaScript:di('[b]DillerInc[/b]','')">DillerInc</a></b><br></div>
<img src="img/s6.gif" alt=""><br><img style="padding-top:3px;" src="av/1613.gif" alt=""><br><span class=txtSm>Ранг: 283.6 (наставник), 56thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.25'>Активность: 0.13<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1613">Участник</a><br><font color=blue>Author of GeTaOEP</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 марта 2006 19:06 <br><script type="text/javascript">QU('DillerInc','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DillerInc" target="_blank">Личное сообщение</a> &middot;  <a href="#24" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=4365.html&amp;page=0#24');return false;">#24</a> </span><div align=left><br>
<I>YDS пишет:
<br>DEBUG_PROCESS or DEBUG_ONLY_THIS_PROCESS or Create_suspended </I>
<br>...по-моему,получается какое-то масло масляное.
<br>Если ты создаёшь процесс с флагом CREATE_SUSPENDED,то,как правильно подметил <b>PE_Kill</b>,главный поток создаваемого процесса не запустится,пока ты не вызовешь функцию ResumeThread.
<br>Далее на MSDN сказано,что:
<br><I>If this flag(DEBUG_PROCESS) is combined with DEBUG_ONLY_THIS_PROCESS, the caller debugs only the new process.</I>
<br>...поэтому толку от использования обоих флагов совместно -- нет.
<br>И если я не ошибаюсь,то при использовании флага DEBUG_PROCESS/DEBUG_ONLY_THIS_PROCESS процесс и так создаётся как бы в замороженном состоянии... зачем тогда CREATE_SUSPENDED ... <img src="img/smilies/s11.gif" alt=""> .
<br><br><font size="1"><i>-----<br>the Power of Reversing team</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=59768&amp;user=1613&amp;forum_n=6&amp;topic=4365.html&amp;page=0&amp;anchor=24" class="addthx" data-post="59768"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Лоадер -  отладчик на ассме</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#25" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="6">
<input type="hidden" name="topic" value="4365">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=4365" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
