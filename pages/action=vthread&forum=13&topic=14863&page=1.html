<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Исследование защиты Themida - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Решил тут поразбираться со страшным зверем которого зовут Themida. Причем не так, как большинство - как бы получше сграбить дамп, чтоб проверки протектора обмануть, а именно по хакерски - дизассемблировать и понять структуру">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b> (+7 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/aspro.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=13&sortBy=0&page=0.html"><b>Протекторы</b></a> <b class=bulletHead>&#8212;&#8250;</b> Исследование защиты Themida</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> <a href="action=vthread&amp;forum=13&amp;topic=14863&amp;page=0.html">&lt;&lt;</a> .  <a href="action=vthread&amp;forum=13&amp;topic=14863&amp;page=0.html">1</a> . <b>2</b> . <a href="action=vthread&amp;forum=13&amp;topic=14863&amp;page=2.html">3</a> . <a href="action=vthread&amp;forum=13&amp;topic=14863&amp;page=2.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]blueboar2[/b]','')">blueboar2</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 16.0 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.91'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=22032">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 13 августа 2009 09:51 &middot; Поправил: blueboar2 <br><script type="text/javascript">QU('blueboar2','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=blueboar2" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=14863&amp;page=1#1');return false;">#1</a> </span><div align=left><br>
Решил тут поразбираться со страшным зверем которого зовут Themida. Причем не так, как большинство - как бы получше сграбить дамп, чтоб проверки протектора обмануть, а именно по хакерски - дизассемблировать и понять структуру протектора.<br><br>Я понимаю, что в каждом случае штамм Themida отличается друг от друга (из-за ее возможностей, и разных настроек при запуске). Но не будете же вы спорить, что один раз ее дизассемблировав второй и последующие разы пойдут проще?<br><br>Как подопытный кролик пошел The Bat 4.0.24 (авторские права автора The Bat я не нарушаю, так как взламывать его прогу я не собираюсь, а сам использую Outlook). Естественно, пока я Themida не взломал, но несколько шагов уже сделал. Результаты моих изысканий оформил тут:<br><br><noindex><a href="http://bigblueboar.narod.ru/kill_themida.doc" rel="nofollow" target="_blank">http://bigblueboar.narod.ru/kill_themida.rar</a></noindex><br><br>Собственно просьба к умным и знающим людям - где поправить, где наставить на путь истинный, а где и поругать. Я думаю, в конце концов мы таки разберемся в данном протекторе.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=237769&amp;user=22032&amp;forum_n=13&amp;topic=14863&amp;page=1&amp;anchor=1" class="addthx" data-post="237769"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]OKOB[/b]','')">OKOB</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/6801.png" alt=""><br><span class=txtSm>Ранг: 527.7 (<b>!</b>), 381thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.78'>Активность: 0.16<span style='color:red'>&searr;</span>0.09</span><br>Статус: <a href="action=userinfo&amp;user=6801">Участник</a><br><font color=blue><font color=red>Победитель турнира 2010</font></font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 августа 2009 15:47 <br><script type="text/javascript">QU('OKOB','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=OKOB" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=14863&amp;page=1#2');return false;">#2</a> </span><div align=left><br>
<I>blueboar2 пишет:<br>абсолютно идентичные виртуальные машины с одинаковыми же командами </I><br><br>Набор команд конкретной виртуальной машины зависит не от опций защиты, а от архитектуры виртуальной машины и от того подмножества кода которое виртуализировалось (машина не избыточна, т.е. хэндлеры команд, которые не использовались при виртуализации в машину не включаются. Вместо этого либо может быть дублирование хэндлера для одной и той-же команды или ссылки в таблице для разных опкодов на один хэндлер).<br><br>Обфускация зависит от 4-х параметров:<br>- набор регистров используемых при обфускации;<br>- допустимость команд доступа к памяти при обфускации или только на регистрах и стеке;<br>- вложенность обфускации (степень обфускации) для каждого обфусцируемого участка своя (не зависит от случайного числа, а от metamorphic level) <br>- подмножество шаблонов обфускации (вот в рамках подмножества уже на случайном числе);<br><br>опкод в данном случае лишь индекс в таблице хэндлеров. Таблица каждый раз строится и постоянной связи между хешированным значением опкода и хэндлером нет.
<br><br><font size="1"><i>-----<br>127.0.0.1, sweet 127.0.0.1</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=237988&amp;user=6801&amp;forum_n=13&amp;topic=14863&amp;page=1&amp;anchor=2" class="addthx" data-post="237988"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]blueboar2[/b]','')">blueboar2</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 16.0 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.91'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=22032">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 августа 2009 16:52 &middot; Поправил: blueboar2 <br><script type="text/javascript">QU('blueboar2','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=blueboar2" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=14863&amp;page=1#3');return false;">#3</a> </span><div align=left><br>
Не согласен! В том же топике, который вы мне указали, в первом посте есть ссылка на PDFку, где написано &quot;Unless the &#039;fake&#039; Virtual Opcodes, you can say that the Virtual Opcodes would be IDENTICAL if you protect an application twice and compare the Virtual Opcodes. What make them different, is a global variable in the Code Virtualizer, that i have called KEY&quot;. То есть, по нашему &quot;Если не считать мусора (кодов, которые не делают ничего), то опкоды (ссылки в таблицу) всегда одинаковы! Они становятся разными лишь из-за разного начального и последующих ключей, которые находятся в регистре BL&quot;<br><br>Или вы имеете в виду, что для каждой конкретной программы опкоды создаются на основании конкретных (не случайных) данных о ней - опкодах, контрольной суммы, защищаемых участков? То есть для одной и той же программы опкоды будут одинаковы (если не считать ключа), а для другой - другие<br><br>И еще вопрос - как вообще виртуализируются переходы? Каждая команда для получения опкода сначала взаимодействует с &quot;ключом&quot;, а потом ключ изменяется. Следовательно при выполнении одного кода два раза (например, цикл), второй раз ключ ведь будет другой, а значит будет переход по другому опкоду?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=237993&amp;user=22032&amp;forum_n=13&amp;topic=14863&amp;page=1&amp;anchor=3" class="addthx" data-post="237993"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]OKOB[/b]','')">OKOB</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/6801.png" alt=""><br><span class=txtSm>Ранг: 527.7 (<b>!</b>), 381thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.78'>Активность: 0.16<span style='color:red'>&searr;</span>0.09</span><br>Статус: <a href="action=userinfo&amp;user=6801">Участник</a><br><font color=blue><font color=red>Победитель турнира 2010</font></font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 августа 2009 17:32 <br><script type="text/javascript">QU('OKOB','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=OKOB" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=14863&amp;page=1#4');return false;">#4</a> </span><div align=left><br>
<I>blueboar2 пишет:<br>на PDFку, где написано </I><br>информация февраля 2007 года - на тот момент когда была еще Фима 1.8.7.0, а исследовался Virtualizer с еще более старым ядром. Все меняется - на дворе Фима 2.1.0.0.<br><br>Опкодов одинаковых не будет!!!!<br>Исследуй... <br><br>В помощь код в чистом виде всех CISC хэндлеров, таблица по которой формируется виртуальная машина и код основного цикла (не настроенный - константы 11111111) из Фимы 2.0.3.0.<br><br><br><img src="img/attach.gif" alt=""> <a href="./files/866a_17.08.2009_CRACKLAB.rU.tgz">866a_17.08.2009_CRACKLAB.rU.tgz</a> - VM_CISC_Th2030.txt
<br><br><font size="1"><i>-----<br>127.0.0.1, sweet 127.0.0.1</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=238000&amp;user=6801&amp;forum_n=13&amp;topic=14863&amp;page=1&amp;anchor=4" class="addthx" data-post="238000"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]blueboar2[/b]','')">blueboar2</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 16.0 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.91'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=22032">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 августа 2009 13:53 <br><script type="text/javascript">QU('blueboar2','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=blueboar2" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=14863&amp;page=1#5');return false;">#5</a> </span><div align=left><br>
Файл обновил. Теперь расшифровано три опкода, и небольшой кусок программы.<br><br>Вопрос OKOBу - я всегда считал, что Themida эмулирует 8 регистров - флаги и 7 обычных, кроме ESP. А ESP не эмулирует. Я прав?<br><br>Если я прав и ESP не эмулируется, то почему Themida переносит его из &quot;реальных&quot; в &quot;виртуальные&quot; регистры, как и все остальные?<br>А если я не прав, и ESP так же эмулируется, как и остальные регистры, почему тогда в списке Themida всего 8 эмулируемых регистров (EFlags имеет номер 07)? Или они в случайном порядке - и регистр EDX скажем будет номер 08?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=238054&amp;user=22032&amp;forum_n=13&amp;topic=14863&amp;page=1&amp;anchor=5" class="addthx" data-post="238054"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]OKOB[/b]','')">OKOB</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/6801.png" alt=""><br><span class=txtSm>Ранг: 527.7 (<b>!</b>), 381thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.78'>Активность: 0.16<span style='color:red'>&searr;</span>0.09</span><br>Статус: <a href="action=userinfo&amp;user=6801">Участник</a><br><font color=blue><font color=red>Победитель турнира 2010</font></font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 августа 2009 16:19 <br><script type="text/javascript">QU('OKOB','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=OKOB" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=14863&amp;page=1#6');return false;">#6</a> </span><div align=left><br>
В контексте CISC VM регистра ESP нет.<br><br>00000000 SLcisc_VMContext struc ; (sizeof=0x44)<br>00000000 _ecx            dd ?<br>00000004 _eax            dd ?<br>00000008 _edx            dd ?<br>0000000C _edi            dd ?<br>00000010 _ebx            dd ?<br>00000014 _esi            dd ?<br>00000018 _ebp            dd ?<br>0000001C _eflag          dd ?<br><br>доступ к содержимому регистров в контексте осуществляется таким кодом<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">ebp</span><span class="hl_char">+</span>operand<span class="hl_char">]</span></li><li class="hl_l1"><span class="hl_function"><b>sub</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0F0000000h</span></li><li class="hl_l0"><span class="hl_function"><b>shr</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">3</span></li><li class="hl_l1"><span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">edi</span><span class="hl_char">+</span><span class="hl_registr">eax</span><span class="hl_char">*</span><span class="hl_number">4</span><span class="hl_char">]</span></li>        </ol>
    </div>
</div></div><br><br><font size="1"><i>-----<br>127.0.0.1, sweet 127.0.0.1</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=238060&amp;user=6801&amp;forum_n=13&amp;topic=14863&amp;page=1&amp;anchor=6" class="addthx" data-post="238060"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]blueboar2[/b]','')">blueboar2</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 16.0 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.91'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=22032">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 20 августа 2009 12:29 <br><script type="text/javascript">QU('blueboar2','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=blueboar2" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=14863&amp;page=1#7');return false;">#7</a> </span><div align=left><br>
Еще вопрос - периодически в процессе разбора обфусцированного кода, регистры загружаются константами, с ними происходят некоторые действия (но в результате опять же получается константа), и происходит (или не происходит) какой-нибудь переход, скажем<br><br>MOV CH, 5E / AND CH, D8 / JGE CB82<br><br>А что будет, если перейти, если не надо. Или не перейти если надо. Там в любом случае тонны обфусцированного кода - если перейти куда надо - все работает. А если наоборот - протектор выведет какую-нибудь ошибку? Или просто повиснет?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=238161&amp;user=22032&amp;forum_n=13&amp;topic=14863&amp;page=1&amp;anchor=7" class="addthx" data-post="238161"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]OKOB[/b]','')">OKOB</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/6801.png" alt=""><br><span class=txtSm>Ранг: 527.7 (<b>!</b>), 381thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.78'>Активность: 0.16<span style='color:red'>&searr;</span>0.09</span><br>Статус: <a href="action=userinfo&amp;user=6801">Участник</a><br><font color=blue><font color=red>Победитель турнира 2010</font></font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 20 августа 2009 15:39 &middot; Поправил: OKOB <br><script type="text/javascript">QU('OKOB','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=OKOB" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=14863&amp;page=1#8');return false;">#8</a> </span><div align=left><br>
<I>blueboar2 пишет:<br>Еще вопрос </I><br>Вопрос риторический и скорее не основному форуму и разбору Фимы соответствует, а подфоруму вопросы новичков.<br><br>Тем не менее ответ. Если команда условного принадлежит обфускации, то все будет нормально (скорее всего), если это реальная команда перехода, то в зависимости от ветвления в логике исходной программы. То можно так перейти, что действительно не надо было.<br><br>Действия протектора самые разные как и другой любой программы в зависимости от контекста, от нарушения логики работы программы и подвисания до голубого экрана. Что касается возможных сообщений, то в прицепе у Фимы есть своя система обработки исключений (будет ли уже инициализирована на момент ошибки).
<br><br><font size="1"><i>-----<br>127.0.0.1, sweet 127.0.0.1</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=238188&amp;user=6801&amp;forum_n=13&amp;topic=14863&amp;page=1&amp;anchor=8" class="addthx" data-post="238188"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]blueboar2[/b]','')">blueboar2</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 16.0 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.91'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=22032">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 21 августа 2009 10:47 <br><script type="text/javascript">QU('blueboar2','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=blueboar2" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=14863&amp;page=1#9');return false;">#9</a> </span><div align=left><br>
Деобфусцировал следующую команду. Вкратце (не считая ключа) - помещает прочитанный из потока байт по адресу [Начало_области_регистров + 28]. Что там есть? Видел, что эта область как-то участвует в обработке флагов, конкретно - битов 200000 и 800000 регистра EFLAGS.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=238234&amp;user=22032&amp;forum_n=13&amp;topic=14863&amp;page=1&amp;anchor=9" class="addthx" data-post="238234"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]kioresk[/b]','')">kioresk</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/10650.gif" alt=""><br><span class=txtSm>Ранг: 154.2 (ветеран), 66thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.31'>Активность: 0.08<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=10650">Участник</a><br><font color=blue>REVENGE Crew</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 21 августа 2009 12:19 <br><script type="text/javascript">QU('kioresk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=kioresk" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=14863&amp;page=1#10');return false;">#10</a> </span><div align=left><br>
<b>blueboar2</b>,<br><br>Почитай еще раз тему с самого начала и о чем тебе писал <b>OKOB</b> и последуй его совету, если ты будешь при каждом затруднении спрашивать что и как, а не разбираться сам, то ты будешь долго возиться...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=238245&amp;user=10650&amp;forum_n=13&amp;topic=14863&amp;page=1&amp;anchor=10" class="addthx" data-post="238245"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]blueboar2[/b]','')">blueboar2</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 16.0 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.91'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=22032">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 21 августа 2009 13:11 <br><script type="text/javascript">QU('blueboar2','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=blueboar2" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=14863&amp;page=1#11');return false;">#11</a> </span><div align=left><br>
Я поступаю так: спрашиваю на форуме и начинаю разбираться сам одновременно. Если на форуме отвечают быстрее чем я разбираюсь, я принимаю ответ к сведению. Если я догадываюсь раньше, чем мне отвечают на форуме - я догадываюсь сам.<br><br>Поэтому если я что-то спрашиваю - это еще не значит что я этого не узнаю сам. Даже наоборот - все, что мне ответил OKOB я впоследствии узнал и сам. Просто иногда спросить на форуме быстрее. Но если вы считаете, что форум только для того, чтобы крякнуть темиду и написать &quot;ураа, я крякнул! Какой я крутой&quot; - ладно, не буду больше вопросов задавать.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=238251&amp;user=22032&amp;forum_n=13&amp;topic=14863&amp;page=1&amp;anchor=11" class="addthx" data-post="238251"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]kioresk[/b]','')">kioresk</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/10650.gif" alt=""><br><span class=txtSm>Ранг: 154.2 (ветеран), 66thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.31'>Активность: 0.08<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=10650">Участник</a><br><font color=blue>REVENGE Crew</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 21 августа 2009 14:55 &middot; Поправил: kioresk <br><script type="text/javascript">QU('kioresk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=kioresk" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=14863&amp;page=1#12');return false;">#12</a> </span><div align=left><br>
<I>blueboar2 пишет:<br>Но если вы считаете, что форум только для того, чтобы крякнуть темиду и написать &quot;ураа, я крякнул! Какой я крутой&quot; - ладно, не буду больше вопросов задавать.  </I><br><br>Делаешь странные выводы из советов, хотя можно просто прислушаться к тому что тебе советуют.<br><br>Никто не говорит, что надо молчать в трубочку. Но тебе уже несколько раз сказали, что разумнее было бы как минимум ознакомиться с трудами людей, которые занимались этой задачей раньше — тогда бы большая часть вопросов просто бы отпала.<br><br>Да и смысла исследовать защищенный файл, не анализируя код самого протектора (благо его постоянно релизят) тоже не много.<br><br><b>Постскриптум</b><br>Воспринимать исключительно как конструктивную критику.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=238261&amp;user=10650&amp;forum_n=13&amp;topic=14863&amp;page=1&amp;anchor=12" class="addthx" data-post="238261"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]blueboar2[/b]','')">blueboar2</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 16.0 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.91'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=22032">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 21 декабря 2009 08:13 &middot; Поправил: blueboar2 <br><script type="text/javascript">QU('blueboar2','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=blueboar2" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=14863&amp;page=1#13');return false;">#13</a> </span><div align=left><br>
А вот и опять я <img src="img/smilies/s1.gif" alt="">. После продолжительного затишься снова вернулся. Файл <noindex><a href="http://bigblueboar.narod.ru/kill_themida.rar" rel="nofollow" target="_blank">http://bigblueboar.narod.ru/kill_themida.rar</a></noindex> обновил. Там уже 9 опкодов (да, из 168, самому смешно) и пара-тройка десятков разобранных команд ВМ Themida<br><br>Очень понравилась эмуляция команды ADD ESP,4 <img src="img/smilies/s1.gif" alt="">. Преобразуется в 5!!! виртуальных опкодов. Причем - ладно бы - мусорных - для усложнения разброки, так нет - все нужно:<br><br>Команда 1: MOV REDX, ESP (REDX - нормальный регистр EDX, не виртуальный)<br>Команда 2: PUSH REDX<br>Команда 3: PUSH 4<br>Команда 4: ADD (сложить два числа на стеке - REDX (который ESP) и 4)<br>Команда 5: MOV ESP, [ESP]
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=247290&amp;user=22032&amp;forum_n=13&amp;topic=14863&amp;page=1&amp;anchor=13" class="addthx" data-post="247290"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 21 декабря 2009 18:19 &middot; Поправил: <a href="action=stats#mods">Модератор</a> <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=14863&amp;page=1#14');return false;">#14</a> </span><div align=left><br>
В принципе ничего хитрого в этом нет, обычная стековая виртуальная машина, в вмпроте используется такая же. Т.е. такая логика уже заложена на уровне перевода кода в ВМ. В принципе, как и в большинстве проектов, колесо они не изобрели, а содрали достаточно известную ВМ, ибо ВМ должна обладать покрытием множества эмулируемых команд.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=247337&amp;user=1556&amp;forum_n=13&amp;topic=14863&amp;page=1&amp;anchor=14" class="addthx" data-post="247337"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]blueboar2[/b]','')">blueboar2</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 16.0 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.91'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=22032">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 22 декабря 2009 11:44 <br><script type="text/javascript">QU('blueboar2','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=blueboar2" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=14863&amp;page=1#15');return false;">#15</a> </span><div align=left><br>
А попродробнее? Что это за ВМ, как называется? Если она так известна и в куче протов используется?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=247392&amp;user=22032&amp;forum_n=13&amp;topic=14863&amp;page=1&amp;anchor=15" class="addthx" data-post="247392"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]mak[/b]','')">mak</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3520.jpg" alt=""><br><span class=txtSm>Ранг: 673.3 <font color=magenta>(<b>! !</b>)</font>, 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.48'>Активность: 0.4<span style='color:red'>&searr;</span>0.31</span><br>Статус: <a href="action=userinfo&amp;user=3520">Участник</a><br><font color=blue>CyberMonk</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 22 декабря 2009 16:50 <br><script type="text/javascript">QU('mak','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=mak" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=14863&amp;page=1#16');return false;">#16</a> </span><div align=left><br>
<img src="img/smilies/s5.gif" alt=""> БлуБор , ты ее уже разбираешь , прочитай что такое <b>стековая виртуальная машина</b> по поиску ,это модель вычисления ,  и сравни с хэндлерами что ты разбираешь , реализация стэковой машины не случайна , так как она в разы ускоряет работу кода , в сравнении по тестам регистровая виртуальная машина работает очень медленно. Правда на сегодня уже полно альтернативных вариантов ускорения , проты будут прогрессировать <img src="img/smilies/s1.gif" alt=""><br><br><br><br><img src="img/attach.gif" alt=""> <a href="./files/6db4_22.12.2009_CRACKLAB.rU.tgz">6db4_22.12.2009_CRACKLAB.rU.tgz</a> - VMProtect VM.rar
<br><br><font size="1"><i>-----<br>RE In Progress [!] Coding Hazard [!] Stay Clear of this Cube</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=247408&amp;user=3520&amp;forum_n=13&amp;topic=14863&amp;page=1&amp;anchor=16" class="addthx" data-post="247408"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]blueboar2[/b]','')">blueboar2</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 16.0 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.91'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=22032">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 22 декабря 2009 19:00 <br><script type="text/javascript">QU('blueboar2','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=blueboar2" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=14863&amp;page=1#17');return false;">#17</a> </span><div align=left><br>
Тьфу ты. Вы про &quot;стековую виртуальную машину&quot; в принципе. Так это я знаю. Разбирал и не раз. Я думал есть какая то &quot;особенная&quot; стековая виртуальная машина - со своим набором команд - и именно ее все используют. А так то - да, именно стековые ВМ чаще всего используются. Более того - регистровых я еще и не видел <img src="img/smilies/s1.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=247421&amp;user=22032&amp;forum_n=13&amp;topic=14863&amp;page=1&amp;anchor=17" class="addthx" data-post="247421"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 22 декабря 2009 22:54 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=14863&amp;page=1#18');return false;">#18</a> </span><div align=left><br>
Ну фактически стековая и имеет определённые характеристики, в частности, положить оба аргумента в стек, произвести действие, потом снять результат.<br>З.Ы. Регистровая в старфорсе, хотя там не совсем ВМ в прямом смысле этого слова. Но не будем уходить в оффтоп.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=247439&amp;user=1556&amp;forum_n=13&amp;topic=14863&amp;page=1&amp;anchor=18" class="addthx" data-post="247439"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]dermatolog[/b]','')">dermatolog</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/1404.png" alt=""><br><span class=txtSm>Ранг: 116.6 (ветеран), 8thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.36'>Активность: 0.05<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1404">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 декабря 2009 09:01 <br><script type="text/javascript">QU('dermatolog','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=dermatolog" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=14863&amp;page=1#19');return false;">#19</a> </span><div align=left><br>
<b>OKOB</b><br><I>___:0060B832 33 C0                             xor     eax, eax<br>___:0060B834 F0 0F B1 4F 30                    lock cmpxchg [edi+SLcisc_VMContext.Busy], ecx<br>___:0060B839 75 F7                             jnz     short loc_60B832</I><br>В темиде до сих пор однопоточная ВМ?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=247457&amp;user=1404&amp;forum_n=13&amp;topic=14863&amp;page=1&amp;anchor=19" class="addthx" data-post="247457"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="20" onfocus="this.blur()" href="JavaScript:di('[b]blueboar2[/b]','')">blueboar2</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 16.0 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.91'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=22032">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 декабря 2009 14:27 <br><script type="text/javascript">QU('blueboar2','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=blueboar2" target="_blank">Личное сообщение</a> &middot;  <a href="#20" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=14863&amp;page=1#20');return false;">#20</a> </span><div align=left><br>
Не знаю как насчет поточности, но пока (50 инструкций от начала) многопоточностью и не пахнет <img src="img/smilies/s1.gif" alt="">. Возможно дальше.<br><br>BTW: Уже разобрано 14 команд
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=247470&amp;user=22032&amp;forum_n=13&amp;topic=14863&amp;page=1&amp;anchor=20" class="addthx" data-post="247470"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="21" onfocus="this.blur()" href="JavaScript:di('[b]AlexVel[/b]','')">AlexVel</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 43.2 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.82'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2596">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 декабря 2009 14:30 <br><script type="text/javascript">QU('AlexVel','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=AlexVel" target="_blank">Личное сообщение</a> &middot;  <a href="#21" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=14863&amp;page=1#21');return false;">#21</a> </span><div align=left><br>
<I>blueboar2 пишет:<br>регистровых я еще и не видел </I><br>АПИ Guardant 5.0 и ранние 5.1 - регистровая ВМ<br>позднее они перешли на стековую ВМ
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=247471&amp;user=2596&amp;forum_n=13&amp;topic=14863&amp;page=1&amp;anchor=21" class="addthx" data-post="247471"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="22" onfocus="this.blur()" href="JavaScript:di('[b]dermatolog[/b]','')">dermatolog</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/1404.png" alt=""><br><span class=txtSm>Ранг: 116.6 (ветеран), 8thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.36'>Активность: 0.05<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1404">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 декабря 2009 16:31 <br><script type="text/javascript">QU('dermatolog','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=dermatolog" target="_blank">Личное сообщение</a> &middot;  <a href="#22" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=14863&amp;page=1#22');return false;">#22</a> </span><div align=left><br>
<b>blueboar2</b><br>Посмотри на цитату, которую. я привел из листинга OKOB-а. Пока ВМ занята обработкой кода потока, то все остальные потоки будут &quot;курить&quot; в этом цикле пока ВМ не освободится. Вот мне и интересно - неужели в темиде до сих пор такая убогая архитектура?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=247484&amp;user=1404&amp;forum_n=13&amp;topic=14863&amp;page=1&amp;anchor=22" class="addthx" data-post="247484"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="23" onfocus="this.blur()" href="JavaScript:di('[b]mak[/b]','')">mak</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3520.jpg" alt=""><br><span class=txtSm>Ранг: 673.3 <font color=magenta>(<b>! !</b>)</font>, 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.48'>Активность: 0.4<span style='color:red'>&searr;</span>0.31</span><br>Статус: <a href="action=userinfo&amp;user=3520">Участник</a><br><font color=blue>CyberMonk</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 декабря 2009 16:42 <br><script type="text/javascript">QU('mak','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=mak" target="_blank">Личное сообщение</a> &middot;  <a href="#23" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=14863&amp;page=1#23');return false;">#23</a> </span><div align=left><br>
<b>blueboar2</b> Что значит многопоточностью не пахнет ? Если вы уже разобрали варианты многопоточности , то я бы послушал. <br><br>Иногда пишут полная поддержка потоков , это значит вм должна иметь полный потоковый контоль (создание , приостановка, возврат , прекращение , синхронизация между потоками) , к тому же подходы к реализации многопоточности весьма обширны .... <br><br><b>dermatolog</b> почему такой вывод ?! Не знаю поэтому спрашиваю ... <br>вот например <br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">___<span class="hl_char">:</span><span class="hl_number">0060B7F2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; ---------------------------------------------------------------------- -----</span></li><li class="hl_l1">___<span class="hl_char">:</span><span class="hl_number">0060B7F2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr"><b>EBX</b></span>&nbsp;<span class="hl_char">-</span>&nbsp;<span class="hl_function"><b>entry</b></span>&nbsp;key</li><li class="hl_l0">___<span class="hl_char">:</span><span class="hl_number">0060B7F2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr"><b>ESI</b></span>&nbsp;<span class="hl_char">-</span>&nbsp;pcode&nbsp;pointer</li><li class="hl_l1">___<span class="hl_char">:</span><span class="hl_number">0060B7F2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr"><b>EDI</b></span>&nbsp;<span class="hl_char">-</span>&nbsp;contex&nbsp;pointer</li>        </ol>
    </div>
</div></div>
<br><br>в еди переадется поинтер на контекст , а параметр бузи может быть в разных случаях , все не смотрел но обычно популярный подход это контекстно поточная виртуальная машина ...
<br><br><font size="1"><i>-----<br>RE In Progress [!] Coding Hazard [!] Stay Clear of this Cube</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=247487&amp;user=3520&amp;forum_n=13&amp;topic=14863&amp;page=1&amp;anchor=23" class="addthx" data-post="247487"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="24" onfocus="this.blur()" href="JavaScript:di('[b]dermatolog[/b]','')">dermatolog</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/1404.png" alt=""><br><span class=txtSm>Ранг: 116.6 (ветеран), 8thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.36'>Активность: 0.05<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1404">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 декабря 2009 17:02 <br><script type="text/javascript">QU('dermatolog','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=dermatolog" target="_blank">Личное сообщение</a> &middot;  <a href="#24" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=14863&amp;page=1#24');return false;">#24</a> </span><div align=left><br>
<I>mak пишет:<br>почему такой вывод ?! Не знаю поэтому спрашиваю ...  </I><br>Скачай разобранный исполнитель <a href="http://www.exelab.ru/f/action=vthread&amp;forum=13&amp;topic=14863&amp;page=1#4" target="_blank">из этого поста</a>. <br>Вот это кусок из него:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">___<span class="hl_char">:</span><span class="hl_number">0060B832</span>&nbsp;<span class="hl_number">33</span>&nbsp;C0&nbsp;<span class="hl_function"><b>xor</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1">___<span class="hl_char">:</span><span class="hl_number">0060B834</span>&nbsp;F0&nbsp;<span class="hl_number">0F</span>&nbsp;B1&nbsp;<span class="hl_number">4F</span>&nbsp;<span class="hl_number">30</span>&nbsp;<span class="hl_function"><b>lock</b></span>&nbsp;<span class="hl_function"><b>cmpxchg</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">edi</span><span class="hl_char">+</span>SLcisc_VMContext<span class="hl_char">.</span>Busy<span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">ecx</span></li><li class="hl_l0">___<span class="hl_char">:</span><span class="hl_number">0060B839</span>&nbsp;<span class="hl_number">75</span>&nbsp;F7&nbsp;<span class="hl_function"><b>jnz</b></span>&nbsp;<span class="hl_function"><b>short</b></span>&nbsp;loc_60B832</li>        </ol>
    </div>
</div></div>
<br>Не трудно догадаться что здесь происходит ожидание когда ВМ освободиться. Освободжается она вот здесь:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">___<span class="hl_char">:</span><span class="hl_number">0060AB40</span>&nbsp;C7&nbsp;<span class="hl_number">42</span>&nbsp;<span class="hl_number">30</span>&nbsp;<span class="hl_number">00</span>&nbsp;<span class="hl_number">00</span>&nbsp;<span class="hl_number">00</span><span class="hl_char">+</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">[</span><span class="hl_registr">edx</span><span class="hl_char">+</span>SLcisc_VMContext<span class="hl_char">.</span>Busy<span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span></li><li class="hl_l1">___<span class="hl_char">:</span><span class="hl_number">0060AB47</span>&nbsp;<span class="hl_number">61</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function">popa</span></li><li class="hl_l0">___<span class="hl_char">:</span><span class="hl_number">0060AB48</span>&nbsp;<span class="hl_number">9D</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function">popf</span></li><li class="hl_l1">___<span class="hl_char">:</span><span class="hl_number">0060AB49</span><span style="word-break: break-all">&nbsp;C3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function">retn</span></li>        </ol>
    </div>
</div></div>
<br>Если тебе все еще непонятнет смысл поля Busy в контексте ВМ, то объясню на пальцах - если 2 разных потока будут вызывать один и тотже исполнитель ВМ, то второй поток зайдя в исполнителе затрет контекст первого потока и в результате первый поток наибнецца. Поэтому чтобы такого не произошло аффтары темиды придумали вот такой вот финт ушами - второй поток будет ожидать завершение выполнения пикода первого потока и ТОЛЬКО после этого начнет выполняться сам. Вот такой вот подход к проектированию ВМ полностью убивает смысл многопоточности в приложении (при условии что разные потоки дергают один и тотжде исполнитель ВМ). ПОэтому я и спросил - в более новых версиях темиды все также работает через жопу или уже нет? <img src="img/smilies/s1.gif" alt="">)
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=247491&amp;user=1404&amp;forum_n=13&amp;topic=14863&amp;page=1&amp;anchor=24" class="addthx" data-post="247491"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="25" onfocus="this.blur()" href="JavaScript:di('[b]mak[/b]','')">mak</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3520.jpg" alt=""><br><span class=txtSm>Ранг: 673.3 <font color=magenta>(<b>! !</b>)</font>, 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.48'>Активность: 0.4<span style='color:red'>&searr;</span>0.31</span><br>Статус: <a href="action=userinfo&amp;user=3520">Участник</a><br><font color=blue>CyberMonk</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 декабря 2009 17:23 &middot; Поправил: mak <br><script type="text/javascript">QU('mak','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=mak" target="_blank">Личное сообщение</a> &middot;  <a href="#25" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=14863&amp;page=1#25');return false;">#25</a> </span><div align=left><br>
<img src="img/smilies/s1.gif" alt=""> это все я видел , и контекстами в виде накладок ясно, не нуби же <img src="img/smilies/s5.gif" alt=""> , я о том что у каждого потока может быть свой интерпретатор , это и есть контекстно поточная вм , а этот параметр может быть просто приостановкой .... прочитай еще раз мой пост выше. Если то что ты говоришь есть реализация свитчед вм , то тогда в случае приостановки потока , контекст должен сохранятся для последующего запуска , а начинаться новый ....но этого кода при быстром взгляде я не вижу , поэтому если кто увидел реализацию потокового енджина в листинге ткните плз пальцем. А если передается каждому потоку свой указатель на контекст в еди , тот тут уже без вопросов. Вот что я имею ввиду ...<br><br><b>Поправлено</b> - Да я так и понял что мы о разных вещах , так надо было и сказать что бузи это тоже самое что критические секции. Критической секцией как вариант может быть та же приостановка в ожидании , о чем я и сказал выше.  Тогда уже вопрос сводится банально к оптимальной реализации. Есть какие то более оптимальные решения доступа ? В нынешнем софте полно программ в которых не учтены такие моменты , это разве большой минус архитектуры ?!
<br><br><font size="1"><i>-----<br>RE In Progress [!] Coding Hazard [!] Stay Clear of this Cube</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=247493&amp;user=3520&amp;forum_n=13&amp;topic=14863&amp;page=1&amp;anchor=25" class="addthx" data-post="247493"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="26" onfocus="this.blur()" href="JavaScript:di('[b]dermatolog[/b]','')">dermatolog</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/1404.png" alt=""><br><span class=txtSm>Ранг: 116.6 (ветеран), 8thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.36'>Активность: 0.05<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1404">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 декабря 2009 17:37 <br><script type="text/javascript">QU('dermatolog','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=dermatolog" target="_blank">Личное сообщение</a> &middot;  <a href="#26" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=14863&amp;page=1#26');return false;">#26</a> </span><div align=left><br>
<b>mak</b><br>Ты путаешь 2 совершенно разные вещи - многопоточность на уровне ОСи и многопоточность на уровне клиентского приложения. Планированием потоков (остановкой, запусками и т.п.) занимается ОСь и когда поток уже создан - ему больше не нужно думать над тем, а как же я бля все-таки живу. Тоже самое относится и к ВМ - ёй совершенно пофигу на то как живут потоки, которые её дергают. У ВМ темиды в силу своей непродуманной архитектуры (судя по 2.0.3) есть только одна проблема - это не дать разным потокам записать свой контекст в одну и туже &quot;глобальную переменную&quot; (читай контекст). Решал когда-нибудь задачу доступа из разных потоков  к одной и тойже переменной? В общем задача решается с использованием критических секций (т.е. пока текущий поток не выйдет из этой секции в неё больше никто не зайдет). Дак вот тут тоже самое, только в роли критической секции выступает поле Busy в контексте ВМ.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=247495&amp;user=1404&amp;forum_n=13&amp;topic=14863&amp;page=1&amp;anchor=26" class="addthx" data-post="247495"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="27" onfocus="this.blur()" href="JavaScript:di('[b]blueboar2[/b]','')">blueboar2</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 16.0 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.91'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=22032">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 декабря 2009 18:05 <br><script type="text/javascript">QU('blueboar2','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=blueboar2" target="_blank">Личное сообщение</a> &middot;  <a href="#27" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=14863&amp;page=1#27');return false;">#27</a> </span><div align=left><br>
Так у разных потоков могут быть разные контексты? И у каждого потока EDI указывает именно на свой?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=247496&amp;user=22032&amp;forum_n=13&amp;topic=14863&amp;page=1&amp;anchor=27" class="addthx" data-post="247496"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="28" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 декабря 2009 18:43 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#28" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=14863&amp;page=1#28');return false;">#28</a> </span><div align=left><br>
Ясный красный, у разных потоков разный контекст. А вм действительно однопоточная, ибо на критических секциях самодельных построена.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=247507&amp;user=1556&amp;forum_n=13&amp;topic=14863&amp;page=1&amp;anchor=28" class="addthx" data-post="247507"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="29" onfocus="this.blur()" href="JavaScript:di('[b]Smon[/b]','')">Smon</a></b><br></div>
<img src="img/s8.gif" alt=""><br><span class=txtSm>Ранг: 500.5 (<b>!</b>), 8thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.33'>Активность: 0.23<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1449">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 декабря 2009 19:05 <br><script type="text/javascript">QU('Smon','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Smon" target="_blank">Личное сообщение</a> &middot;  <a href="#29" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=14863&amp;page=1#29');return false;">#29</a> </span><div align=left><br>
Какбэ капитан очевидность подсказывает, что самодельные критические секции есть лажа, и нормальный многопоток на них не построишь, ибо второй поток может отставать от первого всего на одну-две инструкции, и в этом случае занятость\свобода контекста совершенно неочевидна, сталобыть стековая реализация гораздо более адекватный подход к многопоточности <img src="img/smilies/s1.gif" alt="">
<br><br><font size="1"><i>-----<br>&quotПусть видят, что мы не шутим. Стволы для понта, ножи для дела&quot Lock, Stock &amp Two Smoking Barrels</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=247509&amp;user=1449&amp;forum_n=13&amp;topic=14863&amp;page=1&amp;anchor=29" class="addthx" data-post="247509"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="30" onfocus="this.blur()" href="JavaScript:di('[b]dermatolog[/b]','')">dermatolog</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/1404.png" alt=""><br><span class=txtSm>Ранг: 116.6 (ветеран), 8thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.36'>Активность: 0.05<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1404">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 декабря 2009 19:06 <br><script type="text/javascript">QU('dermatolog','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=dermatolog" target="_blank">Личное сообщение</a> &middot;  <a href="#30" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=14863&amp;page=1#30');return false;">#30</a> </span><div align=left><br>
<I>mak пишет:<br>Тогда уже вопрос сводится банально к оптимальной реализации. Есть какие то более оптимальные решения доступа ? В нынешнем софте полно программ в которых не учтены такие моменты , это разве большой минус архитектуры ?!  </I><br>Какие нах &quot;оптимальные решения доступа&quot;? Надо полностью менять концепцию ВМ - хранилище под контекст должно быть потоконезависимым. А что у нас независимое между потоками? Пральна - это стек. Кто мешает хранить контекст ВМ на стеке? Никто. Сразу же отпадает гемор с &quot;критическими секциями&quot; и автоматически имеем многопоточную ВМ. Интересует реализация - кури исходники исполнителя ВМ от вмпротекта, которые ты сам сюда и выкладывал <img src="img/smilies/s1.gif" alt="">)
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=247510&amp;user=1404&amp;forum_n=13&amp;topic=14863&amp;page=1&amp;anchor=30" class="addthx" data-post="247510"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="31" onfocus="this.blur()" href="JavaScript:di('[b]mak[/b]','')">mak</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3520.jpg" alt=""><br><span class=txtSm>Ранг: 673.3 <font color=magenta>(<b>! !</b>)</font>, 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.48'>Активность: 0.4<span style='color:red'>&searr;</span>0.31</span><br>Статус: <a href="action=userinfo&amp;user=3520">Участник</a><br><font color=blue>CyberMonk</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 декабря 2009 20:25 &middot; Поправил: mak <br><script type="text/javascript">QU('mak','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=mak" target="_blank">Личное сообщение</a> &middot;  <a href="#31" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=14863&amp;page=1#31');return false;">#31</a> </span><div align=left><br>
<img src="img/smilies/s1.gif" alt=""> Короче все понятно ...ужс какойто , все это тоже уже давно известно , простые истины ... получается что только по параметру бузи сделали вывод что вм однопоточная ... а то что параметр еди то есть указатель на контекст может быть сменен никто даже не подумал ...
<br><br><font size="1"><i>-----<br>RE In Progress [!] Coding Hazard [!] Stay Clear of this Cube</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=247512&amp;user=3520&amp;forum_n=13&amp;topic=14863&amp;page=1&amp;anchor=31" class="addthx" data-post="247512"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> <a href="action=vthread&amp;forum=13&amp;topic=14863&amp;page=0.html">&lt;&lt;</a> .  <a href="action=vthread&amp;forum=13&amp;topic=14863&amp;page=0.html">1</a> . <b>2</b> . <a href="action=vthread&amp;forum=13&amp;topic=14863&amp;page=2.html">3</a> . <a href="action=vthread&amp;forum=13&amp;topic=14863&amp;page=2.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/aspro.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=13&sortBy=0&page=0.html"><b>Протекторы</b></a> <b class=bulletHead>&#8212;&#8250;</b> Исследование защиты Themida</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#32" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="13">
<input type="hidden" name="topic" value="14863">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=14863" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
