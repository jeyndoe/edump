<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Убийство процессов-призраков - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Бывают случаи, когда в памяти остаётся процесс, который штатными средствами винды убить невозможно. Попытка убийства через диспетчер задач выдаёт ошибку доступа, а taskkill пишет: Ошибка: Не удается завершить процесс с">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=26261'>bartolomeo</a>, <a target='_blank' href='?action=userinfo&amp;user=28512'>-Sanchez-</a>, <a target='_blank' href='?action=userinfo&amp;user=33192'>morgot</a>, <a target='_blank' href='?action=userinfo&amp;user=54646'>sashalogout</a> (+4 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/default.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=3&sortBy=0&page=0.html"><b>Софт, инструменты</b></a> <b class=bulletHead>&#8212;&#8250;</b> Убийство процессов-призраков</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]IOCTL_[/b]','')">IOCTL_</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 8.2 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 1.94'>Активность: 0.04<span style='color:red'>&searr;</span>0.03</span><br>Статус: <a href="action=userinfo&amp;user=44218">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 марта 2020 00:35 &middot; Поправил: IOCTL_ <br><script type="text/javascript">QU('IOCTL_','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=IOCTL_" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=3&amp;topic=26391.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Бывают случаи, когда в памяти остаётся процесс, который штатными средствами винды убить невозможно. Попытка убийства через диспетчер задач выдаёт ошибку доступа, а taskkill пишет:<br><br><i class=x>Ошибка: Не удается завершить процесс с идентификатором 1234.<br>Причина: Ни один из экземпляров этого задания не запущен.</i><br><br>Если глянуть потоки через procexp, то там либо непонятный пустой поток без опознавательных признаков с TID 0, либо ntdll.dll!RtlUserThreadStart и какой-то вменяемый TID. Кто-нибудь знает, что это за фигня и чем её грохнуть?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=404119&amp;user=44218&amp;forum_n=3&amp;topic=26391.html&amp;page=0&amp;anchor=1" class="addthx" data-post="404119"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]f13nd[/b]','')">f13nd</a></b><br></div>
<img src="img/s6.gif" alt=""><br><img style="padding-top:3px;" src="av/8075.png" alt=""><br><span class=txtSm>Ранг: 271.2 (наставник), 331thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.63'>Активность: 0.32<span style='color:green'>&nearr;</span>1.49</span><br>Статус: <a href="action=userinfo&amp;user=8075">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 марта 2020 01:13 <br><script type="text/javascript">QU('f13nd','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=f13nd" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=3&amp;topic=26391.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
Такие процессы появляются если запустить любой процесс с флагом CREATE_SUSPENDED и после этого не стартануть основной тред. Возможное решение - запустить его, хотя хз надо ли. Лучше разобраться кто их плодит.
<br><br><font size="1"><i>-----<br>2 оттенка серого</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=404120&amp;user=8075&amp;forum_n=3&amp;topic=26391.html&amp;page=0&amp;anchor=2" class="addthx" data-post="404120"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]Vicshann[/b]','')">Vicshann</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 8.0 (гость), 15thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.19'>Активность: 0.01<span style='color:green'>&nearr;</span>0.03</span><br>Статус: <a href="action=userinfo&amp;user=28927">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 марта 2020 01:22 <br><script type="text/javascript">QU('Vicshann','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vicshann" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=3&amp;topic=26391.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
Бывало такое иногда из-за каких-то сбоев асинхронного доступа к файлам, с тем же uTorrent, например<img src="img/smilies/s1.gif" alt=""><br>Может тут CancelIoEx надо использовать, но придется вызывать из того же процесса и знать нужный Handle.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=404121&amp;user=28927&amp;forum_n=3&amp;topic=26391.html&amp;page=0&amp;anchor=3" class="addthx" data-post="404121"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]Xamil[/b]','')">Xamil</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 2.3 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 0.32'>Активность: 0.03=0.03</span><br>Статус: <a href="action=userinfo&amp;user=53766">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 марта 2020 13:32 <br><script type="text/javascript">QU('Xamil','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Xamil" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=3&amp;topic=26391.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
через натив их всех в SUSPENDED, потом через NtQuerySystemInformation - отследить, тут были вроде сорцы Process Explorer+ от HiEndSoft
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=404125&amp;user=53766&amp;forum_n=3&amp;topic=26391.html&amp;page=0&amp;anchor=4" class="addthx" data-post="404125"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]IOCTL_[/b]','')">IOCTL_</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 8.2 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 1.94'>Активность: 0.04<span style='color:red'>&searr;</span>0.03</span><br>Статус: <a href="action=userinfo&amp;user=44218">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 марта 2020 14:34 <br><script type="text/javascript">QU('IOCTL_','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=IOCTL_" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=3&amp;topic=26391.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
А тулза какая-то есть, чтобы грохать процессы нестандартными способами? Ну там через Nt, Zw и т.п. Помню, была какая-то тулза и там были разные кнопки с названиями функций: NtTerminateProcess, ZwTerminateProcess и ещё штук 6 вроде. Ещё помню тулзу, которая через свой драйвер процессы грохала. Есть у кого-то такие тулзы?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=404126&amp;user=44218&amp;forum_n=3&amp;topic=26391.html&amp;page=0&amp;anchor=5" class="addthx" data-post="404126"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]Boostyq[/b]','')">Boostyq</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/40448.png" alt=""><br><span class=txtSm>Ранг: 90.1 (постоянный), 90thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.32'>Активность: 0.29<span style='color:green'>&nearr;</span>0.56</span><br>Статус: <a href="action=userinfo&amp;user=40448">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 марта 2020 14:42 &middot; Поправил: Boostyq <br><script type="text/javascript">QU('Boostyq','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Boostyq" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=3&amp;topic=26391.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
<I>IOCTL_ пишет:<br>А тулза какая-то есть, </I><br>Раньше в Process Hacker 2 было куча методов терминации процесса, но большая методов работала только на 32-битных системах, и это убрали в v2.39<br>Сейчас методы переписали и перенести в отдельный плагин <noindex><a href="https://github.com/processhacker/plugins-extra/tree/master/TerminatorPlugin" rel="nofollow" target="_blank">https://github.com/processhacker/plugins-extra/tree/master/TerminatorPlugin</a></noindex><br>Наверное собранной версии нет, и это нужно компилировать, либо можно просто взять сами методы
<br><br><font size="1"><i>-----<br>В облачке многоточия</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=404127&amp;user=40448&amp;forum_n=3&amp;topic=26391.html&amp;page=0&amp;anchor=6" class="addthx" data-post="404127"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=44218" title="18-03-2020 11:51, ранг:6.0" target="_blank">IOCTL_</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]IOCTL_[/b]','')">IOCTL_</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 8.2 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 1.94'>Активность: 0.04<span style='color:red'>&searr;</span>0.03</span><br>Статус: <a href="action=userinfo&amp;user=44218">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 марта 2020 14:43 <br><script type="text/javascript">QU('IOCTL_','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=IOCTL_" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=3&amp;topic=26391.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
Нашёл статейко шикарное по этому поводу: <noindex><a href="https://wj32.org/wp/2009/05/10/12-ways-to-terminate-a-process/" rel="nofollow" target="_blank"><b>12 ways to terminate a process</b></a></noindex>. Кто-то уже кодил подобное? Как сейчас помню, что где-то такое видел.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=404128&amp;user=44218&amp;forum_n=3&amp;topic=26391.html&amp;page=0&amp;anchor=7" class="addthx" data-post="404128"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]Boostyq[/b]','')">Boostyq</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/40448.png" alt=""><br><span class=txtSm>Ранг: 90.1 (постоянный), 90thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.32'>Активность: 0.29<span style='color:green'>&nearr;</span>0.56</span><br>Статус: <a href="action=userinfo&amp;user=40448">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 марта 2020 14:45 <br><script type="text/javascript">QU('Boostyq','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Boostyq" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=3&amp;topic=26391.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
wj32 это и есть Process Hacker -.-&quot;
<br><br><font size="1"><i>-----<br>В облачке многоточия</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=404129&amp;user=40448&amp;forum_n=3&amp;topic=26391.html&amp;page=0&amp;anchor=8" class="addthx" data-post="404129"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]IOCTL_[/b]','')">IOCTL_</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 8.2 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 1.94'>Активность: 0.04<span style='color:red'>&searr;</span>0.03</span><br>Статус: <a href="action=userinfo&amp;user=44218">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 марта 2020 14:46 <br><script type="text/javascript">QU('IOCTL_','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=IOCTL_" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=3&amp;topic=26391.html&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
<b>Boostyq</b><br>Спасибо! Если ничего не найдётся, то придётся компилить или что-то придумывать. Но я помню, что это уже где-то было.<br><br><b>Добавлено спустя 2 минуты</b><br><I>Boostyq пишет:<br>wj32 это и есть Process Hacker -.-&quot;  </I><br>Ага, точно! Семён Семёныч...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=404130&amp;user=44218&amp;forum_n=3&amp;topic=26391.html&amp;page=0&amp;anchor=9" class="addthx" data-post="404130"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]ManHunter[/b]','')">ManHunter</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/7823.gif" alt=""><br><span class=txtSm>Ранг: 104.9 (ветеран), 46thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.66'>Активность: 0.04<span style='color:red'>&searr;</span>0.02</span><br>Статус: <a href="action=userinfo&amp;user=7823">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 марта 2020 17:22 <br><script type="text/javascript">QU('ManHunter','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ManHunter" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=3&amp;topic=26391.html&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
<I>IOCTL_ пишет:<br>Помню, была какая-то тулза и там были разные кнопки с названиями функций: NtTerminateProcess, ZwTerminateProcess и ещё штук 6 вроде. </I><br><br>Advanced Process Termination (APT), последняя версия 4.2<br><br><img src="img/attach.gif" alt=""> <a href="./files/b5bc_18.03.2020_EXELAB.rU.tgz">b5bc_18.03.2020_EXELAB.rU.tgz</a> - APT.4.2.zip
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=404132&amp;user=7823&amp;forum_n=3&amp;topic=26391.html&amp;page=0&amp;anchor=10" class="addthx" data-post="404132"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=44218" title="18-03-2020 15:18, ранг:6.3" target="_blank">IOCTL_</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]IOCTL_[/b]','')">IOCTL_</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 8.2 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 1.94'>Активность: 0.04<span style='color:red'>&searr;</span>0.03</span><br>Статус: <a href="action=userinfo&amp;user=44218">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 марта 2020 18:14 <br><script type="text/javascript">QU('IOCTL_','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=IOCTL_" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=3&amp;topic=26391.html&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
<I>ManHunter пишет:<br>Advanced Process Termination (APT), последняя версия 4.2 </I><br>Ух ты! Кнопочки! Благодарствую! <img src="img/smilies/s1.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=404133&amp;user=44218&amp;forum_n=3&amp;topic=26391.html&amp;page=0&amp;anchor=11" class="addthx" data-post="404133"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]hiddy[/b]','')">hiddy</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 4.2 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 0.61'>Активность: 0.04=0.04</span><br>Статус: <a href="action=userinfo&amp;user=52118">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 марта 2020 19:35 <br><script type="text/javascript">QU('hiddy','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=hiddy" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=3&amp;topic=26391.html&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
https://randomascii.wordpress.com/2018/02/11/zombie-processes-are-eating-your-memory/<br><br>Можно попробовать вот эту технику: https://scorpiosoftware.net/2020/03/15/how-can-i-close-a-handle-in-another-process/, но если я не ошибаюсь, вызов NtDuplicateObject вернет ошибку STATUS_PROCESS_IS_TERMINATING.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=404135&amp;user=52118&amp;forum_n=3&amp;topic=26391.html&amp;page=0&amp;anchor=12" class="addthx" data-post="404135"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 337.5 (мудрец), 348thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 марта 2020 19:50 &middot; Поправил: difexacaw <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=3&amp;topic=26391.html&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
Процессы так висли из за каких то глобальных синхронизаций в ядре на младших версиях. Прибить такие процессы можно только ресетив ядро. Антируткиты киляют процессы и что толку если висяк в ядре.<br><br><b>f13nd</b><br><br>&gt; Такие процессы появляются если запустить любой процесс с флагом CREATE_SUSPENDED и после этого не стартануть основной тред.<br><br>Может пример будет, а то у меня завершается. Впрочем оно и не может не завершаться, так как все блокировки свободны. Помню глючило на NtSuspendProcess/NtResumeThread.. хотя это можно потестить.<br><br>Теоретически если послать останов поточный и тормознуть такой поток(race), то может что и подвиснет <img src="img/smilies/s13.gif" alt="">
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=404136&amp;user=40990&amp;forum_n=3&amp;topic=26391.html&amp;page=0&amp;anchor=13" class="addthx" data-post="404136"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]dezmand07[/b]','')">dezmand07</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 19.5 (новичок), 8thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 2.98'>Активность: 0.05<span style='color:green'>&nearr;</span>0.08</span><br>Статус: <a href="action=userinfo&amp;user=42822">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 марта 2020 21:52 <br><script type="text/javascript">QU('dezmand07','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=dezmand07" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=3&amp;topic=26391.html&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
<I>difexacaw пишет:<br>Может пример будет </I><br>Наверное имелось ввиду NtCreateProcess с флагом PROCESS_CREATE_FLAGS_SUSPENDED (0x00000200)<br>Если вызвать этот сервис, и дальше ничего не делать с созданным хендлом (не создавать маин поток, не уведомлять csrss и т.д.), а просто закрыть приложение, то хендл так и останется в ядре.<br>Такой хендл Диспетчер задач не увидит, но он будет виден например в x64dbg, при этом, насколько помню, отладчик не сможет его закрыть.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=404150&amp;user=42822&amp;forum_n=3&amp;topic=26391.html&amp;page=0&amp;anchor=14" class="addthx" data-post="404150"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 337.5 (мудрец), 348thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 марта 2020 23:33 &middot; Поправил: difexacaw <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=3&amp;topic=26391.html&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
<b>dezmand07</b><br><br>&gt; просто закрыть приложение, то хендл так и останется в ядре.<br><br>Вся таблица описателей уничтожается при завершении процесса. Интерналс чтоле почитай для начала.
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=404159&amp;user=40990&amp;forum_n=3&amp;topic=26391.html&amp;page=0&amp;anchor=15" class="addthx" data-post="404159"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]IOCTL_[/b]','')">IOCTL_</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 8.2 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 1.94'>Активность: 0.04<span style='color:red'>&searr;</span>0.03</span><br>Статус: <a href="action=userinfo&amp;user=44218">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 марта 2020 01:59 &middot; Поправил: IOCTL_ <br><script type="text/javascript">QU('IOCTL_','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=IOCTL_" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=3&amp;topic=26391.html&amp;page=0#16');return false;">#16</a> </span><div align=left><br>
В общем, поигрался я с вышеуказанными тулзами, перепробовал всё, что можно, включая &quot;опасный&quot; режим TT4 из Process Hacker 2.38, но процесс продолжает висеть. Модулей нет, хэндлов нет, трэдов нет, PID - есть <img src="img/smilies/s1.gif" alt=""><br><br>Cancel I/O не помог.<br><br><b>Добавлено спустя 18 минут</b><br>Под занавес попытался убить процесс стандартным способом через PH, т.к. APT его больше не видит. Написало ошибку: <i class=x>Попытка доступа к процессу, выполняющему процедуру завершения</i>. Возникает философский вопрос: можно ли завершить завершающийся процесс? <img src="img/smilies/s1.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=404167&amp;user=44218&amp;forum_n=3&amp;topic=26391.html&amp;page=0&amp;anchor=16" class="addthx" data-post="404167"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 337.5 (мудрец), 348thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 марта 2020 19:31 <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=3&amp;topic=26391.html&amp;page=0#17');return false;">#17</a> </span><div align=left><br>
<b>IOCTL_</b><br><br>&gt; Попытка доступа к процессу, выполняющему процедуру завершения.<br><br>Необходимы подробности, откуда эта инфа. Тоесть это либо сервисный статус STATUS_PROCESS_IS_TERMINATING, либо значение из PS_BASIC_INFO.ExitStatus != STATUS_PENDING(статус последнего треда, а если у него STATUS_PENDING что тогда..), либо косвенная инфа по маркерам(PS_PROCESS_FLAGS_PROCESS_DELETE).<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;PspLockProcessExclusive&nbsp;<span class="hl_char">(</span>Process<span class="hl_char">,</span>&nbsp;Thread<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;Say&nbsp;one&nbsp;less&nbsp;active&nbsp;thread<span class="hl_char">.</span>&nbsp;<span class="hl_function"><b>If</b></span>&nbsp;we&nbsp;are&nbsp;the&nbsp;last&nbsp;then&nbsp;block&nbsp;creates&nbsp;<span class="hl_function"><b>and</b></span>&nbsp;wait&nbsp;for&nbsp;the&nbsp;other&nbsp;threads&nbsp;to&nbsp;exit<span class="hl_char">.</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;Process<span class="hl_char">-</span><span class="hl_char">&gt;</span>ActiveThreads<span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>Process<span class="hl_char">-</span><span class="hl_char">&gt;</span>ActiveThreads&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span>&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PS_SET_BITS&nbsp;<span class="hl_char">(</span><span class="hl_char">&amp;</span>Process<span class="hl_char">-</span><span class="hl_char">&gt;</span>Flags<span class="hl_char">,</span>&nbsp;PS_PROCESS_FLAGS_PROCESS_DELETE<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LastThread&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function"><b>TRUE</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>ExitStatus&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;STATUS_THREAD_IS_TERMINATING<span class="hl_char">)</span>&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>Process<span class="hl_char">-</span><span class="hl_char">&gt;</span>ExitStatus&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;STATUS_PENDING<span class="hl_char">)</span>&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Process<span class="hl_char">-</span><span class="hl_char">&gt;</span>ExitStatus&nbsp;<span class="hl_char">=</span>&nbsp;Process<span class="hl_char">-</span><span class="hl_char">&gt;</span>LastThreadExitStatus<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="hl_function"><b>else</b></span>&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Process<span class="hl_char">-</span><span class="hl_char">&gt;</span>ExitStatus&nbsp;<span class="hl_char">=</span>&nbsp;ExitStatus<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li>        </ol>
    </div>
</div></div><br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=404190&amp;user=40990&amp;forum_n=3&amp;topic=26391.html&amp;page=0&amp;anchor=17" class="addthx" data-post="404190"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]hiddy[/b]','')">hiddy</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 4.2 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 0.61'>Активность: 0.04=0.04</span><br>Статус: <a href="action=userinfo&amp;user=52118">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 20 марта 2020 03:49 &middot; Поправил: hiddy <br><script type="text/javascript">QU('hiddy','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=hiddy" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=3&amp;topic=26391.html&amp;page=0#18');return false;">#18</a> </span><div align=left><br>
<b>difexacaw</b>, тестил на userinit.exe, потому что он всегда висит на 10 винде. Можно получить доступ 0x1fffff (Full control) к процессу, если есть права, вызовы NtDuplicateObject, NtTerminateProcess итд возвращают STATUS_PROCESS_IS_TERMINATING, но при этом счетчик ссылок уменьшается на 1, если счетчик меньше 21, то ядро устанавливает значение 32771. Интересный факт, можно создать дочерний процесс через NtCreateUserProcess, передав хэндл с правами PROCESS_CREATE_PROCESS. Вот здесь еще пару слов на эту тему: https://youtu.be/dB3seu4o24A?t=2089
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=404212&amp;user=52118&amp;forum_n=3&amp;topic=26391.html&amp;page=0&amp;anchor=18" class="addthx" data-post="404212"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 337.5 (мудрец), 348thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 20 марта 2020 19:15 <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=3&amp;topic=26391.html&amp;page=0#19');return false;">#19</a> </span><div align=left><br>
<b>hiddy</b><br><br>Используется блокировка на 10 ExfAcquireRundownProtection(), на 5 ExAcquireRundownProtection().<br><br>В 10-ке ссылок на неё ~100. Обычно там конструкия:<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>ExAcquireRundownProtection&nbsp;<span class="hl_char">(</span><span class="hl_char">&amp;</span>ProcessToLock<span class="hl_char">-</span><span class="hl_char">&gt;</span>RundownProtect<span class="hl_char">)</span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_function">FALSE</span><span class="hl_char">)</span>&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;STATUS_PROCESS_IS_TERMINATING<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;}</li>        </ol>
    </div>
</div></div>
<br><br>Если бегло глянуть, то эта синхронизация крутит цикл. До этого не поднимается IRQL для запрета ядерной APC. Тоесть можно тормознуть поток и любой иной будет крутится до разморозки первого, конечно нужно подробно посмотреть на реализацию блокировки. Почему блокировка не освободилась - можно лишь гадать. Баг какой то в ядре. Если он повторяется стабильно, то можно попытаться разобраться без отладки.
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=404270&amp;user=40990&amp;forum_n=3&amp;topic=26391.html&amp;page=0&amp;anchor=19" class="addthx" data-post="404270"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="20" onfocus="this.blur()" href="JavaScript:di('[b]stronglogic[/b]','')">stronglogic</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 4.6 (гость), 9thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.74'>Активность: 0.01<span style='color:green'>&nearr;</span>0.02</span><br>Статус: <a href="action=userinfo&amp;user=35992">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 21 марта 2020 14:09 <br><script type="text/javascript">QU('stronglogic','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=stronglogic" target="_blank">Личное сообщение</a> &middot;  <a href="#20" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=3&amp;topic=26391.html&amp;page=0#20');return false;">#20</a> </span><div align=left><br>
Как вариант можно, перезапустить Проводник (explorer.exe) через Диспетчер задач, еще можно попробовать Выйти из системы потом снова зайти и проверить, поискать в гугле утилиты и попробовать их в работе может какая-то из них справится с задачей, перезагрузка ПК крайний случай.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=404286&amp;user=35992&amp;forum_n=3&amp;topic=26391.html&amp;page=0&amp;anchor=20" class="addthx" data-post="404286"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="21" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 337.5 (мудрец), 348thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 21 марта 2020 14:12 <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#21" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=3&amp;topic=26391.html&amp;page=0#21');return false;">#21</a> </span><div align=left><br>
<b>stronglogic</b><br><br>Если ядро повисло то никакие танцы с бубном не помогут <img src="img/smilies/s5.gif" alt="">
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=404287&amp;user=40990&amp;forum_n=3&amp;topic=26391.html&amp;page=0&amp;anchor=21" class="addthx" data-post="404287"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/default.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=3&sortBy=0&page=0.html"><b>Софт, инструменты</b></a> <b class=bulletHead>&#8212;&#8250;</b> Убийство процессов-призраков</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#22" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="3">
<input type="hidden" name="topic" value="26391">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=26391" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
