<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Увеличение размера DOS заголовка. - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Экспериментирую со своим тестовым файлом. После увеличения, пересчитываем размер e_lfanew. Этого естественно мало, файл становится не рабочим. Пересчитываю PointerToRawData для всех секций. Вроде все они сдвигаются на нужное">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=55995'>tyns777</a>, <a target='_blank' href='?action=userinfo&amp;user=6859'>cppasm</a>, <a target='_blank' href='?action=userinfo&amp;user=55996'>dutyfree</a>, <a target='_blank' href='?action=userinfo&amp;user=28016'>asfa</a> (+7 невидимых)</b></span>
</td>
</tr>
</table>

 

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/nub.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=5&sortBy=0&page=0.html"><b>Вопросы новичков</b></a> <b class=bulletHead>&#8212;&#8250;</b> Увеличение размера DOS заголовка.</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]zombi-vadim[/b]','')">zombi-vadim</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 16.3 (новичок), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 3.41'>Активность: 0.15<span style='color:green'>&nearr;</span>0.22</span><br>Статус: <a href="action=userinfo&amp;user=42072">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 16 марта 2017 20:33 <br><script type="text/javascript">QU('zombi-vadim','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=zombi-vadim" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24641.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Экспериментирую со своим тестовым файлом. После увеличения, пересчитываем размер e_lfanew. Этого естественно мало, файл становится не рабочим. Пересчитываю PointerToRawData для всех секций. Вроде все они сдвигаются на нужное место, но этого тоже мало. Подскажите какие значения мне нужно пересчитать для восстановления работоспособности файла.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=373553&amp;user=42072&amp;forum_n=5&amp;topic=24641.html&amp;page=0&amp;anchor=1" class="addthx" data-post="373553"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]Cigan[/b]','')">Cigan</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 160.9 (ветеран), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.89'>Активность: 0.05<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=208">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 16 марта 2017 23:09 <br><script type="text/javascript">QU('Cigan','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Cigan" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24641.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
Я так полагаю что нужно почитать формат на МС и вопросы отпадут.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=373560&amp;user=208&amp;forum_n=5&amp;topic=24641.html&amp;page=0&amp;anchor=2" class="addthx" data-post="373560"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]zombi-vadim[/b]','')">zombi-vadim</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 16.3 (новичок), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 3.41'>Активность: 0.15<span style='color:green'>&nearr;</span>0.22</span><br>Статус: <a href="action=userinfo&amp;user=42072">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 16 марта 2017 23:14 <br><script type="text/javascript">QU('zombi-vadim','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=zombi-vadim" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24641.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
<b>Cigan</b>Я пытаюсь сократить время изучения формата, если вы не знаете ответа то писать в теме нет необходимости!
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=373561&amp;user=42072&amp;forum_n=5&amp;topic=24641.html&amp;page=0&amp;anchor=3" class="addthx" data-post="373561"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]SDK[/b]','')">SDK</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 54.0 (постоянный), 49thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 3.66'>Активность: 0.72<span style='color:green'>&nearr;</span>1.1</span><br>Статус: <a href="action=userinfo&amp;user=41635">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 16 марта 2017 23:21 <br><script type="text/javascript">QU('SDK','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=SDK" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24641.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
какой вы злой прогер)<br><br><b>Добавлено спустя -59 минут</b><br>тестовый файл надо глянуть
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=373562&amp;user=41635&amp;forum_n=5&amp;topic=24641.html&amp;page=0&amp;anchor=4" class="addthx" data-post="373562"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]zombi-vadim[/b]','')">zombi-vadim</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 16.3 (новичок), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 3.41'>Активность: 0.15<span style='color:green'>&nearr;</span>0.22</span><br>Статус: <a href="action=userinfo&amp;user=42072">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 16 марта 2017 23:25 <br><script type="text/javascript">QU('zombi-vadim','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=zombi-vadim" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24641.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
<I>SDK пишет:<br>тестовый файл надо глянуть  </I>Зачем? Там ничего нет. Соберите любой пустой файл в компиляторе.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=373563&amp;user=42072&amp;forum_n=5&amp;topic=24641.html&amp;page=0&amp;anchor=5" class="addthx" data-post="373563"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 222thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 16 марта 2017 23:28 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24641.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
<b>zombi-vadim</b><br>Во-первых, Вы неправильно выразились! Размер DOS-заголовка всегда 0x40 байт!<br>Во-вторых, e_lfanew(по смещению 0x3C) - не размер заголовка, а смещение следующего заголовка, который в основном всегда PE!<br><br>По сему, просто подозрения, что неправильно меняете значение поля e_lfanew...<br><br><b>Добавлено спустя -58 минут</b><br>Ну, а в-третьих, раз нельзя глянуть файл, то, упражняясь в телепатии, вангую, что Вы вдобавок забыли про ALIGNMENT ))
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=373564&amp;user=24257&amp;forum_n=5&amp;topic=24641.html&amp;page=0&amp;anchor=6" class="addthx" data-post="373564"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]dosprog[/b]','')">dosprog</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 431.7 (мудрец), 390thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.95'>Активность: 0.73<span style='color:red'>&searr;</span>0.32</span><br>Статус: <a href="action=userinfo&amp;user=35473">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 16 марта 2017 23:37 &middot; Поправил: dosprog <br><script type="text/javascript">QU('dosprog','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=dosprog" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24641.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
Есть такая программка - DEXEM (Dual-EXE Manipulator (с)Suslikov) - замените целиком DOS-stub с её помощью на другой,<br>убедитесь в работоспособности файла-результата и посмотрите, что там поменялось по сравнению с исходным.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=373565&amp;user=35473&amp;forum_n=5&amp;topic=24641.html&amp;page=0&amp;anchor=7" class="addthx" data-post="373565"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=41635" title="16-03-2017 20:46, ранг:6.1" target="_blank">SDK</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]zombi-vadim[/b]','')">zombi-vadim</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 16.3 (новичок), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 3.41'>Активность: 0.15<span style='color:green'>&nearr;</span>0.22</span><br>Статус: <a href="action=userinfo&amp;user=42072">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 16 марта 2017 23:38 <br><script type="text/javascript">QU('zombi-vadim','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=zombi-vadim" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24641.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
<I>DenCoder пишет:<br>По сему, просто подозрения, что неправильно меняете значение поля e_lfanew... </I> Да я неправильно выразился, я увеличиваю размер между DOS-заголовком  и следующем заголовком PE. Допустим добавляем некое количество нулей между ними.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=373566&amp;user=42072&amp;forum_n=5&amp;topic=24641.html&amp;page=0&amp;anchor=8" class="addthx" data-post="373566"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 222thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 16 марта 2017 23:44 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24641.html&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
Количество нулей(нулевых байт) должно быть кратно 8. Другого я не видел
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=373567&amp;user=24257&amp;forum_n=5&amp;topic=24641.html&amp;page=0&amp;anchor=9" class="addthx" data-post="373567"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]zombi-vadim[/b]','')">zombi-vadim</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 16.3 (новичок), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 3.41'>Активность: 0.15<span style='color:green'>&nearr;</span>0.22</span><br>Статус: <a href="action=userinfo&amp;user=42072">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 16 марта 2017 23:53 <br><script type="text/javascript">QU('zombi-vadim','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=zombi-vadim" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24641.html&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
<b>DenCoder</b>Что то вы мозг компоситуете после дос заголовка может идти  This program must be run under Win32 или This program cannot be run in DOS mode , потом идет или не идет рич сигнатура. Размеры e_lfanew получатся разные.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=373568&amp;user=42072&amp;forum_n=5&amp;topic=24641.html&amp;page=0&amp;anchor=10" class="addthx" data-post="373568"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]dosprog[/b]','')">dosprog</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 431.7 (мудрец), 390thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.95'>Активность: 0.73<span style='color:red'>&searr;</span>0.32</span><br>Статус: <a href="action=userinfo&amp;user=35473">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 марта 2017 00:00 &middot; Поправил: dosprog <br><script type="text/javascript">QU('dosprog','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=dosprog" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24641.html&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
) Э. повежливей.<br><b>DenCoder</b> прав.<br>DOS-MZ заголовок имеет размер 0х40, такой у него формат.<br>Всё остальное, до PE- заголовка, - это собственно DOS&#039;овский исполняемый EXE.<br>Там может быть вообще что угодно, разного размера.<br>А может не быть вообще ничего - сразу по смещению 40h и будет PE-заголовок.<br>Такое делают некоторые упаковщики.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=373569&amp;user=35473&amp;forum_n=5&amp;topic=24641.html&amp;page=0&amp;anchor=11" class="addthx" data-post="373569"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 марта 2017 00:04 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24641.html&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
<I>zombi-vadim пишет:<br>Соберите любой пустой файл в компиляторе.</I><br>Это нам надо, что ли? Есть файл-выкладывай. Нет-нечего и <I>мозг компоситуете</I> тогда.<br>Как минимум дебаг инфа и инфа о подписи содержат file offset, и их надо пересчитывать.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=373570&amp;user=1556&amp;forum_n=5&amp;topic=24641.html&amp;page=0&amp;anchor=12" class="addthx" data-post="373570"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=24257" title="16-03-2017 20:41, ранг:259.7" target="_blank">DenCoder</a>, <a href="action=userinfo&user=26846" title="17-03-2017 02:52, ранг:32.3" target="_blank">kampaster</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]zombi-vadim[/b]','')">zombi-vadim</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 16.3 (новичок), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 3.41'>Активность: 0.15<span style='color:green'>&nearr;</span>0.22</span><br>Статус: <a href="action=userinfo&amp;user=42072">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 марта 2017 00:08 <br><script type="text/javascript">QU('zombi-vadim','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=zombi-vadim" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24641.html&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
<I>dosprog пишет:<br>Всё остальное, до PE- заголовка </I>Простите, я просто задаю вопрос а на него получаю еще десять вопросов. Я что то запихнул между DOS-MZ и PE- заголовок. Соответственно пересчитал e_lfanew. Как мне восстановить файл?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=373571&amp;user=42072&amp;forum_n=5&amp;topic=24641.html&amp;page=0&amp;anchor=13" class="addthx" data-post="373571"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]dosprog[/b]','')">dosprog</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 431.7 (мудрец), 390thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.95'>Активность: 0.73<span style='color:red'>&searr;</span>0.32</span><br>Статус: <a href="action=userinfo&amp;user=35473">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 марта 2017 00:09 &middot; Поправил: dosprog <br><script type="text/javascript">QU('dosprog','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=dosprog" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24641.html&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
<I>zombi-vadim пишет:<br>Как мне восстановить файл?<br> </I><br>- Из резервной копии.<br><br>DEXEM попробовали?<br><br><br><I>DenCoder пишет:<br>Количество нулей(нулевых байт) должно быть кратно 8. Другого я не видел<br> </I><br>.. выравнивание по QWORD ..<br><i class=x><br></i>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=373572&amp;user=35473&amp;forum_n=5&amp;topic=24641.html&amp;page=0&amp;anchor=14" class="addthx" data-post="373572"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 222thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 марта 2017 00:11 <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24641.html&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
<b>zombi-vadim</b><br>RTFM, вообще-то!
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=373573&amp;user=24257&amp;forum_n=5&amp;topic=24641.html&amp;page=0&amp;anchor=15" class="addthx" data-post="373573"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=4773" title="17-03-2017 00:01, ранг:237.9" target="_blank">plutos</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]SDK[/b]','')">SDK</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 54.0 (постоянный), 49thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 3.66'>Активность: 0.72<span style='color:green'>&nearr;</span>1.1</span><br>Статус: <a href="action=userinfo&amp;user=41635">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 марта 2017 00:56 <br><script type="text/javascript">QU('SDK','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=SDK" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24641.html&amp;page=0#16');return false;">#16</a> </span><div align=left><br>
DEXEM попробовали?<br><br>еще бы знать каким пользоваться?)
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=373575&amp;user=41635&amp;forum_n=5&amp;topic=24641.html&amp;page=0&amp;anchor=16" class="addthx" data-post="373575"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]dosprog[/b]','')">dosprog</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 431.7 (мудрец), 390thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.95'>Активность: 0.73<span style='color:red'>&searr;</span>0.32</span><br>Статус: <a href="action=userinfo&amp;user=35473">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 марта 2017 00:59 <br><script type="text/javascript">QU('dosprog','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=dosprog" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24641.html&amp;page=0#17');return false;">#17</a> </span><div align=left><br>
<I>SDK пишет:<br>еще бы знать каким пользоваться?)  </I><br><br><noindex><a href="http://hiew.ru/files/dexem153.zip" rel="nofollow" target="_blank">--&gt; Этот &lt;--</a></noindex> нормальный.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=373576&amp;user=35473&amp;forum_n=5&amp;topic=24641.html&amp;page=0&amp;anchor=17" class="addthx" data-post="373576"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]-=AkaBOSS=-[/b]','')">-=AkaBOSS=-</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/26242.png" alt=""><br><span class=txtSm>Ранг: 150.3 (ветеран), 175thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.88'>Активность: 0.16<span style='color:red'>&searr;</span>0.07</span><br>Статус: <a href="action=userinfo&amp;user=26242">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 марта 2017 05:22 <br><script type="text/javascript">QU('-=AkaBOSS=-','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=-=AkaBOSS=-" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24641.html&amp;page=0#18');return false;">#18</a> </span><div align=left><br>
<I>zombi-vadim пишет:<br>я увеличиваю размер между DOS-заголовком и следующем заголовком PE. Допустим добавляем некое количество нулей между ними.  </I><br>про выравнивание уже написали.<br>и не забываем, что ПЕхидер <b>обязан</b> присутствовать в памяти после загрузки модуля.<br>а значит,  он должен либо находиться в пространстве какой-либо секции, либо возле ДОСхидера (ImageBase .. ImageBase+SectionAlignment)
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=373578&amp;user=26242&amp;forum_n=5&amp;topic=24641.html&amp;page=0&amp;anchor=18" class="addthx" data-post="373578"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]Jupiter[/b]','')">Jupiter</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/1379.png" alt=""><br><span class=txtSm>Ранг: 605.2 (<b>!</b>), 341thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.38'>Активность: 0.47<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1379">Модератор</a><br><font color=blue>Research &amp; Development</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 марта 2017 10:44 <br><script type="text/javascript">QU('Jupiter','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Jupiter" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24641.html&amp;page=0#19');return false;">#19</a> </span><div align=left><br>
<I>zombi-vadim пишет:<br>Я пытаюсь сократить время изучения формата, если вы не знаете ответа то писать в теме нет необходимости!</I><br><br>Зомби-новичок по имени Вадим идёт отдыхать и учиться вежливости на несколько дней.<br>Уж слишком заметна у этого зомби нехватка того, <noindex><a href="http://static.comicsia.ru/i/42/7a-17018.jpeg" rel="nofollow" target="_blank">чего так не хватает всем зомби</a></noindex>.<br><br>Почитать на досуге классику:<br><br>Номер раз: PE Format<br>pecoff.docx, Size: 206 KB, Date Published: 1/24/2017<br><noindex><a href="http://www.microsoft.com/whdc/system/platform/firmware/PECOFF.mspx" rel="nofollow" target="_blank">http://www.microsoft.com/whdc/system/platform/firmware/PECOFF.mspx</a></noindex><br><br>Номер два: <noindex><a href="http://uinc.ru/articles/41/" rel="nofollow" target="_blank">Об упаковщиках в последний раз: Часть первая - теоретическая</a></noindex><br><br><br><img src="http://68.media.tumblr.com/3498fa29464d75c1d9b4281ceb1c3820/tumblr_nmc6dqNyZj1r9zg1jo1_400.gif" border="0" align="" alt="">
<br><br><font size="1"><i>-----<br>EnJoy!</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=373583&amp;user=1379&amp;forum_n=5&amp;topic=24641.html&amp;page=0&amp;anchor=19" class="addthx" data-post="373583"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=8830" title="17-03-2017 07:44, ранг:263.1" target="_blank">ajax</a>, <a href="action=userinfo&user=24257" title="17-03-2017 09:33, ранг:259.7" target="_blank">DenCoder</a>, <a href="action=userinfo&user=4773" title="17-03-2017 10:02, ранг:237.9" target="_blank">plutos</a></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/nub.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=5&sortBy=0&page=0.html"><b>Вопросы новичков</b></a> <b class=bulletHead>&#8212;&#8250;</b> Увеличение размера DOS заголовка.</span></td>
</tr></table>
</div>
<a name=newreply></a>
<div align=center>
<table class=forums>
<tr>
<td class=caption4 width="100%"><span class=header>Эта тема закрыта. Ответы больше не принимаются.</span></td>
</tr>
</table>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=24641" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
