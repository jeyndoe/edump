<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Инжект длл в удаленный процесс фейлится - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Изучаю инжект DLL общим способом. По книге Рихтера и паре статей сделал такой код: dll.h: Code:       #ifdef&nbsp;DLL_EXPORTS#define&nbsp;DLL_API&nbsp;__declspec(dllexport)&nbsp;#else#define&nbsp;DLL_API&nbsp;__declspec(dllimport)">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=40382'>jinoweb</a>, <a target='_blank' href='?action=userinfo&amp;user=26261'>bartolomeo</a> (+5 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Инжект длл в удаленный процесс фейлится</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]ZeroMemory[/b]','')">ZeroMemory</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 7.5 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 3.86'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=41259">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 ноября 2016 00:18 <br><script type="text/javascript">QU('ZeroMemory','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ZeroMemory" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24417.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Изучаю инжект DLL общим способом. По книге Рихтера и паре статей сделал такой код:<br><br>dll.h:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">#ifdef&nbsp;DLL_EXPORTS</li><li class="hl_l1">#define&nbsp;DLL_API&nbsp;__declspec<span class="hl_char">(</span>dllexport<span class="hl_char">)</span>&nbsp;</li><li class="hl_l0">#else</li><li class="hl_l1">#define&nbsp;DLL_API&nbsp;__declspec<span class="hl_char">(</span>dllimport<span class="hl_char">)</span>&nbsp;</li><li class="hl_l0">#endif</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">#include&nbsp;<span class="hl_char">&lt;</span>windows<span class="hl_char">.</span>h<span class="hl_char">&gt;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_function"><b>void</b></span>&nbsp;ShowDllForm<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div>
<br><br>dll.cpp<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">#define&nbsp;DLL_EXPORTS</li><li class="hl_l1">#include&nbsp;<span class="hl_quote">&quot;dll.h&quot;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">BOOL&nbsp;APIENTRY&nbsp;DllMain<span class="hl_char">(</span>HMODULE&nbsp;hModule<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;dwReasonForCall<span class="hl_char">,</span>&nbsp;LPVOID&nbsp;lpReserved<span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>DLL_PROCESS_ATTACH&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;dwReasonForCall<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ShowDllForm<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_function"><b>TRUE</b></span><span class="hl_comment">;</span></li><li class="hl_l0">}</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_function"><b>void</b></span>&nbsp;ShowDllForm<span class="hl_char">(</span><span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;MessageBox<span class="hl_char">(</span><span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;TEXT<span class="hl_char">(</span><span class="hl_quote">&quot;Hello, World!&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;TEXT<span class="hl_char">(</span><span class="hl_quote">&quot;Injected&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;MB_OK<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">}</li>        </ol>
    </div>
</div></div>
<br><br>ui.h<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">#ifndef&nbsp;__UI_H_</li><li class="hl_l1">#define&nbsp;__UI_H_</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">#include&nbsp;<span class="hl_char">&lt;</span>windows<span class="hl_char">.</span>h<span class="hl_char">&gt;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>void</b></span>&nbsp;RegisterWndClass<span class="hl_char">(</span>WNDPROC&nbsp;<span class="hl_function">Proc</span><span class="hl_char">,</span>&nbsp;LPCTSTR&nbsp;szName<span class="hl_char">,</span>&nbsp;UINT&nbsp;brBackground<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">#endif</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">ui<span class="hl_char">.</span>cpp</li><li class="hl_l0">#include&nbsp;<span class="hl_quote">&quot;ui.h&quot;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_function"><b>void</b></span>&nbsp;RegisterWndClass<span class="hl_char">(</span>WNDPROC&nbsp;<span class="hl_function">Proc</span><span class="hl_char">,</span>&nbsp;LPCTSTR&nbsp;szName<span class="hl_char">,</span>&nbsp;UINT&nbsp;brBackground<span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;WNDCLASSEX&nbsp;wc<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;wc<span class="hl_char">.</span>cbSize&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>wc<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;wc<span class="hl_char">.</span>style&nbsp;<span class="hl_char">=</span>&nbsp;CS_HREDRAW&nbsp;<span class="hl_char">|</span>&nbsp;CS_VREDRAW<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;wc<span class="hl_char">.</span>lpfnWndProc&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function"><b>Proc</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;wc<span class="hl_char">.</span>cbClsExtra&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;wc<span class="hl_char">.</span>cbWndExtra&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;wc<span class="hl_char">.</span>hInstance&nbsp;<span class="hl_char">=</span>&nbsp;GetModuleHandle<span class="hl_char">(</span><span class="hl_function">NULL</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;wc<span class="hl_char">.</span>hIcon&nbsp;<span class="hl_char">=</span>&nbsp;LoadIcon<span class="hl_char">(</span><span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;IDI_APPLICATION<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;wc<span class="hl_char">.</span>hCursor&nbsp;<span class="hl_char">=</span>&nbsp;LoadCursor<span class="hl_char">(</span><span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;IDC_ARROW<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;wc<span class="hl_char">.</span>hbrBackground&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">(</span>HBRUSH<span class="hl_char">)</span>brBackground<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;wc<span class="hl_char">.</span>lpszMenuName&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;wc<span class="hl_char">.</span>lpszClassName&nbsp;<span class="hl_char">=</span>&nbsp;szName<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;wc<span class="hl_char">.</span>hIconSm&nbsp;<span class="hl_char">=</span>&nbsp;LoadIcon<span class="hl_char">(</span><span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;IDI_APPLICATION<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span><span class="hl_char">!</span>RegisterClassEx<span class="hl_char">(</span><span class="hl_char">&amp;</span>wc<span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox<span class="hl_char">(</span><span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;TEXT<span class="hl_char">(</span><span class="hl_quote">&quot;Cannot register class&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;TEXT<span class="hl_char">(</span><span class="hl_quote">&quot;Error&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;MB_OK<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">}</li>        </ol>
    </div>
</div></div>
<br><br>main.cpp<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">#include&nbsp;<span class="hl_char">&lt;</span>windows<span class="hl_char">.</span>h<span class="hl_char">&gt;</span></li><li class="hl_l1">#include&nbsp;<span class="hl_char">&lt;</span>Shlwapi<span class="hl_char">.</span>h<span class="hl_char">&gt;</span></li><li class="hl_l0">#include&nbsp;<span class="hl_char">&lt;</span>TlHelp32<span class="hl_char">.</span>h<span class="hl_char">&gt;</span></li><li class="hl_l1">#include&nbsp;<span class="hl_char">&lt;</span>string<span class="hl_char">.</span>h<span class="hl_char">&gt;</span></li><li class="hl_l0">#include&nbsp;<span class="hl_quote">&quot;ui.h&quot;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">#pragma&nbsp;<span class="hl_function">comment</span><span class="hl_char">(</span>lib<span class="hl_char">,</span>&nbsp;<span class="hl_quote">&quot;Shlwapi.lib&quot;</span><span class="hl_char">)</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">#define&nbsp;TEXTBOX_PROCESS&nbsp;<span class="hl_number">3000</span></li><li class="hl_l1">#define&nbsp;TEXTBOX_DLL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">3001</span></li><li class="hl_l0">#define&nbsp;BUTTON_INJECT&nbsp;&nbsp;&nbsp;<span class="hl_number">3002</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">#define&nbsp;BUFFER_SIZE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">128</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">TCHAR&nbsp;processName<span class="hl_char">[</span>BUFFER_SIZE<span class="hl_char">]</span><span class="hl_comment">;</span></li><li class="hl_l1">TCHAR&nbsp;dllName<span class="hl_char">[</span>BUFFER_SIZE<span class="hl_char">]</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">LRESULT&nbsp;CALLBACK&nbsp;WndProc<span class="hl_char">(</span>HWND&nbsp;hWnd<span class="hl_char">,</span>&nbsp;UINT&nbsp;uMsg<span class="hl_char">,</span>&nbsp;WPARAM&nbsp;wParam<span class="hl_char">,</span>&nbsp;LPARAM&nbsp;lParam<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">BOOL&nbsp;StartInjection<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">BOOL&nbsp;Inject<span class="hl_char">(</span><span class="hl_function"><b>DWORD</b></span>&nbsp;pid<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>int</b></span>&nbsp;WINAPI&nbsp;WinMain<span class="hl_char">(</span>HINSTANCE&nbsp;hInstance<span class="hl_char">,</span>&nbsp;HINSTANCE&nbsp;hPrevInstance<span class="hl_char">,</span>&nbsp;LPSTR&nbsp;lpCmdLine<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;nCmdShow<span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;HWND&nbsp;hMainWnd<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;MSG&nbsp;msg<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;RegisterWndClass<span class="hl_char">(</span>WndProc<span class="hl_char">,</span>&nbsp;TEXT<span class="hl_char">(</span><span class="hl_quote">&quot;Injector&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;COLOR_WINDOW<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;hMainWnd&nbsp;<span class="hl_char">=</span>&nbsp;CreateWindow<span class="hl_char">(</span>TEXT<span class="hl_char">(</span><span class="hl_quote">&quot;Injector&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;TEXT<span class="hl_char">(</span><span class="hl_quote">&quot;Injector&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WS_CAPTION&nbsp;<span class="hl_char">|</span>&nbsp;WS_SYSMENU&nbsp;<span class="hl_char">|</span>&nbsp;WS_MINIMIZEBOX<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CW_USEDEFAULT<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">250</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">130</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">(</span>HWND<span class="hl_char">)</span><span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">(</span>HMENU<span class="hl_char">)</span><span class="hl_function">NULL</span><span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">(</span>HINSTANCE<span class="hl_char">)</span>hInstance<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span><span class="hl_char">!</span>hMainWnd<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox<span class="hl_char">(</span><span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;TEXT<span class="hl_char">(</span><span class="hl_quote">&quot;Can't create main window.&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;TEXT<span class="hl_char">(</span><span class="hl_quote">&quot;Error&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;MB_OK<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;GetLastError<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;ShowWindow<span class="hl_char">(</span>hMainWnd<span class="hl_char">,</span>&nbsp;nCmdShow<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>while</b></span>&nbsp;<span class="hl_char">(</span>GetMessage<span class="hl_char">(</span><span class="hl_char">&amp;</span>msg<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TranslateMessage<span class="hl_char">(</span><span class="hl_char">&amp;</span>msg<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DispatchMessage<span class="hl_char">(</span><span class="hl_char">&amp;</span>msg<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">}</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">LRESULT&nbsp;CALLBACK&nbsp;WndProc<span class="hl_char">(</span>HWND&nbsp;hWnd<span class="hl_char">,</span>&nbsp;UINT&nbsp;uMsg<span class="hl_char">,</span>&nbsp;WPARAM&nbsp;wParam<span class="hl_char">,</span>&nbsp;LPARAM&nbsp;lParam<span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;HDC&nbsp;hDC<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;PAINTSTRUCT&nbsp;ps<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;RECT&nbsp;rect<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;TCHAR&nbsp;buffer<span class="hl_char">[</span>BUFFER_SIZE<span class="hl_char">]</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;<span class="hl_char">(</span>uMsg<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;WM_CREATE<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">*</span>&nbsp;Create&nbsp;text&nbsp;box&nbsp;containing&nbsp;process&nbsp;name&nbsp;<span class="hl_char">*</span><span class="hl_char">/</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CreateWindow<span class="hl_char">(</span>TEXT<span class="hl_char">(</span><span class="hl_quote">&quot;EDIT&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;WS_BORDER&nbsp;<span class="hl_char">|</span>&nbsp;WS_VISIBLE&nbsp;<span class="hl_char">|</span>&nbsp;WS_CHILD&nbsp;<span class="hl_char">|</span>&nbsp;ES_LEFT&nbsp;<span class="hl_char">|</span>&nbsp;ES_MULTILINE<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">10</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">10</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">120</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">20</span><span class="hl_char">,</span>&nbsp;hWnd<span class="hl_char">,</span>&nbsp;<span class="hl_char">(</span>HMENU<span class="hl_char">)</span>TEXTBOX_PROCESS<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">*</span>&nbsp;Create&nbsp;text&nbsp;box&nbsp;containing&nbsp;dll&nbsp;name&nbsp;<span class="hl_char">*</span><span class="hl_char">/</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CreateWindow<span class="hl_char">(</span>TEXT<span class="hl_char">(</span><span class="hl_quote">&quot;EDIT&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;WS_BORDER&nbsp;<span class="hl_char">|</span>&nbsp;WS_VISIBLE&nbsp;<span class="hl_char">|</span>&nbsp;WS_CHILD&nbsp;<span class="hl_char">|</span>&nbsp;ES_LEFT&nbsp;<span class="hl_char">|</span>&nbsp;ES_MULTILINE<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">10</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">35</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">120</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">20</span><span class="hl_char">,</span>&nbsp;hWnd<span class="hl_char">,</span>&nbsp;<span class="hl_char">(</span>HMENU<span class="hl_char">)</span>TEXTBOX_DLL<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">*</span>&nbsp;Create&nbsp;button&nbsp;to&nbsp;inject&nbsp;dll&nbsp;<span class="hl_char">*</span><span class="hl_char">/</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CreateWindow<span class="hl_char">(</span>TEXT<span class="hl_char">(</span><span class="hl_quote">&quot;BUTTON&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;TEXT<span class="hl_char">(</span><span class="hl_quote">&quot;Inject&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;WS_CHILD&nbsp;<span class="hl_char">|</span>&nbsp;BS_PUSHBUTTON&nbsp;<span class="hl_char">|</span>&nbsp;WS_VISIBLE<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">150</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">10</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">60</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">20</span><span class="hl_char">,</span>&nbsp;hWnd<span class="hl_char">,</span>&nbsp;<span class="hl_char">(</span>HMENU<span class="hl_char">)</span>BUTTON_INJECT<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>break</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;WM_PAINT<span class="hl_char">:</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hDC&nbsp;<span class="hl_char">=</span>&nbsp;BeginPaint<span class="hl_char">(</span>hWnd<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>ps<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GetClientRect<span class="hl_char">(</span>hWnd<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>rect<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EndPaint<span class="hl_char">(</span>hWnd<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>ps<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>break</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;WM_SIZE<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>break</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;WM_CLOSE<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DestroyWindow<span class="hl_char">(</span>hWnd<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>break</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;WM_DESTROY<span class="hl_char">:</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PostQuitMessage<span class="hl_char">(</span><span class="hl_number">0</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>break</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;WM_COMMAND<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;<span class="hl_char">(</span>LOWORD<span class="hl_char">(</span>wParam<span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;BUTTON_INJECT<span class="hl_char">:</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GetDlgItemText<span class="hl_char">(</span>hWnd<span class="hl_char">,</span>&nbsp;TEXTBOX_PROCESS<span class="hl_char">,</span>&nbsp;buffer<span class="hl_char">,</span>&nbsp;BUFFER_SIZE<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StrCpyN<span class="hl_char">(</span>processName<span class="hl_char">,</span>&nbsp;buffer<span class="hl_char">,</span>&nbsp;BUFFER_SIZE<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZeroMemory<span class="hl_char">(</span>buffer<span class="hl_char">,</span>&nbsp;BUFFER_SIZE<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GetDlgItemText<span class="hl_char">(</span>hWnd<span class="hl_char">,</span>&nbsp;TEXTBOX_DLL<span class="hl_char">,</span>&nbsp;buffer<span class="hl_char">,</span>&nbsp;BUFFER_SIZE<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StrCpyN<span class="hl_char">(</span>dllName<span class="hl_char">,</span>&nbsp;buffer<span class="hl_char">,</span>&nbsp;BUFFER_SIZE<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StartInjection<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>break</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>break</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>break</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;default<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;DefWindowProc<span class="hl_char">(</span>hWnd<span class="hl_char">,</span>&nbsp;uMsg<span class="hl_char">,</span>&nbsp;wParam<span class="hl_char">,</span>&nbsp;lParam<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l1">}</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">BOOL&nbsp;StartInjection<span class="hl_char">(</span><span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;PID&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;PROCESSENTRY32&nbsp;pe<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;HANDLE&nbsp;snapshot&nbsp;<span class="hl_char">=</span>&nbsp;CreateToolhelp32Snapshot<span class="hl_char">(</span>TH32CS_SNAPPROCESS<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>INVALID_HANDLE_VALUE&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;snapshot<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox<span class="hl_char">(</span><span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;TEXT<span class="hl_char">(</span><span class="hl_quote">&quot;Snapshot failed&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;TEXT<span class="hl_char">(</span><span class="hl_quote">&quot;ERROR&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;MB_OK<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_function"><b>FALSE</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;pe<span class="hl_char">.</span>dwSize&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>PROCESSENTRY32<span class="hl_char">)</span><span class="hl_comment">; /* If you do not initialize dwSize, Process32First fails */</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;BOOL&nbsp;curr&nbsp;<span class="hl_char">=</span>&nbsp;Process32First<span class="hl_char">(</span>snapshot<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>pe<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>while</b></span>&nbsp;<span class="hl_char">(</span>curr<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CharLowerBuff<span class="hl_char">(</span>pe<span class="hl_char">.</span>szExeFile<span class="hl_char">,</span>&nbsp;lstrlen<span class="hl_char">(</span>pe<span class="hl_char">.</span>szExeFile<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>StrStr<span class="hl_char">(</span>pe<span class="hl_char">.</span>szExeFile<span class="hl_char">,</span>&nbsp;processName<span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PID&nbsp;<span class="hl_char">=</span>&nbsp;pe<span class="hl_char">.</span>th32ProcessID<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>break</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curr&nbsp;<span class="hl_char">=</span>&nbsp;Process32Next<span class="hl_char">(</span>snapshot<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>pe<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span><span class="hl_number">0</span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;PID<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox<span class="hl_char">(</span><span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;TEXT<span class="hl_char">(</span><span class="hl_quote">&quot;Process not found&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;TEXT<span class="hl_char">(</span><span class="hl_quote">&quot;ERROR&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;MB_OK<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_function"><b>FALSE</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;BOOL&nbsp;result&nbsp;<span class="hl_char">=</span>&nbsp;Inject<span class="hl_char">(</span>PID<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span><span class="hl_function"><b>FALSE</b></span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;result<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox<span class="hl_char">(</span><span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;TEXT<span class="hl_char">(</span><span class="hl_quote">&quot;Injection failed&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;TEXT<span class="hl_char">(</span><span class="hl_quote">&quot;ERROR&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;MB_OK<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_function"><b>FALSE</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_function"><b>TRUE</b></span><span class="hl_comment">;</span></li><li class="hl_l0">}</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">BOOL&nbsp;Inject<span class="hl_char">(</span><span class="hl_function"><b>DWORD</b></span>&nbsp;pid<span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span><span class="hl_number">0</span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;pid<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_function"><b>FALSE</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;HANDLE&nbsp;process&nbsp;<span class="hl_char">=</span>&nbsp;OpenProcess<span class="hl_char">(</span>PROCESS_ALL_ACCESS<span class="hl_char">,</span>&nbsp;<span class="hl_function">FALSE</span><span class="hl_char">,</span>&nbsp;pid<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span><span class="hl_function"><b>NULL</b></span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;process<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_function"><b>FALSE</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;LPVOID&nbsp;loadlib&nbsp;<span class="hl_char">=</span>&nbsp;GetProcAddress<span class="hl_char">(</span>GetModuleHandle<span class="hl_char">(</span>TEXT<span class="hl_char">(</span><span class="hl_quote">&quot;kernel32.dll&quot;</span><span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;<span class="hl_quote">&quot;LoadLibraryA&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span><span class="hl_function"><b>NULL</b></span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;loadlib<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_function"><b>FALSE</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;LPVOID&nbsp;libname&nbsp;<span class="hl_char">=</span>&nbsp;VirtualAllocEx<span class="hl_char">(</span>process<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;lstrlen<span class="hl_char">(</span>dllName<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;&nbsp;MEM_COMMIT&nbsp;<span class="hl_char">|</span>&nbsp;MEM_RESERVE<span class="hl_char">,</span>&nbsp;PAGE_READWRITE<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span><span class="hl_function"><b>NULL</b></span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;libname<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_function"><b>FALSE</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;BOOL&nbsp;written&nbsp;<span class="hl_char">=</span>&nbsp;WriteProcessMemory<span class="hl_char">(</span>process<span class="hl_char">,</span>&nbsp;libname<span class="hl_char">,</span>&nbsp;dllName<span class="hl_char">,</span>&nbsp;lstrlen<span class="hl_char">(</span>dllName<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span><span class="hl_function"><b>FALSE</b></span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;written<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_function"><b>FALSE</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;HANDLE&nbsp;thread&nbsp;<span class="hl_char">=</span>&nbsp;CreateRemoteThread<span class="hl_char">(</span>process<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">(</span>LPTHREAD_START_ROUTINE<span class="hl_char">)</span>loadlib<span class="hl_char">,</span>&nbsp;libname<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span><span class="hl_function"><b>NULL</b></span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;thread<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_function"><b>FALSE</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle<span class="hl_char">(</span>process<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_function"><b>TRUE</b></span><span class="hl_comment">;</span></li><li class="hl_l1">}</li>        </ol>
    </div>
</div></div>
<br><br>В main плохая декомпозиция (завтра выделю две отдельных функции для читаемости), но разобраться можно. <br><br>Инжект не получается. Пробовал сделать инжект в сам инжектор и в эксплорер, но ничего не происходит. Когда под отладчиком делаю инжект в себя, то вижу, что успешно создается и завершается удаленный потом, но DLL-ка не подгружается. Что здесь может быть не так? Пусть к DLL прописывал и как InjDLL.dll, и как C:\InjDLL.dll, и как &quot;C:\InjDLL.dll&quot;. Не помогло. Думал, что не хватает терминирующего нуля в конце пути к длл, поэтому добавил дополнительные байты в массиве, но это тоже не помогло.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=369286&amp;user=41259&amp;forum_n=6&amp;topic=24417.html&amp;page=0&amp;anchor=1" class="addthx" data-post="369286"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 338.5 (мудрец), 349thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 ноября 2016 00:33 <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24417.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
<b>ZeroMemory</b><br><br>Для начала вынесите MsgBox() из DllMain, так нельзя делать, вероятно оно и виснет у вас из за деадлока.
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=369289&amp;user=40990&amp;forum_n=6&amp;topic=24417.html&amp;page=0&amp;anchor=2" class="addthx" data-post="369289"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]ZeroMemory[/b]','')">ZeroMemory</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 7.5 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 3.86'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=41259">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 ноября 2016 19:06 <br><script type="text/javascript">QU('ZeroMemory','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ZeroMemory" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24417.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
<I>difexacaw пишет:<br>так нельзя делать, вероятно оно и виснет у вас из за деадлока </I><br>Почему? Можно подробнее? Допустим, у меня есть программа с гуем, которую надо скрыть из процессов. Для этого я хочу сделать ее как DLL и запускать внутри другого процесса. Так нельзя?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=369312&amp;user=41259&amp;forum_n=6&amp;topic=24417.html&amp;page=0&amp;anchor=3" class="addthx" data-post="369312"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 221thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 ноября 2016 23:27 <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24417.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
<I>ZeroMemory пишет:<br>Почему? Можно подробнее? </I><br>https://msdn.microsoft.com/en-us/library/windows/desktop/ms682583(v=vs.85).aspx
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=369317&amp;user=24257&amp;forum_n=6&amp;topic=24417.html&amp;page=0&amp;anchor=4" class="addthx" data-post="369317"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 ноября 2016 23:32 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24417.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
Подробнее смотри мсдн DllMain и её ограничения.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=369318&amp;user=1556&amp;forum_n=6&amp;topic=24417.html&amp;page=0&amp;anchor=5" class="addthx" data-post="369318"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 221thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 ноября 2016 23:33 <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24417.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
https://msdn.microsoft.com/en-us/library/windows/desktop/dn633971(v=vs.85).aspx#general_best_practices<br><br>Что-то из перечисленного в <b>You should never perform the following tasks from within DllMain:</b>,<br>делать можно, но очень сторожно, конкретное поведение зависит от версии винды и лучше обходиться без этого.
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=369319&amp;user=24257&amp;forum_n=6&amp;topic=24417.html&amp;page=0&amp;anchor=6" class="addthx" data-post="369319"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 338.5 (мудрец), 349thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 ноября 2016 01:07 &middot; Поправил: difexacaw <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24417.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
<b>DenCoder</b><br><br>Захватывается загрузочная блокировка, а вызов гуя это обычно масштабная операция и при попытке подгрузки модуля(а он будет подгружен, да и любое обращение асинхронное к загрузчику или по иным причинам - он слишком наворочен) произойдёт деадлок, конечно есть свои нюансы - критические секции поддерживают рекурсивные входы(спины), но учитывая всё такое практически с абсолютной вероятностью приведёт к зависанию.<br><br>Есть же dbgprint, зачем гуй трогать, его вообще трогать не следует если кодес не гуй.<br><br>А отладчик заюзать это конечно же оверхед.<br><br>Синхронизации важны, могу привести известный пример, это бага в нт - если вы трассируете код и возникнет при этом какое либо исключение, то после рестарта инструкции начнёт трассироваться диспетчер исключений, это будет продолжаться до захвата кс, после чего возникнет деадлок. И таких ситуаций очень много, следует понимать что и когда вызвать.<br><br><b>Добавлено спустя 49 минут</b><br><b>ZeroMemory</b><br><br>&gt; Допустим, у меня есть программа с гуем, которую надо скрыть из процессов. Для этого я хочу сделать ее как DLL и запускать внутри другого процесса. Так нельзя? <br><br>Гуй(ядро shadow) хранит инфу в огромном числе интернал структур, есть даже механизм пакетной обработки запросов - гуй обрабатывает системные вызовы подобно высокоуровневому фильтру. Учитывая всё сложность этой системы что то там скрыть из юзермода, да и вообще(для работы в шадов ядре нужно переключать сессии етц) - не представляется возможным даже теоретически, более того сейчас концепт скрытия таков - нет скрытых обьектов и нет детекта, тоесть сам факт сокрытия служит детектом и на это весь аверский функционал пилится.<br><br>Вызов же какой то функции из недр загрузчика - это сложная довольно операция, нужно как то отложить управление до возврата из загрузчика(методы не будем рассматривать ибо не суть важно, так не нужно делать). Можно к примеру создать поток и синхронно обождать, но никак не заюзать какую то подсистему(гуй) да есчо и в первый раз(произойдёт её инициализация, что очень большая обработка).
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=369322&amp;user=40990&amp;forum_n=6&amp;topic=24417.html&amp;page=0&amp;anchor=7" class="addthx" data-post="369322"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 221thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 ноября 2016 14:13 <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24417.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
<I>difexacaw пишет:<br> и при попытке подгрузки модуля произойдёт деадлок</I><br>Есть какие-то условия, при которых MessageBox успешно выполнится из DllMain. Я так думаю, что по меньшей мере для этого требуется наличия инциализированной user32, и может быть, comctl...<br><br><I>difexacaw пишет:<br>более того сейчас концепт скрытия таков - нет скрытых обьектов и нет детекта, тоесть сам факт сокрытия служит детектом и на это весь аверский функционал пилится. </I><br>Смотря какой авер ещё! Аваст, например, просто кладезь для инжектов <img src="img/smilies/s1.gif" alt="">
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=369330&amp;user=24257&amp;forum_n=6&amp;topic=24417.html&amp;page=0&amp;anchor=8" class="addthx" data-post="369330"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 338.5 (мудрец), 349thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 ноября 2016 13:15 <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24417.html&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
<b>DenCoder</b><br><br>&gt; наличия инциализированной user32, и может быть, comctl...<br><br>Это действительно от фазы луны зависит. В любом случае следует как то отложить управление, до возврата из опасного для синхронизаций кода, например использовать механизм сообщений или синхронно это всё делать из другого потока, прежде создать его; хотя если код начинает в первый раз выполняться и в дллмайн, то старт потока нужно есчо как то обождать, так как опять же вновь созданный тред начнёт выполнять загрузчик и ту же дллмайн, ожидание может привести к взаимоблокировке. Тоесть механизм синхронизаций должен быть заранее проработан. Всегда использовались три метода, это посылка APC самому себе и обработка её перед возвратом из загрузчика, изменение в стартап контексте EP и раскрутка стека для поиска в нём адреса возврата. Есть есчо особо не рассмотренная возможность - пока вновь созданный тред не покинет стартап апк, хоть он и будет выполнять какой то код, но для get/set-context ядро будет работать именно со стартап контекстом, вроде так(позволяет скрыть работу потока :s2<img src="img/smilies/s1.gif" alt="">, но я подробно это не рассматривал.<br><br>&gt; Смотря какой авер ещё!<br><br>Смысл был не в кривости авера или как в него залиться, а в динамик детектах, тоесть обычно находится какой то скрытый обьект и только факт его сокрытия говорит об викс активности в системе. Если все обьекты легал, то такой детект не работает. Это не только к обьектам относится, но и к памяти - нет в памяти данных, тогда и найти там сигнатуру невозможно <img src="img/smilies/s1.gif" alt="">
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=369343&amp;user=40990&amp;forum_n=6&amp;topic=24417.html&amp;page=0&amp;anchor=9" class="addthx" data-post="369343"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=24257" title="10-11-2016 10:32, ранг:251.0" target="_blank">DenCoder</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 221thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 ноября 2016 13:42 <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24417.html&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
<I>ZeroMemory пишет:<br>    BOOL written = WriteProcessMemory(process, libname, dllName, lstrlen(dllName), NULL);<br>    if (FALSE == written)<br>        return FALSE;<br> <br>    HANDLE thread = CreateRemoteThread(process, NULL, 0, (LPTHREAD_START_ROUTINE)loadlib, libname, 0, NULL);<br>    if (NULL == thread)<br>        return FALSE; </I><br><br>тут вообще можно просто второй раз вызвать CreateRemoteThread(), старт рутина - любая функция.
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=369344&amp;user=24257&amp;forum_n=6&amp;topic=24417.html&amp;page=0&amp;anchor=10" class="addthx" data-post="369344"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]nicknamesarehistory[/b]','')">nicknamesarehistory</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 1.2 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 3.69'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=41559">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 ноября 2016 22:25 <br><script type="text/javascript">QU('nicknamesarehistory','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=nicknamesarehistory" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24417.html&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
Меня иногда впечатляют русскоязычные форумы. Это же надо сделать из проблемы, которая отвечена годами назад, активный топик.<br>Начинать с гугла или отсюда: https://stackoverflow.com/questions/8377569/howto-call-messagebox-in-dllmain<br><br><b>TL; DR</b><br>DllMain обычно патчит память процесса, создает поток или что угодно в этом духе, что бы закрепится в процессе. Далее по сигналу должен начать реагировать, например, перехватите вызов ShowWindow, который вам нужен, и начинайте работать оттуда, причем это уже скорее будет в потоке основно приложения. <img src="img/smilies/s1.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=369371&amp;user=41559&amp;forum_n=6&amp;topic=24417.html&amp;page=0&amp;anchor=11" class="addthx" data-post="369371"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=41390" title="12-11-2016 00:01, ранг:1.7" target="_blank">neshta</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 338.5 (мудрец), 349thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 ноября 2016 02:56 <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24417.html&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
<b>nicknamesarehistory</b><br><br>В этом и фишка. Янки не хочет знать механизмы, им надо что бы робило, решить практическую задачу. А вот у нас иначе - решение происходит из знания, причём это разворачивается, что бы понять/обьяснить суть. По этой причине понятия уровня знаний у пиндосов на форумах не существует. И впечатляет вас такое, потому что вы янки <img src="img/smilies/s6.gif" alt="">:<br><br>DllMain обычно патчит память процесса&quot;<br><br>Смысл потерян после трансляции языковой.
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=369376&amp;user=40990&amp;forum_n=6&amp;topic=24417.html&amp;page=0&amp;anchor=12" class="addthx" data-post="369376"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Инжект длл в удаленный процесс фейлится</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#13" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="6">
<input type="hidden" name="topic" value="24417">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=24417" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
