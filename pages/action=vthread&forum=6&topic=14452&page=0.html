<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Выгрузка либы - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Есть лист из либы: Code:       Function&nbsp;MsgProc&nbsp;(Code,&nbsp;WParam,&nbsp;LParam&nbsp;:&nbsp;DWord)&nbsp;:&nbsp;DWord; StdCall;Begin&nbsp;&nbsp;CallNextHookEx&nbsp;(SH,&nbsp;Code,&nbsp;WParam,&nbsp;LParam);End;Procedure&n">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=55995'>tyns777</a>, <a target='_blank' href='?action=userinfo&amp;user=31361'>zds</a>, <a target='_blank' href='?action=userinfo&amp;user=55802'>JustLife</a>, <a target='_blank' href='?action=userinfo&amp;user=2094'>2nd</a>, <a target='_blank' href='?action=userinfo&amp;user=33192'>morgot</a> (+5 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Выгрузка либы</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]50Hz_220B_1200W[/b]','')">50Hz_220B_1200W</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 16.9 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.36'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=20096">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 22 мая 2009 05:54 <br><script type="text/javascript">QU('50Hz_220B_1200W','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=50Hz_220B_1200W" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=14452.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Есть лист из либы:<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">Function&nbsp;MsgProc&nbsp;<span class="hl_char">(</span><span class="hl_function">Code</span><span class="hl_char">,</span>&nbsp;WParam<span class="hl_char">,</span>&nbsp;LParam&nbsp;<span class="hl_char">:</span>&nbsp;<span class="hl_function">DWord</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>DWord</b></span><span class="hl_comment">; StdCall;</span></li><li class="hl_l1">Begin</li><li class="hl_l0">&nbsp;&nbsp;CallNextHookEx&nbsp;<span class="hl_char">(</span>SH<span class="hl_char">,</span>&nbsp;<span class="hl_function">Code</span><span class="hl_char">,</span>&nbsp;WParam<span class="hl_char">,</span>&nbsp;LParam<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span class="hl_function"><b>End</b></span><span class="hl_comment">;</span></li><li class="hl_l0"></li><li class="hl_l1">Procedure&nbsp;DllEntryPoint&nbsp;<span class="hl_char">(</span>Reason&nbsp;<span class="hl_char">:</span>&nbsp;<span class="hl_function">DWord</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">Var</li><li class="hl_l1">&nbsp;&nbsp;CaMutex&nbsp;<span class="hl_char">:</span>&nbsp;Cardinal<span class="hl_comment">;</span></li><li class="hl_l0">Begin</li><li class="hl_l1">&nbsp;&nbsp;Case&nbsp;Reason&nbsp;of</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;Dll_Process_Attach&nbsp;<span class="hl_char">:</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;Begin</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CaMutex&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;CreateMutex&nbsp;<span class="hl_char">(</span>Nil<span class="hl_char">,</span>&nbsp;<span class="hl_function">False</span><span class="hl_char">,</span>&nbsp;<span class="hl_quote">'MyZone'</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>If</b></span>&nbsp;CaMutex&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span>&nbsp;Then</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exit<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetWindowsHookEx&nbsp;<span class="hl_char">(</span>WH_GetMessage<span class="hl_char">,</span>&nbsp;@MsgProc<span class="hl_char">,</span>&nbsp;HInstance<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>End</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;Dll_Process_detach&nbsp;<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UnHookWindowsHookEx&nbsp;<span class="hl_char">(</span>SH<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>End</b></span><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_function"><b>End</b></span><span class="hl_comment">;</span></li><li class="hl_l1"></li><li class="hl_l0">begin</li><li class="hl_l1">&nbsp;&nbsp;DllProc&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;@DllEntryPoint<span class="hl_comment">;//</span></li><li class="hl_l0">&nbsp;&nbsp;DllEntryPoint&nbsp;<span class="hl_char">(</span>Dll_Process_Attach<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span class="hl_function">end</span><span class="hl_char">.</span></li>        </ol>
    </div>
</div></div>
<br><br>как правильно выгрузить данную либу?<br><br>Заранее спс
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=232159&amp;user=20096&amp;forum_n=6&amp;topic=14452.html&amp;page=0&amp;anchor=1" class="addthx" data-post="232159"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]Av0id[/b]','')">Av0id</a></b><br></div>
<img src="img/s8.gif" alt=""><br><span class=txtSm>Ранг: 516.1 (<b>!</b>), 39thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.38'>Активность: 0.28<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1378">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 22 мая 2009 06:52 <br><script type="text/javascript">QU('Av0id','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Av0id" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=14452.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
FreeLibrary
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=232162&amp;user=1378&amp;forum_n=6&amp;topic=14452.html&amp;page=0&amp;anchor=2" class="addthx" data-post="232162"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]50Hz_220B_1200W[/b]','')">50Hz_220B_1200W</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 16.9 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.36'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=20096">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 22 мая 2009 07:00 <br><script type="text/javascript">QU('50Hz_220B_1200W','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=50Hz_220B_1200W" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=14452.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
Не катит FreeLibrary, проверил<br><br>Var<br>  LibaHandle : Cardinal;<br>Begin<br>  Libahandle := GetModuleHandle (&#039;MyDll.Dll&#039;);<br>  FreeLibrary (LibaHandle);<br>End;
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=232163&amp;user=20096&amp;forum_n=6&amp;topic=14452.html&amp;page=0&amp;anchor=3" class="addthx" data-post="232163"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]50Hz_220B_1200W[/b]','')">50Hz_220B_1200W</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 16.9 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.36'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=20096">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 22 мая 2009 08:11 <br><script type="text/javascript">QU('50Hz_220B_1200W','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=50Hz_220B_1200W" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=14452.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
Выгружаю либу, только непонятно вот тут:<br><br>  FreeLibrary (Ca);<br>  FreeLibrary (Ca);<br>  FreeLibrary (Ca);<br><br><br><br><img src="img/attach.gif" alt=""> <a href="./files/66d9_22.05.2009_CRACKLAB.rU.tgz">66d9_22.05.2009_CRACKLAB.rU.tgz</a> - Dll.rar
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=232166&amp;user=20096&amp;forum_n=6&amp;topic=14452.html&amp;page=0&amp;anchor=4" class="addthx" data-post="232166"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]zeppe1in[/b]','')">zeppe1in</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/18780.png" alt=""><br><span class=txtSm>Ранг: 127.3 (ветеран), 44thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.68'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=18780">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 22 мая 2009 11:27 &middot; Поправил: zeppe1in <br><script type="text/javascript">QU('zeppe1in','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=zeppe1in" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=14452.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
а может<br>Ca :=  LoadLibrary(&#039;MyDll.Dll&#039;);<br><br>вот у тебя написано<br><br>  Ca := GetModuleHandle (&#039;Din.Dll&#039;);<br>  LoadLibrary (&#039;Din.Dll&#039;);<br><br>а GetModuleHandle возвращает хендл загруженного модуля, тоесть в твоём случае возвращаеца 0.
<br><br><font size="1"><i>-----<br>zzz</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=232173&amp;user=18780&amp;forum_n=6&amp;topic=14452.html&amp;page=0&amp;anchor=5" class="addthx" data-post="232173"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]ARCHANGEL[/b]','')">ARCHANGEL</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/6336.png" alt=""><br><span class=txtSm>Ранг: 681.5 <font color=magenta>(<b>! !</b>)</font>, 405thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.85'>Активность: 0.42<span style='color:red'>&searr;</span>0.21</span><br>Статус: <a href="action=userinfo&amp;user=6336">Участник</a><br><font color=blue>ALIEN Hack Team</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 22 мая 2009 20:40 <br><script type="text/javascript">QU('ARCHANGEL','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ARCHANGEL" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=14452.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
FreeLibrary прекрасно подходит, но, как говорил Рихтер, тут есть одно но - т.к. количество потоков в приложении, в которое данная либа была внедрена, не всегда (далеко не всегда) равно нулю, это приводит к тому, что для выгрузки из адресного пространства такого процесса данной библиотеки код, её выгружающий, должен выполниться столько раз, сколько потоков имеет процесс. Т.е. проверяем через GetModuleHandle, присутствует ли либа, если возвращается валидный хэндл, то выполняем FreeLibrary, и так столько раз, сколько будет нужно. Так проще, т.к. не нужно вычислять, сколько на данный момент потоков у процесса.
<br><br><font size="1"><i>-----<br>Stuck to the plan, always think that we would stand up, never ran.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=232223&amp;user=6336&amp;forum_n=6&amp;topic=14452.html&amp;page=0&amp;anchor=6" class="addthx" data-post="232223"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]Clerk[/b]','')">Clerk</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 255.8 (наставник), 19thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.86'>Активность: 0.15<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=17964">Участник</a><br><font color=blue>vx</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 мая 2009 00:05 <br><script type="text/javascript">QU('Clerk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Clerk" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=14452.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
<b>ARCHANGEL</b><br>Потоки непричём. Существует счётчик загрузок(LDR_DATA_TABLE_ENTRY.LoadCount). Это значение увеличивается каждый раз при вызове функций загружающих модуль и уменьшается при попытках выгрузить соответственно. Если значение станет равным нулю модуль быдет выгружен. Тоесть туда нужно единицу запихать а потом уже выгружать(для статически прилинкованных не прокатит).
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=232240&amp;user=17964&amp;forum_n=6&amp;topic=14452.html&amp;page=0&amp;anchor=7" class="addthx" data-post="232240"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]SLV[/b]','')">SLV</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 309.8 (мудрец), 21thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.69'>Активность: 0.17<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=663">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 мая 2009 00:11 <br><script type="text/javascript">QU('SLV','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=SLV" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=14452.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
плюс к выше сказанному, увеличение идёт функцией LdrAddRefDll.
<br><br><font size="1"><i>-----<br>Shalom ebanats!</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=232242&amp;user=663&amp;forum_n=6&amp;topic=14452.html&amp;page=0&amp;anchor=8" class="addthx" data-post="232242"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]50Hz_220B_1200W[/b]','')">50Hz_220B_1200W</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 16.9 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.36'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=20096">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 мая 2009 03:52 <br><script type="text/javascript">QU('50Hz_220B_1200W','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=50Hz_220B_1200W" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=14452.html&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
Как подсчитать, скока раз надо вызвать FreeLibrary?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=232251&amp;user=20096&amp;forum_n=6&amp;topic=14452.html&amp;page=0&amp;anchor=9" class="addthx" data-post="232251"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]Av0id[/b]','')">Av0id</a></b><br></div>
<img src="img/s8.gif" alt=""><br><span class=txtSm>Ранг: 516.1 (<b>!</b>), 39thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.38'>Активность: 0.28<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1378">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 мая 2009 09:03 <br><script type="text/javascript">QU('Av0id','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Av0id" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=14452.html&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
50Hz_220B_1200W, может msdn поставишь и избавишь себя и людей от этих вопросов?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=232259&amp;user=1378&amp;forum_n=6&amp;topic=14452.html&amp;page=0&amp;anchor=10" class="addthx" data-post="232259"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]50Hz_220B_1200W[/b]','')">50Hz_220B_1200W</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 16.9 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.36'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=20096">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 мая 2009 09:08 &middot; Поправил: 50Hz_220B_1200W <br><script type="text/javascript">QU('50Hz_220B_1200W','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=50Hz_220B_1200W" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=14452.html&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
качаю сейчас русс. MSDN, потом не буду этих задавать вопросов<br>______________________________________________________<br><I>Лучше плохой учитель, чем хорошая книга</I>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=232260&amp;user=20096&amp;forum_n=6&amp;topic=14452.html&amp;page=0&amp;anchor=11" class="addthx" data-post="232260"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]only[/b]','')">only</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 0.4 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.22'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=20804">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 мая 2009 12:04 &middot; Поправил: only <br><script type="text/javascript">QU('only','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=only" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=14452.html&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
<I>50Hz_220B_1200W пишет:<br>Как подсчитать, скока раз надо вызвать FreeLibrary?  </I><br> - через список структур загрузчика как выше написал клерк<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">TEB<span class="hl_char">(</span><span class="hl_registr">fs</span><span class="hl_char">:</span><span class="hl_char">[</span>0x18<span class="hl_char">]</span><span class="hl_char">)</span><span class="hl_char">:</span><span class="hl_char">:</span>PEB<span class="hl_char">:</span><span class="hl_char">:</span>PEB_LDR_DATA<span class="hl_char">:</span><span class="hl_char">:</span>LDR_DATA_TABLE_ENTRY<span class="hl_char">.</span>LoadCount</li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=232271&amp;user=20804&amp;forum_n=6&amp;topic=14452.html&amp;page=0&amp;anchor=12" class="addthx" data-post="232271"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]ARCHANGEL[/b]','')">ARCHANGEL</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/6336.png" alt=""><br><span class=txtSm>Ранг: 681.5 <font color=magenta>(<b>! !</b>)</font>, 405thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.85'>Активность: 0.42<span style='color:red'>&searr;</span>0.21</span><br>Статус: <a href="action=userinfo&amp;user=6336">Участник</a><br><font color=blue>ALIEN Hack Team</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 мая 2009 12:39 <br><script type="text/javascript">QU('ARCHANGEL','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ARCHANGEL" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=14452.html&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
Внимательно прочитав Рихтера, нашёл:<br><br><i class=x><br>На самом деле LoadLibrary и LoadLibraryEx лишь увеличивают счетчик числа поль-<br>зователей указанной библиотеки, a FreeLibrary и FreeLibraryAndExitThread его умень-<br>шают. Так, при первом вызове LoadLibrary для загрузки DLL система проецирует об-<br>раз DLL-файла на адресное пространство вызывающего процесса и присваивает еди-<br>ницу счетчику числа пользователей этой DLL. Если поток того же процессу вызывает<br>LoadLibrary для той же DLL еще раз, DLL больше не проецируется; система просто<br>увеличивает счетчик числа ее пользователей — вот и все.<br>Чтобы выгрузить DLL из адресного пространства процесса, FreeLibrary придется<br>теперь вызывать дважды: первый вызов уменьшит счетчик до 1, второй — до О. Обна-<br>ружив, что счетчик числа пользователей DLL обнулен, система отключит ее. После<br>этого попытка вызова какой-либо функции из данной DLL приведет к нарушению<br>доступа, так как код по указанному адресу уже не отображается на адресное простран-<br>ство процесса.<br>Система поддерживает в каждом процессе свой счетчик DLL, т. е. если поток<br>процесса А вызывает приведенную ниже функцию, а затем тот же вызов делает поток<br>в процессе В, то MyLib.dll проецируется на адресное пространство обоих процессов,<br>а счетчики числа пользователей DLL в каждом из них приравниваются 1.<br>HINSTANCE hinstDll = LoadLibrary(&quot;MyLib.dllT1);<br>Если же поток процесса В вызовет далее:<br>FreeLibrary(hinstDll);<br>счетчик числа пользователей DLL в процессе В обнулится, что приведет к отключе-<br>нию DLL от адресного пространства процесса В. Но проекция DLL на адресное про-<br>странство процесса А не затрагивается, и счетчик числа пользователей DLL в нем<br>остается прежним.<br>Чтобы определить, спроецирована ли DLL на адресное пространство процесса,<br>поток может вызвать функцию GetModuleHandte;<br>HINSTANCE GetModuleHandle(PCTSTR pszModuleName); •<br>Например, следующий код загружает MyLib.dll, только если она еще не спроеци-<br>рована на адресное пространство процесса:<br>HINSTANCE hinstDll = Get Mod uleH arid le( &quot;MyLib&quot;); // подразумевается расширение .dll<br>if (hinstDll == NULL) {<br>hinstDll = LoadLibraryC&#039;MyLib&quot;); // подразумевается расширение .dll<br></i><br>Так что не стоит использовать какие-то не очень документированные структуры, когда документированные просты и понятны.
<br><br><font size="1"><i>-----<br>Stuck to the plan, always think that we would stand up, never ran.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=232494&amp;user=6336&amp;forum_n=6&amp;topic=14452.html&amp;page=0&amp;anchor=13" class="addthx" data-post="232494"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]only[/b]','')">only</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 0.4 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.22'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=20804">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 мая 2009 13:34 <br><script type="text/javascript">QU('only','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=only" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=14452.html&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
по-моему проще анмепнуть секцию модуля (<b>NtUnmapViewOfSection</b>) и пофигу все эти ссылки
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=232497&amp;user=20804&amp;forum_n=6&amp;topic=14452.html&amp;page=0&amp;anchor=14" class="addthx" data-post="232497"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]ARCHANGEL[/b]','')">ARCHANGEL</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/6336.png" alt=""><br><span class=txtSm>Ранг: 681.5 <font color=magenta>(<b>! !</b>)</font>, 405thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.85'>Активность: 0.42<span style='color:red'>&searr;</span>0.21</span><br>Статус: <a href="action=userinfo&amp;user=6336">Участник</a><br><font color=blue>ALIEN Hack Team</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 мая 2009 12:14 <br><script type="text/javascript">QU('ARCHANGEL','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ARCHANGEL" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=14452.html&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
<b>only</b><br>Если я правильно понял, то тогда не выполнится код, который должен выполняться по Dll_Process_detach. А это - не есть гуд.
<br><br><font size="1"><i>-----<br>Stuck to the plan, always think that we would stand up, never ran.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=232544&amp;user=6336&amp;forum_n=6&amp;topic=14452.html&amp;page=0&amp;anchor=15" class="addthx" data-post="232544"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]only[/b]','')">only</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 0.4 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.22'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=20804">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 мая 2009 13:36 <br><script type="text/javascript">QU('only','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=only" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=14452.html&amp;page=0#16');return false;">#16</a> </span><div align=left><br>
<b>ARCHANGEL</b><br>ну да.<br>хуки и подобный мусор конечно снять нужно, перед анмэпом.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=232548&amp;user=20804&amp;forum_n=6&amp;topic=14452.html&amp;page=0&amp;anchor=16" class="addthx" data-post="232548"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]Clerk[/b]','')">Clerk</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 255.8 (наставник), 19thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.86'>Активность: 0.15<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=17964">Участник</a><br><font color=blue>vx</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 мая 2009 15:28 &middot; Поправил: Clerk <br><script type="text/javascript">QU('Clerk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Clerk" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=14452.html&amp;page=0#17');return false;">#17</a> </span><div align=left><br>
&gt; Система поддерживает в каждом процессе свой счетчик DLL, т. е. если поток <br>процесса А вызывает приведенную ниже функцию, а затем тот же вызов делает поток <br>в процессе В, то MyLib.dll проецируется на адресное пространство обоих процессов, <br>а счетчики числа пользователей DLL в каждом из них приравниваются 1. <br><br>Полнейший бред, написанный кемто не понимающим что есть поток и процесс. Адресное простнаство не зря называется виртуальным, изолированность это главное требование безопасности.<br>&gt; NtUnmapViewOfSection<br>Проекция модуля перестанет существовать в памяти, ссылки на неё останутся, все будут думать что модуль есть, код не выполнит необходимые действия например при выгрузке. В конце концов приведёт к эксцепшину и краху в простейшем случае лоадера.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=232556&amp;user=17964&amp;forum_n=6&amp;topic=14452.html&amp;page=0&amp;anchor=17" class="addthx" data-post="232556"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]Smon[/b]','')">Smon</a></b><br></div>
<img src="img/s8.gif" alt=""><br><span class=txtSm>Ранг: 500.5 (<b>!</b>), 8thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.33'>Активность: 0.23<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1449">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 мая 2009 15:54 &middot; Поправил: Smon <br><script type="text/javascript">QU('Smon','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Smon" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=14452.html&amp;page=0#18');return false;">#18</a> </span><div align=left><br>
<I>ARCHANGEL пишет:<br>На самом деле LoadLibrary и LoadLibraryEx лишь увеличивают счетчик числа поль- <br>зователей указанной библиотеки, a FreeLibrary и FreeLibraryAndExitThread его умень- <br>шают. Так, при первом вызове LoadLibrary для загрузки DLL система проецирует об- <br>раз DLL-файла на адресное пространство вызывающего процесса и присваивает еди- <br>ницу счетчику числа пользователей этой DLL. Если поток того же процессу вызывает <br>LoadLibrary для той же DLL еще раз, DLL больше не проецируется; система просто <br>увеличивает счетчик числа ее пользователей — вот и все. <br>Чтобы выгрузить DLL из адресного пространства процесса, FreeLibrary придется <br>теперь вызывать дважды: первый вызов уменьшит счетчик до 1, второй — до О. Обна- <br>ружив, что счетчик числа пользователей DLL обнулен, система отключит ее. После <br>этого попытка вызова какой-либо функции из данной DLL приведет к нарушению <br>доступа, так как код по указанному адресу уже не отображается на адресное простран- <br>ство процесса.  </I><br>Истена, файло отдельно проецируется на адресное пространство каждого процесса, иначе завалились бы при первом же сплайсе, счётчики количества LoadLibrary/FreeLibrary реально есть - только что проверил ради интереса, для каждого процесса свой счётчик, считал ранее что для получения адреса загруженной библиотеки не обязательно юзать GetModuleHandleA, можно обойтись и LoadLibrary, а там вон какая фишка <img src="img/smilies/s3.gif" alt="">
<br><br><font size="1"><i>-----<br>&quotПусть видят, что мы не шутим. Стволы для понта, ножи для дела&quot Lock, Stock &amp Two Smoking Barrels</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=232559&amp;user=1449&amp;forum_n=6&amp;topic=14452.html&amp;page=0&amp;anchor=18" class="addthx" data-post="232559"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]only[/b]','')">only</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 0.4 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.22'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=20804">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 мая 2009 16:21 <br><script type="text/javascript">QU('only','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=only" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=14452.html&amp;page=0#19');return false;">#19</a> </span><div align=left><br>
<b>Clerk</b><br><I>Проекция модуля перестанет существовать в памяти, ссылки на неё останутся, все будут думать что модуль есть, код не выполнит необходимые действия например при выгрузке. В конце концов приведёт к эксцепшину и краху в простейшем случае лоадера.</I><br>скорее всего это верно только для модуля который статически прилинкован.<br>если иначе, то какие такие необычные ссылки могут быть на модуль(с учетом например того, что все хуки в коде и данных, возможно установленные и данным модулем, сняты, и ссылка на модуль удалена из области памяти лоадера)?<br>может конечно имеются ввиду потоки которые быть созданы кодом из модуля и могли исполнять код модуля в момент удаления его проекции<br>тогда можно ловить все без разбора исключения для данного процесса и удалять потоки в контексте которых eip указывает на область памяти модуля<br>хотя и свои потоки могли оказаться в таком же положении (тоже ведь можно придумать что-то - они все-таки &quot;свои&quot;)
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=232563&amp;user=20804&amp;forum_n=6&amp;topic=14452.html&amp;page=0&amp;anchor=19" class="addthx" data-post="232563"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="20" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 мая 2009 17:26 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#20" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=14452.html&amp;page=0#20');return false;">#20</a> </span><div align=left><br>
Этот текст написан для винды 9х, где либы были 1 на все процессы. Изменение либы в 1 месте, меняло её везде. Поэтому текст не совсем бред, просто старый и уже неактуален.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=232568&amp;user=1556&amp;forum_n=6&amp;topic=14452.html&amp;page=0&amp;anchor=20" class="addthx" data-post="232568"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="21" onfocus="this.blur()" href="JavaScript:di('[b]Clerk[/b]','')">Clerk</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 255.8 (наставник), 19thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.86'>Активность: 0.15<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=17964">Участник</a><br><font color=blue>vx</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 мая 2009 19:49 &middot; Поправил: Clerk <br><script type="text/javascript">QU('Clerk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Clerk" target="_blank">Личное сообщение</a> &middot;  <a href="#21" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=14452.html&amp;page=0#21');return false;">#21</a> </span><div align=left><br>
<b>only</b><br>&gt; какие такие необычные ссылки могут быть на модуль<br>Запись в лдр. Любая функция из Ldr* юзает проверку валидности хидера к примеру, RtlImageNtHeader(), хотя и заключена в сех чтоб не упала, но это общее состояние загрузчика нарушит. Как же импорт/экспорт - другие модуля будут обращаться в никуда, а внутренние хэши, нотификаторы и пр.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=232576&amp;user=17964&amp;forum_n=6&amp;topic=14452.html&amp;page=0&amp;anchor=21" class="addthx" data-post="232576"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Выгрузка либы</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#22" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="6">
<input type="hidden" name="topic" value="14452">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=14452" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
