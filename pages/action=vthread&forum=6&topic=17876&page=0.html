<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>lpParameter для Thread - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Подскажите пожалуйста, есть ли какой нибудь метод указать lpParameter для уже созданного удаленного потока (CreateRemoteThread)? Обычно мы его указывает когда создаем поток, а есть ли какой нибудь способ указать его когда поток">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=55995'>tyns777</a> (+5 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> lpParameter для Thread</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]Enigma[/b]','')">Enigma</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 88.3 (постоянный), 3thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.58'>Активность: 0.04<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=8396">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 марта 2011 11:24 <br><script type="text/javascript">QU('Enigma','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Enigma" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17876.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Подскажите пожалуйста, есть ли какой нибудь метод указать lpParameter для уже созданного удаленного потока (CreateRemoteThread)?<br><br>Обычно мы его указывает когда создаем поток, а есть ли какой нибудь способ указать его когда поток уже создан, но еще не выполнен (создан SUSPENDED)? Кроме махинаций с GetThreadContext, получением rEsp и записыванием параметра напрямую в стек...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=278868&amp;user=8396&amp;forum_n=6&amp;topic=17876.html&amp;page=0&amp;anchor=1" class="addthx" data-post="278868"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]mak[/b]','')">mak</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3520.jpg" alt=""><br><span class=txtSm>Ранг: 673.3 <font color=magenta>(<b>! !</b>)</font>, 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.48'>Активность: 0.4<span style='color:red'>&searr;</span>0.31</span><br>Статус: <a href="action=userinfo&amp;user=3520">Участник</a><br><font color=blue>CyberMonk</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 марта 2011 12:51 <br><script type="text/javascript">QU('mak','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=mak" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17876.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
Какова цель? Если требуется множественные параметры , то можно сделать предварительно коллгэйт и передать все сразу, а потом уже запускать CreateRemoteThread с указателем на шеллкод ...
<br><br><font size="1"><i>-----<br>RE In Progress [!] Coding Hazard [!] Stay Clear of this Cube</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=278876&amp;user=3520&amp;forum_n=6&amp;topic=17876.html&amp;page=0&amp;anchor=2" class="addthx" data-post="278876"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]Enigma[/b]','')">Enigma</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 88.3 (постоянный), 3thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.58'>Активность: 0.04<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=8396">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 марта 2011 13:13 <br><script type="text/javascript">QU('Enigma','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Enigma" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17876.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
<I>mak пишет:<br>Какова цель? </I><br><br>Цель - простая, передать параметры другому процессу, во время инжекта... Только сделать это красиво, и без лишнего кода.. Ты прав, создать еще один CreateRemoteThread и передать параметры из него - это выход, но хотелось бы все сделать без дополнительного потока.<br><br>Кстати, вот тут что нарыл. Когда поток создан с помощью CreateRemoteThread, по умолчанию, Eip у этого потока стоит на RtlUserThreadStart, которая (на вин 7 по крайней мере, для x32 процесса) принимает два параметра, но принимает их не через stdcall/стек, а через регистры EAX и EBX. <br>EAX - код с которого надо начать выполнение потока (твой код)<br>EBX - как раз тот параметр, который передается твоему коду.<br><br>Получается то что я спрашивал, можно сделать, установив необходимые значение регистров EAX и EBX контекста этого потока...<br>Но проблема в том что на XP функции RtlUserThreadStart нет.. надо будет разбираться...<br><br><br><br><br>Еще одна проблема... после создания процесса по ZwCreateUserProcess, до отпускания его основного потока по ZwResumeThread никак нельзя узнать все модули загруженные в этот процесс, CreateToolHelp32SnapShot возвращает ошибку PARTIAL_COPY... нет какого нибудь решения узнать список модулей...? Или хотя бы ImageBase от ntdll.dll?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=278879&amp;user=8396&amp;forum_n=6&amp;topic=17876.html&amp;page=0&amp;anchor=3" class="addthx" data-post="278879"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 марта 2011 13:21 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17876.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
Хытрые манипуляции с контекстом суспенженого потока могут не быть совместимыми с разными защитами, типа аверов/фаеров, не рекомендуется так делать.<br>ntdll не релоцируется, бери локальную базу.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=278881&amp;user=1556&amp;forum_n=6&amp;topic=17876.html&amp;page=0&amp;anchor=4" class="addthx" data-post="278881"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]mak[/b]','')">mak</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3520.jpg" alt=""><br><span class=txtSm>Ранг: 673.3 <font color=magenta>(<b>! !</b>)</font>, 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.48'>Активность: 0.4<span style='color:red'>&searr;</span>0.31</span><br>Статус: <a href="action=userinfo&amp;user=3520">Участник</a><br><font color=blue>CyberMonk</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 марта 2011 13:39 <br><script type="text/javascript">QU('mak','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=mak" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17876.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
<img src="img/smilies/s1.gif" alt=""> Может поможет приложение внизу по мульти параметрам. <br><br><I>Enigma пишет:<br>Еще одна проблема... после создания процесса по ZwCreateUserProcess, до отпускания его основного потока по ZwResumeThread никак нельзя узнать все модули загруженные в этот процесс, CreateToolHelp32SnapShot возвращает ошибку PARTIAL_COPY... нет какого нибудь решения узнать список модулей...? Или хотя бы ImageBase от ntdll.dll?  </I><br><br>На какой винде тест? 64 или 32? Пеб Лодер лист может?<br><br><br><img src="img/attach.gif" alt=""> <a href="./files/4a07_11.03.2011_CRACKLAB.rU.tgz">4a07_11.03.2011_CRACKLAB.rU.tgz</a> - createremotethreadex.zip
<br><br><font size="1"><i>-----<br>RE In Progress [!] Coding Hazard [!] Stay Clear of this Cube</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=278883&amp;user=3520&amp;forum_n=6&amp;topic=17876.html&amp;page=0&amp;anchor=5" class="addthx" data-post="278883"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 марта 2011 13:45 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17876.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
Список модулей в пеб не поможет, до инициализации первого потока он не заполнен.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=278884&amp;user=1556&amp;forum_n=6&amp;topic=17876.html&amp;page=0&amp;anchor=6" class="addthx" data-post="278884"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]Enigma[/b]','')">Enigma</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 88.3 (постоянный), 3thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.58'>Активность: 0.04<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=8396">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 марта 2011 13:54 <br><script type="text/javascript">QU('Enigma','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Enigma" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17876.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
<I>Archer пишет:<br>Хытрые манипуляции с контекстом суспенженого потока могут не быть совместимыми с разными защитами, типа аверов/фаеров, не рекомендуется так делать. </I><br><br>Так а че же делать... если не манипулировать контекстом, то придется создавать свой удаленный поток. А для фаеров мне кажется пофиг, что ты контекстом манипулируешь, что удаленный поток создаешь, все равно как бы опасность и то и другое..<br><br>Как же тогда вообще в процесс инжектится, чтобы аверов не рассердить?<br><br><I>Archer пишет:<br>ntdll не релоцируется, бери локальную базу </I><br><br>Вообще в ntdll.dll есть релоки, Relocations are stripped не установлено, так что фактически, она может быть загружена куда угодно...<br><br><I>mak пишет:<br> Может поможет приложение внизу по мульти параметрам. </I><br><br>Это как бы не особо универсально <img src="img/smilies/s1.gif" alt=""><br><br><I>mak пишет:<br>На какой винде тест? 64 или 32?  </I><br><br>x64<br><br><I>mak пишет:<br>Пеб Лодер лист может? </I><br><br>Точно, вот это в точку, спасибо!
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=278887&amp;user=8396&amp;forum_n=6&amp;topic=17876.html&amp;page=0&amp;anchor=7" class="addthx" data-post="278887"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]mak[/b]','')">mak</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3520.jpg" alt=""><br><span class=txtSm>Ранг: 673.3 <font color=magenta>(<b>! !</b>)</font>, 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.48'>Активность: 0.4<span style='color:red'>&searr;</span>0.31</span><br>Статус: <a href="action=userinfo&amp;user=3520">Участник</a><br><font color=blue>CyberMonk</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 марта 2011 14:06 &middot; Поправил: mak <br><script type="text/javascript">QU('mak','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=mak" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17876.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
Перечисление страниц памяти тогда ? И гетмодулфайлнэйм ?<br><br><I>Enigma пишет:<br>mak пишет:<br>На какой винде тест? 64 или 32?<br><br>x64 </I><br><br>ууу , тогда так и чувствовал , там есть замут какой то с CreateToolHelp32SnapShot и партиал копи , это описано в МСДНе , нужно полистать .. хз тогда
<br><br><font size="1"><i>-----<br>RE In Progress [!] Coding Hazard [!] Stay Clear of this Cube</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=278889&amp;user=3520&amp;forum_n=6&amp;topic=17876.html&amp;page=0&amp;anchor=8" class="addthx" data-post="278889"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]Enigma[/b]','')">Enigma</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 88.3 (постоянный), 3thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.58'>Активность: 0.04<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=8396">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 марта 2011 14:13 <br><script type="text/javascript">QU('Enigma','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Enigma" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17876.html&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
<I>mak пишет:<br>Перечисление страниц памяти тогда ? И гетмодулфайлнэйм ? </I><br><br>Да, получается что без перечисления никуда... про CreateToolHelp32SnapShot и x64 тоже читал, но думал это происходит только когда вызываешь CreateToolHelp32SnapShot из x86 процесса для x64.<br><br>Хотя заметил одну итересную штуку, если после ZwCreateUserProcess приаттачится к новому процессу со второй олькой (первая даже процесса на этой стадии не видит), Alt + M - показывает все модули. Там наверное как раз и идет перечисление страниц.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=278890&amp;user=8396&amp;forum_n=6&amp;topic=17876.html&amp;page=0&amp;anchor=9" class="addthx" data-post="278890"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 марта 2011 14:15 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17876.html&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
Дело не в том, что фаерам/аверам не понравится твой код, это само собой. А в том, что некоторые сами так делают, и твой код тупо не будет работать, если игрища с контекстом будут.<br>Ты плохо слушаешь, нтдлл НЕ релоцируется. И не в релоках дело, а в концепте ос, туда коллбеки из ядра приходят.<br>З.Ы. гетмодулфайлнэйм, который тут посоветовали, тоже ходит по пебу, тогда уж GetMappedFileName
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=278891&amp;user=1556&amp;forum_n=6&amp;topic=17876.html&amp;page=0&amp;anchor=10" class="addthx" data-post="278891"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=8396" title="12-03-2011 16:24, ранг:75.1" target="_blank">Enigma</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]PE_Kill[/b]','')">PE_Kill</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3232.gif" alt=""><br><span class=txtSm>Ранг: 793.4 <font color=magenta>(<b>! !</b>)</font>, 568thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.59'>Активность: 0.74<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3232">Участник</a><br><font color=blue>Шаман</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 марта 2011 14:22 <br><script type="text/javascript">QU('PE_Kill','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=PE_Kill" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17876.html&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
<b>Enigma</b> вот я сорс выкладывал с поиском модуля через перечисление страниц<br><br>https://ssl.cracklab.ru/f/action=vthread&amp;forum=6&amp;topic=17825&amp;page=0#30<br><br>как бы для основы.
<br><br><font size="1"><i>-----<br>Yann Tiersen best and do not fuck</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=278892&amp;user=3232&amp;forum_n=6&amp;topic=17876.html&amp;page=0&amp;anchor=11" class="addthx" data-post="278892"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]ARCHANGEL[/b]','')">ARCHANGEL</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/6336.png" alt=""><br><span class=txtSm>Ранг: 681.5 <font color=magenta>(<b>! !</b>)</font>, 405thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.85'>Активность: 0.42<span style='color:red'>&searr;</span>0.21</span><br>Статус: <a href="action=userinfo&amp;user=6336">Участник</a><br><font color=blue>ALIEN Hack Team</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 марта 2011 15:49 <br><script type="text/javascript">QU('ARCHANGEL','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ARCHANGEL" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17876.html&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
<b>Enigma</b><br>При создании потока адрес, с которого каждый поток начинает выполнение, заносится в структуру ETHREAD, точные смещения для конкретной версии ОС можно из отладочных символов узнать, так вот подменив его, можно не выполнять игры с контекстом и (в теории) добиться желаемого. Но сам я этого не проверял. Эти поля описаны у Руссиновича, под рукой щас инфы нет, если есть интерес, то позже могу глянуть.
<br><br><font size="1"><i>-----<br>Stuck to the plan, always think that we would stand up, never ran.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=278902&amp;user=6336&amp;forum_n=6&amp;topic=17876.html&amp;page=0&amp;anchor=12" class="addthx" data-post="278902"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]Alchemistry[/b]','')">Alchemistry</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 145.8 (ветеран), 191thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.05'>Активность: 0.14<span style='color:green'>&nearr;</span>0.36</span><br>Статус: <a href="action=userinfo&amp;user=21411">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 марта 2011 17:11 <br><script type="text/javascript">QU('Alchemistry','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Alchemistry" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17876.html&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
Это информационные поля, которые можно получить либо изменить через <b>NtSetInformationThread</b>. На выполнение они дальше после <b>KeInitThread</b> влияния не оказывают.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=278907&amp;user=21411&amp;forum_n=6&amp;topic=17876.html&amp;page=0&amp;anchor=13" class="addthx" data-post="278907"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=6336" title="12-03-2011 07:12, ранг:289.5" target="_blank">ARCHANGEL</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]Enigma[/b]','')">Enigma</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 88.3 (постоянный), 3thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.58'>Активность: 0.04<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=8396">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 марта 2011 19:12 <br><script type="text/javascript">QU('Enigma','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Enigma" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17876.html&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
<I>Alchemistry пишет:<br>Это информационные поля, которые можно получить либо изменить через NtSetInformationThread. На выполнение они дальше после KeInitThread влияния не оказывают. </I><br><br>А какой именно класс для NtSetInformationThread? Я пролазил, но вроде ничего такого не нашел...?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=278977&amp;user=8396&amp;forum_n=6&amp;topic=17876.html&amp;page=0&amp;anchor=14" class="addthx" data-post="278977"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]Alchemistry[/b]','')">Alchemistry</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 145.8 (ветеран), 191thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.05'>Активность: 0.14<span style='color:green'>&nearr;</span>0.36</span><br>Статус: <a href="action=userinfo&amp;user=21411">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 марта 2011 19:18 &middot; Поправил: Alchemistry <br><script type="text/javascript">QU('Alchemistry','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Alchemistry" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17876.html&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
ThreadQuerySetWin32StartAddress<br><br>соотв. <b>NtQueryInformationThread</b> для получения и <br><b>NtSetInformationThread</b> для установки<br><br>Поле ETHREAD-&gt;Win32StartAddress, см в отладчике.<br>Опять же ничего кроме информации из этого вытянуть врядли выйдет.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=278978&amp;user=21411&amp;forum_n=6&amp;topic=17876.html&amp;page=0&amp;anchor=15" class="addthx" data-post="278978"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=8396" title="12-03-2011 16:24, ранг:75.1" target="_blank">Enigma</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]Enigma[/b]','')">Enigma</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 88.3 (постоянный), 3thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.58'>Активность: 0.04<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=8396">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 марта 2011 19:23 <br><script type="text/javascript">QU('Enigma','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Enigma" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17876.html&amp;page=0#16');return false;">#16</a> </span><div align=left><br>
<I>Alchemistry пишет:<br>ThreadQuerySetWin32StartAddressсоотв. NtQueryInformationThread для получения и NtSetInformationThread для установки </I><br><br>Но это все равно малость не то. Тут мы можем поменять адрес с которого поток начнется (хотя мне и это тоже надо, спасибо), а мне бы хотелось поменять еще и парамерт, который передается функции обработки потока...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=278979&amp;user=8396&amp;forum_n=6&amp;topic=17876.html&amp;page=0&amp;anchor=16" class="addthx" data-post="278979"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]mak[/b]','')">mak</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3520.jpg" alt=""><br><span class=txtSm>Ранг: 673.3 <font color=magenta>(<b>! !</b>)</font>, 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.48'>Активность: 0.4<span style='color:red'>&searr;</span>0.31</span><br>Статус: <a href="action=userinfo&amp;user=3520">Участник</a><br><font color=blue>CyberMonk</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 13 марта 2011 03:58 <br><script type="text/javascript">QU('mak','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=mak" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17876.html&amp;page=0#17');return false;">#17</a> </span><div align=left><br>
<b>Enigma</b> По поводу lpParameter , а что если использовать указатель на структуру с параметрами?! <br>Мутили еще с передачей параметров над RtlRemoteCall , там тоже есть ограничение на параметры вроде , но эту функцию рипали и переделывали ...
<br><br><font size="1"><i>-----<br>RE In Progress [!] Coding Hazard [!] Stay Clear of this Cube</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=278998&amp;user=3520&amp;forum_n=6&amp;topic=17876.html&amp;page=0&amp;anchor=17" class="addthx" data-post="278998"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]Alchemistry[/b]','')">Alchemistry</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 145.8 (ветеран), 191thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.05'>Активность: 0.14<span style='color:green'>&nearr;</span>0.36</span><br>Статус: <a href="action=userinfo&amp;user=21411">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 13 марта 2011 09:38 &middot; Поправил: Alchemistry <br><script type="text/javascript">QU('Alchemistry','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Alchemistry" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17876.html&amp;page=0#18');return false;">#18</a> </span><div align=left><br>
Все что делает ваша <b>RtlRemoteCall</b> это последовательность <b>NtSuspendThread</b>-&gt;<b>NtGetThreadContext</b>-&gt;<b>NtWriteVirtualMemory</b>-&gt;<b>NtSetThreadContext</b>-&gt;<b>NtResumeThread</b>.<br><br>Предварительно поток и процесс еще надо открыть с правами на суспенд и запись в память.<br>Сосредоточьтесь <img src="img/smilies/s1.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=279003&amp;user=21411&amp;forum_n=6&amp;topic=17876.html&amp;page=0&amp;anchor=18" class="addthx" data-post="279003"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]Enigma[/b]','')">Enigma</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 88.3 (постоянный), 3thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.58'>Активность: 0.04<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=8396">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 апреля 2011 14:12 <br><script type="text/javascript">QU('Enigma','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Enigma" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17876.html&amp;page=0#19');return false;">#19</a> </span><div align=left><br>
Хотелось бы подвести точку в этой теме, может кому пригодится...<br><br>Поменять парамерт для потока (удаленного), после того как он создан, одной простой функцией нельзя. Да и адрес с которого начнется выполнение в удаленного потоке просто так поменять тоже нельзя.<br><br>Единственное как можно все это сделать, перехватить ZwResumeThread для этого потока и поменять регистры контекста Eax и Ebx.<br>Eax - должен содержать адрес обработчика потока<br>Ebx - как раз тот парамерт для потока<br><br>Но тут тоже не все гладко.. в Виндовз 2000, парамерт Ebx игнорируется, и его (парамерт для потока) установить нельзя...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=280808&amp;user=8396&amp;forum_n=6&amp;topic=17876.html&amp;page=0&amp;anchor=19" class="addthx" data-post="280808"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="20" onfocus="this.blur()" href="JavaScript:di('[b]Enigma[/b]','')">Enigma</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 88.3 (постоянный), 3thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.58'>Активность: 0.04<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=8396">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 апреля 2011 14:18 <br><script type="text/javascript">QU('Enigma','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Enigma" target="_blank">Личное сообщение</a> &middot;  <a href="#20" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17876.html&amp;page=0#20');return false;">#20</a> </span><div align=left><br>
Может кто еще подскажет, надо выполнить инжект exe файла в другой процесс, при это образ <br>оригинального файла надо удалить... Процесс выглядит так:<br><br>1. создаем процесс ZwCreateUserProcess(&#039;process.exe&#039;);<br>2. удаляем образ process.exe в процессе через ZwUnmapViewOfSection<br>3. делаем инжект своего inject.exe<br>4. корректируем PEB.ImageBase в удаленном процессе<br>5. перехватом ZwResumeThread корректируем начало исполнения кода на свой inject.exe<br><br>но вот потом, при вызове ZwResumeThread этот процесс падает с ошибкой... Если не делать #2 то все нормально, наш процесс запускается нормально.. В чем тут может быть дело...?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=280811&amp;user=8396&amp;forum_n=6&amp;topic=17876.html&amp;page=0&amp;anchor=20" class="addthx" data-post="280811"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="21" onfocus="this.blur()" href="JavaScript:di('[b]PE_Kill[/b]','')">PE_Kill</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3232.gif" alt=""><br><span class=txtSm>Ранг: 793.4 <font color=magenta>(<b>! !</b>)</font>, 568thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.59'>Активность: 0.74<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3232">Участник</a><br><font color=blue>Шаман</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 апреля 2011 14:23 <br><script type="text/javascript">QU('PE_Kill','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=PE_Kill" target="_blank">Личное сообщение</a> &middot;  <a href="#21" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17876.html&amp;page=0#21');return false;">#21</a> </span><div align=left><br>
Для DLL надо еще править EntryPoint в списке модулей в PEB, возможно в данном случае это тоже нужно делать.
<br><br><font size="1"><i>-----<br>Yann Tiersen best and do not fuck</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=280812&amp;user=3232&amp;forum_n=6&amp;topic=17876.html&amp;page=0&amp;anchor=21" class="addthx" data-post="280812"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="22" onfocus="this.blur()" href="JavaScript:di('[b]Enigma[/b]','')">Enigma</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 88.3 (постоянный), 3thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.58'>Активность: 0.04<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=8396">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 апреля 2011 14:29 <br><script type="text/javascript">QU('Enigma','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Enigma" target="_blank">Личное сообщение</a> &middot;  <a href="#22" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17876.html&amp;page=0#22');return false;">#22</a> </span><div align=left><br>
<I>PE_Kill пишет:<br>Для DLL надо еще править EntryPoint в списке модулей в PEB, возможно в данном случае это тоже нужно делать. </I><br><br>Для длл - понятно, а вот если инжектить не длл а главный образ exe...?<br><br>Тем более что тут задача еще усложняется тем что:<br>1. списки всех модулей в пеб еще не инициализированы, они просто пустые.. Они заполняются только после ZwResumeThread а там надо до него все сделать..<br>2. Оля не аттачится к процессу после его создания с ZwCreateUserProcess.. вываливает ошибку.. аттачится только после ZwResumeThread.. т.е. тяжко отследить где именно падает..
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=280817&amp;user=8396&amp;forum_n=6&amp;topic=17876.html&amp;page=0&amp;anchor=22" class="addthx" data-post="280817"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="23" onfocus="this.blur()" href="JavaScript:di('[b]HiEndsoft[/b]','')">HiEndsoft</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 237.0 (наставник), 20thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.74'>Активность: 0.13<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=13651">Участник</a><br><font color=blue>sysenter</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 апреля 2011 16:01 <br><script type="text/javascript">QU('HiEndsoft','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=HiEndsoft" target="_blank">Личное сообщение</a> &middot;  <a href="#23" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17876.html&amp;page=0#23');return false;">#23</a> </span><div align=left><br>
<I>Enigma пишет:<br>1. списки всех модулей в пеб еще не инициализированы, они просто пустые.. Они заполняются только после ZwResumeThread а там надо до него все сделать.. </I><br>-- на сколько помнится про сам exe +  ntdll + kernel(base) там уже есть инфо.<br><b>Enigma</b><br>- вообще по запуску exe из памяти куча примеров в сети.<br>1. создаем процесс ZwCreateUserProcess(&#039;process.exe&#039;);<br>-suspend + читаем контекст осн. потока<br>2. удаляем образ process.exe в процессе через ZwUnmapViewOfSection<br>-- после чего выделяем память по адресу ep, если возможно<br>3. делаем инжект своего inject.exe<br>--пишем в выделенную память<br>4. корректируем PEB.ImageBase в удаленном процессе<br>--не надо, если по EP память удалось выделить, если нет - релоки обрабатываем<br>5. перехватом ZwResumeThread корректируем начало исполнения кода на свой inject.exe<br>-- просто пишем контекст и resume
<br><br><font size="1"><i>-----<br>продавец резиновых утёнков</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=280832&amp;user=13651&amp;forum_n=6&amp;topic=17876.html&amp;page=0&amp;anchor=23" class="addthx" data-post="280832"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="24" onfocus="this.blur()" href="JavaScript:di('[b]PE_Kill[/b]','')">PE_Kill</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3232.gif" alt=""><br><span class=txtSm>Ранг: 793.4 <font color=magenta>(<b>! !</b>)</font>, 568thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.59'>Активность: 0.74<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3232">Участник</a><br><font color=blue>Шаман</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 апреля 2011 21:15 <br><script type="text/javascript">QU('PE_Kill','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=PE_Kill" target="_blank">Личное сообщение</a> &middot;  <a href="#24" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17876.html&amp;page=0#24');return false;">#24</a> </span><div align=left><br>
<I>HiEndsoft пишет:<br>-- на сколько помнится про сам exe + ntdll + kernel(base) там уже есть инфо. </I><br>В разных виндах по разному, но в основном указатель на список модулей на тот момент вообще равен нулю.
<br><br><font size="1"><i>-----<br>Yann Tiersen best and do not fuck</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=280850&amp;user=3232&amp;forum_n=6&amp;topic=17876.html&amp;page=0&amp;anchor=24" class="addthx" data-post="280850"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="25" onfocus="this.blur()" href="JavaScript:di('[b]Enigma[/b]','')">Enigma</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 88.3 (постоянный), 3thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.58'>Активность: 0.04<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=8396">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 апреля 2011 13:47 &middot; Поправил: Enigma <br><script type="text/javascript">QU('Enigma','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Enigma" target="_blank">Личное сообщение</a> &middot;  <a href="#25" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17876.html&amp;page=0#25');return false;">#25</a> </span><div align=left><br>
<I>HiEndsoft пишет:<br>4. корректируем PEB.ImageBase в удаленном процессе--не надо, если по EP память удалось выделить, если нет - релоки обрабатываем </I><br><br>Если удалось выделить - то конечно не надо, а во всех остальных случаях - обязательно. Потому что GetModuleHandle(nil) берет значение как раз из пеб..<br><br><I>HiEndsoft пишет:<br>5. перехватом ZwResumeThread корректируем начало исполнения кода на свой inject.exe-- просто пишем контекст и resume </I><br><br>И процесс вываливается с ошибкой... <img src="img/smilies/s4.gif" alt=""><br><br>Делая все тоже самое, но без ZwUnmapViewOfSection - все работает как часы, если с ZwUnmapViewOfSection - то валимся в ошибке черт знает где и никак эту гадость не отладить, дебагеры не аттачатся к процессу в это время...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=280914&amp;user=8396&amp;forum_n=6&amp;topic=17876.html&amp;page=0&amp;anchor=25" class="addthx" data-post="280914"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="26" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 апреля 2011 14:19 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#26" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17876.html&amp;page=0#26');return false;">#26</a> </span><div align=left><br>
Отлаживай через ринг0. Или попробуй 2 ольку, она пораньше цепляться к процессу может, вроде.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=280921&amp;user=1556&amp;forum_n=6&amp;topic=17876.html&amp;page=0&amp;anchor=26" class="addthx" data-post="280921"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="27" onfocus="this.blur()" href="JavaScript:di('[b]Enigma[/b]','')">Enigma</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 88.3 (постоянный), 3thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.58'>Активность: 0.04<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=8396">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 апреля 2011 14:33 <br><script type="text/javascript">QU('Enigma','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Enigma" target="_blank">Личное сообщение</a> &middot;  <a href="#27" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=17876.html&amp;page=0#27');return false;">#27</a> </span><div align=left><br>
<I>Archer пишет:<br>Отлаживай через ринг0. </I><br><br>Так и придется через неудобный WinDbg...<br><br><br><I>Archer пишет:<br>Или попробуй 2 ольку, она пораньше цепляться к процессу может, вроде. </I><br><br>Она тоже не аттачится. Первая олька даже процесса не видит, созданного после ZwCreateUserProcess, вторая процесс видит, а приаттачится не может.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=280925&amp;user=8396&amp;forum_n=6&amp;topic=17876.html&amp;page=0&amp;anchor=27" class="addthx" data-post="280925"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> lpParameter для Thread</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#28" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="6">
<input type="hidden" name="topic" value="17876">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=17876" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
