<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Вопросы по ListView (двойная буферизация, выравнивание ячеек, уведомления...) - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Здраствуйте. Меня интересуют несколько аспектов. Здесь вроде как много народу на Api интерфейс любят делать. Так вот... 1) Как сделать двойную буферизацию ListView? Рыскал в поисковиках на эту тему, но либо попадались">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=1533'>rmn</a>, <a target='_blank' href='?action=userinfo&amp;user=8344'>Magister Yoda</a>, <a target='_blank' href='?action=userinfo&amp;user=50833'>vasilevradislav</a>, <a target='_blank' href='?action=userinfo&amp;user=55995'>tyns777</a>, <a target='_blank' href='?action=userinfo&amp;user=42072'>zombi-vadim</a> (+4 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Вопросы по ListView (двойная буферизация, выравнивание ячеек, уведомления...)</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]Exception[/b]','')">Exception</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 10.7 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.84'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=13153">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 мая 2008 13:37 <br><script type="text/javascript">QU('Exception','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Exception" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11780.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Здраствуйте. Меня интересуют несколько аспектов. Здесь вроде как много народу на Api интерфейс любят делать. Так вот...<br>1) Как сделать двойную буферизацию ListView? Рыскал в поисковиках на эту тему, но либо попадались статейки/туториалы на VCL, либо тупо упоминание как якобы надо делать. Наткнулся на пример на языке Си и попытался переделать под Delphi.<br><code>    WM_PAINT :<br>      begin<br>        GetClientRect(hApp, RhLV);<br>        hdcWnd := BeginPaint(hApp, PS);<br>        hbmMem := CreateCompatibleBitmap(hdcWnd, RhLV.Right - RhLV.Left, RhLV.Bottom - RhLV.Top);<br>        hdcMem := CreateCompatibleDC(hdcWnd);<br>        hbmWnd := SelectObject(hdcMem, hbmMem);<br>        BitBlt(hbmWnd, 0, 0, RhLV.Right - RhLV.Left, RhLV.Bottom - RhLV.Top, hdcMem, 0, 0, SRCCOPY);<br>        SelectObject(hdcMem, hbmWnd);<br>        DeleteObject(hbmMem);<br>        DeleteDC(hdcMem);<br>        EndPaint(hApp, PS);<br>      end;<br>    WM_ERASEBKGND : Result := TRUE;</code><br>Сначала делал именно для контрола ListView, но потом в процессе переделки оказалось что хоть какой хэндл контрола подставь BeginPaint, все равно будет буферизировано сразу целое диалоговое окно. Думаю что все равно такой код немного неправильный, потому как например к ListView применяю стиль LVS_EX_DOUBLEBUFFER, а если его не применять - никакой двойной буферизации целого диалога нет. Но ведь по идее должно и без этого стиля тогда буферизироваться... Что за дела...<br>2) Подскажите как выравнивать столбцы в ListView при изменении размеров контрола. Ну например справа от его границ. Какие хотя бы сообщения присылать/отсылать или нужно что-нибудь задать в параметре столбца при его создании?<br>3) Как все-таки без корректно ловить уведомление от ListView, когда выделили другую строчку в нем? Использовал LVN_ITEMCHANGED, но если элемент в контроле выделен и изменяется размер списка, то начинаются жуткие тормоза - у меня 2 таких контрола и выполняетсяпоиск значений в файле при нажатии на первый контрол. Так вот каждый раз при изменении размеров этот поиск начинает выполняться. Событие LVN_ITEMCHANGED мне нужно только для определения конкретного значения из 1 списка, чтобы потом его обработать и отобразить другие данные для него во 2 списке. Потом посмотрел в сторону нажатий клавиш стрелка вниз/вверх. Все равно мне только и нужно с клавиатуры &quot;тыкать&quot; на строчки списка. Однако после старта программы VK_UP и VK_DOWN не срабатывают с первого раза. Приходится по 2 раза &quot;тыкнуть&quot; чтобы выделилась другая строчка. Есть более унивеорсальный способ?<br><br>Спасибо.)
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=187472&amp;user=13153&amp;forum_n=6&amp;topic=11780.html&amp;page=0&amp;anchor=1" class="addthx" data-post="187472"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]s0larian[/b]','')">s0larian</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/1737.jpg" alt=""><br><span class=txtSm>Ранг: 387.4 (мудрец)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.19'>Активность: 0.17<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1737">Участник</a><br><font color=blue>системщик</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 мая 2008 22:04 <br><script type="text/javascript">QU('s0larian','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=s0larian" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11780.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
www.codeproject.com/KB/list/ <br><br>тут, правда, MFC, но ты просто скомпиль пару примеров, а потом выдерни API вызовы.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=187486&amp;user=1737&amp;forum_n=6&amp;topic=11780.html&amp;page=0&amp;anchor=2" class="addthx" data-post="187486"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]Exception[/b]','')">Exception</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 10.7 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.84'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=13153">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 мая 2008 17:24 <br><script type="text/javascript">QU('Exception','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Exception" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11780.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
Ммм... Долго рыскал, но все-таки нашел функцию автоматического подгона столбцов по нужным координатам. Это ListView_SetColumnWidth.<img src="img/smilies/s1.gif" alt=""><br>Буферизацию лучше такую оставлю. Только еще добавил на всякий случай FillRect.<br>Пришлось для ListView использовать NM_CLICK.<br><br>Хотя у кого есть мысли по поводу двойной буферизации, хотелось бы услышть ответ.<img src="img/smilies/s1.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=187675&amp;user=13153&amp;forum_n=6&amp;topic=11780.html&amp;page=0&amp;anchor=3" class="addthx" data-post="187675"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]AlexKlm[/b]','')">AlexKlm</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 38.2 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.39'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=10069">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 мая 2008 12:29 <br><script type="text/javascript">QU('AlexKlm','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=AlexKlm" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11780.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
Мыслей нет, откуда мысли, если голова моя пуста. Хочу заметить, что найти что-либо для чистого АПИ чрезвычайно сложно, тогда как для МФЦ есть горы любого мусора. Был бы благодарен если бы кто-нибудь выложил ссылки на исходники. <br>Если программируешь GUI на АПИ - ты бесстрашный человек, там столько всякого....
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=187947&amp;user=10069&amp;forum_n=6&amp;topic=11780.html&amp;page=0&amp;anchor=4" class="addthx" data-post="187947"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]Demon666[/b]','')">Demon666</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 213.5 (наставник)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.21'>Активность: 0.12<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=4551">Участник</a><br><font color=blue>забанен</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 мая 2008 05:05 <br><script type="text/javascript">QU('Demon666','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Demon666" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11780.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
<I>Exception пишет:<br>Хотя у кого есть мысли по поводу двойной буферизации, хотелось бы услышть ответ </I><br>Как вариант можно захучить обработчик сообщений самого дочернего окна ListView (к примеру <b>SetWindowLong</b>(hListView,GWL_WNDPROC, NewListViewProc)) и уже там, в хуке(NewListViewProc) обрабатывать WM_PAINT, WM_LBUTTONDOWN и т. д.<br>тогда это будет только для ListView<br><br><I>Exception пишет:<br>Рыскал в поисковиках на эту тему </I><br>а ты гугли сразу уже готовые полноценные опенсорсные проекты/компоненты для Delphi(в них потом и ищи уже готовую реализацию GDI)
<br><br><font size="1"><i>-----<br>ЗЫ: истЕна где-то рядом, Welcome@Google.com</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=188045&amp;user=4551&amp;forum_n=6&amp;topic=11780.html&amp;page=0&amp;anchor=5" class="addthx" data-post="188045"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]dermatolog[/b]','')">dermatolog</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/1404.png" alt=""><br><span class=txtSm>Ранг: 116.6 (ветеран), 8thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.36'>Активность: 0.05<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1404">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 мая 2008 08:45 <br><script type="text/javascript">QU('dermatolog','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=dermatolog" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11780.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
<b>Exception</b><br>Посмотри в сторону VirtualTreeView http://www.soft-gems.net/VirtualTreeview . ИМХО возможностей очень много да и представить дерево в виде плоского списка не проблема <img src="img/smilies/s1.gif" alt="">) И исшо - если нужна скорость при работе с большим набором данных в ListView или TreeView, то лучше с них сразу сваливать, т.к. виндовые контролы, к которым за данными лезешь через сообщения это полный пипец.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=188052&amp;user=1404&amp;forum_n=6&amp;topic=11780.html&amp;page=0&amp;anchor=6" class="addthx" data-post="188052"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]UR[/b]','')">UR</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.1 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.65'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=7881">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 мая 2008 17:39 <br><script type="text/javascript">QU('UR','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=UR" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11780.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
<I>dermatolog пишет:<br>Посмотри в сторону VirtualTreeView. ИМХО возможностей очень много да и представить дерево в виде плоского списка не проблема ) И исшо - если нужна скорость при работе с большим набором данных в ListView или TreeView, то лучше с них сразу сваливать, т.к. виндовые контролы, к которым за данными лезешь через сообщения это полный пипец. </I><br><br>Очень спорное утверждение. Про ListView. VirtualTreeView от Мишки Лешки очень хорошая замена для TreeView, но не однозначно хорошая замена для ListView. Если посмотреть на исходники VTV, то сразу станет ясно, почему.<br><br>Для ListView есть хорошая возможность, работа его в виртуальном режиме. Нужно только не полениться и прочитать про это. В этом случае он будет ровно тем, чем должен быть. Средством отображения многоколоночных данных. Причем абсолютно никакой разницы в скорости заполнения/отображения, отображаете вы 10, или 10000000 записей. Достаточно только описать правила доступа к данным и обработчики их получения, и сделать одно присвоение в коде: MyListView.Count := 10 (или 10000000, если вам надо <img src="img/smilies/s1.gif" alt=""> );<br><br>У Мишки Лешки же нужно описать Node, задать NodeSize, и после этого для каждой ноды будет происходить дополнительное аллоцирование памяти под каждую ноду. Вобщем то понятно почему. С деревом по другому сложно. Ну и все теже методы, что и для LV в виртуальном режиме тоже остаются. Еще и с освобождением памяти могут быть нюансы. Если вдруг в в вашей ноде есть, допустим String, и по запаре забылось поставить обработчик на FreeNode, то память будет течь. И чем чаще будет перезаполняться VTV, тем больше памяти утечет.<br><br>Получается, что заменять LV на VTV, это очень спорное решение. TreeView заменять правильно. А вот LV нет абсолютно никакого смысла.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=188081&amp;user=7881&amp;forum_n=6&amp;topic=11780.html&amp;page=0&amp;anchor=7" class="addthx" data-post="188081"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]dermatolog[/b]','')">dermatolog</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/1404.png" alt=""><br><span class=txtSm>Ранг: 116.6 (ветеран), 8thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.36'>Активность: 0.05<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1404">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 мая 2008 18:18 <br><script type="text/javascript">QU('dermatolog','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=dermatolog" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11780.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
<I>UR пишет:<br>Для ListView есть хорошая возможность, работа его в виртуальном режиме. Нужно только не полениться и прочитать про это. В этом случае он будет ровно тем, чем должен быть. Средством отображения многоколоночных данных. Причем абсолютно никакой разницы в скорости заполнения/отображения, отображаете вы 10, или 10000000 записей.  </I><br>Достаточно посмотреть исходники любого виндового контрола чтобы понять, что доступ данных через систему сообщений это мегатормоза <img src="img/smilies/s1.gif" alt="">) Проверено практикой.<br><I>UR пишет:<br>У Мишки Лешки же нужно описать Node, задать NodeSize, и после этого для каждой ноды будет происходить дополнительное аллоцирование памяти под каждую ноду.  </I><br>Вы не правы. Если вы в ноде будете хранить просто указатель, то никаких телодвижений не нужно вообще.<br><I>UR пишет:<br>Еще и с освобождением памяти могут быть нюансы. Если вдруг в в вашей ноде есть, допустим String, и по запаре забылось поставить обработчик на FreeNode, то память будет течь. И чем чаще будет перезаполняться VTV, тем больше памяти утечет.  </I><br>Вы опять не правы. Высвобождением String-ов занимается дельфовый менеджер памяти и не надо заморачиваться по этому поводу - все давно за вас сделал Borland.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=188083&amp;user=1404&amp;forum_n=6&amp;topic=11780.html&amp;page=0&amp;anchor=8" class="addthx" data-post="188083"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]dermatolog[/b]','')">dermatolog</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/1404.png" alt=""><br><span class=txtSm>Ранг: 116.6 (ветеран), 8thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.36'>Активность: 0.05<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1404">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 мая 2008 18:28 <br><script type="text/javascript">QU('dermatolog','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=dermatolog" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11780.html&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
P.S. Я сам с VT работаю много лет - на нём можно сделать дохера чего. Например есть свой TVTDBGrid (кстати пример как не надо писать компоненты - это посмотреть исходники стандартного TDBGrid), есть инспектор свойств с древовидной структурой.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=188084&amp;user=1404&amp;forum_n=6&amp;topic=11780.html&amp;page=0&amp;anchor=9" class="addthx" data-post="188084"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]UR[/b]','')">UR</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.1 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.65'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=7881">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 мая 2008 19:46 <br><script type="text/javascript">QU('UR','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=UR" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11780.html&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
<I>dermatolog пишет:<br>Достаточно посмотреть исходники любого виндового контрола чтобы понять, что доступ данных через систему сообщений это мегатормоза ) Проверено практикой </I><br><br>Не понимаю, причем здесь это? Отрисовать несколько записей совершенно не проблема. А в виртуальном режиме все, что нужно, это получить индекс записи. Дальше дело ваше. Хотите шлите сообщения, хотите рисуйте сами. Делов куча. Главное не в этом, а в том, что список любого размера работает с одинаковой скоростью. И скорость эта не зависит от кол-ва записей. Работает исключительно быстро.<br><br><I>dermatolog пишет:<br>Вы не правы. Если вы в ноде будете хранить просто указатель, то никаких телодвижений не нужно вообще.  </I><br><br>Угу. Только Pointer для каждой записи в размере 4-х байт должен откуда то взяться. Для 10000000 записей (например) это не много ни мало 40мб просто так сожраной памяти. Просто для индексов. Которые в случае прлоской структуры хранить не надо. Они получаются из номера элемента. И давая совет надо предупреждать о таких вещах.<br><br><I>dermatolog пишет:<br>Вы опять не правы. Высвобождением String-ов занимается дельфовый менеджер памяти и не надо заморачиваться по этому поводу - все давно за вас сделал Borland. </I><br><br>Ну чтож. Дело, как говориться, хозяйское. Можно не верить, но можно и проверить. Простой пример:<br><br>PMyNodeData = ^TMyNodeData;<br>TMyNodeData = packed record<br> pIndex: Pointer; //Пусть это будет какой нибудь указатель на отображаемую структуру<br> strComment: String; //А здесь, допустим коментарий для конкретной записи<br>end;<br><br>Вот допустим понадобилось сделать именно нак. При добавлении ноды заполняем соответствующую NodeData. Так вот если во FreeNode не сделать strComment := &#039;&#039;, то все эти строки будут болтаться в памяти до закрытия приложения. Аналогично будут болтаться и все структуры/об&#039;екты созданные при добавлении ноды и не прибитые ручками. Собственно, событие OnFreeNode ровно для того и заложено, что бы руками подбирать мусор, который руками же и создается. Если есть сомнения, можно проверить, блиго это дело пяти минут.<br><br>Кстати. Исходники менеджера памяти Дельфевского тоже доступны. Можно было бы и посмотреть. Автоматом освобождается память только в том случае, если кол-во реферов на данную облость памяти равно 0. Не важно, строки это, либо регионы памяти. Перед каждой выделенной строкой есть счетчик ссылок. Пока он не ноль, память не осободится.<br><br>Вобщем, что-бы не уходить далеко от темы. Мое мнение, что VTV является хорошей заменой для TreeView, но отнюдь не идеальной заменой для ListView. Сам использую VTV как замену штатному TreeView, как замену ListView не использую. Штатных возможностей ListView за глаза хватает.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=188089&amp;user=7881&amp;forum_n=6&amp;topic=11780.html&amp;page=0&amp;anchor=10" class="addthx" data-post="188089"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]Exception[/b]','')">Exception</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 10.7 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.84'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=13153">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 мая 2008 21:11 <br><script type="text/javascript">QU('Exception','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Exception" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11780.html&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
Чего-то вы заспорились тут. <img src="img/smilies/s1.gif" alt=""><br>Проблему частично решил WM_SETREDRAW функцией для отключения/включения обновления ListView перед составлением списка.<br>А буферизация... Да пускай уж будет такая. Один фиг, что хорошо, так сразу целое окно при изменении размеров не рябит.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=188098&amp;user=13153&amp;forum_n=6&amp;topic=11780.html&amp;page=0&amp;anchor=11" class="addthx" data-post="188098"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]UR[/b]','')">UR</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.1 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.65'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=7881">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 мая 2008 23:10 <br><script type="text/javascript">QU('UR','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=UR" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11780.html&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
<I>Exception пишет:<br>Чего-то вы заспорились тут.   </I><br><br>Я не спорю, а всего лишь на некоторые нюансы внимание обращаю.<br><br>С DoubleBuffered есть еще некоторые моменты. Как отрисовка делана? Сам рисуешь, или штатно? И, соответственно, как реагируешь на WM_ERASEBKGND. И т.п. Вообще то надо весь код смотреть. От заполнения и до конца отрисовки, поскольку Дельфи Invalidate может вызывать во многих местах. И перерисовку ячеек при изменении значений, и еще кучу разных весчей.<br><br>Оптимально перекрыть обработчики, которые OnAdvancedCustomDraw, OnAdvancedCustomDrawItem и OnAdvancedCustomDrawSubItem. Они вызываются до Paint и если надо рисовать что то особеное, то лучше это делать в этих эвентах, возвращать DefaultDraw := False и тогда весь процесс рисования будет тебе полностью подконтролен.<br><br>Честно говоря, я вообще не понимаю, в чем у тебя проблема. Никогда с подобным не сталкивался. Мельканий и прочей фигни не видел. Даже без двойной буфферизации. Вот как делаю я:<br><br>1) Перевожу LV в  виртуальный режам. Свойство OwnerData<br>2) Завожу оброботчик для OnData (здесь получаю нужные для ячейки данные)<br>3) Завожу обработчик для OnAdvancedCustomDrawItem (здесь рисую картинку из ImageLista, если надо)<br>4) Завожу обработчик для OnAdvancedCustomDrawSubItem (здесь рисую содержимое субитемов)<br><br>Так примерно это в коде:<br><br>FMyDataList - в примере TStringList. Заполнен где-то.<br><br>procedure TMyForm.ListView1Data(Sender: TObject;  Item: TListItem);<br>begin<br> if (Item &lt;&gt; nil) and  (Item.Index &gt;= 0) and (Item.Index &lt; FMyDataList.Count) then begin<br>  //Тут нужными тебе условиям задаешь что надо<br>  with Item do begin<br>   Caption        := FMyDataList.Strings[Item.Index];<br>   //Устанавливай в нужное тебе значение по своим критериям<br>   ImageIndex := 1; <br>  end;<br> end;<br>end;<br><br>procedure TMyForm.ListView1AdvancedCustomDrawItem(<br>  Sender: TCustomListView; Item: TListItem; State: TCustomDrawState;<br>  Stage: TCustomDrawStage; var DefaultDraw: Boolean);<br>var RT: TRect;<br>    DC: THandle;<br>    BH: THandle;<br>begin<br> if (Stage = cdPrePaint) then<br>  if (Item &lt;&gt; nil) then begin<br>   DC := GetDC(TListView(Sender).Handle);<br>   try<br>    if (Item.ImageIndex &lt;&gt; -1) then begin<br>     RT := Item.DisplayRect(drIcon);<br>     BH := Windows.CreateSolidBrush(ColorToRGB(TListView(Sender).Color));<br>     Windows.FillRect(DC, RT, BH);<br>     DeleteObject(BH);<br>     //Здесь рисую картинку из ImageList&#039;а. Не помню вызова по памяти.<br>     //MyImageList.Draw(DC, RT, Item.ImageIndex);<br>    end;<br>   finally<br>    ReleaseDC(TListView(Sender).Handle, DC);<br>   end;<br>  end;<br> DefaultDraw := True;<br>end;<br><br>procedure TMyForm.ListView1AdvancedCustomDrawSubItem(<br>  Sender: TCustomListView; Item: TListItem; SubItem: Integer;<br>  State: TCustomDrawState; Stage: TCustomDrawStage;<br>  var DefaultDraw: Boolean);<br>var S : String;<br> //---------------------------------------<br> procedure DoPaintItem;<br> var DC: THandle;<br>       CL: TColor;<br>       RT: TRect;<br>       SZ: TSize;<br>       DF: DWORD;<br> begin<br>  ListView_GetSubItemRect(Sender.Handle, Item.Index, SubItem, LVIR_BOUNDS, @RT);<br>  Inc(RT.Left, 8);<br>  with Sender.Canvas do begin<br>   if (Sender.Focused) and (Item.Selected) then CL := FHighlightColor<br>   else CL := FDefaultColor;<br>   DC := GetDC(TListView(Sender).Handle);<br>   try<br>    SelectObject(DC, Font.Handle);<br>    SetTextColor(DC, ColorToRGB(CL));<br>    SetBkMode(DC, TRANSPARENT);<br>    DF  := DT_LEFT or DT_VCENTER or DT_SINGLELINE;<br>    GetTextExtentPoint32(DC, PChar(S), Length(S), SZ);<br>    if (SZ.cx &gt; RT.Right - RT.Left) then<br>     //Эта функция проверяет, и если строка длиннее, чем ширина Rect,<br>     //тримирует строку и добавляет в  конец точки<br>     //Кстати, из исходников Мишки Лешки, его VTV <img src="img/smilies/s1.gif" alt=""><br>     S := ShortenString(DC, S, RT.Right - RT.Left, False);<br>    DrawText(DC, PChar(S), Length(S), RT, DF, False);<br>   finally<br>    ReleaseDC(TListView(Sender).Handle, DC);<br>   end;<br>  end;<br> end;<br> //---------------------------------------<br>begin<br> if (Stage = cdPrePaint) then begin<br>  if (Item &lt;&gt; nil) and  (Item.Index &gt;= 0) and (Item.Index &lt; FMyDataList.Count) then begin<br>   if (SubItem = 1) then begin<br>    S := FMyDataList.Strings[Item.Index];<br>    DoPaintItem;<br>   end else<br>   if (SubItem = 2) then begin<br>    S := &#039;Что то нужное тебе&#039;; //Получай из нужных тебе источников<br>    DoPaintItem;<br>   end;<br>   //Дальше нужные тебе SubItems, сколько их там у тебя...<br>  end;<br> end;<br> DefaultDraw := True;<br>end;<br><br> //Переводим LV  в виртуальный режим<br> ListView1.OwnerData := True;<br> //Теперь устанавливаем кол-во записей<br> ListView1.Count := FMyDataList.Count;<br><br> Если надо почистить LV, то просто  ListView1.Count := 0.<br><br>Все. Ничего не мыргает.<br>Если нужна юникодность, то просто используешь соответствующие юникодные аналоги для GetTextExtentPoint32 и DrawText. Ну и соответственно юникодный StringList (или что у тебя там будет).<br><br><b>Важно!</b> Это только пример! Писал по памяти, возможны ошибки. Над оптимальностью кода не задумывался.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=188110&amp;user=7881&amp;forum_n=6&amp;topic=11780.html&amp;page=0&amp;anchor=12" class="addthx" data-post="188110"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]Demon666[/b]','')">Demon666</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 213.5 (наставник)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.21'>Активность: 0.12<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=4551">Участник</a><br><font color=blue>забанен</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 мая 2008 01:15 <br><script type="text/javascript">QU('Demon666','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Demon666" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11780.html&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
<I>Exception пишет:<br>Чего-то вы заспорились тут. </I><br>Тоже встану на защиту Отца <b>dermatolog</b>`а и <b>UR</b><br>В споре почти всегда рождаецца истЕна ;)( cracklab! это же не какой-нибудь ламосайтег.ру, тут печатаюццо люди -&gt; у которых многолетний(!) стаж в кодинге)<br>И гораздо интереснее почитать этот спор, чем лаконичный ответ решения проблемы<br><br><I>Exception пишет:<br>Проблему частично решил WM_SETREDRAW  </I><br>Судя по твоим ответам должно вообще все замечательно работать, непонятно что значит &quot;Проблему частично решил&quot;<br><br><I>Exception пишет:<br>Использовал LVN_ITEMCHANGED </I><br>Я когда собираюсь вешать обработчик на какое-нибудь сообщение - частенько перед этим стартую тест-прогу и тупо вешаю на нее утилиту Microsoft Spy++, настраиваю то, что нужно чтобы записалось в лог-файл/окно и потом уже анализирую какие и сколько сообщений приходило при нажатии кнопки мыши, изменении размеров окна и т. д.<br>Утиль сохраняет также параметры приходящих сообщений и иногда показывает такие сообщения которые могут решить очень много проблем сразу..
<br><br><font size="1"><i>-----<br>ЗЫ: истЕна где-то рядом, Welcome@Google.com</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=188121&amp;user=4551&amp;forum_n=6&amp;topic=11780.html&amp;page=0&amp;anchor=13" class="addthx" data-post="188121"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]Exception[/b]','')">Exception</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 10.7 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.84'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=13153">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 мая 2008 09:30 <br><script type="text/javascript">QU('Exception','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Exception" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11780.html&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
<I>Demon666 пишет:<br>Судя по твоим ответам должно вообще все замечательно работать, непонятно что значит &quot;Проблему частично решил&quot; </I><br>Да ну насчет ListView - все замечательно. Я просто отказался от перерисовки элементов списка. Ерундень какая-то. Итак пока устраивают стандартные системные цвета...<br><br><I>Demon666 пишет:<br>Я когда собираюсь вешать обработчик на какое-нибудь сообщение - частенько перед этим стартую тест-прогу и тупо вешаю на нее утилиту Microsoft Spy++ </I><br>Да я еще программу даже не отлаживал. Впринципе это пока простенький диспетчер задач с неработающими некоторыми функциями...<br><br>Строго не ругать то что в аттаче. Но после последних изменений список процессов и загруженных модулей должен более менее быстро отображаться. <img src="img/smilies/s1.gif" alt=""><br><br><img src="img/attach.gif" alt=""> <a href="./files/e2fe_08.05.2008_CRACKLAB.rU.tgz">e2fe_08.05.2008_CRACKLAB.rU.tgz</a> - ProcTools.rar
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=188134&amp;user=13153&amp;forum_n=6&amp;topic=11780.html&amp;page=0&amp;anchor=14" class="addthx" data-post="188134"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]dermatolog[/b]','')">dermatolog</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/1404.png" alt=""><br><span class=txtSm>Ранг: 116.6 (ветеран), 8thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.36'>Активность: 0.05<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1404">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 мая 2008 07:31 <br><script type="text/javascript">QU('dermatolog','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=dermatolog" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11780.html&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
<I>UR пишет:<br>Не понимаю, причем здесь это? Отрисовать несколько записей совершенно не проблема. А в виртуальном режиме все, что нужно, это получить индекс записи. Дальше дело ваше. Хотите шлите сообщения, хотите рисуйте сами. Делов куча. Главное не в этом, а в том, что список любого размера работает с одинаковой скоростью. И скорость эта не зависит от кол-ва записей. Работает исключительно быстро.  </I><br>Ну вот с VTV это действительно не проблема <img src="img/smilies/s1.gif" alt="">)<br><br><I>UR пишет:<br>Угу. Только Pointer для каждой записи в размере 4-х байт должен откуда то взяться. Для 10000000 записей (например) это не много ни мало 40мб просто так сожраной памяти. Просто для индексов. Которые в случае прлоской структуры хранить не надо. Они получаются из номера элемента. И давая совет надо предупреждать о таких вещах.  </I><br>Детали реализации - это отдельный вопрос. Не надо мешать всё в кучу - указатели на данные в самих нодах и доступ к темже указателям (в собственном массиве или списке) через индекс нода. Например сортировка нодов с указателями в каждом ноде намного удобнее тойже сортировки с перестановкой индексов в списке. Поэтому давайте не будет спорить кто ожирает и сколько памяти - все зависит от реализации.<br><br><I>UR пишет:<br>Кстати. Исходники менеджера памяти Дельфевского тоже доступны. Можно было бы и посмотреть. Автоматом освобождается память только в том случае, если кол-во реферов на данную облость памяти равно 0. Не важно, строки это, либо регионы памяти. Перед каждой выделенной строкой есть счетчик ссылок. Пока он не ноль, память не осободится.  </I><br>Поля структур как раз и относятся к &quot;связанным&quot; объектам с подсчетам референсов. Если вы высвобождаете структуру имеющую ссылку на строку, то количество ссылок на строку всегда будет=0 и строка высвободится автоматически.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=188401&amp;user=1404&amp;forum_n=6&amp;topic=11780.html&amp;page=0&amp;anchor=15" class="addthx" data-post="188401"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]UR[/b]','')">UR</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.1 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.65'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=7881">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 мая 2008 19:25 <br><script type="text/javascript">QU('UR','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=UR" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11780.html&amp;page=0#16');return false;">#16</a> </span><div align=left><br>
<I>dermatolog пишет:<br>Ну вот с VTV это действительно не проблема )  </I><br><br>Увы, проблема. Однажды мне понадобилось средство отоброжения большого кол-ва данных. Суммарное кол-во записей могло доходить до 600 000 000 (шестисот миллионов). Данные не мои, не организованны в виде базы. Нарушать их целостность и перестраивать под себя я не мог. Нужно было просто предоставить возможность их отображать. VTV не справился с этим. Очень медленно оказалось. Из-за огромного кол-ва сожранной памяти. В результате я за вечер написал нужного мне наследника от TListView.<br><br>Я устраивать баталии не собираюсь. Повторять сказанное тоже смысла не вижу. Единственное, о чем хочу сказать еще раз: Всегда, природа так устроена, у всего есть своя специфика. Нет одного лекарства против всех болезней. Хуже всего советы типа &quot;вот эта таблетка от гемороя и бессонницы&quot;. Без уточнения, что побочный эффект - энурез. Рекомендуя что-то стоит учитывать требования задачи и предупреждать об особенностях. VTV свои особенности имеет. Рекомендуется ВНИМАТЕЛЬНО ознакомится с документацией и просмотреть особенности реализации некоторых решений. Исходники доступны.<br><br><I>dermatolog пишет:<br>Поля структур как раз и относятся к &quot;связанным&quot; объектам с подсчетам референсов. Если вы высвобождаете структуру имеющую ссылку на строку, то количество ссылок на строку всегда будет=0 и строка высвободится автоматически. </I><br><br>Неужели трудно проверить? Если нет времени, или желания проверять на &quot;живом&quot; коде, то предложу к рассмотрению следующее:<br><br>Аксиома: Освобождает тот, кто выделил.<br><br>Если не устраивает строка, то заменим ее на, допустим, TObject. Кто должен сказать ему Free? По каким критериям определяется момент, в который это Free должно произойти? В какой момент происходит декримент счетчика ссылок?<br><br>Вобщем, абсолютно не важно, строка это, либо TObject  и его наследники. В физическом смысле все они представляют из себя некоторую облость памяти. Отличие только в том, что для об&#039;ектов предусмотрен специальный механизм освобождения памяти выделенной в процессе жизни об&#039;екта. <br><br>Резюме мое такое. Приятно, когда за тебя делается масса полезных весчей. Но хорошая привычка - проверить, что тебя не обманули твои ожидания.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=188445&amp;user=7881&amp;forum_n=6&amp;topic=11780.html&amp;page=0&amp;anchor=16" class="addthx" data-post="188445"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]dermatolog[/b]','')">dermatolog</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/1404.png" alt=""><br><span class=txtSm>Ранг: 116.6 (ветеран), 8thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.36'>Активность: 0.05<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1404">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 мая 2008 20:57 <br><script type="text/javascript">QU('dermatolog','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=dermatolog" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11780.html&amp;page=0#17');return false;">#17</a> </span><div align=left><br>
<I>UR пишет:<br>Неужели трудно проверить? Если нет времени, или желания проверять на &quot;живом&quot; коде, то предложу к рассмотрению следующее:  </I><br>Все давно проверено и перепроверено. Для отслеживания утечек памяти есть полно утилит - возьми хотябы FastMM и проверь на нём свою теорию.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=188462&amp;user=1404&amp;forum_n=6&amp;topic=11780.html&amp;page=0&amp;anchor=17" class="addthx" data-post="188462"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]UR[/b]','')">UR</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.1 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.65'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=7881">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 мая 2008 21:39 <br><script type="text/javascript">QU('UR','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=UR" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11780.html&amp;page=0#18');return false;">#18</a> </span><div align=left><br>
<I>dermatolog пишет:<br>Все давно проверено и перепроверено. Для отслеживания утечек памяти есть полно утилит - возьми хотябы FastMM и проверь на нём свою теорию. </I><br><br>Есть в наличии и FastMM, есть и диагностический софт. Все, что хотел сказать - сказал. Привычки высказываться голословно нет, моя информация из реальной практики. Кого заинтересовало, тот посмотрит и проверит сам. Продолжать особого смысла не вижу.<br><br>PS: Сегодня уже делать ничего не буду. Завтра набросаю пример. Демонстрацию.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=188469&amp;user=7881&amp;forum_n=6&amp;topic=11780.html&amp;page=0&amp;anchor=18" class="addthx" data-post="188469"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]UR[/b]','')">UR</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.1 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.65'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=7881">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 мая 2008 22:59 <br><script type="text/javascript">QU('UR','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=UR" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11780.html&amp;page=0#19');return false;">#19</a> </span><div align=left><br>
Настроение появилось, решил не ждать до завтра. <img src="img/smilies/s1.gif" alt=""><br><br>В аттаче демо. В опциях FastMM надо включить FullDebug и наслаждаться результатом.<br><br>PS: Только не надо говорить, что так никто не делает. Дело не в этом, а в том, что строки не освобождаются до закрытия приложения. При каждом заполнении VTV (если крыжик не стоит) по 1000 строк которые уже не используются остаются в памяти.<br><br><img src="img/attach.gif" alt=""> <a href="./files/a85a_12.05.2008_CRACKLAB.rU.tgz">a85a_12.05.2008_CRACKLAB.rU.tgz</a> - vtv_demo.rar
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=188479&amp;user=7881&amp;forum_n=6&amp;topic=11780.html&amp;page=0&amp;anchor=19" class="addthx" data-post="188479"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="20" onfocus="this.blur()" href="JavaScript:di('[b]dermatolog[/b]','')">dermatolog</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/1404.png" alt=""><br><span class=txtSm>Ранг: 116.6 (ветеран), 8thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.36'>Активность: 0.05<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1404">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 13 мая 2008 05:46 <br><script type="text/javascript">QU('dermatolog','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=dermatolog" target="_blank">Личное сообщение</a> &middot;  <a href="#20" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11780.html&amp;page=0#20');return false;">#20</a> </span><div align=left><br>
<I>UR пишет:<br>В аттаче демо. В опциях FastMM надо включить FullDebug и наслаждаться результатом.  </I><br>При закрытии приложения - AV. Фтопку такие тесты <img src="img/smilies/s1.gif" alt="">)
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=188486&amp;user=1404&amp;forum_n=6&amp;topic=11780.html&amp;page=0&amp;anchor=20" class="addthx" data-post="188486"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="21" onfocus="this.blur()" href="JavaScript:di('[b]UR[/b]','')">UR</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.1 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.65'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=7881">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 13 мая 2008 12:11 <br><script type="text/javascript">QU('UR','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=UR" target="_blank">Личное сообщение</a> &middot;  <a href="#21" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11780.html&amp;page=0#21');return false;">#21</a> </span><div align=left><br>
<I>dermatolog пишет:<br>При закрытии приложения - AV. Фтопку такие тесты ) </I><br><br>Надеюсь, ты можешь сказать в каком конкретно месте вылетает AV? Хотелось бы услышать. В противном случае это все смахивает на простое балабольство.<br><br>Данный код работает и не вызывает исключений под Delphi5/7 (я не пользуюсь более новыми версиями за ненадобностью). Не используется НИЧЕГО не стандартного. Никаких вывихов мозговых в коде нет. VTV от Мишки Лешки и FastMM, это все, что не идет в комплекте со стандартной поставкой Delphi.<br><br>Если у тебя падает с AV, значит причина в твоей среде. В том же VTV или FastMM. Это, кстати, еще один довод в пользу осторожного юзания сторонних решений. Код VTV и FastMM не правился и изменений в него не вносилось. Версия VTV 4.0.16, Fast Memory Manager 4.78.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=188510&amp;user=7881&amp;forum_n=6&amp;topic=11780.html&amp;page=0&amp;anchor=21" class="addthx" data-post="188510"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="22" onfocus="this.blur()" href="JavaScript:di('[b]UR[/b]','')">UR</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.1 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.65'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=7881">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 13 мая 2008 12:41 <br><script type="text/javascript">QU('UR','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=UR" target="_blank">Личное сообщение</a> &middot;  <a href="#22" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11780.html&amp;page=0#22');return false;">#22</a> </span><div align=left><br>
Хоть у меня никаких AV и не вылетает, но решил ужесточить контроль. В аттаче доработанный примерчик. Все, что добавил, это очистку VTV на закрытие и контроль Node и NodeData  на nil.<br><br><br><img src="img/attach.gif" alt=""> <a href="./files/4132_13.05.2008_CRACKLAB.rU.tgz">4132_13.05.2008_CRACKLAB.rU.tgz</a> - vtvdemo.rar
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=188512&amp;user=7881&amp;forum_n=6&amp;topic=11780.html&amp;page=0&amp;anchor=22" class="addthx" data-post="188512"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="23" onfocus="this.blur()" href="JavaScript:di('[b]dermatolog[/b]','')">dermatolog</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/1404.png" alt=""><br><span class=txtSm>Ранг: 116.6 (ветеран), 8thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.36'>Активность: 0.05<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1404">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 13 мая 2008 14:07 <br><script type="text/javascript">QU('dermatolog','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=dermatolog" target="_blank">Личное сообщение</a> &middot;  <a href="#23" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11780.html&amp;page=0#23');return false;">#23</a> </span><div align=left><br>
<b>2 UR</b><br>Твой пример компилил на Delphi 5+стандартные FastMM и VT. На выходе получаю AV - разбираться времени не было.<br>Теперь по теме самого самбжа. Я немного не точно выражался, когда говорил про высвобождение памяти с сылками на строки. Информация о ссылках на строки есть, но только на уровне объектов (у каждого объекта есть специальная таблица) и при уничтожении объекта специальные процедуры FinalizeArray и FinalizeRecord подчищают такие связи. Для структур этой таблицы нет и здесь ты прав, что строковые строки нужно высвобождать руками. В любом случае если в нодах хранить только указатели на объекты (что собственно я всегда и делаю и всем рекомендую <img src="img/smilies/s1.gif" alt="">)), то проблем с утечками памяти не будет.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=188521&amp;user=1404&amp;forum_n=6&amp;topic=11780.html&amp;page=0&amp;anchor=23" class="addthx" data-post="188521"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="24" onfocus="this.blur()" href="JavaScript:di('[b]UR[/b]','')">UR</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.1 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.65'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=7881">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 13 мая 2008 17:57 <br><script type="text/javascript">QU('UR','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=UR" target="_blank">Личное сообщение</a> &middot;  <a href="#24" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11780.html&amp;page=0#24');return false;">#24</a> </span><div align=left><br>
<I>dermatolog пишет:<br>Твой пример компилил на Delphi 5+стандартные FastMM и VT. На выходе получаю AV - разбираться времени не было.  </I><br><br>Фиг с ним. Правда если и второй вариант падает, то надо будет посмотреть и МишкеЛешке отписать (если это его бага). Вероятнее всего какойто Invalidate/Repaint пролазит при закрытии. Ну и дергает уже прибитые ссылки.<br><br><I>dermatolog пишет:<br>Для структур этой таблицы нет и здесь ты прав, что строковые строки нужно высвобождать руками. В любом случае если в нодах хранить только указатели на объекты (что собственно я всегда и делаю и всем рекомендую )), то проблем с утечками памяти не будет. </I><br><br>Вот вроде и разобрались. В любом случае понятие &quot;Об&#039;ектное програмирование&quot; как термин не должно восприниматься просто на веру. Обычно именно это и пораждает неприятные и трудно ловимые баги. Автоматическая сборка мусора штука очень приятная. Тут спору нет. Однако подводных камней при этом тоже хватает. В чистой концепции об&#039;ектного програмирования это совершенно безопасная весчь, однако в реальной практике это далеко не всегда так. В Delphi например нужно ужесточение типизации, исключение механизмов приведения типов и полный отказ от pointer&#039;ов. Тогда еще можно поручать программе чистить мусор самостоятельно и не очень задумываться об этом. Пока этого нет - &quot;никому верить нельзя&quot;. <img src="img/smilies/s1.gif" alt=""><br><br>Пеперь вернусь к жору памяти. Жрет, и будет жрать из-за природы своей. Ну не может дерево не жрать! Да, если хранить только указатель на данные, то жрет минимально. Полюбому расход памяти можно рассчитывать как С + (N * 4). Где С, это некий оверхед и N число нод. Меньше не будет никак (больше запросто). Я настоятельно рекомендую не отмахиваться от этого и всегда иметь это ввиду. Разочарований не будет. <img src="img/smilies/s1.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=188557&amp;user=7881&amp;forum_n=6&amp;topic=11780.html&amp;page=0&amp;anchor=24" class="addthx" data-post="188557"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Вопросы по ListView (двойная буферизация, выравнивание ячеек, уведомления...)</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#25" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="6">
<input type="hidden" name="topic" value="11780">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=11780" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
