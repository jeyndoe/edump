<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Зачем нужна инструкция MOV EDI,EDI - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Приветствую. Почему реализация всех WinAPI-функций начинается с инструкции MOV EDI,EDI? В интернете (например, тут) это объясняется тем, что данная инструкция позволяет написать двух-байтовый патч в виде JMP &#036;-5, чтобы">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=42860'>igorcauret</a>, <a target='_blank' href='?action=userinfo&amp;user=8605'>Rio</a> (+6 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/nub.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=5&sortBy=0&page=0.html"><b>Вопросы новичков</b></a> <b class=bulletHead>&#8212;&#8250;</b> Зачем нужна инструкция MOV EDI,EDI</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]b0r3d0m[/b]','')">b0r3d0m</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 10.7 (новичок), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.14'>Активность: 0.06<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=37421">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 июня 2015 22:14 <br><script type="text/javascript">QU('b0r3d0m','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=b0r3d0m" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23624.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Приветствую.<br><br>Почему реализация всех WinAPI-функций начинается с инструкции MOV EDI,EDI?<br><br>В интернете (например, <noindex><a href="http://blogs.msdn.com/b/oldnewthing/archive/2011/09/21/10214405.aspx" rel="nofollow" target="_blank">тут</a></noindex>) это объясняется тем, что данная инструкция позволяет написать двух-байтовый патч в виде JMP &#036;-5, чтобы передать управление коду, который находится на пять байт раньше начала пропатченной WinAPI-функции. Но почему нельзя обойтись без MOV EDI,EDI и заменить JMP&#039;ом другие инструкции?<br><br>Вот, допустим, есть функция CreateFileA. Начало её реализации на моей системе имеет следующий вид:<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_number">77701036</span>&nbsp;<span class="hl_char">&gt;</span>&nbsp;&nbsp;<span class="hl_number">8BFF</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>MOV</b></span>&nbsp;<span class="hl_registr">EDI</span><span class="hl_char">,</span><span class="hl_registr">EDI</span></li><li class="hl_l1"><span class="hl_number">77701038</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;<span class="hl_registr">EBP</span></li><li class="hl_l0"><span class="hl_number">77701039</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">8BEC</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>MOV</b></span>&nbsp;<span class="hl_registr">EBP</span><span class="hl_char">,</span><span class="hl_registr">ESP</span></li><li class="hl_l1"><span class="hl_number">7770103B</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">51</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;<span class="hl_registr">ECX</span></li><li class="hl_l0"><span class="hl_number">7770103C</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">51</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;<span class="hl_registr">ECX</span></li><li class="hl_l1"><span class="hl_number">7770103D</span>&nbsp;&nbsp;&nbsp;&nbsp;FF75&nbsp;<span class="hl_number">08</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_function"><b>PTR</b></span>&nbsp;<span class="hl_registr">SS</span><span class="hl_char">:</span><span class="hl_char">[</span><span class="hl_registr">EBP</span><span class="hl_char">+</span><span class="hl_number">8</span><span class="hl_char">]</span></li><li class="hl_l0"><span class="hl_number">77701040</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">8D45</span>&nbsp;F8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>LEA</b></span>&nbsp;<span class="hl_registr">EAX</span><span class="hl_char">,</span><span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_function"><b>PTR</b></span>&nbsp;<span class="hl_registr">SS</span><span class="hl_char">:</span><span class="hl_char">[</span><span class="hl_registr">EBP</span><span class="hl_char">-</span><span class="hl_number">8</span><span class="hl_char">]</span></li>        </ol>
    </div>
</div></div>
<br><br>В результате патчинга JMP&#039;ом с относительным адресом я затру первые три инструкции (MOV EDI, PUSH EBP и MOV EBP,ESP). Но что было бы плохого, если бы тут не было инструкции MOV EDI,EDI? Ну, затёр бы я тогда ещё два PUSH ECX, что в этом такого? Или это сделано, чтобы можно было пропатчить даже те функции, у которых реализация занимает ровно пять байт вместе с этим MOV EDI,EDI? Но даже если так, WinAPI-функции всё равно разделяются между собой NOP&#039;ами, так что проблем с этим быть не должно.<br><br>И ещё один момент, связанный с перехватом вызовов WinAPI-функций путём как раз подобного патча. На <noindex><a href="https://en.wikipedia.org/wiki/Hooking#API.2FFunction_Hooking.2FInterception_Using_JMP_Instruction" rel="nofollow" target="_blank">вики</a></noindex> предлагается следующий вариант реализации подобной техники:<br><br><code> void BeginRedirect(LPVOID newFunction)  <br> {  <br>   BYTE tempJMP[SIZE] = {0xE9, 0x90, 0x90, 0x90, 0x90, 0xC3};         // 0xE9 = JMP 0x90 = NOP oxC3 = RET<br>   memcpy(JMP, tempJMP, SIZE);                                        // store jmp instruction to JMP<br>   DWORD JMPSize = ((DWORD)newFunction - (DWORD)pOrigMBAddress - 5);  // calculate jump distance<br>   VirtualProtect((LPVOID)pOrigMBAddress, SIZE,                       // assign read write protection<br>           PAGE_EXECUTE_READWRITE, &amp;oldProtect);  <br>   memcpy(oldBytes, pOrigMBAddress, SIZE);                            // make backup<br>   memcpy(&amp;JMP[1], &amp;JMPSize, 4);                              // fill the nop&#039;s with the jump distance (JMP,distance(4bytes),RET)<br>   memcpy(pOrigMBAddress, JMP, SIZE);                                 // set jump instruction at the beginning of the original function<br>   VirtualProtect((LPVOID)pOrigMBAddress, SIZE, oldProtect, NULL);    // reset protection<br> }<br> <br> int WINAPI MyMessageBoxW(HWND hWnd, LPCWSTR lpText, LPCWSTR lpCaption, UINT uiType)  <br> {  <br>   VirtualProtect((LPVOID)pOrigMBAddress, SIZE, myProtect, NULL);     // assign read write protection<br>   memcpy(pOrigMBAddress, oldBytes, SIZE);                            // restore backup<br>   int retValue = MessageBoxW(hWnd, lpText, lpCaption, uiType);       // get return value of original function<br>   memcpy(pOrigMBAddress, JMP, SIZE);                                 // set the jump instruction again<br>   VirtualProtect((LPVOID)pOrigMBAddress, SIZE, oldProtect, NULL);    // reset protection<br>   return retValue;                                                   // return original return value<br> }</code><br><br>Скажите, пожалуйста, зачем после JMP&#039;а они предлагают писать инструкцию RET? Ведь это же безусловный переход на нашу функцию, внутри которой мы вернём оригинальный код WinAPI-функции обратно, и никогда не попадём на этот самый RET. Какой в этом смысл?<br><br>Заранее благодарю за возможные ответы.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=356259&amp;user=37421&amp;forum_n=5&amp;topic=23624.html&amp;page=0&amp;anchor=1" class="addthx" data-post="356259"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]plutos[/b]','')">plutos</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/4773.png" alt=""><br><span class=txtSm>Ранг: 622.6 (<b>!</b>), 521thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.16'>Активность: 0.33<span style='color:green'>&nearr;</span>0.89</span><br>Статус: <a href="action=userinfo&amp;user=4773">Участник</a><br><font color=blue>_Вечный_Студент_</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 июня 2015 22:46 &middot; Поправил: plutos <br><script type="text/javascript">QU('plutos','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=plutos" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23624.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
Читаем тут, может поможет:<br>http://blogs.msdn.com/b/oldnewthing/archive/2011/09/21/10214405.aspx
<br><br><font size="1"><i>-----<br>Give me a HANDLE and I will move the Earth.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=356261&amp;user=4773&amp;forum_n=5&amp;topic=23624.html&amp;page=0&amp;anchor=2" class="addthx" data-post="356261"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]b0r3d0m[/b]','')">b0r3d0m</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 10.7 (новичок), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.14'>Активность: 0.06<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=37421">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 июня 2015 22:50 <br><script type="text/javascript">QU('b0r3d0m','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=b0r3d0m" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23624.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
<I>plutos пишет:<br>Читаем тут, может поможет:<br>http://blogs.msdn.com/b/oldnewthing/archive/2011/09/21/10214405.aspx  </I><br>Так я же и скинул ссылку на эту статью. Собственно, я про неё и написал в начале следующее:<br>&gt; В интернете (например, тут) это объясняется тем, что данная инструкция позволяет написать двух-байтовый патч в виде JMP &#036;-5, чтобы передать управление коду, который находится на пять байт раньше начала пропатченной WinAPI-функции. Но почему нельзя обойтись без MOV EDI,EDI и заменить JMP&#039;ом другие инструкции?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=356262&amp;user=37421&amp;forum_n=5&amp;topic=23624.html&amp;page=0&amp;anchor=3" class="addthx" data-post="356262"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]hello[/b]','')">hello</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 20.4 (новичок), 8thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.25'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=37163">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 июня 2015 23:01 <br><script type="text/javascript">QU('hello','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=hello" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23624.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
<I>b0r3d0m пишет:<br> Но почему нельзя обойтись без MOV EDI,EDI и заменить JMP&#039;ом другие инструкции? </I><br>В смысле, первые инструкции, после MOV EDI, EDI? Так ведь их эмулить придется после выполнения перехвата. А так - имеем инструкцию-пустышку, которая не нужна целевой функции. Это, вроде,  очевидно!<br><I>b0r3d0m пишет:<br> WinAPI-функции всё равно разделяются между собой NOP&#039;ами, так что проблем с этим быть не должно. </I><br>nop для выравнивания, и это уже другой район, который не относиться к хукам. Правда, годный для использования.<br><I>b0r3d0m пишет:<br> зачем после JMP&#039;а они предлагают писать инструкцию RET?  </I><br>А вдруг CPU заглючит и переход безусловный не сработает <img src="img/smilies/s1.gif" alt=""> Мощности хватит, чтоб на следующую инструкцию прыгнуть <img src="img/smilies/s3.gif" alt=""> Вон, после ExitThread, инструкция int3 стоит. А по хорошему: может туда управление, в конце концов передается.<br><br>Я бы по другому поставил вопрос еще: смысл в таких &quot;паразитных&quot; инструкциях, как MOV EDI, EDI. Положить регистр сам в себя?! Бессмысленно и беспощадно.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=356265&amp;user=37163&amp;forum_n=5&amp;topic=23624.html&amp;page=0&amp;anchor=4" class="addthx" data-post="356265"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]b0r3d0m[/b]','')">b0r3d0m</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 10.7 (новичок), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.14'>Активность: 0.06<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=37421">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 июня 2015 23:07 <br><script type="text/javascript">QU('b0r3d0m','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=b0r3d0m" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23624.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
<I>hello пишет:<br>Так ведь их эмулить придется после выполнения перехвата </I><br>Зачем? Вот, допустим, в том же примере с вики после выполнения безусловного перехода на нашу функцию мы просто возвращаем изначальные байты оригинальной функции обратно и вызываем её снова.<br><br><I>hello пишет:<br>nop для выравнивания, и это уже другой район, который не относиться к хукам </I><br>Но ведь использовать же их можно, верно?<br><br><I>hello пишет:<br>А по хорошему: может туда управление, в конце концов передается </I><br>Каким образом? Там выполняется безусловный переход с последующим восстановлением оригинального кода перехваченной WinAPI-функции, так что не вижу такой возможности.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=356268&amp;user=37421&amp;forum_n=5&amp;topic=23624.html&amp;page=0&amp;anchor=5" class="addthx" data-post="356268"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]plutos[/b]','')">plutos</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/4773.png" alt=""><br><span class=txtSm>Ранг: 622.6 (<b>!</b>), 521thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.16'>Активность: 0.33<span style='color:green'>&nearr;</span>0.89</span><br>Статус: <a href="action=userinfo&amp;user=4773">Участник</a><br><font color=blue>_Вечный_Студент_</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 июня 2015 23:13 &middot; Поправил: plutos <br><script type="text/javascript">QU('plutos','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=plutos" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23624.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
<I>b0r3d0m пишет:<br>Собственно, я про неё и написал в начале следующее:&gt; В интернете (например, тут) это объясняется тем, что данная инструкция позволяет написать двух-байтовый патч в виде JMP &#036;-5, чтобы передать управление коду, который находится на пять байт раньше начала пропатченной WinAPI-функции. Но почему нельзя обойтись без MOV EDI,EDI и заменить JMP&#039;ом другие инструкции? </I><br><br>Ну извините, не догадался, что это именно о ней идет речь. Оно как-то не очевидно.<br>А самой ссылки не видал. Теперь вижу.
<br><br><font size="1"><i>-----<br>Give me a HANDLE and I will move the Earth.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=356271&amp;user=4773&amp;forum_n=5&amp;topic=23624.html&amp;page=0&amp;anchor=6" class="addthx" data-post="356271"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]b0r3d0m[/b]','')">b0r3d0m</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 10.7 (новичок), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.14'>Активность: 0.06<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=37421">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 июня 2015 23:16 <br><script type="text/javascript">QU('b0r3d0m','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=b0r3d0m" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23624.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
<I>plutos пишет:<br>Ну извините, не догадался, что это именно о ней идет речь </I><br>Я ссылку привёл. Ну да ладно, это не важно. В любом случае, спасибо. Сможете, пожалуйста, ответить на вопросы, обозначенные в теме?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=356272&amp;user=37421&amp;forum_n=5&amp;topic=23624.html&amp;page=0&amp;anchor=7" class="addthx" data-post="356272"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]dosprog[/b]','')">dosprog</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 431.7 (мудрец), 391thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.95'>Активность: 0.73<span style='color:red'>&searr;</span>0.32</span><br>Статус: <a href="action=userinfo&amp;user=35473">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 июня 2015 23:16 &middot; Поправил: dosprog <br><script type="text/javascript">QU('dosprog','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=dosprog" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23624.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
<I>hello пишет:<br>Я бы по другому поставил вопрос еще: смысл в таких &quot;паразитных&quot; инструкциях, как MOV EDI, EDI. </I><br><br>Если использовать заполнение обычными NOP, то очевидна &quot;неэффективность&quot; полученного года, видимая &quot;невооружённым&quot; глазом в обычном текстовом редакторе. А так код выглядит солидно, да и дополнительная возможность для проверки сигнатуры.<br><br>Вообще, такие вопросы сродни интересу к сигнатуре &quot;MZ&quot; - &quot;почему-да-как?&quot;.<br>Изначально сделали так, а потом изменять это не было нужды.<br><i class=x><br></i>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=356273&amp;user=35473&amp;forum_n=5&amp;topic=23624.html&amp;page=0&amp;anchor=8" class="addthx" data-post="356273"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]b0r3d0m[/b]','')">b0r3d0m</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 10.7 (новичок), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.14'>Активность: 0.06<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=37421">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 июня 2015 23:19 &middot; Поправил: b0r3d0m <br><script type="text/javascript">QU('b0r3d0m','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=b0r3d0m" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23624.html&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
<I>dosprog пишет:<br>Если использовать заполнение обычными NOP, то очевидна &quot;неэффективность&quot; полученного года, видимая &quot;невооружённым&quot; глазом в обычном текстовом редакторе </I><br>&gt;  Why not just use two NOP instructions at the entry point?<br><br>Well, because a NOP instruction consumes one clock cycle and one pipe, so two of them would consume two clock cycles and two pipes. (The instructions will likely be paired, one in each pipe, so the combined execution will take one clock cycle.) On the other hand, the MOV EDI, EDI instruction consumes one clock cycle and one pipe. (In practice, the instruction will occupy one pipe, leaving the other available to execute another instruction in parallel. You might say that the instruction executes in half a cycle.) However you calculate it, the MOV EDI, EDI instruction executes in half the time of two NOP instructions<br><br><I>dosprog пишет:<br>Вообще, такие вопросы сродни интересу к сигнатуре &quot;MZ&quot; - &quot;почему-да-как?&quot;.<br>Изначально сделали так, а потом изменять это не было нужды. </I><br>Вопрос возник из-за необходимости патчить несколько интересующих меня WinAPI-функций. Наткнулся, погуглил, не понял причину, решил спросить, чтобы случайно не облажаться на ровном месте.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=356274&amp;user=37421&amp;forum_n=5&amp;topic=23624.html&amp;page=0&amp;anchor=9" class="addthx" data-post="356274"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]hello[/b]','')">hello</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 20.4 (новичок), 8thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.25'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=37163">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 июня 2015 23:20 <br><script type="text/javascript">QU('hello','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=hello" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23624.html&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
<I>b0r3d0m пишет:<br> просто возвращаем изначальные байты  </I><br>Ну это один из вариантов. Можно и так! Но если первая MOV EDI, EDI -тогда ничего не нужно восстанавливать и эмулировать.<br><I>b0r3d0m пишет:<br>использовать же их можно </I><br>Там обычно мизер остаетс.  Впрочем, вроде слышал, что в некоторых библиотеках такой подход встречается. Но не у микрософт. Если поставить громадное выравнивание в байт 16, тогда наверняка можно.<br>Но это всё дело вкуса.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=356275&amp;user=37163&amp;forum_n=5&amp;topic=23624.html&amp;page=0&amp;anchor=10" class="addthx" data-post="356275"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]Maximus[/b]','')">Maximus</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/2775.jpg" alt=""><br><span class=txtSm>Ранг: 392.8 (мудрец), 108thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.75'>Активность: 0.26<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=2775">Участник</a><br><font color=blue>REVENGE сила, БеХоЦе могила</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 июня 2015 23:21 <br><script type="text/javascript">QU('Maximus','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Maximus" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23624.html&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
Так по ссылке написано почему mov edi, edi, а не nop<br><br>Потому что на два nop надо два такта процессора, а на mov edi, edi один.<br><br>А вообще приведенный способ патча в шапке действительно какой-то извращенный.
<br><br><font size="1"><i>-----<br>StarForce и Themida ацтой!</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=356276&amp;user=2775&amp;forum_n=5&amp;topic=23624.html&amp;page=0&amp;anchor=11" class="addthx" data-post="356276"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]b0r3d0m[/b]','')">b0r3d0m</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 10.7 (новичок), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.14'>Активность: 0.06<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=37421">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 июня 2015 23:22 <br><script type="text/javascript">QU('b0r3d0m','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=b0r3d0m" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23624.html&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
<I>Maximus пишет:<br>А вообще приведенный способ патча в шапке действительно какой-то извращенный </I><br>А что с ним не так?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=356277&amp;user=37421&amp;forum_n=5&amp;topic=23624.html&amp;page=0&amp;anchor=12" class="addthx" data-post="356277"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]Maximus[/b]','')">Maximus</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/2775.jpg" alt=""><br><span class=txtSm>Ранг: 392.8 (мудрец), 108thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.75'>Активность: 0.26<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=2775">Участник</a><br><font color=blue>REVENGE сила, БеХоЦе могила</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 июня 2015 23:25 <br><script type="text/javascript">QU('Maximus','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Maximus" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23624.html&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
Я ссылку на перехват:<br>jmp моя процедура<br>jmp -5<br>Начало реальной процедуры<br><br>делаю через WriteProcessMemory с ProcessID = -1
<br><br><font size="1"><i>-----<br>StarForce и Themida ацтой!</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=356278&amp;user=2775&amp;forum_n=5&amp;topic=23624.html&amp;page=0&amp;anchor=13" class="addthx" data-post="356278"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=37421" title="17-06-2015 20:31, ранг:6.9" target="_blank">b0r3d0m</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]hello[/b]','')">hello</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 20.4 (новичок), 8thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.25'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=37163">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 июня 2015 23:27 <br><script type="text/javascript">QU('hello','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=hello" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23624.html&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
<I>dosprog пишет:<br>использовать заполнение обычными NOP, то очевидна &quot;неэффективность </I><br>Можно было придумать инструкцию типа &quot;Double NOP&quot; (естественно, выделить два байта под неё)
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=356279&amp;user=37163&amp;forum_n=5&amp;topic=23624.html&amp;page=0&amp;anchor=14" class="addthx" data-post="356279"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]Maximus[/b]','')">Maximus</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/2775.jpg" alt=""><br><span class=txtSm>Ранг: 392.8 (мудрец), 108thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.75'>Активность: 0.26<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=2775">Участник</a><br><font color=blue>REVENGE сила, БеХоЦе могила</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 июня 2015 23:28 <br><script type="text/javascript">QU('Maximus','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Maximus" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23624.html&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
А в процедуре MyMessageBoxW необязательно байты возвращать, достаточно выполнить процедуру со следующих байт идущих за jmp -5
<br><br><font size="1"><i>-----<br>StarForce и Themida ацтой!</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=356280&amp;user=2775&amp;forum_n=5&amp;topic=23624.html&amp;page=0&amp;anchor=15" class="addthx" data-post="356280"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]b0r3d0m[/b]','')">b0r3d0m</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 10.7 (новичок), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.14'>Активность: 0.06<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=37421">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 июня 2015 23:28 <br><script type="text/javascript">QU('b0r3d0m','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=b0r3d0m" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23624.html&amp;page=0#16');return false;">#16</a> </span><div align=left><br>
<I>Maximus пишет:<br>Я ссылку на перехват </I><br>Ну, т.е. Вы о том, что возвращать обратно изначальную реализацию нет особой необходимости в таком случае, да?<br><br><I>hello пишет:<br>Но если первая MOV EDI, EDI -тогда ничего не нужно восстанавливать и эмулировать </I><br>Да, но только в том случае, если мы уместим наш JMP в два байта, что можно сделать только в ситуациях, подобных JMP &#036;-5, что Вас же и не устраивает:<br>&gt; Там обычно мизер остаетс. Впрочем, вроде слышал, что в некоторых библиотеках такой подход встречается. Но не у микрософт
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=356281&amp;user=37421&amp;forum_n=5&amp;topic=23624.html&amp;page=0&amp;anchor=16" class="addthx" data-post="356281"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]dosprog[/b]','')">dosprog</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 431.7 (мудрец), 391thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.95'>Активность: 0.73<span style='color:red'>&searr;</span>0.32</span><br>Статус: <a href="action=userinfo&amp;user=35473">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 июня 2015 23:30 &middot; Поправил: dosprog <br><script type="text/javascript">QU('dosprog','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=dosprog" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23624.html&amp;page=0#17');return false;">#17</a> </span><div align=left><br>
<I>b0r3d0m пишет:<br>чтобы случайно не облажаться на ровном месте.<br> </I><br>Надо пробовать. Облажаетесь - вернёте всё на место.<br><i class=x><br></i>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=356282&amp;user=35473&amp;forum_n=5&amp;topic=23624.html&amp;page=0&amp;anchor=17" class="addthx" data-post="356282"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=37421" title="17-06-2015 20:35, ранг:6.9" target="_blank">b0r3d0m</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]b0r3d0m[/b]','')">b0r3d0m</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 10.7 (новичок), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.14'>Активность: 0.06<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=37421">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 июня 2015 23:31 <br><script type="text/javascript">QU('b0r3d0m','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=b0r3d0m" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23624.html&amp;page=0#18');return false;">#18</a> </span><div align=left><br>
<I>hello пишет:<br>Можно было придумать инструкцию типа &quot;Double NOP&quot; (естественно, выделить два байта под неё)  </I><br>А зачем? Тот же NOP не сильно от MOV EDI,EDI отличается, т.к. он, по сути, является синонимом для XCHG EAX,EAX или XCHG AX,AX.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=356283&amp;user=37421&amp;forum_n=5&amp;topic=23624.html&amp;page=0&amp;anchor=18" class="addthx" data-post="356283"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]Maximus[/b]','')">Maximus</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/2775.jpg" alt=""><br><span class=txtSm>Ранг: 392.8 (мудрец), 108thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.75'>Активность: 0.26<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=2775">Участник</a><br><font color=blue>REVENGE сила, БеХоЦе могила</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 июня 2015 23:32 <br><script type="text/javascript">QU('Maximus','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Maximus" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23624.html&amp;page=0#19');return false;">#19</a> </span><div align=left><br>
<I>Ну, т.е. Вы о том, что возвращать обратно изначальную реализацию нет особой необходимости в таком случае, да?</I><br><br>Да, достаточно получить адрес процедуры MessageBox и прибавить к этому адресу 2 (пропускаем jmp-5) и каждый раз возвращать процедуру в исходное состояние не нужно.
<br><br><font size="1"><i>-----<br>StarForce и Themida ацтой!</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=356284&amp;user=2775&amp;forum_n=5&amp;topic=23624.html&amp;page=0&amp;anchor=19" class="addthx" data-post="356284"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="20" onfocus="this.blur()" href="JavaScript:di('[b]b0r3d0m[/b]','')">b0r3d0m</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 10.7 (новичок), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.14'>Активность: 0.06<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=37421">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 июня 2015 23:35 <br><script type="text/javascript">QU('b0r3d0m','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=b0r3d0m" target="_blank">Личное сообщение</a> &middot;  <a href="#20" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23624.html&amp;page=0#20');return false;">#20</a> </span><div align=left><br>
<I>Maximus пишет:<br>Да, достаточно получить адрес процедуры MessageBox и прибавить к этому адресу 2 (пропускаем jmp-5) и каждый раз возвращать процедуру в исходное состояние не нужно </I><br>Спасибо. А RET после безусловного перехода для чего делался в изначальном примере, не подскажете?<br><br><I>dosprog пишет:<br>Надо пробовать. Облажаетесь - вернёте всё на место </I><br>Уже попробовал, просто было интересно, как и почему лучше делать.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=356285&amp;user=37421&amp;forum_n=5&amp;topic=23624.html&amp;page=0&amp;anchor=20" class="addthx" data-post="356285"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="21" onfocus="this.blur()" href="JavaScript:di('[b]Maximus[/b]','')">Maximus</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/2775.jpg" alt=""><br><span class=txtSm>Ранг: 392.8 (мудрец), 108thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.75'>Активность: 0.26<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=2775">Участник</a><br><font color=blue>REVENGE сила, БеХоЦе могила</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 июня 2015 23:43 &middot; Поправил: Maximus <br><script type="text/javascript">QU('Maximus','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Maximus" target="_blank">Личное сообщение</a> &middot;  <a href="#21" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23624.html&amp;page=0#21');return false;">#21</a> </span><div align=left><br>
<I>А RET после безусловного перехода для чего делался в изначальном примере, не подскажете?</I><br><br>Не подскажу. Но скажу, что этот пример не для конструкции<br>nop<br>nop<br>nop<br>nop<br>nop<br>mov edi,edi<br><br>Пример сделан для jmp который затирает первые байты перехватываемой процедуры.
<br><br><font size="1"><i>-----<br>StarForce и Themida ацтой!</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=356286&amp;user=2775&amp;forum_n=5&amp;topic=23624.html&amp;page=0&amp;anchor=21" class="addthx" data-post="356286"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="22" onfocus="this.blur()" href="JavaScript:di('[b]b0r3d0m[/b]','')">b0r3d0m</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 10.7 (новичок), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.14'>Активность: 0.06<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=37421">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 июня 2015 23:45 <br><script type="text/javascript">QU('b0r3d0m','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=b0r3d0m" target="_blank">Личное сообщение</a> &middot;  <a href="#22" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23624.html&amp;page=0#22');return false;">#22</a> </span><div align=left><br>
<I>Maximus пишет:<br>Но скажу, что этот пример не для конструкции </I><br>Да, это я понял. В любом случае, спасибо.<br><br>Может, поможете с ответами в другой теме -- https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23620?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=356287&amp;user=37421&amp;forum_n=5&amp;topic=23624.html&amp;page=0&amp;anchor=22" class="addthx" data-post="356287"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="23" onfocus="this.blur()" href="JavaScript:di('[b]Maximus[/b]','')">Maximus</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/2775.jpg" alt=""><br><span class=txtSm>Ранг: 392.8 (мудрец), 108thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.75'>Активность: 0.26<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=2775">Участник</a><br><font color=blue>REVENGE сила, БеХоЦе могила</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 июня 2015 23:53 <br><script type="text/javascript">QU('Maximus','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Maximus" target="_blank">Личное сообщение</a> &middot;  <a href="#23" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23624.html&amp;page=0#23');return false;">#23</a> </span><div align=left><br>
Я не знаю что сказать по той теме. Скажу только что в своих прогах, в которых надо переловить апи я сначала делаю поиск в kernelbase, и если возвращает ноль (к примеру на XP), то ищу функу в kernel32. Это полностью решает проблемы с совместимостью.
<br><br><font size="1"><i>-----<br>StarForce и Themida ацтой!</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=356289&amp;user=2775&amp;forum_n=5&amp;topic=23624.html&amp;page=0&amp;anchor=23" class="addthx" data-post="356289"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/nub.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=5&sortBy=0&page=0.html"><b>Вопросы новичков</b></a> <b class=bulletHead>&#8212;&#8250;</b> Зачем нужна инструкция MOV EDI,EDI</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#24" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="5">
<input type="hidden" name="topic" value="23624">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=23624" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
