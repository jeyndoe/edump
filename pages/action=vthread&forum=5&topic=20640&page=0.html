<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Как научить видеть игру широкоформатные мониторы? - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Здравствуйте. Нашёл CD древней игрушки, но после установки, заметил, что разработчики ограничились только самыми распространёнными разрешениями экрана. Возможно ли сделать каким-либо образом поддержку 1366х768, 1920х1080?">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=28016'>asfa</a>, <a target='_blank' href='?action=userinfo&amp;user=8605'>Rio</a>, <a target='_blank' href='?action=userinfo&amp;user=41701'>_MBK_</a>, <a target='_blank' href='?action=userinfo&amp;user=41144'>Adler</a> (+8 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/nub.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=5&sortBy=0&page=0.html"><b>Вопросы новичков</b></a> <b class=bulletHead>&#8212;&#8250;</b> Как научить видеть игру широкоформатные мониторы?</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> .  <b>1</b> . <a href="action=vthread&amp;forum=5&amp;topic=20640&amp;page=1.html">2</a> . <a href="action=vthread&amp;forum=5&amp;topic=20640&amp;page=2.html">3</a> . <a href="action=vthread&amp;forum=5&amp;topic=20640&amp;page=1.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]aspirin[/b]','')">aspirin</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/5336.gif" alt=""><br><span class=txtSm>Ранг: 111.0 (ветеран), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.05'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=5336">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 декабря 2012 19:07 <br><script type="text/javascript">QU('aspirin','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=aspirin" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=20640&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Здравствуйте. Нашёл  CD древней игрушки, но после установки, заметил, что разработчики ограничились только самыми распространёнными разрешениями экрана. Возможно ли сделать каким-либо образом поддержку 1366х768, 1920х1080? Прикладываю файлы кинфигуратора разрешения.<br><br>пароль: exelab<br><br><img src="img/attach.gif" alt=""> <a href="./files/4272_23.12.2012_EXELAB.rU.tgz">4272_23.12.2012_EXELAB.rU.tgz</a> - p3.rar
<br><br><font size="1"><i>-----<br>Ламер - не профессия :))</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=316069&amp;user=5336&amp;forum_n=5&amp;topic=20640&amp;page=0&amp;anchor=1" class="addthx" data-post="316069"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]Mishar_Hacker[/b]','')">Mishar_Hacker</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 88.2 (постоянный), 58thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 8.11'>Активность: 0.11<span style='color:red'>&searr;</span>0.04</span><br>Статус: <a href="action=userinfo&amp;user=32157">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 декабря 2012 21:17 <br><script type="text/javascript">QU('Mishar_Hacker','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Mishar_Hacker" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=20640&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
Вот один из известных патчеров для игр с маленьким разрешением<br><br><br><img src="img/attach.gif" alt=""> <a href="./files/6efb_23.12.2012_EXELAB.rU.tgz">6efb_23.12.2012_EXELAB.rU.tgz</a> - Mishar.zip
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=316072&amp;user=32157&amp;forum_n=5&amp;topic=20640&amp;page=0&amp;anchor=2" class="addthx" data-post="316072"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]aspirin[/b]','')">aspirin</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/5336.gif" alt=""><br><span class=txtSm>Ранг: 111.0 (ветеран), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.05'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=5336">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 декабря 2012 21:24 <br><script type="text/javascript">QU('aspirin','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=aspirin" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=20640&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
<b>Mishar_Hacker</b><br>Игра называется Patrician 3, тут такой нет.
<br><br><font size="1"><i>-----<br>Ламер - не профессия :))</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=316073&amp;user=5336&amp;forum_n=5&amp;topic=20640&amp;page=0&amp;anchor=3" class="addthx" data-post="316073"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]Mishar_Hacker[/b]','')">Mishar_Hacker</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 88.2 (постоянный), 58thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 8.11'>Активность: 0.11<span style='color:red'>&searr;</span>0.04</span><br>Статус: <a href="action=userinfo&amp;user=32157">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 декабря 2012 23:24 <br><script type="text/javascript">QU('Mishar_Hacker','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Mishar_Hacker" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=20640&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
<b>aspirin</b><br>Я тебе пример дал как сделать))
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=316078&amp;user=32157&amp;forum_n=5&amp;topic=20640&amp;page=0&amp;anchor=4" class="addthx" data-post="316078"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]aspirin[/b]','')">aspirin</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/5336.gif" alt=""><br><span class=txtSm>Ранг: 111.0 (ветеран), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.05'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=5336">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 декабря 2012 23:36 <br><script type="text/javascript">QU('aspirin','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=aspirin" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=20640&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
<b>Mishar_Hacker</b><br>В этом примере для каждой игры есть &quot;sig=&quot;, как мне найти для моего .ехе?
<br><br><font size="1"><i>-----<br>Ламер - не профессия :))</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=316079&amp;user=5336&amp;forum_n=5&amp;topic=20640&amp;page=0&amp;anchor=5" class="addthx" data-post="316079"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]Mishar_Hacker[/b]','')">Mishar_Hacker</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 88.2 (постоянный), 58thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 8.11'>Активность: 0.11<span style='color:red'>&searr;</span>0.04</span><br>Статус: <a href="action=userinfo&amp;user=32157">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 декабря 2012 23:56 <br><script type="text/javascript">QU('Mishar_Hacker','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Mishar_Hacker" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=20640&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
так давай на примере nfs underground 2 (не смейтесь бывает играю)<br><noindex><a href="http://rghost.ru/42465592" rel="nofollow" target="_blank">exe</a></noindex><br>Вот и ищи примерно<br>Больше вариантов нет<br>пока что
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=316080&amp;user=32157&amp;forum_n=5&amp;topic=20640&amp;page=0&amp;anchor=6" class="addthx" data-post="316080"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]Hexxx[/b]','')">Hexxx</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 481.4 (мудрец), 109thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.37'>Активность: 0.18<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=10168">Участник</a><br><font color=blue>Тот самый :)</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 24 декабря 2012 15:46 <br><script type="text/javascript">QU('Hexxx','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Hexxx" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=20640&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
<I>Mishar_Hacker пишет:<br>так давай на примере nfs underground 2 (не смейтесь бывает играю) </I><br>Мне тоже интересен этот вопрос. Потому что это делается зачастую нетривиально, особенно если дело касается игр на DirectX. Просто патчем цифирок отвечающих за разрешение экрана, дело необходится.
<br><br><font size="1"><i>-----<br>Реверсивная инженерия - написание кода идентичного натуральному</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=316122&amp;user=10168&amp;forum_n=5&amp;topic=20640&amp;page=0&amp;anchor=7" class="addthx" data-post="316122"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]Runner[/b]','')">Runner</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 10.1 (новичок), 5thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.73'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=26669">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 24 декабря 2012 15:58 &middot; Поправил: Runner <br><script type="text/javascript">QU('Runner','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Runner" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=20640&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
Встречал вот <noindex><a href="http://www.sukhoi.ru/forum/showthread.php?t=32751" rel="nofollow" target="_blank">--&gt; такое вот &lt;--</a></noindex> &quot;универсальное&quot; (т.е. как повезет) решение проблемы с разрешением.<br><br>&quot;This DLL attempts to override the screen resolution set <br>by a Direct3D 9 program.&quot;
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=316126&amp;user=26669&amp;forum_n=5&amp;topic=20640&amp;page=0&amp;anchor=8" class="addthx" data-post="316126"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]Gideon Vi[/b]','')">Gideon Vi</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/2585.jpg" alt=""><br><span class=txtSm>Ранг: 1131.7 <b><u>(!!!!)</u></b>, 447thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.83'>Активность: 0.67<span style='color:red'>&searr;</span>0.2</span><br>Статус: <a href="action=userinfo&amp;user=2585">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 24 декабря 2012 17:20 &middot; Поправил: Gideon Vi <br><script type="text/javascript">QU('Gideon Vi','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Gideon Vi" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=20640&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
<I>aspirin пишет:<br>Возможно ли сделать каким-либо образом поддержку 1366х768, 1920х1080? </I><br><br>во многих играх будут проблемы со шрифтами.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=316130&amp;user=2585&amp;forum_n=5&amp;topic=20640&amp;page=0&amp;anchor=9" class="addthx" data-post="316130"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]aspirin[/b]','')">aspirin</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/5336.gif" alt=""><br><span class=txtSm>Ранг: 111.0 (ветеран), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.05'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=5336">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 24 декабря 2012 18:39 &middot; Поправил: aspirin <br><script type="text/javascript">QU('aspirin','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=aspirin" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=20640&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
<I>Mishar_Hacker пишет:<br>так давай на примере nfs underground 2 (не смейтесь бывает играю) </I><br>Ну а чего там смеяться, кстати, одна из лучших игр серии. Думаете Patrician 3 будет новинкой?<img src="img/smilies/s1.gif" alt=""><br><b>Gideon Vi</b><br>предостережения не особо интересны <img src="img/smilies/s1.gif" alt=""><br>В каком направлении лучше всего искать решение?
<br><br><font size="1"><i>-----<br>Ламер - не профессия :))</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=316135&amp;user=5336&amp;forum_n=5&amp;topic=20640&amp;page=0&amp;anchor=10" class="addthx" data-post="316135"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]Veliant[/b]','')">Veliant</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 301.4 (мудрец), 194thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.62'>Активность: 0.17<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=3136">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 24 декабря 2012 18:59 <br><script type="text/javascript">QU('Veliant','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Veliant" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=20640&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
1) Перевести игру в оконный режим и играть на меньшем разрешении<br>2) Искать где создается viewport и сместить его в центр экрана, по краям оставляя черные полосы
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=316138&amp;user=3136&amp;forum_n=5&amp;topic=20640&amp;page=0&amp;anchor=11" class="addthx" data-post="316138"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]Mishar_Hacker[/b]','')">Mishar_Hacker</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 88.2 (постоянный), 58thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 8.11'>Активность: 0.11<span style='color:red'>&searr;</span>0.04</span><br>Статус: <a href="action=userinfo&amp;user=32157">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 24 декабря 2012 22:45 <br><script type="text/javascript">QU('Mishar_Hacker','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Mishar_Hacker" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=20640&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
<b>aspirin</b><br>Может на оф сайте программы есть исходник или манула
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=316151&amp;user=32157&amp;forum_n=5&amp;topic=20640&amp;page=0&amp;anchor=12" class="addthx" data-post="316151"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]tomac[/b]','')">tomac</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 65.3 (постоянный), 10thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.82'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=6470">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 декабря 2012 00:48 &middot; Поправил: tomac <br><script type="text/javascript">QU('tomac','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=tomac" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=20640&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
<b>aspirin</b><br>Выложи всю игрушку, искать именно твою версию неохота. <br>Выбиралка разрешений падает на тесте моего родного разрешения, хп 32бит сп3.<br><br>Я обучал NFS Carbon работать на 1600*900.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=316166&amp;user=6470&amp;forum_n=5&amp;topic=20640&amp;page=0&amp;anchor=13" class="addthx" data-post="316166"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]Mishar_Hacker[/b]','')">Mishar_Hacker</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 88.2 (постоянный), 58thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 8.11'>Активность: 0.11<span style='color:red'>&searr;</span>0.04</span><br>Статус: <a href="action=userinfo&amp;user=32157">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 декабря 2012 00:55 <br><script type="text/javascript">QU('Mishar_Hacker','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Mishar_Hacker" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=20640&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
<b>tomac</b><br>а у меня windows 8<br>тоже краш((
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=316170&amp;user=32157&amp;forum_n=5&amp;topic=20640&amp;page=0&amp;anchor=14" class="addthx" data-post="316170"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]aspirin[/b]','')">aspirin</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/5336.gif" alt=""><br><span class=txtSm>Ранг: 111.0 (ветеран), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.05'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=5336">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 декабря 2012 12:04 &middot; Поправил: aspirin <br><script type="text/javascript">QU('aspirin','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=aspirin" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=20640&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
<b>tomac</b>, <b>Mishar_Hacker</b><br><noindex><a href="http://narod.ru/disk/64799871001.a15f2db07352b0cef0d7aaf731e541ab/P3.rar.html" rel="nofollow" target="_blank">P3.rar</a></noindex><br>exelab
<br><br><font size="1"><i>-----<br>Ламер - не профессия :))</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=316187&amp;user=5336&amp;forum_n=5&amp;topic=20640&amp;page=0&amp;anchor=15" class="addthx" data-post="316187"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]tomac[/b]','')">tomac</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 65.3 (постоянный), 10thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.82'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=6470">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 декабря 2012 18:00 &middot; Поправил: tomac <br><script type="text/javascript">QU('tomac','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=tomac" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=20640&amp;page=0#16');return false;">#16</a> </span><div align=left><br>
Файл выложен на фтп: <noindex><a href="ftp://gurux13.no-ip.org/Patrician3.rar" rel="nofollow" target="_blank">--&gt; Link &lt;--</a></noindex><br>Тот, что на народе, битый.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=316209&amp;user=6470&amp;forum_n=5&amp;topic=20640&amp;page=0&amp;anchor=16" class="addthx" data-post="316209"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]aspirin[/b]','')">aspirin</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/5336.gif" alt=""><br><span class=txtSm>Ранг: 111.0 (ветеран), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.05'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=5336">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 декабря 2012 20:30 &middot; Поправил: aspirin <br><script type="text/javascript">QU('aspirin','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=aspirin" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=20640&amp;page=0#17');return false;">#17</a> </span><div align=left><br>
<b>tomac</b><br>Надо же, у меня у самого тот архив оказался битым, хотя и при упаковке добавил тестировать. В очередной раз доказательства того, что ничему не стоит слепо доверять. Проверяйте, отправил.
<br><br><font size="1"><i>-----<br>Ламер - не профессия :))</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=316216&amp;user=5336&amp;forum_n=5&amp;topic=20640&amp;page=0&amp;anchor=17" class="addthx" data-post="316216"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]tomac[/b]','')">tomac</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 65.3 (постоянный), 10thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.82'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=6470">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 декабря 2012 23:05 &middot; Поправил: tomac <br><script type="text/javascript">QU('tomac','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=tomac" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=20640&amp;page=0#18');return false;">#18</a> </span><div align=left><br>
Предварительный анализ показывает, что разрешения зашиты в код, в частности, в архивах есть переменные ObenLinks800Anim, ObenLinks1024Anim, ObenLinks1280Anim. Похоже, что на других разрешениях работать будет крайне криво, если вообще будет.<br><br>Покопаюсь потом еще.<br><br>Кстати, да, конфигуратор разрешения нифига не конфигурирует. Падал из-за недостатка какой-то либы, сейчас, с полным набором файлов, не падает.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=316225&amp;user=6470&amp;forum_n=5&amp;topic=20640&amp;page=0&amp;anchor=18" class="addthx" data-post="316225"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]JohnyDoe[/b]','')">JohnyDoe</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 105.6 (ветеран), 69thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 8.41'>Активность: 0.06<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=31402">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 декабря 2012 01:00 <br><script type="text/javascript">QU('JohnyDoe','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=JohnyDoe" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=20640&amp;page=0#19');return false;">#19</a> </span><div align=left><br>
Проворачивал подобный трюк с игрой Tank Race. Уже не помню что конкретно делал. Вроде как действовал так. Искал функцию для работы с режимами экрана в импорте. Вышел на switch в котором задавались параметры для разрешения экрана и поправил их на нужные. Вполне замечательно все работало вплодь до разрешения 1600x1200. Широкоформатные разрешения тоже делал и тоже все работало замечательно.<br><br>Может я конечно путаю что-то. Я все-таки дилетант в этом деле.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=316245&amp;user=31402&amp;forum_n=5&amp;topic=20640&amp;page=0&amp;anchor=19" class="addthx" data-post="316245"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="20" onfocus="this.blur()" href="JavaScript:di('[b]Rustem[/b]','')">Rustem</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 74.1 (постоянный), 34thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.41'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1301">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 декабря 2012 10:36 <br><script type="text/javascript">QU('Rustem','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Rustem" target="_blank">Личное сообщение</a> &middot;  <a href="#20" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=20640&amp;page=0#20');return false;">#20</a> </span><div align=left><br>
Делал перехватом ддрав/директикс<br><br>Обрабатывал в рантайме кадр (в принципе любой алгоритм можно, у меня масштабирование и сглаживание было),  потом рендерил<br><br><br>http://blackninja2000.narod.ru/rus/directx_logger.html
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=316266&amp;user=1301&amp;forum_n=5&amp;topic=20640&amp;page=0&amp;anchor=20" class="addthx" data-post="316266"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=2585" title="26-12-2012 15:04, ранг:843.9" target="_blank">Gideon Vi</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="21" onfocus="this.blur()" href="JavaScript:di('[b]Veliant[/b]','')">Veliant</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 301.4 (мудрец), 194thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.62'>Активность: 0.17<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=3136">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 декабря 2012 15:02 &middot; Поправил: Veliant <br><script type="text/javascript">QU('Veliant','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Veliant" target="_blank">Личное сообщение</a> &middot;  <a href="#21" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=20640&amp;page=0#21');return false;">#21</a> </span><div align=left><br>
Стоит смотреть начиная отсюда<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_number">0046373D</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;C705&nbsp;B4CD6E00&nbsp;<span class="hl_function"><b>MOV</b></span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_function"><b>PTR</b></span>&nbsp;<span class="hl_registr">DS</span><span class="hl_char">:</span><span class="hl_char">[</span><span class="hl_number">6ECDB4</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_number">258</span></li><li class="hl_l1"><span class="hl_number">00463747</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;C705&nbsp;B0CD6E00&nbsp;<span class="hl_function"><b>MOV</b></span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_function"><b>PTR</b></span>&nbsp;<span class="hl_registr">DS</span><span class="hl_char">:</span><span class="hl_char">[</span><span class="hl_number">6ECDB0</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_number">320</span></li>        </ol>
    </div>
</div></div>
<br>Это разрешение потом передается почти все функциям ddraw_dll. Но после выставления нужного фон рисуется под старое разрешение, а контролы со смещением. Нужно искать где пересчет идет.<br>Проще наверное все же сделать запуск игры в окне с меньшим разрешением. Там не directx, там gdi<br><br>Add:<br>Возможно стоит смотреть в сторону функции sgl_SetZoomFactor, которая вызывает функцию 05026050 с расчетами. Сама же sgl_SetZoomFactor вызывается перед каждой отрисовкой.<br><br>Add2: с установленным широкоформатным разрешением, но внутренним 1024x768 выглядит как-то так<br>http://rghost.ru/42525347/image.png
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=316283&amp;user=3136&amp;forum_n=5&amp;topic=20640&amp;page=0&amp;anchor=21" class="addthx" data-post="316283"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="22" onfocus="this.blur()" href="JavaScript:di('[b]Veliant[/b]','')">Veliant</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 301.4 (мудрец), 194thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.62'>Активность: 0.17<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=3136">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 декабря 2012 12:54 <br><script type="text/javascript">QU('Veliant','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Veliant" target="_blank">Личное сообщение</a> &middot;  <a href="#22" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=20640&amp;page=0#22');return false;">#22</a> </span><div align=left><br>
Навелосипедил пока следующим образом. Так и не разобрал до конца какие адреса еще участвуют в пересчете экранных координат<br><br>http://rghost.ru/42546882
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=316343&amp;user=3136&amp;forum_n=5&amp;topic=20640&amp;page=0&amp;anchor=22" class="addthx" data-post="316343"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="23" onfocus="this.blur()" href="JavaScript:di('[b]aspirin[/b]','')">aspirin</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/5336.gif" alt=""><br><span class=txtSm>Ранг: 111.0 (ветеран), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.05'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=5336">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 декабря 2012 14:54 <br><script type="text/javascript">QU('aspirin','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=aspirin" target="_blank">Личное сообщение</a> &middot;  <a href="#23" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=20640&amp;page=0#23');return false;">#23</a> </span><div align=left><br>
<I>Veliant пишет:<br>Навелосипедил пока следующим образом. Так и не разобрал до конца какие адреса еще участвуют в пересчете экранных координат<br>http://rghost.ru/42546882  </I><br>Попробовал, кроме рамки игры на чёрном фоне - работает.<br>dll такой вроде не было в папке с игрой, собственная разработка?<br>Не могли бы вы хоть в кратце объяснить, для чего нужна dll, и вообще свою технологию апгрейда игры?
<br><br><font size="1"><i>-----<br>Ламер - не профессия :))</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=316353&amp;user=5336&amp;forum_n=5&amp;topic=20640&amp;page=0&amp;anchor=23" class="addthx" data-post="316353"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="24" onfocus="this.blur()" href="JavaScript:di('[b]Veliant[/b]','')">Veliant</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 301.4 (мудрец), 194thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.62'>Активность: 0.17<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=3136">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 декабря 2012 18:09 <br><script type="text/javascript">QU('Veliant','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Veliant" target="_blank">Личное сообщение</a> &middot;  <a href="#24" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=20640&amp;page=0#24');return false;">#24</a> </span><div align=left><br>
Идея собственно в том чтоб при создании окна и вызова функций sgl_InitScreen и sgl_SetScreenDimension передавать разрешение нативное, после их отработки возвращается старое внутреннее разрешение.<br>В dll ставится veh обработчик и в нужные места программы ставятся hw бряки на которых и происходит подмена.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=316369&amp;user=3136&amp;forum_n=5&amp;topic=20640&amp;page=0&amp;anchor=24" class="addthx" data-post="316369"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="25" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 221thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 декабря 2012 09:59 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#25" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=20640&amp;page=0#25');return false;">#25</a> </span><div align=left><br>
С согласия автора топика, выкладываю обещанный свой вариант.<br><br>Первое, что нужно сделать - написать прокладку и вставить в код исполняемого файла игрушки её загрузку. Под прокладкой имеется ввиду dll, которая хучит нужные функции. Опущу подробности как это делать, поскольку об этом много раз писалось. Сосредоточусь на реализации самой прокладки.<br><br>Нам требуется изменить видео режим. Поскольку игрушка старая, то вряд ли в ней используется Direct3D, используется DirectDraw версий от 1 до 4, 7-ой скорей всего ещё и не было. Функция в DirectDraw, которая меняет видео режим - IDirectDraw::SetDisplayMode. Её описание можно найти <noindex><a href="http://msdn.microsoft.com/en-us/library/aa915192.aspx" rel="nofollow" target="_blank">--&gt; здесь &lt;--</a></noindex>. Но для того, чтобы её перехватить и перехватить ещё 3 функции двух интерфейсов, нам нужно сначала перехватить вызов DirectDrawCreate, чтобы получить указатель на интерфейс IDirectDraw.<br><br>Пишем для этого в DllMain.cpp под <b>case DLL_PROCESS_ATTACH:</b> вызов функции установки хуков:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">SetHooks<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div>
<br><br>Хочу отметить, что для того, чтобы компилятор смог скомпилировать код dll, требуется найти и скачать ddraw.h, если нет, а также подключить директивой #include и указать линкеру ddraw.lib<br><br>В функции SetHooks() пишем тело:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HMODULE&nbsp;hDDrawMod&nbsp;<span class="hl_char">=</span>&nbsp;GetModuleHandle<span class="hl_char">(</span><span class="hl_quote">&quot;ddraw.dll&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetApiHook<span class="hl_char">(</span>hDDrawMod<span class="hl_char">/</span><span class="hl_char">*</span>dll&nbsp;handle<span class="hl_char">*</span><span class="hl_char">/</span><span class="hl_char">,</span>&nbsp;<span class="hl_quote">&quot;DirectDrawCreate&quot;</span><span class="hl_char">/</span><span class="hl_char">*</span>Имя&nbsp;перехватываемой&nbsp;функции<span class="hl_char">*</span><span class="hl_char">/</span><span class="hl_char">,</span>&nbsp;DirectDrawCreateHook<span class="hl_char">/</span><span class="hl_char">*</span>наша&nbsp;функция<span class="hl_char">,</span>&nbsp;которая&nbsp;будет&nbsp;выполняться&nbsp;вместо&nbsp;перехваченной<span class="hl_char">*</span><span class="hl_char">/</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">3</span><span class="hl_char">/</span><span class="hl_char">*</span>кол<span class="hl_char">-</span>во&nbsp;аргументов&nbsp;оригинальной&nbsp;функции<span class="hl_char">*</span><span class="hl_char">/</span><span class="hl_char">)</span><span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div>
<br><br>В функции SetApiHook:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>void</b></span>&nbsp;__stdcall&nbsp;SetApiHook<span class="hl_char">(</span>HMODULE&nbsp;hMod<span class="hl_char">,</span>&nbsp;<span class="hl_function">char</span><span class="hl_char">*</span>&nbsp;sFunc<span class="hl_char">,</span>&nbsp;<span class="hl_function">void</span><span class="hl_char">*</span>&nbsp;fPre<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;nArgs<span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>Получаем&nbsp;адрес&nbsp;перехватываемой&nbsp;функции</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;dwAddress&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span>GetProcAddress<span class="hl_char">(</span>hMod<span class="hl_char">,</span>&nbsp;sFunc<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>проверям&nbsp;наличие&nbsp;сигнатуры&nbsp;в&nbsp;начале&nbsp;перехватываемой&nbsp;функции</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>dwAddress&nbsp;<span class="hl_char">&amp;</span><span class="hl_char">&amp;</span>&nbsp;<span class="hl_char">!</span>memcmp<span class="hl_char">(</span><span class="hl_char">(</span><span class="hl_function">void</span><span class="hl_char">*</span><span class="hl_char">)</span>dwAddress<span class="hl_char">,</span>&nbsp;<span class="hl_char">(</span><span class="hl_function">void</span><span class="hl_char">*</span><span class="hl_char">)</span><span class="hl_quote">&quot;\x8b\xff\x55\x8b\xec&quot;</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">5</span><span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;dwBytes&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;dwPos&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;dwPrevPos<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>fPre&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwBytes&nbsp;</span><span class="hl_char">=</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>PrologCode<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;nArgs&nbsp;<span class="hl_char">*</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>PassArgsCode<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>HookCode<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>ReturnCode<span class="hl_char">)</span><span class="hl_comment">;//считаем, сколько байт потребуется для функции-хука</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function">BYTE</span><span class="hl_char">*</span>&nbsp;pCode&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function"><b>new</b></span>&nbsp;<span class="hl_function">BYTE</span><span class="hl_char">[</span>dwBytes<span class="hl_char">]</span><span class="hl_comment">;//выделяем память под функцию</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>DWORD</b></span>&nbsp;dwOldProtect<span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VirtualProtect</span><span class="hl_char">(</span>pCode<span class="hl_char">,</span>&nbsp;dwBytes<span class="hl_char">,</span>&nbsp;PAGE_EXECUTE_READWRITE<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>dwOldProtect<span class="hl_char">)</span><span class="hl_comment">;//делаем выделенную область исполняемой</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_char">/</span><span class="hl_char">/</span>копируем&nbsp;нужные&nbsp;куски&nbsp;кода&nbsp;в&nbsp;выделенную&nbsp;область</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CopyCode</span><span class="hl_char">(</span>PrologCode<span class="hl_char">)</span>&nbsp;<span class="hl_char">*</span><span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">*</span><span class="hl_char">)</span><span class="hl_char">(</span>pCode&nbsp;<span class="hl_char">+</span>&nbsp;dwPos&nbsp;<span class="hl_char">-</span>&nbsp;<span class="hl_number">5</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">=</span>&nbsp;dwAddress<span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function">if</span><span class="hl_char">(</span>nArgs&nbsp;<span class="hl_char">&gt;</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for</span><span class="hl_char">(</span><span class="hl_function"><b>int</b></span>&nbsp;i&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_comment">; i &lt; nArgs; i++)</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CopyCode</span><span class="hl_char">(</span>PassArgsCode<span class="hl_char">)</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_char">*</span><span class="hl_char">(</span>pCode&nbsp;<span class="hl_char">+</span>&nbsp;dwPrevPos&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">3</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span><span class="hl_char">=</span>&nbsp;nArgs&nbsp;<span class="hl_char">*</span>&nbsp;<span class="hl_number">4</span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CopyCode</span><span class="hl_char">(</span>PreHookCode<span class="hl_char">)</span>&nbsp;SetJmp<span class="hl_char">(</span><span class="hl_char">(</span><span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span>pCode&nbsp;<span class="hl_char">+</span>&nbsp;dwPos<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span>fPre<span class="hl_char">)</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CopyCode</span><span class="hl_char">(</span>ReturnCode<span class="hl_char">)</span>&nbsp;<span class="hl_char">*</span><span class="hl_char">(</span><span class="hl_function">WORD</span><span class="hl_char">*</span><span class="hl_char">)</span><span class="hl_char">(</span>pCode&nbsp;<span class="hl_char">+</span>&nbsp;dwPrevPos&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">2</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span><span class="hl_char">=</span>&nbsp;nArgs&nbsp;<span class="hl_char">*</span>&nbsp;<span class="hl_number">4</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VirtualProtect</span><span class="hl_char">(</span><span class="hl_char">(</span><span class="hl_function">void</span><span class="hl_char">*</span><span class="hl_char">)</span>dwAddress<span class="hl_char">,</span>&nbsp;<span class="hl_number">5</span><span class="hl_char">,</span>&nbsp;PAGE_EXECUTE_READWRITE<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>dwOldProtect<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_char">*</span><span class="hl_char">(</span><span class="hl_function">BYTE</span><span class="hl_char">*</span><span class="hl_char">)</span>dwAddress&nbsp;<span class="hl_char">=</span>&nbsp;0xe9<span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetJmp</span><span class="hl_char">(</span><span class="hl_char">(</span>dwAddress&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">5</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span>pCode<span class="hl_char">)</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VirtualProtect</span><span class="hl_char">(</span><span class="hl_char">(</span><span class="hl_function">void</span><span class="hl_char">*</span><span class="hl_char">)</span>dwAddress<span class="hl_char">,</span>&nbsp;<span class="hl_number">5</span><span class="hl_char">,</span>&nbsp;dwOldProtect<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>dwOldProtect<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FlushInstructionCache</span><span class="hl_char">(</span>GetCurrentProcess<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">(</span><span class="hl_function">void</span><span class="hl_char">*</span><span class="hl_char">)</span>dwAddress<span class="hl_char">,</span>&nbsp;<span class="hl_number">5</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">}</li>        </ol>
    </div>
</div></div>
<br><br>В заголовочном файле определяем 2 макроса:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">#define&nbsp;CopyCode<span class="hl_char">(</span>CodeType<span class="hl_char">)</span>&nbsp;memcpy<span class="hl_char">(</span>pCode&nbsp;<span class="hl_char">+</span>&nbsp;dwPos<span class="hl_char">,</span>&nbsp;CodeType<span class="hl_char">,</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>CodeType<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">; dwPrevPos = dwPos; dwPos += sizeof(CodeType);</span></li><li class="hl_l1">#define&nbsp;SetJmp<span class="hl_char">(</span>NextInstr<span class="hl_char">,</span>&nbsp;Address<span class="hl_char">)</span>&nbsp;<span class="hl_char">*</span><span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">*</span><span class="hl_char">)</span><span class="hl_char">(</span>NextInstr&nbsp;<span class="hl_char">-</span>&nbsp;<span class="hl_number">4</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">=</span>&nbsp;Address&nbsp;<span class="hl_char">-</span>&nbsp;NextInstr<span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div>
<br><br>Определяем все нужные куски кода<br>//push ebp<br>//mov ebp, esp<br>//push ebp<br>//push Address - адрем перехватываемой функции, которую нужно будет вызвать после нужных операций<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>BYTE</b></span>&nbsp;PrologCode<span class="hl_char">[</span><span class="hl_char">]</span>&nbsp;<span class="hl_char">=</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x55<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x8b<span class="hl_char">,</span>&nbsp;0xec<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x68<span class="hl_char">,</span>&nbsp;0x00<span class="hl_char">,</span>&nbsp;0x00<span class="hl_char">,</span>&nbsp;0x00<span class="hl_char">,</span>&nbsp;0x00<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x55</li><li class="hl_l0">}<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function">ptr</span><span class="hl_char">[</span><span class="hl_registr"><b>esp</b></span>&nbsp;<span class="hl_char">+</span>&nbsp;0xC<span class="hl_char">]</span></li><li class="hl_l1"><span class="hl_function"><b>BYTE</b></span>&nbsp;PassArgsCode<span class="hl_char">[</span><span class="hl_char">]</span>&nbsp;<span class="hl_char">=</span></li><li class="hl_l0">{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xff<span class="hl_char">,</span>&nbsp;0x74<span class="hl_char">,</span>&nbsp;0xe4<span class="hl_char">,</span>&nbsp;0x0C</li><li class="hl_l0">}<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_function"><b>call</b></span>&nbsp;func</li><li class="hl_l1"><span class="hl_function"><b>BYTE</b></span>&nbsp;PreHookCode<span class="hl_char">[</span><span class="hl_char">]</span>&nbsp;<span class="hl_char">=</span></li><li class="hl_l0">{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xe8<span class="hl_char">,</span>&nbsp;0x00<span class="hl_char">,</span>&nbsp;0x00<span class="hl_char">,</span>&nbsp;0x00<span class="hl_char">,</span>&nbsp;0x00</li><li class="hl_l0">}<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_function">leave</span></li><li class="hl_l1"><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_function"><b>retn</b></span>&nbsp;nArgs</li><li class="hl_l0"><span class="hl_function"><b>BYTE</b></span>&nbsp;ReturnCode<span class="hl_char">[</span><span class="hl_char">]</span>&nbsp;<span class="hl_char">=</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xc9<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xc2<span class="hl_char">,</span>&nbsp;0x00<span class="hl_char">,</span>&nbsp;0x00</li><li class="hl_l0">}<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li>        </ol>
    </div>
</div></div>
<br><br>Таким образом, мы перехватываем функцию и заставляем процессор при вызове функции выполнить код переходника на нашу функцию. Теперь можно приступить к нашей функции<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">HRESULT&nbsp;__stdcall&nbsp;DirectDrawCreateHook<span class="hl_char">(</span>GUID<span class="hl_char">*</span>&nbsp;pGuid<span class="hl_char">,</span>&nbsp;LPDIRECTDRAW&nbsp;<span class="hl_char">*</span>ppDD<span class="hl_char">,</span>&nbsp;IUnknown<span class="hl_char">*</span>&nbsp;pUnkOuter<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;rEsp<span class="hl_char">,</span>&nbsp;<span class="hl_function">void</span><span class="hl_char">*</span>&nbsp;fOrigin<span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HRESULT&nbsp;hResult<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>Вызываем&nbsp;оригинальную&nbsp;функцию</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hResult&nbsp;<span class="hl_char">=</span>&nbsp;CallHookedStdcallFunc<span class="hl_char">(</span>fOrigin<span class="hl_char">,</span>&nbsp;pGuid<span class="hl_char">,</span>&nbsp;ppDD<span class="hl_char">,</span>&nbsp;pUnkOuter<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>Поскольку&nbsp;оригинальная&nbsp;функция&nbsp;DirectDrawCreate&nbsp;конвенции&nbsp;__stdcall<span class="hl_char">,</span>&nbsp;а&nbsp;компилятор&nbsp;при&nbsp;вызове&nbsp;функции&nbsp;с&nbsp;переменным&nbsp;числом&nbsp;аргументов&nbsp;вставляет&nbsp;<span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">esp</span><span class="hl_char">,</span>&nbsp;0x10<span class="hl_char">,</span>&nbsp;то&nbsp;вернуть&nbsp;указатель&nbsp;стека&nbsp;обратно</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__asm&nbsp;<span class="hl_function"><b>sub</b></span>&nbsp;<span class="hl_registr">esp</span><span class="hl_char">,</span>&nbsp;0x10<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>Если&nbsp;всё&nbsp;прошло&nbsp;нормально<span class="hl_char">,</span>&nbsp;устанавливаем&nbsp;хуки&nbsp;на&nbsp;<span class="hl_number">2</span>&nbsp;функции&nbsp;полученного&nbsp;в&nbsp;ppDD&nbsp;интерфейса</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>hResult&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;DD_OK<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET_INTERFACE_HOOK<span class="hl_char">(</span>IDirectDraw<span class="hl_char">,</span>&nbsp;CreateSurface<span class="hl_char">,</span>&nbsp;ppDD<span class="hl_char">,</span>&nbsp;<span class="hl_number">3</span><span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET_INTERFACE_HOOK<span class="hl_char">(</span>IDirectDraw<span class="hl_char">,</span>&nbsp;QueryInterface<span class="hl_char">,</span>&nbsp;ppDD<span class="hl_char">,</span>&nbsp;<span class="hl_number">2</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;hResult<span class="hl_comment">;</span></li><li class="hl_l1">}</li>        </ol>
    </div>
</div></div>
<br><br>Функция вызова оригинальной функции с переменным числом аргументов<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">__declspec<span class="hl_char">(</span>naked<span class="hl_char">)</span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;__stdcall&nbsp;CallHookedStdcallFunc<span class="hl_char">(</span><span class="hl_function">void</span><span class="hl_char">*</span>&nbsp;Func<span class="hl_char">,</span>&nbsp;<span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__asm</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_registr"><b>eax</b></span><span class="hl_comment">; извлекаем адрес возврата</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>xchg</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">esp</span><span class="hl_char">]</span><span class="hl_comment">; обмениваем в стеке адрес возврата с адресом оригинальной функции</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr"><b>ebp</b></span><span class="hl_comment">; в eax адрес оригинальной функции, но по адресу мы поставили jmp</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ebp</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>esp</b></span><span class="hl_comment">; поэтому выполняем код пролога и прибавляем к адресу размер команды jmp</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">5</span><span class="hl_comment">; чтобы перейти по этому адресу</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jmp</b></span>&nbsp;<span class="hl_registr"><b>eax</b></span><span class="hl_comment">; в стеке адрес возврата из нашей функции + аргументы оригинальной функции</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">}</li>        </ol>
    </div>
</div></div>
<br><br>Макросы для установки хуков на метода интерфейса выглядят так<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">#define&nbsp;INTERFACE_POINTER_FUNC<span class="hl_char">(</span>Interface<span class="hl_char">,</span>&nbsp;Func<span class="hl_char">,</span>&nbsp;pRealInterface<span class="hl_char">)</span>&nbsp;<span class="hl_char">\</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">*</span><span class="hl_char">)</span><span class="hl_char">(</span><span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span><span class="hl_char">*</span><span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">*</span><span class="hl_char">)</span><span class="hl_char">*</span>pRealInterface&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_char">(</span><span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span><span class="hl_char">&amp;</span>p##Interface<span class="hl_char">.</span>Func&nbsp;<span class="hl_char">-</span>&nbsp;<span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span><span class="hl_char">&amp;</span>p##Interface<span class="hl_char">.</span>QueryInterface<span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">#define&nbsp;SET_INTERFACE_HOOK<span class="hl_char">(</span>Interface<span class="hl_char">,</span>&nbsp;Func<span class="hl_char">,</span>&nbsp;pRealInterface<span class="hl_char">,</span>&nbsp;nArgs<span class="hl_char">)</span>&nbsp;<span class="hl_char">\</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetInterfaceHook<span class="hl_char">(</span>INTERFACE_POINTER_FUNC<span class="hl_char">(</span>Interface<span class="hl_char">,</span>&nbsp;Func<span class="hl_char">,</span>&nbsp;pRealInterface<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">(</span><span class="hl_function">void</span><span class="hl_char">*</span><span class="hl_char">)</span>##Interface##_##Func##HookPre<span class="hl_char">,</span>&nbsp;nArgs<span class="hl_char">,</span>&nbsp;<span class="hl_quote">#Interface&quot;::&quot;</span>#Func<span class="hl_char">)</span><span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div>
<br><br>Адрес метода интерфейса вычисляется значением [адреса таблицы + порядковый номер метода * 4]. Нам требуется не сам адрес метода, а указатель на его место в таблице, чтобы подменить оригинальный адрес на адрес нашей функции интерфейса. В си/си++ нельзя производить действия над укателями на разные методы классов, поэтому пришлось определять целые таблицы функций интерфейсов
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=316464&amp;user=24257&amp;forum_n=5&amp;topic=20640&amp;page=0&amp;anchor=25" class="addthx" data-post="316464"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=2585" title="31-12-2012 15:45, ранг:846.2" target="_blank">Gideon Vi</a>, <a href="action=userinfo&user=33253" title="01-04-2013 13:01, ранг:8.8" target="_blank">Abraham</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="26" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 221thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 декабря 2012 10:00 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#26" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=20640&amp;page=0#26');return false;">#26</a> </span><div align=left><br><div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">struct&nbsp;IDirectDraw_Functions</li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span>&nbsp;IUnknown&nbsp;methods&nbsp;<span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">/</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;QueryInterface<span class="hl_comment">; //(THIS_ REFIID riid, LPVOID FAR * ppvObj) PURE;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;AddRef<span class="hl_comment">; //(THIS)  PURE;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;Release<span class="hl_comment">; //(THIS) PURE;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span>&nbsp;IDirectDraw&nbsp;methods&nbsp;<span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">/</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;Compact<span class="hl_comment">; //(THIS) PURE;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;CreateClipper<span class="hl_comment">; //(THIS_ DWORD, LPDIRECTDRAWCLIPPER FAR*, IUnknown FAR * ) PURE;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;CreatePalette<span class="hl_comment">; //(THIS_ DWORD, LPPALETTEENTRY, LPDIRECTDRAWPALETTE FAR*, IUnknown FAR * ) PURE;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;CreateSurface<span class="hl_comment">; //(THIS_  LPDDSURFACEDESC, LPDIRECTDRAWSURFACE FAR *, IUnknown FAR *) PURE;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;DuplicateSurface<span class="hl_comment">; //( THIS_ LPDIRECTDRAWSURFACE, LPDIRECTDRAWSURFACE FAR * ) PURE;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;EnumDisplayModes<span class="hl_comment">; //( THIS_ DWORD, LPDDSURFACEDESC, LPVOID, LPDDENUMMODESCALLBACK ) PURE;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;EnumSurfaces<span class="hl_comment">; //(THIS_ DWORD, LPDDSURFACEDESC, LPVOID,LPDDENUMSURFACESCALLBACK ) PURE;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;FlipToGDISurface<span class="hl_comment">; //(THIS) PURE;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;GetCaps<span class="hl_comment">; //( THIS_ LPDDCAPS, LPDDCAPS) PURE;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;GetDisplayMode<span class="hl_comment">; //( THIS_ LPDDSURFACEDESC) PURE;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;GetFourCCCodes<span class="hl_comment">; //(THIS_  LPDWORD, LPDWORD ) PURE;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;GetGDISurface<span class="hl_comment">; //(THIS_ LPDIRECTDRAWSURFACE FAR *) PURE;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;GetMonitorFrequency<span class="hl_comment">; //(THIS_ LPDWORD) PURE;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;GetScanLine<span class="hl_comment">; //(THIS_ LPDWORD) PURE;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;GetVerticalBlankStatus<span class="hl_comment">; //(THIS_ LPBOOL ) PURE;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;Initialize<span class="hl_comment">; //(THIS_ GUID FAR *) PURE;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;RestoreDisplayMode<span class="hl_comment">; //(THIS) PURE;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;SetCooperativeLevel<span class="hl_comment">; //(THIS_ HWND, DWORD) PURE;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;SetDisplayMode<span class="hl_comment">; //(THIS_ DWORD, DWORD,DWORD) PURE;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;WaitForVerticalBlank<span class="hl_comment">; //(THIS_ DWORD, HANDLE ) PURE;</span></li><li class="hl_l1">}<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">struct&nbsp;IDirectDraw2_Functions</li><li class="hl_l0">{</li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span>&nbsp;IUnknown&nbsp;methods&nbsp;<span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">/</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;QueryInterface<span class="hl_comment">; //(THIS_ REFIID riid, LPVOID FAR * ppvObj) PURE;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;AddRef<span class="hl_comment">; //(THIS)  PURE;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;Release<span class="hl_comment">; //(THIS) PURE;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span>&nbsp;IDirectDraw&nbsp;methods&nbsp;<span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">/</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;Compact<span class="hl_comment">; //(THIS) PURE;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;CreateClipper<span class="hl_comment">; //(THIS_ DWORD, LPDIRECTDRAWCLIPPER FAR*, IUnknown FAR * ) PURE;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;CreatePalette<span class="hl_comment">; //(THIS_ DWORD, LPPALETTEENTRY, LPDIRECTDRAWPALETTE FAR*, IUnknown FAR * ) PURE;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;CreateSurface<span class="hl_comment">; //(THIS_  LPDDSURFACEDESC, LPDIRECTDRAWSURFACE FAR *, IUnknown FAR *) PURE;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;DuplicateSurface<span class="hl_comment">; //(THIS_ LPDIRECTDRAWSURFACE, LPDIRECTDRAWSURFACE FAR * ) PURE;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;EnumDisplayModes<span class="hl_comment">; //(THIS_ DWORD, LPDDSURFACEDESC, LPVOID, LPDDENUMMODESCALLBACK ) PURE;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;EnumSurfaces<span class="hl_comment">; //(THIS_ DWORD, LPDDSURFACEDESC, LPVOID,LPDDENUMSURFACESCALLBACK ) PURE;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;FlipToGDISurface<span class="hl_comment">; //(THIS) PURE;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;GetCaps<span class="hl_comment">; //(THIS_ LPDDCAPS, LPDDCAPS) PURE;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;GetDisplayMode<span class="hl_comment">; //(THIS_ LPDDSURFACEDESC) PURE;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;GetFourCCCodes<span class="hl_comment">; //(THIS_  LPDWORD, LPDWORD ) PURE;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;GetGDISurface<span class="hl_comment">; //(THIS_ LPDIRECTDRAWSURFACE FAR *) PURE;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;GetMonitorFrequency<span class="hl_comment">; //(THIS_ LPDWORD) PURE;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;GetScanLine<span class="hl_comment">; //(THIS_ LPDWORD) PURE;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;GetVerticalBlankStatus<span class="hl_comment">; //(THIS_ LPBOOL ) PURE;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;Initialize<span class="hl_comment">; //(THIS_ GUID FAR *) PURE;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;RestoreDisplayMode<span class="hl_comment">; //(THIS) PURE;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;SetCooperativeLevel<span class="hl_comment">; //(THIS_ HWND, DWORD) PURE;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;SetDisplayMode<span class="hl_comment">; //(THIS_ DWORD, DWORD,DWORD, DWORD, DWORD) PURE;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;WaitForVerticalBlank<span class="hl_comment">; //(THIS_ DWORD, HANDLE ) PURE;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span>&nbsp;Added&nbsp;<span class="hl_function"><b>in</b></span>&nbsp;the&nbsp;v2&nbsp;interface&nbsp;<span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">/</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;GetAvailableVidMem<span class="hl_comment">; //(THIS_ LPDDSCAPS, LPDWORD, LPDWORD) PURE;</span></li><li class="hl_l0">}<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">struct&nbsp;IDirectDraw4_Functions</li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span>&nbsp;IUnknown&nbsp;methods&nbsp;<span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">/</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;QueryInterface<span class="hl_comment">; //(THIS_ REFIID riid, LPVOID FAR * ppvObj) PURE;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;AddRef<span class="hl_comment">; //(THIS)  PURE;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;Release<span class="hl_comment">; //(THIS) PURE;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span>&nbsp;IDirectDraw&nbsp;methods&nbsp;<span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">/</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;Compact<span class="hl_comment">; //(THIS) PURE;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;CreateClipper<span class="hl_comment">; //(THIS_ DWORD, LPDIRECTDRAWCLIPPER FAR*, IUnknown FAR * ) PURE;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;CreatePalette<span class="hl_comment">; //(THIS_ DWORD, LPPALETTEENTRY, LPDIRECTDRAWPALETTE FAR*, IUnknown FAR * ) PURE;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;CreateSurface<span class="hl_comment">; //(THIS_  LPDDSURFACEDESC2, LPDIRECTDRAWSURFACE4 FAR *, IUnknown FAR *) PURE;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;DuplicateSurface<span class="hl_comment">; //(THIS_ LPDIRECTDRAWSURFACE4, LPDIRECTDRAWSURFACE4 FAR * ) PURE;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;EnumDisplayModes<span class="hl_comment">; //(THIS_ DWORD, LPDDSURFACEDESC2, LPVOID, LPDDENUMMODESCALLBACK2 ) PURE;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;EnumSurfaces<span class="hl_comment">; //(THIS_ DWORD, LPDDSURFACEDESC2, LPVOID,LPDDENUMSURFACESCALLBACK2 ) PURE;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;FlipToGDISurface<span class="hl_comment">; //(THIS) PURE;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;GetCaps<span class="hl_comment">; //(THIS_ LPDDCAPS, LPDDCAPS) PURE;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;GetDisplayMode<span class="hl_comment">; //(THIS_ LPDDSURFACEDESC2) PURE;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;GetFourCCCodes<span class="hl_comment">; //(THIS_  LPDWORD, LPDWORD ) PURE;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;GetGDISurface<span class="hl_comment">; //(THIS_ LPDIRECTDRAWSURFACE4 FAR *) PURE;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;GetMonitorFrequency<span class="hl_comment">; //(THIS_ LPDWORD) PURE;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;GetScanLine<span class="hl_comment">; //(THIS_ LPDWORD) PURE;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;GetVerticalBlankStatus<span class="hl_comment">; //(THIS_ LPBOOL ) PURE;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;Initialize<span class="hl_comment">; //(THIS_ GUID FAR *) PURE;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;RestoreDisplayMode<span class="hl_comment">; //(THIS) PURE;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;SetCooperativeLevel<span class="hl_comment">; //(THIS_ HWND, DWORD) PURE;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;SetDisplayMode<span class="hl_comment">; //(THIS_ DWORD, DWORD,DWORD, DWORD, DWORD) PURE;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;WaitForVerticalBlank<span class="hl_comment">; //(THIS_ DWORD, HANDLE ) PURE;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span>&nbsp;Added&nbsp;<span class="hl_function"><b>in</b></span>&nbsp;the&nbsp;v2&nbsp;interface&nbsp;<span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">/</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;GetAvailableVidMem<span class="hl_comment">; //(THIS_ LPDDSCAPS2, LPDWORD, LPDWORD) PURE;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span>&nbsp;Added&nbsp;<span class="hl_function"><b>in</b></span>&nbsp;the&nbsp;V4&nbsp;Interface&nbsp;<span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">/</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;GetSurfaceFromDC<span class="hl_comment">; //(THIS_ HDC, LPDIRECTDRAWSURFACE4 *) PURE;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;RestoreAllSurfaces<span class="hl_comment">; //(THIS) PURE;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;TestCooperativeLevel<span class="hl_comment">; //(THIS) PURE;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;GetDeviceIdentifier<span class="hl_comment">; //(THIS_ LPDDDEVICEIDENTIFIER, DWORD ) PURE;</span></li><li class="hl_l0">}<span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div>
<br><br>Два метода, IDirectDraw::QueryInterface и IDirectDraw::CreateSurface, перехватываются для получения контроля над используемым интерфейсом IDirectDraw более новой версии и для получения контроля  интерфейса для работы с поверхностями IDirectDrawSurface. Также нам потребуется перехватить метод IDirectDraw::SetDisplayMode, для чего аналогичным образом добавляем установку хука<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">SET_INTERFACE_HOOK<span class="hl_char">(</span>IDirectDraw<span class="hl_char">,</span>&nbsp;SetDisplayMode<span class="hl_char">,</span>&nbsp;ppDD<span class="hl_char">,</span>&nbsp;<span class="hl_number">5</span><span class="hl_char">)</span></li>        </ol>
    </div>
</div></div>
<br><br>Установщик хуков на методы интерфейса выглядит следующим образом<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>void</b></span>&nbsp;__stdcall&nbsp;SetInterfaceHook<span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">*</span>&nbsp;dwpDDFunc<span class="hl_char">,</span>&nbsp;<span class="hl_function">void</span><span class="hl_char">*</span>&nbsp;HookFunc<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;nArgs<span class="hl_char">,</span>&nbsp;<span class="hl_function">char</span><span class="hl_char">*</span>&nbsp;Name<span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;dwOriginalFunc&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">*</span>dwpDDFunc<span class="hl_char">,</span>&nbsp;dwBytes&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;dwPos&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;dwPrevPos<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>dwpDDFunc&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwBytes&nbsp;</span><span class="hl_char">=</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>PrologCode<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_char">(</span>nArgs&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">1</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">*</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>PassArgsCode<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>PreHookCode<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>ReturnCode<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function">BYTE</span><span class="hl_char">*</span>&nbsp;pCode&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function"><b>new</b></span>&nbsp;<span class="hl_function">BYTE</span><span class="hl_char">[</span>dwBytes<span class="hl_char">]</span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>DWORD</b></span>&nbsp;dwOldProtect<span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VirtualProtect</span><span class="hl_char">(</span>pCode<span class="hl_char">,</span>&nbsp;dwBytes<span class="hl_char">,</span>&nbsp;PAGE_EXECUTE_READWRITE<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>dwOldProtect<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CopyCode</span><span class="hl_char">(</span>PrologCode<span class="hl_char">)</span>&nbsp;<span class="hl_char">*</span><span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">*</span><span class="hl_char">)</span><span class="hl_char">(</span>pCode&nbsp;<span class="hl_char">+</span>&nbsp;dwPos&nbsp;<span class="hl_char">-</span>&nbsp;<span class="hl_number">5</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">=</span>&nbsp;dwOriginalFunc<span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function">if</span><span class="hl_char">(</span>nArgs&nbsp;<span class="hl_char">&gt;</span><span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for</span><span class="hl_char">(</span><span class="hl_function"><b>int</b></span>&nbsp;i&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_comment">; i &lt;= nArgs; i++)</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CopyCode</span><span class="hl_char">(</span>PassArgsCode<span class="hl_char">)</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_char">*</span><span class="hl_char">(</span>pCode&nbsp;<span class="hl_char">+</span>&nbsp;dwPrevPos&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">3</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">(</span>nArgs&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">1</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">*</span>&nbsp;<span class="hl_number">4</span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CopyCode</span><span class="hl_char">(</span>PreHookCode<span class="hl_char">)</span>&nbsp;SetJmp<span class="hl_char">(</span><span class="hl_char">(</span><span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span>pCode&nbsp;<span class="hl_char">+</span>&nbsp;dwPos<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span>HookFunc<span class="hl_char">)</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CopyCode</span><span class="hl_char">(</span>ReturnCode<span class="hl_char">)</span>&nbsp;<span class="hl_char">*</span><span class="hl_char">(</span><span class="hl_function">WORD</span><span class="hl_char">*</span><span class="hl_char">)</span><span class="hl_char">(</span>pCode&nbsp;<span class="hl_char">+</span>&nbsp;dwPrevPos&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">2</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">(</span>nArgs&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">1</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">*</span>&nbsp;<span class="hl_number">4</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_char">*</span>dwpDDFunc&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span>pCode<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">}</li>        </ol>
    </div>
</div></div>
<br><br>Определим наши функции-хуки для QueryInterface и CreateSurface, а также SetDisplayMode:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">HRESULT&nbsp;__stdcall&nbsp;IDirectDraw_QueryInterfaceHookPre<span class="hl_char">(</span>LPDIRECTDRAW&nbsp;<span class="hl_function">This</span><span class="hl_char">,</span>&nbsp;REFIID&nbsp;riid<span class="hl_char">,</span>&nbsp;LPVOID&nbsp;<span class="hl_function"><b>FAR</b></span>&nbsp;<span class="hl_char">*</span>&nbsp;ppvObj<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;rEsp<span class="hl_char">,</span>&nbsp;<span class="hl_function">void</span><span class="hl_char">*</span>&nbsp;fOrigin<span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HRESULT&nbsp;hResult&nbsp;<span class="hl_char">=</span>&nbsp;DD_OK<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hResult&nbsp;<span class="hl_char">=</span>&nbsp;CallHookedInterfaceFunc<span class="hl_char">(</span>fOrigin<span class="hl_char">,</span>&nbsp;<span class="hl_function">This</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>riid<span class="hl_char">,</span>&nbsp;ppvObj<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__asm&nbsp;<span class="hl_function"><b>sub</b></span>&nbsp;<span class="hl_registr">esp</span><span class="hl_char">,</span>&nbsp;0x10<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>hResult&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;DD_OK<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span><span class="hl_char">!</span>memcmp<span class="hl_char">(</span><span class="hl_char">&amp;</span>riid<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>IID_IDirectDraw<span class="hl_char">,</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>GUID<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sprintf</span><span class="hl_char">(</span>s<span class="hl_char">,</span>&nbsp;<span class="hl_quote">&quot;IID_IDirectDraw\r\n&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET_INTERFACE_HOOK</span><span class="hl_char">(</span>IDirectDraw<span class="hl_char">,</span>&nbsp;CreateSurface<span class="hl_char">,</span>&nbsp;ppvObj<span class="hl_char">,</span>&nbsp;<span class="hl_number">3</span><span class="hl_char">)</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET_INTERFACE_HOOK</span><span class="hl_char">(</span>IDirectDraw<span class="hl_char">,</span>&nbsp;QueryInterface<span class="hl_char">,</span>&nbsp;ppvObj<span class="hl_char">,</span>&nbsp;<span class="hl_number">2</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>else</b></span>&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span><span class="hl_char">!</span>memcmp<span class="hl_char">(</span><span class="hl_char">&amp;</span>riid<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>IID_IDirectDraw2<span class="hl_char">,</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>GUID<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sprintf</span><span class="hl_char">(</span>s<span class="hl_char">,</span>&nbsp;<span class="hl_quote">&quot;IID_IDirectDraw2\r\n&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET_INTERFACE_HOOK</span><span class="hl_char">(</span>IDirectDraw2<span class="hl_char">,</span>&nbsp;CreateSurface<span class="hl_char">,</span>&nbsp;ppvObj<span class="hl_char">,</span>&nbsp;<span class="hl_number">3</span><span class="hl_char">)</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET_INTERFACE_HOOK</span><span class="hl_char">(</span>IDirectDraw2<span class="hl_char">,</span>&nbsp;QueryInterface<span class="hl_char">,</span>&nbsp;ppvObj<span class="hl_char">,</span>&nbsp;<span class="hl_number">2</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>else</b></span>&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span><span class="hl_char">!</span>memcmp<span class="hl_char">(</span><span class="hl_char">&amp;</span>riid<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>IID_IDirectDraw4<span class="hl_char">,</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>GUID<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sprintf</span><span class="hl_char">(</span>s<span class="hl_char">,</span>&nbsp;<span class="hl_quote">&quot;IID_IDirectDraw4\r\n&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET_INTERFACE_HOOK</span><span class="hl_char">(</span>IDirectDraw4<span class="hl_char">,</span>&nbsp;CreateSurface<span class="hl_char">,</span>&nbsp;ppvObj<span class="hl_char">,</span>&nbsp;<span class="hl_number">3</span><span class="hl_char">)</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET_INTERFACE_HOOK</span><span class="hl_char">(</span>IDirectDraw4<span class="hl_char">,</span>&nbsp;QueryInterface<span class="hl_char">,</span>&nbsp;ppvObj<span class="hl_char">,</span>&nbsp;<span class="hl_number">2</span><span class="hl_char">)</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lpDD4&nbsp;</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">(</span>LPDIRECTDRAW4<span class="hl_char">)</span><span class="hl_char">*</span>ppvObj<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;hResult<span class="hl_comment">;</span></li><li class="hl_l1">}</li>        </ol>
    </div>
</div></div>
<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">HRESULT&nbsp;__stdcall&nbsp;IDirectDraw_CreateSurfaceHookPre<span class="hl_char">(</span>LPDIRECTDRAW&nbsp;<span class="hl_function">This</span><span class="hl_char">,</span>&nbsp;LPDDSURFACEDESC&nbsp;pSurfDesc<span class="hl_char">,</span>&nbsp;LPDIRECTDRAWSURFACE&nbsp;<span class="hl_function"><b>FAR</b></span>&nbsp;<span class="hl_char">*</span>&nbsp;ppDDSurf<span class="hl_char">,</span>&nbsp;IUnknown&nbsp;<span class="hl_function"><b>FAR</b></span>&nbsp;<span class="hl_char">*</span>&nbsp;pUnk<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;rEsp<span class="hl_char">,</span>&nbsp;<span class="hl_function">void</span><span class="hl_char">*</span>&nbsp;fOrigin<span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HRESULT&nbsp;hResult&nbsp;<span class="hl_char">=</span>&nbsp;DD_OK<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>char</b></span>&nbsp;s<span class="hl_char">[</span>0x1000<span class="hl_char">]</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hResult&nbsp;<span class="hl_char">=</span>&nbsp;CallHookedInterfaceFunc<span class="hl_char">(</span>fOrigin<span class="hl_char">,</span>&nbsp;<span class="hl_function">This</span><span class="hl_char">,</span>&nbsp;pSurfDesc<span class="hl_char">,</span>&nbsp;ppDDSurf<span class="hl_char">,</span>&nbsp;pUnk<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__asm&nbsp;<span class="hl_function"><b>sub</b></span>&nbsp;<span class="hl_registr">esp</span><span class="hl_char">,</span>&nbsp;0x14<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>hResult&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;DD_OK<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET_INTERFACE_HOOK<span class="hl_char">(</span>IDirectDrawSurface<span class="hl_char">,</span>&nbsp;GetAttachedSurface<span class="hl_char">,</span>&nbsp;ppDDSurf<span class="hl_char">,</span>&nbsp;<span class="hl_number">2</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET_INTERFACE_HOOK<span class="hl_char">(</span>IDirectDrawSurface<span class="hl_char">,</span>&nbsp;Flip<span class="hl_char">,</span>&nbsp;ppDDSurf<span class="hl_char">,</span>&nbsp;<span class="hl_number">2</span><span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;hResult<span class="hl_comment">;</span></li><li class="hl_l0">}</li>        </ol>
    </div>
</div></div>
<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>DWORD</b></span>&nbsp;glOriginalWidth<span class="hl_char">,</span>&nbsp;glOriginalHeight<span class="hl_comment">;</span></li><li class="hl_l1">HRESULT&nbsp;__stdcall&nbsp;IDirectDraw_CreateSurfaceHookPre<span class="hl_char">(</span>LPDIRECTDRAW&nbsp;<span class="hl_function">This</span><span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;dwWidth<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;dwHeight<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;dwBPP<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;dwRefreshRate<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;dwFlags<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;rEsp<span class="hl_char">,</span>&nbsp;<span class="hl_function">void</span><span class="hl_char">*</span>&nbsp;fOrigin<span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HRESULT&nbsp;hResult&nbsp;<span class="hl_char">=</span>&nbsp;DD_OK<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>запоминаем&nbsp;выбранные&nbsp;приложением&nbsp;ширину&nbsp;и&nbsp;высоту</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;glOriginalWidth&nbsp;<span class="hl_char">=</span>&nbsp;dwWidth<span class="hl_char">,</span>&nbsp;glOriginalHeight&nbsp;<span class="hl_char">=</span>&nbsp;dwHeight<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>Наши&nbsp;характеристики&nbsp;устанавливаемого&nbsp;режима</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;dwOurWidth&nbsp;<span class="hl_char">=</span><span class="hl_number">1920</span><span class="hl_char">,</span>&nbsp;dwOurHeight&nbsp;<span class="hl_char">=</span><span class="hl_number">1080</span><span class="hl_char">,</span>&nbsp;dwOurRefreshRate&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">75</span><span class="hl_char">/</span><span class="hl_char">*</span>если&nbsp;поддерживает&nbsp;видеокарта&nbsp;с&nbsp;монитором<span class="hl_char">*</span><span class="hl_char">/</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>char</b></span>&nbsp;s<span class="hl_char">[</span>0x1000<span class="hl_char">]</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hResult&nbsp;<span class="hl_char">=</span>&nbsp;CallHookedInterfaceFunc<span class="hl_char">(</span>fOrigin<span class="hl_char">,</span>&nbsp;<span class="hl_function">This</span><span class="hl_char">,</span>&nbsp;dwOurWidth<span class="hl_char">,</span>&nbsp;dwOurHeight<span class="hl_char">,</span>&nbsp;dwBPP<span class="hl_char">,</span>&nbsp;dwRefreshRate<span class="hl_char">,</span>&nbsp;dwFlags<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__asm&nbsp;<span class="hl_function"><b>sub</b></span>&nbsp;<span class="hl_registr">esp</span><span class="hl_char">,</span>&nbsp;0x1C<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>hResult&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;DD_OK<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;hResult<span class="hl_comment">;</span></li><li class="hl_l1">}</li>        </ol>
    </div>
</div></div>
<br><br>Если используется DirectDraw2 или DirectDraw4, следует аналогичным образом установить хуки на нужные методы используемого интерфейса.<br><br>Функция вызова оригинального метода<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">__declspec<span class="hl_char">(</span>naked<span class="hl_char">)</span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;__stdcall&nbsp;CallHookedInterfaceFunc<span class="hl_char">(</span><span class="hl_function">void</span><span class="hl_char">*</span>&nbsp;Func<span class="hl_char">,</span>&nbsp;<span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__asm</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>xchg</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">esp</span><span class="hl_char">]</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jmp</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">}</li>        </ol>
    </div>
</div></div>
<br><br>Установить режим - это ещё не всё. В коде исполняемого файла игры и её библиотек во многих местах могут быть прописаны относительные и абсолютные размеры экрана, графических объектов. И в лучшем случае выводиться будет на левую верхнюю часть экрана, а нижняя и правая части останутся нетронутыми. Чтобы изображение растянулось, и потребуются два установленных хука: на IDirectDrawSurface::GetAttachedSurface и IDirectDrawSurface::Flip. Первый метод получает поверхность(или поверхности, которых может быть несколько), присоединённую к экрану, с которой готовый результат копируется на экран вторым методом IDirectDrawSurface::Flip. Такие поверхности называются в DirectX бэкбуферами.
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=316465&amp;user=24257&amp;forum_n=5&amp;topic=20640&amp;page=0&amp;anchor=26" class="addthx" data-post="316465"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=24498" title="29-12-2012 16:12, ранг:9.6" target="_blank">mdscorp</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="27" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 221thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 декабря 2012 10:01 <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#27" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=20640&amp;page=0#27');return false;">#27</a> </span><div align=left><br>
Идея перехватов IDirectDrawSurface::GetAttachedSurface и IDirectDrawSurface::Flip состоит в том, чтобы при получении приложением бэкбуфера подсунуть созданную нами промежуточную поверхность с теми размерами, которые приложение ставит в вызове метода IDirectDraw::SetDisplayMode, чтобы при переключении приложением бэкбуферов методом IDirectDrawSurface::Flip перед этим скопировать с внедрённой промежуточной на действительный бэкбуфер всю подготовленную приложением графику методом IDirectDrawSurface::Blt, который при передаче NULL в качестве исходного и целевого прямоугольников производит автоматическое растягивание.<br><br>Перехваты нужных методов работы с поверхностями будут выглядеть так<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">LPDIRECTDRAWSURFACE&nbsp;pBackSurf<span class="hl_char">,</span>&nbsp;pMidSurf<span class="hl_comment">;</span></li><li class="hl_l1">HRESULT&nbsp;__stdcall&nbsp;IDirectDrawSurface_GetAttachedSurfaceHookPre<span class="hl_char">(</span>LPDIRECTDRAWSURFACE&nbsp;<span class="hl_function">This</span><span class="hl_char">,</span>&nbsp;DDSCAPS<span class="hl_char">*</span>&nbsp;pDDSCaps<span class="hl_char">,</span>&nbsp;LPDIRECTDRAWSURFACE<span class="hl_char">*</span>&nbsp;ppDDSurf<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;rEsp<span class="hl_char">,</span>&nbsp;<span class="hl_function">void</span><span class="hl_char">*</span>&nbsp;fOrigin<span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HRESULT&nbsp;hResult&nbsp;<span class="hl_char">=</span>&nbsp;DD_OK<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hResult&nbsp;<span class="hl_char">=</span>&nbsp;CallHookedInterfaceFunc<span class="hl_char">(</span>fOrigin<span class="hl_char">,</span>&nbsp;<span class="hl_function">This</span><span class="hl_char">,</span>&nbsp;pDDSCaps<span class="hl_char">,</span>&nbsp;ppDDSurf<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__asm&nbsp;<span class="hl_function"><b>sub</b></span>&nbsp;<span class="hl_registr">esp</span><span class="hl_char">,</span>&nbsp;0x10<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>hResult&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;DD_OK<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pBackSurf&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">*</span>ppDDSurf<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DDSURFACEDESC&nbsp;pMidSurfDesc</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZeroMemory<span class="hl_char">(</span><span class="hl_char">&amp;</span>pMidSurfDesc<span class="hl_char">,</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>DDSURFACEDESC<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pMidSurfDesc<span class="hl_char">.</span>dwSize&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>DDSURFACEDESC<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pMidSurfDesc<span class="hl_char">.</span>dwFlags&nbsp;<span class="hl_char">=</span>&nbsp;DDSD_HEIGHT&nbsp;<span class="hl_char">|</span>&nbsp;DDSD_WIDTH&nbsp;<span class="hl_char">|</span>&nbsp;DDSD_CAPS<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pMidSurfDesc<span class="hl_char">.</span>dwWidth&nbsp;<span class="hl_char">=</span>&nbsp;glOriginalWidth<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pMidSurfDesc<span class="hl_char">.</span>dwHeight&nbsp;<span class="hl_char">=</span>&nbsp;glOriginalHeight<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pMidSurfDesc<span class="hl_char">.</span>ddsCaps<span class="hl_char">.</span>dwCaps&nbsp;<span class="hl_char">=</span>&nbsp;DDSCAPS_OFFSCREENPLAIN&nbsp;<span class="hl_char">|</span>&nbsp;DDSCAPS_SYSTEMMEMORY<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>Приложение&nbsp;теперь&nbsp;будет&nbsp;копировать&nbsp;графику&nbsp;не&nbsp;в&nbsp;бэкбуфер<span class="hl_char">,</span>&nbsp;а&nbsp;в&nbsp;промежуточную&nbsp;поверхность</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hResult&nbsp;<span class="hl_char">=</span>&nbsp;lpDD<span class="hl_char">-</span><span class="hl_char">&gt;</span>CreateSurface<span class="hl_char">(</span><span class="hl_char">&amp;</span>pMidSurfDesc<span class="hl_char">,</span>&nbsp;ppDDSurf<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pMidSurf&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">*</span>ppDDSurf<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;hResult<span class="hl_comment">;</span></li><li class="hl_l0">}</li><li class="hl_l1">&nbsp;</li>        </ol>
    </div>
</div></div>
<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">HRESULT&nbsp;__stdcall&nbsp;IDirectDrawSurface_FlipHookPre<span class="hl_char">(</span>LPDIRECTDRAWSURFACE&nbsp;<span class="hl_function">This</span><span class="hl_char">,</span>&nbsp;LPDIRECTDRAWSURFACE&nbsp;lpTargetSurf<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;dwFlags<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;rEsp<span class="hl_char">,</span>&nbsp;<span class="hl_function">void</span><span class="hl_char">*</span>&nbsp;fOrigin<span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HRESULT&nbsp;hResult&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RECT&nbsp;rDest<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DDBLTFX&nbsp;BltFx<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZeroMemory<span class="hl_char">(</span><span class="hl_char">&amp;</span>BltFx<span class="hl_char">,</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>DDBLTFX<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BltFx<span class="hl_char">.</span>dwSize&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>DDBLTFX<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hResult&nbsp;<span class="hl_char">=</span>&nbsp;pBackSurf4<span class="hl_char">-</span><span class="hl_char">&gt;</span>Blt<span class="hl_char">(</span><span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;pMidSurf<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;DDBLT_WAIT<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>BltFx<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hResult&nbsp;<span class="hl_char">=</span>&nbsp;CallHookedInterfaceFunc<span class="hl_char">(</span>fOrigin<span class="hl_char">,</span>&nbsp;<span class="hl_function">This</span><span class="hl_char">,</span>&nbsp;lpTargetSurf<span class="hl_char">,</span>&nbsp;dwFlags<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__asm&nbsp;<span class="hl_function"><b>sub</b></span>&nbsp;<span class="hl_registr">esp</span><span class="hl_char">,</span>&nbsp;0x10<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;hResult<span class="hl_comment">;</span></li><li class="hl_l0">}</li>        </ol>
    </div>
</div></div>
<br><br>Собственно и всё. Может где-то пропустил объявление переменных - в свободное время пройдусь по написанному пару раз, вставлю, поправлю. В случае, если приложение получает не один бэкбуфер, а больше, то следует организовать массивы бэкбуферов и соответствующих им промежуточных поверхностей, а в коде перехвата Flip() смотреть для какой поверхности Flip вызывается, на соответствующий бэкбуфер и будет выполняться копирование графики.
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=316466&amp;user=24257&amp;forum_n=5&amp;topic=20640&amp;page=0&amp;anchor=27" class="addthx" data-post="316466"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="28" onfocus="this.blur()" href="JavaScript:di('[b]aspirin[/b]','')">aspirin</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/5336.gif" alt=""><br><span class=txtSm>Ранг: 111.0 (ветеран), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.05'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=5336">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 31 декабря 2012 17:10 &middot; Поправил: aspirin <br><script type="text/javascript">QU('aspirin','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=aspirin" target="_blank">Личное сообщение</a> &middot;  <a href="#28" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=20640&amp;page=0#28');return false;">#28</a> </span><div align=left><br>
<b>DenCoder</b><br>Ваше решение выглядит в общем-то серьёзно. Если это всё будет работать, тогда программистам из <b>Акеллы</b> есть, чему поучиться в ответах этого топа. Т.к. когда я обращался в тех. поддержку года 2 назад, мне сказали, что ничего сделать, в принципе, невозможно в данном случае.<br>Сам я только немного играюсь с кодом в консольных приложениях на сях++, как мне всё это скомпелировать в одно решение?
<br><br><font size="1"><i>-----<br>Ламер - не профессия :))</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=316581&amp;user=5336&amp;forum_n=5&amp;topic=20640&amp;page=0&amp;anchor=28" class="addthx" data-post="316581"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="29" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 221thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 31 декабря 2012 19:11 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#29" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=20640&amp;page=0#29');return false;">#29</a> </span><div align=left><br>
<I>aspirin пишет:<br>Если это всё будет работать </I><br>Ну у меня же работало. ) Правда была немного другая задача - сжать окно с графикой немного и добавить 2 окошка - вверху и справа. Метод разработал сам, пройдя вводный курс в DirectX. Одна проблема при таком способе возможна - нелинейность изображения, так как его растянули, квадрат будет прямоугольником, а круг эллипсом. Не сомневаюсь, можно это как-то улучшить. Но для этого надо основательно покопаться в коде игры.<br><br><I>aspirin пишет:<br>Сам я только немного играюсь с кодом в консольных приложениях на сях++, как мне всё это скомпелировать в одно решение? </I><br>dll. Но сначала поиграйтесь с DirectX, оно ещё интересней ) http://netlib.narod.ru/category.htm?1240<br><br><I>aspirin пишет:<br>программистам из Акеллы есть, чему поучиться в ответах этого топа. </I><br>Ну, тут дело не в грамотности программистов, а в желании! Никто не будет <b>бесплатно</b> поддерживать <b>старый</b> проект! Максимум, чего можно ждать от разработчиков - какой-нибудь ремейк.
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=316592&amp;user=24257&amp;forum_n=5&amp;topic=20640&amp;page=0&amp;anchor=29" class="addthx" data-post="316592"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="30" onfocus="this.blur()" href="JavaScript:di('[b]Rustem[/b]','')">Rustem</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 74.1 (постоянный), 34thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.41'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1301">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 января 2013 12:26 &middot; Поправил: Rustem <br><script type="text/javascript">QU('Rustem','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Rustem" target="_blank">Личное сообщение</a> &middot;  <a href="#30" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=20640&amp;page=0#30');return false;">#30</a> </span><div align=left><br>
<b>DenCoder</b><br><br>Чтобы не гадать какой директ используется, можно посмотреть вызовы этой утилитой, <br>http://blackninja2000.narod.ru/rus/directx_logger.html<br><br>Кстати поддерживаются плагины, которые позволяют сразу реагировать на вызов функций, а не возится самому с хуками и интерфейсами<br>Там есть пример плагина под игру мдк
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=316686&amp;user=1301&amp;forum_n=5&amp;topic=20640&amp;page=0&amp;anchor=30" class="addthx" data-post="316686"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> .  <b>1</b> . <a href="action=vthread&amp;forum=5&amp;topic=20640&amp;page=1.html">2</a> . <a href="action=vthread&amp;forum=5&amp;topic=20640&amp;page=2.html">3</a> . <a href="action=vthread&amp;forum=5&amp;topic=20640&amp;page=1.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/nub.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=5&sortBy=0&page=0.html"><b>Вопросы новичков</b></a> <b class=bulletHead>&#8212;&#8250;</b> Как научить видеть игру широкоформатные мониторы?</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#31" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="5">
<input type="hidden" name="topic" value="20640">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=20640" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
