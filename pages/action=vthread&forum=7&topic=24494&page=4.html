<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>syser - а он еще нужен? - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="есть мысль себе в портфолио добавить хоть что то, что можно показать на паблик из всего что сделано или делается или будет делаться, почти ничего на паблик показывать нельзя вспомнил про Syser,его можно, могу восстановить соурсы">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=55914'>Kybyx</a> (+2 невидимых)</b></span>
</td>
</tr>
</table>

 

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/mod.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=7&sortBy=0&page=0.html"><b>Оффтоп</b></a> <b class=bulletHead>&#8212;&#8250;</b> syser - а он еще нужен?</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> <a href="action=vthread&amp;forum=7&amp;topic=24494&amp;page=3.html">&lt;&lt;</a> .  <a href="action=vthread&amp;forum=7&amp;topic=24494&amp;page=0.html">1</a> . <a href="action=vthread&amp;forum=7&amp;topic=24494&amp;page=1.html">2</a> . <a href="action=vthread&amp;forum=7&amp;topic=24494&amp;page=2.html">3</a> . <a href="action=vthread&amp;forum=7&amp;topic=24494&amp;page=3.html">4</a> . <b>5</b> . <a href="action=vthread&amp;forum=7&amp;topic=24494&amp;page=5.html">6</a> . <a href="action=vthread&amp;forum=7&amp;topic=24494&amp;page=5.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]reversecode[/b]','')">reversecode</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/15381.gif" alt=""><br><span class=txtSm>Ранг: 1053.6 <b><u>(!!!!)</u></b>, 1078thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.43'>Активность: 1.06<span style='color:red'>&searr;</span>0.81</span><br>Статус: <a href="action=userinfo&amp;user=15381">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 декабря 2016 00:08 <br><script type="text/javascript">QU('reversecode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=reversecode" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=24494&amp;page=4#1');return false;">#1</a> </span><div align=left><br>
есть мысль себе в портфолио добавить хоть что то, что можно показать на паблик<br>из всего что сделано или делается или будет делаться, почти ничего на паблик показывать нельзя<br>вспомнил про Syser,его можно, могу восстановить соурсы ядра дебагера, которое общее для Ring3 и Ring0<br>(кто помнит у Syser два дебагера, ring3 и ring0, знают все только ring0, про ring3 мало наверное кто помнит, он был бесплатен)<br>ну и сам Ring3 часть как рабочий дебагер, можно и всю Ring0, но мне это не интересно<br>ну и все конечно на гитхаб<br><br>собственно вопрос, а дальше это кому то интересно? подхватить,развивать итд, гуи дебагер для ядра еще живы ?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=370403&amp;user=15381&amp;forum_n=7&amp;topic=24494&amp;page=4&amp;anchor=1" class="addthx" data-post="370403"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]shellstorm[/b]','')">shellstorm</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: -0.7 (гость), 170thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 3.69'>Активность: 0.54<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=41575">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 16 мая 2017 08:45 &middot; Поправил: shellstorm <br><script type="text/javascript">QU('shellstorm','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=shellstorm" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=24494&amp;page=4#2');return false;">#2</a> </span><div align=left><br>
<I>reversecode пишет: да там код простой до безобразия </I><br><br>При O2 нормальный код будет и скорее всего заинлайнится.<br>Тестил на 2008 все сводится к cmp byte [esi],bl  setn al.<br>Вот так лучше не делать bool CALLME(void *Buffer, int i ). void* это хз какой тип, поэтому компилятор втыкает регистр под размер адреса, BYTE* существенно меняет картину, CALLME(Buffer|i|) \ CALLME(BYTE Buffer)  еще лучше, компилятор все развернет до 16 битных регистров.<br><br><I>reversecode пишет: я еще помню был жесткий баг в ГЦЦ как миниум </I><br><br>Тоже писал багрепорт, версия GCC если не изменяет память была 4.3 не всегда корректно разворачивал свитч с if-ми внутри в которых были довольно сложные битовые сравнения, выкидывал часть условия даже с выключенной оптимизацией, что естественно приводило к неработающей программе.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=375877&amp;user=41575&amp;forum_n=7&amp;topic=24494&amp;page=4&amp;anchor=2" class="addthx" data-post="375877"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]reversecode[/b]','')">reversecode</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/15381.gif" alt=""><br><span class=txtSm>Ранг: 1053.6 <b><u>(!!!!)</u></b>, 1078thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.43'>Активность: 1.06<span style='color:red'>&searr;</span>0.81</span><br>Статус: <a href="action=userinfo&amp;user=15381">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 16 мая 2017 09:58 <br><script type="text/javascript">QU('reversecode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=reversecode" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=24494&amp;page=4#3');return false;">#3</a> </span><div align=left><br>
<I>shellstorm пишет:<br>Вот так лучше не делать bool CALLME(void *Buffer, int i ).  </I><br>что значит не делать, это аля memcpy который то char* то long* может использовать<br><br><b>Добавлено спустя 8 минут</b><br>что там лежит в стеке сразу после фолта ?<br>+8 CS<br>+4 EIP<br>+0 ERROR<br><br>так ?<br><br>push    0Eh<br>call    _HandleInterrupt_sub_19FFC<br>lea     esp, [esp+4]<br><br>ничего не меняет, стек остался на месте<br><br>pushf   +4<br>pusha +20<br>затолкали флаги и регистры +24<br><br>дальше забираем указатель на наш стек<br>mov     ebp, esp<br><br>и увеличиваем стаек на два дворда <br>lea     esp, [esp-8]<br><br>в первый записываем указатель на стек<br>mov     [ebp-4], ebp<br>во второй адрес фолта<br>mov     eax, cr2<br>mov     [ebp-8], eax<br><br>и переползаем по указателю на стек в верх<br>add     dword ptr [ebp-4], 28h<br><br><br>и ... вот здесь я не понял. где мы в итоге на dword ptr [ebp-4] оказываемся ?<br>+24h мы пропускаем все флаги+регистры <br>+4 еще выше поднимаемся по фловому фрему, получается на сам EIP ? если так то дальше не складывается...<br><br>а если так то дальше в логике все ок,<br>должны быть на указателе на стеке с ошибкой<br>тогда<br>mov     eax, [ebp-4] это указатель на стек с ошибкой<br>push    dword ptr [eax] сама ошибка<br><br><br>а уже в функции<br>call    _from_int_14_sub_62076<br>выгребается с [eax+4] уже EIP
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=375878&amp;user=15381&amp;forum_n=7&amp;topic=24494&amp;page=4&amp;anchor=3" class="addthx" data-post="375878"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]spinz[/b]','')">spinz</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 50.0 (постоянный), 31thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.72'>Активность: 0.09<span style='color:green'>&nearr;</span>0.1</span><br>Статус: <a href="action=userinfo&amp;user=22831">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 16 мая 2017 10:29 <br><script type="text/javascript">QU('spinz','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=spinz" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=24494&amp;page=4#4');return false;">#4</a> </span><div align=left><br>
<I>reversecode пишет:<br>+4 еще выше поднимаемся по фловому фрему, получается на сам EIP ? если так то дальше не складывается...<br> </I><br><br>Так вот выходит, что не складывается.<br><br>Если, конечно,  _HandleInterrupt_sub_19FFC не манипулирует с esp
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=375880&amp;user=22831&amp;forum_n=7&amp;topic=24494&amp;page=4&amp;anchor=4" class="addthx" data-post="375880"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]reversecode[/b]','')">reversecode</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/15381.gif" alt=""><br><span class=txtSm>Ранг: 1053.6 <b><u>(!!!!)</u></b>, 1078thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.43'>Активность: 1.06<span style='color:red'>&searr;</span>0.81</span><br>Статус: <a href="action=userinfo&amp;user=15381">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 16 мая 2017 13:16 <br><script type="text/javascript">QU('reversecode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=reversecode" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=24494&amp;page=4#5');return false;">#5</a> </span><div align=left><br>
не меняет<br>это обычная функа для сохранения контекста цпу под свои нужды<br>https://pastebin.com/90fbx2K5<br><br>либо что то с трап фреймом недопонимаю...<br>над будет загнать в компилером этот код и пройтись отладчиком по этим стековым манипуляциям
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=375883&amp;user=15381&amp;forum_n=7&amp;topic=24494&amp;page=4&amp;anchor=5" class="addthx" data-post="375883"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]spinz[/b]','')">spinz</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 50.0 (постоянный), 31thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.72'>Активность: 0.09<span style='color:green'>&nearr;</span>0.1</span><br>Статус: <a href="action=userinfo&amp;user=22831">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 16 мая 2017 15:06 <br><script type="text/javascript">QU('spinz','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=spinz" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=24494&amp;page=4#6');return false;">#6</a> </span><div align=left><br>
выложи листинг функи  _from_int_14_sub_62076 целиком
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=375885&amp;user=22831&amp;forum_n=7&amp;topic=24494&amp;page=4&amp;anchor=6" class="addthx" data-post="375885"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]reversecode[/b]','')">reversecode</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/15381.gif" alt=""><br><span class=txtSm>Ранг: 1053.6 <b><u>(!!!!)</u></b>, 1078thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.43'>Активность: 1.06<span style='color:red'>&searr;</span>0.81</span><br>Статус: <a href="action=userinfo&amp;user=15381">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 16 мая 2017 15:39 <br><script type="text/javascript">QU('reversecode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=reversecode" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=24494&amp;page=4#7');return false;">#7</a> </span><div align=left><br>
https://pastebin.com/hhc2XSx8<br>собственно зачем это все затеяно<br>хотелось понять что за данные приходят в функу call    dword ptr [eax+44h], которая является обработчиком с цикле дебаг ядра в сисере<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">00062147</span>&nbsp;<span class="hl_number">028</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">ebp</span><span class="hl_char">+</span>Pa3<span class="hl_char">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">&lt;</span><span class="hl_char">-</span><span class="hl_char">-</span>&nbsp;<span class="hl_char">?</span><span class="hl_char">?</span><span class="hl_char">?</span><span class="hl_char">?</span>&nbsp;</li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">0006214A</span>&nbsp;<span class="hl_number">028</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">?</span>gpSyser@@3PAVCSyser@@A&nbsp;<span class="hl_comment">; CSyser * gpSyser</span></li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">00062150</span>&nbsp;<span class="hl_number">028</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">edx</span><span class="hl_char">+</span><span class="hl_number">4</span><span class="hl_char">]</span>&nbsp;&nbsp;<span class="hl_char">&lt;</span><span class="hl_char">-</span><span class="hl_char">-</span>&nbsp;<span class="hl_char">-</span><span class="hl_char">?</span><span class="hl_char">?</span><span class="hl_char">?</span><span class="hl_char">?</span></li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">00062153</span>&nbsp;<span class="hl_number">02C</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>add</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">25CBCh</span></li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">00062159</span>&nbsp;<span class="hl_number">02C</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">[</span><span class="hl_registr">ebp</span><span class="hl_char">+</span>Address<span class="hl_char">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">&lt;</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span>&nbsp;CR2<span class="hl_char">?</span><span class="hl_char">?</span><span class="hl_char">?</span></li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">0006215C</span>&nbsp;<span class="hl_number">030</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">ecx</span><span class="hl_char">]</span></li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">0006215E</span>&nbsp;<span class="hl_number">030</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>call</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">eax</span><span class="hl_char">+</span><span class="hl_number">44h</span><span class="hl_char">]</span></li>        </ol>
    </div>
</div></div>
<br><br>один аргумент это адрес фолта cr2<br>а вот второй это тот eax который является аргументом Pa3 и который берется [edx+4]<br><br>и судя по логике это должен быть EIP<br><br>почему EIP<br>потому что есть еще функа<br>https://pastebin.com/1CaMY17N<br>в которую тоже передается <br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">0006219F</span>&nbsp;<span class="hl_number">038</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">ebp</span><span class="hl_char">-</span><span class="hl_number">4</span><span class="hl_char">]</span></li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">000621A2</span>&nbsp;<span class="hl_number">03C</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>call</b></span>&nbsp;&nbsp;&nbsp;&nbsp;_find_hook_sub_61FE8</li>        </ol>
    </div>
</div></div>
<br>и в которой [eax+4] уже черпается EIP адреса функций из самого сисера<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">00061FE8</span>&nbsp;<span class="hl_number">000</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">esp</span><span class="hl_char">+</span>arg_0<span class="hl_char">]</span></li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">00061FEC</span>&nbsp;<span class="hl_number">000</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">ecx</span><span class="hl_char">+</span><span class="hl_number">4</span><span class="hl_char">]</span></li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">00061FEF</span>&nbsp;<span class="hl_number">000</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cmp</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>offset</b></span>&nbsp;_READ_B_sub_445F0</li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">00061FF4</span>&nbsp;<span class="hl_number">000</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jbe</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>short</b></span>&nbsp;loc_61FFF</li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">00061FF6</span>&nbsp;<span class="hl_number">000</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>offset</b></span>&nbsp;_READ_B_END_sub_44626</li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">00061FFB</span>&nbsp;<span class="hl_number">000</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cmp</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">edx</span></li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">00061FFD</span>&nbsp;<span class="hl_number">000</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jb</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>short</b></span>&nbsp;loc_6206A</li>        </ol>
    </div>
</div></div>
<br>вот по логике вроде так<br>а по математике не сходятся подсчеты со стеком<br><br>либо в стеке после фолта данные как то не так ложатся.. я хз, вроде гуглил но не нашел описания фолтового фрейма<br><br><b>Добавлено спустя 14 часов 16 минут</b><br>все таки наверное я ошибся<br>это не чистые функи с IDT<br>это патченные,  потому что в этих нет вызова оригинальных виндовых....
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=375886&amp;user=15381&amp;forum_n=7&amp;topic=24494&amp;page=4&amp;anchor=7" class="addthx" data-post="375886"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]spinz[/b]','')">spinz</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 50.0 (постоянный), 31thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.72'>Активность: 0.09<span style='color:green'>&nearr;</span>0.1</span><br>Статус: <a href="action=userinfo&amp;user=22831">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 мая 2017 07:58 <br><script type="text/javascript">QU('spinz','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=spinz" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=24494&amp;page=4#8');return false;">#8</a> </span><div align=left><br>
Вроде разобрался.<br>Еще до первой команды хэндлера - push    0Eh - где-то происходит уменьшение указателя стека на 4.<br>Это становится очевидно, если взглянуть на конец функции:<br>popa<br>popf<br>lea     esp, [esp+8]<br>or      dword ptr [esp+8], 100h<br>iret<br>Т.е. после popf указатель стека указывает не на код ошибки, а на 4 байта ниже.<br>Поэтому всё правильно - после add dword ptr [ebp-4], 28h в [ebp-4] указатель на код ошибки, а не на EIP.<br>Получается, что после фолта до выполнения этого кода выполняется что-то еще.<br><br>P.S.<br>Очень интересно зачем сисер при возврате из обработчика PF# устанавливает TF в образе EFLAGS в стеке<br>(or      dword ptr [esp+8], 100h)
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=375897&amp;user=22831&amp;forum_n=7&amp;topic=24494&amp;page=4&amp;anchor=8" class="addthx" data-post="375897"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]shellstorm[/b]','')">shellstorm</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: -0.7 (гость), 170thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 3.69'>Активность: 0.54<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=41575">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 мая 2017 12:47 <br><script type="text/javascript">QU('shellstorm','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=shellstorm" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=24494&amp;page=4#9');return false;">#9</a> </span><div align=left><br>
<I>reversecode пишет:что значит не делать, это аля memcpy который то char* то long* может использовать </I><br><br>Так кода же не видел и сужу лишь по описанию.<br><I>reversecode пишет:нужно пробежаться по void * буферу как байтовому, и найти байты СС </I><br><I>reversecode пишет:char BUFFER[10]; </I>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=375903&amp;user=41575&amp;forum_n=7&amp;topic=24494&amp;page=4&amp;anchor=9" class="addthx" data-post="375903"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]reversecode[/b]','')">reversecode</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/15381.gif" alt=""><br><span class=txtSm>Ранг: 1053.6 <b><u>(!!!!)</u></b>, 1078thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.43'>Активность: 1.06<span style='color:red'>&searr;</span>0.81</span><br>Статус: <a href="action=userinfo&amp;user=15381">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 мая 2017 17:40 &middot; Поправил: reversecode <br><script type="text/javascript">QU('reversecode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=reversecode" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=24494&amp;page=4#10');return false;">#10</a> </span><div align=left><br>
оказывается в сисере можно закладками дата вью и коде вью открывать<br>могу и альфу для тестов сбилдить если кому захочется позапускать<br>бп ставить по коду можно, степ трейсы работают....<br>окна стека и вотча еще пустые....<br>десяток не очень нужных комманд наполнить... типа скопировать память, сравнить память итд<br>и попап меню с дата вьюва еще не работает<br>и окно брекоинтов расширенное еще пустует.. <br>донабить и можно релизить <br><br><img src="http://meson.ad-l.ink/6j4tyNS25/image.png" border="0" align="" alt=""><br><br><b>Добавлено спустя 7 минут</b><br><I>spinz пишет:<br>Очень интересно зачем сисер при возврате из обработчика PF# устанавливает TF в образе EFLAGS в стеке </I><br>может поймать трапом обработку<br><br>пока копал ring0, нашел что там есть branch tf который ставят в MSR<br>интересная штука... только в ring3 там заглушка... <br>нашел что можно вроде и в ring3 такое запустить<br>http://www.openrce.org/blog/view/535/Branch_Tracing_with_Intel_MSR_Registers<br>надо будет попробовать заимплементить<br><br>хотя можно же и софтово реализовать ? дизасмом смотреть опкоды бранчей и генерить брекпоинт<br><br><b>Добавлено спустя 2 часа 3 минуты</b><br>печаль<br>гугл пишет что NtSystemDebugControl на win7 x64 уже не пашет.. <br>http://rsdn.org/forum/winapi/4421811.hot<br><br><b>Добавлено спустя 2 часа 9 минут</b><br>и в тоже время народ пишет что <br><br><i class=x>and here a link to an article about the easy ring3 method:<br>http://fdbg.x86asm.net/article_DebugCtlMSR_backdoor_in_win64.txt<br>a bit long reading, so in shortcut: for enabling branches in win x64, just set some bits in  debug 7 register (DR7.LE, DR7.GE). That&#039;s all ! Simple, huh? Unbelievable and funny? No, that way really works under current versions of x64 windows.</i><br><br>т.е. через DR7 у них работает<br>интересно а на 32битах ....<br><br>dr7 под ring3 же доступен насколько я помню ?...<br><br><b>Добавлено спустя 2 часа 21 минуту</b><br>https://github.com/x64dbg/x64dbg/issues/227<br>https://www.codeproject.com/Articles/517466/Last-branch-records-and-branch-tracing<br>http://www.rcollins.org/secrets/DR7.html<br>сохраню для себя
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=375911&amp;user=15381&amp;forum_n=7&amp;topic=24494&amp;page=4&amp;anchor=10" class="addthx" data-post="375911"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]spinz[/b]','')">spinz</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 50.0 (постоянный), 31thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.72'>Активность: 0.09<span style='color:green'>&nearr;</span>0.1</span><br>Статус: <a href="action=userinfo&amp;user=22831">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 мая 2017 06:37 <br><script type="text/javascript">QU('spinz','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=spinz" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=24494&amp;page=4#11');return false;">#11</a> </span><div align=left><br>
<I>reversecode пишет:<br>может поймать трапом обработку </I><br>Т.е. сисер зачем-то трапит инструкцию, вызвавшую PF#<br>Непонятно зачем.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=375950&amp;user=22831&amp;forum_n=7&amp;topic=24494&amp;page=4&amp;anchor=11" class="addthx" data-post="375950"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]reversecode[/b]','')">reversecode</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/15381.gif" alt=""><br><span class=txtSm>Ранг: 1053.6 <b><u>(!!!!)</u></b>, 1078thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.43'>Активность: 1.06<span style='color:red'>&searr;</span>0.81</span><br>Статус: <a href="action=userinfo&amp;user=15381">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 мая 2017 07:25 &middot; Поправил: reversecode <br><script type="text/javascript">QU('reversecode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=reversecode" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=24494&amp;page=4#12');return false;">#12</a> </span><div align=left><br>
механизм TF на выходе как я понимаю должен использоваться к обработке BP через PF# где я раньше спрашивал<br>если посмотреть то TF ставится если функа _from_int_14_sub_62076 возвращает 1<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">000621C3</span>&nbsp;<span class="hl_number">038</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">ebp</span><span class="hl_char">-</span><span class="hl_number">4</span><span class="hl_char">]</span></li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">000621C6</span>&nbsp;<span class="hl_number">038</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">000621C7</span>&nbsp;<span class="hl_number">03C</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">eax</span><span class="hl_char">]</span></li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">000621C9</span>&nbsp;<span class="hl_number">040</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">ebp</span><span class="hl_char">-</span><span class="hl_number">8</span><span class="hl_char">]</span></li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">000621CC</span>&nbsp;<span class="hl_number">044</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>call</b></span>&nbsp;&nbsp;&nbsp;&nbsp;_from_int_14_sub_62076</li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">000621D1</span>&nbsp;<span class="hl_number">038</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>test</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">al</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">al</span></li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">000621D3</span>&nbsp;<span class="hl_number">038</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jz</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>short</b></span>&nbsp;loc_621EC</li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">000621D5</span>&nbsp;<span class="hl_number">038</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>pop</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">fs</span></li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">000621D7</span>&nbsp;<span class="hl_number">034</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>pop</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">es</span></li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">000621D8</span>&nbsp;<span class="hl_number">030</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>pop</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">ds</span></li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">000621D9</span>&nbsp;<span class="hl_number">02C</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lea</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">esp</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">esp</span><span class="hl_char">+</span><span class="hl_number">8</span><span class="hl_char">]</span></li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">000621DD</span>&nbsp;<span class="hl_number">024</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">popa</span></li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">000621DE</span>&nbsp;<span class="hl_number">004</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">popf</span></li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">000621DF</span>&nbsp;<span class="hl_number">000</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lea</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">esp</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">esp</span><span class="hl_char">+</span><span class="hl_number">8</span><span class="hl_char">]</span></li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">000621E3</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">08</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>or</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">esp</span><span class="hl_char">+</span><span class="hl_number">8</span><span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">100h</span></li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">000621EB</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">08</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">iret</span></li>        </ol>
    </div>
</div></div>
<br>а 1 она возвращает только когда находит что то там в каком то своем списке (возможно расширенные BP)<br>https://pastebin.com/kSXqF199<br>и по TF она уже попадет в свой int1 или int3 трап<br>где видимо как то продолжит обработку BP<br><br><b>Добавлено спустя 18 часов 56 минут</b><br>в чем магический смысл<br>0xCC<br>и<br>0xCD 0x03<br> <br>только в размерности ? проц одинаково их обрабатывает ?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=375951&amp;user=15381&amp;forum_n=7&amp;topic=24494&amp;page=4&amp;anchor=12" class="addthx" data-post="375951"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]reversecode[/b]','')">reversecode</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/15381.gif" alt=""><br><span class=txtSm>Ранг: 1053.6 <b><u>(!!!!)</u></b>, 1078thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.43'>Активность: 1.06<span style='color:red'>&searr;</span>0.81</span><br>Статус: <a href="action=userinfo&amp;user=15381">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 июня 2017 20:48 &middot; Поправил: reversecode <br><script type="text/javascript">QU('reversecode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=reversecode" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=24494&amp;page=4#13');return false;">#13</a> </span><div align=left><br>
кручу верчу ring0 сисер<br>обдумываю сколько усилий нужно что бы добить до ring0<br><br>что бы нарисовать сисер в ring0<br>0) переписать std::map<br>1) графика<br>вроде все просто, банальные хуки функций ддрав<br>2) клава, мышь для емуляции и работа с портам<br>кода много разного, но вроде без асма<br>3) хуки ИДТ (той же клавы и мыши)<br>вот тут наверное сложнее<br>есть асм, и без него никуда, для x86 студия инлан асм поддерживает, а вот что делать для x64, непонятно<br>писать на голом асм лениво<br>смотрел диагонально интрисики, что то есть, но хз есть ли все<br>как минимум iret там нет<br>4) APIC и мульти ядерность<br>вообще забыл эту тему, даже не понимаю еще что там сисер чудил<br>но видно по коду есть в IDT инструкций lock cmp,lock add<br>и не ясно можно ли обойтись без мультиядерности пока просто рисованием и обработкой миши и клавы<br><br><br>для полноценного  дебагера<br>1) куча версий ядер нт, для детекта MiCopyOnWrite<br>вроде даже обычными плюсами обойтись можно, асма нет<br>2) хуки ИДТ для всех остальных int, 1,3,14 и кучу еще всяких по моему даже пустых в реализации<br>без асма вообще никак<br>3) несколько разных заумных функций копирования итд которые разбавленны разным асм кодом, popfd pushfd и прочим<br>врядли без асма обойти<br>4) несколько заумных функций трансляции адреса (наверное)<br>даже если их реверснуть, пока не понятно можно ли будет портировать на x64<br>адресация памяти, место резервации ядер итд, наверняка перебито по новой<br>а по коду много всяких <br>v10 = (4 * (Address &gt;&gt; 22) - 0x3FD00000);<br>v13 = (4 * (Address &gt;&gt; 12) - 0x40000000);<br>v4 = (((Address &gt;&gt; 18) &amp; 0x3FF8) - 0x3FA00000);<br>v4 = (((Address &gt;&gt; 9) &amp; 0x7FFFF8) - 0x40000000);<br>итд и хрен на глаз поймешь зачем это надо<br>5) заумные функции read(b,w,d) write(b,w,d) memcmp итд<br>разбавлены коды возврата через stc clc, без асма вообще хз как такое в С С++ реализовывать<br><br>и самое интересное, я почти уверен что сисер писали только асм инлайнами, как же они повыкручивались там в этих ситуациях..
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=376528&amp;user=15381&amp;forum_n=7&amp;topic=24494&amp;page=4&amp;anchor=13" class="addthx" data-post="376528"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=17432" title="03-06-2017 02:23, ранг:455.0" target="_blank">ClockMan</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 221thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 июня 2017 02:23 <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=24494&amp;page=4#14');return false;">#14</a> </span><div align=left><br>
<b>reversecode</b>, ты постарался от души и спасаешь меня как-то! <img src="img/smilies/s1.gif" alt=""><br>Когда мне будет нечего читать - ты меня уже выручил! ))<br>Когда мне будет нечего реверсить - вспомни, я сюда пришёл из-за этого бажного инструмента. <img src="img/smilies/s5.gif" alt=""><br>Когда мне будет нечего писать - я помогу тебе <img src="img/smilies/s2.gif" alt="">
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=376537&amp;user=24257&amp;forum_n=7&amp;topic=24494&amp;page=4&amp;anchor=14" class="addthx" data-post="376537"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]reversecode[/b]','')">reversecode</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/15381.gif" alt=""><br><span class=txtSm>Ранг: 1053.6 <b><u>(!!!!)</u></b>, 1078thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.43'>Активность: 1.06<span style='color:red'>&searr;</span>0.81</span><br>Статус: <a href="action=userinfo&amp;user=15381">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 июня 2017 12:25 &middot; Поправил: reversecode <br><script type="text/javascript">QU('reversecode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=reversecode" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=24494&amp;page=4#15');return false;">#15</a> </span><div align=left><br>
замысловато ты написал, я даже не понял хорошо это или плохо<br>помню что ты боролся  с сисером и его #PF<br>но бажность сисера не в этих асм закрутках<br>а в невнимательности логики использования своих же указателей<br>например у меня сисер часто валился на калькуляторе, видимо какие то деления на ноль, не разбирался<br>потом есть всякие использование не проинициализированых указателей,<br>поклацать на отображения айпи в дизасме, и он валится<br>итд<br>в своей версии фикшу, если такое нахожу в оригинальной<br><br><br>вообщем хочется степ бранчей<br>полез в гугл<br>нашел что dbgeng.dll умеет<br>dbgeng.h<br>#define DEBUG_STATUS_STEP_BRANCH  8<br><br>потом залез в саму длл<br>покопал чуток<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>int</b></span>&nbsp;__thiscall&nbsp;LocalLiveKernelTargetInfo<span class="hl_char">:</span><span class="hl_char">:</span>WriteMsr<span class="hl_char">(</span>LocalLiveKernelTargetInfo&nbsp;<span class="hl_char">*</span><span class="hl_function">this</span><span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;a2<span class="hl_char">,</span>&nbsp;__int64&nbsp;a3<span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;v3<span class="hl_comment">; // edi@1</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;v5<span class="hl_comment">; // [esp+4h] [ebp-10h]@1</span></li><li class="hl_l0">&nbsp;&nbsp;__int64&nbsp;v6<span class="hl_comment">; // [esp+Ch] [ebp-8h]@1</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;v5&nbsp;<span class="hl_char">=</span>&nbsp;a2<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;v6&nbsp;<span class="hl_char">=</span>&nbsp;a3<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;v3&nbsp;<span class="hl_char">=</span>&nbsp;LocalLiveKernelTargetInfo<span class="hl_char">:</span><span class="hl_char">:</span>DebugControl<span class="hl_char">(</span><span class="hl_char">(</span><span class="hl_function">int</span><span class="hl_char">)</span><span class="hl_function">this</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">17</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">(</span><span class="hl_function">int</span><span class="hl_char">)</span><span class="hl_char">&amp;</span>v5<span class="hl_char">,</span>&nbsp;<span class="hl_number">16</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>&nbsp;<span class="hl_char">!</span>v3&nbsp;<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;NotifyChangeDebuggeeState<span class="hl_char">(</span>2u<span class="hl_char">,</span>&nbsp;4ui64<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;return&nbsp;v3<span class="hl_comment">;</span></li><li class="hl_l0">}</li>        </ol>
    </div>
</div></div>
<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>int</b></span>&nbsp;__thiscall&nbsp;LocalLiveKernelTargetInfo<span class="hl_char">:</span><span class="hl_char">:</span>DebugControl<span class="hl_char">(</span><span class="hl_function"><b>int</b></span>&nbsp;<span class="hl_function">this</span><span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;a2<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;a3<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;a4<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>void</b></span>&nbsp;<span class="hl_char">*</span>a5<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;a6<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_char">*</span>a7<span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>void</b></span>&nbsp;<span class="hl_char">*</span>v7<span class="hl_comment">; // eax@1</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;result<span class="hl_comment">; // eax@4</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;v9<span class="hl_comment">; // eax@11</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;v10<span class="hl_comment">; // [esp+0h] [ebp-Ch]@2</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;v11<span class="hl_comment">; // [esp+4h] [ebp-8h]@2</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;v12<span class="hl_comment">; // [esp+8h] [ebp-4h]@2</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;v7&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">*</span><span class="hl_char">(</span><span class="hl_function"><b>void</b></span>&nbsp;<span class="hl_char">*</span><span class="hl_char">*</span><span class="hl_char">)</span><span class="hl_char">(</span><span class="hl_function"><b>this</b></span>&nbsp;<span class="hl_char">+</span>&nbsp;0xFF8<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>&nbsp;<span class="hl_char">!</span>v7&nbsp;<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;v9&nbsp;<span class="hl_char">=</span>&nbsp;g_NtDllCalls<span class="hl_char">.</span>NtSystemDebugControl<span class="hl_char">(</span>a2<span class="hl_char">,</span>&nbsp;a3<span class="hl_char">,</span>&nbsp;a4<span class="hl_char">,</span>&nbsp;a5<span class="hl_char">,</span>&nbsp;a6<span class="hl_char">,</span>&nbsp;a7<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>&nbsp;v9&nbsp;<span class="hl_char">&lt;</span>&nbsp;<span class="hl_number">0</span>&nbsp;<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;v9&nbsp;<span class="hl_char">|</span>&nbsp;0x10000000<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;v10&nbsp;<span class="hl_char">=</span>&nbsp;a2<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;v11&nbsp;<span class="hl_char">=</span>&nbsp;a3<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;v12&nbsp;<span class="hl_char">=</span>&nbsp;a4<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>&nbsp;DeviceIoControl<span class="hl_char">(</span>v7<span class="hl_char">,</span>&nbsp;0x22C007u<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>v10<span class="hl_char">,</span>&nbsp;0xCu<span class="hl_char">,</span>&nbsp;a5<span class="hl_char">,</span>&nbsp;a6<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>a6<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>&nbsp;a7&nbsp;<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">*</span>a7&nbsp;<span class="hl_char">=</span>&nbsp;a6<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>&nbsp;<span class="hl_char">!</span>GetLastError<span class="hl_char">(</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0x80004005<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;result&nbsp;<span class="hl_char">=</span>&nbsp;GetLastError<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>&nbsp;result&nbsp;<span class="hl_char">&gt;</span>&nbsp;<span class="hl_number">0</span>&nbsp;<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">(</span>unsigned&nbsp;__int16<span class="hl_char">)</span>result&nbsp;<span class="hl_char">|</span>&nbsp;0x80070000<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;return&nbsp;result<span class="hl_comment">;</span></li><li class="hl_l0">}</li>        </ol>
    </div>
</div></div>
<br><br>угу, либо через nt.dll<br>а мы знаем что оно обрезано с некоторых версий винды<br>либо через какой то драйвер<br>гугл рассказал и это<br>https://www.yumpu.com/en/document/view/54775013/draw-me-a-local-kernel-debugger/17<br>http://www.ivanlef0u.tuxfamily.org/?p=382<br>https://github.com/sogeti-esec-lab/LKD<br><br>но то чего хочется раскопать, а именно кто и как легально юзает msr через SetContext в спец битах DR7<br>и как это заюзать самому, по быстрому не нашлось...<br>по трейсил бы кто SetContext до самого ядра ?)) и если биты устанавливаются в msr, то почему дебаг евенты не приходят в юзермод<br>импортируемых вызовов SetContext даже не просматривается в dbgeng.dll, а жаль....<br><br>за то увидел что протокол общения с интерфейсом com порта(если мечтать о виртулке ring0)<br>и общения с драйвером kldbgdrv сидит в этой длл, хотя олеком какие то цепляются по ходу пьесы...<br><br><b>Добавлено спустя 16 минут</b><br>https://twitter.com/painter701<br>не знаю что за чел, но приятно что кто то проявил инициативу)))
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=376545&amp;user=15381&amp;forum_n=7&amp;topic=24494&amp;page=4&amp;anchor=15" class="addthx" data-post="376545"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=41575" title="04-06-2017 09:57, ранг:38.3" target="_blank">shellstorm</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 338.5 (мудрец), 349thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 июня 2017 16:30 <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=24494&amp;page=4#16');return false;">#16</a> </span><div align=left><br>
<b>reversecode</b><br><br>&gt; кто и как легально юзает msr через SetContext в спец битах DR7<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_comment">;++</span></li><li class="hl_l1"><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_comment">; KiSaveProcessorControlState (</span></li><li class="hl_l1"><span class="hl_comment">;     PKPROCESSOR_STATE ProcessorState</span></li><li class="hl_l0"><span class="hl_comment">;     );</span></li><li class="hl_l1"><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_comment">; Routine Description:</span></li><li class="hl_l1"><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_comment">;   This routine saves the control state of the current processor.</span></li><li class="hl_l1"><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_comment">; Arguments:</span></li><li class="hl_l1"><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_comment">;   ProcessorState (rcx) - Supplies a pointer to a processor state structure.</span></li><li class="hl_l1"><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_comment">; Return Value:</span></li><li class="hl_l1"><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_comment">;    None.</span></li><li class="hl_l1"><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_comment">;--</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LEAF_ENTRY&nbsp;KiSaveProcessorControlState<span class="hl_char">,</span>&nbsp;_TEXT<span class="hl_char">$</span><span class="hl_number">00</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">rax</span><span class="hl_char">,</span>&nbsp;cr0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; save processor control state</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PsCr0<span class="hl_char">[</span><span class="hl_registr">rcx</span><span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>rax</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">rax</span><span class="hl_char">,</span>&nbsp;cr2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PsCr2<span class="hl_char">[</span><span class="hl_registr">rcx</span><span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>rax</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">rax</span><span class="hl_char">,</span>&nbsp;cr3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PsCr3<span class="hl_char">[</span><span class="hl_registr">rcx</span><span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>rax</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">rax</span><span class="hl_char">,</span>&nbsp;cr4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PsCr4<span class="hl_char">[</span><span class="hl_registr">rcx</span><span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>rax</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">rax</span><span class="hl_char">,</span>&nbsp;cr8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PsCr8<span class="hl_char">[</span><span class="hl_registr">rcx</span><span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>rax</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>sgdt</b></span>&nbsp;&nbsp;&nbsp;&nbsp;fword&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;PsGdtr<span class="hl_char">[</span><span class="hl_registr">rcx</span><span class="hl_char">]</span>&nbsp;&nbsp;&nbsp;<span class="hl_comment">; save GDTR</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>sidt</b></span>&nbsp;&nbsp;&nbsp;&nbsp;fword&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;PsIdtr<span class="hl_char">[</span><span class="hl_registr">rcx</span><span class="hl_char">]</span>&nbsp;&nbsp;&nbsp;<span class="hl_comment">; save IDTR</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>str</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>word</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;PsTr<span class="hl_char">[</span><span class="hl_registr">rcx</span><span class="hl_char">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; save TR</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>sldt</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>word</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;PsLdtr<span class="hl_char">[</span><span class="hl_registr">rcx</span><span class="hl_char">]</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; save LDTR</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>stmxcsr</b></span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;PsMxCsr<span class="hl_char">[</span><span class="hl_registr">rcx</span><span class="hl_char">]</span>&nbsp;&nbsp;<span class="hl_comment">; save XMM control/status</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_comment">; Save debug control state.</span></li><li class="hl_l1"><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">rax</span><span class="hl_char">,</span>&nbsp;dr0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; save debug registers</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">rdx</span><span class="hl_char">,</span>&nbsp;dr1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PsKernelDr0<span class="hl_char">[</span><span class="hl_registr">rcx</span><span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>rax</b></span>&nbsp;&nbsp;&nbsp;<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PsKernelDr1<span class="hl_char">[</span><span class="hl_registr">rcx</span><span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>rdx</b></span>&nbsp;&nbsp;&nbsp;<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">rax</span><span class="hl_char">,</span>&nbsp;dr2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">rdx</span><span class="hl_char">,</span>&nbsp;dr3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PsKernelDr2<span class="hl_char">[</span><span class="hl_registr">rcx</span><span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>rax</b></span>&nbsp;&nbsp;&nbsp;<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PsKernelDr3<span class="hl_char">[</span><span class="hl_registr">rcx</span><span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>rdx</b></span>&nbsp;&nbsp;&nbsp;<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">rax</span><span class="hl_char">,</span>&nbsp;dr6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">rdx</span><span class="hl_char">,</span>&nbsp;dr7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PsKernelDr6<span class="hl_char">[</span><span class="hl_registr">rcx</span><span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>rax</b></span>&nbsp;&nbsp;&nbsp;<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PsKernelDr7<span class="hl_char">[</span><span class="hl_registr">rcx</span><span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>rdx</b></span>&nbsp;&nbsp;&nbsp;<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>xor</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>eax</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dr7<span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>rax</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cmp</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>byte</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_registr">gs</span><span class="hl_char">:</span><span class="hl_char">[</span>PcCpuVendor<span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;CPU_AMD&nbsp;<span class="hl_comment">; check if AMD processor</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jne</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>short</b></span>&nbsp;KiSC10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; if ne, not authentic AMD processor</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_comment">;</span></li><li class="hl_l1"><span class="hl_comment">; The host processor is an authentic AMD processor.</span></li><li class="hl_l0"><span class="hl_comment">;</span></li><li class="hl_l1"><span class="hl_comment">; Check if branch tracing or last branch capture is enabled.</span></li><li class="hl_l0"><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>test</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">dx</span><span class="hl_char">,</span>&nbsp;DR7_TRACE_BRANCH&nbsp;<span class="hl_function"><b>or</b></span>&nbsp;DR7_LAST_BRANCH&nbsp;<span class="hl_comment">; test for extended enables</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jz</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>short</b></span>&nbsp;KiSC10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; if z, extended debugging not enabled</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r8<span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>rcx</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; save processor state address</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span>&nbsp;MSR_LAST_BRANCH_FROM&nbsp;<span class="hl_comment">; save last branch information</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>rdmsr</b></span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PsLastBranchFromRip<span class="hl_char">[</span>r8<span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>eax</b></span>&nbsp;<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PsLastBranchFromRip&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">4</span><span class="hl_char">[</span>r8<span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>edx</b></span>&nbsp;<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span>&nbsp;MSR_LAST_BRANCH_TO&nbsp;<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>rdmsr</b></span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PsLastBranchToRip<span class="hl_char">[</span>r8<span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>eax</b></span>&nbsp;<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PsLastBranchToRip&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">4</span><span class="hl_char">[</span>r8<span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>edx</b></span>&nbsp;<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span>&nbsp;MSR_LAST_EXCEPTION_FROM&nbsp;<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>rdmsr</b></span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PsLastExceptionFromRip<span class="hl_char">[</span>r8<span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>eax</b></span>&nbsp;<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PsLastExceptionFromRip&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">4</span><span class="hl_char">[</span>r8<span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>edx</b></span>&nbsp;<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span>&nbsp;MSR_LAST_EXCEPTION_TO&nbsp;<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>rdmsr</b></span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PsLastExceptionToRip<span class="hl_char">[</span>r8<span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>eax</b></span>&nbsp;<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PsLastExceptionToRip&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">4</span><span class="hl_char">[</span>r8<span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>edx</b></span>&nbsp;<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span>&nbsp;MSR_DEGUG_CTL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; clear extended debug control</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>rdmsr</b></span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>and</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>not</b></span>&nbsp;<span class="hl_char">(</span>MSR_DEBUG_CTL_LBR&nbsp;<span class="hl_function"><b>or</b></span>&nbsp;MSR_DEBUG_CRL_BTF<span class="hl_char">)</span>&nbsp;<span class="hl_comment">; </span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>wrmsr</b></span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; </span></li><li class="hl_l1">KiSC10<span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>ret</b></span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; return</span></li>        </ol>
    </div>
</div></div>
<br><br>Это у амд отображение управляющих бит мср на др. Поэтому можно запустить этот механизм из юм загрузкой dr7 в контексте. При свопе потоков или при переключении мода(возврате в юм) - Kei386EoiHelper() etc, не происходит перезагрузка мср, таким образом записав принудительно мср и запустив механизм трассировки ветвлений он начнёт выполняться для всех потоков в системе(без BTS_OFF_OS начнётся трассировка ядра). Поэтому нужно написать дров, который будет управлять данным процессом.<br><br><b>Добавлено спустя 15 минут</b><br>&gt; в чем магический смысл 0xCC и 0xCD 0x03<br><br>Это ловушка(trap), поэтому в ISR передаётся адрес следующей инструкции, но система его не правильно фиксит:<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">ebp</span><span class="hl_char">]</span><span class="hl_char">+</span>TsEip</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>dec</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr"><b>ebx</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; (ebx)-&gt; int3 instruction</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">3</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;STATUS_BREAKPOINT</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>call</b></span>&nbsp;&nbsp;&nbsp;&nbsp;CommonDispatchException&nbsp;<span class="hl_comment">; Never return</span></li>        </ol>
    </div>
</div></div>
<br><br>Отматывается один байт назад, это правильно для CC, но не для CD с префиксами или двубайтному.<br><br><b>Добавлено спустя 18 минут</b><br>&gt; хотя можно же и софтово реализовать ? дизасмом смотреть опкоды бранчей и генерить брекпоинт<br><br>Можно, я уже где то писал про такое. Но железячная трассировка ветвлений хороша из за профайла. А можно есчо по простому сделать, если профайл не важен - трассируем как обычно(TF) и продолжаем до обнаружения ветвления.
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=376584&amp;user=40990&amp;forum_n=7&amp;topic=24494&amp;page=4&amp;anchor=16" class="addthx" data-post="376584"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]reversecode[/b]','')">reversecode</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/15381.gif" alt=""><br><span class=txtSm>Ранг: 1053.6 <b><u>(!!!!)</u></b>, 1078thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.43'>Активность: 1.06<span style='color:red'>&searr;</span>0.81</span><br>Статус: <a href="action=userinfo&amp;user=15381">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 июня 2017 16:59 &middot; Поправил: reversecode <br><script type="text/javascript">QU('reversecode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=reversecode" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=24494&amp;page=4#17');return false;">#17</a> </span><div align=left><br>
у интела такой же код для dr7, я смотрел дизасмом свой кернель, просто в wrk его похоже нет<br><br>сколько байт у опкодов int 3 я и так знаю, мне интересует какая нужда применять разные опкоды на практике? <br>может их проц по другому ловит и обрабатывает ?<br>если есть 0xCC зачем нужен 0xCD 0x03  ?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=376587&amp;user=15381&amp;forum_n=7&amp;topic=24494&amp;page=4&amp;anchor=17" class="addthx" data-post="376587"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 338.5 (мудрец), 349thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 июня 2017 17:01 &middot; Поправил: difexacaw <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=24494&amp;page=4#18');return false;">#18</a> </span><div align=left><br>
<b>reversecode</b><br><br>Смысл не в коде, у амд несколько бит в мср отображены на др, тоесть пишем их в др, а они меняются в мср <img src="img/smilies/s1.gif" alt="">
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=376588&amp;user=40990&amp;forum_n=7&amp;topic=24494&amp;page=4&amp;anchor=18" class="addthx" data-post="376588"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]reversecode[/b]','')">reversecode</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/15381.gif" alt=""><br><span class=txtSm>Ранг: 1053.6 <b><u>(!!!!)</u></b>, 1078thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.43'>Активность: 1.06<span style='color:red'>&searr;</span>0.81</span><br>Статус: <a href="action=userinfo&amp;user=15381">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 июня 2017 17:03 <br><script type="text/javascript">QU('reversecode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=reversecode" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=24494&amp;page=4#19');return false;">#19</a> </span><div align=left><br>
так я еще раз повторяю, причем здесь amd ? в интела все тоже самое, даже по коду<br>фокус в том что не работает, ранее чал копал, и вроде наткунлся что в старых кернелях была проверка на тип проца,<br>и как он подметил, видимо документация из интела не дошла в МС по новым процам, и там забыли добавить новые типы для возможности записи msr через dr7
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=376589&amp;user=15381&amp;forum_n=7&amp;topic=24494&amp;page=4&amp;anchor=19" class="addthx" data-post="376589"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="20" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 338.5 (мудрец), 349thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 июня 2017 17:31 &middot; Поправил: difexacaw <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#20" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=24494&amp;page=4#20');return false;">#20</a> </span><div align=left><br>
<b>reversecode</b><br><br>&gt; может их проц по другому ловит и обрабатывает ?<br><br>Разницы заметной нет, кроме не существенных деталей(не проверяет IOPL из V86).<br><br>Допустим у нас последовательность F3 CD 03. При останове Ip = 03. Нужно идти назад и найти начало инструкции, а при серии префиксов это не всегда возможно сделать.<br><br>&gt; причем здесь amd ? в интела все тоже самое<br><br>Да нет же, эта фича даже не описана в мане амд(том 2). Я давно читал в какой то их спецификации, но не помню где. На Интеле это не сработает, я проверял на i5. Выше в коде посмотрите имена полей dr7: DR7_TRACE_BRANCH or DR7_LAST_BRANCH. У Интела этих бит нет.
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=376591&amp;user=40990&amp;forum_n=7&amp;topic=24494&amp;page=4&amp;anchor=20" class="addthx" data-post="376591"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="21" onfocus="this.blur()" href="JavaScript:di('[b]reversecode[/b]','')">reversecode</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/15381.gif" alt=""><br><span class=txtSm>Ранг: 1053.6 <b><u>(!!!!)</u></b>, 1078thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.43'>Активность: 1.06<span style='color:red'>&searr;</span>0.81</span><br>Статус: <a href="action=userinfo&amp;user=15381">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 июня 2017 17:40 <br><script type="text/javascript">QU('reversecode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=reversecode" target="_blank">Личное сообщение</a> &middot;  <a href="#21" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=24494&amp;page=4#21');return false;">#21</a> </span><div align=left><br>
у интела и amd есть msr и оно поддерживается ( во всяком случае это можно проверять через cpuid)<br>dr7 поля, это мапинг, эти поля устанавливаются из ring3 и через SetContext, ядро ловит эти установки и перекладывает на msr<br><br>был бы ядреный дебагер или бы я был профспецом по windbg, я бы уже взял да проверил доходят ли эти установки  из ring3 в ring0 или ломаются на каких то проверках
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=376593&amp;user=15381&amp;forum_n=7&amp;topic=24494&amp;page=4&amp;anchor=21" class="addthx" data-post="376593"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="22" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 338.5 (мудрец), 349thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 июня 2017 18:01 <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#22" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=24494&amp;page=4#22');return false;">#22</a> </span><div align=left><br>
Что то такое происходит в amd-64, но на 86 этой эмуляции вообще нет.
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=376594&amp;user=40990&amp;forum_n=7&amp;topic=24494&amp;page=4&amp;anchor=22" class="addthx" data-post="376594"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="23" onfocus="this.blur()" href="JavaScript:di('[b]reversecode[/b]','')">reversecode</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/15381.gif" alt=""><br><span class=txtSm>Ранг: 1053.6 <b><u>(!!!!)</u></b>, 1078thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.43'>Активность: 1.06<span style='color:red'>&searr;</span>0.81</span><br>Статус: <a href="action=userinfo&amp;user=15381">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 июня 2017 18:14 <br><script type="text/javascript">QU('reversecode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=reversecode" target="_blank">Личное сообщение</a> &middot;  <a href="#23" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=24494&amp;page=4#23');return false;">#23</a> </span><div align=left><br>
ну да, такой мапинг msr только на x64 платформе, на x86 такого увы нет, но и платформы такой уже почти нет<br>везде все x64
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=376596&amp;user=15381&amp;forum_n=7&amp;topic=24494&amp;page=4&amp;anchor=23" class="addthx" data-post="376596"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="24" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 338.5 (мудрец), 349thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 июня 2017 18:33 <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#24" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=24494&amp;page=4#24');return false;">#24</a> </span><div align=left><br>
А чем обычная трассировка не устраивает. Можно блок линейный выделить, но это дизасм длин нужен.<br><br><img src="img/attach.gif" alt=""> <a href="./files/7517_04.06.2017_EXELAB.rU.tgz">7517_04.06.2017_EXELAB.rU.tgz</a> - bt.rar<br><br><b>Добавлено спустя 1 час 2 минуты</b><br>Вот есчо через HWB. Можно напрямую блок выполнить в буфере, принципиально разницы нет.<br><br><img src="img/attach.gif" alt=""> <a href="./files/eec9_04.06.2017_EXELAB.rU.tgz">eec9_04.06.2017_EXELAB.rU.tgz</a> - bt2.rar
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=376597&amp;user=40990&amp;forum_n=7&amp;topic=24494&amp;page=4&amp;anchor=24" class="addthx" data-post="376597"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="25" onfocus="this.blur()" href="JavaScript:di('[b]reversecode[/b]','')">reversecode</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/15381.gif" alt=""><br><span class=txtSm>Ранг: 1053.6 <b><u>(!!!!)</u></b>, 1078thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.43'>Активность: 1.06<span style='color:red'>&searr;</span>0.81</span><br>Статус: <a href="action=userinfo&amp;user=15381">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 июня 2017 21:16 <br><script type="text/javascript">QU('reversecode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=reversecode" target="_blank">Личное сообщение</a> &middot;  <a href="#25" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=24494&amp;page=4#25');return false;">#25</a> </span><div align=left><br>
это все хаки, сиеровский тоже умеет<br>хочется хардварно через мср
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=376602&amp;user=15381&amp;forum_n=7&amp;topic=24494&amp;page=4&amp;anchor=25" class="addthx" data-post="376602"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="26" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 338.5 (мудрец), 349thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 июня 2017 21:45 &middot; Поправил: difexacaw <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#26" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=24494&amp;page=4#26');return false;">#26</a> </span><div align=left><br>
А что мешает собрать простейший драйвер для операций с мср ?<br><br>В 8-ке кстате есть такой код:<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC71C</span>&nbsp;<span class="hl_comment">; __stdcall VfStartBranchTracing()</span></li><li class="hl_l1">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC71C</span>&nbsp;_VfStartBranchTracing@0&nbsp;<span class="hl_function"><b>proc</b></span>&nbsp;<span class="hl_function"><b>near</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; CODE XREF: KiFreezeTargetExecution(x,x)+36Dp</span></li><li class="hl_l0">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC71C</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; VfNotifyVerifierOfEvent(x)+34p ...</span></li><li class="hl_l1">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC71C</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;_MmVerifierData</li><li class="hl_l0">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC721</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>test</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">8000000h</span></li><li class="hl_l1">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC726</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jz</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>short</b></span>&nbsp;loc_7DC794</li><li class="hl_l0">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC728</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cmp</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">ds</span><span class="hl_char">:</span>_VfBTSSupported<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span></li><li class="hl_l1">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC72F</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jz</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>short</b></span>&nbsp;loc_7DC794</li><li class="hl_l0">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC731</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>xor</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">ecx</span></li><li class="hl_l1">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC733</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cmp</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">ds</span><span class="hl_char">:</span>_VfBTSInitialized<span class="hl_char">,</span>&nbsp;<span class="hl_registr">ecx</span></li><li class="hl_l0">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC739</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jnz</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>short</b></span>&nbsp;loc_7DC741</li><li class="hl_l1">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC73B</span></li><li class="hl_l0">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC73B</span>&nbsp;loc_7DC73B<span class="hl_char">:</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; CODE XREF: VfStartBranchTracing()+38j</span></li><li class="hl_l1">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC73B</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0C000042Ah</span></li><li class="hl_l0">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC740</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">retn</span></li><li class="hl_l1">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC741</span>&nbsp;<span class="hl_comment">; ---------------------------------------------------------------------------</span></li><li class="hl_l0">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC741</span></li><li class="hl_l1">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC741</span>&nbsp;loc_7DC741<span class="hl_char">:</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; CODE XREF: VfStartBranchTracing()+1Dj</span></li><li class="hl_l0">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC741</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;large&nbsp;<span class="hl_registr">fs</span><span class="hl_char">:</span><span class="hl_number">20h</span></li><li class="hl_l1">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC747</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">eax</span><span class="hl_char">+</span><span class="hl_number">3CCh</span><span class="hl_char">]</span></li><li class="hl_l0">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC74D</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cmp</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">ds</span><span class="hl_char">:</span>_VfBTSStarted<span class="hl_char">[</span><span class="hl_registr">eax</span><span class="hl_char">*</span><span class="hl_number">4</span><span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">ecx</span></li><li class="hl_l1">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC754</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jnz</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>short</b></span>&nbsp;loc_7DC73B</li><li class="hl_l0">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC756</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">ds</span><span class="hl_char">:</span>_VfBTSProcessorFamily</li><li class="hl_l1">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC75B</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cmp</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0Fh</span></li><li class="hl_l0">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC75E</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jnz</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>short</b></span>&nbsp;loc_7DC765</li><li class="hl_l1">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC760</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">ecx</span></li><li class="hl_l0">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC761</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">0Ch</span></li><li class="hl_l1">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC763</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jmp</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>short</b></span>&nbsp;loc_7DC770</li><li class="hl_l0">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC765</span>&nbsp;<span class="hl_comment">; ---------------------------------------------------------------------------</span></li><li class="hl_l1">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC765</span></li><li class="hl_l0">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC765</span>&nbsp;loc_7DC765<span class="hl_char">:</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; CODE XREF: VfStartBranchTracing()+42j</span></li><li class="hl_l1">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC765</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cmp</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">6</span></li><li class="hl_l0">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC768</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jnz</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>short</b></span>&nbsp;loc_7DC77A</li><li class="hl_l1">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC76A</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">ecx</span></li><li class="hl_l0">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC76B</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">0C0h</span></li><li class="hl_l1">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC770</span></li><li class="hl_l0">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC770</span>&nbsp;loc_7DC770<span class="hl_char">:</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; CODE XREF: VfStartBranchTracing()+47j</span></li><li class="hl_l1">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC770</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">1D9h</span></li><li class="hl_l0">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC775</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>call</b></span>&nbsp;&nbsp;&nbsp;&nbsp;_WRMSR@12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; WRMSR(x,x,x)</span></li><li class="hl_l1">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC77A</span></li><li class="hl_l0">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC77A</span>&nbsp;loc_7DC77A<span class="hl_char">:</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; CODE XREF: VfStartBranchTracing()+4Cj</span></li><li class="hl_l1">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC77A</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;large&nbsp;<span class="hl_registr">fs</span><span class="hl_char">:</span><span class="hl_number">20h</span></li><li class="hl_l0">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC780</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">eax</span><span class="hl_char">+</span><span class="hl_number">3CCh</span><span class="hl_char">]</span></li><li class="hl_l1">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC786</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">ds</span><span class="hl_char">:</span>_VfBTSStarted<span class="hl_char">[</span><span class="hl_registr">eax</span><span class="hl_char">*</span><span class="hl_number">4</span><span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">1</span></li><li class="hl_l0">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC791</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>xor</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC793</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">retn</span></li><li class="hl_l0">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC794</span>&nbsp;<span class="hl_comment">; ---------------------------------------------------------------------------</span></li><li class="hl_l1">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC794</span></li><li class="hl_l0">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC794</span>&nbsp;loc_7DC794<span class="hl_char">:</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; CODE XREF: VfStartBranchTracing()+Aj</span></li><li class="hl_l1">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC794</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; VfStartBranchTracing()+13j</span></li><li class="hl_l0">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC794</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0C0000002h</span></li><li class="hl_l1">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC799</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">retn</span></li><li class="hl_l0">PAGEVRFY<span class="hl_char">:</span><span class="hl_number">007DC799</span>&nbsp;_VfStartBranchTracing@0&nbsp;<span class="hl_function">endp</span></li>        </ol>
    </div>
</div></div>
<br><br>Может как то и можно через это из юм заюзать bt, ссылок много на функу, но должен быть запущен верифер.<br><br><noindex><a href="https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/tb--trace-to-next-branch-" rel="nofollow" target="_blank">--&gt; Link &lt;--</a></noindex>
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=376604&amp;user=40990&amp;forum_n=7&amp;topic=24494&amp;page=4&amp;anchor=26" class="addthx" data-post="376604"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="27" onfocus="this.blur()" href="JavaScript:di('[b]reversecode[/b]','')">reversecode</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/15381.gif" alt=""><br><span class=txtSm>Ранг: 1053.6 <b><u>(!!!!)</u></b>, 1078thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.43'>Активность: 1.06<span style='color:red'>&searr;</span>0.81</span><br>Статус: <a href="action=userinfo&amp;user=15381">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 июня 2017 22:50 <br><script type="text/javascript">QU('reversecode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=reversecode" target="_blank">Личное сообщение</a> &middot;  <a href="#27" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=24494&amp;page=4#27');return false;">#27</a> </span><div align=left><br>
никто не мешает, но ring3 дебаггер не подразумевает драйверов<br>а так бы да, я бы мог дернуть и драйвер МС с windbg <br><br>по ссылке выше tb это да, его же и исследовал выше по ссылкам, но как к нему добраться на x64 в ring3 без дров, загадка
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=376609&amp;user=15381&amp;forum_n=7&amp;topic=24494&amp;page=4&amp;anchor=27" class="addthx" data-post="376609"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="28" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 338.5 (мудрец), 349thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 июня 2017 23:18 <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#28" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=24494&amp;page=4#28');return false;">#28</a> </span><div align=left><br>
Я мельком глянул, KiSaveProcessorControlState &lt;- ExpSystemErrorHandler &lt;- ExpRaiseHardError вызвать(NtRaiseHardError) с подходящими аргументами.
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=376610&amp;user=40990&amp;forum_n=7&amp;topic=24494&amp;page=4&amp;anchor=28" class="addthx" data-post="376610"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="29" onfocus="this.blur()" href="JavaScript:di('[b]Alchemistry[/b]','')">Alchemistry</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 145.8 (ветеран), 191thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.06'>Активность: 0.14<span style='color:green'>&nearr;</span>0.36</span><br>Статус: <a href="action=userinfo&amp;user=21411">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 июня 2017 14:11 <br><script type="text/javascript">QU('Alchemistry','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Alchemistry" target="_blank">Личное сообщение</a> &middot;  <a href="#29" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=24494&amp;page=4#29');return false;">#29</a> </span><div align=left><br>
<I>reversecode пишет:<br>а так бы да, я бы мог дернуть и драйвер МС с windbg  </I><br>А там нечего дергать. Этот драйвер просто врапер KdSystemDebugControl.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=376616&amp;user=21411&amp;forum_n=7&amp;topic=24494&amp;page=4&amp;anchor=29" class="addthx" data-post="376616"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="30" onfocus="this.blur()" href="JavaScript:di('[b]reversecode[/b]','')">reversecode</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/15381.gif" alt=""><br><span class=txtSm>Ранг: 1053.6 <b><u>(!!!!)</u></b>, 1078thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.43'>Активность: 1.06<span style='color:red'>&searr;</span>0.81</span><br>Статус: <a href="action=userinfo&amp;user=15381">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 июня 2017 18:13 <br><script type="text/javascript">QU('reversecode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=reversecode" target="_blank">Личное сообщение</a> &middot;  <a href="#30" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=24494&amp;page=4#30');return false;">#30</a> </span><div align=left><br>
хм<br>полез в 64 битное ядро, таки да<br>доступ к msr присутсвует<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>&nbsp;<span class="hl_char">(</span>_DWORD<span class="hl_char">)</span>a3&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;<span class="hl_number">16</span>&nbsp;<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;3221225476i64<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v15&nbsp;<span class="hl_char">=</span>&nbsp;KdpSysReadMsr<span class="hl_char">(</span><span class="hl_char">*</span><span class="hl_char">(</span>_DWORD&nbsp;<span class="hl_char">*</span><span class="hl_char">)</span>a2<span class="hl_char">,</span>&nbsp;a2&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">1</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto&nbsp;LABEL_90<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;v20&nbsp;<span class="hl_char">=</span>&nbsp;v19&nbsp;<span class="hl_char">-</span>&nbsp;<span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>&nbsp;<span class="hl_char">!</span>v20&nbsp;<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>&nbsp;<span class="hl_char">(</span>_DWORD<span class="hl_char">)</span>a3&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;<span class="hl_number">16</span>&nbsp;<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0xC0000004i64<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v15&nbsp;<span class="hl_char">=</span>&nbsp;KdpSysWriteMsr<span class="hl_char">(</span><span class="hl_char">*</span><span class="hl_char">(</span>_DWORD&nbsp;<span class="hl_char">*</span><span class="hl_char">)</span>a2<span class="hl_char">,</span>&nbsp;<span class="hl_char">(</span>unsigned&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;<span class="hl_char">*</span><span class="hl_char">)</span>a2&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">2</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto&nbsp;LABEL_90<span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div>
<br>так что если что, можно пытаться через nt dll вскочить, если там нет заглушек в ring3
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=376624&amp;user=15381&amp;forum_n=7&amp;topic=24494&amp;page=4&amp;anchor=30" class="addthx" data-post="376624"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="31" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 338.5 (мудрец), 349thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 июня 2017 19:07 <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#31" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=24494&amp;page=4#31');return false;">#31</a> </span><div align=left><br>
<b>reversecode</b><br><br>Может и можно, через извраты:<br><br>&gt; это все хаки, сиеровский тоже умеет<br>&gt; хочется хардварно через мср <br><br><img src="img/smilies/s5.gif" alt="">
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=376627&amp;user=40990&amp;forum_n=7&amp;topic=24494&amp;page=4&amp;anchor=31" class="addthx" data-post="376627"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> <a href="action=vthread&amp;forum=7&amp;topic=24494&amp;page=3.html">&lt;&lt;</a> .  <a href="action=vthread&amp;forum=7&amp;topic=24494&amp;page=0.html">1</a> . <a href="action=vthread&amp;forum=7&amp;topic=24494&amp;page=1.html">2</a> . <a href="action=vthread&amp;forum=7&amp;topic=24494&amp;page=2.html">3</a> . <a href="action=vthread&amp;forum=7&amp;topic=24494&amp;page=3.html">4</a> . <b>5</b> . <a href="action=vthread&amp;forum=7&amp;topic=24494&amp;page=5.html">6</a> . <a href="action=vthread&amp;forum=7&amp;topic=24494&amp;page=5.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/mod.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=7&sortBy=0&page=0.html"><b>Оффтоп</b></a> <b class=bulletHead>&#8212;&#8250;</b> syser - а он еще нужен?</span></td>
</tr></table>
</div>
<a name=newreply></a>
<center><h3>У вас должно быть 20 пунктов ранга, чтобы оставлять сообщения в  этом подфоруме, но у вас только 0</h3></center><script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=24494" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
