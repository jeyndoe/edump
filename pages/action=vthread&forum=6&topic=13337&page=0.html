<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Работа с ресурсами PE-exe - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Просвятите плз, каким макаром программно можно заменять ресурсы существующего ехе-шника. Интересует, в первую очередь, значок и строки. Желательно Delphi.">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=26261'>bartolomeo</a>, <a target='_blank' href='?action=userinfo&amp;user=50833'>vasilevradislav</a>, <a target='_blank' href='?action=userinfo&amp;user=1533'>rmn</a>, <a target='_blank' href='?action=userinfo&amp;user=8344'>Magister Yoda</a> (+7 невидимых)</b></span>
</td>
</tr>
</table>

 

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Работа с ресурсами PE-exe</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]mindkeeper[/b]','')">mindkeeper</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 11.1 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.39'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=10063">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 декабря 2008 17:33 <br><script type="text/javascript">QU('mindkeeper','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=mindkeeper" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13337.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Просвятите плз, каким макаром программно можно заменять ресурсы существующего ехе-шника. Интересует, в первую очередь, значок и строки. Желательно Delphi.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=212994&amp;user=10063&amp;forum_n=6&amp;topic=13337.html&amp;page=0&amp;anchor=1" class="addthx" data-post="212994"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]Ray[/b]','')">Ray</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 28.7 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.2'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=16451">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 декабря 2008 17:47 <br><script type="text/javascript">QU('Ray','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Ray" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13337.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
С помощью программ: Resource Tuner, Restorator, Resource_Hacker.<br>Строки  - там же,либо в Ольке: Search for-&gt;All referenced text strings.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=212998&amp;user=16451&amp;forum_n=6&amp;topic=13337.html&amp;page=0&amp;anchor=2" class="addthx" data-post="212998"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]AVE[/b]','')">AVE</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/1957.jpg" alt=""><br><span class=txtSm>Ранг: 81.7 (постоянный), 10thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.09'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1957">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 декабря 2008 18:00 <br><script type="text/javascript">QU('AVE','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=AVE" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13337.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
Автор видимо сорсы подобного ищет
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=213002&amp;user=1957&amp;forum_n=6&amp;topic=13337.html&amp;page=0&amp;anchor=3" class="addthx" data-post="213002"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]Dr3d[/b]','')">Dr3d</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/7074.jpg" alt=""><br><span class=txtSm>Ранг: 68.0 (постоянный), 6thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.75'>Активность: 0.06<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=7074">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 декабря 2008 18:17 <br><script type="text/javascript">QU('Dr3d','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Dr3d" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13337.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
www.delphisources.ru/forum/showthread.php?p=3648 </a>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=213006&amp;user=7074&amp;forum_n=6&amp;topic=13337.html&amp;page=0&amp;anchor=4" class="addthx" data-post="213006"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]cppasm[/b]','')">cppasm</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 251.3 (наставник), 81thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.77'>Активность: 0.14<span style='color:red'>&searr;</span>0.11</span><br>Статус: <a href="action=userinfo&amp;user=6859">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 декабря 2008 18:36 <br><script type="text/javascript">QU('cppasm','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=cppasm" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13337.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
WinAPI UpdateResource(), а там хоть на ассемблере пиши <img src="img/smilies/s1.gif" alt=""><br>msdn.microsoft.com/en-us/library/ms648008(VS.85).aspx
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=213012&amp;user=6859&amp;forum_n=6&amp;topic=13337.html&amp;page=0&amp;anchor=5" class="addthx" data-post="213012"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]mindkeeper[/b]','')">mindkeeper</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 11.1 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.39'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=10063">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 декабря 2008 19:01 &middot; Поправил: mindkeeper <br><script type="text/javascript">QU('mindkeeper','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=mindkeeper" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13337.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
Большое спасибо.<br><b>Ray</b>, мне нужно именно самостоятельно и программно (<b>AVE</b> прав), не буду вдаваться в подробности почему.<br><b>cppasm</b> Сначала попробую эту DLL по ссылке, которую <b>Dr3d</b> дал. Там в форуме есть указание автора, что почему то эта ф-я API отказывалась работать у него из dephi, поэтому он на сях сделал, а из delphi просто вызывал. <br>  О результате отпишусь, мало ли, кому еще пригодится.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=213019&amp;user=10063&amp;forum_n=6&amp;topic=13337.html&amp;page=0&amp;anchor=6" class="addthx" data-post="213019"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]mindkeeper[/b]','')">mindkeeper</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 11.1 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.39'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=10063">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 декабря 2008 00:19 &middot; Поправил: mindkeeper <br><script type="text/javascript">QU('mindkeeper','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=mindkeeper" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13337.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
Получилось просто отлично, таки пошел по пути самостоятельного внедрения UpdateResource и всего, что к нему причитается. Вобще с ресурсами раньше особо не работал, максимум читал курсоры и строки, а тут оказалось все так просто, правда немного пришлось догадываться что к чему. По итогу: у меня в ресурсах одного EXE сидит другой, и целая куча ресурсов к нему на выбор пользователя... экстрактится &quot;внутренний&quot; EXE (я кго еще и упаковал для экономии места), к нему пришиваются необходимые MAINICON, RCDATA. Вот примерчик замены ресурсов из моей тупенькой прожки:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">procedure&nbsp;UpdateIcons<span class="hl_char">(</span><span class="hl_function"><b>const</b></span>&nbsp;FileName<span class="hl_char">,</span>&nbsp;IcoFileName<span class="hl_char">:</span>&nbsp;String<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">type</li><li class="hl_l0">&nbsp;&nbsp;PIcoItemHeader&nbsp;<span class="hl_char">=</span>&nbsp;^TIcoItemHeader<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;TIcoItemHeader&nbsp;<span class="hl_char">=</span>&nbsp;packed&nbsp;record</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;Width<span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>Byte</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;Height<span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>Byte</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;Colors<span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>Byte</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;Reserved<span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>Byte</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;Planes<span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>Word</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;BitCount<span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>Word</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;ImageSize<span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>DWORD</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;PIcoItem&nbsp;<span class="hl_char">=</span>&nbsp;^TIcoItem<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;TIcoItem&nbsp;<span class="hl_char">=</span>&nbsp;packed&nbsp;record</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;Header<span class="hl_char">:</span>&nbsp;TIcoItemHeader<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">Offset</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>DWORD</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;PIcoHeader&nbsp;<span class="hl_char">=</span>&nbsp;^TIcoHeader<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;TIcoHeader&nbsp;<span class="hl_char">=</span>&nbsp;packed&nbsp;record</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;Reserved<span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>Word</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;Typ<span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>Word</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;ItemCount<span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>Word</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;Items<span class="hl_char">:</span>&nbsp;array&nbsp;<span class="hl_char">[</span><span class="hl_number">0</span><span class="hl_char">.</span><span class="hl_char">.</span>MaxInt&nbsp;<span class="hl_function"><b>shr</b></span>&nbsp;<span class="hl_number">4</span>&nbsp;<span class="hl_char">-</span>&nbsp;<span class="hl_number">1</span><span class="hl_char">]</span>&nbsp;of&nbsp;TIcoItem<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;PGroupIconDirItem&nbsp;<span class="hl_char">=</span>&nbsp;^TGroupIconDirItem<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;TGroupIconDirItem&nbsp;<span class="hl_char">=</span>&nbsp;packed&nbsp;record</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;Header<span class="hl_char">:</span>&nbsp;TIcoItemHeader<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;Id<span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>Word</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;PGroupIconDir&nbsp;<span class="hl_char">=</span>&nbsp;^TGroupIconDir<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;TGroupIconDir&nbsp;<span class="hl_char">=</span>&nbsp;packed&nbsp;record</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;Reserved<span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>Word</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;Typ<span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>Word</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;ItemCount<span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>Word</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;Items<span class="hl_char">:</span>&nbsp;array&nbsp;<span class="hl_char">[</span><span class="hl_number">0</span><span class="hl_char">.</span><span class="hl_char">.</span>MaxInt&nbsp;<span class="hl_function"><b>shr</b></span>&nbsp;<span class="hl_number">4</span>&nbsp;<span class="hl_char">-</span>&nbsp;<span class="hl_number">1</span><span class="hl_char">]</span>&nbsp;of&nbsp;TGroupIconDirItem<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l0"></li><li class="hl_l1">&nbsp;&nbsp;function&nbsp;IsValidIcon<span class="hl_char">(</span>P<span class="hl_char">:</span>&nbsp;Pointer<span class="hl_comment">; Size: Cardinal): Boolean;</span></li><li class="hl_l0">&nbsp;&nbsp;var</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;ItemCount<span class="hl_char">:</span>&nbsp;Cardinal<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;begin</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;Result&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;<span class="hl_function"><b>False</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;Size&nbsp;<span class="hl_char">&lt;</span>&nbsp;Cardinal<span class="hl_char">(</span><span class="hl_function">SizeOf</span><span class="hl_char">(</span><span class="hl_function">Word</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">*</span>&nbsp;<span class="hl_number">3</span><span class="hl_char">)</span>&nbsp;then</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exit<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>PChar<span class="hl_char">(</span>P<span class="hl_char">)</span><span class="hl_char">[</span><span class="hl_number">0</span><span class="hl_char">]</span>&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_quote">'M'</span><span class="hl_char">)</span>&nbsp;<span class="hl_function"><b>and</b></span>&nbsp;<span class="hl_char">(</span>PChar<span class="hl_char">(</span>P<span class="hl_char">)</span><span class="hl_char">[</span><span class="hl_number">1</span><span class="hl_char">]</span>&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_quote">'Z'</span><span class="hl_char">)</span>&nbsp;then</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exit<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;ItemCount&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;PIcoHeader<span class="hl_char">(</span>P<span class="hl_char">)</span><span class="hl_char">.</span>ItemCount<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;Size&nbsp;<span class="hl_char">&lt;</span>&nbsp;Cardinal<span class="hl_char">(</span><span class="hl_char">(</span><span class="hl_function">SizeOf</span><span class="hl_char">(</span><span class="hl_function">Word</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">*</span>&nbsp;<span class="hl_number">3</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_char">(</span>ItemCount&nbsp;<span class="hl_char">*</span>&nbsp;<span class="hl_function">SizeOf</span><span class="hl_char">(</span>TIcoItem<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_char">)</span>&nbsp;then</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exit<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;P&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;@PIcoHeader<span class="hl_char">(</span>P<span class="hl_char">)</span><span class="hl_char">.</span>Items<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>while</b></span>&nbsp;ItemCount&nbsp;<span class="hl_char">&gt;</span>&nbsp;Cardinal<span class="hl_char">(</span><span class="hl_number">0</span><span class="hl_char">)</span>&nbsp;do&nbsp;begin</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>Cardinal<span class="hl_char">(</span>PIcoItem<span class="hl_char">(</span>P<span class="hl_char">)</span><span class="hl_char">.</span><span class="hl_function"><b>Offset</b></span>&nbsp;<span class="hl_char">+</span>&nbsp;PIcoItem<span class="hl_char">(</span>P<span class="hl_char">)</span><span class="hl_char">.</span>Header<span class="hl_char">.</span>ImageSize<span class="hl_char">)</span>&nbsp;<span class="hl_char">&lt;</span>&nbsp;Cardinal<span class="hl_char">(</span>PIcoItem<span class="hl_char">(</span>P<span class="hl_char">)</span><span class="hl_char">.</span><span class="hl_function">Offset</span><span class="hl_char">)</span><span class="hl_char">)</span>&nbsp;or</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">(</span>Cardinal<span class="hl_char">(</span>PIcoItem<span class="hl_char">(</span>P<span class="hl_char">)</span><span class="hl_char">.</span><span class="hl_function"><b>Offset</b></span>&nbsp;<span class="hl_char">+</span>&nbsp;PIcoItem<span class="hl_char">(</span>P<span class="hl_char">)</span><span class="hl_char">.</span>Header<span class="hl_char">.</span>ImageSize<span class="hl_char">)</span>&nbsp;<span class="hl_char">&gt;</span>&nbsp;Cardinal<span class="hl_char">(</span>Size<span class="hl_char">)</span><span class="hl_char">)</span>&nbsp;then</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exit<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">Inc</span><span class="hl_char">(</span>PIcoItem<span class="hl_char">(</span>P<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">Dec</span><span class="hl_char">(</span>ItemCount<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;Result&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;<span class="hl_function"><b>True</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l1"></li><li class="hl_l0">var</li><li class="hl_l1">&nbsp;&nbsp;H<span class="hl_char">:</span>&nbsp;THandle<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;M<span class="hl_char">:</span>&nbsp;HMODULE<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;R<span class="hl_char">:</span>&nbsp;HRSRC<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;Res<span class="hl_char">:</span>&nbsp;HGLOBAL<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;GroupIconDir<span class="hl_char">,</span>&nbsp;NewGroupIconDir<span class="hl_char">:</span>&nbsp;PGroupIconDir<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;I<span class="hl_char">:</span>&nbsp;Integer<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;wLanguage<span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>Word</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_registr">FS</span><span class="hl_char">:</span>TFileStream<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;Ico<span class="hl_char">:</span>&nbsp;PIcoHeader<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;N<span class="hl_char">:</span>&nbsp;Cardinal<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;NewGroupIconDirSize<span class="hl_char">:</span>&nbsp;LongInt<span class="hl_comment">;</span></li><li class="hl_l0">begin</li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;Win32Platform&nbsp;<span class="hl_char">&lt;</span><span class="hl_char">&gt;</span>&nbsp;VER_PLATFORM_WIN32_NT&nbsp;then</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;ShowMessage<span class="hl_char">(</span><span class="hl_quote">'Only supported on Windows NT and above'</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"></li><li class="hl_l0">&nbsp;&nbsp;Ico&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;nil<span class="hl_comment">;</span></li><li class="hl_l1"></li><li class="hl_l0">&nbsp;&nbsp;try</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;Load&nbsp;the&nbsp;icons&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">fs</span><span class="hl_char">:</span><span class="hl_char">=</span>TFileStream<span class="hl_char">.</span>Create<span class="hl_char">(</span>IcoFileName<span class="hl_char">,</span>fmOpenRead<span class="hl_char">,</span>fmShareDenyWrite<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;try</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;N<span class="hl_char">:</span><span class="hl_char">=</span><span class="hl_registr">fs</span><span class="hl_char">.</span>Size<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;Cardinal<span class="hl_char">(</span>N<span class="hl_char">)</span>&nbsp;<span class="hl_char">&gt;</span>&nbsp;Cardinal<span class="hl_char">(</span><span class="hl_char">$</span><span class="hl_number">100000</span><span class="hl_char">)</span>&nbsp;then&nbsp;&nbsp;{&nbsp;sanity&nbsp;check&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ShowMessage<span class="hl_char">(</span><span class="hl_quote">'Icon file is too large'</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GetMem<span class="hl_char">(</span>Ico<span class="hl_char">,</span>&nbsp;N<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">fs</span><span class="hl_char">.</span>Read<span class="hl_char">(</span>Ico^<span class="hl_char">,</span>N<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;finally</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">fs</span><span class="hl_char">.</span>Free<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l0"></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;Ensure&nbsp;the&nbsp;<span class="hl_function"><b>icon</b></span>&nbsp;is&nbsp;valid&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_function"><b>not</b></span>&nbsp;IsValidIcon<span class="hl_char">(</span>Ico<span class="hl_char">,</span>&nbsp;N<span class="hl_char">)</span>&nbsp;then</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ShowMessage<span class="hl_char">(</span><span class="hl_quote">'Icon file is invalid'</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;Update&nbsp;the&nbsp;resources&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;H&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;BeginUpdateResource<span class="hl_char">(</span>PChar<span class="hl_char">(</span>FileName<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">False</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;H&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span>&nbsp;then</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ShowMessage<span class="hl_char">(</span><span class="hl_quote">'BeginUpdateResource failed (1)'</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;try</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;LoadLibraryEx<span class="hl_char">(</span>PChar<span class="hl_char">(</span>FileName<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;LOAD_LIBRARY_AS_DATAFILE<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;M&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span>&nbsp;then</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ShowMessage<span class="hl_char">(</span><span class="hl_quote">'LoadLibraryEx failed (1)'</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;Load&nbsp;the&nbsp;<span class="hl_quote">'MAINICON'</span>&nbsp;group&nbsp;<span class="hl_function"><b>icon</b></span>&nbsp;<span class="hl_function"><b>resource</b></span>&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;FindResource<span class="hl_char">(</span>M<span class="hl_char">,</span>&nbsp;<span class="hl_quote">'MAINICON'</span><span class="hl_char">,</span>&nbsp;RT_GROUP_ICON<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;R&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span>&nbsp;then</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ShowMessage<span class="hl_char">(</span><span class="hl_quote">'FindResource failed (1)'</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Res&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;LoadResource<span class="hl_char">(</span>M<span class="hl_char">,</span>&nbsp;R<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;Res&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span>&nbsp;then</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ShowMessage<span class="hl_char">(</span><span class="hl_quote">'LoadResource failed (1)'</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GroupIconDir&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;LockResource<span class="hl_char">(</span>Res<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;GroupIconDir&nbsp;<span class="hl_char">=</span>&nbsp;nil&nbsp;then</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ShowMessage<span class="hl_char">(</span><span class="hl_quote">'LockResource failed (1)'</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;Delete&nbsp;<span class="hl_quote">'MAINICON'</span>&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wLanguage<span class="hl_char">:</span><span class="hl_char">=</span>GetSystemDefaultLangID<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_function"><b>not</b></span>&nbsp;GetResourceLanguage<span class="hl_char">(</span>M<span class="hl_char">,</span>&nbsp;RT_GROUP_ICON<span class="hl_char">,</span>&nbsp;<span class="hl_quote">'MAINICON'</span><span class="hl_char">,</span>&nbsp;wLanguage<span class="hl_char">)</span>&nbsp;then</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;&nbsp;Error<span class="hl_char">(</span><span class="hl_quote">'GetResourceLanguage failed (1)'</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_function"><b>not</b></span>&nbsp;UpdateResource<span class="hl_char">(</span>H<span class="hl_char">,</span>&nbsp;RT_GROUP_ICON<span class="hl_char">,</span>&nbsp;<span class="hl_quote">'MAINICON'</span><span class="hl_char">,</span>&nbsp;wLanguage<span class="hl_char">,</span>&nbsp;nil<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span>&nbsp;then</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ShowMessage<span class="hl_char">(</span><span class="hl_quote">'UpdateResource failed (1)'</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;Delete&nbsp;the&nbsp;RT_ICON&nbsp;<span class="hl_function"><b>icon</b></span>&nbsp;resources&nbsp;that&nbsp;belonged&nbsp;to&nbsp;<span class="hl_quote">'MAINICON'</span>&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;I&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span>&nbsp;to&nbsp;GroupIconDir<span class="hl_char">.</span>ItemCount<span class="hl_char">-</span><span class="hl_number">1</span>&nbsp;do&nbsp;begin</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wLanguage<span class="hl_char">:</span><span class="hl_char">=</span>GetSystemDefaultLangID<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_function"><b>not</b></span>&nbsp;UpdateResource<span class="hl_char">(</span>H<span class="hl_char">,</span>&nbsp;RT_ICON<span class="hl_char">,</span>&nbsp;MakeIntResource<span class="hl_char">(</span>GroupIconDir<span class="hl_char">.</span>Items<span class="hl_char">[</span>I<span class="hl_char">]</span><span class="hl_char">.</span>Id<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;wLanguage<span class="hl_char">,</span>&nbsp;nil<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span>&nbsp;then</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ShowMessage<span class="hl_char">(</span><span class="hl_quote">'UpdateResource failed (2)'</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l0"></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;Build&nbsp;the&nbsp;<span class="hl_function"><b>new</b></span>&nbsp;group&nbsp;<span class="hl_function"><b>icon</b></span>&nbsp;<span class="hl_function"><b>resource</b></span>&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NewGroupIconDirSize&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;<span class="hl_number">3</span><span class="hl_char">*</span><span class="hl_function">SizeOf</span><span class="hl_char">(</span><span class="hl_function">Word</span><span class="hl_char">)</span><span class="hl_char">+</span>Ico<span class="hl_char">.</span>ItemCount<span class="hl_char">*</span><span class="hl_function">SizeOf</span><span class="hl_char">(</span>TGroupIconDirItem<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GetMem<span class="hl_char">(</span>NewGroupIconDir<span class="hl_char">,</span>&nbsp;NewGroupIconDirSize<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;Build&nbsp;the&nbsp;<span class="hl_function"><b>new</b></span>&nbsp;group&nbsp;<span class="hl_function"><b>icon</b></span>&nbsp;<span class="hl_function"><b>resource</b></span>&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NewGroupIconDir<span class="hl_char">.</span>Reserved&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;GroupIconDir<span class="hl_char">.</span>Reserved<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NewGroupIconDir<span class="hl_char">.</span>Typ&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;GroupIconDir<span class="hl_char">.</span>Typ<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NewGroupIconDir<span class="hl_char">.</span>ItemCount&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;Ico<span class="hl_char">.</span>ItemCount<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;I&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span>&nbsp;to&nbsp;NewGroupIconDir<span class="hl_char">.</span>ItemCount<span class="hl_char">-</span><span class="hl_number">1</span>&nbsp;do&nbsp;begin</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NewGroupIconDir<span class="hl_char">.</span>Items<span class="hl_char">[</span>I<span class="hl_char">]</span><span class="hl_char">.</span>Header&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;Ico<span class="hl_char">.</span>Items<span class="hl_char">[</span>I<span class="hl_char">]</span><span class="hl_char">.</span>Header<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NewGroupIconDir<span class="hl_char">.</span>Items<span class="hl_char">[</span>I<span class="hl_char">]</span><span class="hl_char">.</span>Id&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;I<span class="hl_char">+</span><span class="hl_number">1</span><span class="hl_comment">; //assumes that there aren't any icons left</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l1"></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;Update&nbsp;<span class="hl_quote">'MAINICON'</span>&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;I&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span>&nbsp;to&nbsp;NewGroupIconDir<span class="hl_char">.</span>ItemCount<span class="hl_char">-</span><span class="hl_number">1</span>&nbsp;do</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_function"><b>not</b></span>&nbsp;UpdateResource<span class="hl_char">(</span>H<span class="hl_char">,</span>&nbsp;RT_ICON<span class="hl_char">,</span>&nbsp;MakeIntResource<span class="hl_char">(</span>NewGroupIconDir<span class="hl_char">.</span>Items<span class="hl_char">[</span>I<span class="hl_char">]</span><span class="hl_char">.</span>Id<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">1033</span><span class="hl_char">,</span>&nbsp;Pointer<span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">(</span>Ico<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;Ico<span class="hl_char">.</span>Items<span class="hl_char">[</span>I<span class="hl_char">]</span><span class="hl_char">.</span><span class="hl_function">Offset</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;Ico<span class="hl_char">.</span>Items<span class="hl_char">[</span>I<span class="hl_char">]</span><span class="hl_char">.</span>Header<span class="hl_char">.</span>ImageSize<span class="hl_char">)</span>&nbsp;then</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ShowMessage<span class="hl_char">(</span><span class="hl_quote">'UpdateResource failed (3)'</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;Update&nbsp;the&nbsp;icons&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_function"><b>not</b></span>&nbsp;UpdateResource<span class="hl_char">(</span>H<span class="hl_char">,</span>&nbsp;RT_GROUP_ICON<span class="hl_char">,</span>&nbsp;<span class="hl_quote">'MAINICON'</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">1033</span><span class="hl_char">,</span>&nbsp;NewGroupIconDir<span class="hl_char">,</span>&nbsp;NewGroupIconDirSize<span class="hl_char">)</span>&nbsp;then</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ShowMessage<span class="hl_char">(</span><span class="hl_quote">'UpdateResource failed (4)'</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{###&nbsp;myURL&nbsp;###}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_function"><b>not</b></span>&nbsp;UpdateResource<span class="hl_char">(</span>H<span class="hl_char">,</span>RT_RCDATA<span class="hl_char">,</span><span class="hl_quote">'URL'</span><span class="hl_char">,</span>wLanguage<span class="hl_char">,</span><span class="hl_function">addr</span><span class="hl_char">(</span><span class="hl_registr">ch</span><span class="hl_char">)</span><span class="hl_char">,</span><span class="hl_number">1024</span><span class="hl_char">)</span>&nbsp;then</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ShowMessage<span class="hl_char">(</span><span class="hl_quote">'Fck... cannot write URL'</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;finally</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FreeMem<span class="hl_char">(</span>NewGroupIconDir<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;finally</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FreeLibrary<span class="hl_char">(</span>M<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;except</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EndUpdateResource<span class="hl_char">(</span>H<span class="hl_char">,</span>&nbsp;<span class="hl_function">True</span><span class="hl_char">)</span><span class="hl_comment">;  { discard changes }</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_function"><b>not</b></span>&nbsp;EndUpdateResource<span class="hl_char">(</span>H<span class="hl_char">,</span>&nbsp;<span class="hl_function">False</span><span class="hl_char">)</span>&nbsp;then</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ShowMessage<span class="hl_char">(</span><span class="hl_quote">'EndUpdateResource failed'</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;finally</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;FreeMem<span class="hl_char">(</span>Ico<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=213082&amp;user=10063&amp;forum_n=6&amp;topic=13337.html&amp;page=0&amp;anchor=7" class="addthx" data-post="213082"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]4kusNick[/b]','')">4kusNick</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/1931.jpg" alt=""><br><span class=txtSm>Ранг: 748.2 <font color=magenta>(<b>! !</b>)</font>, 390thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.1'>Активность: 0.37<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1931">Участник</a><br><font color=blue>bytecode!</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 декабря 2008 04:22 &middot; Поправил: 4kusNick <br><script type="text/javascript">QU('4kusNick','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=4kusNick" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13337.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
Я как-то на сях для себя либу написал для работы с ресурсами и юзаю ее наздоровье откуда угодно, в том числе из-под делфи.<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;ResDll<span class="hl_char">.</span>cpp&nbsp;<span class="hl_char">:</span>&nbsp;Defines&nbsp;the&nbsp;<span class="hl_function"><b>entry</b></span>&nbsp;point&nbsp;for&nbsp;the&nbsp;DLL&nbsp;application<span class="hl_char">.</span></li><li class="hl_l1"><span class="hl_char">/</span><span class="hl_char">/</span></li><li class="hl_l0"></li><li class="hl_l1">#include&nbsp;<span class="hl_quote">&quot;stdafx.h&quot;</span></li><li class="hl_l0">#define&nbsp;WINAPI&nbsp;__stdcall</li><li class="hl_l1"></li><li class="hl_l0">BOOL&nbsp;APIENTRY&nbsp;DllMain<span class="hl_char">(</span>&nbsp;HANDLE&nbsp;hModule<span class="hl_char">,</span>&nbsp;</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>DWORD</b></span>&nbsp;&nbsp;ul_reason_for_call<span class="hl_char">,</span>&nbsp;</li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LPVOID&nbsp;lpReserved</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_function"><b>TRUE</b></span><span class="hl_comment">;</span></li><li class="hl_l0">}</li><li class="hl_l1"></li><li class="hl_l0">bool&nbsp;WINAPI&nbsp;ReplaceResource<span class="hl_char">(</span>PCHAR&nbsp;sSource<span class="hl_char">,</span>PCHAR&nbsp;sDest<span class="hl_char">,</span>PCHAR&nbsp;sType<span class="hl_char">,</span>PCHAR&nbsp;sName<span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;Переменные&nbsp;для&nbsp;чтения&nbsp;и&nbsp;добавления&nbsp;ресурса</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HANDLE&nbsp;hFile<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;dwFileSize<span class="hl_char">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwBytesRead<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LPBYTE&nbsp;lpBuffer<span class="hl_comment">;</span></li><li class="hl_l1"></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;Открываем&nbsp;файл&nbsp;для&nbsp;дальнейшего&nbsp;чтения</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hFile&nbsp;<span class="hl_char">=</span>&nbsp;CreateFile<span class="hl_char">(</span>sSource<span class="hl_char">,</span>GENERIC_READ<span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">,</span>OPEN_EXISTING<span class="hl_char">,</span>FILE_ATTRIBUTE_NO&nbsp;RMAL<span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;Если&nbsp;открыть&nbsp;не&nbsp;удалось<span class="hl_char">,</span>&nbsp;то&nbsp;выходим</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>hFile&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;INVALID_HANDLE_VALUE<span class="hl_char">)</span>&nbsp;return&nbsp;<span class="hl_function"><b>FALSE</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;Сохраняем&nbsp;его&nbsp;размер</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwFileSize&nbsp;<span class="hl_char">=</span>&nbsp;GetFileSize<span class="hl_char">(</span>hFile<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;Если&nbsp;не&nbsp;удалось&nbsp;получить&nbsp;размер<span class="hl_char">,</span>&nbsp;то&nbsp;выходим</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>dwFileSize&nbsp;<span class="hl_char">&lt;</span><span class="hl_char">=</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;Закрываем&nbsp;хендл&nbsp;файла</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle<span class="hl_char">(</span>hFile<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_function"><b>FALSE</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1"></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;Создаём&nbsp;массив&nbsp;для&nbsp;чтения&nbsp;файла</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lpBuffer&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function"><b>new</b></span>&nbsp;<span class="hl_function">BYTE</span><span class="hl_char">[</span>dwFileSize<span class="hl_char">]</span><span class="hl_comment">;</span></li><li class="hl_l0"></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>ReadFile<span class="hl_char">(</span>hFile<span class="hl_char">,</span>lpBuffer<span class="hl_char">,</span>dwFileSize<span class="hl_char">,</span><span class="hl_char">&amp;</span>dwBytesRead<span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;<span class="hl_function">FALSE</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HANDLE&nbsp;hResource<span class="hl_comment">;</span></li><li class="hl_l0"></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hResource&nbsp;<span class="hl_char">=</span>&nbsp;BeginUpdateResource<span class="hl_char">(</span>sDest<span class="hl_char">,</span><span class="hl_function">FALSE</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span><span class="hl_function"><b>NULL</b></span>&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;hResource<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>UpdateResource<span class="hl_char">(</span>hResource<span class="hl_char">,</span>sType<span class="hl_char">,</span>sName<span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span><span class="hl_char">(</span>LPVOID<span class="hl_char">)</span>lpBuffer<span class="hl_char">,</span>dwFileSize<span class="hl_char">)</span><span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;<span class="hl_function">FALSE</span><span class="hl_char">)</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EndUpdateResource</span><span class="hl_char">(</span>hResource<span class="hl_char">,</span>&nbsp;<span class="hl_function">FALSE</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delete&nbsp;<span class="hl_char">[</span><span class="hl_char">]</span>&nbsp;lpBuffer<span class="hl_comment">;        </span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle<span class="hl_char">(</span>hFile<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_function"><b>true</b></span><span class="hl_comment">;</span></li><li class="hl_l1">}</li>        </ol>
    </div>
</div></div>
<br><br>Когда пробовал адаптировать код под делфю - выходило херово, в некоторых случаях бились exeшки, а при юзаньи либы - не былись, так и забил переписывать под паскаль.
<br><br><font size="1"><i>-----<br>Флэш, ява, дотнет - на завтрак, обед и ужин. Unity3D на закуску.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=213103&amp;user=1931&amp;forum_n=6&amp;topic=13337.html&amp;page=0&amp;anchor=8" class="addthx" data-post="213103"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]mindkeeper[/b]','')">mindkeeper</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 11.1 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.39'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=10063">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 декабря 2008 10:31 <br><script type="text/javascript">QU('mindkeeper','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=mindkeeper" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13337.html&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
<I>4kusNick пишет:<br>Я как-то на сях для себя либу написал для работы с ресурсами и юзаю ее наздоровье откуда угодно, в том числе из-под делфи. <br>...<br>Когда пробовал адаптировать код под делфю - выходило херово, в некоторых случаях бились exeшки, а при юзаньи либы - не былись, так и забил переписывать под паскаль.  </I><br>  В том-то и дело - цель была сделать все единым exe и в делфях, без дополнительных dll и вобще файлов любого типа. Поэтому все, что надо, включил в свои ресурсы (строго говоря, и эту dll можно было включить, но так хотелось заставить делфи нормально понимать api). А тупо переписывать из исходника на сях в паскаль не так-то просто, приведение типов и структур до нервного тика может довести (убедился, когда пытался самостоятельно в паскале вкрутить Canon SDK - у них то только 1 пример, и то только с использованием Microsoft Foundation Classes...). В общем, формула msdn+google+brain все же действует <img src="img/smilies/s2.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=213129&amp;user=10063&amp;forum_n=6&amp;topic=13337.html&amp;page=0&amp;anchor=9" class="addthx" data-post="213129"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]progopis[/b]','')">progopis</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 101.0 (ветеран), 344thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.1'>Активность: 1.15<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2449">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 декабря 2008 12:42 &middot; Поправил: progopis <br><script type="text/javascript">QU('progopis','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=progopis" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13337.html&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
<b>mindkeeper</b><br>Здесь сорцы моего любимого редактора (Delphi 2006).<br>http://www.wilsonc.demon.co.ukd10resourceeditor.htm http://www.wilsonc.demon.co.uk/d10resourceeditor.htm <br>Из минусов - отсутствует поиск. Из плюсов - побеждает файлы после распаковки, в то время как тот же ResHack сначала хочет чтобы ресурсы пофиксили.<br><br>Да, забыл. XN Resource Editor называется.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=213148&amp;user=2449&amp;forum_n=6&amp;topic=13337.html&amp;page=0&amp;anchor=10" class="addthx" data-post="213148"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]Ray[/b]','')">Ray</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 28.7 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.2'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=16451">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 декабря 2008 15:46 <br><script type="text/javascript">QU('Ray','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Ray" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13337.html&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
<b>progopis</b><br>Resource Tuner тоже вполне неплохо справляется с файлами после распаковки.<br>Но за XN Resource Editor спасибо.Боекомплект пополнен <img src="img/smilies/s1.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=213175&amp;user=16451&amp;forum_n=6&amp;topic=13337.html&amp;page=0&amp;anchor=11" class="addthx" data-post="213175"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]YO-everybody[/b]','')">YO-everybody</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 41.9 (посетитель), 3thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.59'>Активность: 0.04<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=14471">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 декабря 2008 20:07 <br><script type="text/javascript">QU('YO-everybody','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=YO-everybody" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13337.html&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
Меня прёт PE Explorer https://nova-forum.com/topic.cgi?forum=35&amp;topic=2300&amp;glp
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=213205&amp;user=14471&amp;forum_n=6&amp;topic=13337.html&amp;page=0&amp;anchor=12" class="addthx" data-post="213205"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]mindkeeper[/b]','')">mindkeeper</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 11.1 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.39'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=10063">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 декабря 2008 11:05 <br><script type="text/javascript">QU('mindkeeper','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=mindkeeper" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13337.html&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
Всем спасибо, закрываю.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=213841&amp;user=10063&amp;forum_n=6&amp;topic=13337.html&amp;page=0&amp;anchor=13" class="addthx" data-post="213841"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Работа с ресурсами PE-exe</span></td>
</tr></table>
</div>
<a name=newreply></a>
<div align=center>
<table class=forums>
<tr>
<td class=caption4 width="100%"><span class=header>Эта тема закрыта. Ответы больше не принимаются.</span></td>
</tr>
</table>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=13337" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
