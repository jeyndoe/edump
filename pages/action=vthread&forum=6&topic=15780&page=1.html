<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Небольшие полезные коды - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Часто во время написания проектов возникают небольшие, но при этом довольно общие задачи, которые потом могут быть использованы в будущем, вот эта тема как раз для этого. В этой теме предлагаю размещать небольшие фрагменты кода,">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=55995'>tyns777</a> (+4 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Небольшие полезные коды</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> <a href="action=vthread&amp;forum=6&amp;topic=15780&amp;page=0.html">&lt;&lt;</a> .  <a href="action=vthread&amp;forum=6&amp;topic=15780&amp;page=0.html">1</a> . <b>2</b> . <a href="action=vthread&amp;forum=6&amp;topic=15780&amp;page=2.html">3</a> . <a href="action=vthread&amp;forum=6&amp;topic=15780&amp;page=2.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]Vol4ok[/b]','')">Vol4ok</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 47.1 (посетитель), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.61'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=18950">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 февраля 2010 18:42 &middot; Поправил: Vol4ok <br><script type="text/javascript">QU('Vol4ok','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vol4ok" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15780&amp;page=1#1');return false;">#1</a> </span><div align=left><br>
Часто во время написания проектов возникают небольшие, но при этом довольно общие задачи, которые потом могут быть использованы в будущем, вот эта тема как раз для этого. В этой теме предлагаю размещать небольшие фрагменты кода, которые могут применятся в повседневной практике системного программирования. <br><br>В этом топике можно <br> - размещать только свои коды, а не копировать из общедоступных источников<br> - желательно хорошо протестировать код, прежде чем разместить его. Если вы не уверены, что код работает точно будет работать так как надо на всех ОС и всех процах, то надо пометить - где и каким образом тестировался этот код, или вообще написать что код не тестирован (хорошо подумав при это, стоит ли вообще такой код размещать).<br> - нормально его оформить, чтобы тот кому этот код пригодится смог разобраться в нем быстрее чем писать это же с нуля. Обязательно должны быть описания входных и выходных данных. Крайне приветствуются цели создания кода, основные требования которым он удовлетворяет, и описание того как работает этот код.<br><br>Также приветствуются багфиксы, замечания по коду и варианты оптимизации.<br><br>Итак начну с себя. Недавно столкнулся с необходимостью делать высокоточные паузы в работе кода, в моем случае необходимо было достигать точности десятых милисекунд. В итоге я написал микросекундный таймер<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">#define&nbsp;YIELD_LOOP&nbsp;<span class="hl_number">200</span></li><li class="hl_l1">#define&nbsp;get_interval_in_us<span class="hl_char">(</span>_t1_<span class="hl_char">,</span>_t2_<span class="hl_char">,</span>_fq_<span class="hl_char">)</span>&nbsp;<span class="hl_char">(</span><span class="hl_function">int</span><span class="hl_char">)</span><span class="hl_char">(</span><span class="hl_char">(</span>_t2_<span class="hl_char">.</span>QuadPart&nbsp;<span class="hl_char">-</span>&nbsp;_t1_<span class="hl_char">.</span>QuadPart<span class="hl_char">)</span><span class="hl_char">*</span><span class="hl_number">1000000</span>&nbsp;<span class="hl_char">/</span>&nbsp;_fq_<span class="hl_char">.</span>QuadPart<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">static&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;g_sleep_error&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">1000</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>void</b></span>&nbsp;precision_sleep<span class="hl_char">(</span><span class="hl_function"><b>int</b></span>&nbsp;timeout<span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;i<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;sleep_time<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;real_sleep_time<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LARGE_INTEGER&nbsp;t2<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LARGE_INTEGER&nbsp;t1<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LARGE_INTEGER&nbsp;fq<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QueryPerformanceCounter<span class="hl_char">(</span><span class="hl_char">&amp;</span>t1<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QueryPerformanceFrequency<span class="hl_char">(</span><span class="hl_char">&amp;</span>fq<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>timeout&nbsp;<span class="hl_char">&gt;</span>&nbsp;g_sleep_error<span class="hl_char">)</span>&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sleep_time&nbsp;<span class="hl_char">=</span>&nbsp;timeout&nbsp;<span class="hl_char">-</span>&nbsp;g_sleep_error<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sleep<span class="hl_char">(</span>sleep_time<span class="hl_char">/</span><span class="hl_number">1000</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QueryPerformanceCounter<span class="hl_char">(</span><span class="hl_char">&amp;</span>t2<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;real_sleep_time&nbsp;<span class="hl_char">=</span>&nbsp;get_interval_in_us<span class="hl_char">(</span>t1<span class="hl_char">,</span>t2<span class="hl_char">,</span>fq<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>timeout&nbsp;<span class="hl_char">&lt;</span>&nbsp;real_sleep_time<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_sleep_error&nbsp;<span class="hl_char">+</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">(</span>real_sleep_time&nbsp;<span class="hl_char">-</span>&nbsp;timeout<span class="hl_char">)</span><span class="hl_char">/</span><span class="hl_number">2</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>else</b></span>&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>g_sleep_error&nbsp;<span class="hl_char">&gt;</span>&nbsp;<span class="hl_number">2000</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_sleep_error&nbsp;<span class="hl_char">-</span><span class="hl_char">=</span>&nbsp;min<span class="hl_char">(</span><span class="hl_char">(</span>timeout&nbsp;<span class="hl_char">-</span>&nbsp;real_sleep_time<span class="hl_char">)</span><span class="hl_char">/</span><span class="hl_number">2</span><span class="hl_char">,</span>&nbsp;g_sleep_error<span class="hl_char">/</span><span class="hl_number">2</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>while</b></span>&nbsp;<span class="hl_char">(</span>get_interval_in_us<span class="hl_char">(</span>t1<span class="hl_char">,</span>t2<span class="hl_char">,</span>fq<span class="hl_char">)</span>&nbsp;<span class="hl_char">&lt;</span>&nbsp;timeout<span class="hl_char">)</span>&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;<span class="hl_char">(</span>i<span class="hl_char">=</span><span class="hl_number">0</span><span class="hl_comment">;i&lt;YIELD_LOOP;i++)</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;YieldProcessor</span><span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>Sleep<span class="hl_char">(</span><span class="hl_number">0</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QueryPerformanceCounter<span class="hl_char">(</span><span class="hl_char">&amp;</span>t2<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">}</li>        </ol>
    </div>
</div></div>
<br> - timeout - время таймаута в  микросекундах<br><br>код рекомендуется выполнять с повышением точности обыкновенного слипа, например так:<br><br>#include &lt;Mmsystem.h&gt;<br>...<br>timeBeginPeriod(1);<br>precision_sleep(timeout);<br>timeEndPeriod(1);<br><br>Код делает таймауты с микросекундой точностью. Как извесно простой Sleep имеет огромную погрешность, допутим Sleep(1) - в нормальных условиях выполнется около 10-15мс (1,5-2мс при установке timeBeginPeriod(1)). Высокая точность достигается за счет использования цикла опроса высокоточного системного таймера (период &lt;1нс - на современных компах и 300-400нс на более старых). Минимальная погрешность данной функции равна времени вызова QueryPerformanceCounter - которое на современных компах равно 200-300нс, на компах по старше может доходить до микросекунды. Ес-но в условиях нехватки процессорного времени погрешность может значительно возрастать.<br><br>Конечно такой метод измерения сильно грузит проц, поэтому при ожидании более 1мс будет использоваться обыкновенный слип, но поскольку он имеет большую погрешность, то динамически в при многократном вызове, precision_sleep проводит пересчет предельной погрешности слипа, подгоняя его под оптимальное значение, при котором будет сохранена хорошая точность при минимальной нагрузке на процессор. Однако не смотря на это всегда имеется вероятность того что слип превысит предельное время и внесет дополнительную погрешность.<br><br>Код тестировался на 2х ядероном компе с процом core2duo и на старом одноядерном Celeron-е<br>При тестировании интервалов больших 3мс загрузка процессора скачет 1% до 15%, при интервалах больих 10мс в средем чтото около 2-3%. Хуже всего дело обстоит с таймаутами порядка 1мс и менее, загрузка может быть очень большой, так как слип в этом случае не работает, чуть чуть улутшить положение можно если заменить <br>for (i=0;i&lt;YIELD_LOOP;i++)<br>	YieldProcessor();<br>на Sleep(0), будет небольшая потеря точности, на моем компе Sleep(0) работает примерно за 1-2мкс (на старых компах может быть еще больше) когда YIELD_LOOP работает &lt; 1 мкс<br><br>Данный код может быть использован при написании сетевых приложений, например для того чтобы точно регуоировать скорость выходного трафика.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=251202&amp;user=18950&amp;forum_n=6&amp;topic=15780&amp;page=1&amp;anchor=1" class="addthx" data-post="251202"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]ADACH[/b]','')">ADACH</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 13.9 (новичок), 9thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.48'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3527">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 апреля 2010 20:17 &middot; Поправил: ADACH <br><script type="text/javascript">QU('ADACH','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ADACH" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15780&amp;page=1#2');return false;">#2</a> </span><div align=left><br>
Самовыгружение dll из памяти.<br>Ф-я принимает параметром ImageBase модуля который необходимо выгрузить.<br><b>Warning! Поток в чьём контексте исполняется код, будет закрыт.</b><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>void</b></span>&nbsp;__declspec<span class="hl_char">(</span>noreturn<span class="hl_char">)</span>&nbsp;unloadLibrary<span class="hl_char">(</span>HMODULE&nbsp;hDll<span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">*</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_start<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">edi</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>call</b></span>&nbsp;<span class="hl_function"><b>near</b></span>&nbsp;<span class="hl_registr">esi</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>test</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>je</b></span>&nbsp;_start</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">ebx</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_registr">ebx</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_registr">esi</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_registr">edi</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jmp</b></span>&nbsp;<span class="hl_function"><b>near</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">*</span><span class="hl_char">/</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>const</b></span>&nbsp;<span class="hl_function"><b>char</b></span>&nbsp;dllUnloadCode&nbsp;<span class="hl_char">[</span><span class="hl_char">]</span>&nbsp;<span class="hl_char">=</span>&nbsp;{0x57<span class="hl_char">,</span>&nbsp;0xFF<span class="hl_char">,</span>&nbsp;0xD6<span class="hl_char">,</span>&nbsp;0x85<span class="hl_char">,</span>&nbsp;0xC0<span class="hl_char">,</span>&nbsp;0x74<span class="hl_char">,</span>&nbsp;0xF9<span class="hl_char">,</span>&nbsp;0x8B<span class="hl_char">,</span>&nbsp;0xC3<span class="hl_char">,</span>&nbsp;0x5B<span class="hl_char">,</span>&nbsp;0x5E<span class="hl_char">,</span>&nbsp;0x5F<span class="hl_char">,</span>&nbsp;0xFF<span class="hl_char">,</span>&nbsp;0xE0}<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>char</b></span>&nbsp;<span class="hl_char">*</span>&nbsp;memAddr&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">(</span><span class="hl_function"><b>char</b></span>&nbsp;<span class="hl_char">*</span><span class="hl_char">)</span>VirtualAllocEx<span class="hl_char">(</span>GetCurrentProcess<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">1</span><span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MEM_COMMIT&nbsp;<span class="hl_char">|</span>&nbsp;MEM_RESERVE<span class="hl_char">,</span>PAGE_EXECUTE_READWRITE<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memcpy<span class="hl_char">(</span>memAddr<span class="hl_char">,</span>dllUnloadCode<span class="hl_char">,</span><span class="hl_function">sizeof</span><span class="hl_char">(</span>dllUnloadCode<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_asm</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">ebx</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">esi</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">edi</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span><span class="hl_char">[</span>hDll<span class="hl_char">]</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">esi</span><span class="hl_char">,</span><span class="hl_char">[</span>FreeLibrary<span class="hl_char">]</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span><span class="hl_char">[</span>ExitThread<span class="hl_char">]</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>jmp</b></span>&nbsp;<span class="hl_char">[</span>memAddr<span class="hl_char">]</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">}<span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=255956&amp;user=3527&amp;forum_n=6&amp;topic=15780&amp;page=1&amp;anchor=2" class="addthx" data-post="255956"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]SLV[/b]','')">SLV</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 309.8 (мудрец), 21thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.69'>Активность: 0.17<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=663">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 апреля 2010 09:41 <br><script type="text/javascript">QU('SLV','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=SLV" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15780&amp;page=1#3');return false;">#3</a> </span><div align=left><br>
&gt; Самовыгружение dll из памяти.<br>а потом ещё сам процесс упадёт скорее всего <img src="img/smilies/s1.gif" alt="">
<br><br><font size="1"><i>-----<br>Shalom ebanats!</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=255984&amp;user=663&amp;forum_n=6&amp;topic=15780&amp;page=1&amp;anchor=3" class="addthx" data-post="255984"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 222thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 апреля 2010 12:57 <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15780&amp;page=1#4');return false;">#4</a> </span><div align=left><br>
<b>SLV пишет<br>а потом ещё сам процесс упадёт скорее всего  <br></b><br><br>Не, не упадет. Я пробовал, только по-другому: со снятием хуков, ведущей на эту dll, а потом выгрузка...
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=256000&amp;user=24257&amp;forum_n=6&amp;topic=15780&amp;page=1&amp;anchor=4" class="addthx" data-post="256000"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]Clerk[/b]','')">Clerk</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 255.8 (наставник), 19thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.86'>Активность: 0.15<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=17964">Участник</a><br><font color=blue>vx</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 апреля 2010 16:05 <br><script type="text/javascript">QU('Clerk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Clerk" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15780&amp;page=1#5');return false;">#5</a> </span><div align=left><br>
<b>ADACH</b><br>FreeLibraryAndExitThread() ?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=256011&amp;user=17964&amp;forum_n=6&amp;topic=15780&amp;page=1&amp;anchor=5" class="addthx" data-post="256011"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]ADACH[/b]','')">ADACH</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 13.9 (новичок), 9thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.48'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3527">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 апреля 2010 22:08 <br><script type="text/javascript">QU('ADACH','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ADACH" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15780&amp;page=1#6');return false;">#6</a> </span><div align=left><br>
<b>[OFFTOPIC]</b><br><I>SLV пишет:<br>&gt; Самовыгружение dll из памяти.<br>а потом ещё сам процесс упадёт скорее всего  </I><br>Нет не упадёт, произойдёт корректная остановка потока с помощью ExitThread.<br><br><I>Clerk пишет:<br>ADACH<br>FreeLibraryAndExitThread() ?  </I><br>да<br><br><b>[/OFFTOPIC]</b>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=256020&amp;user=3527&amp;forum_n=6&amp;topic=15780&amp;page=1&amp;anchor=6" class="addthx" data-post="256020"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]punxer[/b]','')">punxer</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 30.0 (посетитель), 4thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.76'>Активность: 0.03<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=6939">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 22 мая 2010 15:10 &middot; Поправил: punxer <br><script type="text/javascript">QU('punxer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=punxer" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15780&amp;page=1#7');return false;">#7</a> </span><div align=left><br><div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>void</b></span>&nbsp;DebugPrintF<span class="hl_char">(</span><span class="hl_function"><b>const</b></span>&nbsp;<span class="hl_function">char</span><span class="hl_char">*</span>&nbsp;<span class="hl_function">Format</span><span class="hl_char">,</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;va_list&nbsp;args<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;len<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>char</b></span>&nbsp;<span class="hl_char">*</span>&nbsp;buffer<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;va_start<span class="hl_char">(</span>&nbsp;args<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>Format</b></span>&nbsp;<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;len&nbsp;<span class="hl_char">=</span>&nbsp;_vscprintf<span class="hl_char">(</span>&nbsp;<span class="hl_function">Format</span><span class="hl_char">,</span>&nbsp;args&nbsp;<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buffer&nbsp;<span class="hl_char">=</span><span class="hl_char">(</span><span class="hl_function">char</span><span class="hl_char">*</span><span class="hl_char">)</span>&nbsp;malloc<span class="hl_char">(</span>&nbsp;len&nbsp;<span class="hl_char">*</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span><span class="hl_function">char</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vsprintf<span class="hl_char">(</span>&nbsp;buffer<span class="hl_char">,</span>&nbsp;<span class="hl_function">Format</span><span class="hl_char">,</span>&nbsp;args&nbsp;<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OutputDebugString<span class="hl_char">(</span>buffer<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free<span class="hl_char">(</span>&nbsp;buffer&nbsp;<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;va_end<span class="hl_char">(</span>args<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return<span class="hl_comment">;</span></li><li class="hl_l0">}</li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=258545&amp;user=6939&amp;forum_n=6&amp;topic=15780&amp;page=1&amp;anchor=7" class="addthx" data-post="258545"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]punxer[/b]','')">punxer</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 30.0 (посетитель), 4thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.76'>Активность: 0.03<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=6939">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 22 мая 2010 16:00 <br><script type="text/javascript">QU('punxer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=punxer" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15780&amp;page=1#8');return false;">#8</a> </span><div align=left><br><div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>void</b></span>&nbsp;GenerateKey&nbsp;<span class="hl_char">(</span>&nbsp;<span class="hl_function"><b>WORD</b></span>&nbsp;vk<span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KEYBDINPUT&nbsp;&nbsp;kinpt<span class="hl_char">=</span>{0}<span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INPUT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inpt</span><span class="hl_char">=</span>{0}<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;generate&nbsp;down&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inpt<span class="hl_char">.</span>type<span class="hl_char">=</span>INPUT_KEYBOARD<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kinpt<span class="hl_char">.</span>wVk<span class="hl_char">=</span>vk<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kinpt<span class="hl_char">.</span>time<span class="hl_char">=</span><span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kinpt<span class="hl_char">.</span>dwExtraInfo<span class="hl_char">=</span><span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kinpt<span class="hl_char">.</span>wScan<span class="hl_char">=</span><span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kinpt<span class="hl_char">.</span>dwFlags<span class="hl_char">=</span><span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inpt<span class="hl_char">.</span>ki<span class="hl_char">=</span>kinpt<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SendInput<span class="hl_char">(</span><span class="hl_number">1</span><span class="hl_char">,</span><span class="hl_char">&amp;</span>inpt<span class="hl_char">,</span><span class="hl_function">sizeof</span><span class="hl_char">(</span>inpt<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kinpt<span class="hl_char">.</span>dwFlags<span class="hl_char">=</span>KEYEVENTF_KEYUP<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sleep<span class="hl_char">(</span><span class="hl_number">200</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SendInput<span class="hl_char">(</span><span class="hl_number">1</span><span class="hl_char">,</span><span class="hl_char">&amp;</span>inpt<span class="hl_char">,</span><span class="hl_function">sizeof</span><span class="hl_char">(</span>inpt<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return<span class="hl_comment">;</span></li><li class="hl_l1">}</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_function"><b>void</b></span>&nbsp;GenerateKbdEvent&nbsp;<span class="hl_char">(</span><span class="hl_function"><b>WORD</b></span>&nbsp;vk<span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;keybd_event<span class="hl_char">(</span><span class="hl_char">(</span><span class="hl_function">BYTE</span><span class="hl_char">)</span>vk<span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;keybd_event<span class="hl_char">(</span><span class="hl_char">(</span><span class="hl_function">BYTE</span><span class="hl_char">)</span>vk<span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">,</span>KEYEVENTF_KEYUP<span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return<span class="hl_comment">;</span></li><li class="hl_l0">}</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>void</b></span>&nbsp;PostVkeyMessage<span class="hl_char">(</span>HWND&nbsp;hWnd<span class="hl_char">,</span><span class="hl_function"><b>WORD</b></span>&nbsp;vk<span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PostMessage<span class="hl_char">(</span>hWnd<span class="hl_char">,</span>WM_KEYDOWN<span class="hl_char">,</span>VK_RETURN<span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sleep<span class="hl_char">(</span><span class="hl_number">100</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PostMessage<span class="hl_char">(</span>hWnd<span class="hl_char">,</span>WM_KEYUP<span class="hl_char">,</span>VK_RETURN<span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return<span class="hl_comment">;</span></li><li class="hl_l0">}</li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_function"><b>void</b></span>&nbsp;SendVkeyMessage<span class="hl_char">(</span>HWND&nbsp;hWnd<span class="hl_char">,</span><span class="hl_function"><b>WORD</b></span>&nbsp;vk<span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SendMessage<span class="hl_char">(</span>hWnd<span class="hl_char">,</span>WM_KEYDOWN<span class="hl_char">,</span>VK_RETURN<span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sleep<span class="hl_char">(</span><span class="hl_number">100</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SendMessage<span class="hl_char">(</span>hWnd<span class="hl_char">,</span>WM_KEYUP<span class="hl_char">,</span>VK_RETURN<span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return<span class="hl_comment">;</span></li><li class="hl_l1">}</li><li class="hl_l0"><span class="hl_function"><b>void</b></span>&nbsp;GenerateKbdUPEvent&nbsp;<span class="hl_char">(</span><span class="hl_function"><b>WORD</b></span>&nbsp;vk<span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;keybd_event<span class="hl_char">(</span><span class="hl_char">(</span><span class="hl_function">BYTE</span><span class="hl_char">)</span>vk<span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">,</span>KEYEVENTF_KEYUP<span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return<span class="hl_comment">;</span></li><li class="hl_l1">}</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;</li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=258548&amp;user=6939&amp;forum_n=6&amp;topic=15780&amp;page=1&amp;anchor=8" class="addthx" data-post="258548"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]punxer[/b]','')">punxer</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 30.0 (посетитель), 4thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.76'>Активность: 0.03<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=6939">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 22 мая 2010 16:01 <br><script type="text/javascript">QU('punxer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=punxer" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15780&amp;page=1#9');return false;">#9</a> </span><div align=left><br><div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>DWORD</b></span>&nbsp;HookCOM<span class="hl_char">(</span>PVOID<span class="hl_char">*</span>&nbsp;lplpI<span class="hl_char">,</span><span class="hl_function"><b>DWORD</b></span>&nbsp;offs<span class="hl_char">,</span><span class="hl_function"><b>DWORD</b></span>&nbsp;new_fn<span class="hl_char">,</span><span class="hl_function"><b>DWORD</b></span>&nbsp;vtbl_size<span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;&nbsp;&nbsp;<span class="hl_function">ret</span><span class="hl_char">=</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">DWORD</span><span class="hl_char">*</span>&nbsp;&nbsp;ppvtbl<span class="hl_char">=</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">DWORD</span><span class="hl_char">*</span>&nbsp;&nbsp;pvtbl<span class="hl_char">=</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;&nbsp;&nbsp;flOldProtect<span class="hl_char">=</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;&nbsp;&nbsp;flNewProtect<span class="hl_char">=</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;&nbsp;&nbsp;flDontCare<span class="hl_char">=</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">DWORD</span><span class="hl_char">*</span>&nbsp;&nbsp;pOldFN<span class="hl_char">=</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MEMORY_BASIC_INFORMATION&nbsp;mbi<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ppvtbl&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">*</span><span class="hl_char">)</span><span class="hl_char">*</span>lplpI<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pvtbl&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">*</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">*</span>ppvtbl<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VirtualQuery<span class="hl_char">(</span>&nbsp;<span class="hl_char">(</span><span class="hl_function">void</span><span class="hl_char">*</span><span class="hl_char">)</span>pvtbl<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>mbi<span class="hl_char">,</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>mbi<span class="hl_char">)</span>&nbsp;<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;remove&nbsp;ReadOnly&nbsp;<span class="hl_function"><b>and</b></span>&nbsp;ExecuteRead&nbsp;attributes<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>add</b></span>&nbsp;on&nbsp;ReadWrite&nbsp;flag</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flNewProtect&nbsp;<span class="hl_char">=</span>&nbsp;mbi<span class="hl_char">.</span>Protect<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flNewProtect&nbsp;<span class="hl_char">&amp;</span><span class="hl_char">=</span>&nbsp;~<span class="hl_char">(</span>PAGE_READONLY&nbsp;<span class="hl_char">|</span>&nbsp;PAGE_EXECUTE_READ&nbsp;<span class="hl_char">|</span>&nbsp;PAGE_EXECUTE<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flNewProtect&nbsp;<span class="hl_char">|</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">(</span>PAGE_READWRITE<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>&nbsp;<span class="hl_char">!</span>VirtualProtect<span class="hl_char">(</span>&nbsp;&nbsp;&nbsp;<span class="hl_char">(</span><span class="hl_function">void</span><span class="hl_char">*</span><span class="hl_char">)</span>pvtbl<span class="hl_char">,</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>PVOID<span class="hl_char">)</span><span class="hl_char">*</span>vtbl_size<span class="hl_char">,</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flNewProtect</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>flOldProtect<span class="hl_char">)</span>&nbsp;<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_function"><b>false</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>Hook&nbsp;Vtbl</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pOldFN&nbsp;<span class="hl_char">=</span>&nbsp;MakePtr<span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">*</span><span class="hl_char">,</span>pvtbl<span class="hl_char">,</span>offs<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">ret</span><span class="hl_char">=</span><span class="hl_char">*</span>pOldFN<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">*</span>pOldFN<span class="hl_char">=</span><span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span>&nbsp;new_fn<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VirtualProtect<span class="hl_char">(</span><span class="hl_char">(</span><span class="hl_function">void</span><span class="hl_char">*</span><span class="hl_char">)</span>pvtbl<span class="hl_char">,</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>PVOID<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;flOldProtect<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>flDontCare<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_function"><b>ret</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">}</li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=258549&amp;user=6939&amp;forum_n=6&amp;topic=15780&amp;page=1&amp;anchor=9" class="addthx" data-post="258549"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]punxer[/b]','')">punxer</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 30.0 (посетитель), 4thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.76'>Активность: 0.03<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=6939">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 22 мая 2010 16:03 <br><script type="text/javascript">QU('punxer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=punxer" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15780&amp;page=1#10');return false;">#10</a> </span><div align=left><br><div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>void</b></span>&nbsp;&nbsp;&nbsp;&nbsp;WinErrDebugOut&nbsp;<span class="hl_char">(</span>&nbsp;<span class="hl_function">void</span><span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>CHAR</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">*</span>Buffer<span class="hl_comment">;    </span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;&nbsp;&nbsp;&nbsp;LangId&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">=</span>&nbsp;0x400<span class="hl_comment">; // Default.</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;FormatMessage&nbsp;<span class="hl_char">(</span>&nbsp;FORMAT_MESSAGE_ALLOCATE_BUFFER&nbsp;<span class="hl_char">|</span>&nbsp;FORMAT_MESSAGE_FROM_SYSTEM<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;GetLastError<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;LangId<span class="hl_char">,</span>&nbsp;&nbsp;Buffer<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>NULL</b></span>&nbsp;<span class="hl_char">)</span><span class="hl_comment">;    </span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DebugPrintF<span class="hl_char">(</span><span class="hl_quote">&quot;%s&quot;</span><span class="hl_char">,</span>&nbsp;Buffer<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LocalFree<span class="hl_char">(</span>&nbsp;Buffer<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">}</li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=258550&amp;user=6939&amp;forum_n=6&amp;topic=15780&amp;page=1&amp;anchor=10" class="addthx" data-post="258550"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]punxer[/b]','')">punxer</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 30.0 (посетитель), 4thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.76'>Активность: 0.03<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=6939">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 мая 2010 14:34 <br><script type="text/javascript">QU('punxer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=punxer" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15780&amp;page=1#11');return false;">#11</a> </span><div align=left><br>
Делает текущего пользователя владельцем файла<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">&nbsp;</li><li class="hl_l1">bool&nbsp;GetOwnership&nbsp;<span class="hl_char">(</span>LPCSTR&nbsp;p<span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HANDLE&nbsp;hToken<span class="hl_char">=</span><span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PTOKEN_USER&nbsp;ptuUser<span class="hl_char">=</span><span class="hl_function"><b>NULL</b></span><span class="hl_comment">;  </span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;dwSize<span class="hl_char">=</span><span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SECURITY_DESCRIPTOR&nbsp;sdSID<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;bWasEnabled<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bool&nbsp;ret1<span class="hl_char">=</span><span class="hl_function">false</span><span class="hl_char">,</span>ret2<span class="hl_char">=</span><span class="hl_function"><b>false</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RtlAdjustPrivilege<span class="hl_char">(</span>SE_TAKE_OWNERSHIP_PRIVILEGE<span class="hl_char">,</span><span class="hl_function">TRUE</span><span class="hl_char">,</span><span class="hl_function">FALSE</span><span class="hl_char">,</span><span class="hl_char">(</span>PBOOLEAN<span class="hl_char">)</span><span class="hl_char">&amp;</span>&nbsp;bWasEnabled<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OpenProcessToken<span class="hl_char">(</span>GetCurrentProcess<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_char">,</span>TOKEN_QUERY<span class="hl_char">,</span><span class="hl_char">&amp;</span>hToken<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ptuUser<span class="hl_char">=</span><span class="hl_char">(</span>PTOKEN_USER<span class="hl_char">)</span>malloc<span class="hl_char">(</span>0x200<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GetTokenInformation<span class="hl_char">(</span>hToken<span class="hl_char">,</span><span class="hl_char">(</span>TOKEN_INFORMATION_CLASS<span class="hl_char">)</span><span class="hl_number">1</span><span class="hl_char">,</span>ptuUser<span class="hl_char">,</span>0x200<span class="hl_char">,</span><span class="hl_char">&amp;</span>&nbsp;dwSize<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InitializeSecurityDescriptor&nbsp;<span class="hl_char">(</span><span class="hl_char">&amp;</span>sdSID<span class="hl_char">,</span>SECURITY_DESCRIPTOR_REVISION<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetSecurityDescriptorOwner&nbsp;<span class="hl_char">(</span><span class="hl_char">&amp;</span>sdSID<span class="hl_char">,</span>ptuUser<span class="hl_char">-</span><span class="hl_char">&gt;</span>User<span class="hl_char">.</span>Sid<span class="hl_char">,</span><span class="hl_function">false</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle<span class="hl_char">(</span>hToken<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret1<span class="hl_char">=</span>SetFileSecurityA<span class="hl_char">(</span>p<span class="hl_char">,</span>OWNER_SECURITY_INFORMATION<span class="hl_char">,</span><span class="hl_char">&amp;</span>sdSID<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span><span class="hl_char">!</span>ret1<span class="hl_char">)</span>&nbsp;return&nbsp;<span class="hl_function"><b>false</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret2<span class="hl_char">=</span>SetFileSecurityA<span class="hl_char">(</span>p<span class="hl_char">,</span>DACL_SECURITY_INFORMATION<span class="hl_char">,</span><span class="hl_char">&amp;</span>sdSID<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span><span class="hl_char">!</span>ret2<span class="hl_char">)</span>&nbsp;return&nbsp;<span class="hl_function"><b>false</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_function"><b>true</b></span><span class="hl_comment">;</span></li><li class="hl_l1">}</li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=258796&amp;user=6939&amp;forum_n=6&amp;topic=15780&amp;page=1&amp;anchor=11" class="addthx" data-post="258796"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]punxer[/b]','')">punxer</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 30.0 (посетитель), 4thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.76'>Активность: 0.03<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=6939">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 мая 2010 14:37 <br><script type="text/javascript">QU('punxer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=punxer" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15780&amp;page=1#12');return false;">#12</a> </span><div align=left><br>
Добавляет ДЛЛ в таблицу импорта<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">&nbsp;&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>int</b></span>&nbsp;infectByDLL&nbsp;<span class="hl_char">(</span>PCHAR&nbsp;path<span class="hl_char">,</span>PCHAR&nbsp;OUR_DLL_NAME<span class="hl_char">,</span>PCHAR&nbsp;OUR_FUNC_NAME&nbsp;<span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMAGE_DOS_HEADER<span class="hl_char">*</span>&nbsp;mz_head<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMAGE_FILE_HEADER<span class="hl_char">*</span>&nbsp;pe_head<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMAGE_OPTIONAL_HEADER<span class="hl_char">*</span>&nbsp;pe_opt_head<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMAGE_SECTION_HEADER<span class="hl_char">*</span>&nbsp;sect<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HANDLE&nbsp;hFile<span class="hl_char">=</span><span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HANDLE&nbsp;hMap<span class="hl_char">=</span><span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PVOID&nbsp;hMapFile<span class="hl_char">=</span><span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;size<span class="hl_char">=</span><span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;sizehi<span class="hl_char">=</span><span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>char</b></span>&nbsp;pe<span class="hl_char">[</span><span class="hl_char">]</span>&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_quote">&quot;PE\0\0&quot;</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PVOID&nbsp;tmp<span class="hl_char">=</span><span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hFile<span class="hl_char">=</span>CreateFile<span class="hl_char">(</span>path<span class="hl_char">,</span>&nbsp;GENERIC_READ&nbsp;<span class="hl_char">|</span>&nbsp;GENERIC_WRITE<span class="hl_char">,</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FILE_SHARE_WRITE</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OPEN_EXISTING</span><span class="hl_char">,</span>&nbsp;FILE_ATTRIBUTE_NORMAL<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span><span class="hl_char">!</span>hFile<span class="hl_char">)</span>&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf<span class="hl_char">(</span><span class="hl_quote">&quot;File open failed&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hMap<span class="hl_char">=</span>CreateFileMapping<span class="hl_char">(</span>hFile<span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">,</span>PAGE_READWRITE<span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span><span class="hl_char">!</span>hMap<span class="hl_char">)</span>&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf<span class="hl_char">(</span><span class="hl_quote">&quot;Map object is not created&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle<span class="hl_char">(</span>hFile<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hMapFile<span class="hl_char">=</span>MapViewOfFile<span class="hl_char">(</span>hMap<span class="hl_char">,</span>FILE_MAP_ALL_ACCESS<span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span><span class="hl_char">!</span>hMapFile<span class="hl_char">)</span>&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf<span class="hl_char">(</span><span class="hl_quote">&quot;File Mapping not success&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle<span class="hl_char">(</span>hMap<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle<span class="hl_char">(</span>hFile<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mz_head<span class="hl_char">=</span><span class="hl_char">(</span>IMAGE_DOS_HEADER<span class="hl_char">*</span><span class="hl_char">)</span>hMapFile<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pe_head&nbsp;<span class="hl_char">=</span><span class="hl_char">(</span>IMAGE_FILE_HEADER<span class="hl_char">*</span><span class="hl_char">)</span><span class="hl_char">(</span><span class="hl_char">(</span><span class="hl_function">char</span><span class="hl_char">*</span><span class="hl_char">)</span>hMapFile&nbsp;<span class="hl_char">+</span>&nbsp;mz_head<span class="hl_char">-</span><span class="hl_char">&gt;</span>e_lfanew<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>&nbsp;strcmp<span class="hl_char">(</span>pe<span class="hl_char">,</span><span class="hl_char">(</span><span class="hl_function"><b>const</b></span>&nbsp;<span class="hl_function"><b>char</b></span>&nbsp;<span class="hl_char">*</span><span class="hl_char">)</span>pe_head<span class="hl_char">)</span>&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf</span><span class="hl_char">(</span><span class="hl_quote">&quot;It is not PE File&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UnmapViewOfFile</span><span class="hl_char">(</span>hMapFile<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle</span><span class="hl_char">(</span>hMap<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle</span><span class="hl_char">(</span>hFile<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pe_head&nbsp;<span class="hl_char">=</span><span class="hl_char">(</span>IMAGE_FILE_HEADER<span class="hl_char">*</span><span class="hl_char">)</span><span class="hl_char">(</span><span class="hl_char">(</span><span class="hl_function">char</span><span class="hl_char">*</span><span class="hl_char">)</span>hMapFile&nbsp;<span class="hl_char">+</span>&nbsp;mz_head<span class="hl_char">-</span><span class="hl_char">&gt;</span>e_lfanew<span class="hl_char">+</span><span class="hl_function">sizeof</span><span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pe_opt_head&nbsp;<span class="hl_char">=</span><span class="hl_char">(</span>&nbsp;IMAGE_OPTIONAL_HEADER<span class="hl_char">*</span><span class="hl_char">)</span><span class="hl_char">(</span><span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span>pe_head&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>IMAGE_FILE_HEADER<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;sect_num&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_comment">;	</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;ImportRVA&nbsp;<span class="hl_char">=</span>&nbsp;pe_opt_head<span class="hl_char">-</span><span class="hl_char">&gt;</span>DataDirectory<span class="hl_char">[</span>IMAGE_DIRECTORY_ENTRY_IMPORT<span class="hl_char">]</span><span class="hl_char">.</span>VirtualAddres&nbsp;s<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sect&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">(</span>IMAGE_SECTION_HEADER<span class="hl_char">*</span><span class="hl_char">)</span><span class="hl_char">(</span><span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span>pe_opt_head&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>IMAGE_OPTIONAL_HEADER<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;<span class="hl_char">(</span>&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;i<span class="hl_char">=</span><span class="hl_number">0</span><span class="hl_comment">; i&lt;pe_head-&gt;NumberOfSections; i++)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>&nbsp;ImportRVA&nbsp;<span class="hl_char">&lt;</span>&nbsp;sect<span class="hl_char">-</span><span class="hl_char">&gt;</span>VirtualAddress&nbsp;<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sect<span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sect_num<span class="hl_char">=</span>i<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>break</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sect<span class="hl_char">+</span><span class="hl_char">+</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>sect_num&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf<span class="hl_char">(</span><span class="hl_quote">&quot;Import Data not presented&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UnmapViewOfFile<span class="hl_char">(</span>hMapFile<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle<span class="hl_char">(</span>hMap<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle<span class="hl_char">(</span>hFile<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;sect<span class="hl_char">+</span><span class="hl_char">+</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;AfterImportSecBeg&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span>hMapFile&nbsp;<span class="hl_char">+</span>&nbsp;sect<span class="hl_char">-</span><span class="hl_char">&gt;</span>PointerToRawData<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;sect<span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf<span class="hl_char">(</span><span class="hl_quote">&quot;Import table:&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;LPVOID&nbsp;ImportSecBeg<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;ImportSecBeg&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">(</span>LPVOID<span class="hl_char">)</span><span class="hl_char">(</span><span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span>hMapFile&nbsp;<span class="hl_char">+</span>&nbsp;sect<span class="hl_char">-</span><span class="hl_char">&gt;</span>PointerToRawData<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;LPVOID&nbsp;ImportTable<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;ImportTable&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">(</span>LPVOID<span class="hl_char">)</span><span class="hl_char">(</span>ImportRVA&nbsp;<span class="hl_char">-</span>&nbsp;sect<span class="hl_char">-</span><span class="hl_char">&gt;</span>VirtualAddress<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;ImportTable&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">(</span>LPVOID<span class="hl_char">)</span><span class="hl_char">(</span><span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span>ImportSecBeg<span class="hl_char">+</span>&nbsp;<span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span>ImportTable<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;IMAGE_IMPORT_DESCRIPTOR&nbsp;<span class="hl_char">*</span>DLLInfo&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">(</span>IMAGE_IMPORT_DESCRIPTOR&nbsp;<span class="hl_char">*</span><span class="hl_char">)</span>ImportTable<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;PCHAR&nbsp;DLLName<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;DLLCounter&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf<span class="hl_char">(</span><span class="hl_quote">&quot;Import Table Entries:\n&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>while</b></span>&nbsp;<span class="hl_char">(</span>DLLInfo<span class="hl_char">-</span><span class="hl_char">&gt;</span>Name&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DLLCounter<span class="hl_char">+</span><span class="hl_char">+</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DLLName&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">(</span>PCHAR<span class="hl_char">)</span><span class="hl_char">(</span><span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span>DLLInfo<span class="hl_char">-</span><span class="hl_char">&gt;</span>Name&nbsp;<span class="hl_char">-</span>&nbsp;sect<span class="hl_char">-</span><span class="hl_char">&gt;</span>VirtualAddress<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DLLName&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">(</span>PCHAR<span class="hl_char">)</span><span class="hl_char">(</span><span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span>ImportSecBeg&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span>DLLName<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf<span class="hl_char">(</span><span class="hl_quote">&quot;%d:-&gt;%s\n&quot;</span><span class="hl_char">,</span>DLLCounter<span class="hl_char">,</span>DLLName<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DLLInfo<span class="hl_char">+</span><span class="hl_char">+</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>Counting&nbsp;needed&nbsp;size&nbsp;<span class="hl_function"><b>in</b></span>&nbsp;bytes&nbsp;for&nbsp;<span class="hl_function"><b>new</b></span>&nbsp;<span class="hl_function"><b>import</b></span>&nbsp;table</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;NewImportTableSize&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>IMAGE_IMPORT_DESCRIPTOR<span class="hl_char">)</span><span class="hl_char">*</span><span class="hl_char">(</span>DLLCounter<span class="hl_char">+</span><span class="hl_number">2</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>Получаем&nbsp;файловый&nbsp;указатель&nbsp;на&nbsp;конец&nbsp;секции&nbsp;импорта</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;LPBYTE&nbsp;pos<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;pos&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">(</span>LPBYTE<span class="hl_char">)</span>AfterImportSecBeg<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;maxFree&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;prevPtr<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;LPBYTE&nbsp;FreePtr&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>Ищем&nbsp;свободное&nbsp;место&nbsp;в&nbsp;секции<span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>while</b></span>&nbsp;<span class="hl_char">(</span>&nbsp;pos&nbsp;<span class="hl_char">&gt;</span><span class="hl_char">=</span>&nbsp;ImportSecBeg&nbsp;<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>&nbsp;<span class="hl_char">*</span><span class="hl_char">(</span><span class="hl_function"><b>BYTE</b></span>&nbsp;<span class="hl_char">*</span><span class="hl_char">)</span>pos&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;0x00&nbsp;&nbsp;<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prevPtr&nbsp;<span class="hl_char">=</span><span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span>&nbsp;pos<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>while</b></span>&nbsp;<span class="hl_char">(</span><span class="hl_char">*</span><span class="hl_char">(</span><span class="hl_function"><b>BYTE</b></span>&nbsp;<span class="hl_char">*</span><span class="hl_char">)</span>pos&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;0x00<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pos&nbsp;<span class="hl_char">-</span><span class="hl_char">=</span>&nbsp;<span class="hl_number">4</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>&nbsp;<span class="hl_char">(</span><span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span>prevPtr&nbsp;<span class="hl_char">-</span>&nbsp;<span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span>pos<span class="hl_char">)</span>&nbsp;<span class="hl_char">&gt;</span>&nbsp;maxFree&nbsp;<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maxFree&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">(</span><span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span>prevPtr&nbsp;<span class="hl_char">-</span>&nbsp;<span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span>pos<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FreePtr&nbsp;<span class="hl_char">=</span>&nbsp;pos&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">4</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pos&nbsp;<span class="hl_char">-</span><span class="hl_char">=</span>&nbsp;<span class="hl_number">4</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>Модифицируем&nbsp;полученный&nbsp;указатель&nbsp;на&nbsp;свободный&nbsp;блок<span class="hl_char">,</span>&nbsp;т<span class="hl_char">.</span>к<span class="hl_char">.</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>он&nbsp;может&nbsp;указывать&nbsp;на&nbsp;завершающий&nbsp;нулевой&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;какой<span class="hl_char">-</span>либо&nbsp;структуры</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;FreePtr&nbsp;<span class="hl_char">+</span><span class="hl_char">=</span><span class="hl_number">4</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;maxFree&nbsp;<span class="hl_char">-</span><span class="hl_char">=</span><span class="hl_number">4</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf<span class="hl_char">(</span><span class="hl_quote">&quot;Free Size Ptr:-&gt;%x\n&quot;</span><span class="hl_char">,</span>FreePtr<span class="hl_char">-</span><span class="hl_char">(</span>LPBYTE<span class="hl_char">)</span>hMapFile<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf<span class="hl_char">(</span><span class="hl_quote">&quot;Free Size:-&gt;%d\n&quot;</span><span class="hl_char">,</span>maxFree<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf<span class="hl_char">(</span><span class="hl_quote">&quot;Analizing free size...\n&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>Проверяем&nbsp;объем&nbsp;свободного&nbsp;места</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>&nbsp;maxFree&nbsp;<span class="hl_char">&lt;</span>&nbsp;NewImportTableSize&nbsp;<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf<span class="hl_char">(</span><span class="hl_quote">&quot;Don't have enough free size\n&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UnmapViewOfFile<span class="hl_char">(</span>hMapFile<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle<span class="hl_char">(</span>hMap<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle<span class="hl_char">(</span>hFile<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">else</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf<span class="hl_char">(</span><span class="hl_quote">&quot;Free size presented\n&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_number">1</span><span class="hl_char">.</span>&nbsp;Копируем&nbsp;старую&nbsp;таблицу&nbsp;импорта&nbsp;в&nbsp;новое&nbsp;место</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;memcpy<span class="hl_char">(</span>FreePtr<span class="hl_char">,</span>&nbsp;ImportTable<span class="hl_char">,</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>IMAGE_IMPORT_DESCRIPTOR<span class="hl_char">)</span><span class="hl_char">*</span>DLLCounter<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_number">2</span><span class="hl_char">.</span><span class="hl_number">1</span>&nbsp;Сохраняем&nbsp;строку&nbsp;с&nbsp;именем&nbsp;нашей&nbsp;DLL&nbsp;в&nbsp;старой&nbsp;таблице&nbsp;импорта</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">(</span>для&nbsp;экономии&nbsp;места<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;memcpy<span class="hl_char">(</span>ImportTable<span class="hl_char">,</span>&nbsp;OUR_DLL_NAME<span class="hl_char">,</span>&nbsp;lstrlenA<span class="hl_char">(</span>OUR_DLL_NAME<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;<span class="hl_function">BYTE</span><span class="hl_char">*</span>&nbsp;zeroPtr<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;zeroPtr&nbsp;<span class="hl_char">=</span><span class="hl_char">(</span><span class="hl_function">BYTE</span><span class="hl_char">*</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">(</span><span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span>ImportTable&nbsp;<span class="hl_char">+</span>&nbsp;lstrlenA<span class="hl_char">(</span>OUR_DLL_NAME<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_number">2</span><span class="hl_char">.</span><span class="hl_number">2</span>&nbsp;Сохраняем&nbsp;структуру&nbsp;IMAGE_IMPORT_BY_NAME&nbsp;в&nbsp;старой&nbsp;таблице&nbsp;импорта<span class="hl_char">.</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">(</span>так&nbsp;же&nbsp;для&nbsp;экономии&nbsp;места<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;IMAGE_IMPORT_BY_NAME&nbsp;myName<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;myName<span class="hl_char">.</span>Hint&nbsp;<span class="hl_char">=</span>&nbsp;0x00<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;myName<span class="hl_char">.</span>Name<span class="hl_char">[</span><span class="hl_number">0</span><span class="hl_char">]</span>&nbsp;<span class="hl_char">=</span>&nbsp;0x00<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>WORD</b></span>&nbsp;Hint&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;<span class="hl_function">char</span><span class="hl_char">*</span>&nbsp;myFuncName&nbsp;<span class="hl_char">=</span>&nbsp;OUR_FUNC_NAME<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;hackRec&nbsp;patch<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;patch<span class="hl_char">.</span>ZeroDword&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;patch<span class="hl_char">.</span>IAT&nbsp;<span class="hl_char">=</span>&nbsp;ImportRVA&nbsp;<span class="hl_char">+</span>&nbsp;lstrlenA<span class="hl_char">(</span>OUR_DLL_NAME<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>hackRec<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;patch<span class="hl_char">.</span>IATEnd&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;IIBN_Table<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;memcpy<span class="hl_char">(</span>zeroPtr<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>patch<span class="hl_char">,</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>patch<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;zeroPtr&nbsp;<span class="hl_char">+</span><span class="hl_char">=</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>patch<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;memcpy<span class="hl_char">(</span>zeroPtr<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>Hint<span class="hl_char">,</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span><span class="hl_function">WORD</span><span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;zeroPtr&nbsp;<span class="hl_char">+</span><span class="hl_char">=</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span><span class="hl_function">WORD</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;memcpy<span class="hl_char">(</span>zeroPtr<span class="hl_char">,</span>&nbsp;myFuncName<span class="hl_char">,</span>&nbsp;lstrlenA<span class="hl_char">(</span>myFuncName<span class="hl_char">)</span><span class="hl_char">+</span><span class="hl_number">1</span>&nbsp;<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;zeroPtr&nbsp;<span class="hl_char">+</span><span class="hl_char">=</span>&nbsp;lstrlenA<span class="hl_char">(</span>myFuncName<span class="hl_char">)</span><span class="hl_char">+</span><span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;memcpy<span class="hl_char">(</span>zeroPtr<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>myName<span class="hl_char">,</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>IMAGE_IMPORT_BY_NAME<span class="hl_char">)</span>&nbsp;<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_number">2</span><span class="hl_char">.</span><span class="hl_number">3</span><span class="hl_char">.</span>&nbsp;Заполняем&nbsp;структуру&nbsp;IMAGE_IMPORT_BY_NAME&nbsp;данными&nbsp;о&nbsp;нашей&nbsp;DLL</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;IMAGE_IMPORT_DESCRIPTOR&nbsp;myDLL<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>Вычисляем&nbsp;указатель&nbsp;на&nbsp;нашу&nbsp;структуру&nbsp;IMAGE_IMPORT_BY_NAME<span class="hl_char">:</span>&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>это&nbsp;адрес&nbsp;начала&nbsp;старой&nbsp;таблицы&nbsp;импорта&nbsp;<span class="hl_char">+</span>&nbsp;длинна&nbsp;строки&nbsp;с&nbsp;именем&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>нашей&nbsp;DLL&nbsp;<span class="hl_char">+</span>&nbsp;нулевой&nbsp;<span class="hl_function">DWORD</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;IIBN_Table&nbsp;<span class="hl_char">=</span>&nbsp;ImportRVA&nbsp;<span class="hl_char">+</span>&nbsp;lstrlenA<span class="hl_char">(</span>&nbsp;OUR_DLL_NAME&nbsp;<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>Указатель&nbsp;на&nbsp;таблицу&nbsp;Characteristics</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;myDLL<span class="hl_char">.</span>Characteristics&nbsp;<span class="hl_char">=</span>&nbsp;IIBN_Table<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;myDLL<span class="hl_char">.</span>TimeDateStamp&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;myDLL<span class="hl_char">.</span>ForwarderChain&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function"><b>NULL</b></span><span class="hl_comment">;                                   </span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>Записываем&nbsp;адрес&nbsp;строки&nbsp;с&nbsp;именем&nbsp;файла&nbsp;нашей&nbsp;DLL</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;myDLL<span class="hl_char">.</span>Name&nbsp;<span class="hl_char">=</span>&nbsp;ImportRVA<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>Указатель&nbsp;на&nbsp;таблицу&nbsp;FirstThunk</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;myDLL<span class="hl_char">.</span>FirstThunk&nbsp;<span class="hl_char">=</span>&nbsp;IIBN_Table<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>Записываем&nbsp;в&nbsp;новую&nbsp;таблицу&nbsp;импорта&nbsp;запись&nbsp;о&nbsp;нашей&nbsp;DLL</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;LPBYTE&nbsp;OldFreePtr&nbsp;<span class="hl_char">=</span>&nbsp;FreePtr<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;FreePtr&nbsp;<span class="hl_char">+</span><span class="hl_char">=</span><span class="hl_function">sizeof</span><span class="hl_char">(</span>IMAGE_IMPORT_DESCRIPTOR<span class="hl_char">)</span><span class="hl_char">*</span>DLLCounter<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;memcpy<span class="hl_char">(</span>FreePtr<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>myDLL<span class="hl_char">,</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>IMAGE_IMPORT_DESCRIPTOR<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>Создаем&nbsp;<span class="hl_quote">&quot;финальную&quot;</span>&nbsp;нулевую&nbsp;запись&nbsp;со&nbsp;всеми&nbsp;полями&nbsp;равными&nbsp;нулю</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;myDLL<span class="hl_char">.</span>Characteristics&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;myDLL<span class="hl_char">.</span>TimeDateStamp&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;myDLL<span class="hl_char">.</span>ForwarderChain&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;myDLL<span class="hl_char">.</span>Name&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;myDLL<span class="hl_char">.</span>FirstThunk&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>И&nbsp;записываем&nbsp;её&nbsp;в&nbsp;конец&nbsp;новой&nbsp;таблицы&nbsp;импорта<span class="hl_char">.</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;FreePtr&nbsp;<span class="hl_char">+</span><span class="hl_char">=</span><span class="hl_function">sizeof</span><span class="hl_char">(</span>IMAGE_IMPORT_DESCRIPTOR<span class="hl_char">)</span><span class="hl_char">*</span>DLLCounter<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;memcpy<span class="hl_char">(</span>FreePtr<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>myDLL<span class="hl_char">,</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>IMAGE_IMPORT_DESCRIPTOR<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_number">3</span><span class="hl_char">.</span>&nbsp;Устанавливаем&nbsp;указатель&nbsp;на&nbsp;нашу&nbsp;таблицу&nbsp;импорта<span class="hl_char">.</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;Вычисляем&nbsp;RVA&nbsp;нашей&nbsp;таблицы</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;NewImportTableRVA&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span>OldFreePtr&nbsp;<span class="hl_char">-</span>&nbsp;<span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span>ImportSecBeg&nbsp;<span class="hl_char">+</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sect</span><span class="hl_char">-</span><span class="hl_char">&gt;</span>VirtualAddress<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;Заносим&nbsp;его&nbsp;в&nbsp;DataDirectory</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;pe_opt_head<span class="hl_char">-</span><span class="hl_char">&gt;</span>DataDirectory<span class="hl_char">[</span>IMAGE_DIRECTORY_ENTRY_IMPORT<span class="hl_char">]</span><span class="hl_char">.</span>VirtualAddres&nbsp;s&nbsp;<span class="hl_char">=</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NewImportTableRVA</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;pe_opt_head<span class="hl_char">-</span><span class="hl_char">&gt;</span>DataDirectory<span class="hl_char">[</span>IMAGE_DIRECTORY_ENTRY_IMPORT<span class="hl_char">]</span><span class="hl_char">.</span>Size&nbsp;<span class="hl_char">=</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">(</span>DLLCounter&nbsp;<span class="hl_char">+</span><span class="hl_number">1</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">*</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>IMAGE_IMPORT_DESCRIPTOR<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>Additional&nbsp;changes&nbsp;<span class="hl_number">28</span><span class="hl_char">.</span><span class="hl_number">11</span><span class="hl_char">.</span><span class="hl_number">2002</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;pe_opt_head<span class="hl_char">-</span><span class="hl_char">&gt;</span>DataDirectory<span class="hl_char">[</span>IMAGE_DIRECTORY_ENTRY_BOUND_IMPORT<span class="hl_char">]</span><span class="hl_char">.</span>Virtual&nbsp;Address&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;pe_opt_head<span class="hl_char">-</span><span class="hl_char">&gt;</span>DataDirectory<span class="hl_char">[</span>IMAGE_DIRECTORY_ENTRY_BOUND_IMPORT<span class="hl_char">]</span><span class="hl_char">.</span>Size&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;pe_opt_head<span class="hl_char">-</span><span class="hl_char">&gt;</span>DataDirectory<span class="hl_char">[</span>IMAGE_DIRECTORY_ENTRY_IAT<span class="hl_char">]</span><span class="hl_char">.</span>VirtualAddress&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;pe_opt_head<span class="hl_char">-</span><span class="hl_char">&gt;</span>DataDirectory<span class="hl_char">[</span>IMAGE_DIRECTORY_ENTRY_IAT<span class="hl_char">]</span><span class="hl_char">.</span>Size&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf<span class="hl_char">(</span><span class="hl_quote">&quot;with God help it must be working...\n&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getch<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UnmapViewOfFile<span class="hl_char">(</span>hMapFile<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle<span class="hl_char">(</span>hMap<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle<span class="hl_char">(</span>hFile<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l0">}</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;</li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=258797&amp;user=6939&amp;forum_n=6&amp;topic=15780&amp;page=1&amp;anchor=12" class="addthx" data-post="258797"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]punxer[/b]','')">punxer</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 30.0 (посетитель), 4thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.76'>Активность: 0.03<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=6939">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 мая 2010 14:45 <br><script type="text/javascript">QU('punxer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=punxer" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15780&amp;page=1#13');return false;">#13</a> </span><div align=left><br><div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">bool&nbsp;path_exist<span class="hl_char">(</span>PCHAR&nbsp;path<span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_function">ret</span><span class="hl_char">=</span><span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">ret</span><span class="hl_char">=</span>GetFileAttributesA<span class="hl_char">(</span>path<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span><span class="hl_function">ret</span><span class="hl_char">=</span><span class="hl_char">=</span>INVALID_FILE_ATTRIBUTES<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_function"><b>false</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_function"><b>true</b></span><span class="hl_comment">;</span></li><li class="hl_l0">}</li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=258798&amp;user=6939&amp;forum_n=6&amp;topic=15780&amp;page=1&amp;anchor=13" class="addthx" data-post="258798"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]punxer[/b]','')">punxer</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 30.0 (посетитель), 4thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.76'>Активность: 0.03<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=6939">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 мая 2010 14:54 <br><script type="text/javascript">QU('punxer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=punxer" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15780&amp;page=1#14');return false;">#14</a> </span><div align=left><br>
Простенькое обратимое шифрование ксором с ключом<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>void</b></span>&nbsp;decode_mem<span class="hl_char">(</span>PCHAR&nbsp;mem<span class="hl_char">,</span><span class="hl_function"><b>int</b></span>&nbsp;size<span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;i<span class="hl_char">=</span><span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">*</span><span class="hl_char">(</span><span class="hl_function"><b>BYTE</b></span>&nbsp;<span class="hl_char">*</span><span class="hl_char">)</span><span class="hl_char">(</span>i<span class="hl_char">+</span><span class="hl_char">+</span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span>mem<span class="hl_char">)</span>&nbsp;^<span class="hl_char">=</span>&nbsp;calc_xor_arg<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>while</b></span>&nbsp;<span class="hl_char">(</span>&nbsp;i&nbsp;<span class="hl_char">&lt;</span>&nbsp;size&nbsp;<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">}</li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_function"><b>DWORD</b></span>&nbsp;calc_xor_arg<span class="hl_char">(</span><span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;xor_arg<span class="hl_char">=</span><span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xor_arg&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">214013</span>&nbsp;<span class="hl_char">*</span>&nbsp;key&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">2531011</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;key&nbsp;<span class="hl_char">=</span>&nbsp;xor_arg<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;xor_arg&nbsp;<span class="hl_char">&gt;</span><span class="hl_char">&gt;</span>&nbsp;<span class="hl_number">24</span><span class="hl_comment">;</span></li><li class="hl_l0">}</li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=258799&amp;user=6939&amp;forum_n=6&amp;topic=15780&amp;page=1&amp;anchor=14" class="addthx" data-post="258799"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]punxer[/b]','')">punxer</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 30.0 (посетитель), 4thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.76'>Активность: 0.03<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=6939">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 мая 2010 14:59 &middot; Поправил: punxer <br><script type="text/javascript">QU('punxer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=punxer" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15780&amp;page=1#15');return false;">#15</a> </span><div align=left><br>
Оборачиваем чужой сокет в SSL<br>Код выдернут из проекта так что много лишнего но суть ясна<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>int</b></span>&nbsp;WINAPI&nbsp;MyConnect<span class="hl_char">(</span><span class="hl_function"><b>IN</b></span>&nbsp;SOCKET&nbsp;s<span class="hl_char">,</span><span class="hl_function"><b>IN</b></span>&nbsp;sockaddr<span class="hl_char">*</span>&nbsp;name<span class="hl_char">,</span><span class="hl_function"><b>IN</b></span>&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;namelen<span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>char</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buff<span class="hl_char">[</span><span class="hl_number">255</span><span class="hl_char">]</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">ret</span><span class="hl_char">=</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>NULL</b></span><span class="hl_comment">;		</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wr_ret<span class="hl_char">=</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read_ret<span class="hl_char">=</span>&nbsp;&nbsp;<span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;len<span class="hl_char">=</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;au_packet&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmpp<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;au_packet&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pack<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bool&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;optval<span class="hl_char">=</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>true</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>OutputDebugString<span class="hl_char">(</span><span class="hl_quote">&quot;MyConnect called with data:&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>sprintf<span class="hl_char">(</span>tmp<span class="hl_char">,</span><span class="hl_quote">&quot;SOCKET=%d name-&gt;sa_family=%d&quot;</span><span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span>s<span class="hl_char">,</span>name<span class="hl_char">-</span><span class="hl_char">&gt;</span>sa_family<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>OutputDebugString<span class="hl_char">(</span>tmp<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>setsockopt<span class="hl_char">(</span>s<span class="hl_char">,</span>&nbsp;SOL_SOCKET<span class="hl_char">,</span>&nbsp;SO_KEEPALIVE<span class="hl_char">,</span>&nbsp;<span class="hl_char">(</span><span class="hl_function"><b>char</b></span>&nbsp;<span class="hl_char">*</span><span class="hl_char">)</span><span class="hl_char">&amp;</span>optval<span class="hl_char">,</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>optval<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_char">=</span><span class="hl_char">=</span><span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>OutputDebugString<span class="hl_char">(</span><span class="hl_quote">&quot;Cant change to SO_KEEPALIVE&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span>SSL<span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SSL_library_init<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_comment">;  </span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">ret</span><span class="hl_char">=</span>pConnect<span class="hl_char">(</span>s<span class="hl_char">,</span>name<span class="hl_char">,</span>namelen<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;meth<span class="hl_char">=</span>SSLv23_client_method<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx&nbsp;<span class="hl_char">=</span>SSL_CTX_new<span class="hl_char">(</span>meth<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ssl<span class="hl_char">=</span>SSL_new<span class="hl_char">(</span>ctx<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SSL_set_fd<span class="hl_char">(</span>ssl<span class="hl_char">,</span>&nbsp;<span class="hl_char">(</span><span class="hl_function">int</span><span class="hl_char">)</span>s<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>SSL_connect<span class="hl_char">(</span>ssl<span class="hl_char">)</span><span class="hl_char">&lt;</span><span class="hl_char">=</span><span class="hl_number">0</span><span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;err_exit<span class="hl_char">(</span><span class="hl_quote">&quot;SSL connect error&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>OutputDebugString<span class="hl_char">(</span><span class="hl_quote">&quot;SSL_connect succesfull&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;<span class="hl_char">(</span><span class="hl_function"><b>int</b></span>&nbsp;i<span class="hl_char">=</span><span class="hl_number">0</span><span class="hl_comment">;i&lt;=2;i++)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read_ret<span class="hl_char">=</span>SSL_read<span class="hl_char">(</span>ssl<span class="hl_char">,</span><span class="hl_char">&amp;</span>tmpp<span class="hl_char">,</span><span class="hl_function">sizeof</span><span class="hl_char">(</span>tmpp<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;<span class="hl_char">(</span>SSL_get_error<span class="hl_char">(</span>ssl<span class="hl_char">,</span>read_ret<span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;&nbsp;SSL_ERROR_NONE</span><span class="hl_char">:</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>break</b></span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default</span><span class="hl_char">:</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;err_exit</span><span class="hl_char">(</span><span class="hl_quote">&quot;Cant SSL_read&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<span class="hl_comment">;</span></li><li class="hl_l1">return&nbsp;<span class="hl_function"><b>ret</b></span><span class="hl_comment">;</span></li><li class="hl_l0">}</li><li class="hl_l1"><span class="hl_function"><b>int</b></span>&nbsp;WINAPI&nbsp;MySend<span class="hl_char">(</span><span class="hl_function"><b>IN</b></span>&nbsp;SOCKET&nbsp;s<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>IN</b></span>&nbsp;<span class="hl_function"><b>const</b></span>&nbsp;<span class="hl_function">char</span><span class="hl_char">*</span>&nbsp;buf<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>IN</b></span>&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;len<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>IN</b></span>&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;flags<span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;wr_ret<span class="hl_char">=</span>SSL_write<span class="hl_char">(</span>ssl<span class="hl_char">,</span>buf<span class="hl_char">,</span><span class="hl_function">sizeof</span><span class="hl_char">(</span>ss_packet<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;<span class="hl_char">(</span>SSL_get_error<span class="hl_char">(</span>ssl<span class="hl_char">,</span>wr_ret<span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;&nbsp;SSL_ERROR_NONE</span><span class="hl_char">:</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>break</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default<span class="hl_char">:</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;err_exit</span><span class="hl_char">(</span><span class="hl_quote">&quot;Cant SSL_write&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<span class="hl_comment">;</span></li><li class="hl_l0">return&nbsp;wr_ret<span class="hl_comment">;</span></li><li class="hl_l1">}</li><li class="hl_l0"><span class="hl_function"><b>int</b></span>&nbsp;WINAPI&nbsp;MyRecv<span class="hl_char">(</span><span class="hl_function"><b>IN</b></span>&nbsp;SOCKET&nbsp;s<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>OUT</b></span>&nbsp;<span class="hl_function">char</span><span class="hl_char">*</span>&nbsp;buf<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>IN</b></span>&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;len<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>IN</b></span>&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;flags<span class="hl_char">)</span></li><li class="hl_l1">{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read_ret<span class="hl_char">=</span>&nbsp;&nbsp;<span class="hl_function"><b>NULL</b></span><span class="hl_comment">;;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read_ret<span class="hl_char">=</span>SSL_read<span class="hl_char">(</span>ssl<span class="hl_char">,</span>buf<span class="hl_char">,</span>len<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;<span class="hl_char">(</span>SSL_get_error<span class="hl_char">(</span>ssl<span class="hl_char">,</span>read_ret<span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;&nbsp;SSL_ERROR_NONE<span class="hl_char">:</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>break</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default<span class="hl_char">:</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;err_exit<span class="hl_char">(</span><span class="hl_quote">&quot;Cant SSL_read&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<span class="hl_comment">;</span></li><li class="hl_l1">return&nbsp;read_ret<span class="hl_comment">;</span></li><li class="hl_l0">}</li><li class="hl_l1">&nbsp;</li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=258800&amp;user=6939&amp;forum_n=6&amp;topic=15780&amp;page=1&amp;anchor=15" class="addthx" data-post="258800"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]HiEndsoft[/b]','')">HiEndsoft</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 237.0 (наставник), 20thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.74'>Активность: 0.13<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=13651">Участник</a><br><font color=blue>sysenter</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 мая 2010 05:42 &middot; Поправил: HiEndsoft <br><script type="text/javascript">QU('HiEndsoft','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=HiEndsoft" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15780&amp;page=1#16');return false;">#16</a> </span><div align=left><br>
<b>punxer</b><br>прям прорвало тебя<br>Вот старье от меня, прямо перед сисколом помена в ntdll на свой обработчик<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span></li><li class="hl_l1"><span class="hl_char">/</span><span class="hl_char">/</span>Сплайс&nbsp;функ&nbsp;NTDLL<span class="hl_char">.</span>DLL<span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span></li><li class="hl_l0"><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span></li><li class="hl_l1"><span class="hl_char">/</span><span class="hl_char">/</span>pNFUNC&nbsp;<span class="hl_char">-</span>&nbsp;<span class="hl_function">NEW</span><span class="hl_char">-</span>функция<span class="hl_char">-</span>обработчик</li><li class="hl_l0"><span class="hl_char">/</span><span class="hl_char">/</span>FunName&nbsp;<span class="hl_char">-</span>&nbsp;имя&nbsp;функции&nbsp;ntdll<span class="hl_char">.</span>dll</li><li class="hl_l1"><span class="hl_char">/</span><span class="hl_char">/</span>Ordinal&nbsp;<span class="hl_char">-</span>&nbsp;ординал&nbsp;функции&nbsp;ntdll<span class="hl_char">.</span>dll</li><li class="hl_l0"><span class="hl_char">/</span><span class="hl_char">/</span>Возвращает&nbsp;указатель&nbsp;на&nbsp;<span class="hl_function">TRUE</span><span class="hl_char">-</span>функцию</li><li class="hl_l1"><span class="hl_char">/</span><span class="hl_char">/</span>Когда<span class="hl_char">-</span>то&nbsp;не&nbsp;палился&nbsp;этот&nbsp;метод</li><li class="hl_l0"><span class="hl_char">/</span><span class="hl_char">/</span>GetProcAdrLibFunc&nbsp;<span class="hl_char">-</span>&nbsp;думаю&nbsp;понятно&nbsp;что&nbsp;делает</li><li class="hl_l1">LPVOID&nbsp;NTSPLIS<span class="hl_char">(</span>LPVOID&nbsp;pNFUNC<span class="hl_char">,</span>OPTIONAL&nbsp;PCSZ&nbsp;FunName<span class="hl_char">,</span>OPTIONAL&nbsp;<span class="hl_function"><b>WORD</b></span>&nbsp;Ordinal<span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1"><span class="hl_function"><b>DWORD</b></span>&nbsp;aFunc<span class="hl_char">=</span><span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_function">if</span><span class="hl_char">(</span>GetProcAdrLibFunc<span class="hl_char">(</span><span class="hl_char">(</span>PVOID<span class="hl_char">*</span><span class="hl_char">)</span><span class="hl_char">&amp;</span>aFunc<span class="hl_char">,</span>NtDll<span class="hl_char">,</span>FunName<span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SIZE_T&nbsp;RegionSize<span class="hl_char">=</span><span class="hl_number">15</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LPVOID&nbsp;pBridg<span class="hl_char">=</span><span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>NT_SUCCESS<span class="hl_char">(</span>NtAllocateVirtualMemory<span class="hl_char">(</span>INVALID_HANDLE_VALUE<span class="hl_char">,</span><span class="hl_char">&amp;</span>pBridg<span class="hl_char">,</span><span class="hl_number">0</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">,</span><span class="hl_char">&amp;</span>RegionSize<span class="hl_char">,</span>MEM_COMMIT<span class="hl_char">,</span>PAGE_EXECUTE_READWRITE<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>DWORD</b></span>&nbsp;P<span class="hl_char">=</span><span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>DWORD</b></span>&nbsp;tFunc<span class="hl_char">=</span>aFunc<span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function">if</span><span class="hl_char">(</span>NT_SUCCESS<span class="hl_char">(</span>NtProtectVirtualMemory<span class="hl_char">(</span>INVALID_HANDLE_VALUE<span class="hl_char">,</span><span class="hl_char">(</span>PVOID<span class="hl_char">*</span><span class="hl_char">)</span><span class="hl_char">&amp;</span>&nbsp;&nbsp;&nbsp;&nbsp;tFunc<span class="hl_char">,</span><span class="hl_char">&amp;</span>RegionSize<span class="hl_char">,</span>PAGE_EXECUTE_READWRITE<span class="hl_char">,</span><span class="hl_char">&amp;</span>P<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memcpy</span><span class="hl_char">(</span>pBridg<span class="hl_char">,</span><span class="hl_char">(</span>LPVOID<span class="hl_char">)</span>aFunc<span class="hl_char">,</span>RegionSize<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_asm</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">ebx</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span>aFunc</li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>pNFUNC</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">ebx</span><span class="hl_char">+</span><span class="hl_number">6</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_registr">eax</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_function"><b>JMP</b></span>&nbsp;<span class="hl_registr">EDX</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function">mov</span><span class="hl_char">[</span><span class="hl_registr">ebx</span><span class="hl_char">+</span><span class="hl_number">11</span><span class="hl_char">]</span><span class="hl_char">,</span>0x000000E2</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_registr">ebx</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tFunc</span><span class="hl_char">=</span>aFunc<span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NtProtectVirtualMemory</span><span class="hl_char">(</span>INVALID_HANDLE_VALUE<span class="hl_char">,</span><span class="hl_char">(</span>PVOID<span class="hl_char">*</span><span class="hl_char">)</span><span class="hl_char">&amp;</span>tFunc<span class="hl_char">,</span><span class="hl_char">&amp;</span>Region&nbsp;&nbsp;&nbsp;&nbsp;Size<span class="hl_char">,</span>P<span class="hl_char">,</span><span class="hl_char">&amp;</span>P<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;pBridg</span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">}</li><li class="hl_l0">return&nbsp;<span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l1">}</li><li class="hl_l0"><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">/</span></li>        </ol>
    </div>
</div></div><br><br><font size="1"><i>-----<br>продавец резиновых утёнков</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=258825&amp;user=13651&amp;forum_n=6&amp;topic=15780&amp;page=1&amp;anchor=16" class="addthx" data-post="258825"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]punxer[/b]','')">punxer</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 30.0 (посетитель), 4thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.76'>Активность: 0.03<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=6939">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 мая 2010 14:56 <br><script type="text/javascript">QU('punxer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=punxer" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15780&amp;page=1#17');return false;">#17</a> </span><div align=left><br>
немного макросов и их применения<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">#define&nbsp;min<span class="hl_char">(</span>a<span class="hl_char">,</span>&nbsp;b<span class="hl_char">)</span>&nbsp;&nbsp;<span class="hl_char">(</span><span class="hl_char">(</span><span class="hl_char">(</span>a<span class="hl_char">)</span>&nbsp;<span class="hl_char">&lt;</span>&nbsp;<span class="hl_char">(</span>b<span class="hl_char">)</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">?</span>&nbsp;<span class="hl_char">(</span>a<span class="hl_char">)</span>&nbsp;<span class="hl_char">:</span>&nbsp;<span class="hl_char">(</span>b<span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l1">#define&nbsp;max<span class="hl_char">(</span>a<span class="hl_char">,</span>&nbsp;b<span class="hl_char">)</span>&nbsp;&nbsp;<span class="hl_char">(</span><span class="hl_char">(</span><span class="hl_char">(</span>a<span class="hl_char">)</span>&nbsp;<span class="hl_char">&gt;</span>&nbsp;<span class="hl_char">(</span>b<span class="hl_char">)</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">?</span>&nbsp;<span class="hl_char">(</span>a<span class="hl_char">)</span>&nbsp;<span class="hl_char">:</span>&nbsp;<span class="hl_char">(</span>b<span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l0">#define&nbsp;MakePtr<span class="hl_char">(</span>cast<span class="hl_char">,</span>&nbsp;<span class="hl_function">ptr</span><span class="hl_char">,</span>&nbsp;addValue&nbsp;<span class="hl_char">)</span>&nbsp;<span class="hl_char">(</span>cast<span class="hl_char">)</span><span class="hl_char">(</span>&nbsp;<span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span><span class="hl_char">(</span><span class="hl_function">ptr</span><span class="hl_char">)</span><span class="hl_char">+</span><span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span><span class="hl_char">(</span>addValue<span class="hl_char">)</span><span class="hl_char">)</span></li>        </ol>
    </div>
</div></div>
<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">__forceinline&nbsp;bool&nbsp;InRect<span class="hl_char">(</span>RECT&nbsp;rc<span class="hl_char">,</span>POINT&nbsp;pt<span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>min<span class="hl_char">(</span>rc<span class="hl_char">.</span>left<span class="hl_char">,</span>pt<span class="hl_char">.</span>x<span class="hl_char">)</span><span class="hl_char">=</span><span class="hl_char">=</span>rc<span class="hl_char">.</span>left&nbsp;<span class="hl_char">&amp;</span><span class="hl_char">&amp;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;min<span class="hl_char">(</span>rc<span class="hl_char">.</span>right<span class="hl_char">,</span>pt<span class="hl_char">.</span>x<span class="hl_char">)</span><span class="hl_char">=</span><span class="hl_char">=</span>pt<span class="hl_char">.</span>x&nbsp;&nbsp;&nbsp;<span class="hl_char">&amp;</span><span class="hl_char">&amp;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;min<span class="hl_char">(</span>rc<span class="hl_char">.</span>top<span class="hl_char">,</span>pt<span class="hl_char">.</span>y<span class="hl_char">)</span><span class="hl_char">=</span><span class="hl_char">=</span>rc<span class="hl_char">.</span>top&nbsp;&nbsp;&nbsp;<span class="hl_char">&amp;</span><span class="hl_char">&amp;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;min<span class="hl_char">(</span>rc<span class="hl_char">.</span>bottom<span class="hl_char">,</span>pt<span class="hl_char">.</span>y<span class="hl_char">)</span><span class="hl_char">=</span><span class="hl_char">=</span>pt<span class="hl_char">.</span>y<span class="hl_char">)</span>&nbsp;</li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hl_function"><b>true</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_function"><b>false</b></span><span class="hl_comment">;</span></li><li class="hl_l1">}</li><li class="hl_l0">&nbsp;</li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=258839&amp;user=6939&amp;forum_n=6&amp;topic=15780&amp;page=1&amp;anchor=17" class="addthx" data-post="258839"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]punxer[/b]','')">punxer</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 30.0 (посетитель), 4thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.76'>Активность: 0.03<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=6939">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 мая 2010 14:58 <br><script type="text/javascript">QU('punxer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=punxer" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15780&amp;page=1#18');return false;">#18</a> </span><div align=left><br>
Немного DDraw<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">&nbsp;</li><li class="hl_l1">LPDIRECTDRAWSURFACE7&nbsp;LoadResBitmap<span class="hl_char">(</span><span class="hl_function"><b>int</b></span>&nbsp;id<span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HBITMAP&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hbm&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_char">=</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BITMAP&nbsp;bmp<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LPDIRECTDRAWSURFACE7&nbsp;temp<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hbm<span class="hl_char">=</span>&nbsp;<span class="hl_char">(</span>HBITMAP<span class="hl_char">)</span>LoadImageA<span class="hl_char">(</span>g_hInst<span class="hl_char">,</span>MAKEINTRESOURCE<span class="hl_char">(</span>id<span class="hl_char">)</span><span class="hl_char">,</span>IMAGE_BITMAP<span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span>LR_CR&nbsp;EATEDIBSECTION<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DebugPrintF<span class="hl_char">(</span><span class="hl_quote">&quot;HBITMAP hbm=%d&quot;</span><span class="hl_char">,</span><span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span>hbm<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GetObject<span class="hl_char">(</span>hbm<span class="hl_char">,</span><span class="hl_function">sizeof</span><span class="hl_char">(</span>BITMAP<span class="hl_char">)</span><span class="hl_char">,</span><span class="hl_char">&amp;</span>bmp<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DebugPrintF<span class="hl_char">(</span><span class="hl_quote">&quot;WIDTH =%d HEIGHT=%d&quot;</span><span class="hl_char">,</span>bmp<span class="hl_char">.</span>bmWidth<span class="hl_char">,</span>bmp<span class="hl_char">.</span>bmHeight<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;temp<span class="hl_char">=</span>CreateCustomSurface<span class="hl_char">(</span>bmp<span class="hl_char">.</span>bmWidth<span class="hl_char">,</span>bmp<span class="hl_char">.</span>bmHeight<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DebugPrintF<span class="hl_char">(</span><span class="hl_quote">&quot;lpDDCustomSurface=%d&quot;</span><span class="hl_char">,</span><span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span>temp<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>FAILED<span class="hl_char">(</span>DDCopyBitmap<span class="hl_char">(</span>temp<span class="hl_char">,</span>hbm<span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span>bmp<span class="hl_char">.</span>bmWidth<span class="hl_char">,</span>bmp<span class="hl_char">.</span>bmHeight<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DebugPrintF<span class="hl_char">(</span><span class="hl_quote">&quot;DDCopyBitmap failed&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;temp<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">}</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">LPDIRECTDRAWSURFACE7&nbsp;CreateCustomSurface<span class="hl_char">(</span><span class="hl_function"><b>DWORD</b></span>&nbsp;w<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;h<span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;DDSURFACEDESC2&nbsp;desc<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LPDIRECTDRAWSURFACE7&nbsp;surf&nbsp;<span class="hl_char">=</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HRESULT&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">=</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZeroMemory<span class="hl_char">(</span><span class="hl_char">&amp;</span>desc<span class="hl_char">,</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>desc<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;desc<span class="hl_char">.</span>dwSize&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>desc<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;desc<span class="hl_char">.</span>dwFlags&nbsp;<span class="hl_char">=</span>&nbsp;DDSD_WIDTH&nbsp;<span class="hl_char">|</span>&nbsp;DDSD_HEIGHT&nbsp;<span class="hl_char">|</span>&nbsp;DDSD_CAPS<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;desc<span class="hl_char">.</span>dwWidth&nbsp;<span class="hl_char">=</span>&nbsp;w<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;desc<span class="hl_char">.</span>dwHeight&nbsp;<span class="hl_char">=</span>&nbsp;h<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;desc<span class="hl_char">.</span>ddsCaps<span class="hl_char">.</span>dwCaps&nbsp;<span class="hl_char">=</span>DDSCAPS_OFFSCREENPLAIN&nbsp;<span class="hl_char">|</span>&nbsp;DDSCAPS_VIDEOMEMORY<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;<span class="hl_char">=</span>&nbsp;g_lpDD<span class="hl_char">-</span><span class="hl_char">&gt;</span>CreateSurface<span class="hl_char">(</span><span class="hl_char">&amp;</span>desc<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>surf<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>r&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;DD_OK<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DebugPrintF<span class="hl_char">(</span><span class="hl_quote">&quot;CreateSurface(%d,%d) created in video memory \n&quot;</span><span class="hl_char">,</span>&nbsp;w<span class="hl_char">,</span>&nbsp;h<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;surf<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;desc<span class="hl_char">.</span>ddsCaps<span class="hl_char">.</span>dwCaps&nbsp;<span class="hl_char">=</span>&nbsp;DDSCAPS_OFFSCREENPLAIN&nbsp;<span class="hl_char">|</span>&nbsp;DDSCAPS_SYSTEMMEMORY<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;<span class="hl_char">=</span>&nbsp;g_lpDD<span class="hl_char">-</span><span class="hl_char">&gt;</span>CreateSurface<span class="hl_char">(</span><span class="hl_char">&amp;</span>desc<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>surf<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>r&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;DD_OK<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DebugPrintF<span class="hl_char">(</span><span class="hl_quote">&quot;CreateSurface(%d,%d) allocated in system memory \n&quot;</span><span class="hl_char">,</span>&nbsp;w<span class="hl_char">,</span>&nbsp;h<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;surf<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;DebugPrintF<span class="hl_char">(</span><span class="hl_quote">&quot;CreateSurface(%d,%d) failed\n&quot;</span><span class="hl_char">,</span>&nbsp;w<span class="hl_char">,</span>&nbsp;h<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l1">}</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">HRESULT&nbsp;DDCopyBitmap<span class="hl_char">(</span>IDirectDrawSurface7&nbsp;<span class="hl_char">*</span>&nbsp;pdds<span class="hl_char">,</span>&nbsp;HBITMAP&nbsp;hbm<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;x<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;y<span class="hl_char">,</span><span class="hl_function"><b>int</b></span>&nbsp;<span class="hl_registr">dx</span><span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;dy<span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;HDC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hdcImage</span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;HDC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hdc</span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;BITMAP&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bm</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;DDSURFACEDESC2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ddsd<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;HRESULT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hr<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>hbm&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_function"><b>NULL</b></span>&nbsp;<span class="hl_char">|</span><span class="hl_char">|</span>&nbsp;pdds&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;E_FAIL<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;Make&nbsp;sure&nbsp;<span class="hl_function"><b>this</b></span>&nbsp;surface&nbsp;is&nbsp;restored<span class="hl_char">.</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;pdds<span class="hl_char">-</span><span class="hl_char">&gt;</span>Restore<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;Select&nbsp;bitmap&nbsp;<span class="hl_function"><b>into</b></span>&nbsp;a&nbsp;memoryDC&nbsp;so&nbsp;we&nbsp;can&nbsp;use&nbsp;it<span class="hl_char">.</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;hdcImage&nbsp;<span class="hl_char">=</span>&nbsp;CreateCompatibleDC<span class="hl_char">(</span><span class="hl_function">NULL</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;SelectObject<span class="hl_char">(</span>hdcImage<span class="hl_char">,</span>&nbsp;hbm<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;Get&nbsp;size&nbsp;of&nbsp;the&nbsp;bitmap</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;GetObject<span class="hl_char">(</span>hbm<span class="hl_char">,</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>bm<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>bm<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr"><b>dx</b></span>&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_registr"><b>dx</b></span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span>&nbsp;<span class="hl_char">?</span>&nbsp;bm<span class="hl_char">.</span>bmWidth&nbsp;<span class="hl_char">:</span>&nbsp;<span class="hl_registr"><b>dx</b></span><span class="hl_comment">;    // Use the passed size, unless zero</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;dy&nbsp;<span class="hl_char">=</span>&nbsp;dy&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span>&nbsp;<span class="hl_char">?</span>&nbsp;bm<span class="hl_char">.</span>bmHeight&nbsp;<span class="hl_char">:</span>&nbsp;dy<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;Get&nbsp;size&nbsp;of&nbsp;surface<span class="hl_char">.</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;ddsd<span class="hl_char">.</span>dwSize&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>ddsd<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;ddsd<span class="hl_char">.</span>dwFlags&nbsp;<span class="hl_char">=</span>&nbsp;DDSD_HEIGHT&nbsp;<span class="hl_char">|</span>&nbsp;DDSD_WIDTH<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;pdds<span class="hl_char">-</span><span class="hl_char">&gt;</span>GetSurfaceDesc<span class="hl_char">(</span><span class="hl_char">&amp;</span>ddsd<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span><span class="hl_char">(</span>hr&nbsp;<span class="hl_char">=</span>&nbsp;pdds<span class="hl_char">-</span><span class="hl_char">&gt;</span>GetDC<span class="hl_char">(</span><span class="hl_char">&amp;</span>hdc<span class="hl_char">)</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;DD_OK<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StretchBlt<span class="hl_char">(</span>hdc<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;ddsd<span class="hl_char">.</span>dwWidth<span class="hl_char">,</span>&nbsp;ddsd<span class="hl_char">.</span>dwHeight<span class="hl_char">,</span>&nbsp;hdcImage<span class="hl_char">,</span>&nbsp;x<span class="hl_char">,</span>&nbsp;y<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">dx</span><span class="hl_char">,</span>&nbsp;dy<span class="hl_char">,</span>&nbsp;SRCCOPY<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pdds<span class="hl_char">-</span><span class="hl_char">&gt;</span>ReleaseDC<span class="hl_char">(</span>hdc<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;DeleteDC<span class="hl_char">(</span>hdcImage<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;hr<span class="hl_comment">;</span></li><li class="hl_l0">}</li><li class="hl_l1">&nbsp;</li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=258840&amp;user=6939&amp;forum_n=6&amp;topic=15780&amp;page=1&amp;anchor=18" class="addthx" data-post="258840"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]punxer[/b]','')">punxer</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 30.0 (посетитель), 4thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.76'>Активность: 0.03<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=6939">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 мая 2010 15:00 <br><script type="text/javascript">QU('punxer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=punxer" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15780&amp;page=1#19');return false;">#19</a> </span><div align=left><br><div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">&nbsp;</li><li class="hl_l1">BOOL&nbsp;GetSurfaceDimensions<span class="hl_char">(</span>LPDIRECTDRAWSURFACE7&nbsp;surf<span class="hl_char">,</span><span class="hl_function">DWORD</span><span class="hl_char">&amp;</span>&nbsp;w<span class="hl_char">,</span>&nbsp;<span class="hl_function">DWORD</span><span class="hl_char">&amp;</span>&nbsp;h<span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>surf&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_function"><b>FALSE</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;DDSURFACEDESC2&nbsp;desc<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;ZeroMemory<span class="hl_char">(</span><span class="hl_char">&amp;</span>desc<span class="hl_char">,</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>desc<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;desc<span class="hl_char">.</span>dwSize&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>desc<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;desc<span class="hl_char">.</span>dwFlags&nbsp;<span class="hl_char">=</span>&nbsp;DDSD_WIDTH&nbsp;<span class="hl_char">|</span>&nbsp;DDSD_HEIGHT<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>surf<span class="hl_char">-</span><span class="hl_char">&gt;</span>GetSurfaceDesc<span class="hl_char">(</span><span class="hl_char">&amp;</span>desc<span class="hl_char">)</span>&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;DD_OK<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_function"><b>FALSE</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;w&nbsp;<span class="hl_char">=</span>&nbsp;desc<span class="hl_char">.</span>dwWidth<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;h&nbsp;<span class="hl_char">=</span>&nbsp;desc<span class="hl_char">.</span>dwHeight<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_function"><b>TRUE</b></span><span class="hl_comment">;</span></li><li class="hl_l1">}</li><li class="hl_l0">&nbsp;</li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=258841&amp;user=6939&amp;forum_n=6&amp;topic=15780&amp;page=1&amp;anchor=19" class="addthx" data-post="258841"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="20" onfocus="this.blur()" href="JavaScript:di('[b]punxer[/b]','')">punxer</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 30.0 (посетитель), 4thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.76'>Активность: 0.03<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=6939">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 мая 2010 15:01 &middot; Поправил: punxer <br><script type="text/javascript">QU('punxer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=punxer" target="_blank">Личное сообщение</a> &middot;  <a href="#20" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15780&amp;page=1#20');return false;">#20</a> </span><div align=left><br>
Если интересно могу накидать вывод поверх чужого Директ Дро из подгруженной ДЛЛ
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=258842&amp;user=6939&amp;forum_n=6&amp;topic=15780&amp;page=1&amp;anchor=20" class="addthx" data-post="258842"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="21" onfocus="this.blur()" href="JavaScript:di('[b]MasterSoft[/b]','')">MasterSoft</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 281.8 (наставник), 272thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.16'>Активность: 0.25<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=16624">Участник</a><br><font color=blue>Destroyer of protectors</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 мая 2010 17:21 <br><script type="text/javascript">QU('MasterSoft','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=MasterSoft" target="_blank">Личное сообщение</a> &middot;  <a href="#21" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15780&amp;page=1#21');return false;">#21</a> </span><div align=left><br>
<b>punxer</b><br>Кидай если не в тягость, это нужно.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=258850&amp;user=16624&amp;forum_n=6&amp;topic=15780&amp;page=1&amp;anchor=21" class="addthx" data-post="258850"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="22" onfocus="this.blur()" href="JavaScript:di('[b]punxer[/b]','')">punxer</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 30.0 (посетитель), 4thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.76'>Активность: 0.03<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=6939">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 мая 2010 07:57 <br><script type="text/javascript">QU('punxer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=punxer" target="_blank">Личное сообщение</a> &middot;  <a href="#22" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15780&amp;page=1#22');return false;">#22</a> </span><div align=left><br>
Кидаю. Прорисовка подерх чужого DirectDraw7<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">&nbsp;</li><li class="hl_l1">HRESULT&nbsp;WINAPI&nbsp;MyDirectDrawCreateEx<span class="hl_char">(</span>GUID&nbsp;<span class="hl_char">*</span>lpGuid<span class="hl_char">,</span>LPVOID&nbsp;<span class="hl_char">*</span>lplpDD<span class="hl_char">,</span><span class="hl_function"><b>const</b></span>&nbsp;IID&nbsp;<span class="hl_char">&amp;</span>iid<span class="hl_char">,</span>IUnknown&nbsp;<span class="hl_char">*</span>pUnkOuter<span class="hl_char">)</span>&nbsp;</li><li class="hl_l0">{</li><li class="hl_l1">#define&nbsp;CREATE_SURFACE_OFFSET&nbsp;<span class="hl_number">24</span></li><li class="hl_l0">#define&nbsp;SET_COOP_LEVEL_OFFSET&nbsp;<span class="hl_number">80</span></li><li class="hl_l1">#define&nbsp;SET_DISP_MODE_OFFSET&nbsp;&nbsp;<span class="hl_number">84</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HRESULT&nbsp;r<span class="hl_char">=</span><span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span><span class="hl_char">(</span>r<span class="hl_char">=</span>pDirectDrawCreateEx<span class="hl_char">(</span>lpGuid<span class="hl_char">,</span>lplpDD<span class="hl_char">,</span>iid<span class="hl_char">,</span>pUnkOuter<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_char">=</span><span class="hl_char">=</span>DD_OK<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DebugPrintF<span class="hl_char">(</span><span class="hl_quote">&quot;DirectDrawCreateEx SUCCESS&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_lpDD<span class="hl_char">=</span><span class="hl_char">(</span>IDirectDraw7<span class="hl_char">*</span><span class="hl_char">)</span><span class="hl_char">*</span>lplpDD<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>HOOKING&nbsp;COM</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pIDirectDraw7_SetCooperativeLevel<span class="hl_char">=</span><span class="hl_char">(</span>HRESULT&nbsp;<span class="hl_char">(</span>__stdcall&nbsp;PASCAL<span class="hl_char">*</span>&nbsp;<span class="hl_char">)</span><span class="hl_char">(</span>LPDIRECTDRAWSURFACE7<span class="hl_char">,</span>HWND<span class="hl_char">,</span><span class="hl_function">DWORD</span><span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HookCOM<span class="hl_char">(</span>lplpDD<span class="hl_char">,</span>SET_COOP_LEVEL_OFFSET<span class="hl_char">,</span><span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span>MyIDirectDraw7_SetCooper&nbsp;ativeLevel<span class="hl_char">,</span><span class="hl_number">31</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DebugPrintF<span class="hl_char">(</span><span class="hl_quote">&quot;!!SetCooperativeLevel hooked&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pIDirectDraw7_SetDisplayMode<span class="hl_char">=</span><span class="hl_char">(</span>HRESULT&nbsp;<span class="hl_char">(</span>__stdcall&nbsp;PASCAL<span class="hl_char">*</span>&nbsp;<span class="hl_char">)</span><span class="hl_char">(</span>LPDIRECTDRAWSURFACE7<span class="hl_char">,</span><span class="hl_function">DWORD</span><span class="hl_char">,</span><span class="hl_function">DWORD</span><span class="hl_char">,</span><span class="hl_function">DWORD</span><span class="hl_char">,</span><span class="hl_function">DWORD</span><span class="hl_char">,</span><span class="hl_function">DWORD</span><span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HookCOM<span class="hl_char">(</span>lplpDD<span class="hl_char">,</span>SET_DISP_MODE_OFFSET<span class="hl_char">,</span><span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span>MyIDirectDraw7_SetDisplay&nbsp;Mode<span class="hl_char">,</span><span class="hl_number">31</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DebugPrintF<span class="hl_char">(</span><span class="hl_quote">&quot;!!SetDisplayMode hooked&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;r<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">}</li>        </ol>
    </div>
</div></div>
<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">&nbsp;</li><li class="hl_l1">HRESULT&nbsp;&nbsp;__stdcall&nbsp;&nbsp;&nbsp;PASCAL&nbsp;MyIDirectDrawSurface7_Flip<span class="hl_char">(</span>LPDIRECTDRAWSURFACE7&nbsp;lplpThis<span class="hl_char">,</span>LPDIRECTDRAWSURFACE7<span class="hl_char">*</span>&nbsp;lplpSurf7<span class="hl_char">,</span><span class="hl_function"><b>DWORD</b></span>&nbsp;param<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HRESULT&nbsp;<span class="hl_function">ret</span><span class="hl_char">=</span><span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DDSURFACEDESC2&nbsp;sd2<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>DebugPrintF<span class="hl_char">(</span><span class="hl_quote">&quot;!!!In lpDDPrimarySurf7-&gt;Flip&quot;</span><span class="hl_char">)</span><span class="hl_comment">;		</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>g_lpDDSurfBack<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_lpDDSurfBack<span class="hl_char">-</span><span class="hl_char">&gt;</span><span class="hl_function">Lock</span><span class="hl_char">(</span><span class="hl_function">NULL</span><span class="hl_char">,</span><span class="hl_char">&amp;</span>sd2<span class="hl_char">,</span>DDLOCK_WAIT<span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">)</span><span class="hl_comment">;	</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>Drawing</li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_lpDDSurfBack</span><span class="hl_char">-</span><span class="hl_char">&gt;</span>BltFast<span class="hl_char">(</span><span class="hl_number">385</span><span class="hl_char">,</span><span class="hl_number">400</span><span class="hl_char">,</span>g_lpDDSurfBtnSelectorUP<span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_lpDDSurfBack<span class="hl_char">-</span><span class="hl_char">&gt;</span>Unlock<span class="hl_char">(</span><span class="hl_function">NULL</span><span class="hl_char">)</span><span class="hl_comment">;	</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>DebugPrintF<span class="hl_char">(</span><span class="hl_quote">&quot;!!!RETURN&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">ret</span><span class="hl_char">=</span>pIDirectDrawSurface7_Flip<span class="hl_char">(</span>lplpThis<span class="hl_char">,</span>lplpSurf7<span class="hl_char">,</span>param<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_function"><b>ret</b></span><span class="hl_comment">;</span></li><li class="hl_l0">}</li><li class="hl_l1">&nbsp;</li>        </ol>
    </div>
</div></div>
<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">HRESULT&nbsp;&nbsp;__stdcall&nbsp;&nbsp;&nbsp;PASCAL&nbsp;MyIDirectDrawSurface7_GetAttachedSurface<span class="hl_char">(</span>LPDIRECTDRAWSURFACE7&nbsp;lplpThis<span class="hl_char">,</span>&nbsp;LPDDSCAPS2&nbsp;lpCaps<span class="hl_char">,</span>&nbsp;LPDIRECTDRAWSURFACE7&nbsp;<span class="hl_function"><b>FAR</b></span>&nbsp;<span class="hl_char">*</span>&nbsp;lplpSurf<span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HRESULT&nbsp;<span class="hl_function"><b>ret</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">ret</span><span class="hl_char">=</span>pIDirectDrawSurface7_GetAttachedSurface<span class="hl_char">(</span>lplpThis<span class="hl_char">,</span>lpCaps<span class="hl_char">,</span>lplpSurf<span class="hl_char">)</span>&nbsp;<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DebugPrintF<span class="hl_char">(</span><span class="hl_quote">&quot;!!!!!!Primary surface-&gt;GetAttachedSurface&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>lpCaps<span class="hl_char">-</span><span class="hl_char">&gt;</span>dwCaps&nbsp;<span class="hl_char">&amp;</span>&nbsp;DDSCAPS_BACKBUFFER<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DebugPrintF<span class="hl_char">(</span><span class="hl_quote">&quot;!!!!!!!!!!!Back Buffer Founded&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_lpDDSurfBack<span class="hl_char">=</span><span class="hl_char">*</span>lplpSurf<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_function"><b>ret</b></span><span class="hl_comment">;</span></li><li class="hl_l0">}</li><li class="hl_l1">&nbsp;</li>        </ol>
    </div>
</div></div>
<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">&nbsp;</li><li class="hl_l1">HRESULT&nbsp;__stdcall&nbsp;PASCAL&nbsp;MyIDirectDraw7_CreateSurface<span class="hl_char">(</span>LPVOID&nbsp;lplpDD<span class="hl_char">,</span>LPDDSURFACEDESC2&nbsp;lpDDSurfdesc2<span class="hl_char">,</span>&nbsp;LPDIRECTDRAWSURFACE7&nbsp;<span class="hl_function"><b>FAR</b></span>&nbsp;<span class="hl_char">*</span>lpDDSurf7<span class="hl_char">,</span>&nbsp;IUnknown&nbsp;<span class="hl_function"><b>FAR</b></span>&nbsp;<span class="hl_char">*</span>&nbsp;pUnk<span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1">#define&nbsp;IDirectDrawSurface7_Flip_OFFSET&nbsp;<span class="hl_number">44</span></li><li class="hl_l0">#define&nbsp;GetAttachedSurface_OFFSET&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">48</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HRESULT&nbsp;<span class="hl_function">ret</span><span class="hl_char">=</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">ret</span><span class="hl_char">=</span>pIDirectDraw7_CreateSurface<span class="hl_char">(</span>lplpDD<span class="hl_char">,</span>lpDDSurfdesc2<span class="hl_char">,</span>lpDDSurf7<span class="hl_char">,</span>pUnk<span class="hl_char">)</span><span class="hl_comment">; </span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>DebugPrintF<span class="hl_char">(</span><span class="hl_quote">&quot;!!!In lpDD-&gt;CreateSurface&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>lpDDSurfdesc2<span class="hl_char">-</span><span class="hl_char">&gt;</span>ddsCaps<span class="hl_char">.</span>dwCaps&nbsp;<span class="hl_char">&amp;</span>&nbsp;DDSCAPS_PRIMARYSURFACE<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>Hook&nbsp;flip&nbsp;<span class="hl_function"><b>and</b></span>&nbsp;other&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DebugPrintF<span class="hl_char">(</span><span class="hl_quote">&quot;!!!!!!Primary surface founded&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>lpDDSurfdesc2<span class="hl_char">-</span><span class="hl_char">&gt;</span>dwBackBufferCount<span class="hl_char">=</span><span class="hl_char">=</span><span class="hl_number">1</span><span class="hl_char">)</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DebugPrintF</span><span class="hl_char">(</span><span class="hl_quote">&quot;!!!!!!Primary surface founded!!!!BackBuffer one!!!!!!!!!!&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_lpDDSurfPrimary<span class="hl_char">=</span><span class="hl_char">(</span>LPDIRECTDRAWSURFACE7<span class="hl_char">)</span><span class="hl_char">*</span>lpDDSurf7<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pIDirectDrawSurface7_Flip<span class="hl_char">=</span><span class="hl_char">(</span>HRESULT<span class="hl_char">(</span>__stdcall&nbsp;&nbsp;&nbsp;PASCAL<span class="hl_char">*</span><span class="hl_char">)</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_char">(</span>LPDIRECTDRAWSURFACE7&nbsp;lplpThis<span class="hl_char">,</span>LPDIRECTDRAWSURFACE7<span class="hl_char">*</span>&nbsp;lplpSurf7<span class="hl_char">,</span><span class="hl_function"><b>DWORD</b></span>&nbsp;param<span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HookCOM</span><span class="hl_char">(</span><span class="hl_char">(</span>PVOID<span class="hl_char">*</span><span class="hl_char">)</span>lpDDSurf7<span class="hl_char">,</span>IDirectDrawSurface7_Flip_OFFSET<span class="hl_char">,</span><span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span>My&nbsp;IDirectDrawSurface7_Flip<span class="hl_char">,</span><span class="hl_number">52</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pIDirectDrawSurface7_GetAttachedSurface</span><span class="hl_char">=</span><span class="hl_char">(</span>HRESULT<span class="hl_char">(</span>__stdcall&nbsp;&nbsp;&nbsp;PASCAL<span class="hl_char">*</span><span class="hl_char">)</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_char">(</span>LPDIRECTDRAWSURFACE7&nbsp;lplpThis<span class="hl_char">,</span>&nbsp;LPDDSCAPS2<span class="hl_char">,</span>&nbsp;LPDIRECTDRAWSURFACE7&nbsp;<span class="hl_function"><b>FAR</b></span>&nbsp;<span class="hl_char">*</span><span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HookCOM</span><span class="hl_char">(</span><span class="hl_char">(</span>PVOID<span class="hl_char">*</span><span class="hl_char">)</span>lpDDSurf7<span class="hl_char">,</span>GetAttachedSurface_OFFSET<span class="hl_char">,</span><span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span>MyIDirec&nbsp;tDrawSurface7_GetAttachedSurface<span class="hl_char">,</span><span class="hl_number">52</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_function"><b>ret</b></span><span class="hl_comment">;</span></li><li class="hl_l1">}</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;</li>        </ol>
    </div>
</div></div>
<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">&nbsp;</li><li class="hl_l1">HRESULT&nbsp;__stdcall&nbsp;PASCAL&nbsp;MyIDirectDraw7_SetDisplayMode<span class="hl_char">(</span>LPDIRECTDRAWSURFACE7&nbsp;lplpThis<span class="hl_char">,</span><span class="hl_function"><b>DWORD</b></span>&nbsp;dwWidth<span class="hl_char">,</span><span class="hl_function"><b>DWORD</b></span>&nbsp;dwHeight<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;dwBPP<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;dwRefreshRate<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;dwFlags&nbsp;<span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1">#define&nbsp;CREATE_SURFACE_OFFSET&nbsp;<span class="hl_number">24</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HRESULT&nbsp;tmp<span class="hl_char">=</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;iter<span class="hl_char">=</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DebugPrintF<span class="hl_char">(</span><span class="hl_quote">&quot;!!!!!!!!!!!!!!!!!!!!!!!!!!!!!in MyIDirectDraw7_SetDisplayMode&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp<span class="hl_char">=</span>pIDirectDraw7_SetDisplayMode<span class="hl_char">(</span>lplpThis<span class="hl_char">,</span>dwWidth<span class="hl_char">,</span>dwHeight<span class="hl_char">,</span>dwBPP<span class="hl_char">,</span>dwRe&nbsp;freshRate<span class="hl_char">,</span>dwFlags<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DebugPrintF<span class="hl_char">(</span><span class="hl_quote">&quot;!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! !!!!Loading Graphics&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_lpDDSurfBtnSelectorDN<span class="hl_char">=</span>LoadResBitmap<span class="hl_char">(</span>IDB_BITMAP2<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span><span class="hl_char">!</span>g_lpDDSurfBtnSelectorDN<span class="hl_char">)</span>&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DebugPrintF<span class="hl_char">(</span><span class="hl_quote">&quot;Load Failed 101&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pIDirectDraw7_CreateSurface<span class="hl_char">=</span><span class="hl_char">(</span>HRESULT&nbsp;<span class="hl_char">(</span>__stdcall&nbsp;PASCAL&nbsp;<span class="hl_char">*</span><span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">(</span>LPVOID<span class="hl_char">,</span>LPDDSURFACEDESC2<span class="hl_char">,</span>&nbsp;LPDIRECTDRAWSURFACE7&nbsp;<span class="hl_function"><b>FAR</b></span>&nbsp;<span class="hl_char">*</span><span class="hl_char">,</span>&nbsp;IUnknown&nbsp;<span class="hl_function"><b>FAR</b></span>&nbsp;<span class="hl_char">*</span><span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HookCOM<span class="hl_char">(</span><span class="hl_char">(</span>PVOID<span class="hl_char">*</span><span class="hl_char">)</span><span class="hl_char">&amp;</span>g_lpDD<span class="hl_char">,</span>CREATE_SURFACE_OFFSET<span class="hl_char">,</span><span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span>&nbsp;MyIDirectDraw7_CreateSurface<span class="hl_char">,</span><span class="hl_number">31</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DebugPrintF<span class="hl_char">(</span><span class="hl_quote">&quot;!!!!!!CreateSurface hooked&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;tmp<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">}</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;</li>        </ol>
    </div>
</div></div>
<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">HRESULT&nbsp;__stdcall&nbsp;PASCAL&nbsp;MyIDirectDraw7_SetCooperativeLevel<span class="hl_char">(</span>LPDIRECTDRAWSURFACE7&nbsp;lplpThis<span class="hl_char">,</span>HWND&nbsp;hWnd<span class="hl_char">,</span><span class="hl_function"><b>DWORD</b></span>&nbsp;dwFlags<span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DebugPrintF<span class="hl_char">(</span><span class="hl_quote">&quot;in MyIDirectDraw7_SetCooperativeLevel&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;pIDirectDraw7_SetCooperativeLevel<span class="hl_char">(</span>lplpThis<span class="hl_char">,</span>hWnd<span class="hl_char">,</span>dwFlags<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">}</li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=258881&amp;user=6939&amp;forum_n=6&amp;topic=15780&amp;page=1&amp;anchor=22" class="addthx" data-post="258881"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="23" onfocus="this.blur()" href="JavaScript:di('[b]punxer[/b]','')">punxer</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 30.0 (посетитель), 4thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.76'>Активность: 0.03<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=6939">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 мая 2010 08:00 <br><script type="text/javascript">QU('punxer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=punxer" target="_blank">Личное сообщение</a> &middot;  <a href="#23" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15780&amp;page=1#23');return false;">#23</a> </span><div align=left><br><div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function">ret</span><span class="hl_char">=</span>SpliceBridge<span class="hl_char">(</span><span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span>GetProcAddress<span class="hl_char">(</span>GetModuleHandle<span class="hl_char">(</span><span class="hl_quote">&quot;DDRAW.DLL&quot;</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">,</span><span class="hl_quote">&quot;DirectDrawCreateEx&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span>MyDirectDrawCreateEx<span class="hl_char">,</span>true_ptr<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span><span class="hl_char">!</span><span class="hl_function">ret</span><span class="hl_char">)</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit</span><span class="hl_char">(</span><span class="hl_number">0</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pDirectDrawCreateEx</span><span class="hl_char">=</span><span class="hl_char">(</span>HRESULT&nbsp;<span class="hl_char">(</span>WINAPI&nbsp;<span class="hl_char">*</span><span class="hl_char">)</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_char">(</span>GUID&nbsp;<span class="hl_char">*</span>lpGuid<span class="hl_char">,</span>LPVOID&nbsp;<span class="hl_char">*</span>lplpDD<span class="hl_char">,</span><span class="hl_function"><b>const</b></span>&nbsp;IID&nbsp;<span class="hl_char">&amp;</span>iid<span class="hl_char">,</span>IUnknown&nbsp;<span class="hl_char">*</span>pUnkOuter<span class="hl_char">)</span><span class="hl_char">)</span>&nbsp;true_ptr<span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DebugPrintF</span><span class="hl_char">(</span><span class="hl_quote">&quot;DirectDrawCreateEx hooked&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=258882&amp;user=6939&amp;forum_n=6&amp;topic=15780&amp;page=1&amp;anchor=23" class="addthx" data-post="258882"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="24" onfocus="this.blur()" href="JavaScript:di('[b]punxer[/b]','')">punxer</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 30.0 (посетитель), 4thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.76'>Активность: 0.03<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=6939">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 июня 2010 09:06 <br><script type="text/javascript">QU('punxer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=punxer" target="_blank">Личное сообщение</a> &middot;  <a href="#24" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15780&amp;page=1#24');return false;">#24</a> </span><div align=left><br>
Перехват функций с нестандартным не 5-байтовым прологом с помощью мостов.<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">bool&nbsp;SpliceBridgeAllProlog<span class="hl_char">(</span>__in&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_function">addr</span><span class="hl_char">,</span>__in&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;new_addr<span class="hl_char">,</span>__out&nbsp;<span class="hl_function">DWORD</span><span class="hl_char">&amp;</span>&nbsp;true_addr<span class="hl_char">,</span><span class="hl_function"><b>int</b></span>&nbsp;prolog_size<span class="hl_char">)</span>&nbsp;</li><li class="hl_l1">{&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;Protects<span class="hl_char">=</span>&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>NULL</b></span><span class="hl_comment">; </span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_function">JA</span><span class="hl_char">=</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">BYTE</span><span class="hl_char">*</span>&nbsp;bridge<span class="hl_char">=</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>NULL</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span><span class="hl_function"><b>addr</b></span>&nbsp;<span class="hl_char">&amp;</span><span class="hl_char">&amp;</span>&nbsp;new_addr<span class="hl_char">)</span>&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>Create&nbsp;Bridge</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bridge<span class="hl_char">=</span><span class="hl_char">(</span><span class="hl_function">BYTE</span><span class="hl_char">*</span><span class="hl_char">)</span>VirtualAlloc<span class="hl_char">(</span><span class="hl_function">NULL</span><span class="hl_char">,</span><span class="hl_number">5</span><span class="hl_char">+</span>prolog_size<span class="hl_char">,</span>MEM_COMMIT<span class="hl_char">,</span>PAGE_EXECUT&nbsp;&nbsp;E_READWRITE<span class="hl_char">)</span><span class="hl_comment">; </span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VirtualProtect<span class="hl_char">(</span><span class="hl_char">(</span>LPVOID<span class="hl_char">)</span><span class="hl_function">addr</span><span class="hl_char">,</span>&nbsp;prolog_size<span class="hl_char">,</span>&nbsp;PAGE_EXECUTE_READWRITE<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>Protects<span class="hl_char">)</span><span class="hl_comment">; </span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memcpy<span class="hl_char">(</span>bridge<span class="hl_char">,</span>&nbsp;<span class="hl_char">(</span>LPVOID<span class="hl_char">)</span><span class="hl_function">addr</span><span class="hl_char">,</span>&nbsp;&nbsp;prolog_size<span class="hl_char">)</span><span class="hl_comment">; </span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bridge<span class="hl_char">[</span>prolog_size<span class="hl_char">]</span><span class="hl_char">=</span>0xE9<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">JA</span><span class="hl_char">=</span><span class="hl_function">addr</span><span class="hl_char">-</span><span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span>bridge<span class="hl_char">-</span><span class="hl_number">5</span><span class="hl_comment">; </span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memcpy<span class="hl_char">(</span><span class="hl_char">&amp;</span>bridge<span class="hl_char">[</span>prolog_size<span class="hl_char">+</span><span class="hl_number">1</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_char">&amp;</span><span class="hl_function">JA</span><span class="hl_char">,</span><span class="hl_number">4</span><span class="hl_char">)</span><span class="hl_comment">; </span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;true_addr<span class="hl_char">=</span><span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span>bridge<span class="hl_comment">; </span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>Patch&nbsp;Function</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>BYTE</b></span>&nbsp;<span class="hl_char">*</span><span class="hl_function">jmp</span><span class="hl_char">=</span><span class="hl_char">(</span><span class="hl_function">BYTE</span><span class="hl_char">*</span><span class="hl_char">)</span>VirtualAlloc<span class="hl_char">(</span><span class="hl_function">NULL</span><span class="hl_char">,</span>prolog_size<span class="hl_char">,</span>MEM_COMMIT<span class="hl_char">,</span>PAGE_EXECUTE_READ&nbsp;WRITE<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">jmp</span><span class="hl_char">[</span><span class="hl_number">0</span><span class="hl_char">]</span><span class="hl_char">=</span>0xE9<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">JA</span><span class="hl_char">=</span><span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span>new_addr&nbsp;<span class="hl_char">-</span>&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;<span class="hl_char">-</span>&nbsp;<span class="hl_number">5</span><span class="hl_comment">; </span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memcpy<span class="hl_char">(</span><span class="hl_char">&amp;</span><span class="hl_function">jmp</span><span class="hl_char">[</span><span class="hl_number">1</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_char">&amp;</span><span class="hl_function">JA</span><span class="hl_char">,</span><span class="hl_number">4</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memset<span class="hl_char">(</span><span class="hl_char">&amp;</span><span class="hl_function">jmp</span><span class="hl_char">[</span><span class="hl_number">5</span><span class="hl_char">]</span><span class="hl_char">,</span>0x90<span class="hl_char">,</span>prolog_size<span class="hl_char">-</span><span class="hl_number">5</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>memcpy<span class="hl_char">(</span><span class="hl_char">(</span>LPVOID<span class="hl_char">)</span><span class="hl_function">addr</span><span class="hl_char">,</span><span class="hl_function">jmp</span><span class="hl_char">,</span>&nbsp;prolog_size<span class="hl_char">)</span><span class="hl_char">)</span>&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VirtualProtect</span><span class="hl_char">(</span><span class="hl_char">(</span>LPVOID<span class="hl_char">)</span><span class="hl_function">addr</span><span class="hl_char">,</span>&nbsp;prolog_size<span class="hl_char">,</span>&nbsp;Protects<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>Protects<span class="hl_char">)</span><span class="hl_comment">; </span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hl_function"><b>true</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</li><li class="hl_l1">return&nbsp;<span class="hl_function"><b>false</b></span><span class="hl_comment">; </span></li><li class="hl_l0">}</li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=259249&amp;user=6939&amp;forum_n=6&amp;topic=15780&amp;page=1&amp;anchor=24" class="addthx" data-post="259249"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="25" onfocus="this.blur()" href="JavaScript:di('[b]HiEndsoft[/b]','')">HiEndsoft</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 237.0 (наставник), 20thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.74'>Активность: 0.13<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=13651">Участник</a><br><font color=blue>sysenter</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 июня 2010 11:37 &middot; Поправил: HiEndsoft <br><script type="text/javascript">QU('HiEndsoft','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=HiEndsoft" target="_blank">Личное сообщение</a> &middot;  <a href="#25" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15780&amp;page=1#25');return false;">#25</a> </span><div align=left><br>
<I>punxer пишет:<br>Перехват функций с нестандартным не 5-байтовым прологом с помощью мостов. </I><br>как показывает опыт, для 99% WIN32 API если 1-ый байт=0x55 значит пролог не 5 байт.
<br><br><font size="1"><i>-----<br>продавец резиновых утёнков</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=259306&amp;user=13651&amp;forum_n=6&amp;topic=15780&amp;page=1&amp;anchor=25" class="addthx" data-post="259306"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="26" onfocus="this.blur()" href="JavaScript:di('[b]punxer[/b]','')">punxer</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 30.0 (посетитель), 4thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.76'>Активность: 0.03<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=6939">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 июня 2010 21:02 <br><script type="text/javascript">QU('punxer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=punxer" target="_blank">Личное сообщение</a> &middot;  <a href="#26" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15780&amp;page=1#26');return false;">#26</a> </span><div align=left><br>
<b>HiEndsoft</b> как показывает опыт для WIN32API хватает 5 байт<br>Точнее эта функция для пролога и вовбще для перехвата любой длины
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=259341&amp;user=6939&amp;forum_n=6&amp;topic=15780&amp;page=1&amp;anchor=26" class="addthx" data-post="259341"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="27" onfocus="this.blur()" href="JavaScript:di('[b]HiEndsoft[/b]','')">HiEndsoft</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 237.0 (наставник), 20thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.74'>Активность: 0.13<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=13651">Участник</a><br><font color=blue>sysenter</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 июня 2010 22:39 &middot; Поправил: HiEndsoft <br><script type="text/javascript">QU('HiEndsoft','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=HiEndsoft" target="_blank">Личное сообщение</a> &middot;  <a href="#27" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15780&amp;page=1#27');return false;">#27</a> </span><div align=left><br>
<I>punxer пишет:<br>как показывает опыт для WIN32API хватает 5 байт </I><br>Да ну? connect [ws2_32] и много других. (вообще и 1байта достаточно, например 0xCC).<br>На счет 0x55 я конечно погорячился (нужен дизассемблер длин в общ случае).
<br><br><font size="1"><i>-----<br>продавец резиновых утёнков</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=259345&amp;user=13651&amp;forum_n=6&amp;topic=15780&amp;page=1&amp;anchor=27" class="addthx" data-post="259345"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="28" onfocus="this.blur()" href="JavaScript:di('[b]punxer[/b]','')">punxer</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 30.0 (посетитель), 4thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.76'>Активность: 0.03<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=6939">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 июня 2010 22:56 <br><script type="text/javascript">QU('punxer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=punxer" target="_blank">Личное сообщение</a> &middot;  <a href="#28" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15780&amp;page=1#28');return false;">#28</a> </span><div align=left><br>
<b>HiEndsoft</b><br>connect [ws2_32] перехватывается и стандартно -5.  Про СС отдельный разговор. А так зная что перехватываешь функция самое то
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=259347&amp;user=6939&amp;forum_n=6&amp;topic=15780&amp;page=1&amp;anchor=28" class="addthx" data-post="259347"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="29" onfocus="this.blur()" href="JavaScript:di('[b]punxer[/b]','')">punxer</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 30.0 (посетитель), 4thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.76'>Активность: 0.03<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=6939">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 июня 2010 23:01 <br><script type="text/javascript">QU('punxer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=punxer" target="_blank">Личное сообщение</a> &middot;  <a href="#29" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15780&amp;page=1#29');return false;">#29</a> </span><div align=left><br>
<b>HiEndsoft</b><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">SpliceBridgeAllProlog&nbsp;с&nbsp;аргументом&nbsp;<span class="hl_number">5</span></li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=259348&amp;user=6939&amp;forum_n=6&amp;topic=15780&amp;page=1&amp;anchor=29" class="addthx" data-post="259348"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="30" onfocus="this.blur()" href="JavaScript:di('[b]punxer[/b]','')">punxer</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 30.0 (посетитель), 4thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.76'>Активность: 0.03<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=6939">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 июня 2010 23:14 &middot; Поправил: <a href="action=stats#mods">Модератор</a> <br><script type="text/javascript">QU('punxer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=punxer" target="_blank">Личное сообщение</a> &middot;  <a href="#30" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15780&amp;page=1#30');return false;">#30</a> </span><div align=left><br>
конвертация исполняемого файла EXE в DLL<br><b><font color="red">От модератора: в топике же просили проверенный код, за поиск PE сигнатуры поиском строки руки надо просто вырывать</font></b>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=259351&amp;user=6939&amp;forum_n=6&amp;topic=15780&amp;page=1&amp;anchor=30" class="addthx" data-post="259351"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="31" onfocus="this.blur()" href="JavaScript:di('[b]HiEndsoft[/b]','')">HiEndsoft</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 237.0 (наставник), 20thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.74'>Активность: 0.13<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=13651">Участник</a><br><font color=blue>sysenter</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 июня 2010 23:14 &middot; Поправил: HiEndsoft <br><script type="text/javascript">QU('HiEndsoft','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=HiEndsoft" target="_blank">Личное сообщение</a> &middot;  <a href="#31" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15780&amp;page=1#31');return false;">#31</a> </span><div align=left><br>
1. Утверждение:<br><I>punxer пишет:<br>как показывает опыт для WIN32API хватает 5 байт </I><br>- не верно.<br>2.<br><I>punxer пишет:<br>connect [ws2_32] перехватывается и стандартно -5 </I><br>connect [ws2_32] WinXP SP3:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">ebp</span></li><li class="hl_l1"><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ebp</span><span class="hl_char">,</span><span class="hl_registr">esp</span></li><li class="hl_l0"><span class="hl_function"><b>sub</b></span>&nbsp;<span class="hl_registr">esp</span><span class="hl_char">,</span>0x00000018</li><li class="hl_l1"><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span></li>        </ol>
    </div>
</div></div>
<br>- уже 6 байт. Прежде чем копипастить здесь вагонами, в дизассемблер загляните.<br><br><I>punxer пишет:<br>конвертация исполняемого файла EXE в DLL </I><br><img src="img/smilies/s5.gif" alt=""> Ув. модераторы: сбейте этот самолет он загнался.
<br><br><font size="1"><i>-----<br>продавец резиновых утёнков</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=259352&amp;user=13651&amp;forum_n=6&amp;topic=15780&amp;page=1&amp;anchor=31" class="addthx" data-post="259352"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> <a href="action=vthread&amp;forum=6&amp;topic=15780&amp;page=0.html">&lt;&lt;</a> .  <a href="action=vthread&amp;forum=6&amp;topic=15780&amp;page=0.html">1</a> . <b>2</b> . <a href="action=vthread&amp;forum=6&amp;topic=15780&amp;page=2.html">3</a> . <a href="action=vthread&amp;forum=6&amp;topic=15780&amp;page=2.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Небольшие полезные коды</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#32" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="6">
<input type="hidden" name="topic" value="15780">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=15780" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
