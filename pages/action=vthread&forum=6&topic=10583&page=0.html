<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Перехват CreateThread API - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Народ подскажите как сделать сабж? А то чето притомился с ним. Вот собсна код: . . if (EnableDebugPrivilege()) //задаем дебаг привилегии   gcnew intercept(CrThrAddress); else . . bool Interception(PROC pfnCurrent) { 	DWORD">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=55995'>tyns777</a>, <a target='_blank' href='?action=userinfo&amp;user=42072'>zombi-vadim</a> (+4 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Перехват CreateThread API</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]Hill[/b]','')">Hill</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 36.7 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.38'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=10104">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 ноября 2007 15:09 &middot; Поправил: Hill <br><script type="text/javascript">QU('Hill','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Hill" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=10583.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Народ подскажите как сделать сабж?<br>А то чето притомился с ним. Вот собсна код:<br><br>.<br>.<br>if (EnableDebugPrivilege()) //задаем дебаг привилегии<br>     gcnew intercept(CrThrAddress);<br>else<br>.<br>.<br>bool Interception(PROC pfnCurrent)<br>{<br>	DWORD bw,Writen;<br>	Byte* Buffer,Buff;<br>	HANDLE hProcess;<br>	intercept^ MyProc;<br>	try<br>	{<br>                 hProcess= OpenProcess(PROCESS_VM_READ|PROCESS_VM_WRITE|PROCESS_VM_OPERATION,fals e,                                                            GetCurrentProcessId());<br>		MyProc=gcnew intercept(gcnew Interceptor(),&amp;Interceptor::MyCreateThread);<br>	 //инициализация структуры перехвата CreateThread<br>         //сохраняем старое начало функции<br>		 ReadProcessMemory(hProcess, pfnCurrent, &amp;Buff, sizeof(Buffer), (SIZE_T *)bw);<br>			DWORD dwDummy;<br>          //Разрешим запись в эту страницу<br>          VirtualProtect(pfnCurrent, sizeof(Buffer), PAGE_EXECUTE_READWRITE, &amp;dwDummy);<br>	<br>          //записываем новое начало CreateThread<br>		if (!WriteProcessMemory(hProcess, pfnCurrent,Buffer,sizeof(Buffer),(SIZE_T*) Writen))<br>		<br>	        //Interceptor::RunThreads();<br>		  return true;<br>		}<br>	catch (...)<br>	{<br>		<br>	}<br>	return false;<br>}<br><br>уже как только не пытался... погуглил, пересмотрел... а результат один: либо ребут, либо ERROR_NOACCESS<br>P.S. пыпытка остановить все левые потоки приводит к полному зависанию...<br>То ди я где то накосячил то ли это такие особенности 2005 студии и дллок с CLR заголовками...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=170208&amp;user=10104&amp;forum_n=6&amp;topic=10583.html&amp;page=0&amp;anchor=1" class="addthx" data-post="170208"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]Rascal[/b]','')">Rascal</a></b><br></div>
<img src="img/s6.gif" alt=""><br><img style="padding-top:3px;" src="av/60.jpg" alt=""><br><span class=txtSm>Ранг: 260.9 (наставник)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.95'>Активность: 0.12<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=60">Участник</a><br><font color=blue>John Smith</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 ноября 2007 15:56 &middot; Поправил: Rascal <br><script type="text/javascript">QU('Rascal','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Rascal" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=10583.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
//Разрешим запись в эту страницу<br>VirtualProtect(pfnCurrent, sizeof(Buffer), PAGE_EXECUTE_READWRITE, &amp;dwDummy); <br><br>Если в чужом процессе хочешь открыть доступ для изменения, почему функция не VirtualProtectEx?<br>Если это длл, то зачем ваще WriteProcessMemory с ридом. проще через асм вставку. Синтаксис паленый. Я не уверен, что это компилится в натив код... И так и не понял что ты пишешь через WritePRocessMemory
<br><br><font size="1"><i>-----<br>Недостаточно только получить знания:надо найти им приложение</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=170212&amp;user=60&amp;forum_n=6&amp;topic=10583.html&amp;page=0&amp;anchor=2" class="addthx" data-post="170212"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]Hill[/b]','')">Hill</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 36.7 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.38'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=10104">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 ноября 2007 16:13 <br><script type="text/javascript">QU('Hill','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Hill" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=10583.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
писдетс.... спать надо больше! найди 10 ошибок и посмотри как система на них реагирует! <img src="img/smilies/s5.gif" alt=""> мда... тему можно смело в юмор...<br>2 Rascal:<br>прописывается что-то вроде jmp MyProc, изменить надо в родном процессе и перехватывать тоже в родном... Рид нужен чтобы потом все вернуть...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=170215&amp;user=10104&amp;forum_n=6&amp;topic=10583.html&amp;page=0&amp;anchor=3" class="addthx" data-post="170215"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]Rascal[/b]','')">Rascal</a></b><br></div>
<img src="img/s6.gif" alt=""><br><img style="padding-top:3px;" src="av/60.jpg" alt=""><br><span class=txtSm>Ранг: 260.9 (наставник)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.95'>Активность: 0.12<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=60">Участник</a><br><font color=blue>John Smith</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 ноября 2007 16:21 <br><script type="text/javascript">QU('Rascal','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Rascal" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=10583.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
асм вставки нерулят? протектить память не требуется при записи через WriteProcessMemory
<br><br><font size="1"><i>-----<br>Недостаточно только получить знания:надо найти им приложение</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=170217&amp;user=60&amp;forum_n=6&amp;topic=10583.html&amp;page=0&amp;anchor=4" class="addthx" data-post="170217"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]__[/b]','')">__</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 115.1 (ветеран), 3thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.73'>Активность: 0.07<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=7172">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 ноября 2007 16:25 <br><script type="text/javascript">QU('__','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=__" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=10583.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
<I>Rascal пишет:<br>протектить память не требуется при записи через WriteProcessMemory</I><br><br>сомнительное утверждение
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=170218&amp;user=7172&amp;forum_n=6&amp;topic=10583.html&amp;page=0&amp;anchor=5" class="addthx" data-post="170218"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]Ice-T[/b]','')">Ice-T</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/12329.jpg" alt=""><br><span class=txtSm>Ранг: 126.7 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.01'>Активность: 0.14<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=12329">Участник</a><br><font color=blue>#CCh</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 ноября 2007 16:31 &middot; Поправил: Ice-T <br><script type="text/javascript">QU('Ice-T','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Ice-T" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=10583.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
тоже прогнал сначала, но все же для записи в длл, протектить память надо...
<br><br><font size="1"><i>-----<br>invoke OpenFire</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=170220&amp;user=12329&amp;forum_n=6&amp;topic=10583.html&amp;page=0&amp;anchor=6" class="addthx" data-post="170220"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]Hill[/b]','')">Hill</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 36.7 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.38'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=10104">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 ноября 2007 16:44 <br><script type="text/javascript">QU('Hill','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Hill" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=10583.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
асм не рулит ибо говноменеджд код... либу грузит прилога писаная в С решетке.... просто через CreateRemoteThread не получилось, ибо кросс-поточность &quot;защищена&quot; значит выход один: ловить создание потока и запускать от имени текущего процесса а не удаленного...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=170221&amp;user=10104&amp;forum_n=6&amp;topic=10583.html&amp;page=0&amp;anchor=7" class="addthx" data-post="170221"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]Hellspawn[/b]','')">Hellspawn</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/72.gif" alt=""><br><span class=txtSm>Ранг: 990.2 <font color=red>(<b>! ! !</b>)</font>, 380thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.95'>Активность: 0.68<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=72">Модератор</a><br><font color=blue>Author of DiE</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 ноября 2007 16:56 &middot; Поправил: Hellspawn <br><script type="text/javascript">QU('Hellspawn','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Hellspawn" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=10583.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
<I>__ пишет:<br>сомнительное утверждение </I><br><br>почему это? раскал как раз прав...<br><code><br><b>WriteProcessMemory:</b><br>...<br>7C802238  |.  50                  PUSH EAX<br>7C802239  |.  57                  PUSH EDI<br>7C80223A  |.  895D FC             MOV [LOCAL.1],EBX<br>7C80223D  |.  FFD6                CALL ESI                                               ;  &lt;&amp;ntdll.NtProtectVirtualMemory&gt;<br>7C80223F  |.  3D 4E0000C0         CMP EAX,C000004E<br>7C802244  |.  74 5C               JE SHORT kernel32.7C8022A2<br><br><b>стек:</b><br><br>0096FE34  0000004C hProcess<br>0096FE38  0096FE54 lpAddress<br>0096FE3C  0096FE58 dwSize<br>0096FE40  00000040 flNewProtect (PAGE_EXECUTE_READWRITE = &#036;40;)<br>0096FE44  0096FE70 lpflOldProtect<br></code><br>я думаю комментарии излишни <img src="img/smilies/s1.gif" alt=""> <br>з.ы. Билли заботится о вас <img src="img/smilies/s5.gif" alt="">
<br><br><font size="1"><i>-----<br>[nice coder and reverser]</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=170224&amp;user=72&amp;forum_n=6&amp;topic=10583.html&amp;page=0&amp;anchor=8" class="addthx" data-post="170224"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]__[/b]','')">__</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 115.1 (ветеран), 3thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.73'>Активность: 0.07<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=7172">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 ноября 2007 17:07 <br><script type="text/javascript">QU('__','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=__" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=10583.html&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
<b>Hellspawn</b><br>у вас теоретические изыскания, у меня практические<br>много раз видел как WriteProcessMemory возвращает 0, а после VirtualProtect отрабатывает<br>нормально, причина меня не интересовала
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=170227&amp;user=7172&amp;forum_n=6&amp;topic=10583.html&amp;page=0&amp;anchor=9" class="addthx" data-post="170227"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]ValdikSS[/b]','')">ValdikSS</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 72.4 (постоянный), 33thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.15'>Активность: 0.05<span style='color:red'>&searr;</span>0.03</span><br>Статус: <a href="action=userinfo&amp;user=4827">Участник</a><br><font color=blue></font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 ноября 2007 17:59 <br><script type="text/javascript">QU('ValdikSS','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ValdikSS" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=10583.html&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
<I>__ пишет:<br>много раз видел как WriteProcessMemory возвращает 0, а после VirtualProtect отрабатывает </I><br>анологично
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=170235&amp;user=4827&amp;forum_n=6&amp;topic=10583.html&amp;page=0&amp;anchor=10" class="addthx" data-post="170235"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]Hellspawn[/b]','')">Hellspawn</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/72.gif" alt=""><br><span class=txtSm>Ранг: 990.2 <font color=red>(<b>! ! !</b>)</font>, 380thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.95'>Активность: 0.68<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=72">Модератор</a><br><font color=blue>Author of DiE</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 ноября 2007 18:07 <br><script type="text/javascript">QU('Hellspawn','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Hellspawn" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=10583.html&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
ниразу такого не встречал + к тому же в основном я пользуюсь ZwWriteVirtualMemory, чтобы <br>полность контролировать ситуацию <img src="img/smilies/s1.gif" alt="">
<br><br><font size="1"><i>-----<br>[nice coder and reverser]</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=170236&amp;user=72&amp;forum_n=6&amp;topic=10583.html&amp;page=0&amp;anchor=11" class="addthx" data-post="170236"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]Ice-T[/b]','')">Ice-T</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/12329.jpg" alt=""><br><span class=txtSm>Ранг: 126.7 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.01'>Активность: 0.14<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=12329">Участник</a><br><font color=blue>#CCh</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 ноября 2007 18:10 <br><script type="text/javascript">QU('Ice-T','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Ice-T" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=10583.html&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
потому что в VirtualProtect скорее всего юзаюцо еще какие-то функи, а не только ZwVirtualProtectMemory, которой не всегда видемо достаточно..
<br><br><font size="1"><i>-----<br>invoke OpenFire</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=170237&amp;user=12329&amp;forum_n=6&amp;topic=10583.html&amp;page=0&amp;anchor=12" class="addthx" data-post="170237"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]__[/b]','')">__</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 115.1 (ветеран), 3thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.73'>Активность: 0.07<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=7172">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 ноября 2007 18:24 <br><script type="text/javascript">QU('__','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=__" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=10583.html&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
это чтоб сомнения пропали<br>#include &lt;windows.h&gt;<br><br>#pragma comment(linker, &quot;/ENTRY:start&quot;)<br><br>#pragma comment(lib, &quot;kernel32.lib&quot;)<br>#pragma comment(lib, &quot;user32.lib&quot;)<br><br><br>void start()<br>{<br>    char    buff[4096] = {0};<br><br>    if ( WriteProcessMemory(GetCurrentProcess(), GetModuleHandle(NULL), buff, 4096, NULL) )<br>        MessageBox(NULL, &quot;Done!&quot;, NULL, MB_OK | MB_ICONINFORMATION);<br>    else<br>        MessageBox(NULL, &quot;An error occured&quot;, NULL, MB_OK | MB_ICONERROR);<br>    ExitProcess(0);<br>}
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=170239&amp;user=7172&amp;forum_n=6&amp;topic=10583.html&amp;page=0&amp;anchor=13" class="addthx" data-post="170239"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]Rascal[/b]','')">Rascal</a></b><br></div>
<img src="img/s6.gif" alt=""><br><img style="padding-top:3px;" src="av/60.jpg" alt=""><br><span class=txtSm>Ранг: 260.9 (наставник)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.95'>Активность: 0.12<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=60">Участник</a><br><font color=blue>John Smith</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 ноября 2007 18:34 &middot; Поправил: Rascal <br><script type="text/javascript">QU('Rascal','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Rascal" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=10583.html&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
Ну я так со своими процессами не изгалялся, а писал через асм вставки или через разыменовывание указателей. WriteProcessMemory юзал только для записи в чужие процессы - никаких проблем не было.
<br><br><font size="1"><i>-----<br>Недостаточно только получить знания:надо найти им приложение</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=170240&amp;user=60&amp;forum_n=6&amp;topic=10583.html&amp;page=0&amp;anchor=14" class="addthx" data-post="170240"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]__[/b]','')">__</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 115.1 (ветеран), 3thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.73'>Активность: 0.07<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=7172">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 ноября 2007 23:02 <br><script type="text/javascript">QU('__','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=__" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=10583.html&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
<I>Rascal пишет:<br>никаких проблем не было. </I><br><br>будут =) (с) &quot;операция Ы&quot;
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=170280&amp;user=7172&amp;forum_n=6&amp;topic=10583.html&amp;page=0&amp;anchor=15" class="addthx" data-post="170280"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]Error_Log[/b]','')">Error_Log</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 228.7 (наставник), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.05'>Активность: 0.12<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2060">Участник</a><br><font color=blue>malware research</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 ноября 2007 23:59 &middot; Поправил: Error_Log <br><script type="text/javascript">QU('Error_Log','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Error_Log" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=10583.html&amp;page=0#16');return false;">#16</a> </span><div align=left><br>
<I>Hill пишет:<br>изменить надо в родном процессе и перехватывать тоже в родном </I><br><br>1) Писать в своем процессе через WriteProcessMemory -- это жесть, для этого есть memcpy. <br>2) Чтобы задать права на запись --  VirtualProtect<br>3) В доке по WriteProcessMemory сказанно <br>&gt;&gt;The entire area to be written to must be accessible. Имхо accessible не значит PAGE_READWRITE, насчет VirtualProtect там молчек; правда я сам не проверял, может от DEBUG_PROCESS зависит.<br>4) Кстати sizeof(Buffer) - это размер указателя <img src="img/smilies/s5.gif" alt=""> если jmp - поставь 5
<br><br><font size="1"><i>-----<br>Research is my purpose</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=170299&amp;user=2060&amp;forum_n=6&amp;topic=10583.html&amp;page=0&amp;anchor=16" class="addthx" data-post="170299"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]Hill[/b]','')">Hill</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 36.7 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.38'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=10104">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 ноября 2007 07:56 <br><script type="text/javascript">QU('Hill','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Hill" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=10583.html&amp;page=0#17');return false;">#17</a> </span><div align=left><br>
2 Error_Log<br>Да я ошибки нашел почти сразу как только тему написал! Так что исправил... <br><I>Error_Log пишет:<br>1) Писать в своем процессе через WriteProcessMemory -- это жесть, для этого есть memcpy. </I><br>извините мне  WriteProcessMemory привычнее, хотя тут ты прав.<br><I>Error_Log пишет:<br>4) Кстати sizeof(Buffer) - это размер указателя  если jmp - поставь 5 </I><br>у мну нормально работат...<br>кстати косяк был не тут а тут:<br> <I>if (!WriteProcessMemory(hProcess, pfnCurrent,Buffer,sizeof(Buffer),(SIZE_T*) Writen)) </I><br>Хохотал долго...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=170339&amp;user=10104&amp;forum_n=6&amp;topic=10583.html&amp;page=0&amp;anchor=17" class="addthx" data-post="170339"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Перехват CreateThread API</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#18" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="6">
<input type="hidden" name="topic" value="10583">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=10583" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
