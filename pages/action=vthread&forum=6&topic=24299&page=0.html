<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>лоадер глючит на винхп - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="что я делаю и что происходит: 1. создаю целевой процесс с опцией CREATE_SUSPENDED 2. аллокаю там память (VirtualAllocEx) 3. пишу в полученную память мой код через WriteProcessMemory 4. выполняю DuplicateHandle для хэндла главного">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=40382'>jinoweb</a>, <a target='_blank' href='?action=userinfo&amp;user=26261'>bartolomeo</a> (+5 невидимых)</b></span>
</td>
</tr>
</table>

 

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> лоадер глючит на винхп</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]-=AkaBOSS=-[/b]','')">-=AkaBOSS=-</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/26242.png" alt=""><br><span class=txtSm>Ранг: 150.3 (ветеран), 175thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.88'>Активность: 0.16<span style='color:red'>&searr;</span>0.07</span><br>Статус: <a href="action=userinfo&amp;user=26242">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 сентября 2016 01:08 <br><script type="text/javascript">QU('-=AkaBOSS=-','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=-=AkaBOSS=-" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24299.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
что я делаю и что происходит:<br>1. создаю целевой процесс с опцией CREATE_SUSPENDED<br>2. аллокаю там память (VirtualAllocEx)<br>3. пишу в полученную память мой код через WriteProcessMemory<br>4. выполняю DuplicateHandle для хэндла главного треда в целевом процессе<br>5. создаю тред через CreateRemoteThread, в качестве аргумента - дублированный хэндл с предыдущего шага (мой код перед выходом размораживает основной поток)<br><br>что делает внедряемый код:<br>1. настраивает себе импорт<br>2. патчит-хукает то что нужно<br>3. отпускает основной поток через ResumeThread<br>4. закрывает хэндл потока (это уже добавил позднее, но положительного эффекта это не дало)<br>5. выходит через ExitThread<br><br>при выполнении кода лоадера и внедряемого кода никаких ошибок или исключений не происходит.<br>на других системах (начиная с вин2к3) вроде работает нормально.<br>глюки наблюдаются под винхп (может быть и под более ранними виндами тоже, но потребности в подобной совместимости я не испытываю)<br><br>размороженный основной поток или тихо завершается, или работает некорректно (в дельфи-прогах например не перерисовывается б0льшая часть контролов в окнах)<br>некоторые проги падают с эксепшенами, но причину установить так и не удалось.<br><br>и вот теперь собственно вопрос - WTF? кто-нибудь встречался с подобными ..особенностями?<br><br>в аттаче - лоадер для notepad.exe<br><br><img src="img/attach.gif" alt=""> <a href="./files/66da_05.09.2016_EXELAB.rU.tgz">66da_05.09.2016_EXELAB.rU.tgz</a> - loader.exe
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=367254&amp;user=26242&amp;forum_n=6&amp;topic=24299.html&amp;page=0&amp;anchor=1" class="addthx" data-post="367254"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]UniSoft[/b]','')">UniSoft</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/1288.png" alt=""><br><span class=txtSm>Ранг: 52.0 (постоянный), 146thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.41'>Активность: 0.03<span style='color:green'>&nearr;</span>0.08</span><br>Статус: <a href="action=userinfo&amp;user=1288">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 сентября 2016 09:39 &middot; Поправил: UniSoft <br><script type="text/javascript">QU('UniSoft','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=UniSoft" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24299.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
Да, я тоже с этим сталкивался. <br>Причину особо не искал, но где-то нагуливал, что типа CreateRemoteThread() каким-то образом повреждает контекст процесса (только под XP).<br>В результате просто заюзал QueueUserAPC(), с ней никаких глюков не наблюдалось.<br><br>ну как пример: (скопипастено с exetools)<br>(только я использовал VirtualAllocEx() и WriteProcessMemory())<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>DWORD</b></span>&nbsp;APCInject<span class="hl_char">(</span>PCHAR&nbsp;sProcName<span class="hl_char">,</span>PCHAR&nbsp;sDllName<span class="hl_char">)</span>{</li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;dRet<span class="hl_char">=</span><span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>define&nbsp;type&nbsp;<span class="hl_function"><b>and</b></span>&nbsp;pointer&nbsp;to&nbsp;function</li><li class="hl_l1">&nbsp;&nbsp;typedef&nbsp;NTSTATUS&nbsp;<span class="hl_char">(</span>WINAPI&nbsp;<span class="hl_char">*</span>tNtMapViewOfSection<span class="hl_char">)</span><span class="hl_char">(</span>HANDLE<span class="hl_char">,</span>HANDLE<span class="hl_char">,</span>LPVOID<span class="hl_char">,</span>ULONG<span class="hl_char">,</span>SIZE_T<span class="hl_char">,</span>LARGE_INTEGER<span class="hl_char">*</span><span class="hl_char">,</span>SIZE_T<span class="hl_char">*</span><span class="hl_char">,</span>SECTION_INHERIT<span class="hl_char">,</span>ULONG<span class="hl_char">,</span>ULONG<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;tNtMapViewOfSection&nbsp;NtMapViewOfSection<span class="hl_char">=</span><span class="hl_char">(</span>tNtMapViewOfSection<span class="hl_char">)</span>GetProcAddress<span class="hl_char">(</span>GetModuleHandle<span class="hl_char">(</span><span class="hl_quote">&quot;ntdll.dll&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span><span class="hl_quote">&quot;NtMapViewOfSection&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span><span class="hl_char">!</span>NtMapViewOfSection<span class="hl_char">)</span>return&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>create&nbsp;buffer</li><li class="hl_l1">&nbsp;&nbsp;HANDLE&nbsp;hFile<span class="hl_char">=</span>CreateFileMapping<span class="hl_char">(</span>INVALID_HANDLE_VALUE<span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">,</span>PAGE_READWRITE<span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span>strlen<span class="hl_char">(</span>sDllName<span class="hl_char">)</span><span class="hl_char">+</span><span class="hl_number">1</span><span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span><span class="hl_char">!</span>hFile<span class="hl_char">)</span>return&nbsp;<span class="hl_char">-</span><span class="hl_number">2</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;PCHAR&nbsp;hView<span class="hl_char">=</span>MapViewOfFile<span class="hl_char">(</span>hFile<span class="hl_char">,</span>FILE_MAP_ALL_ACCESS<span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span><span class="hl_char">!</span>hView<span class="hl_char">)</span>{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle<span class="hl_char">(</span>hFile<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_char">-</span><span class="hl_number">3</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;}else<span class="hl_char">/</span><span class="hl_char">/</span>set&nbsp;value&nbsp;to&nbsp;buffer</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;strcpy<span class="hl_char">(</span>hView<span class="hl_char">,</span>sDllName<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;Starting&nbsp;target&nbsp;process</li><li class="hl_l0">&nbsp;&nbsp;PROCESS_INFORMATION&nbsp;pi<span class="hl_comment">;STARTUPINFO st;</span></li><li class="hl_l1">&nbsp;&nbsp;ZeroMemory<span class="hl_char">(</span><span class="hl_char">&amp;</span>pi<span class="hl_char">,</span><span class="hl_function">sizeof</span><span class="hl_char">(</span>pi<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;ZeroMemory<span class="hl_char">(</span><span class="hl_char">&amp;</span>st<span class="hl_char">,</span><span class="hl_function">sizeof</span><span class="hl_char">(</span>st<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;st<span class="hl_char">.</span>cb<span class="hl_char">=</span><span class="hl_function">sizeof</span><span class="hl_char">(</span>STARTUPINFO<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>create&nbsp;suspended&nbsp;process</li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>CreateProcess<span class="hl_char">(</span>sProcName<span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">,</span><span class="hl_function">FALSE</span><span class="hl_char">,</span>CREATE_SUSPENDED<span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">,</span><span class="hl_char">&amp;</span>st<span class="hl_char">,</span><span class="hl_char">&amp;</span>pi<span class="hl_char">)</span><span class="hl_char">)</span>{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;LPVOID&nbsp;RemoteString<span class="hl_char">=</span><span class="hl_function"><b>NULL</b></span><span class="hl_comment">;ULONG ViewSize=0;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>NtMapViewOfSection<span class="hl_char">(</span>hFile<span class="hl_char">,</span>pi<span class="hl_char">.</span>hProcess<span class="hl_char">,</span><span class="hl_char">&amp;</span>RemoteString<span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">,</span><span class="hl_char">&amp;</span>ViewSize<span class="hl_char">,</span>ViewShare<span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span>PAGE_READONLY<span class="hl_char">)</span><span class="hl_char">=</span><span class="hl_char">=</span><span class="hl_number">0</span><span class="hl_char">)</span>{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LPVOID&nbsp;nLoadLibrary<span class="hl_char">=</span><span class="hl_char">(</span>LPVOID<span class="hl_char">)</span>GetProcAddress<span class="hl_char">(</span>GetModuleHandle<span class="hl_char">(</span><span class="hl_quote">&quot;kernel32.dll&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span><span class="hl_quote">&quot;LoadLibraryA&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span><span class="hl_char">!</span>QueueUserAPC<span class="hl_char">(</span><span class="hl_char">(</span>PAPCFUNC<span class="hl_char">)</span>nLoadLibrary<span class="hl_char">,</span>pi<span class="hl_char">.</span>hThread<span class="hl_char">,</span><span class="hl_char">(</span>ULONG_PTR<span class="hl_char">)</span>RemoteString<span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dRet<span class="hl_char">=</span><span class="hl_char">-</span><span class="hl_number">6</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;}else</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dRet<span class="hl_char">=</span><span class="hl_char">-</span><span class="hl_number">5</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;ResumeThread<span class="hl_char">(</span>pi<span class="hl_char">.</span>hThread<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle<span class="hl_char">(</span>pi<span class="hl_char">.</span>hThread<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle<span class="hl_char">(</span>pi<span class="hl_char">.</span>hProcess<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;}else</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;dRet<span class="hl_char">=</span><span class="hl_char">-</span><span class="hl_number">4</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;UnmapViewOfFile<span class="hl_char">(</span>hView<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;CloseHandle<span class="hl_char">(</span>hFile<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;return&nbsp;dRet<span class="hl_comment">;</span></li><li class="hl_l1">}</li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>int</b></span>&nbsp;main<span class="hl_char">(</span><span class="hl_function">void</span><span class="hl_char">)</span>{</li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;dwRet<span class="hl_char">=</span>APCInject<span class="hl_char">(</span><span class="hl_quote">&quot;C:\Games\Counter-Strike\hl.exe&quot;</span><span class="hl_char">,</span><span class="hl_quote">&quot;C:\cheat.dll&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span><span class="hl_char">!</span>dwRet<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;puts<span class="hl_char">(</span><span class="hl_quote">&quot;Injection Ok!&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function">else</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;printf<span class="hl_char">(</span><span class="hl_quote">&quot;Injection fail -&gt; %d!&quot;</span><span class="hl_char">,</span>dwRet<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;system<span class="hl_char">(</span><span class="hl_quote">&quot;pause&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;return&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l1">}</li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=367262&amp;user=1288&amp;forum_n=6&amp;topic=24299.html&amp;page=0&amp;anchor=2" class="addthx" data-post="367262"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=26242" title="05-09-2016 21:15, ранг:102.4" target="_blank">-=AkaBOSS=-</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]dosprog[/b]','')">dosprog</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 431.7 (мудрец), 390thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.95'>Активность: 0.73<span style='color:red'>&searr;</span>0.32</span><br>Статус: <a href="action=userinfo&amp;user=35473">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 сентября 2016 20:26 &middot; Поправил: dosprog <br><script type="text/javascript">QU('dosprog','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=dosprog" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24299.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
<I>-=AkaBOSS=- пишет:<br>в аттаче - лоадер для notepad.exe<br> </I><br><br>Нормально отрабатывает, запускает нотепад.<br>В чём должно проявляться, что инжект отработал без ошибок?<br><i class=x><br></i>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=367275&amp;user=35473&amp;forum_n=6&amp;topic=24299.html&amp;page=0&amp;anchor=3" class="addthx" data-post="367275"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]Jaa[/b]','')">Jaa</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 134.1 (ветеран), 246thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.52'>Активность: 0.22<span style='color:red'>&searr;</span>0.1</span><br>Статус: <a href="action=userinfo&amp;user=33657">Участник</a><br><font color=blue>realist</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 сентября 2016 20:46 <br><script type="text/javascript">QU('Jaa','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Jaa" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24299.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
<I>dosprog пишет:<br>Нормально отрабатывает, запускает нотепад.<br>В чём должно проявляться, что инжект отработал без ошибок? </I><br><br><I>-=AkaBOSS=- пишет:<br>при выполнении кода лоадера и внедряемого кода никаких ошибок или исключений не происходит.<br>на других системах (начиная с вин2к3) вроде работает нормально.<br>глюки наблюдаются под винхп (может быть и под более ранними виндами тоже, но потребности в подобной совместимости я не испытываю)<br><br>размороженный основной поток или тихо завершается, или работает некорректно (в дельфи-прогах например не перерисовывается б0льшая часть контролов в окнах)<br>некоторые проги падают с эксепшенами, но причину установить так и не удалось. </I>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=367277&amp;user=33657&amp;forum_n=6&amp;topic=24299.html&amp;page=0&amp;anchor=4" class="addthx" data-post="367277"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]dosprog[/b]','')">dosprog</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 431.7 (мудрец), 390thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.95'>Активность: 0.73<span style='color:red'>&searr;</span>0.32</span><br>Статус: <a href="action=userinfo&amp;user=35473">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 сентября 2016 21:13 &middot; Поправил: dosprog <br><script type="text/javascript">QU('dosprog','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=dosprog" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24299.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
<I>Jaa пишет:<br>-=AkaBOSS=- пишет:<br>глюки наблюдаются под винхп </I><br><br>Так под WinXP и запускалось. <br>Нотепад работает нормально. А вот инжект отработал или нет не проверял.<br>Потому и вопрос, чем занимается в данном случае инжектированный код.<br><i class=x><br></i>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=367279&amp;user=35473&amp;forum_n=6&amp;topic=24299.html&amp;page=0&amp;anchor=5" class="addthx" data-post="367279"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]ajax[/b]','')">ajax</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/8830.gif" alt=""><br><span class=txtSm>Ранг: 337.6 (мудрец), 224thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.53'>Активность: 0.21<span style='color:red'>&searr;</span>0.1</span><br>Статус: <a href="action=userinfo&amp;user=8830">Участник</a><br><font color=blue>born to be evil</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 сентября 2016 21:58 &middot; Поправил: ajax <br><script type="text/javascript">QU('ajax','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ajax" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24299.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
<I>-=AkaBOSS=- пишет:<br>выполняю DuplicateHandle для хэндла главного треда в целевом процессе </I><br>нафик? процесс свой, код минимальный, че дуплицировать? если все более обширно - сами, гадать нет смысла
<br><br><font size="1"><i>-----<br>От многой мудрости много скорби, и умножающий знание умножает печаль</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=367282&amp;user=8830&amp;forum_n=6&amp;topic=24299.html&amp;page=0&amp;anchor=6" class="addthx" data-post="367282"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]-=AkaBOSS=-[/b]','')">-=AkaBOSS=-</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/26242.png" alt=""><br><span class=txtSm>Ранг: 150.3 (ветеран), 175thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.88'>Активность: 0.16<span style='color:red'>&searr;</span>0.07</span><br>Статус: <a href="action=userinfo&amp;user=26242">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 06 сентября 2016 00:30 <br><script type="text/javascript">QU('-=AkaBOSS=-','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=-=AkaBOSS=-" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24299.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
<I>UniSoft пишет:<br>типа CreateRemoteThread() каким-то образом повреждает контекст процесса (только под XP). </I><br>но если создавать тред в <b>не</b> замороженном процессе - всё нормально<br><br><br><I>UniSoft пишет:<br>В результате просто заюзал QueueUserAPC(), с ней никаких глюков не наблюдалось. </I><br>спасибо, попробую такой вариант<br><br><br><I>dosprog пишет:<br>Нормально отрабатывает, запускает нотепад.<br>В чём должно проявляться, что инжект отработал без ошибок? </I><br>в тестовом варианте никаких патчей/хуков не ставится.<br>если блокнот запустился - значит мой код отработал правильно, так как раморозка главного потока выполняется именно внедрённым кодом.<br>это странно, так как у меня на тестовой хп сп3 процесс размораживается и умирает даже не показав окно (но под отладчиком работает ровно, поэтому найти причину не получилось)<br><br><I>ajax пишет:<br>процесс свой, код минимальный, че дуплицировать? </I><br>для 100% уверенности, что все хуки/патчи будут установлены вовремя - основной поток целевого процесса размораживается инжектированным кодом (не люблю я на таймеры полагаться)<br>для этого я и дублирую хэндл оттуда где он есть и передаю его в инжект<br><br><br><b>dosprog</b><br>на каком сервиспаке проверялось? винда случаем не х64?<br><br><b>Добавлено спустя 1 час 17 минут</b><br>вопрос насчёт QueueUserAPC.<br>просто хочу убедиться что правильно понимаю что оно делает.<br>адрес который я укажу получит управление и будет выполняться за счёт процессорного времени указанного треда.<br>и пока моя процедура не вернёт управление, код треда выполняться не будет совсем.<br>это правильно?<br><br>нужно ли вставлять какую-то задержку между QueueUserAPC и ResumeThread?<br>просто для уверенности, что поток не разморозится раньше чем к нему будет подвешен APC.<br><br>нужно ли заботиться о сохранении регистров и значений в стэке?<br>в смысле - могу ли я случайно испортить контекст тому треду, к которому прицепился?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=367284&amp;user=26242&amp;forum_n=6&amp;topic=24299.html&amp;page=0&amp;anchor=7" class="addthx" data-post="367284"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=26773" title="10-09-2016 00:46, ранг:9.6" target="_blank">Dynamic</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]dosprog[/b]','')">dosprog</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 431.7 (мудрец), 390thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.95'>Активность: 0.73<span style='color:red'>&searr;</span>0.32</span><br>Статус: <a href="action=userinfo&amp;user=35473">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 06 сентября 2016 06:03 &middot; Поправил: dosprog <br><script type="text/javascript">QU('dosprog','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=dosprog" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24299.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
<I>-=AkaBOSS=- пишет:<br>на каком сервиспаке проверялось? винда случаем не х64? </I><br><br>SP2/x32<br><br>Это, кстати, очередной пример случая, когда SP3 уже не устраивает.<br><br>Ну, или наоборот, если требуется тестировать софт на всей линейке систем.<br><i class=x><br></i>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=367287&amp;user=35473&amp;forum_n=6&amp;topic=24299.html&amp;page=0&amp;anchor=8" class="addthx" data-post="367287"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=26242" title="07-09-2016 00:05, ранг:103.4" target="_blank">-=AkaBOSS=-</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 338.5 (мудрец), 349thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 октября 2016 06:27 &middot; Поправил: difexacaw <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24299.html&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
В GetProcAddress() передаётся не корректное значение. Проблема не с запуском потока, это кривой кодес инжектится.<br><br>&gt; могу ли я случайно испортить контекст тому треду, к которому прицепился?<br><br>При доставке апк контекст сохраняется, но часть его будет утеряна(статусный регистр). Доставка апк мало где используется, поток должен войти в алертабельное ожидание. Загрузчик очищает очередь апк, доставляя все сообщения перед переходом на стартап код. При этом возвращаемый статус значения не имеет.
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=368452&amp;user=40990&amp;forum_n=6&amp;topic=24299.html&amp;page=0&amp;anchor=9" class="addthx" data-post="368452"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]-=AkaBOSS=-[/b]','')">-=AkaBOSS=-</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/26242.png" alt=""><br><span class=txtSm>Ранг: 150.3 (ветеран), 175thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.88'>Активность: 0.16<span style='color:red'>&searr;</span>0.07</span><br>Статус: <a href="action=userinfo&amp;user=26242">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 октября 2016 02:19 <br><script type="text/javascript">QU('-=AkaBOSS=-','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=-=AkaBOSS=-" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24299.html&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
<I>difexacaw пишет:<br>В GetProcAddress() передаётся не корректное значение </I><br>Мне под отладчиком не видно (им если цепляться, то всё нормально работать будет).<br>Могу я попросить показать конкретные данные?<br><br>Предполагаю, что какой-то hModule мог быть не получен. Я их ищу, разбирая PEB_LDR_DATA.InLoadOrderModuleList. На тестовой системе зациклил код инжекта и прошёлся по структурам - вроде всё в порядке, DllBase везде присутствует.<br><br>С чем там еще можно было накосячить? Указатель на имя функции? Дык ну если я свою же таблицу криво разбираю, оно бы тогда везде глючило.<br><br><br><I>difexacaw пишет:<br>Проблема не с запуском потока, это кривой кодес инжектится. </I><br>Этот &quot;кривой кодес&quot; <u>работает</u> на всех системах, кроме хпсп3. <br>А после переделки на QueueUserAPC, это кривой кодес стал работать еще и там.<br>Так что проблема если и есть, то только в конкретной системе, для которой надо придумать workaround.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=368484&amp;user=26242&amp;forum_n=6&amp;topic=24299.html&amp;page=0&amp;anchor=10" class="addthx" data-post="368484"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 338.5 (мудрец), 349thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 октября 2016 19:49 <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24299.html&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
<b>-=AkaBOSS=-</b><br><br>У меня есть очередь задач, которые нужно решить. Суть проблемы я вам описал, у вас есть код ну а мне незачем копаться в дизасме, дальше сами. В GPA() передаётся мусор. Как и почему это уже не суть важно.
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=368495&amp;user=40990&amp;forum_n=6&amp;topic=24299.html&amp;page=0&amp;anchor=11" class="addthx" data-post="368495"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]-=AkaBOSS=-[/b]','')">-=AkaBOSS=-</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/26242.png" alt=""><br><span class=txtSm>Ранг: 150.3 (ветеран), 175thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.88'>Активность: 0.16<span style='color:red'>&searr;</span>0.07</span><br>Статус: <a href="action=userinfo&amp;user=26242">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 октября 2016 20:36 <br><script type="text/javascript">QU('-=AkaBOSS=-','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=-=AkaBOSS=-" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24299.html&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
<I>difexacaw пишет:<br>У меня есть очередь задач, которые нужно решить. </I><br>Как странно. Вы нашли время, чтобы откопать этот топик месячной давности и нашли врамя чтобы отследить и указать мне, что <I>В GPA() передаётся мусор </I><br>Но при этом, несмотря на выраженные мною контраргументы, времени предоставить какие-либо доказательства у Вас уже нет. А стоило ли тогда тратить это самое время на столь бесполезный комментарий?<br><br>Я продолжаю оставаться при мнении, что мой код не содержит ошибок, приводящих к аварийному завершению приложения. Так как в некоторых случаях (в частности - дельфи) целевой модуль всё-таки запускается, но формы работают некорректно. Если в GPA будет передан мусор, я в самом худшем случае получу NULL  в ответ, и благополучно к нему обращусь, вызван тем самым исключение.<br><br>.<I>difexacaw пишет:<br>Как и почему это уже не суть важно.  </I><br>Как раз это и важно, учитывая что код не работает только на конкретной системе, успешно справляясь с запрограммированной задачей в остальных случаях.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=368500&amp;user=26242&amp;forum_n=6&amp;topic=24299.html&amp;page=0&amp;anchor=12" class="addthx" data-post="368500"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 221thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 октября 2016 22:48 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24299.html&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
Припоминаю, что под XP SP3 у меня были ранее попытки инжектить dll на старте процесса. Когда процесс в состоянии SUSPENDED, он не инициализирован нормально, от того и проходить по списку dll бесполезно. Выходом было подмена EP процесса на адрес внедрённого кода. Структура CONTEXT процесса в спящем состоянии сохраняет EP в регистре Eax (на x64 - Rcx)...<br><br>Вызов LoadLibrary не считаю корректным до окончания инициализации процесса.
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=368505&amp;user=24257&amp;forum_n=6&amp;topic=24299.html&amp;page=0&amp;anchor=13" class="addthx" data-post="368505"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]-=AkaBOSS=-[/b]','')">-=AkaBOSS=-</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/26242.png" alt=""><br><span class=txtSm>Ранг: 150.3 (ветеран), 175thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.88'>Активность: 0.16<span style='color:red'>&searr;</span>0.07</span><br>Статус: <a href="action=userinfo&amp;user=26242">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 октября 2016 05:15 &middot; Поправил: -=AkaBOSS=- <br><script type="text/javascript">QU('-=AkaBOSS=-','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=-=AkaBOSS=-" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24299.html&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
<I>DenCoder пишет:<br>проходить по списку dll бесполезно </I><br>Почему? Список есть, все необходимые длл загружены и инициализированы, у них настроен импорт. Что тут не так?<br><br><I>DenCoder пишет:<br>Вызов LoadLibrary не считаю корректным до окончания инициализации процесса </I><br>А разве ThreadRoutine может вообще получить управление до окончания инициализации процесса?<br>И когда же происходит эта самая инициализация в таком случае?<br>Процесс ведь это всего лишь выделенная область памяти, когда он создан - он создан.<br>Загружается основной модуль и его зависимости, а что еще нужно? <br>Работой ведь занимается поток. Главный или инжектированный - какая разница? При разморозке любого из них должны и будут произведены соответствующие вызовы DllMain, и инициализация загруженных модулей будет завершена.<br><br>Я еще раз подчёркиваю - глюк наблюдается исключительно  на конкретном сервиспаке конкретной операционки. <br><br>Ну ладно, на минутку <u>допустим</u>, что проблема в моём &quot;кривом кодесе&quot; (хотя внятных доказательств этой теории так и не было предоставлено). Написал другую версию, полный код инжекта которой выглядит так<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_comment">; return 0</span></li><li class="hl_l1"><span class="hl_function"><b>xor</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l0"><span class="hl_function"><b>ret</b></span>&nbsp;<span class="hl_number">4</span></li>        </ol>
    </div>
</div></div>
<br>Основной поток отпускается с задержкой в секунду.<br>Скомпилил, запустил - на моей оси блокнот работает, под винхп молча закрывается. <br>Тестовый модуль: <br><br><br><img src="img/attach.gif" alt=""> <a href="./files/e08e_11.10.2016_EXELAB.rU.tgz">e08e_11.10.2016_EXELAB.rU.tgz</a> - LOADER3.exe
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=368508&amp;user=26242&amp;forum_n=6&amp;topic=24299.html&amp;page=0&amp;anchor=14" class="addthx" data-post="368508"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 338.5 (мудрец), 349thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 октября 2016 06:20 &middot; Поправил: difexacaw <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24299.html&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
<b>-=AkaBOSS=-</b><br><br>Запилил вам видос с последним вашим семплом и там не xor/ret <img src="img/smilies/s13.gif" alt=""><br><br><noindex><a href="https://yadi.sk/i/BQUkJKO9wcgkK" rel="nofollow" target="_blank">--&gt; Link &lt;--</a></noindex><br><br>#12 - смысл был в том, что мне незачем тратить время на разбор кривого пайлода без сурцов.
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=368509&amp;user=40990&amp;forum_n=6&amp;topic=24299.html&amp;page=0&amp;anchor=15" class="addthx" data-post="368509"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=26242" title="11-10-2016 03:56, ранг:110.2" target="_blank">-=AkaBOSS=-</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]-=AkaBOSS=-[/b]','')">-=AkaBOSS=-</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/26242.png" alt=""><br><span class=txtSm>Ранг: 150.3 (ветеран), 175thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.88'>Активность: 0.16<span style='color:red'>&searr;</span>0.07</span><br>Статус: <a href="action=userinfo&amp;user=26242">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 октября 2016 06:56 <br><script type="text/javascript">QU('-=AkaBOSS=-','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=-=AkaBOSS=-" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24299.html&amp;page=0#16');return false;">#16</a> </span><div align=left><br>
<I>difexacaw пишет:<br>Запилил вам видос с последним вашим семплом и там не xor/ret  </I><br>там не xor/ret потому, что на видео лоадер из шапки темы, а не из #14<br><br><I>difexacaw пишет:<br>мне незачем тратить время на разбор кривого пайлода без сурцов </I><br>Я просил его не разбирать, а всего лишь показать мусор, который Вы там увидели.<br>Скриншота с остановкой на том самом вызове GetProcAddress мне бы хватило.<br>В тестовом коде получаются всего три импортируемых функции - CloseHandle, ExitThread и ResumeThread.<br>На видео ошибка уже по факту, после того как отладчиком код отпущен.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=368510&amp;user=26242&amp;forum_n=6&amp;topic=24299.html&amp;page=0&amp;anchor=16" class="addthx" data-post="368510"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]Hellspawn[/b]','')">Hellspawn</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/72.gif" alt=""><br><span class=txtSm>Ранг: 990.2 <font color=red>(<b>! ! !</b>)</font>, 380thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.95'>Активность: 0.68<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=72">Модератор</a><br><font color=blue>Author of DiE</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 октября 2016 14:40 <br><script type="text/javascript">QU('Hellspawn','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Hellspawn" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24299.html&amp;page=0#17');return false;">#17</a> </span><div align=left><br>
<b>-=AkaBOSS=-</b><br><br>а отладить не? вот тут блокнот фэйлит:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_number">0100473D</span>&nbsp;&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">53</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;<span class="hl_registr"><b>EBX</b></span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; /lParam</span></li><li class="hl_l1"><span class="hl_number">0100473E</span>&nbsp;&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;FF75&nbsp;AC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_function"><b>PTR</b></span>&nbsp;<span class="hl_registr">SS</span><span class="hl_char">:</span><span class="hl_char">[</span><span class="hl_registr">EBP</span><span class="hl_char">-</span><span class="hl_number">54</span><span class="hl_char">]</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; |hInst</span></li><li class="hl_l0"><span class="hl_number">01004741</span>&nbsp;&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">83C0</span>&nbsp;<span class="hl_number">9C</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>ADD</b></span>&nbsp;<span class="hl_registr">EAX</span><span class="hl_char">,</span><span class="hl_char">-</span><span class="hl_number">64</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; |</span></li><li class="hl_l1"><span class="hl_number">01004744</span>&nbsp;&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">6A</span>&nbsp;<span class="hl_number">0F</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;<span class="hl_number">0F</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; |hMenu = 0000000F</span></li><li class="hl_l0"><span class="hl_number">01004746</span>&nbsp;&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;FF35&nbsp;<span class="hl_number">30980001</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_function"><b>PTR</b></span>&nbsp;<span class="hl_registr">DS</span><span class="hl_char">:</span><span class="hl_char">[</span><span class="hl_number">1009830</span><span class="hl_char">]</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; |hParent = 002301E8 (class='Notepad')</span></li><li class="hl_l1"><span class="hl_number">0100474C</span>&nbsp;&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;<span class="hl_registr"><b>EAX</b></span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; |Height</span></li><li class="hl_l0"><span class="hl_number">0100474D</span>&nbsp;&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;FF75&nbsp;<span class="hl_number">8C</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_function"><b>PTR</b></span>&nbsp;<span class="hl_registr">SS</span><span class="hl_char">:</span><span class="hl_char">[</span><span class="hl_registr">EBP</span><span class="hl_char">-</span><span class="hl_number">74</span><span class="hl_char">]</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; |Width</span></li><li class="hl_l1"><span class="hl_number">01004750</span>&nbsp;&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;A1&nbsp;<span class="hl_number">50980001</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>MOV</b></span>&nbsp;<span class="hl_registr">EAX</span><span class="hl_char">,</span><span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_function"><b>PTR</b></span>&nbsp;<span class="hl_registr">DS</span><span class="hl_char">:</span><span class="hl_char">[</span><span class="hl_number">1009850</span><span class="hl_char">]</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; |</span></li><li class="hl_l0"><span class="hl_number">01004755</span>&nbsp;&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;F7D8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>NEG</b></span>&nbsp;<span class="hl_registr"><b>EAX</b></span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; |</span></li><li class="hl_l1"><span class="hl_number">01004757</span>&nbsp;&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">53</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;<span class="hl_registr"><b>EBX</b></span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; |Y</span></li><li class="hl_l0"><span class="hl_number">01004758</span>&nbsp;&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">1BC0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>SBB</b></span>&nbsp;<span class="hl_registr">EAX</span><span class="hl_char">,</span><span class="hl_registr"><b>EAX</b></span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; |</span></li><li class="hl_l1"><span class="hl_number">0100475A</span>&nbsp;&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">53</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;<span class="hl_registr"><b>EBX</b></span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; |X</span></li><li class="hl_l0"><span class="hl_number">0100475B</span>&nbsp;&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">25</span>&nbsp;<span class="hl_number">0000F0FF</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>AND</b></span>&nbsp;<span class="hl_registr">EAX</span><span class="hl_char">,</span><span style="word-break: break-all">FFF00000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; |</span></li><li class="hl_l1"><span class="hl_number">01004760</span>&nbsp;&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">05</span>&nbsp;<span class="hl_number">04013050</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>ADD</b></span>&nbsp;<span class="hl_registr">EAX</span><span class="hl_char">,</span><span class="hl_number">50300104</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; |</span></li><li class="hl_l0"><span class="hl_number">01004765</span>&nbsp;&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;<span class="hl_registr"><b>EAX</b></span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; |Style</span></li><li class="hl_l1"><span class="hl_number">01004766</span>&nbsp;&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">56</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;<span class="hl_registr"><b>ESI</b></span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; |WindowName</span></li><li class="hl_l0"><span class="hl_number">01004767</span>&nbsp;&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">68</span>&nbsp;<span class="hl_number">94170001</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;notepad<span class="hl_char">.</span><span class="hl_number">01001794</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; |Class = &quot;Edit&quot;</span></li><li class="hl_l1"><span class="hl_number">0100476C</span>&nbsp;&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">68</span>&nbsp;<span class="hl_number">00020000</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;<span class="hl_number">200</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; |ExtStyle = WS_EX_CLIENTEDGE</span></li><li class="hl_l0"><span class="hl_number">01004771</span>&nbsp;&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;FF15&nbsp;E0110001&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>CALL</b></span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_function"><b>PTR</b></span>&nbsp;<span class="hl_registr">DS</span><span class="hl_char">:</span><span class="hl_char">[</span><span class="hl_char">&lt;</span><span class="hl_char">&amp;</span>USER32<span class="hl_char">.</span>CreateWindowExW<span class="hl_char">&gt;</span><span class="hl_char">]</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; \CreateWindowExW</span></li>        </ol>
    </div>
</div></div>
<br>почему? не совсем ясно, что-то из-за инициализации видимо, т.к. когда поток создается удаленный,<br>процесс инициализируется в этот момент, видно в Process Explorer. Разбирайтесь сами.<br>p.s. это не баг, это фича.<br><br><I>-=AkaBOSS=- пишет:<br>Вызов LoadLibrary не считаю корректным до окончания инициализации процесса  </I><br>микрософт прямо запрещает так делать, опасность дедлоков, вот тут все есть<br><br>https://msdn.microsoft.com/en-us/library/windows/desktop/ms682437(v=vs.85).aspx
<br><br><font size="1"><i>-----<br>[nice coder and reverser]</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=368516&amp;user=72&amp;forum_n=6&amp;topic=24299.html&amp;page=0&amp;anchor=17" class="addthx" data-post="368516"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=24257" title="11-10-2016 11:59, ранг:241.3" target="_blank">DenCoder</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 221thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 октября 2016 15:18 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24299.html&amp;page=0#18');return false;">#18</a> </span><div align=left><br>
(В первом абазаце мог немного ошибиться, поскольку выдаю всё по памяти)<br><I>-=AkaBOSS=- пишет:<br>Почему? Список есть, все необходимые длл загружены и инициализированы, у них настроен импорт. Что тут не так? </I><br>Инициализация процесса происходит посредством APC до момента, когда стартует основной тред. В PEB_LDR_DATA должно быть 3 списка модулей с различной сортировкой: по порядку загрузки InLoadOrderModuleList,  по базе InMemoryOrderModuleList, по порядку инициализации InInitializationOrderModuleList. Самое интересное - PEB_LDR_DATA.Initialized ты не проверяешь. Так вот до того, как APC инициализации отработает, в 2х списках 2 dll на XPSP3 - kernel32 и ntdll, но последнего списка нет! Загруженные либы не инциализированы, переменные их ещё не настроены, значит пользоваться ещё нельзя.<br><br><I>-=AkaBOSS=- пишет:<br>А разве ThreadRoutine может вообще получить управление до окончания инициализации процесса? </I><br>Сторонний тред - да, может быть запущен до того, как APC инициализации отработает. Не разбирался в различных сервис паках, но видимо это и есть отличие работы XPSP3 от других. Припоминаю, что на SP2 ещё отлично подгружалась либа в спящем процессе, а на SP3 приходилось исследовать, в чём дело.<br><br><b>Добавлено спустя 6 минут</b><br>А успешность трюка с заменой ThreadRoutine на APC состоит в том, что APC доставляется после того, как APC инициализации отрабатывает. Поскольку юзерские APC только по очереди могут работать.
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=368517&amp;user=24257&amp;forum_n=6&amp;topic=24299.html&amp;page=0&amp;anchor=18" class="addthx" data-post="368517"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 338.5 (мудрец), 349thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 октября 2016 16:48 &middot; Поправил: difexacaw <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24299.html&amp;page=0#19');return false;">#19</a> </span><div align=left><br>
<b>-=AkaBOSS=-</b><br><br>Не из шапки, там другой вроде бы был, ошибка там была с GPA. Тот что я последний тестил не валится непосредственно, там если отпустить потоки пошаговый останов из за трейса, это из за отладчика(можно добавить в обработку отладчиком). Посмотрю есчо #14, может не то скачал.<br><br><b>DenCoder</b><br><br>Инициализация асинхронна, для этого и доставляется апк, она первая всегда и загрузочная. Из неё будет инит лодера, а затем загрузка контекста и переход на стартап адрес треда. То же самое даст и метод с апк - она будет доставлена по окончанию инит лодера, но ранее загрузки контекста.<br><br><b>Добавлено спустя 1 час 51 минуту</b><br>Посмотрел, в первом семпле ошибка была из за EMET, он рубит такие инжекты(поэтому и ошибка была в GPA наверно). Семпл из #14 не заводится, возвращается ошибка при инициализации гуя:<br><br>CreateWindow() -&gt; ... GPA(COMCTL32.RegisterClassName) -&gt; Fail<br><br>Откуда там такой вызов появляется хз, это нужно гуй дебажить.
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=368520&amp;user=40990&amp;forum_n=6&amp;topic=24299.html&amp;page=0&amp;anchor=19" class="addthx" data-post="368520"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="20" onfocus="this.blur()" href="JavaScript:di('[b]-=AkaBOSS=-[/b]','')">-=AkaBOSS=-</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/26242.png" alt=""><br><span class=txtSm>Ранг: 150.3 (ветеран), 175thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.88'>Активность: 0.16<span style='color:red'>&searr;</span>0.07</span><br>Статус: <a href="action=userinfo&amp;user=26242">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 октября 2016 18:52 <br><script type="text/javascript">QU('-=AkaBOSS=-','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=-=AkaBOSS=-" target="_blank">Личное сообщение</a> &middot;  <a href="#20" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24299.html&amp;page=0#20');return false;">#20</a> </span><div align=left><br>
<I>DenCoder пишет:<br>Самое интересное - PEB_LDR_DATA.Initialized ты не проверяешь. </I><br>Только что зациклил свой тред и посмотрел - PEB_LDR_DATA.Initialized = 0х01<br>Я как бы не ожидаю там ничего другого, поэтому в коде проверок и не делал.<br><br><I>DenCoder пишет:<br>но последнего списка нет! Загруженные либы не инциализированы, переменные их ещё не настроены, значит пользоваться ещё нельзя. </I><br>Все три списка заполнены. Нет разницы - сторонний тред или основной, DllMain модулей всё равно получит управление до ThreadRoutine. В вышеупомянутом мсдн так прямо и написано <br><i class=x>It results in a call to the entry point of each DLL in the process.</i><br><br><br><I>Hellspawn пишет:<br>микрософт прямо запрещает так делать, опасность дедлоков</I><br>Вы об этом? <i class=x>application can deadlock if the thread attempts to obtain ownership of locks that another thread is using</i><br>Мне кажется, что замороженному потоку, который еще не запускался, таким образом навредить не удастся.<br><br><br><I>difexacaw пишет:<br>Не из шапки, там другой вроде бы был, ошибка там была с GPA </I><br>Ну что я, свой код не узнаю что ли? <img src="img/smilies/s6.gif" alt=""><br>На видео лоадер из шапки. А ошибку с GPA Вы, видимо, вообще не в моём лоадере нашли.<br><br><br>Давайте перестанем критиковать LoadLibrary, так как она фактически и не загружает ничего - просто берет базу кернел32. Специально для этого в посте #14 я выложил лоадер с return 0, без всяких вымудрёных загрузок. Но он по прежнему вызывает падение приложения.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=368528&amp;user=26242&amp;forum_n=6&amp;topic=24299.html&amp;page=0&amp;anchor=20" class="addthx" data-post="368528"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="21" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 338.5 (мудрец), 349thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 октября 2016 19:15 <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#21" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24299.html&amp;page=0#21');return false;">#21</a> </span><div align=left><br>
<b>-=AkaBOSS=-</b><br><br>Вот пруф если не верите сами попробуйте подебажить. Про ошибку с гпа на вашем первом семпле я уже выше написал что это емет был.<br><br><noindex><a href="https://yadi.sk/i/SyA5HLz-weuC8" rel="nofollow" target="_blank">--&gt; Link &lt;--</a></noindex>
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=368529&amp;user=40990&amp;forum_n=6&amp;topic=24299.html&amp;page=0&amp;anchor=21" class="addthx" data-post="368529"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="22" onfocus="this.blur()" href="JavaScript:di('[b]Hellspawn[/b]','')">Hellspawn</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/72.gif" alt=""><br><span class=txtSm>Ранг: 990.2 <font color=red>(<b>! ! !</b>)</font>, 380thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.95'>Активность: 0.68<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=72">Модератор</a><br><font color=blue>Author of DiE</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 октября 2016 19:24 <br><script type="text/javascript">QU('Hellspawn','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Hellspawn" target="_blank">Личное сообщение</a> &middot;  <a href="#22" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24299.html&amp;page=0#22');return false;">#22</a> </span><div align=left><br>
<b>-=AkaBOSS=-</b> а по факту имеет место быть повреждение <img src="img/smilies/s1.gif" alt=""> я указал место где падает блокнот, разбирайтесь.<br>скорее всего если заменить CreateRemoteThread на RtlCreateUserThread, все отработает как надо.
<br><br><font size="1"><i>-----<br>[nice coder and reverser]</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=368530&amp;user=72&amp;forum_n=6&amp;topic=24299.html&amp;page=0&amp;anchor=22" class="addthx" data-post="368530"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="23" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 338.5 (мудрец), 349thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 октября 2016 19:35 <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#23" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24299.html&amp;page=0#23');return false;">#23</a> </span><div align=left><br>
<b>Hellspawn</b><br><br>Я первым делом туда либо инжектнул с ловушкой на фолты, их нет. Ну и в семпле там есчо задержка 1с.
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=368531&amp;user=40990&amp;forum_n=6&amp;topic=24299.html&amp;page=0&amp;anchor=23" class="addthx" data-post="368531"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="24" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 221thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 октября 2016 20:13 <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#24" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24299.html&amp;page=0#24');return false;">#24</a> </span><div align=left><br>
<b>-=AkaBOSS=-</b><br>Да... не помню точно, как там обстоят дела, но давно использую этот код для инжектов<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>BYTE</b></span>&nbsp;pCode<span class="hl_char">[</span><span class="hl_char">]</span>&nbsp;<span class="hl_char">=</span></li><li class="hl_l1">{</li><li class="hl_l0"><span class="hl_char">/</span><span class="hl_char">/</span>Some&nbsp;<span class="hl_function">code</span></li><li class="hl_l1"><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span></li><li class="hl_l0"><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_function"><b>code</b></span>&nbsp;for&nbsp;synchronization&nbsp;on&nbsp;the&nbsp;<span class="hl_function"><b>end</b></span>&nbsp;of&nbsp;work</li><li class="hl_l1"><span class="hl_char">/</span><span class="hl_char">/</span>hEvt&nbsp;<span class="hl_char">=</span>&nbsp;OpenEvent<span class="hl_char">(</span>EVENT_ALL_ACCESS<span class="hl_char">,</span>&nbsp;<span class="hl_function">FALSE</span><span class="hl_char">,</span>&nbsp;<span class="hl_quote">&quot;LoaderEvent&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_char">/</span><span class="hl_char">/</span>SetEvent<span class="hl_char">(</span>hEvt<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_char">/</span><span class="hl_char">/</span>jump&nbsp;to&nbsp;oep</li><li class="hl_l0">0xe9<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span>&nbsp;</li><li class="hl_l1">}<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span></li><li class="hl_l0"><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">CreateProcess<span class="hl_char">(</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">,</span>&nbsp;CREATE_SUSPENDED<span class="hl_char">,</span>&nbsp;<span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>pi<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_function">void</span><span class="hl_char">*</span>&nbsp;pRemCode&nbsp;<span class="hl_char">=</span>&nbsp;VirtualAllocEx<span class="hl_char">(</span>pi<span class="hl_char">.</span>hProcess<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;size<span class="hl_char">,</span>&nbsp;MEM_COMMIT&nbsp;<span class="hl_char">|</span>&nbsp;MEM_RESERVE<span class="hl_char">,</span>&nbsp;PAGE_EXECUTE_READWRITE<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">CONTEXT&nbsp;ctx<span class="hl_comment">;</span></li><li class="hl_l1">ctx<span class="hl_char">.</span>ContextFlags&nbsp;<span class="hl_char">=</span>&nbsp;CONTEXT_INTEGER<span class="hl_comment">;</span></li><li class="hl_l0">GetThreadContext<span class="hl_char">(</span>pi<span class="hl_char">.</span>hThread<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>ctx<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span class="hl_function"><b>DWORD</b></span>&nbsp;oep&nbsp;<span class="hl_char">=</span>&nbsp;ctx<span class="hl_char">.</span><span class="hl_registr"><b>Eax</b></span><span class="hl_comment">;</span></li><li class="hl_l0">ctx<span class="hl_char">.</span><span class="hl_registr"><b>Eax</b></span>&nbsp;<span class="hl_char">=</span>&nbsp;pRemCode<span class="hl_comment">;</span></li><li class="hl_l1">SetThreadContext<span class="hl_char">(</span>pi<span class="hl_char">.</span>hThread<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>ctx<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_char">*</span><span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">*</span><span class="hl_char">)</span><span class="hl_char">(</span>pCode&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>pCode<span class="hl_char">)</span>&nbsp;<span class="hl_char">-</span>&nbsp;<span class="hl_number">4</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">=</span>&nbsp;oep&nbsp;<span class="hl_char">-</span>&nbsp;<span class="hl_char">(</span>pRemCode&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>pCode<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">WriteProcessMemory<span class="hl_char">(</span>pi<span class="hl_char">.</span>hProcess<span class="hl_char">,</span>&nbsp;pRemCode<span class="hl_char">,</span>&nbsp;pCode<span class="hl_char">,</span>&nbsp;size<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">HANDLE&nbsp;hEvt&nbsp;<span class="hl_char">=</span>&nbsp;CreateEvent<span class="hl_char">(</span><span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">FALSE</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">FALSE</span><span class="hl_char">,</span>&nbsp;<span class="hl_quote">&quot;LoaderEvent&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">ResumeThread<span class="hl_char">(</span>pi<span class="hl_char">.</span>hThread<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_function"><b>DWORD</b></span>&nbsp;dwObj&nbsp;<span class="hl_char">=</span>&nbsp;WaitForSingleObject<span class="hl_char">(</span>hEvt<span class="hl_char">,</span>&nbsp;<span class="hl_number">1000</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span class="hl_function">if</span><span class="hl_char">(</span>dwObj&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;WAIT_TIMEOUT<span class="hl_char">)</span>&nbsp;&nbsp;MessageBox<span class="hl_char">(</span><span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;<span class="hl_quote">&quot;Failed to inject&quot;</span><span class="hl_char">,</span>&nbsp;<span class="hl_quote">&quot;&quot;</span><span class="hl_char">,</span>&nbsp;MB_OK<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">CloseHandle<span class="hl_char">(</span>hEvt<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">CloseHandle<span class="hl_char">(</span>pi<span class="hl_char">.</span>hProcess<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">CloseHandle<span class="hl_char">(</span>pi<span class="hl_char">.</span>hThread<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li>        </ol>
    </div>
</div></div><br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=368533&amp;user=24257&amp;forum_n=6&amp;topic=24299.html&amp;page=0&amp;anchor=24" class="addthx" data-post="368533"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=26242" title="11-10-2016 23:40, ранг:112.2" target="_blank">-=AkaBOSS=-</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="25" onfocus="this.blur()" href="JavaScript:di('[b]-=AkaBOSS=-[/b]','')">-=AkaBOSS=-</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/26242.png" alt=""><br><span class=txtSm>Ранг: 150.3 (ветеран), 175thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.88'>Активность: 0.16<span style='color:red'>&searr;</span>0.07</span><br>Статус: <a href="action=userinfo&amp;user=26242">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 октября 2016 02:40 <br><script type="text/javascript">QU('-=AkaBOSS=-','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=-=AkaBOSS=-" target="_blank">Личное сообщение</a> &middot;  <a href="#25" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24299.html&amp;page=0#25');return false;">#25</a> </span><div align=left><br>
<I>Hellspawn пишет:<br>а по факту имеет место быть повреждение </I><br>По факту это повреждение не имеет никакого отношения к вызову LoadLibrary.<br><br>По всей видимости, косяк как-то связан именно с тем, что вызовы DllMain с причиной DLL_PROCESS_ATTACH происходят при выполнении моего треда, а он потом берёт и уходит (DLL_THREAD_DETACH).<br>Просто обнаружил, что если оставить мой поток висеть в мёртвом цикле, краша не происходит.<br><br><br><I>difexacaw пишет:<br>CreateWindow() -&gt; ... GPA(COMCTL32.RegisterClassName) -&gt; Fail </I><br>При нормальном выполнении этого вызова вообще не происходит.<br>Под лоадером туда управление доходит из-за проверки выше<br>GetLastError () == ERROR_CANNOT_FIND_WND_CLASS<br><br><br><b>DenCoder</b><br>Интересный метод, я запомню. А пока что и APC вполне устраивает.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=368538&amp;user=26242&amp;forum_n=6&amp;topic=24299.html&amp;page=0&amp;anchor=25" class="addthx" data-post="368538"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="26" onfocus="this.blur()" href="JavaScript:di('[b]Hellspawn[/b]','')">Hellspawn</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/72.gif" alt=""><br><span class=txtSm>Ранг: 990.2 <font color=red>(<b>! ! !</b>)</font>, 380thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.95'>Активность: 0.68<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=72">Модератор</a><br><font color=blue>Author of DiE</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 октября 2016 12:04 <br><script type="text/javascript">QU('Hellspawn','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Hellspawn" target="_blank">Личное сообщение</a> &middot;  <a href="#26" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24299.html&amp;page=0#26');return false;">#26</a> </span><div align=left><br>
<b>-=AkaBOSS=-</b><br>по факту я не говорил ничего про LoadLibrary из вашего кода, косяк идет с другими длл, которые грузятся (совпадение ли? с помощью LoadLibrary) после инжекта потока.<br>об этом косвенно тоже есть у микрософт. можно попробовать убивать поток не сразу, а спустя время, как вариант, либо нативный поток без уведомления csrss.<br><br>p.s. если гадания закончились, а реверсить такое поведение ОС некогда, то предлагаю закрыть тему.
<br><br><font size="1"><i>-----<br>[nice coder and reverser]</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=368545&amp;user=72&amp;forum_n=6&amp;topic=24299.html&amp;page=0&amp;anchor=26" class="addthx" data-post="368545"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="27" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 338.5 (мудрец), 349thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 16 октября 2016 02:35 <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#27" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24299.html&amp;page=0#27');return false;">#27</a> </span><div align=left><br>
Можно попробовать снять трассу для двух вариантов запуска и найти разницу, это позволит найти отклонение в работе треда автоматикой.
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=368630&amp;user=40990&amp;forum_n=6&amp;topic=24299.html&amp;page=0&amp;anchor=27" class="addthx" data-post="368630"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> лоадер глючит на винхп</span></td>
</tr></table>
</div>
<a name=newreply></a>
<div align=center>
<table class=forums>
<tr>
<td class=caption4 width="100%"><span class=header>Эта тема закрыта. Ответы больше не принимаются.</span></td>
</tr>
</table>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=24299" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
