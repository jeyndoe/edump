<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Перехват API - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="люди добрые помогите!Задача такая нада при вызове определенной API передать управление моей проге. Если у кого есть исходники на masm залейте куданить плизз. зарание сенкс и извините за возможное повторение темы но в поиске я">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=42072'>zombi-vadim</a>, <a target='_blank' href='?action=userinfo&amp;user=31361'>zds</a> (+4 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Перехват API</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> .  <b>1</b> . <a href="action=vthread&amp;forum=6&amp;topic=8678&amp;page=1.html">2</a> . <a href="action=vthread&amp;forum=6&amp;topic=8678&amp;page=2.html">3</a> . <a href="action=vthread&amp;forum=6&amp;topic=8678&amp;page=1.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]bitmaster[/b]','')">bitmaster</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 9.6 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.15'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=4843">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 06 мая 2007 20:16 <br><script type="text/javascript">QU('bitmaster','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=bitmaster" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
люди добрые помогите!Задача такая нада при вызове определенной API передать управление моей проге.<br>Если у кого есть исходники на masm залейте куданить плизз.<img src="img/smilies/s15.gif" alt=""><br>зарание сенкс и извините за возможное повторение темы но в поиске я ниче нинашел!<img src="img/smilies/s16.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=135267&amp;user=4843&amp;forum_n=6&amp;topic=8678&amp;page=0&amp;anchor=1" class="addthx" data-post="135267"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]ValdiS[/b]','')">ValdiS</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/1263.gif" alt=""><br><span class=txtSm>Ранг: 420.3 (мудрец)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.42'>Активность: 0.24<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1263">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 06 мая 2007 20:25 <br><script type="text/javascript">QU('ValdiS','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ValdiS" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
<b>bitmaster</b><br>Почитай тут http://wasm.ru/publist.php?list=6  и тут http://wasm.ru/publist.php?list=21 .
<br><br><font size="1"><i>-----<br>Сколько ни наталкивали на мысль – все равно сумел увернуться</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=135274&amp;user=1263&amp;forum_n=6&amp;topic=8678&amp;page=0&amp;anchor=2" class="addthx" data-post="135274"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]DillerInc[/b]','')">DillerInc</a></b><br></div>
<img src="img/s6.gif" alt=""><br><img style="padding-top:3px;" src="av/1613.gif" alt=""><br><span class=txtSm>Ранг: 283.6 (наставник), 56thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.25'>Активность: 0.13<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1613">Участник</a><br><font color=blue>Author of GeTaOEP</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 06 мая 2007 20:48 <br><script type="text/javascript">QU('DillerInc','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DillerInc" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
<b>bitmaster</b><br>Посмотри эту статью http://www.rsdn.ru/article/baseserv/IntercetionAPI.xml .Там,правда,на Cи,но не разберётся там только ленивый.
<br><br><font size="1"><i>-----<br>the Power of Reversing team</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=135282&amp;user=1613&amp;forum_n=6&amp;topic=8678&amp;page=0&amp;anchor=3" class="addthx" data-post="135282"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]Xoluay[/b]','')">Xoluay</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.3 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.72'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=580">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 мая 2007 05:33 <br><script type="text/javascript">QU('Xoluay','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Xoluay" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
Держи и разбирайся. <img src="img/smilies/s6.gif" alt=""><br><br><img src="img/attach.gif" alt=""> <a href="./files/aa77_08.05.2007_CRACKLAB.rU.tgz">aa77_08.05.2007_CRACKLAB.rU.tgz</a> - Inject.rar
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=135625&amp;user=580&amp;forum_n=6&amp;topic=8678&amp;page=0&amp;anchor=4" class="addthx" data-post="135625"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]mysterio[/b]','')">mysterio</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/1803.gif" alt=""><br><span class=txtSm>Ранг: 307.9 (мудрец), 196thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.17'>Активность: 0.18<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1803">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 мая 2007 07:59 <br><script type="text/javascript">QU('mysterio','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=mysterio" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
а можно тоже самое на Делфях ?
<br><br><font size="1"><i>-----<br>Don_t hate the cracker - hate the code.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=135795&amp;user=1803&amp;forum_n=6&amp;topic=8678&amp;page=0&amp;anchor=5" class="addthx" data-post="135795"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]DillerInc[/b]','')">DillerInc</a></b><br></div>
<img src="img/s6.gif" alt=""><br><img style="padding-top:3px;" src="av/1613.gif" alt=""><br><span class=txtSm>Ранг: 283.6 (наставник), 56thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.25'>Активность: 0.13<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1613">Участник</a><br><font color=blue>Author of GeTaOEP</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 мая 2007 19:13 <br><script type="text/javascript">QU('DillerInc','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DillerInc" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
<b>mysterio</b><br>Дык,Ms-Rem же писал как раз на Дельфях: <br>Перехват API функций в Windows NT (часть 1). Основы перехвата. http://www.wasm.ru/article.php?article=apihook_1
<br><br><font size="1"><i>-----<br>the Power of Reversing team</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=135872&amp;user=1613&amp;forum_n=6&amp;topic=8678&amp;page=0&amp;anchor=6" class="addthx" data-post="135872"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]mysterio[/b]','')">mysterio</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/1803.gif" alt=""><br><span class=txtSm>Ранг: 307.9 (мудрец), 196thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.17'>Активность: 0.18<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1803">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 мая 2007 19:35 <br><script type="text/javascript">QU('mysterio','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=mysterio" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
<I>Перехват API функций в Windows NT (часть 1). Основы перехвата. </I><br>Давно качал... совсем забыл про это... спс что напомнил. Старею - чертов склероз.
<br><br><font size="1"><i>-----<br>Don_t hate the cracker - hate the code.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=135875&amp;user=1803&amp;forum_n=6&amp;topic=8678&amp;page=0&amp;anchor=7" class="addthx" data-post="135875"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]g3r0n1m0[/b]','')">g3r0n1m0</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 25.7 (посетитель), 4thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 8.44'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=31280">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 июля 2012 13:23 &middot; Поправил: g3r0n1m0 <br><script type="text/javascript">QU('g3r0n1m0','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=g3r0n1m0" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
Из &quot;Перехват API функций в Windows NT (часть 2)&quot;:<br><i class=x>В среде Borland C++ Builder некоторые приведенные приёмы неосуществимы (в связи с особенностями генерации кода компилятором). </i><br>1) с чем это связано;<br>2)изменилась ли ситуация в следующих версиях(Codegear или Embarcadero RAD Studio ). Я так понимаю здесь имелся в виду  C++Builder 6<br>3)&quot;особенностями генерации кода компилятором&quot; - можно ли это исправить, например ассемблерными вставками.<br>Просто привык сильно к этой среде<img src="img/smilies/s1.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=309334&amp;user=31280&amp;forum_n=6&amp;topic=8678&amp;page=0&amp;anchor=8" class="addthx" data-post="309334"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]Maximus[/b]','')">Maximus</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/2775.jpg" alt=""><br><span class=txtSm>Ранг: 392.8 (мудрец), 108thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.75'>Активность: 0.26<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=2775">Участник</a><br><font color=blue>REVENGE сила, БеХоЦе могила</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 июля 2012 16:42 &middot; Поправил: Maximus <br><script type="text/javascript">QU('Maximus','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Maximus" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
<b>g3r0n1m0</b> все осуществимо. Я делаю все proxy dll в дельфе 5.<br><br>Во вложении пример, заготовка для всех basic программ.<br><img src="img/attach.gif" alt=""> <a href="./files/3738_26.07.2012_EXELAB.rU.tgz">3738_26.07.2012_EXELAB.rU.tgz</a> - 1.rar<br><br>Там остается только сделать перехват любой API, какой вздумается.<br>Для примера я перехватил RegQueryValueExA
<br><br><font size="1"><i>-----<br>StarForce и Themida ацтой!</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=309338&amp;user=2775&amp;forum_n=6&amp;topic=8678&amp;page=0&amp;anchor=9" class="addthx" data-post="309338"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]volopas[/b]','')">volopas</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.8 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.92'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=21986">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 24 июня 2013 19:57 &middot; Поправил: volopas <br><script type="text/javascript">QU('volopas','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=volopas" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
В Перехват API функций в Windows NT (часть 2) есть архив с примерами. Пример InjectDllEx.dpr работает , но если применять CreateProcessWithDllEx , то Блокнот не выходит из приостановленного состояния. После ResumeThread на точку входа в Блокнот попадает, но дальше CreateWindowExW возвращает 0  и  завершается. Сразу после возврата CreateWindowExW  попробовал перескочить на GetLastError . Выдало 7F. Что означает The specified procedure could not be found. Но все равно причина не ясна. В чем причина?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=326625&amp;user=21986&amp;forum_n=6&amp;topic=8678&amp;page=0&amp;anchor=10" class="addthx" data-post="326625"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]volopas[/b]','')">volopas</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.8 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.92'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=21986">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 июня 2013 17:00 &middot; Поправил: volopas <br><script type="text/javascript">QU('volopas','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=volopas" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
Похоже, проблема в создании удаленных потоков и запуске их, пока главный поток стоит. Если процесс  создается с флагом CREATE_SUSPENDED , то процесс не отображается в списке процессов , по крайней мере Ольга не видит его в окне Attach (Кстати , как приаттатчиться к такому процессу Ольгой? ), но как только создается удаленный поток, то процесс notepad.exe появляется.<br><br><noindex><a href="http://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=20320" rel="nofollow" target="_blank">Здесь</a></noindex> у топикстартер пишет, что тоже если стартует не основной поток , то потом нифига не работает.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=326686&amp;user=21986&amp;forum_n=6&amp;topic=8678&amp;page=0&amp;anchor=11" class="addthx" data-post="326686"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]Artem_N[/b]','')">Artem_N</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 17.7 (новичок), 13thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.99'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=17427">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 июня 2013 17:08 <br><script type="text/javascript">QU('Artem_N','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Artem_N" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
При CREATE_SUSPENDED даже импорт не парсится и никакие внешние dll&#039;ки не загружаются в процесс. Соответственно, приаттачиться в таком состоянии невозможно.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=326688&amp;user=17427&amp;forum_n=6&amp;topic=8678&amp;page=0&amp;anchor=12" class="addthx" data-post="326688"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]volopas[/b]','')">volopas</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.8 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.92'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=21986">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 июня 2013 17:21 <br><script type="text/javascript">QU('volopas','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=volopas" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
Тогда вообще эта статья имеет посредственную ценность, так как нужно будет инжект длл делать с запущенным процессом и молиться , чтобы инжектируемая длл успела сделать все поправки.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=326689&amp;user=21986&amp;forum_n=6&amp;topic=8678&amp;page=0&amp;anchor=13" class="addthx" data-post="326689"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]Artem_N[/b]','')">Artem_N</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 17.7 (новичок), 13thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.99'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=17427">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 июня 2013 17:49 <br><script type="text/javascript">QU('Artem_N','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Artem_N" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
А что мешает использовать DEBUG_PROCESS с int3 в Entry Point, например? <img src="img/smilies/s2.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=326691&amp;user=17427&amp;forum_n=6&amp;topic=8678&amp;page=0&amp;anchor=14" class="addthx" data-post="326691"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]volopas[/b]','')">volopas</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.8 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.92'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=21986">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 июня 2013 18:01 <br><script type="text/javascript">QU('volopas','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=volopas" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
&gt;&gt; А что мешает использовать DEBUG_PROCESS с int3 в Entry Point, например? <br><br>После инжекта мой процесс закроется и убьет  созданный процесс. Смысла тогда не вижу в инжекте длл.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=326693&amp;user=21986&amp;forum_n=6&amp;topic=8678&amp;page=0&amp;anchor=15" class="addthx" data-post="326693"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]Artem_N[/b]','')">Artem_N</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 17.7 (новичок), 13thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.99'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=17427">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 июня 2013 18:12 <br><script type="text/javascript">QU('Artem_N','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Artem_N" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=0#16');return false;">#16</a> </span><div align=left><br>
<I>volopas пишет:<br>После инжекта мой процесс закроется и убьет  созданный процесс. </I><br>Твой процесс будет выступать отладчиком для запускаемого процесса. Ничего не закроется и ничего не убьётся.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=326694&amp;user=17427&amp;forum_n=6&amp;topic=8678&amp;page=0&amp;anchor=16" class="addthx" data-post="326694"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]volopas[/b]','')">volopas</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.8 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.92'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=21986">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 июня 2013 18:15 <br><script type="text/javascript">QU('volopas','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=volopas" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=0#17');return false;">#17</a> </span><div align=left><br>
&gt;&gt;Твой процесс будет выступать отладчиком для запускаемого процесса<br>А разве после закрытия отладчика, отлажываемый процесс не убивается? Этим приемом автор статьи кстати убивает Касперского (кслову противодействовать этому очень просто, если в драйвер сам запустит отладку касперского)
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=326695&amp;user=21986&amp;forum_n=6&amp;topic=8678&amp;page=0&amp;anchor=17" class="addthx" data-post="326695"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]SReg[/b]','')">SReg</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 315.1 (мудрец), 631thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.78'>Активность: 0.3<span style='color:green'>&nearr;</span>0.33</span><br>Статус: <a href="action=userinfo&amp;user=18316">Модератор</a><br><font color=blue>CrackLab</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 июня 2013 18:57 <br><script type="text/javascript">QU('SReg','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=SReg" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=0#18');return false;">#18</a> </span><div align=left><br>
<b>volopas</b><br><noindex><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms679296(v=vs.85).aspx" rel="nofollow" target="_blank">--&gt; Link &lt;--</a></noindex>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=326699&amp;user=18316&amp;forum_n=6&amp;topic=8678&amp;page=0&amp;anchor=18" class="addthx" data-post="326699"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]volopas[/b]','')">volopas</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.8 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.92'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=21986">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 июня 2013 19:26 &middot; Поправил: volopas <br><script type="text/javascript">QU('volopas','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=volopas" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=0#19');return false;">#19</a> </span><div align=left><br>
Про отладчик - это всё костыли. Тогда уж проще написать отладчик или написать прогу , которая будет нажимать на кнопки в стороннем отладчике (напр. Ольге) и этот отладчик будет перехватывать API через родные приемы бряков. Я же хочу понять суть ошибки в применении CreateProcessWithDllEx и хочу добиться  перехвата через инжекцию длл без костылей и отладчиков.<br><br>Подскажите , в какую сторону копать. Почему если стартует неосновной поток, то потом ничего не работает? Если приаттатчится к процессу с отработавшими неосновными потоками, но остановленным основным (теперь он будетт виден в Ольге), то в окне Потоков в столбике Entry основной поток имеет 00000000. А если запускать блокнот в Ольге , то там стоит точка входа
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=326704&amp;user=21986&amp;forum_n=6&amp;topic=8678&amp;page=0&amp;anchor=19" class="addthx" data-post="326704"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="20" onfocus="this.blur()" href="JavaScript:di('[b]SReg[/b]','')">SReg</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 315.1 (мудрец), 631thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.78'>Активность: 0.3<span style='color:green'>&nearr;</span>0.33</span><br>Статус: <a href="action=userinfo&amp;user=18316">Модератор</a><br><font color=blue>CrackLab</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 июня 2013 20:18 <br><script type="text/javascript">QU('SReg','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=SReg" target="_blank">Личное сообщение</a> &middot;  <a href="#20" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=0#20');return false;">#20</a> </span><div align=left><br>
<b>volopas</b><br>а в чем проблема я не понимаю отладить свой код и посмотреть что и почему не воркает/падает? может что то не так делаешь? где твои сорцы?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=326705&amp;user=18316&amp;forum_n=6&amp;topic=8678&amp;page=0&amp;anchor=20" class="addthx" data-post="326705"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="21" onfocus="this.blur()" href="JavaScript:di('[b]ARCHANGEL[/b]','')">ARCHANGEL</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/6336.png" alt=""><br><span class=txtSm>Ранг: 681.5 <font color=magenta>(<b>! !</b>)</font>, 405thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.85'>Активность: 0.42<span style='color:red'>&searr;</span>0.21</span><br>Статус: <a href="action=userinfo&amp;user=6336">Участник</a><br><font color=blue>ALIEN Hack Team</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 июня 2013 20:20 <br><script type="text/javascript">QU('ARCHANGEL','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ARCHANGEL" target="_blank">Личное сообщение</a> &middot;  <a href="#21" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=0#21');return false;">#21</a> </span><div align=left><br>
<b>volopas пишет:</b><br><i class=x>Похоже, проблема в создании удаленных потоков и запуске их, пока главный поток стоит</i><br><br>Проблема в том, что кто-то как нихрена не читал и не хотел делать, так и продолжает в том же духе. Кстати, как там старфорс - уже распаковался?
<br><br><font size="1"><i>-----<br>Stuck to the plan, always think that we would stand up, never ran.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=326707&amp;user=6336&amp;forum_n=6&amp;topic=8678&amp;page=0&amp;anchor=21" class="addthx" data-post="326707"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="22" onfocus="this.blur()" href="JavaScript:di('[b]volopas[/b]','')">volopas</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.8 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.92'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=21986">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 июня 2013 20:45 &middot; Поправил: volopas <br><script type="text/javascript">QU('volopas','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=volopas" target="_blank">Личное сообщение</a> &middot;  <a href="#22" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=0#22');return false;">#22</a> </span><div align=left><br>
&gt;&gt;а в чем проблема я не понимаю отладить свой код и посмотреть что и почему не воркает/падает? может что то не так делаешь? где твои сорцы?<br><br>Все исходники в файле advApiHook.rar к второй части статьи:<br><br>TestDll.dll вообще не компилировал , взял готовую<br>InjectDllEx.dpr Переписал следующим образом:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">{</li><li class="hl_l1">&nbsp;Демонстрация&nbsp;внедрения&nbsp;Dll&nbsp;альтернативным&nbsp;способом<span class="hl_char">.</span></li><li class="hl_l0">&nbsp;Copyright&nbsp;by&nbsp;Ms<span class="hl_char">-</span>Rem&nbsp;<span class="hl_char">(</span>Ms<span class="hl_char">-</span>Rem@yandex<span class="hl_char">.</span>ru<span class="hl_char">)</span>&nbsp;ICQ&nbsp;<span class="hl_number">286370715</span></li><li class="hl_l1">}</li><li class="hl_l0">program&nbsp;aInjectDllEx<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_function">uses</span></li><li class="hl_l1">&nbsp;&nbsp;Windows<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;advApiHook<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;</li><li class="hl_l0">var</li><li class="hl_l1">&nbsp;&nbsp;StartInfo<span class="hl_char">:</span>&nbsp;TStartupInfo<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;ProcInfo<span class="hl_char">:</span>&nbsp;TProcessInformation<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;sFile<span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>dword</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;Size<span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>dword</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;Buff<span class="hl_char">:</span>&nbsp;pointer<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;BytesReaded<span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>dword</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">begin</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>считываем&nbsp;Dll&nbsp;в&nbsp;память</li><li class="hl_l1">&nbsp;&nbsp;sFile&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;CreateFile<span class="hl_char">(</span><span class="hl_quote">'TestDll.dll'</span><span class="hl_char">,</span>&nbsp;GENERIC_READ<span class="hl_char">,</span>&nbsp;FILE_SHARE_READ<span class="hl_char">,</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nil</span><span class="hl_char">,</span>&nbsp;OPEN_EXISTING<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;Size&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;GetFileSize<span class="hl_char">(</span>sFile<span class="hl_char">,</span>&nbsp;nil<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;GetMem<span class="hl_char">(</span>Buff<span class="hl_char">,</span>&nbsp;Size<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;ReadFile<span class="hl_char">(</span>sFile<span class="hl_char">,</span>&nbsp;Buff^<span class="hl_char">,</span>&nbsp;Size<span class="hl_char">,</span>&nbsp;BytesReaded<span class="hl_char">,</span>&nbsp;nil<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;CloseHandle<span class="hl_char">(</span>sFile<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>Запускаем&nbsp;процесс</li><li class="hl_l1">&nbsp;&nbsp;ZeroMemory<span class="hl_char">(</span>@StartInfo<span class="hl_char">,</span>&nbsp;<span class="hl_function">SizeOf</span><span class="hl_char">(</span>TStartupInfo<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;StartInfo<span class="hl_char">.</span>cb&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;<span class="hl_function">SizeOf</span><span class="hl_char">(</span>TStartupInfo<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;CreateProcessWithDllEx<span class="hl_char">(</span>nil<span class="hl_char">,</span>&nbsp;<span class="hl_quote">'notepad.exe'</span><span class="hl_char">,</span>&nbsp;nil<span class="hl_char">,</span>&nbsp;nil<span class="hl_char">,</span>&nbsp;<span class="hl_function">False</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nil<span class="hl_char">,</span>&nbsp;nil<span class="hl_char">,</span>&nbsp;StartInfo<span class="hl_char">,</span>&nbsp;ProcInfo<span class="hl_char">,</span>&nbsp;Buff<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;FreeMem<span class="hl_char">(</span>Buff<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span class="hl_function">end</span><span class="hl_char">.</span></li>        </ol>
    </div>
</div></div>
<br><br><br>advApiHook.pas  не менял:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;Запуск&nbsp;процесса&nbsp;с&nbsp;загрузкой&nbsp;в&nbsp;него&nbsp;Dll&nbsp;альтернативным&nbsp;методом<span class="hl_char">.</span></li><li class="hl_l1">&nbsp;Обеспечивается&nbsp;высокая&nbsp;скрытность&nbsp;загрузки&nbsp;Dll<span class="hl_char">.</span></li><li class="hl_l0">}</li><li class="hl_l1">function&nbsp;CreateProcessWithDllEx<span class="hl_char">(</span>lpApplicationName<span class="hl_char">:</span>&nbsp;PChar<span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lpCommandLine</span><span class="hl_char">:</span>&nbsp;PChar<span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lpProcessAttributes</span><span class="hl_char">,</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lpThreadAttributes</span><span class="hl_char">:</span>&nbsp;PSecurityAttributes<span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bInheritHandles</span><span class="hl_char">:</span>&nbsp;boolean<span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwCreationFlags</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>dword</b></span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lpEnvironment</span><span class="hl_char">:</span>&nbsp;pointer<span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lpCurrentDirectory</span><span class="hl_char">:</span>&nbsp;PChar<span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>const</b></span>&nbsp;lpStartupInfo<span class="hl_char">:</span>&nbsp;TStartupInfo<span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;lpProcessInformation</span><span class="hl_char">:</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TProcessInformation</span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Src</span><span class="hl_char">:</span>&nbsp;pointer<span class="hl_char">)</span><span class="hl_char">:</span>&nbsp;boolean<span class="hl_comment">;</span></li><li class="hl_l1">begin</li><li class="hl_l0">&nbsp;&nbsp;Result&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;<span class="hl_function"><b>False</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_function"><b>not</b></span>&nbsp;CreateProcess<span class="hl_char">(</span>lpApplicationName<span class="hl_char">,</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lpCommandLine</span><span class="hl_char">,</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lpProcessAttributes</span><span class="hl_char">,</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lpThreadAttributes</span><span class="hl_char">,</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bInheritHandles</span><span class="hl_char">,</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwCreationFlags&nbsp;</span><span class="hl_function"><b>or</b></span>&nbsp;CREATE_SUSPENDED<span class="hl_char">,</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lpEnvironment</span><span class="hl_char">,</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lpCurrentDirectory</span><span class="hl_char">,</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lpStartupInfo</span><span class="hl_char">,</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lpProcessInformation</span><span class="hl_char">)</span>&nbsp;then&nbsp;Exit<span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="hl_l0">&nbsp;&nbsp;Result&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;InjectDllEx<span class="hl_char">(</span>lpProcessInformation<span class="hl_char">.</span>hProcess<span class="hl_char">,</span>&nbsp;Src<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>dwCreationFlags&nbsp;<span class="hl_function"><b>and</b></span>&nbsp;CREATE_SUSPENDED<span class="hl_char">)</span>&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span>&nbsp;then</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResumeThread<span class="hl_char">(</span>lpProcessInformation<span class="hl_char">.</span>hThread<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span class="hl_function"><b>end</b></span><span class="hl_comment">;      </span></li><li class="hl_l0"><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span></li>        </ol>
    </div>
</div></div>
<br><br>Все прекрасно работает в моем приложении и DLL отрабатывать (правда окна не видно, так как процесс приостановлен , но если делать инжект после старта Блокнота, то Messagebox вылетает аж бегом). Проблема в уже Блокноте, который не может выйти из SUSPENDED. Я отлаживал его , CreateWindowExW при создании окна класса Edit возвращает 0. А 0 возвращает потому что по адресу &#036; 00090010 стоит  0, а должно быть 00090010  60 00 00 40 . У вас адрес может быть другой . По-моему это основная куча процесса. Но что это означает, не понял. Методом тыка попробовал закомментировать все процедуры , использующие CreateRemoteThread и блокнот нормально начал работать (естественно, без инжекта)<br><br>TЕсли вместо блокнота прописать путь к Пэйнту, то Пэйнт не закрывается , а все таки стартует. Но видно только основное окно , строку меню и полотно, ничего нарисовать нельзя.<br><br><img src="img/attach.gif" alt=""> <a href="./files/da44_25.06.2013_EXELAB.rU.tgz">da44_25.06.2013_EXELAB.rU.tgz</a> - advApiHook.rar
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=326709&amp;user=21986&amp;forum_n=6&amp;topic=8678&amp;page=0&amp;anchor=22" class="addthx" data-post="326709"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="23" onfocus="this.blur()" href="JavaScript:di('[b]volopas[/b]','')">volopas</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.8 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.92'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=21986">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 июня 2013 20:52 <br><script type="text/javascript">QU('volopas','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=volopas" target="_blank">Личное сообщение</a> &middot;  <a href="#23" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=0#23');return false;">#23</a> </span><div align=left><br>
TЕсли вместо блокнота прописать путь к Пэйнту, то Пэйнт не закрывается , а все таки стартует. Но видно только основное окно , строку меню и полотно, ничего нарисовать нельзя.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=326710&amp;user=21986&amp;forum_n=6&amp;topic=8678&amp;page=0&amp;anchor=23" class="addthx" data-post="326710"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="24" onfocus="this.blur()" href="JavaScript:di('[b]SReg[/b]','')">SReg</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 315.1 (мудрец), 631thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.78'>Активность: 0.3<span style='color:green'>&nearr;</span>0.33</span><br>Статус: <a href="action=userinfo&amp;user=18316">Модератор</a><br><font color=blue>CrackLab</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 июня 2013 21:04 &middot; Поправил: SReg <br><script type="text/javascript">QU('SReg','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=SReg" target="_blank">Личное сообщение</a> &middot;  <a href="#24" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=0#24');return false;">#24</a> </span><div align=left><br>
<b>volopas</b> компилишь я надеюсь не в юникодной дельфи?<br><br><I>volopas пишет:<br>Нет , да это вообще не проблема этих исходников. Хотите сказать, у вас работает? Наверняка же не работает. (Я имею в виду восстанавливается ли приложение из suspended-состояния? Сам инжект работает) </I><br>я не пойму, какая стоит задача вообще? тупо заинжектить либу или что?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=326711&amp;user=18316&amp;forum_n=6&amp;topic=8678&amp;page=0&amp;anchor=24" class="addthx" data-post="326711"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="25" onfocus="this.blur()" href="JavaScript:di('[b]volopas[/b]','')">volopas</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.8 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.92'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=21986">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 июня 2013 21:16 &middot; Поправил: volopas <br><script type="text/javascript">QU('volopas','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=volopas" target="_blank">Личное сообщение</a> &middot;  <a href="#25" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=0#25');return false;">#25</a> </span><div align=left><br>
&gt;&gt;volopas компилишь я надеюсь не в юникодной дельфи?<br><br>Нет , да это вообще не проблема этих исходников. Хотите сказать, у вас работает? Наверняка же не работает. (Я имею в виду восстанавливается ли приложение из suspended-состояния? Сам инжект работает)<br>В родном файле InjectDllEx.dpr:<br>begin<br>  //Запускаем процесс<br>  ZeroMemory(@StartInfo, SizeOf(TStartupInfo));<br>  StartInfo.cb := SizeOf(TStartupInfo);<br>  CreateProcess(nil, &#039;notepad.exe&#039;, nil, nil, False, 0,<br>                nil, nil, StartInfo, ProcInfo);<br>  //считываем Dll в память<br>  sFile := CreateFile(&#039;TestDll.dll&#039;, GENERIC_READ, FILE_SHARE_READ,<br>                      nil, OPEN_EXISTING, 0, 0);<br>  Size := GetFileSize(sFile, nil);<br>  GetMem(Buff, Size);<br>  ReadFile(sFile, Buff^, Size, BytesReaded, nil);<br>  CloseHandle(sFile);<br><br>  Sleep(2000);<br><br>  InjectDllEx(ProcInfo.hProcess, Buff);<br>  FreeMem(Buff);<br>end.   <br><br>Для чего здесь Sleep(2000); ? Явно и у автора самого не работает.  Поэтому он решил исключить пример с использованием CreateProcessWithDllEx, и ограничелся инжектом в уже действующий процесс. Но такой инжект бесполезен, так как целевой процес будет с момента старта беспрепятственно использовать неперехваченные процедуры.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=326713&amp;user=21986&amp;forum_n=6&amp;topic=8678&amp;page=0&amp;anchor=25" class="addthx" data-post="326713"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="26" onfocus="this.blur()" href="JavaScript:di('[b]Dr0p[/b]','')">Dr0p</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33727.png" alt=""><br><span class=txtSm>Ранг: 72.3 (постоянный), 133thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.5'>Активность: 0.38<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33727">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 июня 2013 00:10 <br><script type="text/javascript">QU('Dr0p','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Dr0p" target="_blank">Личное сообщение</a> &middot;  <a href="#26" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=0#26');return false;">#26</a> </span><div align=left><br>
<b>volopas</b><br>Открою вам правду и истену. Задача должна решаться на основе требований и механизмов, они должны быть изначально чётко определены. Соответственно решенье должно удовлетворять эти требования. Допиливать фундаментально кривое гавно не годится.<br><br>Вам нужно загрузить из памяти модуль - не нужен экзешник, он от длл отличается всего лишь одним битом в хидере и релоками(обычно их нет, ибо ядро мапит). Так вот и используйте уже существующие лодеры(лучше вы написать не способны на данный момент), билдите с /dll(фиксапы). Ежели это конечно не зарипанный целиком модуль..<br><br>Инжект - бесчисленное количество метод есть. А дедлоки у вас походу на кс нтлдр, вполне вероятно. Низя окна и треды создавать из дллмэйн. Она защищена критической секцией. Обойти есно можно, но вы вначале разберитесь с простейшими вещами.<br><br>Самое элементарное решенье - создаём процесс остановленным, загружаем в контекст ссыль на стаб(в rEax вродь, не помню точно). Либо ставим апк в очередь треду. Стандартные методы. А дельфя это уёбищная среда, не удивительно что у вас чота отваливается - она слишком много говна по дефолту линкует.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=326717&amp;user=33727&amp;forum_n=6&amp;topic=8678&amp;page=0&amp;anchor=26" class="addthx" data-post="326717"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="27" onfocus="this.blur()" href="JavaScript:di('[b]volopas[/b]','')">volopas</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.8 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.92'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=21986">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 июня 2013 07:41 &middot; Поправил: volopas <br><script type="text/javascript">QU('volopas','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=volopas" target="_blank">Личное сообщение</a> &middot;  <a href="#27" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=0#27');return false;">#27</a> </span><div align=left><br>
&gt;&gt;Задача должна решаться на основе требований и механизмов, они должны быть изначально чётко определены.<br><br>Задача состоит в перехвате функции ReadFile в целевом приложении, которое практически сразу после запуска использует функцию ReadFile . Лоадер тоже пытается успеть: сначала ReadProcessMemory и если байты есть, то замениь их через WriteProcessMemory ,  если байтов нет, то sleep(100). А где гарантия, что во время проверки ReadProcessMemory или sleep(100), целевой процесс не успеет обратиться к функции.<br><br>Метод четко определен: использовать CreateProcessWithDllEx
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=326724&amp;user=21986&amp;forum_n=6&amp;topic=8678&amp;page=0&amp;anchor=27" class="addthx" data-post="326724"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="28" onfocus="this.blur()" href="JavaScript:di('[b]Dr0p[/b]','')">Dr0p</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33727.png" alt=""><br><span class=txtSm>Ранг: 72.3 (постоянный), 133thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.5'>Активность: 0.38<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33727">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 июня 2013 07:57 <br><script type="text/javascript">QU('Dr0p','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Dr0p" target="_blank">Личное сообщение</a> &middot;  <a href="#28" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=0#28');return false;">#28</a> </span><div align=left><br>
<b>volopas</b><br><br>Пока стартап тред не покинул нтлдр, есть не много мест, откуда экспорт из кернел может вызываться. По дефолту это либо еп кернел, либо еп статически прилинкованных либ. Тут очевидно как сказали отладочный порт само то, при мапе файловой секции достовляется на порт нотифи. В этот момент и можно пропатчить.<br><br>В любом другом случае придётся с нэйтивом работать. NtReadFile вам же не годится ?<br><br>Ну а в цикле вращаться ожидая когда промапится кернел - мусье знает толк в извратах <img src="img/smilies/s15.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=326725&amp;user=33727&amp;forum_n=6&amp;topic=8678&amp;page=0&amp;anchor=28" class="addthx" data-post="326725"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="29" onfocus="this.blur()" href="JavaScript:di('[b]ARCHANGEL[/b]','')">ARCHANGEL</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/6336.png" alt=""><br><span class=txtSm>Ранг: 681.5 <font color=magenta>(<b>! !</b>)</font>, 405thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.85'>Активность: 0.42<span style='color:red'>&searr;</span>0.21</span><br>Статус: <a href="action=userinfo&amp;user=6336">Участник</a><br><font color=blue>ALIEN Hack Team</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 июня 2013 09:58 <br><script type="text/javascript">QU('ARCHANGEL','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ARCHANGEL" target="_blank">Личное сообщение</a> &middot;  <a href="#29" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=0#29');return false;">#29</a> </span><div align=left><br>
<b>Dr0p</b><br>Да что вы с ним возитесь - это ж гроза старфорса свиновод. Уже больше года старфорс анпакает, и всё никак функции перехватывать не научился. Даже блог есть <noindex><a href="http://svinovod2012.livejournal.com/" rel="nofollow" target="_blank">--&gt; вот он &lt;--</a></noindex>. Ржака ещё та. А вы ему кернел, отладочный порт.
<br><br><font size="1"><i>-----<br>Stuck to the plan, always think that we would stand up, never ran.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=326727&amp;user=6336&amp;forum_n=6&amp;topic=8678&amp;page=0&amp;anchor=29" class="addthx" data-post="326727"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=22828" title="26-06-2013 06:36, ранг:92.1" target="_blank">Dart Sergius</a>, <a href="action=userinfo&user=4773" title="28-06-2013 00:11, ранг:104.9" target="_blank">plutos</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="30" onfocus="this.blur()" href="JavaScript:di('[b]SReg[/b]','')">SReg</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 315.1 (мудрец), 631thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.78'>Активность: 0.3<span style='color:green'>&nearr;</span>0.33</span><br>Статус: <a href="action=userinfo&amp;user=18316">Модератор</a><br><font color=blue>CrackLab</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 июня 2013 12:40 <br><script type="text/javascript">QU('SReg','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=SReg" target="_blank">Личное сообщение</a> &middot;  <a href="#30" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=0#30');return false;">#30</a> </span><div align=left><br>
<I>volopas пишет:<br>Задача состоит в перехвате функции ReadFile в целевом приложении, которое практически сразу после запуска использует функцию ReadFile  </I><br>Создай процесс остановленным, выдели в нем память, поменяй контекст регистра Eip на эту область и запиши туда шеллкод(рипни со стронга), который и вызовет LoadLibrary.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=326732&amp;user=18316&amp;forum_n=6&amp;topic=8678&amp;page=0&amp;anchor=30" class="addthx" data-post="326732"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> .  <b>1</b> . <a href="action=vthread&amp;forum=6&amp;topic=8678&amp;page=1.html">2</a> . <a href="action=vthread&amp;forum=6&amp;topic=8678&amp;page=2.html">3</a> . <a href="action=vthread&amp;forum=6&amp;topic=8678&amp;page=1.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Перехват API</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#31" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="6">
<input type="hidden" name="topic" value="8678">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=8678" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
