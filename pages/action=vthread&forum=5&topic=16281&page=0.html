<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Как поставить заглушку на завершение работы программы - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Пытаюсь написать пакер. Выстраиваю внешнюю программу в памяти, запускаю. Всё идёт нормально. А вот после завершения работы программы управление назад пакеру не передаётся. Пакер просто закрывается. Что-то читал о заглушке на">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=28016'>asfa</a> (+6 невидимых)</b></span>
</td>
</tr>
</table>

 

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/nub.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=5&sortBy=0&page=0.html"><b>Вопросы новичков</b></a> <b class=bulletHead>&#8212;&#8250;</b> Как поставить заглушку на завершение работы программы</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]e53[/b]','')">e53</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 1.4 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.14'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=25428">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 мая 2010 01:01 <br><script type="text/javascript">QU('e53','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=e53" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=16281.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Пытаюсь написать пакер.<br>Выстраиваю внешнюю программу в памяти, запускаю. Всё идёт нормально.<br>А вот после завершения работы программы управление назад пакеру не передаётся. Пакер просто закрывается.<br><br>Что-то читал о заглушке на exit.<br>Расскажите, как её реализовать.<br><br>P.S. пишу на С.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=258569&amp;user=25428&amp;forum_n=5&amp;topic=16281.html&amp;page=0&amp;anchor=1" class="addthx" data-post="258569"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]Bonez92[/b]','')">Bonez92</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 39.6 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.91'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=17764">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 мая 2010 04:44 <br><script type="text/javascript">QU('Bonez92','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Bonez92" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=16281.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
<I>e53 пишет:<br>заглушке на exit. </I><br>Как понять?<br><br>Есть другая идея или алгоритм.<br>- Распаковываем;<br>- Записываем куда-нибудь, также изменяем указатель на точку входа (если нужно);<br>- Запускаем (CreateProcess);<br>- Потом ждем пока программа выполняется (кажется WaitForSingleObject (hProccess, INFINITE);<br>- Делаем все остальное;<br><br>В инете уже был какой-то криптер, который делает тоже самое (но не ждет завершения). По примеру распаковки думаю будет понятно как оно работает.<br>www.4shared.com/file/18076073/efbc883d/UnpackingCelsiusCrypt2English.html
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=258574&amp;user=17764&amp;forum_n=5&amp;topic=16281.html&amp;page=0&amp;anchor=2" class="addthx" data-post="258574"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 мая 2010 08:20 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=16281.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
В общем случае изнутри процесса ты не узнаешь о том, что он подыхает.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=258578&amp;user=1556&amp;forum_n=5&amp;topic=16281.html&amp;page=0&amp;anchor=3" class="addthx" data-post="258578"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]Clerk[/b]','')">Clerk</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 255.8 (наставник), 19thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.86'>Активность: 0.15<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=17964">Участник</a><br><font color=blue>vx</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 мая 2010 10:22 <br><script type="text/javascript">QU('Clerk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Clerk" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=16281.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
<b>Archer</b><br>&gt; В общем случае изнутри процесса ты не узнаешь о том, что он подыхает.<br>Для этого есть специальная переменная - <b>LdrpShutdownInProgress</b>.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=258582&amp;user=17964&amp;forum_n=5&amp;topic=16281.html&amp;page=0&amp;anchor=4" class="addthx" data-post="258582"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]Clerk[/b]','')">Clerk</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 255.8 (наставник), 19thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.86'>Активность: 0.15<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=17964">Участник</a><br><font color=blue>vx</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 мая 2010 10:29 <br><script type="text/javascript">QU('Clerk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Clerk" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=16281.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
На счёт заглушки - использовать нотификаторы, например шим(g_pfnSE_ProcessDying), нотификацию загрузчика(DLL_PROCESS_DETACH), собщения логгера (&quot;LDR: PID: 0x%x finished - &#039;%wZ&#039;&quot;,LF,&quot;&quot;), запросы на сервер(Csr), либо более сложные способы, например IDP, ожидание захвата кс + бактрейс и пр.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=258583&amp;user=17964&amp;forum_n=5&amp;topic=16281.html&amp;page=0&amp;anchor=5" class="addthx" data-post="258583"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 мая 2010 11:33 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=16281.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
Если поток тупо сделает mov esp,0, то он будет прибит обработчиком из ядра, и никакие длл детач и ничего этого не придёт. Я не вижу возможности отследить это из ринг3 из прибиваемого процесса, так что в общем случае завершение он не отследит.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=258585&amp;user=1556&amp;forum_n=5&amp;topic=16281.html&amp;page=0&amp;anchor=6" class="addthx" data-post="258585"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]Clerk[/b]','')">Clerk</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 255.8 (наставник), 19thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.86'>Активность: 0.15<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=17964">Участник</a><br><font color=blue>vx</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 мая 2010 12:22 <br><script type="text/javascript">QU('Clerk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Clerk" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=16281.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
<b>Archer</b><br>Разрушение стека это фатальная ошибка. А ошибки тут не учитываются. Темболее отследить это можно - на отладочный порт придёт уведамление.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=258589&amp;user=17964&amp;forum_n=5&amp;topic=16281.html&amp;page=0&amp;anchor=7" class="addthx" data-post="258589"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]e53[/b]','')">e53</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 1.4 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.14'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=25428">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 24 мая 2010 01:35 <br><script type="text/javascript">QU('e53','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=e53" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=16281.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
Всё, нашел, как это делается.<br><br>Во время обработки таблицы импорта нужно для ф-ций типа ExitProcess, exit и пр.<br>подставить адрес своей функции, которая будет это отрабатывать.<br><br>Я просто ещё немного не в теме, поэтому сразу не догадался.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=258621&amp;user=25428&amp;forum_n=5&amp;topic=16281.html&amp;page=0&amp;anchor=8" class="addthx" data-post="258621"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]Bonez92[/b]','')">Bonez92</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 39.6 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.91'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=17764">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 24 мая 2010 03:23 <br><script type="text/javascript">QU('Bonez92','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Bonez92" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=16281.html&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
<I>e53 пишет:<br>Во время обработки таблицы импорта нужно для ф-ций типа ExitProcess, exit и пр.<br>подставить адрес своей функции, которая будет это отрабатывать. </I><br>Решение не универсальное. Например для этого крякми www.crackmes.de/users/little_brother/key4lilbro_1/ (написан на VB). Там я не нашел ничего про ExitProcess.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=258622&amp;user=17764&amp;forum_n=5&amp;topic=16281.html&amp;page=0&amp;anchor=9" class="addthx" data-post="258622"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 24 мая 2010 18:03 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=16281.html&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
Ну раз автора такой костыль устраивает и проблема решена, то закрывай топик. Хотя, походу, он не читает то, что писали выше. И клерк, походу, не читает, ибо я ясно указал, что процесс 1 и ринг3, откуда в 1 процессе дебаг порт на самого себя, я не знаю.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=258663&amp;user=1556&amp;forum_n=5&amp;topic=16281.html&amp;page=0&amp;anchor=10" class="addthx" data-post="258663"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]Clerk[/b]','')">Clerk</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 255.8 (наставник), 19thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.86'>Активность: 0.15<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=17964">Участник</a><br><font color=blue>vx</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 24 мая 2010 19:36 <br><script type="text/javascript">QU('Clerk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Clerk" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=16281.html&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
<b>Archer</b><br>Слух. Вы явно не понимаете. Что клерк не читает или не то пишет вы заблуждаетесь. Вы слишком грубы, даже я так не пишу. Это можно было написать комуто иному, но не мне. То что вы сейчас пытаетесь понять и то что вам предстоит узнать из области ядра и далее я знаю досконально, незачем мне чтото упоминать про юзермод, вы так скажем есчо не доросли чтобы спорить со мной и подобными. Про разрушение стека, дебугпорты и пр. - незачем мне меняже цитировать и обьяснять примитивные вещи. Ктото может вас рассматривать как весьма шарящего, для меняже вы не особо продвинуты в подобных вопросах. Это в качестве демотиватора вам. Сосредоточтесь и почитайте вопрос есчо раз. Автору не нужно обрабатывать всякие крэши для изоляции своих потоков.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=258673&amp;user=17964&amp;forum_n=5&amp;topic=16281.html&amp;page=0&amp;anchor=11" class="addthx" data-post="258673"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 24 мая 2010 20:06 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=16281.html&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
Прочитал вопрос ещё раз: автор пишет пакер. Поскольку 99% пакеров с 1 процессом, делаю предположение, что процесс один. Поскольку 99% пакеров без дрова и юзаются юзермодные апи, делаю предположение, что это чисто юзермод. Автору надо получить управление после отработки упакованного приложения, что не исключает возможности получения управления при фолтах (например, удалять временные файлы надо в этом случае тоже). Я утверждаю, что в общем случае этого не получится и привёл примеры таких случаев. Что я прочитал не так, я хз. Остальное пропущу, ибо вырос из того возраста, когда меряются достоин-не достоин.<br>З.Ы. Что интересно, автор почему-то молчит на эту тему, что конкретно ему надо и зачем.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=258676&amp;user=1556&amp;forum_n=5&amp;topic=16281.html&amp;page=0&amp;anchor=12" class="addthx" data-post="258676"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]Clerk[/b]','')">Clerk</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 255.8 (наставник), 19thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.86'>Активность: 0.15<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=17964">Участник</a><br><font color=blue>vx</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 24 мая 2010 20:21 &middot; Поправил: Clerk <br><script type="text/javascript">QU('Clerk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Clerk" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=16281.html&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
<b>Archer</b><br>&gt; не исключает возможности получения управления при фолтах <br>ну так мб нужно есчо багчеки в ядре отслеживать <img src="img/smilies/s15.gif" alt=""><br>Фоллты могут возникать везде в любой момент при необычных ситуациях, например изза косяков в нижележащем софте. Это никто не учитывает.<br>&gt; Я утверждаю, что в общем случае этого не получится и привёл примеры таких случаев.<br>Вы пишите бред, согласитесь.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=258678&amp;user=17964&amp;forum_n=5&amp;topic=16281.html&amp;page=0&amp;anchor=13" class="addthx" data-post="258678"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 24 мая 2010 20:27 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=16281.html&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
Я соглашусь, что фолты могут быть везде, в том числе и в упакованном приложении. Всё зависит от задачи. Если в конверте, например, он создаёт временные файлы, которые потом хочет удалить, то задача носит характер: получить управление после любого завершения упакованного приложения. Пока автор не озвучит цель, которую он хочет достичь, обсуждение смысла не имеет.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=258679&amp;user=1556&amp;forum_n=5&amp;topic=16281.html&amp;page=0&amp;anchor=14" class="addthx" data-post="258679"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]Clerk[/b]','')">Clerk</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 255.8 (наставник), 19thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.86'>Активность: 0.15<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=17964">Участник</a><br><font color=blue>vx</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 24 мая 2010 20:30 &middot; Поправил: Clerk <br><script type="text/javascript">QU('Clerk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Clerk" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=16281.html&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
<b>Archer</b><br>Имеет смысл. Не рассматриваю патч кодосекций как жизнеспособное решение. Нормальное решение я описал в #5.<br>Касательно ошибок - не зависимо от задачи, фолты софт не учитывает. Всякие ошибки ловятся через VEH, подобные разрушению стека - это фолты и по определению они не могут быть обработаны(ут. задача должна быть прибита вот).
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=258680&amp;user=17964&amp;forum_n=5&amp;topic=16281.html&amp;page=0&amp;anchor=15" class="addthx" data-post="258680"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]e53[/b]','')">e53</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 1.4 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.14'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=25428">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 мая 2010 15:55 <br><script type="text/javascript">QU('e53','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=e53" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=16281.html&amp;page=0#16');return false;">#16</a> </span><div align=left><br>
Наверное, мне сразу нужно было написать, что я хочу, что бы не было таких споров.<br>Работаю с юзермоде исключительно.<br><br>Я хотел просто получить управление после того, как программа отработает и вывести в лог, что программа отработала нормально.<br><br>Но, судя по комментариям, возможна масса вариантов, за разруливание  которых мне браться пока рано.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=258728&amp;user=25428&amp;forum_n=5&amp;topic=16281.html&amp;page=0&amp;anchor=16" class="addthx" data-post="258728"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]Clerk[/b]','')">Clerk</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 255.8 (наставник), 19thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.86'>Активность: 0.15<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=17964">Участник</a><br><font color=blue>vx</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 мая 2010 19:51 <br><script type="text/javascript">QU('Clerk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Clerk" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=16281.html&amp;page=0#17');return false;">#17</a> </span><div align=left><br>
<b>e53</b><br>Понятно сразу было, просто <b>Archer</b> решил повыёбываться. Решение описал, оно тривиально.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=258743&amp;user=17964&amp;forum_n=5&amp;topic=16281.html&amp;page=0&amp;anchor=17" class="addthx" data-post="258743"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 мая 2010 21:26 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=16281.html&amp;page=0#18');return false;">#18</a> </span><div align=left><br>
Если задача поставлена так, то да, фолты обрабатывать смысла нет, я был не прав. Я не боюсь признать свои ошибки, особенно, если это потешит чьё-то самолюбие, мне не жалко.<br>На этом топик закрою.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=258746&amp;user=1556&amp;forum_n=5&amp;topic=16281.html&amp;page=0&amp;anchor=18" class="addthx" data-post="258746"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/nub.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=5&sortBy=0&page=0.html"><b>Вопросы новичков</b></a> <b class=bulletHead>&#8212;&#8250;</b> Как поставить заглушку на завершение работы программы</span></td>
</tr></table>
</div>
<a name=newreply></a>
<div align=center>
<table class=forums>
<tr>
<td class=caption4 width="100%"><span class=header>Эта тема закрыта. Ответы больше не принимаются.</span></td>
</tr>
</table>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=16281" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
