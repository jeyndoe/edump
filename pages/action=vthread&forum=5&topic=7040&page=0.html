<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Выбор инструментов для задачи (+) - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Доброго, уважаемые форумчане. Мне нужна помощь по выбору инструментария в целом и в частности по OllyDbg. Задача:  Возможно Вы слышали о таком математическом пакете как Mathcad, менее вероятно, что Вы знаете, что в версии 11-13,5">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=41701'>_MBK_</a>, <a target='_blank' href='?action=userinfo&amp;user=5602'>ut2004</a>, <a target='_blank' href='?action=userinfo&amp;user=40607'>vsv1</a> (+6 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/nub.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=5&sortBy=0&page=0.html"><b>Вопросы новичков</b></a> <b class=bulletHead>&#8212;&#8250;</b> Выбор инструментов для задачи (+)</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]uni[/b]','')">uni</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 2.4 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.59'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=8321">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 декабря 2006 09:22 <br><script type="text/javascript">QU('uni','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=uni" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=7040.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Доброго, уважаемые форумчане. Мне нужна помощь по выбору инструментария в целом и в частности по OllyDbg.<br>Задача:<br>   Возможно Вы слышали о таком математическом пакете как Mathcad, менее вероятно, что Вы знаете, что в версии 11-13,5 встроено ядро символьных вычислений от другой математической программы - MapleV R4. Вот с этими двумя программами мне нужно повозиться. Конкретно с Mathcad 11.0a и MapleV R4 (не демо). Что нужно: Mathcad 11.0a (далее MC11) является численной системой, т.е. в общем выполняет численные расчёты, но может обращаться к &quot;встроенному&quot; (отдельная OEM библиотека) символьному движку Maple. После нескольких лет изучения возможностей MC11 выяснилось, что кроме документированного использования символьных вычислений (из справки) в нём доступна вся функциональность символьного движка, НО есть проблема. Интерфейс MC не позволяет передавать команды maple-движку напрямую. Послдений имеет командный интерфейс, в отличие от MC, у которого, как известно, он графический. Был придуман (мною) извращённый подход к обходу этой проблемы. Я написал простую программку на языке MC для перевода текстовых строк в строки понятные maple-движку, которая передаёт потом эту строку на выполнение движку. К сожалению, возможности этой утилитки не идут ни в какое сравнение с оригинальным IDE интерфейсом MapleV R4 (хоть и устаревшим - заря MS Windows 95). В общем и целом, дела обстоят так. Мне нужно подцепить каким-либо образом &quot;выдранный&quot; IDE MapleV R4 к MC11 таким образом, чтобы, допустим, по нажатии кнопы он вызывался, а команды его передавались встроенному симольному движку и результаты отображались тоже в IDE.<br><br>Теоретически, думаю, что это можно как-то реализовать. Надо отметить, что обе среды - интерпретаторы, т.е. у них где-то есть главная интерпретирующая функция, причём у MC11 их 2, т.к. численные расчёты там выполняются отдельно от символьных. Нужно отыскать интерпретирующую функцию в MapleV R4 и такую же в MC11. Далее, MC11 поддерживает механизм &quot;плагинов&quot;. Просто он может подключать dll-ки при запуске. Я хочу переделать запускающий файл MapleV R4, который содержит всю функциональность и является единственным исполняемым файлом (ни dll ничего более, только доп. файлы с данными), под вид dll-ки для MC11 (опыт есть по реализации интерфейса в dll для MC). Короче, суть ... нужно перенаправить текстовую строку введённую в IDE Maple внутреннему движку MC11 и отобразить результат тоже в IDE - Всё это будет в обход интерфейса MC11 - это нормально.<br><br>Задача со многими неизвестными. Дело в том, что если бы получилось совместить 2 интерфейса, то среда для математических расчётов была бы очень мощная, её уже прозвали Maplecad VR4/11. Можно обойтись и без интерфейса, но с ним всё-таки гораздо удобнее и лучше. Я остановился пота на под задаче отыскания кода интерпретатора в MapleV R4, для чего скачал OllyDbg, настроил по статье и теперь соображаю, что делать далее....<br><br>Вот ссылка по использованию недокументированных возможностей символьных вычислений в MC11:<br>forum.exponenta.ru/viewtopic.php?t=4132&amp;start=0<br><br>Итак, первый ламерский вопрос:<br>1) В среде MapleV R4 поддерживается MDI интерфейс. В каждом дочернем окне - командный, свой собственный интерфейс. Сами вычисления выполняются в том же .exe файле (это уже я додумал, т.к. больше просто негде). Загрузил я exe&#039;шник в Olly и теперь не знаю как бы мне начать. Хочу просто: ввести команду в MVR4 типа &quot;?help&quot; и отследить по какому адресу и функции начинается её обработка. Как правильней поставить BP на строку? И если не сработает стандартная команда, то как поступить далее?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=107999&amp;user=8321&amp;forum_n=5&amp;topic=7040.html&amp;page=0&amp;anchor=1" class="addthx" data-post="107999"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]uni[/b]','')">uni</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 2.4 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.59'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=8321">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 декабря 2006 10:25 <br><script type="text/javascript">QU('uni','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=uni" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=7040.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
Ещё есть такое соображение. Символьный движок maple использует специальные библиотеки на своём языке более высокого уровня. Так вот эти библиотеки от отдельного релиза MapleV R4 подходят к MC11, более того, они расширяют спектр доступных символьных функций, но важнее всего то, что ни от одного другого релиза (MVR2 или MVR5) такие библиотеки не подходят. Это говорит о возможной даже бинарной идентичности кода символьного движка. Только по-видимому в MVR4 он собран статической компоновкой, а в MC11 поставляется отдельной динамической библиотекой. Думаю, эти соображения возможно сделают более успешной мою задачу.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=108021&amp;user=8321&amp;forum_n=5&amp;topic=7040.html&amp;page=0&amp;anchor=2" class="addthx" data-post="108021"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]uni[/b]','')">uni</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 2.4 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.59'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=8321">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 декабря 2006 11:52 &middot; Поправил: uni <br><script type="text/javascript">QU('uni','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=uni" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=7040.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
Дополню ещё. На всякий случай. Я тему не с потолка взял и хоть и новичок в этом деле, но кое-что всё-таки умею. Вот немного картинок моего творчества:<br>Экспериментальный Peviewer, восстановленный после прочтения книжки Румянцева:<br>http://l.foto.radikal.ru/0612/f0ba52278f13.gif http://l.foto.radikal.ru/0612/f0ba52278f13.gif <br><br>Отладчик для документов Mathcad 11:<br>http://k.foto.radikal.ru/0612/05095c01e127.gif http://k.foto.radikal.ru/0612/05095c01e127.gif <br><br>А эта картинка результат использования dll-ки с функцией CallWin32Api(), с помощью которой я сделал из Mathcad&#039;а транслятор Win32API функций - вещь сама по себе забавная. На картинке ниже я в Mathcad 11 написал классическу программу инициализирующую OpenGL (Hello world был до этого):<br>http://l.foto.radikal.ru/0612/0a1f775bcc12.jpg http://l.foto.radikal.ru/0612/0a1f775bcc12.jpg <br><br>Поскольку я не ломаю ничего, а исследую, то моя задача не совсем я бы сказал стандартная, потому &quot;бряки&quot; на функции окон Win32API, поиск неких строк под IDA и прочие типовые шалости пока применить не могу, т.к. не знаю вообще что искать.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=108036&amp;user=8321&amp;forum_n=5&amp;topic=7040.html&amp;page=0&amp;anchor=3" class="addthx" data-post="108036"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]uni[/b]','')">uni</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 2.4 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.59'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=8321">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 декабря 2006 16:43 <br><script type="text/javascript">QU('uni','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=uni" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=7040.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
По-маленьку начинаю разбираться. Открыл бинарик MVR4 в IDA и параллельно в OllyDbg, с параметром типа asciiz пошёл на хитрость. Сначала просканил память на предмет наличия будущей команды, получил нулевой результат. Далее ввёл команду в среде MVR4 и опять просканил память, получил 2 совпадения. На всякий случай убедился ещё, что искомая строка храниться там постоянно, т.е. адреса не меняются после выполнения команды. Поставил bp на доступ к памяти по этому адресу, выплыл хрен знает где... Посмотрел на другой экран с IDA прыгнул на тот же адрес ... IDA восстановила, что окружение по этому адресу является функцией _strlen(), т.е. стандартной функции из прилинкованной библиотеки ... да-а.... так я наверное далеко не уйду, если буду шариться по стандартным либам. Буду думать как поступить далее. Оказывается, что многим функциям такой параметр может достаться.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=108059&amp;user=8321&amp;forum_n=5&amp;topic=7040.html&amp;page=0&amp;anchor=4" class="addthx" data-post="108059"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]tundra37[/b]','')">tundra37</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 310.8 (мудрец), 29thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.32'>Активность: 0.43<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=4072">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 декабря 2006 06:54 <br><script type="text/javascript">QU('tundra37','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=tundra37" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=7040.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
<b>uni</b> Я думаю, что ты в неправильном направлении ковыряешь. Пока ты еле-еле что-то сделал - в Инете  давно уже есть  MathCad 12 и Maple 9.5 и даже 10-й-  я думаю что там есть такое, что проще их скачать, чем делать велосипед с квадратными колесами <img src="img/smilies/s5.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=108463&amp;user=4072&amp;forum_n=5&amp;topic=7040.html&amp;page=0&amp;anchor=5" class="addthx" data-post="108463"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]gegter[/b]','')">gegter</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 214.1 (наставник)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.6'>Активность: 0.13<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=8261">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 13 декабря 2006 04:05 <br><script type="text/javascript">QU('gegter','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=gegter" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=7040.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
Мда, такого длинного вопроса еще не видел - чуть сам не подвис <img src="img/smilies/s1.gif" alt=""><br>картинки для понта не пойдут...<br><I>А вообще такое смотрят (на что ставить бряки) на деле. если одно не канает берешь другое и вперед.</I><br><b>в принципе ставь бряки на чтение из гл. окна. их название (на eng) должны говорить сами за себя.</b><br>попробуй поломать - хотя бы самое простое - разберись - 100% поможет это и здесь<br>ух, сюда больше не зайду - уж больно вопрос длиииинный.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=108649&amp;user=8261&amp;forum_n=5&amp;topic=7040.html&amp;page=0&amp;anchor=6" class="addthx" data-post="108649"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]uni[/b]','')">uni</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 2.4 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.59'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=8321">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 14 декабря 2006 22:04 <br><script type="text/javascript">QU('uni','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=uni" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=7040.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
<code>uni Я думаю, что ты в неправильном направлении ковыряешь. Пока ты еле-еле что-то сделал - в Инете давно уже есть MathCad 12 и Maple 9.5 и даже 10-й- я думаю что там есть такое, что проще их скачать, чем делать велосипед с квадратными колесами <br></code> Неее, Вы просто не знаете ФИШКИ. У меня есть все эти пакеты и Maple 10, и Mathcad 13, но проблема в том, что к примеру MC13 хуже по функциональности чем MC11, как бы парадоксально это не звучало. А Maple слишком СИМВОЛЬНЫЙ, чтобы решать на нём чисто численные задачи, да и наворочен он. Мне нужно всего по-немножку - так, как это присутствует в MC11 - она скрывает в себе будущее интерфеса математических пакетов - полуграфических полу-в виде командной строки - ЭТО ТО, ЧТО Я ХОЧУ РЕАЛИЗОВАТЬ.<br><br>Окей, вопрос длинный - это да. Но и тема не простая. Я исследую в полном смысле слова и никакими бряками тут сильно не поможешь. С Olly я промашку дал, нифига мне не помог, цифры одни везде... трудновато в нём. Я в IDA сделал что нужно. ИТАК.<br><br><b>КРАТКО СУТЬ</b>: Есть 2 файла. Один .EXE, второй .DLL (это 2 разных файла от разных пакетов, но один кое-что позаимствовал у другого). Экзешник содержит в себе код экспортируемых dll функций. Т.е. в dll&#039;ке имеется 10 записей в таблице экспорта для функций + 3 записи экспортируемых переменных + 2 просто ординалы (не знаю пока что это). Всего получается 15.<br>Я дизассемблировал DLL и EXE по отдельности. Я сделал ПРЕДПОЛОЖЕНИЕ, что куски кода в DLL присутствуют в EXE. Я нашёл эти одинаковые куски. Точность примерно 99.9%, т.е. вплоть до инструкции. Этого и следовало ожидать. Дело в другом. EXE содержит ещё интерфейс, по простому IDE разработки.<br><b>Вот картинка (~100 Кб) чуть разрисовано </b> MC11 + MapleV R4 http://l.foto.radikal.ru/0612/b9007a3f550c.jpg <br>Я всё сделаю сам, мне только нужны наводки по инструментарию. <b>Крякеры Вы тут или всё-таки хакеры</b>? Как я уже говорил я хочу эти 2 интерфейса объединить, т.е. чтобы они запускались от одного процесса - были в адресном пространстве одном. Главным считается Mathcad, т.к. это он подключает DLL с символьным движком. Мне нужно заменить эту DLL на другую, которая кроме самого символьного движка содержит ещё и интерфейс. Я думаю, что это возможно.<br><br>Поскольку я уже сам нашёл все экспортируемые функции, то можно двигаться дальше. А дальше уже труднее гораздо. Мне нужно создать в EXE файле DllEntryPoint() и типовой switch(). Код её у меня есть, нужно внедрить его в dll и изменить точку входа. Ещё нужно поменять аттрибуты EXE файла, чтобы он стал DLL, кроме этого ещё нужно создать секцию экспорта, в котором сделать ссылки на найденные мною функции, чтобы MC подгрузив эту dll-оборотень нашла нужные функции.<br><br>Я конечно понимаю, что читать такой текст трудно, но иначе вообще не въехать никак.<br>Вопросы:<br>1) Можно ли переделать EXE в DLL в принципе?<br>2) Если известны точки входа в функции внутри EXE, можно ли создать секцию экспорта со ссылками на эти функции? Как быть с public областями данных? Т.е. мне нужно ещё кроме функций экспортировать некоторые ячейки с данными... это похожим образом делается?<br><br>Пока хватит.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=109058&amp;user=8321&amp;forum_n=5&amp;topic=7040.html&amp;page=0&amp;anchor=7" class="addthx" data-post="109058"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]uni[/b]','')">uni</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 2.4 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.59'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=8321">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 15 декабря 2006 11:14 &middot; Поправил: uni <br><script type="text/javascript">QU('uni','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=uni" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=7040.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
Идём далее.<br>Хочу для начала изменить точку входа, вставить дополнительный код DllEntryPoint() и табличку экспорта, не важно пока с какими там значениями адресов. Работаем с .EXE. Для начала я просмотрел секцию кода на предмет свободного места. Не много оказалось. До следующей секции 288 байт (0x0120). Код на асме забить можно и секцию экспорта туда тоже поместиться. Секцию экспорта я нашёл в .DLL файле и просто скопировал структуру IMAGE_DIRECTORY_ENTRY_EXPORT (P.S. т.е. я хотел сказать IMAGE_EXPORT_DIRECTORY) прямо в конец секции .text в файле .EXE. Размер её составил 176 байт (0x00B0). Насколько мне помниться есть некоторая свобода в расположении секций и то, что я засунул секцию экспорта в .text - просто немного сейчас усложнит мне жизнь. Пока есть возможность я не хочу менять размера бинарика.<br>Теперь, нужно или не нужно менять NumberOfSections в IMAGE_FILE_HEADER? Вопрос на первый взгляд странный, но в .DLL файле, откуда я взял этот экспорт, найти стандартным путём смещение на таблицу экспорта мне не удалось. Я её поиском нашёл по известным мне именам экспортируемых функций.<br>Так вот... А...аа в IMAGE_DIRECTORY_ENTRY_EXPORT есть запись. Теперь понятно.<br>Тогда такой вопрос. Теперь мне нужно заполнить просто поля: VirtualAddress и Size. Если с последним понятно, то как правильно выбрать VirtualAddress? Просмотреть все записи массива IMAGE_DATA_DIRECTORY, найти самый большой адрес и что-то к нему прибавив записать в качестве VirtualAddress для секции экспорта, так? Как должен образ таблицы экспорта располагаться в памяти после загрузки? Также как в файле - в секции кода - или всё таки в своей собвстенной области какой?<br><br>Я не слишком замудрил? Потом перейду к написанию DllEntryPoint() и возможно модификации таблицы перемещений.<br><br>P.S. Блин я ошибся с размером секции экспорта. Не правильно смещение вычислил. Она оказалась больше ... можно было и догадаться... там же три массива кроме шапки. Куда его засунуть теперь...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=109213&amp;user=8321&amp;forum_n=5&amp;topic=7040.html&amp;page=0&amp;anchor=8" class="addthx" data-post="109213"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]uni[/b]','')">uni</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 2.4 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.59'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=8321">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 20 декабря 2006 11:20 <br><script type="text/javascript">QU('uni','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=uni" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=7040.html&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
Итак, вроде бы <b>заработало</b>. После многочисленных телодвижений <i class=x>exe</i> превратился в <i class=x>dll</i>, но пока я не стал интерфейс запускать. Надо сказать, что я не всё подчистить как надо, но Mathcad пока не ругается, решает как полагается. Для этого потребовалось совсем не много:<br>1) Я создал секцию экспорта, нашёл все функции (кроме одной) и прописал их адреса в секции<br>2) Одну функцию пришлось прямо в машинных кодах дописывать к секции кода. Благо она небольшая, но 2 релокейшна придётся делеать для неё, т.к. две инструкции обращаются по абсолютным адресам. Хорошо, что эта функция предназначена только для небольшого мониторинга.<br>3) Также к секции кода дописал заглушку DllMain и поменял точку входа на неё<br>4) Добавил флаг <b>IMAGE_FILE_DLL</b> ([0x96]: 0x210e) , ну и конечно поменял имя на <b>mkernel.dll</b><br><br>Для пущей уверенности дизассемблил заново в IDA - всё тип топ. Релоки в экзешнике были, кроме того, пришлось отдельно проверять работают они или нет - это отдельная история. Самое трудное оказалось правильно таблицу экспорта разрисовать, тут dumbbin помог, каждый раз его просил посмотреть всё ли в порядке.<br><br>Наконец решил подсунуть это дело Mathcad&#039;у (была маленькая вероятность, что сразу заработает). Заработало. Тестирую. Но это ещё не всё.<br><br><b>ВОПРОС</b>. В dll содержится код MDI приложения, там обычный код, начинающийся со <i class=x>start </i>и т.д. Мне нужно, чтобы при инициализации dll этот код получил управление и отобразил (создал) интерфейс, причём потом вернул управление обратно для загрузки остального кода и непосредственно приложения-родителя. Как это делается? Организовать отдельный поток и функцию <i class=x>start()</i> выполнять в нём? Функция эта ведь зациклится наверное, если так, то я не смогу основного приложения загрузить. Как тут быть? Я знаю что это возможно, есть пример, но разбираться долго. Подскажите кто что знает. Спасибо за внимание.<br><br>P.S. Ещё. Стартап коду какие параметры от системы передаются при запуске приложения? Если я хочу сам выполнить вызов по call, то какие переменные и в каком количестве нужно передовать библиотечной функции <i class=x>start()</i>?<br>Если может кого не затруднит показать простой код создания потока и запуска в нём своей функции. Или пошлите за примером. Только одно условие, желательно всё это в машинных кодах <img src="img/smilies/s1.gif" alt=""> Ну если нету в кодах, то хотя бы на masm&#039;е, чтобы лишнего кода было как можно меньше.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=110061&amp;user=8321&amp;forum_n=5&amp;topic=7040.html&amp;page=0&amp;anchor=9" class="addthx" data-post="110061"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]Chup_zZz[/b]','')">Chup_zZz</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 0.9 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.59'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=8358">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 21 декабря 2006 08:59 <br><script type="text/javascript">QU('Chup_zZz','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Chup_zZz" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=7040.html&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
UNI, не нужно драть <img src="img/smilies/s16.gif" alt=""> и усложнять и без того <br>нелегкую жизнь. ПРОСТО откажись от Этой <br>БРЕДОВОЙ идеи. <br>  Секономишь кучу нервов, волос на попе, времени<br>и кучу ресурсов - овчинка вряд ли ВЫДЕЛКИ стоит.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=110255&amp;user=8358&amp;forum_n=5&amp;topic=7040.html&amp;page=0&amp;anchor=10" class="addthx" data-post="110255"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]uni[/b]','')">uni</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 2.4 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.59'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=8321">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 декабря 2006 03:50 <br><script type="text/javascript">QU('uni','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=uni" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=7040.html&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
Эй, Чуп, в каком месте она бредовая? Уже всё работает. Мне сталось интерфейс только поднастроить чтобы вызывался. Для этого я вызову функцию CreateThread() и подставлю ей точку входа start(), т.к. по параметрам они совпадают, кроме того start() не использует указатель на PEB. Где тут бред-то? Моя интуиция меня не подвела, я попал в 10-ку с первой попытки. Сейчас правлю релоки, точнее добавляю. Не надо о людях по себе судить, вредно это.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=110605&amp;user=8321&amp;forum_n=5&amp;topic=7040.html&amp;page=0&amp;anchor=11" class="addthx" data-post="110605"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/nub.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=5&sortBy=0&page=0.html"><b>Вопросы новичков</b></a> <b class=bulletHead>&#8212;&#8250;</b> Выбор инструментов для задачи (+)</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#12" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="5">
<input type="hidden" name="topic" value="7040">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=7040" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
