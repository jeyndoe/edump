<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Вопрос по особенности расчета эффективного адреса в 64-битном режиме - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Подскажите плиз! Я разрабатываю специализированный отладчик под 64-битную Windows Seven. Мне нужно получить адрес TEB для текущего потока, но не могу расчитать эффективный адрес для следующей инструкции: mov rax, gs:[0]. В">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=55995'>tyns777</a>, <a target='_blank' href='?action=userinfo&amp;user=31361'>zds</a>, <a target='_blank' href='?action=userinfo&amp;user=55802'>JustLife</a> (+4 невидимых)</b></span>
</td>
</tr>
</table>

 

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Вопрос по особенности расчета эффективного адреса в 64-битном режиме</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]Mag_3d[/b]','')">Mag_3d</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 9.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.37'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=24494">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 февраля 2010 16:00 <br><script type="text/javascript">QU('Mag_3d','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Mag_3d" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15896.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Подскажите плиз!<br>Я разрабатываю специализированный отладчик под 64-битную Windows Seven.<br>Мне нужно получить адрес TEB для текущего потока, но не могу расчитать эффективный адрес для следующей инструкции:<br><br>mov rax, gs:[0].<br><br>В 32-битной ОС это делалось следующим образом:<br>1) GetThreadContextEx(hThread, &amp;context), и получали селектор fs (в 64-битной ОС стал gs).<br>2) GetThreadSelectorEntry(hThread, context.SegFs, &amp;ldr_entry);<br>3) Base = (ldr_entry.BaseLow) | (ldr_entry.HighWord.Bytes.BaseHi &lt;&lt; 24) | (ldr_entry.HighWord.Bytes.BaseMid &lt;&lt; 16);<br><br>Base - содержит фактически базовый адрес сегмента.<br><br>Теперь о 64-битном режиме, fs заменили на gs.<br>А функция GetThreadSelectorEntry не отрабатывает. <br>В чем проблема???
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=252817&amp;user=24494&amp;forum_n=6&amp;topic=15896.html&amp;page=0&amp;anchor=1" class="addthx" data-post="252817"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 февраля 2010 16:39 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15896.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
Проблема в том, что ты мсдн не читаешь.<br>GetThreadSelectorEntry is only functional on x86-based systems. For systems that are not x86-based, the function returns FALSE.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=252823&amp;user=1556&amp;forum_n=6&amp;topic=15896.html&amp;page=0&amp;anchor=2" class="addthx" data-post="252823"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]Mag_3d[/b]','')">Mag_3d</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 9.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.37'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=24494">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 февраля 2010 17:29 <br><script type="text/javascript">QU('Mag_3d','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Mag_3d" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15896.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
Проблема в том, что я мсдн читаю, <br>мало того могу сказать, что <br><br>функция GetThreadSelectorEntry в 64-битном режиме работает, но в самом конце при <br>любом условии выполняет xor rax, rax <img src="img/smilies/s1.gif" alt=""><br><br>В своем 1-м сообщении я привел просто пример как можно расчитать эффективный адрес для 32-битной ОС.<br><br>А как в 64-битном я просто не знаю.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=252827&amp;user=24494&amp;forum_n=6&amp;topic=15896.html&amp;page=0&amp;anchor=3" class="addthx" data-post="252827"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]Clerk[/b]','')">Clerk</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 255.8 (наставник), 19thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.86'>Активность: 0.15<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=17964">Участник</a><br><font color=blue>vx</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 февраля 2010 18:10 <br><script type="text/javascript">QU('Clerk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Clerk" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15896.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
В x64 сервис NtSetLdtEntries, Nt[Query]SetInformationProcess(ProcessLdtInformation и ProcessLdtSize) и NtQueryInformationThread(ThreadDescriptorTableEntry) сводятся к вызову xKdSetupPciDeviceForDebugging(), которая вляется заглушкой возвращающей STATUS_NOT_IMPLEMENTED.<br>Определяйте TEB из ThreadBasicInformation.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=252831&amp;user=17964&amp;forum_n=6&amp;topic=15896.html&amp;page=0&amp;anchor=4" class="addthx" data-post="252831"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]Mag_3d[/b]','')">Mag_3d</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 9.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.37'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=24494">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 февраля 2010 18:25 <br><script type="text/javascript">QU('Mag_3d','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Mag_3d" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15896.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
Спасибо ща попробую
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=252832&amp;user=24494&amp;forum_n=6&amp;topic=15896.html&amp;page=0&amp;anchor=5" class="addthx" data-post="252832"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]Mag_3d[/b]','')">Mag_3d</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 9.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.37'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=24494">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 февраля 2010 18:41 <br><script type="text/javascript">QU('Mag_3d','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Mag_3d" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15896.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
Вы безусловно правы насчет функции NtQueryInformationThread, <br>но получение адреса TEB - это одна из задач связанных с расчетом полного эффективного адреса (с учетом базы сегмента).<br><br>Все же задача полного расчета эффективного адреса в юзер моде не раскрыта.<br><br>Как все же в Vista64 и Seven64 получить базу сегмента из юзер моде?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=252834&amp;user=24494&amp;forum_n=6&amp;topic=15896.html&amp;page=0&amp;anchor=6" class="addthx" data-post="252834"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]Clerk[/b]','')">Clerk</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 255.8 (наставник), 19thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.86'>Активность: 0.15<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=17964">Участник</a><br><font color=blue>vx</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 февраля 2010 18:43 <br><script type="text/javascript">QU('Clerk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Clerk" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15896.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
<b>Mag_3d</b><br>Как все же в Vista64 и Seven64 получить базу сегмента из юзер мода ? <br>Никак. К дескрипторным таблицам доступ нужен. Из ядра читайте.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=252835&amp;user=17964&amp;forum_n=6&amp;topic=15896.html&amp;page=0&amp;anchor=7" class="addthx" data-post="252835"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]Mag_3d[/b]','')">Mag_3d</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 9.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.37'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=24494">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 февраля 2010 18:49 <br><script type="text/javascript">QU('Mag_3d','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Mag_3d" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15896.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
По-любому, есть решение в юзер моде, остальные отладчики же корректно работают (Microsoft VC например), или  я ошибаюсь? С отладчиками в юзер моде в 64-битном режиме работал мало.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=252838&amp;user=24494&amp;forum_n=6&amp;topic=15896.html&amp;page=0&amp;anchor=8" class="addthx" data-post="252838"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]mak[/b]','')">mak</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3520.jpg" alt=""><br><span class=txtSm>Ранг: 673.3 <font color=magenta>(<b>! !</b>)</font>, 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.48'>Активность: 0.4<span style='color:red'>&searr;</span>0.31</span><br>Статус: <a href="action=userinfo&amp;user=3520">Участник</a><br><font color=blue>CyberMonk</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 февраля 2010 21:14 <br><script type="text/javascript">QU('mak','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=mak" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15896.html&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
fdbg.x86asm.net/download.html<br><br>посмотри тут , это отладчик под 64 ку в ранних версиях была дровина, теперь ее вроде нету. Может что полезное найдешь , код на фасм.
<br><br><font size="1"><i>-----<br>RE In Progress [!] Coding Hazard [!] Stay Clear of this Cube</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=252853&amp;user=3520&amp;forum_n=6&amp;topic=15896.html&amp;page=0&amp;anchor=9" class="addthx" data-post="252853"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]Mag_3d[/b]','')">Mag_3d</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 9.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.37'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=24494">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 февраля 2010 22:17 <br><script type="text/javascript">QU('Mag_3d','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Mag_3d" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15896.html&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
mak спасибо за ссылку,<br>посмотрел исходники, забавненько ....<br><br>В них я нашел вот какую интересную вещь:<br>ThreadLocalBase=GS_segment_register<br><br>Далее размышления на основе документации AMD:<br><br>In 64-bit mode, segmentation is disabled. <br>In 64-bit mode, the FS and GS segment-base registers (unlike the DS, ES, and SS segmentbase<br>registers) can be used as non-zero data-segment base registers for address calculations. <br>...<br>data-segment registers (DS, ES, and SS) have a base address of 0.<br>... <br><br><br>Видимо разработчики не стали заморачиваться на полную реализацию функции:<br>GetThreadSelectorEntry поскольку нужно реально знать только базу gs и этот адрес пишут в <br>ThreadLocalBase.<br><br>Таким образом, получается что <br>gs - для прямой адресации к teb в 64-битном режиме;<br>fs -  для прямой адресации к teb в 32-битном режиме;<br><br>видимо чтобы не путаться самим.<br><br>Согласны?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=252857&amp;user=24494&amp;forum_n=6&amp;topic=15896.html&amp;page=0&amp;anchor=10" class="addthx" data-post="252857"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]Clerk[/b]','')">Clerk</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 255.8 (наставник), 19thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.86'>Активность: 0.15<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=17964">Участник</a><br><font color=blue>vx</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 марта 2010 00:41 &middot; Поправил: Clerk <br><script type="text/javascript">QU('Clerk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Clerk" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15896.html&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
<b>Mag_3d</b><br>&gt; Согласны?<br>Нет. ASLR не забыли ?<br>Нет способа в юзермоде извлечь дескриптор без доступа к ядерной памяти(x64). Так как те сервисы не доступны, также нет способа создавать дескрипторы. Изменив селектор, базу сегмента вы не найдёте. Для сегмента, атрибуты которого можно изменять(к TEB не относится) определить его базу можно аппаратно, при возникновении исключения процессор передаёт в ISR линейный адрес к которому произошло обращение(в Cr2), а далее его получает диспетчер исключений.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=252860&amp;user=17964&amp;forum_n=6&amp;topic=15896.html&amp;page=0&amp;anchor=11" class="addthx" data-post="252860"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]Mag_3d[/b]','')">Mag_3d</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 9.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.37'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=24494">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 марта 2010 08:05 <br><script type="text/javascript">QU('Mag_3d','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Mag_3d" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15896.html&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
&gt; Нет способа в юзермоде извлечь дескриптор без доступа к ядерной памяти(x64). <br>&gt; Так как те сервисы не доступны, также нет способа создавать дескрипторы. Изменив селектор, базу <br>&gt; сегмента вы не найдёте. Для сегмента, атрибуты которого можно изменять(к TEB не относится) <br>&gt; определить его базу можно аппаратно, при возникновении исключения процессор передаёт в ISR <br>&gt; линейный адрес к которому произошло обращение(в Cr2), а далее его получает диспетчер исключений.<br><br>Это  все понятно, мы ВЕЛИ РАЗГОВОР в ветке форума лишь О юзер моде и лишь О расчете эффективного адреса.<br><br>По поводу &quot;согласен&quot; -  я имел введу, что в 32-битном режиме в юзер моде для получения базы сегментов есть функция GetThreadSelectorEntry, а в 64-битном режиме ее нет из-за не целесообразности ее введения как таковой, т.к. fs в 64-битном режиме не используется, а значение базы  gs разработчики размещают в ThreadLocalBase, т.е. остальные базы равны 0.<br><br>Таким образом, считаю обсуждение исчерпаным, <br>если я что-то конечно не упустил для решения названной задачи.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=252876&amp;user=24494&amp;forum_n=6&amp;topic=15896.html&amp;page=0&amp;anchor=12" class="addthx" data-post="252876"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]Clerk[/b]','')">Clerk</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 255.8 (наставник), 19thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.86'>Активность: 0.15<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=17964">Участник</a><br><font color=blue>vx</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 марта 2010 09:50 <br><script type="text/javascript">QU('Clerk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Clerk" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15896.html&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
<b>Mag_3d</b><br>Cr2 передаётся в пользовательский диспетчер, чтоже ты такой не понятливый <img src="img/smilies/s13.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=252879&amp;user=17964&amp;forum_n=6&amp;topic=15896.html&amp;page=0&amp;anchor=13" class="addthx" data-post="252879"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]Mag_3d[/b]','')">Mag_3d</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 9.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.37'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=24494">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 марта 2010 10:10 <br><script type="text/javascript">QU('Mag_3d','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Mag_3d" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15896.html&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
По-моему я описал более простой способ определения ;)<br>Без генерации всяких исключений (особенно когда нужно определить все 1 базовый адрес gs, а не несколько ;)<br><br>Хотя последнее замечание считаю оправданным (в общем случае определения базы какого либо сегмента).<br><br>Только для особо не понятливых (такого как я) объсните как получить значение записанное в cr2 (если я отладчик и занимаюсь трассеровкой некоторого процесса ???
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=252880&amp;user=24494&amp;forum_n=6&amp;topic=15896.html&amp;page=0&amp;anchor=14" class="addthx" data-post="252880"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]Clerk[/b]','')">Clerk</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 255.8 (наставник), 19thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.86'>Активность: 0.15<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=17964">Участник</a><br><font color=blue>vx</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 марта 2010 10:51 <br><script type="text/javascript">QU('Clerk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Clerk" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15896.html&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
<b>Mag_3d</b><br>&gt; как получить значение записанное в cr2 (если я отладчик и занимаюсь трассеровкой некоторого процесса ???<br>Оно передаётся как информация об исключении, вы получите адрес к которому произошло обращение.<br>&gt; По-моему я описал более простой способ определения ;)<br>Сказали ведь, ASLR(рандомизация адресного пространства) выполняется. Сегмент плавает и база его не фиксирована. Решение в #4.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=252884&amp;user=17964&amp;forum_n=6&amp;topic=15896.html&amp;page=0&amp;anchor=15" class="addthx" data-post="252884"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]Mag_3d[/b]','')">Mag_3d</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 9.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.37'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=24494">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 марта 2010 11:11 <br><script type="text/javascript">QU('Mag_3d','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Mag_3d" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15896.html&amp;page=0#16');return false;">#16</a> </span><div align=left><br>
&gt; Сегмент плавает и база его не фиксирована. <br><br>База сегмента gs в ThreadLocalBase.<br>Все остальные базы сегментов равны 0.<br><br>База имеджа совсем другое, и ее рендомизация ни как не связана с базой сегмента (базу имеджа  определить крайне просто отладчику).
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=252886&amp;user=24494&amp;forum_n=6&amp;topic=15896.html&amp;page=0&amp;anchor=16" class="addthx" data-post="252886"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]Mag_3d[/b]','')">Mag_3d</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 9.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.37'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=24494">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 марта 2010 11:16 <br><script type="text/javascript">QU('Mag_3d','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Mag_3d" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15896.html&amp;page=0#17');return false;">#17</a> </span><div align=left><br>
&gt;&gt; как получить значение записанное в cr2 (если я отладчик и занимаюсь трассеровкой некоторого <br>&gt;&gt; процесса ???<br><br>&gt; Оно передаётся как информация об исключении, вы получите адрес к которому произошло обращение.<br><br>Интересно вот мы занимаемся отладкой приложения и как же мне по вашему определить базовый адрес сегмента gs?<br><br>Выставляя инт3 или тф мы можем лишь определить адрес базовый cs.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=252887&amp;user=24494&amp;forum_n=6&amp;topic=15896.html&amp;page=0&amp;anchor=17" class="addthx" data-post="252887"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]Clerk[/b]','')">Clerk</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 255.8 (наставник), 19thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.86'>Активность: 0.15<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=17964">Участник</a><br><font color=blue>vx</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 марта 2010 15:48 <br><script type="text/javascript">QU('Clerk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Clerk" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15896.html&amp;page=0#18');return false;">#18</a> </span><div align=left><br>
<b>Mag_3d</b><br>&gt; База сегмента gs в ThreadLocalBase.<br>База сегмента определена в дескрипторе, который находится в дескрипторной таблице(GDT или LDT) и индексируется селектором. Что есть ThreadLocalBase нам не известно. Плавает это значит что для всех процессов адрес TEB и PEB различны lhc645.wordpress.com/2009/11/07/aslr/<br>Базу TEB в GDT загружает шедулер при свопинге.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=252907&amp;user=17964&amp;forum_n=6&amp;topic=15896.html&amp;page=0&amp;anchor=18" class="addthx" data-post="252907"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]Mag_3d[/b]','')">Mag_3d</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 9.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.37'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=24494">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 марта 2010 19:12 <br><script type="text/javascript">QU('Mag_3d','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Mag_3d" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15896.html&amp;page=0#19');return false;">#19</a> </span><div align=left><br>
Clerk не читаешь мои сообщения:<br><br>mak спасибо за ссылку,<br>посмотрел исходники, забавненько ....<br><br>В них я нашел вот какую интересную вещь:<br>ThreadLocalBase=GS_segment_register<br><br>Далее размышления на основе документации AMD:<br><br>In 64-bit mode, segmentation is disabled. <br>In 64-bit mode, the FS and GS segment-base registers (unlike the DS, ES, and SS segmentbase<br>registers) can be used as non-zero data-segment base registers for address calculations. <br>...<br>data-segment registers (DS, ES, and SS) have a base address of 0.<br>... <br><br><br>Видимо разработчики не стали заморачиваться на полную реализацию функции:<br>GetThreadSelectorEntry поскольку нужно реально знать только базу gs и этот адрес пишут в <br>ThreadLocalBase.<br><br>Таким образом, получается что <br>gs - для прямой адресации к teb в 64-битном режиме;<br>fs - для прямой адресации к teb в 32-битном режиме;
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=252923&amp;user=24494&amp;forum_n=6&amp;topic=15896.html&amp;page=0&amp;anchor=19" class="addthx" data-post="252923"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="20" onfocus="this.blur()" href="JavaScript:di('[b]LoveLab[/b]','')">LoveLab</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 4.6 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.33'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=20263">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 марта 2010 00:28 <br><script type="text/javascript">QU('LoveLab','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=LoveLab" target="_blank">Личное сообщение</a> &middot;  <a href="#20" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15896.html&amp;page=0#20');return false;">#20</a> </span><div align=left><br>
Речь идёт о том, что адреса TEB &amp; PEB в разных процессах различны.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=252948&amp;user=20263&amp;forum_n=6&amp;topic=15896.html&amp;page=0&amp;anchor=20" class="addthx" data-post="252948"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="21" onfocus="this.blur()" href="JavaScript:di('[b]ARCHANGEL[/b]','')">ARCHANGEL</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/6336.png" alt=""><br><span class=txtSm>Ранг: 681.5 <font color=magenta>(<b>! !</b>)</font>, 405thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.85'>Активность: 0.42<span style='color:red'>&searr;</span>0.21</span><br>Статус: <a href="action=userinfo&amp;user=6336">Участник</a><br><font color=blue>ALIEN Hack Team</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 марта 2010 01:28 <br><script type="text/javascript">QU('ARCHANGEL','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ARCHANGEL" target="_blank">Личное сообщение</a> &middot;  <a href="#21" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15896.html&amp;page=0#21');return false;">#21</a> </span><div align=left><br>
<b>Mag_3d пишет:</b><br><i class=x>Clerk не читаешь мои сообщения:</i><br>Да нет, он как раз их читает. Он имеет ввиду (ИМХО), что в gs никак не может находиться сегмент. Там находится селектор, по которому можно определить, к какой из таблиц - LDT или GDT - принадлежит сегмент, описываемый этим селектором. <br><br><i class=x>Базу TEB в GDT загружает шедулер при свопинге.</i><br>Планировщик загружает базу TEB в GDT при обращению к файлу подкачки??? Я правильно понял?
<br><br><font size="1"><i>-----<br>Stuck to the plan, always think that we would stand up, never ran.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=252951&amp;user=6336&amp;forum_n=6&amp;topic=15896.html&amp;page=0&amp;anchor=21" class="addthx" data-post="252951"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="22" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 марта 2010 18:51 &middot; Поправил: <a href="action=stats#mods">Модератор</a> <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#22" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15896.html&amp;page=0#22');return false;">#22</a> </span><div align=left><br>
Какая подкачка, при свопконтексте.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=253009&amp;user=1556&amp;forum_n=6&amp;topic=15896.html&amp;page=0&amp;anchor=22" class="addthx" data-post="253009"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="23" onfocus="this.blur()" href="JavaScript:di('[b]Mag_3d[/b]','')">Mag_3d</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 9.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.37'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=24494">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 марта 2010 19:08 <br><script type="text/javascript">QU('Mag_3d','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Mag_3d" target="_blank">Личное сообщение</a> &middot;  <a href="#23" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15896.html&amp;page=0#23');return false;">#23</a> </span><div align=left><br>
&gt; Он имеет ввиду (ИМХО), что в gs никак не может находиться сегмент. <br><br>Странные вы люди, это и ежику понятно.<br>Я вел разговор про базу сегмента и опускал всегда момент, что gs - это сегментный регистр.<br><br>&gt; Там находится селектор, по которому можно определить, к какой из таблиц - LDT или GDT - <br>&gt; принадлежит сегмент, описываемый этим селектором. <br><br>А по этому поводу все достаточно просто (рассмотрим структуру Segment Selectors - 16 бит):<br><br>Bits         Mnemonic         Description                          R/W<br><br>15-3       SI                      Selector Index                     R/W<br>2             TI                     Table Indicator                     R/W<br>1-0          RPL                   Requestor Privilege Level    R/W<br><br>The TI bit indicates which table holds<br>the descriptor referenced by the selector index. When TI=0 the<br>GDT is used and when TI=1 the LDT is used.<br><br>Таким образом, крайне просто определить принадлежность к таблице LDT или GDT.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=253011&amp;user=24494&amp;forum_n=6&amp;topic=15896.html&amp;page=0&amp;anchor=23" class="addthx" data-post="253011"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="24" onfocus="this.blur()" href="JavaScript:di('[b]Mag_3d[/b]','')">Mag_3d</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 9.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.37'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=24494">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 марта 2010 19:16 <br><script type="text/javascript">QU('Mag_3d','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Mag_3d" target="_blank">Личное сообщение</a> &middot;  <a href="#24" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15896.html&amp;page=0#24');return false;">#24</a> </span><div align=left><br>
&gt; Базу TEB в GDT загружает шедулер при свопинге. <br>&gt; Планировщик загружает базу TEB в GDT при обращению к файлу подкачки??? Я правильно понял?<br><br>Конечно нет. Загрузчик формирует адресное просторанство процесса.<br>И при этом и определяет сегменты (для сегментно-страничной адресации). <br><br>Доступ к памяти при расчете эффективного адреса производится через сегментные регистры: cs, ds, gs, fs, ss, es (для каждого из них есть дескриптор, где указывается задает база, лимит, ...).<br><br>Полный эффективный адрес расчитывается оп формуле: [база сегмента] + base + index*scale + disp8(32).<br>Для простоты реализации микрософт все адресует через [база сегмента] = 0, за исключением в 32-битном режиме сегмента fs, а в 64-битном режиме - gs.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=253012&amp;user=24494&amp;forum_n=6&amp;topic=15896.html&amp;page=0&amp;anchor=24" class="addthx" data-post="253012"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="25" onfocus="this.blur()" href="JavaScript:di('[b]Mag_3d[/b]','')">Mag_3d</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 9.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.37'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=24494">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 марта 2010 19:17 <br><script type="text/javascript">QU('Mag_3d','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Mag_3d" target="_blank">Личное сообщение</a> &middot;  <a href="#25" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15896.html&amp;page=0#25');return false;">#25</a> </span><div align=left><br>
Считаю, что ветку надо закрыть, я лично ответ получил и уже проверил.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=253014&amp;user=24494&amp;forum_n=6&amp;topic=15896.html&amp;page=0&amp;anchor=25" class="addthx" data-post="253014"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="26" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 марта 2010 20:11 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#26" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15896.html&amp;page=0#26');return false;">#26</a> </span><div align=left><br>
Во-первых, автор сам закрыть может, кнопка Закрыть тему под кнопкой Отправить сообщение.<br>Во-вторых, есть кнопка Правка, выучи её уже наконец.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=253018&amp;user=1556&amp;forum_n=6&amp;topic=15896.html&amp;page=0&amp;anchor=26" class="addthx" data-post="253018"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Вопрос по особенности расчета эффективного адреса в 64-битном режиме</span></td>
</tr></table>
</div>
<a name=newreply></a>
<div align=center>
<table class=forums>
<tr>
<td class=caption4 width="100%"><span class=header>Эта тема закрыта. Ответы больше не принимаются.</span></td>
</tr>
</table>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=15896" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
