<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Поменять флаги секции в EXE из вызываемой им DLL - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Понимаю, что вопрос глупый и для решения задачи мне не хватает знания PE формата и ещё много чего, однако может кто подскажет. Есть ЕХЕ файл который вызывает мою длл. Если в нужной секции установить флажок разрешения записи,">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=28016'>asfa</a>, <a target='_blank' href='?action=userinfo&amp;user=41701'>_MBK_</a>, <a target='_blank' href='?action=userinfo&amp;user=41144'>Adler</a> (+8 невидимых)</b></span>
</td>
</tr>
</table>

 

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/nub.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=5&sortBy=0&page=0.html"><b>Вопросы новичков</b></a> <b class=bulletHead>&#8212;&#8250;</b> Поменять флаги секции в EXE из вызываемой им DLL</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]ToBad[/b]','')">ToBad</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/702.gif" alt=""><br><span class=txtSm>Ранг: 450.3 (мудрец), 13thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.67'>Активность: 0.2<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=702">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 декабря 2012 02:40 <br><script type="text/javascript">QU('ToBad','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ToBad" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=20617.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Понимаю, что вопрос глупый и для решения задачи мне не хватает знания PE формата и ещё много чего, однако может кто подскажет.<br>Есть ЕХЕ файл который вызывает мою длл. Если в нужной секции установить флажок разрешения записи, (патч одного байта по адресу &#036;400247 c &#036;60 на &#036;E0) то в длл можно делать так: dword(pointer(&#036;406720)^):=&#036;90909090;<br>По некоторым соображениям не хочется менять EXE файл на диске. Конечно можно использовать связку OpenProcess/WriteProcessMemory и это работает для всех адресов нужной секции, однако не работает для адреса &#036;400247 где располагается флаг секции.<br>Хочется найти вариант как поменять на лету флаг записи, что бы далее пользоваться прямой записью dword(pointer(&#036;406720)^):=&#036;90909090;
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=315725&amp;user=702&amp;forum_n=5&amp;topic=20617.html&amp;page=0&amp;anchor=1" class="addthx" data-post="315725"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]SReg[/b]','')">SReg</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 315.1 (мудрец), 631thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.78'>Активность: 0.3<span style='color:green'>&nearr;</span>0.33</span><br>Статус: <a href="action=userinfo&amp;user=18316">Модератор</a><br><font color=blue>CrackLab</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 декабря 2012 05:13 &middot; Поправил: SReg <br><script type="text/javascript">QU('SReg','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=SReg" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=20617.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
<b>ToBad</b><br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>library</b></span>&nbsp;inject<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_function">uses</span></li><li class="hl_l1">&nbsp;&nbsp;SysUtils<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;Windows<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">{<span class="hl_char">$</span>IMAGEBASE&nbsp;<span class="hl_char">$</span>10000000}</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">procedure&nbsp;MyProc<span class="hl_comment">; stdcall;</span></li><li class="hl_l1"><span class="hl_function"><b>const</b></span>&nbsp;new_characteristics<span class="hl_char">:</span>&nbsp;Cardinal&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">$</span>E0000060<span class="hl_comment">;</span></li><li class="hl_l0">var&nbsp;<span class="hl_function">offset</span><span class="hl_char">,</span>oldprt&nbsp;<span class="hl_char">:</span>&nbsp;Cardinal<span class="hl_comment">;</span></li><li class="hl_l1">begin</li><li class="hl_l0">&nbsp;<span class="hl_function">offset</span><span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;GetModuleHandle<span class="hl_char">(</span>nil<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span class="hl_function">inc</span><span class="hl_char">(</span><span class="hl_function">offset</span><span class="hl_char">,</span><span class="hl_char">$</span><span class="hl_number">21C</span><span class="hl_char">)</span><span class="hl_comment">;  // 21C - посмотришь в ольке, чтоб  по быстрому и без лишнего кода</span></li><li class="hl_l0">&nbsp;VirtualProtect<span class="hl_char">(</span>Pointer<span class="hl_char">(</span><span class="hl_function">offset</span><span class="hl_char">)</span><span class="hl_char">,</span><span class="hl_number">4</span><span class="hl_char">,</span>PAGE_READWRITE<span class="hl_char">,</span>oldprt<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;CopyMemory<span class="hl_char">(</span>Pointer<span class="hl_char">(</span><span class="hl_function">offset</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">Addr</span><span class="hl_char">(</span>new_characteristics<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">4</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">VirtualProtect<span class="hl_char">(</span>Pointer<span class="hl_char">(</span><span class="hl_function">offset</span><span class="hl_char">)</span><span class="hl_char">,</span><span class="hl_number">4</span><span class="hl_char">,</span>oldprt<span class="hl_char">,</span>oldprt<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span class="hl_function"><b>end</b></span><span class="hl_comment">;  </span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">procedure&nbsp;DLLEntryPoint<span class="hl_char">(</span>dwReason<span class="hl_char">:</span>&nbsp;<span class="hl_function">DWORD</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">begin</li><li class="hl_l1">&nbsp;case&nbsp;dwReason&nbsp;of</li><li class="hl_l0">&nbsp;&nbsp;DLL_PROCESS_ATTACH<span class="hl_char">:</span></li><li class="hl_l1">&nbsp;&nbsp;begin</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;MyProc<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;DLL_PROCESS_DETACH<span class="hl_char">:</span></li><li class="hl_l1">&nbsp;&nbsp;begin</li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;<span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">exports</li><li class="hl_l1">MyProc<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">begin</li><li class="hl_l0">&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;@DllProc&nbsp;<span class="hl_char">=</span>&nbsp;nil&nbsp;then</li><li class="hl_l1">&nbsp;begin</li><li class="hl_l0">&nbsp;&nbsp;DllProc&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;@DLLEntryPoint<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;DllEntryPoint<span class="hl_char">(</span>Dll_Process_Attach<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;<span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l1"><span class="hl_function">end</span><span class="hl_char">.</span></li>        </ol>
    </div>
</div></div>
<br>в аттаче работающий пример<br><br><br><img src="img/attach.gif" alt=""> <a href="./files/683a_18.12.2012_EXELAB.rU.tgz">683a_18.12.2012_EXELAB.rU.tgz</a> - Project1.rar
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=315729&amp;user=18316&amp;forum_n=5&amp;topic=20617.html&amp;page=0&amp;anchor=2" class="addthx" data-post="315729"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=702" title="18-12-2012 11:58, ранг:433.9" target="_blank">ToBad</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]ToBad[/b]','')">ToBad</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/702.gif" alt=""><br><span class=txtSm>Ранг: 450.3 (мудрец), 13thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.67'>Активность: 0.2<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=702">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 декабря 2012 06:07 &middot; Поправил: ToBad <br><script type="text/javascript">QU('ToBad','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ToBad" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=20617.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
<b>SReg</b> - спасибо за пример! Код меняет флаг секции, только к сожалению это не помогает. Дальнейшая запись всё равно вызывает исключение, память не может быть записана...<br><br><noindex><a href="http://rghost.ru/42325694" rel="nofollow" target="_blank">Вот мой пример.</a></noindex>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=315732&amp;user=702&amp;forum_n=5&amp;topic=20617.html&amp;page=0&amp;anchor=3" class="addthx" data-post="315732"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]SReg[/b]','')">SReg</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 315.1 (мудрец), 631thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.78'>Активность: 0.3<span style='color:green'>&nearr;</span>0.33</span><br>Статус: <a href="action=userinfo&amp;user=18316">Модератор</a><br><font color=blue>CrackLab</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 декабря 2012 06:47 <br><script type="text/javascript">QU('SReg','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=SReg" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=20617.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
<I>ToBad пишет:<br>Дальнейшая запись всё равно вызывает исключение </I><br>сурово ты написал там)) Вот пробуй...<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>library</b></span>&nbsp;SensApi<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_function">uses</span></li><li class="hl_l1">&nbsp;&nbsp;SysUtils<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;Windows<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">{<span class="hl_char">$</span>IMAGEBASE&nbsp;<span class="hl_char">$</span>10000000}</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">procedure&nbsp;MyProc<span class="hl_comment">; stdcall;</span></li><li class="hl_l1"><span class="hl_function"><b>const</b></span>&nbsp;new_characteristics<span class="hl_char">:</span>&nbsp;Cardinal&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">$</span>E0000020<span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_function"><b>jmp</b></span>&nbsp;<span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>Word</b></span>&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">$</span><span class="hl_number">2BEB</span><span class="hl_comment">;</span></li><li class="hl_l1">var&nbsp;<span class="hl_function">offset</span><span class="hl_char">,</span>oldprt<span class="hl_char">,</span>Hndl&nbsp;<span class="hl_char">:</span>&nbsp;Cardinal<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">begin</li><li class="hl_l0">&nbsp;Hndl<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;GetModuleHandle<span class="hl_char">(</span>nil<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;<span class="hl_function">offset</span><span class="hl_char">:</span><span class="hl_char">=</span>Hndl<span class="hl_char">+</span><span class="hl_char">$</span><span class="hl_number">244</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;VirtualProtect<span class="hl_char">(</span>Pointer<span class="hl_char">(</span><span class="hl_function">offset</span><span class="hl_char">)</span><span class="hl_char">,</span><span class="hl_number">4</span><span class="hl_char">,</span>PAGE_READWRITE<span class="hl_char">,</span>oldprt<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;CopyMemory<span class="hl_char">(</span>Pointer<span class="hl_char">(</span><span class="hl_function">offset</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">Addr</span><span class="hl_char">(</span>new_characteristics<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">4</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;VirtualProtect<span class="hl_char">(</span>Pointer<span class="hl_char">(</span><span class="hl_function">offset</span><span class="hl_char">)</span><span class="hl_char">,</span><span class="hl_number">4</span><span class="hl_char">,</span>oldprt<span class="hl_char">,</span>oldprt<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;<span class="hl_function">offset</span><span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;Hndl&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_char">$</span><span class="hl_number">1BF213</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;VirtualProtect<span class="hl_char">(</span>Pointer<span class="hl_char">(</span><span class="hl_function">offset</span><span class="hl_char">)</span><span class="hl_char">,</span><span class="hl_number">4</span><span class="hl_char">,</span>PAGE_READWRITE<span class="hl_char">,</span>oldprt<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;CopyMemory<span class="hl_char">(</span>Pointer<span class="hl_char">(</span><span class="hl_function">offset</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">Addr</span><span class="hl_char">(</span><span class="hl_function">jmp</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">2</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;VirtualProtect<span class="hl_char">(</span>Pointer<span class="hl_char">(</span><span class="hl_function">offset</span><span class="hl_char">)</span><span class="hl_char">,</span><span class="hl_number">4</span><span class="hl_char">,</span>oldprt<span class="hl_char">,</span>oldprt<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">function&nbsp;IsNetworkAlive<span class="hl_char">(</span>a<span class="hl_char">:</span><span class="hl_function">dword</span><span class="hl_char">)</span><span class="hl_char">:</span>boolean<span class="hl_comment">; stdcall;</span></li><li class="hl_l1">begin</li><li class="hl_l0">Result<span class="hl_char">:</span><span class="hl_char">=</span><span class="hl_function"><b>true</b></span><span class="hl_comment">;</span></li><li class="hl_l1"><span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">procedure&nbsp;DLLEntryPoint<span class="hl_char">(</span>dwReason<span class="hl_char">:</span>&nbsp;<span class="hl_function">DWORD</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">begin</li><li class="hl_l1">&nbsp;case&nbsp;dwReason&nbsp;of</li><li class="hl_l0">&nbsp;&nbsp;DLL_PROCESS_ATTACH<span class="hl_char">:</span></li><li class="hl_l1">&nbsp;&nbsp;begin</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;MyProc<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;DLL_PROCESS_DETACH<span class="hl_char">:</span></li><li class="hl_l1">&nbsp;&nbsp;begin</li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;<span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">exports&nbsp;IsNetworkAlive<span class="hl_char">,</span>&nbsp;MyProc<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">begin</li><li class="hl_l1">&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;@DllProc&nbsp;<span class="hl_char">=</span>&nbsp;nil&nbsp;then</li><li class="hl_l0">&nbsp;begin</li><li class="hl_l1">&nbsp;&nbsp;DllProc&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;@DLLEntryPoint<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;DllEntryPoint<span class="hl_char">(</span>Dll_Process_Attach<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;<span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_function">end</span><span class="hl_char">.</span></li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=315733&amp;user=18316&amp;forum_n=5&amp;topic=20617.html&amp;page=0&amp;anchor=4" class="addthx" data-post="315733"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 декабря 2012 10:08 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=20617.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
После загрузки файла атрибуты секций уже никому не нужны, там что брось лезть, куда не нужно, и пытаться вылечить покойника.<br>Либо делай руками VirtualProtect на всю секцию, что достаточно криво, но удовлетворит постановке задачи, что потом можно будет писать прямо. Либо меняй атрибуты только на время патча и потом возвращай обратно.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=315739&amp;user=1556&amp;forum_n=5&amp;topic=20617.html&amp;page=0&amp;anchor=5" class="addthx" data-post="315739"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=702" title="18-12-2012 11:58, ранг:433.9" target="_blank">ToBad</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]ToBad[/b]','')">ToBad</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/702.gif" alt=""><br><span class=txtSm>Ранг: 450.3 (мудрец), 13thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.67'>Активность: 0.2<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=702">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 декабря 2012 15:58 &middot; Поправил: ToBad <br><script type="text/javascript">QU('ToBad','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ToBad" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=20617.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
<b>SReg</b> - в том то и дело, что конструкцию типа этой использовать не хотел:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function">offset</span><span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;Hndl&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_char">$</span><span class="hl_number">1BF213</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;VirtualProtect<span class="hl_char">(</span>Pointer<span class="hl_char">(</span><span class="hl_function">offset</span><span class="hl_char">)</span><span class="hl_char">,</span><span class="hl_number">4</span><span class="hl_char">,</span>PAGE_READWRITE<span class="hl_char">,</span>oldprt<span class="hl_char">)</span><span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div>
<br><br><I>Archer пишет:<br>Либо делай руками VirtualProtect на всю секцию, что достаточно криво, но удовлетворит постановке задачи, что потом можно будет писать прямо. </I><br><br>Да, это то, что нужно. Просто пример <b>SReg</b> расширю на участок попадающий под патч, между двух VirtualProtect сделаю всё что нужно и будет работать!<br><br>Всем спасибо за помощь!
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=315751&amp;user=702&amp;forum_n=5&amp;topic=20617.html&amp;page=0&amp;anchor=6" class="addthx" data-post="315751"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/nub.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=5&sortBy=0&page=0.html"><b>Вопросы новичков</b></a> <b class=bulletHead>&#8212;&#8250;</b> Поменять флаги секции в EXE из вызываемой им DLL</span></td>
</tr></table>
</div>
<a name=newreply></a>
<div align=center>
<table class=forums>
<tr>
<td class=caption4 width="100%"><span class=header>Эта тема закрыта. Ответы больше не принимаются.</span></td>
</tr>
</table>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=20617" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
