<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Скриптинг в OllyDbg. Плагин Playtime - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Приветствую участников форума! Начиная разбираться в практическом использовании плагина lua-скриптов Playtime для OllyDbg 2.01 столкнулся с недопониманием ряда вопросов. Не всё оказалось так просто и очевидно, даже несмотря на">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=55995'>tyns777</a>, <a target='_blank' href='?action=userinfo&amp;user=53803'>localhost1</a>, <a target='_blank' href='?action=userinfo&amp;user=40607'>vsv1</a>, <a target='_blank' href='?action=userinfo&amp;user=28016'>asfa</a> (+6 невидимых)</b></span>
</td>
</tr>
</table>

 

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/nub.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=5&sortBy=0&page=0.html"><b>Вопросы новичков</b></a> <b class=bulletHead>&#8212;&#8250;</b> Скриптинг в OllyDbg. Плагин Playtime</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]rukop84[/b]','')">rukop84</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 16.6 (новичок), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.22'>Активность: 0.03<span style='color:green'>&nearr;</span>0.16</span><br>Статус: <a href="action=userinfo&amp;user=25117">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 февраля 2020 00:12 &middot; Поправил: rukop84 <br><script type="text/javascript">QU('rukop84','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=rukop84" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=26296.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Приветствую участников форума!<br><br>Начиная разбираться в практическом использовании плагина lua-скриптов Playtime для OllyDbg 2.01 столкнулся с недопониманием ряда вопросов. Не всё оказалось так просто и очевидно, даже несмотря на наличие справки и примеров в комплекте. Поэтому, собственно и был создан этот Топик.<br><br>В дальнейшем Тему планирую оставить открытой, чтобы при необходимости можно было продолжить обсуждение вопросов связанных с данным плагином.<br><br>Говорят лучше всего осваивать навык на простых примерах и упражнениях. Поэтому, далеко не буду отходить от этой прописной истины. Для тестов и экспериментов взял простой Crackme от Truehead&#039;a (подойдет любой, главное разобраться в синтаксисе скриптов).<br><br>-------------------------------------------------------------------------------------------------------------------<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">Для&nbsp;начала&nbsp;опишу&nbsp;словами&nbsp;что&nbsp;я&nbsp;хочу&nbsp;сделать&nbsp;с&nbsp;помощью&nbsp;скрипта<span class="hl_char">:</span></li><li class="hl_l1"><span class="hl_number">1</span><span class="hl_char">.</span>&nbsp;сохранить&nbsp;в&nbsp;память&nbsp;по&nbsp;адресу&nbsp;<span class="hl_char">[</span><span class="hl_number">402000</span><span class="hl_char">]</span>&nbsp;строку&nbsp;<span class="hl_quote">'Hello_World!'</span>&nbsp;<span class="hl_char">(</span>байт&nbsp;код<span class="hl_char">:</span>&nbsp;<span class="hl_number">48</span>&nbsp;<span class="hl_number">65</span>&nbsp;<span class="hl_number">6C</span>&nbsp;<span class="hl_number">6C</span>&nbsp;<span class="hl_number">6F</span>&nbsp;<span class="hl_number">5F</span>&nbsp;<span class="hl_number">57</span>&nbsp;<span class="hl_number">6F</span>&nbsp;<span class="hl_number">72</span>&nbsp;<span class="hl_number">6C</span>&nbsp;<span class="hl_number">64</span>&nbsp;<span class="hl_number">21</span><span class="hl_char">)</span></li><li class="hl_l0"><span class="hl_number">2</span><span class="hl_char">.</span>&nbsp;установить&nbsp;HBP&nbsp;на&nbsp;execute&nbsp;по&nbsp;адресу&nbsp;<span class="hl_number">401068</span></li><li class="hl_l1"><span class="hl_number">3</span><span class="hl_char">.</span>&nbsp;установить&nbsp;обработчик&nbsp;исключений<span class="hl_char">,</span>&nbsp;когда&nbsp;таковое&nbsp;произойдет&nbsp;или&nbsp;сработает&nbsp;установленный&nbsp;HBP</li><li class="hl_l0"><span class="hl_number">4</span><span class="hl_char">.</span>&nbsp;запустить&nbsp;программу&nbsp;<span class="hl_char">(</span>F9<span class="hl_char">)</span></li><li class="hl_l1"><span class="hl_number">5</span><span class="hl_char">.</span>&nbsp;проверить&nbsp;по&nbsp;какому&nbsp;адресу&nbsp;произошло&nbsp;исключение<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">5</span><span class="hl_char">.</span><span class="hl_number">1</span>&nbsp;если&nbsp;адрес&nbsp;будет&nbsp;равен&nbsp;адресу&nbsp;нашего&nbsp;HBP<span class="hl_char">,</span>&nbsp;то<span class="hl_char">:</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">5</span><span class="hl_char">.</span><span class="hl_number">1</span><span class="hl_char">.</span><span class="hl_number">1</span>&nbsp;заменить&nbsp;значение&nbsp;в&nbsp;стеке&nbsp;<span class="hl_char">[</span><span class="hl_registr">esp</span><span class="hl_char">+</span><span class="hl_number">14</span><span class="hl_char">]</span>&nbsp;на&nbsp;<span class="hl_number">00000004</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">5</span><span class="hl_char">.</span><span class="hl_number">1</span><span class="hl_char">.</span><span class="hl_number">2</span>&nbsp;сделать&nbsp;Step&nbsp;Over&nbsp;<span class="hl_char">(</span>F8<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">5</span><span class="hl_char">.</span><span class="hl_number">1</span><span class="hl_char">.</span><span class="hl_number">3</span>&nbsp;удалить&nbsp;установленный&nbsp;ранее&nbsp;HBP</li><li class="hl_l0"><span class="hl_number">6</span><span class="hl_char">.</span>&nbsp;удалить&nbsp;установленный&nbsp;в&nbsp;шаге&nbsp;<span class="hl_number">3</span>&nbsp;обработчик&nbsp;исключений</li><li class="hl_l1"><span class="hl_number">7</span><span class="hl_char">.</span>&nbsp;завершить&nbsp;работу&nbsp;скрипта</li>        </ol>
    </div>
</div></div>
<br><br>-------------------------------------------------------------------------------------------------------------------<br>А вот как бы этот скрипт выглядел, если бы он создавался в плагине OllyScript:<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">scr_begin<span class="hl_char">:</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_number">402000</span><span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;#48656C6C6F5F576F726C6421#&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>запись&nbsp;в&nbsp;память&nbsp;<span class="hl_quote">'Hello_World!'</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bphws&nbsp;<span class="hl_number">401068</span><span class="hl_char">,</span>&nbsp;<span class="hl_quote">&quot;x&quot;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>устанавливаем&nbsp;hardware<span class="hl_char">-</span>бряк&nbsp;на&nbsp;выполнение</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eob&nbsp;scr_eip_checked&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_char">/</span><span class="hl_char">/</span>устанавливаем&nbsp;обработчик&nbsp;исключений</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">scr_continue<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;run&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>F9</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jmp</b></span>&nbsp;scr_end</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">scr_eip_checked<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cmp</b></span>&nbsp;eip<span class="hl_char">,</span>&nbsp;<span class="hl_number">401068</span>&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>проверяем&nbsp;это&nbsp;сработал&nbsp;наш&nbsp;бряк&nbsp;или&nbsp;что<span class="hl_char">-</span>то&nbsp;еще</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>je</b></span>&nbsp;scr_body&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>если&nbsp;это&nbsp;был&nbsp;наш&nbsp;бряк<span class="hl_char">,</span>&nbsp;то&nbsp;переходим&nbsp;на&nbsp;соответствующую&nbsp;метку</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jmp</b></span>&nbsp;scr_continue&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>иначе&nbsp;переходим&nbsp;на&nbsp;метку&nbsp;продолжить</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">scr_body<span class="hl_char">:</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">esp</span><span class="hl_char">+</span><span class="hl_number">14</span><span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">4</span>&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>изменяем&nbsp;значение&nbsp;стека</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sto&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>F8</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bphwc&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>удаляем&nbsp;установленный&nbsp;ранее&nbsp;бряк</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cob&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>удаляем&nbsp;обработчик&nbsp;исключений</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">scr_end<span class="hl_char">:</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>ret</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>завершаем&nbsp;работу&nbsp;скрипта</li>        </ol>
    </div>
</div></div>
<br>	<br>-------------------------------------------------------------------------------------------------------------------<br>Ну, а теперь перейдем к lua-скриптингу плагина Playtime (с чем у меня возникли сложности и непонимание):<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_char">-</span><span class="hl_char">-</span>&nbsp;<span class="hl_number">1</span><span class="hl_char">.</span>&nbsp;записываем&nbsp;в&nbsp;память&nbsp;<span class="hl_quote">'Hello_World!'</span></li><li class="hl_l1">WriteMemoryULong<span class="hl_char">(</span>0x00402000<span class="hl_char">,</span>&nbsp;0x6c6c6548<span class="hl_char">)</span></li><li class="hl_l0">WriteMemoryULong<span class="hl_char">(</span>0x00402004<span class="hl_char">,</span>&nbsp;0x6f575f6f<span class="hl_char">)</span></li><li class="hl_l1">WriteMemoryULong<span class="hl_char">(</span>0x00402008<span class="hl_char">,</span>&nbsp;0x21646c72<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_char">-</span><span class="hl_char">-</span>&nbsp;<span class="hl_number">2</span><span class="hl_char">.</span>&nbsp;устанавливаем&nbsp;HBP</li><li class="hl_l0">SetHardBreakpoint<span class="hl_char">(</span><span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;0x00401068<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_char">-</span><span class="hl_char">-</span>&nbsp;<span class="hl_number">3</span><span class="hl_char">.</span>&nbsp;устанавливаем&nbsp;обработчик&nbsp;исключений</li><li class="hl_l1"><span class="hl_function"><b>local</b></span>&nbsp;handle&nbsp;<span class="hl_char">=</span>&nbsp;Event<span class="hl_char">.</span>Listen<span class="hl_char">(</span><span class="hl_quote">&quot;Exception&quot;</span><span class="hl_char">,</span>&nbsp;function<span class="hl_char">(</span>info<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eip_checked<span class="hl_char">(</span><span class="hl_char">)</span></li><li class="hl_l1"><span class="hl_function">end</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_char">-</span><span class="hl_char">-</span>&nbsp;<span class="hl_number">4</span><span class="hl_char">.</span>&nbsp;запускаем&nbsp;программу</li><li class="hl_l0">Continue<span class="hl_char">(</span><span class="hl_char">)</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_char">-</span><span class="hl_char">-</span>&nbsp;<span class="hl_number">5</span><span class="hl_char">.</span>&nbsp;проверяем&nbsp;по&nbsp;какому&nbsp;адресу&nbsp;произошло&nbsp;исключение</li><li class="hl_l1">function&nbsp;eip_checked<span class="hl_char">(</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;EIP&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;0x000401068&nbsp;then</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">-</span><span class="hl_char">-</span>&nbsp;если&nbsp;истина<span class="hl_char">,</span>&nbsp;то<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">-</span><span class="hl_char">-</span>&nbsp;изменяем&nbsp;значение&nbsp;в&nbsp;стеке&nbsp;по&nbsp;адресу&nbsp;<span class="hl_char">[</span><span class="hl_registr">esp</span><span class="hl_char">+</span><span class="hl_number">14</span><span class="hl_char">]</span>&nbsp;на&nbsp;<span class="hl_number">4</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Assembler<span class="hl_char">.</span>Make<span class="hl_char">(</span>ip<span class="hl_char">,</span>&nbsp;string<span class="hl_char">.</span><span class="hl_function">format</span><span class="hl_char">(</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">[</span><span class="hl_char">[</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">esp</span><span class="hl_char">+</span><span class="hl_number">14</span><span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">4</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function">ret</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">]</span><span class="hl_char">]</span><span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">-</span><span class="hl_char">-</span>&nbsp;F8<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StepOver<span class="hl_char">(</span><span class="hl_char">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">-</span><span class="hl_char">-</span>&nbsp;удаляем&nbsp;установленный&nbsp;ранее&nbsp;бряк<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RemoveHardBreakpoint<span class="hl_char">(</span><span class="hl_number">0</span><span class="hl_char">)</span>&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">-</span><span class="hl_char">-</span>&nbsp;удаляем&nbsp;обработчик&nbsp;исключений<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Event<span class="hl_char">.</span>Remove<span class="hl_char">(</span>handle<span class="hl_char">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">else</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">-</span><span class="hl_char">-</span>&nbsp;иначе&nbsp;продолжаем&nbsp;выполнение&nbsp;программы</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Continue<span class="hl_char">(</span><span class="hl_char">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">end</span></li><li class="hl_l0"><span class="hl_function">end</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_char">-</span><span class="hl_char">-</span>&nbsp;<span class="hl_number">6</span><span class="hl_char">.</span>&nbsp;Выводим&nbsp;сообщение&nbsp;о&nbsp;завершении&nbsp;работы&nbsp;скрипта</li><li class="hl_l1">MsgBox&nbsp;<span class="hl_quote">&quot;Скрипт выполнен!&quot;</span></li>        </ol>
    </div>
</div></div>
<br>-------------------------------------------------------------------------------------------------------------------<br><br>Честно говоря, я уже упарился изменять и отлаживать последний вышеприведенный lua-скрипт. Сейчас просто хочется увидеть работу профессионала:<br>- сам синтаксис и структуру правильного lua-скрипта, его эргономичность, короче, чтоб по науке!!!<br><br>Сами скрипты в окне кода отображаются не идеально, поэтому их вместе с crackme залил сюда <noindex><a href="https://www.sendspace.com/file/u77lqq" rel="nofollow" target="_blank">--&gt; Link &lt;--</a></noindex>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=402596&amp;user=25117&amp;forum_n=5&amp;topic=26296.html&amp;page=0&amp;anchor=1" class="addthx" data-post="402596"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]f13nd[/b]','')">f13nd</a></b><br></div>
<img src="img/s6.gif" alt=""><br><img style="padding-top:3px;" src="av/8075.png" alt=""><br><span class=txtSm>Ранг: 271.2 (наставник), 331thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.63'>Активность: 0.32<span style='color:green'>&nearr;</span>1.49</span><br>Статус: <a href="action=userinfo&amp;user=8075">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 февраля 2020 10:53 <br><script type="text/javascript">QU('f13nd','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=f13nd" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=26296.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
Во-первых настоящие Профессионалы предпочитают классическую тему windows. Во-вторых настоящий Профессионал всегда использует визор. В-третьих ты в эрмитаже свой скрипт выставлять собрался? Работает и ладно, можно было вообще на бесконечном цикле с continue() заколхозить, ограничившись изменением значения в стеке, eip и esp. StepOver() перед удалением бряка странная мера, какая-то слишком профессиональная.
<br><br><font size="1"><i>-----<br>2 оттенка серого</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=402598&amp;user=8075&amp;forum_n=5&amp;topic=26296.html&amp;page=0&amp;anchor=2" class="addthx" data-post="402598"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]rukop84[/b]','')">rukop84</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 16.6 (новичок), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.22'>Активность: 0.03<span style='color:green'>&nearr;</span>0.16</span><br>Статус: <a href="action=userinfo&amp;user=25117">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 февраля 2020 09:55 &middot; Поправил: rukop84 <br><script type="text/javascript">QU('rukop84','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=rukop84" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=26296.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
<I>f13nd пишет:<br>Работает и ладно </I><br>в том-то и дело, что lua-скрипт - нифига не работает. Работает только OllyScript
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=402625&amp;user=25117&amp;forum_n=5&amp;topic=26296.html&amp;page=0&amp;anchor=3" class="addthx" data-post="402625"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]f13nd[/b]','')">f13nd</a></b><br></div>
<img src="img/s6.gif" alt=""><br><img style="padding-top:3px;" src="av/8075.png" alt=""><br><span class=txtSm>Ранг: 271.2 (наставник), 331thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.63'>Активность: 0.32<span style='color:green'>&nearr;</span>1.49</span><br>Статус: <a href="action=userinfo&amp;user=8075">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 февраля 2020 12:27 &middot; Поправил: f13nd <br><script type="text/javascript">QU('f13nd','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=f13nd" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=26296.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br><div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">WriteMemory<span class="hl_char">(</span>0x436000<span class="hl_char">,</span><span class="hl_quote">&quot;Hello_World!\0&quot;</span><span class="hl_char">)</span></li><li class="hl_l1">SetHardBreakpoint<span class="hl_char">(</span><span class="hl_number">0</span><span class="hl_char">,</span>0x00401025<span class="hl_char">,</span>BP_MANUAL<span class="hl_char">+</span>BP_BREAK<span class="hl_char">+</span>BP_EXEC<span class="hl_char">)</span></li><li class="hl_l0">Continue<span class="hl_char">(</span><span class="hl_char">)</span></li><li class="hl_l1"><span class="hl_function"><b>while</b></span>&nbsp;EIP~<span class="hl_char">=</span>0x00401025&nbsp;do</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Continue<span class="hl_char">(</span><span class="hl_char">)</span></li><li class="hl_l1"><span class="hl_function">end</span></li><li class="hl_l0">RemoveHardBreakpoint<span class="hl_char">(</span><span class="hl_number">0</span><span class="hl_char">)</span></li><li class="hl_l1">WriteMemory<span class="hl_char">(</span>EIP<span class="hl_char">,</span>Assembler<span class="hl_char">.</span>Make<span class="hl_char">(</span>EIP<span class="hl_char">,</span><span class="hl_char">[</span><span class="hl_char">[</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_registr">ss</span><span class="hl_char">:</span><span class="hl_char">[</span><span class="hl_registr">esp</span><span class="hl_char">+</span><span class="hl_number">14</span><span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">4</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">ret</span></li><li class="hl_l0"><span class="hl_char">]</span><span class="hl_char">]</span><span class="hl_char">)</span><span class="hl_char">)</span></li>        </ol>
    </div>
</div></div><br><br><font size="1"><i>-----<br>2 оттенка серого</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=402628&amp;user=8075&amp;forum_n=5&amp;topic=26296.html&amp;page=0&amp;anchor=4" class="addthx" data-post="402628"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=25117" title="03-02-2020 14:32, ранг:14.8" target="_blank">rukop84</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]rukop84[/b]','')">rukop84</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 16.6 (новичок), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.22'>Активность: 0.03<span style='color:green'>&nearr;</span>0.16</span><br>Статус: <a href="action=userinfo&amp;user=25117">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 февраля 2020 17:32 &middot; Поправил: rukop84 <br><script type="text/javascript">QU('rukop84','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=rukop84" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=26296.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
Учитель <b>f13nd</b>, Спасибо, очень интересное решение. Думал, что плагин Playtime работает подобно  OllyScript. То есть, др. словами, после строки &#039;03. Continue()&#039; не было бы перехода на след. строку, а программа просто бы выполнялась подобно плагину OllyScript.<br><br>Строки кода 08.-11. - это немного не то. Требуется не патч ассемблерных инструкций в памяти, а изменение значения стека по адресу [esp+14] на значение 4.<br><br>Решение кода, которое Вы написали очень оригинальное. Тем не менее все таки очень хочется разобраться в связке Event.Listen и Event.Remove. С помощью этих связок возможно написать скрипты не только с ключевым словом  &#039;Exception&#039; (как в нашем примере), но и такими событиями как &#039;CreateThread&#039;, &#039;ExitThread&#039;, &#039;LoadDll&#039;, &#039;UnloadDll&#039;, &#039;Int3Breakpoint&#039;, &#039;DebugString&#039;. А это очень ценно в плане исследования приложений.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=402650&amp;user=25117&amp;forum_n=5&amp;topic=26296.html&amp;page=0&amp;anchor=5" class="addthx" data-post="402650"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]rukop84[/b]','')">rukop84</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 16.6 (новичок), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.22'>Активность: 0.03<span style='color:green'>&nearr;</span>0.16</span><br>Статус: <a href="action=userinfo&amp;user=25117">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 февраля 2020 08:39 <br><script type="text/javascript">QU('rukop84','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=rukop84" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=26296.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
Пришел к выводу, что плагин Playtime - это какая-то экзотика:<br>	- популярность у реверсеров почти нулевая;<br>	- в самой справке отсутствуют примеры кода;<br>	- нет достаточного количества примеров, чтобы можно было свободно разобраться в инструменте;<br>	- нет пошаговой отладки кода;<br>	- слишком много уходит времени на написание и отладку простых lua-скриптов;<br>	- в общем инструмент - в топку<br>	<br>Для себя выбрал плагин OllyScript:<br>	- прост в изучении;<br>	- прост в написании скриптов;<br>	- для каждой инструкции - примеры в справке;<br>	- популярен среди реверсеров;<br>	- минимум времени на написание скрипта;<br>	- есть пошаговая отладка скрипта;<br>	- в общем надежен как Пистолет Макарова: стреляет и в дождь, и в грязь, и в песке. Никогда не подведет!!!<br>	<br>Актуальность и ценность Темы для др. участников - нулевая. Тема Закрыта
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=402689&amp;user=25117&amp;forum_n=5&amp;topic=26296.html&amp;page=0&amp;anchor=6" class="addthx" data-post="402689"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/nub.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=5&sortBy=0&page=0.html"><b>Вопросы новичков</b></a> <b class=bulletHead>&#8212;&#8250;</b> Скриптинг в OllyDbg. Плагин Playtime</span></td>
</tr></table>
</div>
<a name=newreply></a>
<div align=center>
<table class=forums>
<tr>
<td class=caption4 width="100%"><span class=header>Эта тема закрыта. Ответы больше не принимаются.</span></td>
</tr>
</table>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=26296" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
