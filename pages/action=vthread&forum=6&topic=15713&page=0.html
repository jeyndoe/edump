<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Высокоскоростной UDP-генератор - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Столкнулся с такой проблемой, необходимо генерировать UDP трафик на максимальной скорости близкой к гигабиту, при этом каждый пакет для передачи в сеть генерируется отдельно и может иметь различный размер, т.е. размер != MTU.  Я">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=55995'>tyns777</a>, <a target='_blank' href='?action=userinfo&amp;user=31361'>zds</a>, <a target='_blank' href='?action=userinfo&amp;user=55802'>JustLife</a> (+3 невидимых)</b></span>
</td>
</tr>
</table>

 

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Высокоскоростной UDP-генератор</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]Vol4ok[/b]','')">Vol4ok</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 47.1 (посетитель), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.61'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=18950">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 января 2010 14:10 <br><script type="text/javascript">QU('Vol4ok','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vol4ok" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15713.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Столкнулся с такой проблемой, необходимо генерировать UDP трафик на максимальной скорости близкой к гигабиту, при этом каждый пакет для передачи в сеть генерируется отдельно и может иметь различный размер, т.е. размер != MTU. <br><br>Я пробовал писать все это дело через WSASendTo, вначале пробовал писать синхронно, но в итоге средние издержки на отсылку одного пакета были порядка 200-400 микросекунд что катастрафически много, ес-но с такими издержками быстродействием тут и не пахнет, зато дропа пакетов при этом не наблюдается. <br><br>После чего я попробовал использовать WSASendTo асинхронно, через колбеки (эвенты в моем случае использовать не возможно, думаю это очевидно), в итоге получилось что издержки стали скакать от 1-300 микросикунд, но при этом пакеты начинают нещадно дропатся и увеличение буфера отправки - никак не помогает. <br><br>Пробовал также слать в WSASendTo сразу массив буферов, но эта дура вместо того чтобы слать каждый буфер по отдельности склиевает буфера в один большой и нарезает их на мелкие размером MTU в итоге имеем пачку фрагментиранных пакетов - что не приемлемо в моем случае. <br><br>Вобщем мой вопрос в том, возможно ли увеличить скорость в рамках юзер мода? и если возможно, то как?<br>В идеале, чтобы слать гигабит время отправки одного пакета должно быть порядка 12 микросекунд - но думаю меня бы устроил результат в пределах 50 микросекунд, только бы остаться в пределах юзермода и не писать драйверов.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=250282&amp;user=18950&amp;forum_n=6&amp;topic=15713.html&amp;page=0&amp;anchor=1" class="addthx" data-post="250282"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]HiEndsoft[/b]','')">HiEndsoft</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 237.0 (наставник), 20thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.74'>Активность: 0.13<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=13651">Участник</a><br><font color=blue>sysenter</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 января 2010 14:42 &middot; Поправил: HiEndsoft <br><script type="text/javascript">QU('HiEndsoft','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=HiEndsoft" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15713.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
Думаю из юзермода - вряд ли: переключение контекстов потоков и все-такое..Единственное готовить буфер в юзермоде, а слать ч/з дровину. (Была какая-то книжка про руткиты - там довольно не плохо это освещалось.)
<br><br><font size="1"><i>-----<br>продавец резиновых утёнков</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=250287&amp;user=13651&amp;forum_n=6&amp;topic=15713.html&amp;page=0&amp;anchor=2" class="addthx" data-post="250287"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]ntldr[/b]','')">ntldr</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 369.8 (мудрец), 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.89'>Активность: 0.39<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=12867">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 января 2010 15:01 <br><script type="text/javascript">QU('ntldr','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ntldr" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15713.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br><div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>int</b></span>&nbsp;main<span class="hl_char">(</span><span class="hl_function"><b>int</b></span>&nbsp;argc<span class="hl_char">,</span>&nbsp;<span class="hl_function">char</span><span class="hl_char">*</span>&nbsp;argv<span class="hl_char">[</span><span class="hl_char">]</span><span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SOCKADDR_IN&nbsp;ina<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SOCKET&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sock<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WSADATA&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wsa_d<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>char</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buff<span class="hl_char">[</span><span class="hl_number">1024</span><span class="hl_char">]</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WSAStartup<span class="hl_char">(</span>MAKEWORD<span class="hl_char">(</span><span class="hl_number">2</span><span class="hl_char">,</span><span class="hl_number">2</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>wsa_d<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ina<span class="hl_char">.</span>sin_family&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">=</span>&nbsp;AF_INET<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ina<span class="hl_char">.</span>sin_addr<span class="hl_char">.</span>S_un<span class="hl_char">.</span>S_addr&nbsp;<span class="hl_char">=</span>&nbsp;inet_addr<span class="hl_char">(</span><span class="hl_quote">&quot;192.168.1.1&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ina<span class="hl_char">.</span>sin_port&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">=</span>&nbsp;htons<span class="hl_char">(</span><span class="hl_number">123</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;<span class="hl_char">(</span>i&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_comment">; i &lt; sizeof(buff); i++) {</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buff<span class="hl_char">[</span>i<span class="hl_char">]</span>&nbsp;<span class="hl_char">=</span>&nbsp;i<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>&nbsp;<span class="hl_char">(</span>sock&nbsp;<span class="hl_char">=</span>&nbsp;socket<span class="hl_char">(</span>AF_INET<span class="hl_char">,</span>&nbsp;SOCK_DGRAM<span class="hl_char">,</span>&nbsp;IPPROTO_UDP<span class="hl_char">)</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;SOCKET_ERROR&nbsp;<span class="hl_char">)</span>&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;<span class="hl_char">(</span><span class="hl_comment">;;) {</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sendto<span class="hl_char">(</span>sock<span class="hl_char">,</span>&nbsp;buff<span class="hl_char">,</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>buff<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">(</span><span class="hl_function">void</span><span class="hl_char">*</span><span class="hl_char">)</span><span class="hl_char">&amp;</span>ina<span class="hl_char">,</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>ina<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l1">}</li>        </ol>
    </div>
</div></div>
<br>У меня этот код спокойно выдает 500мбит/c трафика.
<br><br><font size="1"><i>-----<br>PGP key <noindex><a href="https://diskcryptor.net/storage/new_key.asc" rel="nofollow" target="_blank">&lt0x1B6A24550F33E44A&gt</a></noindex></i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=250290&amp;user=12867&amp;forum_n=6&amp;topic=15713.html&amp;page=0&amp;anchor=3" class="addthx" data-post="250290"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]ntldr[/b]','')">ntldr</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 369.8 (мудрец), 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.89'>Активность: 0.39<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=12867">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 января 2010 15:20 <br><script type="text/javascript">QU('ntldr','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ntldr" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15713.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
Попробовал отсылать асинхронно через IO Completion Ports, добился 923 мбит/сек при одновременной отсылке 100 пакетов.
<br><br><font size="1"><i>-----<br>PGP key <noindex><a href="https://diskcryptor.net/storage/new_key.asc" rel="nofollow" target="_blank">&lt0x1B6A24550F33E44A&gt</a></noindex></i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=250294&amp;user=12867&amp;forum_n=6&amp;topic=15713.html&amp;page=0&amp;anchor=4" class="addthx" data-post="250294"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]sendersu[/b]','')">sendersu</a></b><br></div>
<img src="img/s8.gif" alt=""><br><span class=txtSm>Ранг: 512.7 (<b>!</b>), 360thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.56'>Активность: 0.27<span style='color:red'>&searr;</span>0.03</span><br>Статус: <a href="action=userinfo&amp;user=14629">Модератор</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 января 2010 15:49 <br><script type="text/javascript">QU('sendersu','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=sendersu" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15713.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
<b>ntldr</b><br>можно пример?(как в пред. посте)<br>Спс
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=250297&amp;user=14629&amp;forum_n=6&amp;topic=15713.html&amp;page=0&amp;anchor=5" class="addthx" data-post="250297"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]ntldr[/b]','')">ntldr</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 369.8 (мудрец), 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.89'>Активность: 0.39<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=12867">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 января 2010 17:04 <br><script type="text/javascript">QU('ntldr','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ntldr" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15713.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
<I>sendersu пишет:<br>можно пример?(как в пред. посте) </I><br>Извини, я писал тест не на API, а на коммерческой библиотеке асинхронного ввода-вывода, исходники которой открывать не имею права.<br><br>З.Ы. ещё можно отправить много UDP пакетов сразу через ф-ю TransmitPackets
<br><br><font size="1"><i>-----<br>PGP key <noindex><a href="https://diskcryptor.net/storage/new_key.asc" rel="nofollow" target="_blank">&lt0x1B6A24550F33E44A&gt</a></noindex></i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=250302&amp;user=12867&amp;forum_n=6&amp;topic=15713.html&amp;page=0&amp;anchor=6" class="addthx" data-post="250302"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]Vol4ok[/b]','')">Vol4ok</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 47.1 (посетитель), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.61'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=18950">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 января 2010 18:36 <br><script type="text/javascript">QU('Vol4ok','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vol4ok" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15713.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
<b>ntldr</b><br>хм, у меня посути такой же код, с той лишь что у меня дополнительно еще весит тред который слушает и отвечает на том же сокете, НО интенсивность трафика там практически нулевая(раз в пол секнуды могут приходить и уходить пакеты по 50-100 байт). <br><br>Я замеряю время следующим образом<br>QueryPerformanceFrequency(&amp;fq);<br>...<br>QueryPerformanceCounter(&amp;t1);<br>//Send buffer...<br>QueryPerformanceCounter(&amp;t2);<br>n++; //количество пакетов<br>t += (t2.QuadPart-t1.QuadPart)*1000000/fq.QuadPart; //t - суммарное время отправки в микросекундах<br>...<br>и вконце нахожу средение время dt = t/n которое оказывается &gt;100 мкс. <br><br>Мультипоточная отсылка с использованием IO Completion Port в данном случае слишком громоздка так как важна очередность пакетов, и следовательно очень сложно синхранизировать патоки правильным образом.<br><br>TransmitPackets еще не пробовал, но сча попробую с ним разобраться, спс за идею.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=250310&amp;user=18950&amp;forum_n=6&amp;topic=15713.html&amp;page=0&amp;anchor=7" class="addthx" data-post="250310"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]ntldr[/b]','')">ntldr</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 369.8 (мудрец), 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.89'>Активность: 0.39<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=12867">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 января 2010 18:43 <br><script type="text/javascript">QU('ntldr','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ntldr" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15713.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
<I>Vol4ok пишет:<br>с той лишь что у меня дополнительно еще весит тред который слушает и отвечает на том же сокете </I><br>Никогда не используй блокирующие сокеты одновременно в двух тредах, ибо вызванная одним тредом операция будет блокировать другие. Используй select и делай всё в одном потоке, или переходи на IOCP модель.<br><br><I>Vol4ok пишет:<br>так как важна очередность пакетов </I><br>В таком случае ты выбрал не тот протокол. UDP не гарантирует сохранение порядка доставки пакетов. Используй TCP или делай свой протокол нечувствительным к порядку доставки. Конечно можно отправлять пакеты строго последовательно, и надеяться что сетевое оборудование не изменит их порядок, но хорошей производительности не добьешся даже в kernel mode, т.к. сетевая карта наиболее эффективно отсылает пакеты пулом из нескольких сотен штук.
<br><br><font size="1"><i>-----<br>PGP key <noindex><a href="https://diskcryptor.net/storage/new_key.asc" rel="nofollow" target="_blank">&lt0x1B6A24550F33E44A&gt</a></noindex></i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=250311&amp;user=12867&amp;forum_n=6&amp;topic=15713.html&amp;page=0&amp;anchor=8" class="addthx" data-post="250311"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]Vol4ok[/b]','')">Vol4ok</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 47.1 (посетитель), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.61'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=18950">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 января 2010 19:15 &middot; Поправил: Vol4ok <br><script type="text/javascript">QU('Vol4ok','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vol4ok" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15713.html&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
<I>ntldr пишет:<br>Никогда не используй блокирующие сокеты одновременно в двух тредах, ибо вызванная одним тредом операция будет блокировать другие. Используй select и делай всё в одном потоке, или переходи на IOCP модель. </I><br>Согласен, возможно причина в этом, сча как раз переписываю код, чтобы проверить. Но в идеале все должно быть как сделано у меня, а именно несколько тредов на одном порте, я прекрасно понимаю что проще сделать через несколько портов, но таковы требования, и менять возможно только в крайних случаях.<br><br><I>ntldr пишет:<br>В таком случае ты выбрал не тот протокол. UDP не гарантирует сохранение порядка доставки пакетов. Используй TCP или делай свой протокол нечувствительным к порядку доставки. </I><br>Протокол стандартизирован, я не могу его менять, изменение порядка доставки на практике я не встречал, а в случае потери пакетов у протокола имеются механизмы ресенда, но ес-но потери должны быть в пределах разумного.<br><br><I>ntldr пишет:<br>Конечно можно отправлять пакеты строго последовательно, и надеяться что сетевое оборудование не изменит их порядок, но хорошей производительности не добьешся даже в kernel mode, т.к. сетевая карта наиболее эффективно отсылает пакеты пулом из нескольких сотен штук.  </I><br>Именно такая модель была бы эффективнее всего, если была возможность отправлять сразу пул пакетов и как раз по несколько сотен штук, но пока я не вижу как это можно было бы реализовать в юзер моде с помощью имеющегося АПИ.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=250313&amp;user=18950&amp;forum_n=6&amp;topic=15713.html&amp;page=0&amp;anchor=9" class="addthx" data-post="250313"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]HiEndsoft[/b]','')">HiEndsoft</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 237.0 (наставник), 20thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.74'>Активность: 0.13<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=13651">Участник</a><br><font color=blue>sysenter</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 января 2010 19:22 <br><script type="text/javascript">QU('HiEndsoft','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=HiEndsoft" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15713.html&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
<I>Vol4ok пишет:<br>ь в юзер моде с помощью имеющегося АПИ </I><br>можно собирать пакеты и пулы в raw моде
<br><br><font size="1"><i>-----<br>продавец резиновых утёнков</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=250314&amp;user=13651&amp;forum_n=6&amp;topic=15713.html&amp;page=0&amp;anchor=10" class="addthx" data-post="250314"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]ntldr[/b]','')">ntldr</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 369.8 (мудрец), 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.89'>Активность: 0.39<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=12867">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 января 2010 19:22 <br><script type="text/javascript">QU('ntldr','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ntldr" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15713.html&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
<I>Vol4ok пишет:<br>изменение порядка доставки на практике я не встречал </I><br>Это так, если дело касается локалки с простой топологией (без хитровыебанных маршрутизаторов), а в интернете может что угодно твориться. Если в RFC написано, что порядок доставки не гарантируется, то следует считать, что он может быть произвольным, хотя это уже претензии к разработчикам протокола.<br><br><I>Vol4ok пишет:<br>Именно такая модель была бы эффективнее всего, если была возможность отправлять сразу пул пакетов и как раз по несколько сотен штук, но пока я не вижу как это можно было бы реализовать в юзер моде с помощью имеющегося АПИ. </I><br>TransmitPackets или IOCP. IOCP прекрасно подходит везде, где нужна производительность. Если тебе не нужно поддерживать чужой ректально-ориентированный код, то используй IOCP.
<br><br><font size="1"><i>-----<br>PGP key <noindex><a href="https://diskcryptor.net/storage/new_key.asc" rel="nofollow" target="_blank">&lt0x1B6A24550F33E44A&gt</a></noindex></i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=250315&amp;user=12867&amp;forum_n=6&amp;topic=15713.html&amp;page=0&amp;anchor=11" class="addthx" data-post="250315"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]Vol4ok[/b]','')">Vol4ok</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 47.1 (посетитель), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.61'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=18950">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 февраля 2010 17:50 <br><script type="text/javascript">QU('Vol4ok','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vol4ok" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15713.html&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
<b>ntldr</b><br>спасибо, TransmitPackets - это то что мне было нужно, была достигнута загрузка сети на отправку - 94% от гигабита, при загрузке проца 20-30%, причем большинство процессорного времени уходило на генерацию трафика, отправка потребляет очень мало, что не может не радовать <img src="img/smilies/s8.gif" alt=""><br><br>Закрыто.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=250498&amp;user=18950&amp;forum_n=6&amp;topic=15713.html&amp;page=0&amp;anchor=12" class="addthx" data-post="250498"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Высокоскоростной UDP-генератор</span></td>
</tr></table>
</div>
<a name=newreply></a>
<div align=center>
<table class=forums>
<tr>
<td class=caption4 width="100%"><span class=header>Эта тема закрыта. Ответы больше не принимаются.</span></td>
</tr>
</table>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=15713" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
