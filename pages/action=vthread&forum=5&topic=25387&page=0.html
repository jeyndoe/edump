<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Можно ли по средствам винды отключить подсчет тактов, или изменить значение на фиксированное? - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="собственно тема в названии, если можно, то как? не подскажите? ">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=55477'>Lohmaty</a> (+7 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/nub.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=5&sortBy=0&page=0.html"><b>Вопросы новичков</b></a> <b class=bulletHead>&#8212;&#8250;</b> Можно ли по средствам винды отключить подсчет тактов, или изменить значение на фиксированное?</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]Aqua_regia[/b]','')">Aqua_regia</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 3.2 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 1.98'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=44105">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 октября 2018 08:53 <br><script type="text/javascript">QU('Aqua_regia','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Aqua_regia" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=25387.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
собственно тема в названии, если можно, то как? не подскажите? <img src="img/smilies/s1.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=388225&amp;user=44105&amp;forum_n=5&amp;topic=25387.html&amp;page=0&amp;anchor=1" class="addthx" data-post="388225"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]ELF_7719116[/b]','')">ELF_7719116</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 419.0 (мудрец), 647thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.73'>Активность: 0.46<span style='color:green'>&nearr;</span>0.51</span><br>Статус: <a href="action=userinfo&amp;user=26651">Участник</a><br><font color=blue>&quotТибериумный реверсинг&quot</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 октября 2018 09:15 <br><script type="text/javascript">QU('ELF_7719116','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ELF_7719116" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=25387.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
WinAPI GetTickCount / QueryPerformanceCounter??<br>RDTSC?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=388226&amp;user=26651&amp;forum_n=5&amp;topic=25387.html&amp;page=0&amp;anchor=2" class="addthx" data-post="388226"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]Aqua_regia[/b]','')">Aqua_regia</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 3.2 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 1.98'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=44105">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 октября 2018 12:37 <br><script type="text/javascript">QU('Aqua_regia','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Aqua_regia" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=25387.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
<I>ELF_7719116 пишет:<br>WinAPI GetTickCount / QueryPerformanceCounter??<br>RDTSC?  </I><br>а, точно, забыл сказать, RDTSC
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=388235&amp;user=44105&amp;forum_n=5&amp;topic=25387.html&amp;page=0&amp;anchor=3" class="addthx" data-post="388235"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]f13nd[/b]','')">f13nd</a></b><br></div>
<img src="img/s6.gif" alt=""><br><img style="padding-top:3px;" src="av/8075.png" alt=""><br><span class=txtSm>Ранг: 271.2 (наставник), 331thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.63'>Активность: 0.32<span style='color:green'>&nearr;</span>1.49</span><br>Статус: <a href="action=userinfo&amp;user=8075">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 октября 2018 12:53 <br><script type="text/javascript">QU('f13nd','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=f13nd" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=25387.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
Если верить мануалу, эту инструкцию можно только выключить, чтоб исключение вызывала.
<br><br><font size="1"><i>-----<br>2 оттенка серого</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=388236&amp;user=8075&amp;forum_n=5&amp;topic=25387.html&amp;page=0&amp;anchor=4" class="addthx" data-post="388236"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]Aqua_regia[/b]','')">Aqua_regia</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 3.2 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 1.98'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=44105">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 октября 2018 12:56 <br><script type="text/javascript">QU('Aqua_regia','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Aqua_regia" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=25387.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
<I>f13nd пишет:<br>Если верить мануалу, эту инструкцию можно только выключить, чтоб исключение вызывала.  </I><br>как выключить? не догоняю <img src="img/smilies/s4.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=388237&amp;user=44105&amp;forum_n=5&amp;topic=25387.html&amp;page=0&amp;anchor=5" class="addthx" data-post="388237"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]f13nd[/b]','')">f13nd</a></b><br></div>
<img src="img/s6.gif" alt=""><br><img style="padding-top:3px;" src="av/8075.png" alt=""><br><span class=txtSm>Ранг: 271.2 (наставник), 331thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.63'>Активность: 0.32<span style='color:green'>&nearr;</span>1.49</span><br>Статус: <a href="action=userinfo&amp;user=8075">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 октября 2018 13:03 &middot; Поправил: f13nd <br><script type="text/javascript">QU('f13nd','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=f13nd" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=25387.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
Ее логика такая<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>IF</b></span>&nbsp;<span class="hl_char">(</span>CR4<span class="hl_char">.</span>TSD<span class="hl_char">=</span><span class="hl_number">0</span><span class="hl_char">)</span>&nbsp;<span class="hl_function"><b>OR</b></span>&nbsp;<span class="hl_char">(</span>CPL<span class="hl_char">=</span><span class="hl_number">0</span><span class="hl_char">)</span>&nbsp;<span class="hl_function"><b>OR</b></span>&nbsp;<span class="hl_char">(</span>CR0<span class="hl_char">.</span>PE<span class="hl_char">=</span><span class="hl_number">0</span><span class="hl_char">)</span></li><li class="hl_l1">THEN</li><li class="hl_l0"><span class="hl_registr">EDX</span><span class="hl_char">:</span><span class="hl_registr"><b>EAX</b></span>&nbsp;<span class="hl_char">&amp;</span>#8592<span class="hl_comment">; TimeStampCounter;</span></li><li class="hl_l1"><span class="hl_function"><b>ELSE</b></span>&nbsp;<span class="hl_char">(</span><span class="hl_char">*</span>&nbsp;CR4<span class="hl_char">.</span>TSD&nbsp;is&nbsp;<span class="hl_number">1</span>&nbsp;<span class="hl_function"><b>and</b></span>&nbsp;CPL&nbsp;is&nbsp;<span class="hl_number">1</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">2</span><span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>or</b></span>&nbsp;<span class="hl_number">3</span>&nbsp;<span class="hl_function"><b>and</b></span>&nbsp;CR0<span class="hl_char">.</span>PE&nbsp;is&nbsp;<span class="hl_number">1</span>&nbsp;<span class="hl_char">*</span><span class="hl_char">)</span></li><li class="hl_l0">#GP<span class="hl_char">(</span><span class="hl_number">0</span><span class="hl_char">)</span></li><li class="hl_l1">FI<span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div>
<br>When in protected or virtual 8086 mode, the time stamp disable (TSD) flag in register CR4<br>restricts the use of the RDTSC instruction as follows. When the TSD flag is clear, the RDTSC<br>instruction can be executed at any privilege level; when the flag is set, the instruction can only<br>be executed at privilege level 0.<br><br>CR4 устанавливается одним из форматов инструкции mov и только в 0 кольце:<br>Moves the contents of a control register (CR0, CR2, CR3, or CR4) to a general-purpose register<br>or vice versa. The operand size for these instructions is always 32 bits, regardless of the operandsize<br>attribute. (See “Control Registers” in Chapter 2 of the IA-32 Intel Architecture Software<br>Developer’s Manual, Volume 3, for a detailed description of the flags and fields in the control<br>registers.) This instruction can be executed only when the current privilege level is 0.
<br><br><font size="1"><i>-----<br>2 оттенка серого</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=388238&amp;user=8075&amp;forum_n=5&amp;topic=25387.html&amp;page=0&amp;anchor=6" class="addthx" data-post="388238"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]Aqua_regia[/b]','')">Aqua_regia</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 3.2 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 1.98'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=44105">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 октября 2018 13:26 <br><script type="text/javascript">QU('Aqua_regia','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Aqua_regia" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=25387.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
<I>f13nd пишет:<br>Ее логика такая </I><br>И как применить на практике?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=388239&amp;user=44105&amp;forum_n=5&amp;topic=25387.html&amp;page=0&amp;anchor=7" class="addthx" data-post="388239"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]f13nd[/b]','')">f13nd</a></b><br></div>
<img src="img/s6.gif" alt=""><br><img style="padding-top:3px;" src="av/8075.png" alt=""><br><span class=txtSm>Ранг: 271.2 (наставник), 331thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.63'>Активность: 0.32<span style='color:green'>&nearr;</span>1.49</span><br>Статус: <a href="action=userinfo&amp;user=8075">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 октября 2018 13:36 <br><script type="text/javascript">QU('f13nd','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=f13nd" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=25387.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
<I>Aqua_regia пишет:<br>И как применить на практике?  </I><br>Скорей всего никак, хотя кто его знает. Теоретически конечно можно так сделать и обрабатывать это исключение, устанавливая какое хочешь значение, но с режима ядра и хз как такое решение по трудоемкости выйдет.
<br><br><font size="1"><i>-----<br>2 оттенка серого</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=388240&amp;user=8075&amp;forum_n=5&amp;topic=25387.html&amp;page=0&amp;anchor=8" class="addthx" data-post="388240"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]Jupiter[/b]','')">Jupiter</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/1379.png" alt=""><br><span class=txtSm>Ранг: 605.2 (<b>!</b>), 341thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.38'>Активность: 0.47<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1379">Модератор</a><br><font color=blue>Research &amp; Development</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 октября 2018 14:19 <br><script type="text/javascript">QU('Jupiter','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Jupiter" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=25387.html&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
Проще будет хукать код, который юзает RDTSC.<br>Другой вариант - драйвер типа того, что выкладывал Archer <noindex><a href="https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=4880&amp;page=27#29" rel="nofollow" target="_blank">в теме про Quick Unpack</a></noindex>.<br>Ну и, наверняка, у Indy есть свой вариант.
<br><br><font size="1"><i>-----<br>EnJoy!</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=388241&amp;user=1379&amp;forum_n=5&amp;topic=25387.html&amp;page=0&amp;anchor=9" class="addthx" data-post="388241"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]Aqua_regia[/b]','')">Aqua_regia</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 3.2 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 1.98'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=44105">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 октября 2018 14:24 <br><script type="text/javascript">QU('Aqua_regia','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Aqua_regia" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=25387.html&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
<I>Jupiter пишет:<br>Проще будет хукать код, который юзает RDTSC.<br>Другой вариант - драйвер типа того, что выкладывал Archer в теме про Quick Unpack.<br>Ну и, наверняка, у Indy есть свой вариант. <br> </I><br>Хорошо, поищу, спасибо за совет, если не получится, отпишу здесь
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=388242&amp;user=44105&amp;forum_n=5&amp;topic=25387.html&amp;page=0&amp;anchor=10" class="addthx" data-post="388242"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]ajax[/b]','')">ajax</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/8830.gif" alt=""><br><span class=txtSm>Ранг: 337.6 (мудрец), 224thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.53'>Активность: 0.21<span style='color:red'>&searr;</span>0.1</span><br>Статус: <a href="action=userinfo&amp;user=8830">Участник</a><br><font color=blue>born to be evil</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 октября 2018 16:39 <br><script type="text/javascript">QU('ajax','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ajax" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=25387.html&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
<noindex><a href="https://github.com/nihilus/idastealth/tree/master/src/RDTSCEmu/driver" rel="nofollow" target="_blank">--&gt; idastealth src &lt;--</a></noindex>
<br><br><font size="1"><i>-----<br>От многой мудрости много скорби, и умножающий знание умножает печаль</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=388244&amp;user=8830&amp;forum_n=5&amp;topic=25387.html&amp;page=0&amp;anchor=11" class="addthx" data-post="388244"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]ntldr[/b]','')">ntldr</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 369.8 (мудрец), 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.89'>Активность: 0.39<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=12867">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 октября 2018 18:47 <br><script type="text/javascript">QU('ntldr','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ntldr" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=25387.html&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
Точно отбенчить код можно в ядре. Знаю такой трюк:<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">#define&nbsp;IA32_PERF_CAPABILITIES&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x345&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;read<span class="hl_char">-</span>only&nbsp;</li><li class="hl_l1">#define&nbsp;IA32_FIXED_CTR_CTRL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x38D&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;Fixed<span class="hl_char">-</span>Function&nbsp;Performance&nbsp;Counter&nbsp;Control&nbsp;<span class="hl_char">(</span>R<span class="hl_char">/</span>W<span class="hl_char">)</span></li><li class="hl_l0">#define&nbsp;IA32_PERF_GLOBAL_STATUS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x38E&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;Global&nbsp;Performance&nbsp;Counter&nbsp;Status&nbsp;<span class="hl_char">(</span>RO<span class="hl_char">)</span></li><li class="hl_l1">#define&nbsp;IA32_PERF_GLOBAL_CTRL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x38F&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;Global&nbsp;Performance&nbsp;Counter&nbsp;Control&nbsp;<span class="hl_char">(</span>R<span class="hl_char">/</span>W<span class="hl_char">)</span></li><li class="hl_l0">#define&nbsp;IA32_PERF_GLOBAL_OVF_CTRL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x390&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;Global&nbsp;Performance&nbsp;Counter&nbsp;Overflow&nbsp;Control&nbsp;<span class="hl_char">(</span>R<span class="hl_char">/</span>W<span class="hl_char">)</span></li><li class="hl_l1">#define&nbsp;IA32_PERF_GLOBAL_STATUS_RESET&nbsp;0x390&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;Global&nbsp;Performance&nbsp;Counter&nbsp;Overflow&nbsp;Reset&nbsp;Control&nbsp;<span class="hl_char">(</span>R<span class="hl_char">/</span>W<span class="hl_char">)</span></li><li class="hl_l0">#define&nbsp;IA32_PERF_GLOBAL_STATUS_SET&nbsp;&nbsp;&nbsp;0x391&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;Global&nbsp;Performance&nbsp;Counter&nbsp;Overflow&nbsp;Set&nbsp;Control&nbsp;<span class="hl_char">(</span>R<span class="hl_char">/</span>W<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">#define&nbsp;MSR_PERF_FIXED_CTR0&nbsp;0x309&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;INST_RETIRED<span class="hl_char">.</span>ANY</li><li class="hl_l1">#define&nbsp;MSR_PERF_FIXED_CTR1&nbsp;0x30A&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;CPU_CLK_UNHALTED<span class="hl_char">.</span>THREAD&nbsp;<span class="hl_char">/</span>&nbsp;CPU_CLK_UNHALTED<span class="hl_char">.</span>CORE</li><li class="hl_l0">#define&nbsp;MSR_PERF_FIXED_CTR2&nbsp;0x30B&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;CPU_CLK_UNHALTED<span class="hl_char">.</span>REF_TSC</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">static&nbsp;uint64_t&nbsp;g_perfGlobalCtrl<span class="hl_comment">;</span></li><li class="hl_l1">static&nbsp;uint64_t&nbsp;g_perfFixedCtrl<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;IA32_PERF_GLOBAL_CTRL&nbsp;bits</li><li class="hl_l1">#define&nbsp;EN_FIXED_CTR0&nbsp;<span class="hl_char">(</span>1ull&nbsp;<span class="hl_char">&lt;</span><span class="hl_char">&lt;</span>&nbsp;<span class="hl_number">32</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;<span class="hl_function"><b>If</b></span>&nbsp;<span class="hl_function">CPUID</span><span class="hl_char">.</span><span class="hl_number">0AH</span><span class="hl_char">:</span>&nbsp;<span class="hl_registr">EDX</span><span class="hl_char">[</span><span class="hl_number">4</span><span class="hl_char">:</span><span class="hl_number">0</span><span class="hl_char">]</span>&nbsp;<span class="hl_char">&gt;</span>&nbsp;<span class="hl_number">0</span></li><li class="hl_l0">#define&nbsp;EN_FIXED_CTR1&nbsp;<span class="hl_char">(</span>1ull&nbsp;<span class="hl_char">&lt;</span><span class="hl_char">&lt;</span>&nbsp;<span class="hl_number">33</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;<span class="hl_function"><b>If</b></span>&nbsp;<span class="hl_function">CPUID</span><span class="hl_char">.</span><span class="hl_number">0AH</span><span class="hl_char">:</span>&nbsp;<span class="hl_registr">EDX</span><span class="hl_char">[</span><span class="hl_number">4</span><span class="hl_char">:</span><span class="hl_number">0</span><span class="hl_char">]</span>&nbsp;<span class="hl_char">&gt;</span>&nbsp;<span class="hl_number">1</span></li><li class="hl_l1">#define&nbsp;EN_FIXED_CTR2&nbsp;<span class="hl_char">(</span>1ull&nbsp;<span class="hl_char">&lt;</span><span class="hl_char">&lt;</span>&nbsp;<span class="hl_number">34</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;<span class="hl_function"><b>If</b></span>&nbsp;<span class="hl_function">CPUID</span><span class="hl_char">.</span><span class="hl_number">0AH</span><span class="hl_char">:</span>&nbsp;<span class="hl_registr">EDX</span><span class="hl_char">[</span><span class="hl_number">4</span><span class="hl_char">:</span><span class="hl_number">0</span><span class="hl_char">]</span>&nbsp;<span class="hl_char">&gt;</span>&nbsp;<span class="hl_number">2</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;IA32_FIXED_CTR_CTRL&nbsp;bits</li><li class="hl_l0">#define&nbsp;EN0_OS&nbsp;&nbsp;<span class="hl_char">(</span>1ull&nbsp;<span class="hl_char">&lt;</span><span class="hl_char">&lt;</span>&nbsp;&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;Enable&nbsp;Fixed&nbsp;Counter&nbsp;<span class="hl_number">0</span>&nbsp;to&nbsp;count&nbsp;<span class="hl_function"><b>while</b></span>&nbsp;CPL&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span></li><li class="hl_l1">#define&nbsp;EN0_USR&nbsp;<span class="hl_char">(</span>1ull&nbsp;<span class="hl_char">&lt;</span><span class="hl_char">&lt;</span>&nbsp;&nbsp;<span class="hl_number">1</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;Enable&nbsp;Fixed&nbsp;Counter&nbsp;<span class="hl_number">0</span>&nbsp;to&nbsp;count&nbsp;<span class="hl_function"><b>while</b></span>&nbsp;CPL&nbsp;<span class="hl_char">&gt;</span>&nbsp;<span class="hl_number">0</span></li><li class="hl_l0">#define&nbsp;EN0_PMI&nbsp;<span class="hl_char">(</span>1ull&nbsp;<span class="hl_char">&lt;</span><span class="hl_char">&lt;</span>&nbsp;&nbsp;<span class="hl_number">3</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;Enable&nbsp;PMI&nbsp;when&nbsp;fixed&nbsp;counter&nbsp;<span class="hl_number">0</span>&nbsp;overflows</li><li class="hl_l1">#define&nbsp;EN1_OS&nbsp;&nbsp;<span class="hl_char">(</span>1ull&nbsp;<span class="hl_char">&lt;</span><span class="hl_char">&lt;</span>&nbsp;&nbsp;<span class="hl_number">4</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;Enable&nbsp;Fixed&nbsp;Counter&nbsp;1to&nbsp;count&nbsp;<span class="hl_function"><b>while</b></span>&nbsp;CPL&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span></li><li class="hl_l0">#define&nbsp;EN1_USR&nbsp;<span class="hl_char">(</span>1ull&nbsp;<span class="hl_char">&lt;</span><span class="hl_char">&lt;</span>&nbsp;&nbsp;<span class="hl_number">5</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;Enable&nbsp;Fixed&nbsp;Counter&nbsp;1to&nbsp;count&nbsp;<span class="hl_function"><b>while</b></span>&nbsp;CPL&nbsp;<span class="hl_char">&gt;</span>&nbsp;<span class="hl_number">0</span></li><li class="hl_l1">#define&nbsp;EN1_PMI&nbsp;<span class="hl_char">(</span>1ull&nbsp;<span class="hl_char">&lt;</span><span class="hl_char">&lt;</span>&nbsp;&nbsp;<span class="hl_number">7</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;Enable&nbsp;PMI&nbsp;when&nbsp;fixed&nbsp;counter&nbsp;<span class="hl_number">1</span>&nbsp;overflows</li><li class="hl_l0">#define&nbsp;EN2_OS&nbsp;&nbsp;<span class="hl_char">(</span>1ull&nbsp;<span class="hl_char">&lt;</span><span class="hl_char">&lt;</span>&nbsp;&nbsp;<span class="hl_number">8</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;Enable&nbsp;Fixed&nbsp;Counter&nbsp;<span class="hl_number">2</span>&nbsp;to&nbsp;count&nbsp;<span class="hl_function"><b>while</b></span>&nbsp;CPL&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span></li><li class="hl_l1">#define&nbsp;EN2_USR&nbsp;<span class="hl_char">(</span>1ull&nbsp;<span class="hl_char">&lt;</span><span class="hl_char">&lt;</span>&nbsp;&nbsp;<span class="hl_number">9</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;Enable&nbsp;Fixed&nbsp;Counter&nbsp;<span class="hl_number">2</span>&nbsp;to&nbsp;count&nbsp;<span class="hl_function"><b>while</b></span>&nbsp;CPL&nbsp;<span class="hl_char">&gt;</span>&nbsp;<span class="hl_number">0</span></li><li class="hl_l0">#define&nbsp;EN2_PMI&nbsp;<span class="hl_char">(</span>1ull&nbsp;<span class="hl_char">&lt;</span><span class="hl_char">&lt;</span>&nbsp;<span class="hl_number">11</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;Enable&nbsp;PMI&nbsp;when&nbsp;fixed&nbsp;counter&nbsp;<span class="hl_number">2</span>&nbsp;overflows</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">static&nbsp;<span class="hl_function"><b>void</b></span>&nbsp;print_perfs<span class="hl_char">(</span><span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uint64_t&nbsp;ctr0&nbsp;<span class="hl_char">=</span>&nbsp;__readmsr<span class="hl_char">(</span>MSR_PERF_FIXED_CTR0<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uint64_t&nbsp;ctr1&nbsp;<span class="hl_char">=</span>&nbsp;__readmsr<span class="hl_char">(</span>MSR_PERF_FIXED_CTR1<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uint64_t&nbsp;ctr2&nbsp;<span class="hl_char">=</span>&nbsp;__readmsr<span class="hl_char">(</span>MSR_PERF_FIXED_CTR2<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DbgMsg<span class="hl_char">(</span><span class="hl_quote">&quot;-------------------------------------\n&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DbgMsg<span class="hl_char">(</span><span class="hl_quote">&quot;INST_RETIRED.ANY         = %08X%08X\n&quot;</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">(</span>uint32_t<span class="hl_char">)</span><span class="hl_char">(</span>ctr0&nbsp;<span class="hl_char">&gt;</span><span class="hl_char">&gt;</span>&nbsp;<span class="hl_number">32</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">(</span>uint32_t<span class="hl_char">)</span>ctr0<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DbgMsg<span class="hl_char">(</span><span class="hl_quote">&quot;CPU_CLK_UNHALTED.THREAD  = %08X%08X\n&quot;</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">(</span>uint32_t<span class="hl_char">)</span><span class="hl_char">(</span>ctr1&nbsp;<span class="hl_char">&gt;</span><span class="hl_char">&gt;</span>&nbsp;<span class="hl_number">32</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">(</span>uint32_t<span class="hl_char">)</span>ctr1<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DbgMsg<span class="hl_char">(</span><span class="hl_quote">&quot;CPU_CLK_UNHALTED.REF_TSC = %08X%08X\n&quot;</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">(</span>uint32_t<span class="hl_char">)</span><span class="hl_char">(</span>ctr2&nbsp;<span class="hl_char">&gt;</span><span class="hl_char">&gt;</span>&nbsp;<span class="hl_number">32</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">(</span>uint32_t<span class="hl_char">)</span>ctr2<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DbgMsg<span class="hl_char">(</span><span class="hl_quote">&quot;-------------------------------------\n&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">}</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">static&nbsp;<span class="hl_function"><b>void</b></span>&nbsp;enable_perf<span class="hl_char">(</span><span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print_perfs<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_perfGlobalCtrl&nbsp;<span class="hl_char">=</span>&nbsp;__readmsr<span class="hl_char">(</span>IA32_PERF_GLOBAL_CTRL<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_perfFixedCtrl&nbsp;<span class="hl_char">=</span>&nbsp;__readmsr<span class="hl_char">(</span>IA32_FIXED_CTR_CTRL<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DbgMsg<span class="hl_char">(</span><span class="hl_quote">&quot;IA32_PERF_GLOBAL_CTRL = %08X%08X\n&quot;</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">(</span>uint32_t<span class="hl_char">)</span><span class="hl_char">(</span>g_perfGlobalCtrl&nbsp;<span class="hl_char">&gt;</span><span class="hl_char">&gt;</span>&nbsp;<span class="hl_number">32</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">(</span>uint32_t<span class="hl_char">)</span>g_perfGlobalCtrl<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DbgMsg<span class="hl_char">(</span><span class="hl_quote">&quot;IA32_PERF_GLOBAL_CTRL = %08X%08X\n&quot;</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">(</span>uint32_t<span class="hl_char">)</span><span class="hl_char">(</span>g_perfFixedCtrl&nbsp;<span class="hl_char">&gt;</span><span class="hl_char">&gt;</span>&nbsp;<span class="hl_number">32</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">(</span>uint32_t<span class="hl_char">)</span>g_perfFixedCtrl<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__writemsr<span class="hl_char">(</span>IA32_PERF_GLOBAL_CTRL<span class="hl_char">,</span>&nbsp;g_perfGlobalCtrl&nbsp;<span class="hl_char">|</span>&nbsp;<span class="hl_char">(</span>EN_FIXED_CTR0&nbsp;<span class="hl_char">|</span>&nbsp;EN_FIXED_CTR1&nbsp;<span class="hl_char">|</span>&nbsp;EN_FIXED_CTR2<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__writemsr<span class="hl_char">(</span>IA32_FIXED_CTR_CTRL<span class="hl_char">,</span>&nbsp;<span class="hl_char">(</span>EN0_OS&nbsp;<span class="hl_char">|</span>&nbsp;EN1_OS&nbsp;<span class="hl_char">|</span>&nbsp;EN2_OS<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">; //  | (EN0_USR | EN1_USR | EN2_USR)</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__writemsr<span class="hl_char">(</span>MSR_PERF_FIXED_CTR0<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__writemsr<span class="hl_char">(</span>MSR_PERF_FIXED_CTR1<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__writemsr<span class="hl_char">(</span>MSR_PERF_FIXED_CTR2<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print_perfs<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">}</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">static&nbsp;<span class="hl_function"><b>void</b></span>&nbsp;disable_perf<span class="hl_char">(</span><span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__writemsr<span class="hl_char">(</span>IA32_PERF_GLOBAL_STATUS_RESET<span class="hl_char">,</span>&nbsp;<span class="hl_char">(</span>EN_FIXED_CTR0&nbsp;<span class="hl_char">|</span>&nbsp;EN_FIXED_CTR1&nbsp;<span class="hl_char">|</span>&nbsp;EN_FIXED_CTR2<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__writemsr<span class="hl_char">(</span>IA32_FIXED_CTR_CTRL<span class="hl_char">,</span>&nbsp;g_perfFixedCtrl<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__writemsr<span class="hl_char">(</span>IA32_PERF_GLOBAL_CTRL<span class="hl_char">,</span>&nbsp;g_perfGlobalCtrl<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">}</li>        </ol>
    </div>
</div></div>
<br><br>Используем perfomance counter&#039;ы в MSR регистрах. Их три штуки: один считает все такты, другой только такты затраченные на исполнение кода, третий - выполненные инструкции. Если брать третий счетчик и тестируемый код оборачивать в cli / sti, то результат всегда сходится цифра в цифру. Если брать значимые такты - немного плавает. Если брать все такты - скачет как мартовский заяц из-за смены режимов энергопотребления процессора.
<br><br><font size="1"><i>-----<br>PGP key <noindex><a href="https://diskcryptor.net/storage/new_key.asc" rel="nofollow" target="_blank">&lt0x1B6A24550F33E44A&gt</a></noindex></i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=388247&amp;user=12867&amp;forum_n=5&amp;topic=25387.html&amp;page=0&amp;anchor=12" class="addthx" data-post="388247"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=3520" title="04-10-2018 16:11, ранг:625.1" target="_blank">mak</a>, <a href="action=userinfo&user=4773" title="04-10-2018 23:00, ранг:362.5" target="_blank">plutos</a>, <a href="action=userinfo&user=44105" title="05-10-2018 15:05, ранг:1.5" target="_blank">Aqua_regia</a>, <a href="action=userinfo&user=20807" title="03-11-2018 11:57, ранг:9.8" target="_blank">Katana</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 337.5 (мудрец), 348thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 ноября 2018 20:50 <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=25387.html&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
<b>Jupiter</b><br><br>&gt; Ну и, наверняка, у Indy есть свой вариант. <br><br>Конечно же. Есть калибровочный источник данных, который расположен в разделяемой ядром памяти и ядро там значение апдейтит. Есть пользовательский поток выборок(DF) к данной области. Для решения задачи могут быть использованы два пути:<br><br>1. Установка ловушки на область. Дикий способ, учитывая что ловушек всего четыре.<br>2. Трек выборки. Адресный декодер обнаруживает выборку из целевой области и тогда в зависимости от импл. выполняется подмена данных. Могу пример показать если интересно.
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=388666&amp;user=40990&amp;forum_n=5&amp;topic=25387.html&amp;page=0&amp;anchor=13" class="addthx" data-post="388666"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]Jupiter[/b]','')">Jupiter</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/1379.png" alt=""><br><span class=txtSm>Ранг: 605.2 (<b>!</b>), 341thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.38'>Активность: 0.47<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1379">Модератор</a><br><font color=blue>Research &amp; Development</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 ноября 2018 00:53 <br><script type="text/javascript">QU('Jupiter','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Jupiter" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=25387.html&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
<b>difexacaw</b><br>А с точки зрения производительности второй вариант насколько хорош?
<br><br><font size="1"><i>-----<br>EnJoy!</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=388677&amp;user=1379&amp;forum_n=5&amp;topic=25387.html&amp;page=0&amp;anchor=14" class="addthx" data-post="388677"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 337.5 (мудрец), 348thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 ноября 2018 12:10 &middot; Поправил: difexacaw <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=25387.html&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
<b>Jupiter</b><br><br>У юзер кода как таковой производительности нет. Общий профайл определяется ядром, там потоки большую часть времени спят в ожидании синхрособытий. Драйвера не панацея, нет никаких проблем отключить таймеры(tsc или сервисные) и в драйвере нужные значения возвращать. Вот только есть один нюанс, что ту же тск можно заменить на любые асм примитивы. Тоесть счётчики возвращают абсолютное время, можно сравнить два цикла на число итераций и так получится относительное время, без использования таймеров. Это просто обычно не используется.<br><br>А счётчики в USD никак по простому не изменить. У ядра нет интерфейсов, что бы там значение калибровать, так же и манипуляции с этой областью из юм невозможны. В простейшем случае нужно анмапить из км эту область и замапить туда свою, где реализовать свой таймер. Это из области извратов. Делается просто - отслеживаем выборку и подменяем значение. Не трогая ядро. Профайл зависит от имплементации.
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=388709&amp;user=40990&amp;forum_n=5&amp;topic=25387.html&amp;page=0&amp;anchor=15" class="addthx" data-post="388709"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/nub.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=5&sortBy=0&page=0.html"><b>Вопросы новичков</b></a> <b class=bulletHead>&#8212;&#8250;</b> Можно ли по средствам винды отключить подсчет тактов, или изменить значение на фиксированное?</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#16" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="5">
<input type="hidden" name="topic" value="25387">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=25387" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
