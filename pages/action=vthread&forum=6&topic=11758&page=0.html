<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Помогите оптимизировать манипуляцию с битами на Си - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Изучаю Си в (CodeVisionAVR). Сделал вот такое нужное мне действие: Установить бит с номером &#039;n&#039; в переменной &#039;y&#039; как бит с номером &#039;d&#039; в переменной &#039;x&#039;. if ((x&gt;&gt;d)&amp;1)">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=1533'>rmn</a>, <a target='_blank' href='?action=userinfo&amp;user=8344'>Magister Yoda</a>, <a target='_blank' href='?action=userinfo&amp;user=50833'>vasilevradislav</a>, <a target='_blank' href='?action=userinfo&amp;user=55995'>tyns777</a>, <a target='_blank' href='?action=userinfo&amp;user=42072'>zombi-vadim</a> (+4 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Помогите оптимизировать манипуляцию с битами на Си</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]ToBad[/b]','')">ToBad</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/702.gif" alt=""><br><span class=txtSm>Ранг: 450.3 (мудрец), 13thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.67'>Активность: 0.2<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=702">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 апреля 2008 00:14 <br><script type="text/javascript">QU('ToBad','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ToBad" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11758.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Изучаю Си в (CodeVisionAVR). Сделал вот такое нужное мне действие:<br><br><code>Установить бит с номером &#039;n&#039; в переменной &#039;y&#039; как бит с номером &#039;d&#039; в переменной &#039;x&#039;. <br>if ((x&gt;&gt;d)&amp;1) {y|=(1&lt;&lt;n);} else {y&amp;=~(1&lt;&lt;n);}</code><br><br>Хоть и работает, подозреваю, что сделал это криво. Наверняка можно оптимизировать. Прошу помощи.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=187197&amp;user=702&amp;forum_n=6&amp;topic=11758.html&amp;page=0&amp;anchor=1" class="addthx" data-post="187197"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]reversecode[/b]','')">reversecode</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/15381.gif" alt=""><br><span class=txtSm>Ранг: 1053.6 <b><u>(!!!!)</u></b>, 1078thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.43'>Активность: 1.06<span style='color:red'>&searr;</span>0.81</span><br>Статус: <a href="action=userinfo&amp;user=15381">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 апреля 2008 01:38 <br><script type="text/javascript">QU('reversecode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=reversecode" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11758.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
a = ((x &gt;&gt; d) &lt;&lt; n);<br>if (a != 0)<br>    y |= a;<br>else<br>    y &amp;= ~a;<br><br>помоему тоже самое)
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=187199&amp;user=15381&amp;forum_n=6&amp;topic=11758.html&amp;page=0&amp;anchor=2" class="addthx" data-post="187199"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]ToBad[/b]','')">ToBad</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/702.gif" alt=""><br><span class=txtSm>Ранг: 450.3 (мудрец), 13thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.67'>Активность: 0.2<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=702">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 апреля 2008 01:49 &middot; Поправил: ToBad <br><script type="text/javascript">QU('ToBad','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ToBad" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11758.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
<I><b>reversecode</b> пишет:<br>a = ((x &gt;&gt; d) &lt;&lt; n);<br>if (a != 0)<br>y |= a;<br>else<br>y &amp;= ~a;<br><br>помоему тоже самое) </I><br><br>Да, только лишняя переменная... Хотя нужно посмотреть сколько будет кода после компиляции в том и в другом случае.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=187200&amp;user=702&amp;forum_n=6&amp;topic=11758.html&amp;page=0&amp;anchor=3" class="addthx" data-post="187200"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]s0larian[/b]','')">s0larian</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/1737.jpg" alt=""><br><span class=txtSm>Ранг: 387.4 (мудрец)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.19'>Активность: 0.17<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1737">Участник</a><br><font color=blue>системщик</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 апреля 2008 06:08 <br><script type="text/javascript">QU('s0larian','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=s0larian" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11758.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
<b>ToBad</b>, я думаю что там будет всего несколько инструкций, и далее оптимизировать нету смысла... в смысле если у тебя что-то медлено, то, думаю, проблема не тут. Кста, есть пара спец инструкций для таких дел: &quot;bt r/m32, bit&quot; и btr, btc
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=187202&amp;user=1737&amp;forum_n=6&amp;topic=11758.html&amp;page=0&amp;anchor=4" class="addthx" data-post="187202"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]ToBad[/b]','')">ToBad</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/702.gif" alt=""><br><span class=txtSm>Ранг: 450.3 (мудрец), 13thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.67'>Активность: 0.2<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=702">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 апреля 2008 12:08 <br><script type="text/javascript">QU('ToBad','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ToBad" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11758.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
<I><b>s0larian</b> пишет:<br>ToBad, я думаю что там будет всего несколько инструкций, и далее оптимизировать нету смысла... в смысле если у тебя что-то медлено, то, думаю, проблема не тут. Кста, есть пара спец инструкций для таких дел: &quot;bt r/m32, bit&quot; и btr, btc </I><br><br>Дело в том, что пишу я как упомянул ранее под CodeVisionAVR. Это Си для микроконтроллеров. Там свой ассемблер, свои инструкции. Оптимизация нужна не для скорости, а для сокращения числа команд. Есть там конечно свои инструкции для манипуляции битами (bld и bst), которые копируют указанный бит во флаг и восстанавливают назад. Написать функцию с ассемблерными командами у меня не получилось из за того, что упомянутые команды принимают в параметрах регистр и константу. А в функцию я передаю всё через переменные.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=187216&amp;user=702&amp;forum_n=6&amp;topic=11758.html&amp;page=0&amp;anchor=5" class="addthx" data-post="187216"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]egorovshura[/b]','')">egorovshura</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 122.2 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.43'>Активность: 0.04<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1227">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 апреля 2008 20:28 <br><script type="text/javascript">QU('egorovshura','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=egorovshura" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11758.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
<I>ToBad пишет:<br>...не получилось из за того, что упомянутые команды принимают в параметрах регистр и константу. </I><br><br>Помню еще во времена ZX Spectrum в играх использовалась одна интересная оптимизация для уменьшения числа команд. Оптимизация эта была связана с моджификацией кода процедуры. Может и тут получится, если константу в битовой команде модифицировать на лету.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=187236&amp;user=1227&amp;forum_n=6&amp;topic=11758.html&amp;page=0&amp;anchor=6" class="addthx" data-post="187236"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]Fallout[/b]','')">Fallout</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 45.7 (посетитель), 5thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.44'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3650">Участник</a><br><font color=blue></font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 апреля 2008 21:00 &middot; Поправил: Fallout <br><script type="text/javascript">QU('Fallout','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Fallout" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11758.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
<I>reversecode пишет:<br>a = ((x &gt;&gt; d) &lt;&lt; n);<br>if (a != 0)<br>y |= a;<br>else<br>y &amp;= ~a;  </I><br><br>Этот код вообще не к чему...  задача установить только тот бит что надо... а с данным примером будут установлены и другие биты которые человеку не нужны ... пример ( переменные скажем 8битные, номер бита с 0 как понимаю ):<br><br><code><br>x = 0b11001100;<br>y = 0b00110011;<br><br>d = 1; /* берем значение первого бита в x */<br>n = 2; /* установим значение первого бита в бит номер 2 */<br></code><br><br>Выполняем твой код:<br><br><code><br>a = ((x &gt;&gt; d) &lt;&lt; n);<br></code><br><br>после выполнения &#039;a&#039; будет 0b10011000  далее твоё условие в if будет true .... так как дейсвительно оно не равно нуля....  хотя и второй бит равен нулю!!!! соотвенно дальше мы установим биты из переменной &#039;a&#039; в переменую y. То есть мало того что в условии ошибка... так ещё мы и установили лишние биты....   Что же нехватает в коде ? А нехватает маски что отсечет лишние биты.... Например так :<br><br><code><br>a = ((x &gt;&gt; d) &lt;&lt; n); -&gt;  a = (((x &gt;&gt; d)&amp;0x01) &lt;&lt; n); <br></code>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=187237&amp;user=3650&amp;forum_n=6&amp;topic=11758.html&amp;page=0&amp;anchor=7" class="addthx" data-post="187237"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]tomac[/b]','')">tomac</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 65.3 (постоянный), 10thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.82'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=6470">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 апреля 2008 23:07 <br><script type="text/javascript">QU('tomac','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=tomac" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11758.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
y=(y&amp;~(1&lt;&lt;n))|(((x&gt;&gt;d)&amp;1)&lt;&lt;n);<br>Тоже 7 битовых операции, но нету условия <img src="img/smilies/s1.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=187240&amp;user=6470&amp;forum_n=6&amp;topic=11758.html&amp;page=0&amp;anchor=8" class="addthx" data-post="187240"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]ToBad[/b]','')">ToBad</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/702.gif" alt=""><br><span class=txtSm>Ранг: 450.3 (мудрец), 13thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.67'>Активность: 0.2<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=702">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 апреля 2008 00:09 <br><script type="text/javascript">QU('ToBad','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ToBad" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11758.html&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
<I><b>egorovshura</b> пишет:<br>Оптимизация эта была связана с моджификацией кода процедуры. Может и тут получится, если константу в битовой команде модифицировать на лету. </I><br><br>Трудно сказать, я не настолько знаю Си, да ещё вариант для микроконтроллеров, что бы провернуть такое. Подозреваю, что с асм вставками можно провернуть всё компактно, если знать как и преодолеть проблемы с регистрами и константами.<br><br><I><b>tomac </b>пишет:<br>y=(y&amp;~(1&lt;&lt;n))|(((x&gt;&gt;d)&amp;1)&lt;&lt;n);<br>Тоже 7 битовых операции, но нету условия </I><br><br>Хороший примерчик. Без условия мне больше нравится. Жалко, что код не изменился ни на байт. Размер остался тот же как ни странно. У меня это всё записано в #define и что интересно компилятор мой вариант в зависимости от передаваемых параметров превращает в ассемблерный код от двух строчек, до десятка с несколькими подпрограммами !<br><br>Нужно будет спросить на каком нибудь форуме у программеров микроконтроллеров. Они должны знать особенности этого ассемблера и его совмещения с Си, и думаю какие нибудь фишки там есть. Вариант с логикой наверное уже более оптимизировать некуда ?...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=187244&amp;user=702&amp;forum_n=6&amp;topic=11758.html&amp;page=0&amp;anchor=9" class="addthx" data-post="187244"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]Fallout[/b]','')">Fallout</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 45.7 (посетитель), 5thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.44'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3650">Участник</a><br><font color=blue></font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 апреля 2008 09:17 <br><script type="text/javascript">QU('Fallout','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Fallout" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11758.html&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
Зачастую компактная запись и последующая генерация кода мягко говоря не особо связаны.... мало того что надо хранить где то промежуточный вариант так ещё и операций то меньше не стало....   надо смотреть что генерирует компилятор в данных случаях.... <br><br>/*<br>что интересно компилятор мой вариант в зависимости от передаваемых параметров превращает в ассемблерный код от двух строчек, до десятка с несколькими подпрограммами ! <br>*/<br><br>Если касаемо именно этого варианта <code>y=(y&amp;~(1&lt;&lt;n))|(((x&gt;&gt;d)&amp;1)&lt;&lt;n);</code> то скорее всего ты в макрос передавал не 8битные переменные...  а так как нативно микроконтроллер твой скорее всего (мега или тини небось ? ) 8битный то и переменные большего размера он уже нативно не может поддерживать поэтому может быть и сдвиги и прочие операции над такими переменными он делает через соответствующие подпрограммы....  всё от компилятора конечно зависит и от уровня оптимизации в настройках....<br><br>Темболее зачем за такой оптимизацией дикой гнаться ? Ты не успеваешь что то сделать ?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=187248&amp;user=3650&amp;forum_n=6&amp;topic=11758.html&amp;page=0&amp;anchor=10" class="addthx" data-post="187248"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]ToBad[/b]','')">ToBad</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/702.gif" alt=""><br><span class=txtSm>Ранг: 450.3 (мудрец), 13thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.67'>Активность: 0.2<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=702">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 апреля 2008 14:40 <br><script type="text/javascript">QU('ToBad','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ToBad" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11758.html&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
<I><b>Fallout</b> пишет:<br>скорее всего ты в макрос передавал не 8битные переменные... а так как нативно микроконтроллер твой (мега или тини небось ? ) </I><br><br>Ну в конфиге проекта указывал именно что бы 8-ми битные были. Контроллер мега8515.<br><br><I>Тем более зачем за такой оптимизацией дикой гнаться ? Ты не успеваешь что то сделать ? </I><br><br>Я и сам себе задаю этот вопрос. В общем то успеваю, да и запас есть по кварцу. Впаял 8Mhz, а контроллер на 16 может работать. Вот и оптимизация скорости в два раза. Просто режут глаз конструкции:<br><br><code>...<br>COPYBIT(st2,statkey1,st2pin,PORT1);<br>COPYBIT(cn,statkey1,cnpin,PORT1);<br>COPYBIT(at,statkey1,atpin,PORT1);<br>COPYBIT(bt,statkey0,btpin,PORT2);<br>COPYBIT(sl2,statkey0,sl2pin,PORT2);<br>...</code><br><br>...и таких много.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=187265&amp;user=702&amp;forum_n=6&amp;topic=11758.html&amp;page=0&amp;anchor=11" class="addthx" data-post="187265"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]Fallout[/b]','')">Fallout</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 45.7 (посетитель), 5thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.44'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3650">Участник</a><br><font color=blue></font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 апреля 2008 18:22 <br><script type="text/javascript">QU('Fallout','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Fallout" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11758.html&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
<I>ToBad пишет:<br>Ну в конфиге проекта указывал именно что бы 8-ми битные были. </I><br><br>Ну char то понятно, но мало ли ты там short , int используешь ....  вот тебе компилятор и генерит к ним &quot;обвес&quot;<br>....
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=187274&amp;user=3650&amp;forum_n=6&amp;topic=11758.html&amp;page=0&amp;anchor=12" class="addthx" data-post="187274"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]s0larian[/b]','')">s0larian</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/1737.jpg" alt=""><br><span class=txtSm>Ранг: 387.4 (мудрец)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.19'>Активность: 0.17<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1737">Участник</a><br><font color=blue>системщик</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 апреля 2008 19:25 <br><script type="text/javascript">QU('s0larian','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=s0larian" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11758.html&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
<b>ToBad</b>, стой секунду, ты биты читаешь из memory-mapped регистра какого-то устройства? Если да, то ты бы спросил про &quot;красивый С код&quot; а не оптимизацию. Это делается проще через struct и bit fields:<br><br><code><br>struct Uart<br>{<br>    byte rx_fifo;<br>    byte flag1:1, flag2:1, flag3:1, reserved:5;<br>};<br></code><br><br>потом просто объявляешь глобальный volatile указатель этого типа, и пользуешься полями - компилер выплюнет код для выделения конкретного бита. Тебе только надо удостоверится что читаются байты, а не machine word, то есть компилер знает что эти адреса лежат в области с byte достопом (это не RAM).
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=187277&amp;user=1737&amp;forum_n=6&amp;topic=11758.html&amp;page=0&amp;anchor=13" class="addthx" data-post="187277"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]Fallout[/b]','')">Fallout</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 45.7 (посетитель), 5thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.44'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3650">Участник</a><br><font color=blue></font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 апреля 2008 21:50 <br><script type="text/javascript">QU('Fallout','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Fallout" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11758.html&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
<I>s0larian пишет:<br>ты биты читаешь из memory-mapped регистра какого-то устройства </I><br><br>У него 8битный микроконтроллер ( риск процессор + рам + ром на борту ) фирмы Атмел... там грубо говоря РАМ и представляет из себя кучу регистров общего назначения... тока определенная область их являются регистрами специального назначения такие как регистры портов ввода вывода и тд...  Битовые поля как вариант только не всегда компилятор генерит оптимальный код для таких дел <img src="img/smilies/s1.gif" alt=""> Я бы сказал почти никогда... Но интересно To Bad скажешь потом скока получилось по коду ? <img src="img/smilies/s1.gif" alt=""><br><br>п.с: вообще заметил тема МК тут появляться уже не раз <img src="img/smilies/s1.gif" alt=""> что радует
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=187282&amp;user=3650&amp;forum_n=6&amp;topic=11758.html&amp;page=0&amp;anchor=14" class="addthx" data-post="187282"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]s0larian[/b]','')">s0larian</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/1737.jpg" alt=""><br><span class=txtSm>Ранг: 387.4 (мудрец)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.19'>Активность: 0.17<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1737">Участник</a><br><font color=blue>системщик</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 апреля 2008 22:31 <br><script type="text/javascript">QU('s0larian','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=s0larian" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11758.html&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
<b>Fallout</b>, <b>ToBad</b>, просто вопрос в том эти биты в твоих переменных или в регистрах железа? Если первое, то флаги на С реализовывают именно полями. Если второе, то эти поля можно присобачить и к железу, но надо проверять код.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=187283&amp;user=1737&amp;forum_n=6&amp;topic=11758.html&amp;page=0&amp;anchor=15" class="addthx" data-post="187283"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]Fallout[/b]','')">Fallout</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 45.7 (посетитель), 5thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.44'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3650">Участник</a><br><font color=blue></font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 апреля 2008 09:09 <br><script type="text/javascript">QU('Fallout','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Fallout" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11758.html&amp;page=0#16');return false;">#16</a> </span><div align=left><br>
Биты в регистрах....   Тут проблем не будет можно присвоить адрес регистра структуре... но это две доп. переменные... <img src="img/smilies/s1.gif" alt=""> + как он к полям структуры будет обращаться если у него номер бита что надо читать в переменной.... была бы константа можно было бы макрос сделать....  а тут switch/if-else городить <img src="img/smilies/s1.gif" alt=""><br><br>п.с: компилятор поддерживает кстати бит ассес к ИО портам...  ( см. док 3.13.1 ) <img src="img/smilies/s1.gif" alt=""> <br><br><code><br>/* Set bit 0 of PORTA output */<br>PORTA.0 = 1;<br></code><br><br>Так что вот как вариант... только мало поможет <img src="img/smilies/s1.gif" alt=""> если опять таки номер пина не константа....   ещё поддерживается тип данных <code>bit</code> вот тут можно тоже поэксперементировать <img src="img/smilies/s1.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=187296&amp;user=3650&amp;forum_n=6&amp;topic=11758.html&amp;page=0&amp;anchor=16" class="addthx" data-post="187296"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]reversecode[/b]','')">reversecode</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/15381.gif" alt=""><br><span class=txtSm>Ранг: 1053.6 <b><u>(!!!!)</u></b>, 1078thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.43'>Активность: 1.06<span style='color:red'>&searr;</span>0.81</span><br>Статус: <a href="action=userinfo&amp;user=15381">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 апреля 2008 11:19 <br><script type="text/javascript">QU('reversecode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=reversecode" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11758.html&amp;page=0#17');return false;">#17</a> </span><div align=left><br>
проще уже смотреть как компилятор соптимизирует на asm<br>а то может какая то большая и неуклюжая манипуляция на С будет оптимальнее на asm<br>чем красивая и краткая
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=187301&amp;user=15381&amp;forum_n=6&amp;topic=11758.html&amp;page=0&amp;anchor=17" class="addthx" data-post="187301"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]ToBad[/b]','')">ToBad</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/702.gif" alt=""><br><span class=txtSm>Ранг: 450.3 (мудрец), 13thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.67'>Активность: 0.2<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=702">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 апреля 2008 13:49 <br><script type="text/javascript">QU('ToBad','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ToBad" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11758.html&amp;page=0#18');return false;">#18</a> </span><div align=left><br>
<I><b>Fallout</b> пишет:<br>PORTA.0 = 1;  </I><br><br>Да, это знаю, но устанавливать нужно не бит порта, а бит в переменной.<br><br><I><b>s0larian</b> пишет:<br>Это делается проще через struct и bit fields </I><br><br>Вот как раз из всего Си, (а я писал, что только учу его), со структурами я ничего и не понял...<br>Подчитаю ещё. Спасибо за наводку !<br><br><I><b>reversecode</b> пишет:<br>проще уже смотреть как компилятор соптимизирует на asm </I><br><br>Да жуть что он делает. Он зависим от конкретных значений и констант. Одну из приведенных строчек он делает в две команды, на другой десяток строк и несколько подпрограмм.<br><br><br>Я вот уперся в реализацию универсальной и оптимальной функции на Си, которая в итоге должна сделать лишь перетасовку данных с порта в соответствующие биты 2-х байтовых переменных. Если взглянуть на картину целиком, то получается всё очень просто на ассемблере если делать всё скопом:<br><br><code>clr zl<br>clr zh<br>sbis  pinb,popin<br>sbr zl,bitpokey<br>sbis  pinb,lnpin<br>sbr zl,bitlnkey<br>sbis  pinb,sl1pin<br>sbr zl,bitsl1key<br>sbis  pinb,atpin<br>sbr zh,bitatkey<br>sbis  pinb,mnpin<br>sbr zh,bitmnkey<br>sbis  pinb,cnpin<br>sbr zh,bitcnkey<br>sbis  pinb,st2pin<br>sbr zh,bitst2key<br>sbis  pind,sl3pin<br>sbr zl,bitsl3key<br>sbis  pind,st1pin<br>sbr zh,bitst1key<br>sbis  pind,btpin<br>sbr zl,bitbtkey<br>sbis  pind,sl2pin<br>sbr zl,bitsl2key<br>sbis  pinb,stpin<br>sbr zl,bitstkey</code><br><br>Единственное не разобрался ещё как передавать в CodeVision ассемблерным коммандам константы объявленные в #define. Хотя при желании всё можно заменить конкретными цифрами и номерами регистров, но это будет не наглядно.<br><br><I><b>Fallout</b> пишет:<br>п.с: вообще заметил тема МК тут появляться уже не раз что радует </I><br><br>Да, творческие идеи рвутся наружу за пределы громоздких PC... Каждая программа хочет жить своей жизнью и не зависеть от Билла... <img src="img/smilies/s1.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=187314&amp;user=702&amp;forum_n=6&amp;topic=11758.html&amp;page=0&amp;anchor=18" class="addthx" data-post="187314"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]s0larian[/b]','')">s0larian</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/1737.jpg" alt=""><br><span class=txtSm>Ранг: 387.4 (мудрец)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.19'>Активность: 0.17<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1737">Участник</a><br><font color=blue>системщик</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 апреля 2008 20:19 <br><script type="text/javascript">QU('s0larian','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=s0larian" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11758.html&amp;page=0#19');return false;">#19</a> </span><div align=left><br>
<b>ToBad</b>, вот тебе целый пример для VC++:<br><br><code><br>#pragma pack(push)<br>#pragma pack(1)<br>struct Uart<br>{<br>    byte    rx_fifo;<br>    byte    flag1:1, <br>            flag2:1, <br>            flag3:1, <br>            reserved:5;<br>    byte    tx_fifo;<br>}; <br>#pragma pack(pop)<br><br>volatile struct Uart *g_uart = (struct Uart *)0x80001010;<br><br>void init()<br>{<br>    const char *prompt = &quot;Hello\r\n&quot;;<br>    byte i;<br><br>    g_uart-&gt;flag1 = 1;  // Enable something...<br>    g_uart-&gt;flag2 = 0;  // set something else...<br><br>    for (i = 0; i &lt; strlen(prompt); ++i)<br>        g_uart-&gt;tx_fifo = prompt[i];<br>}<br></code>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=187350&amp;user=1737&amp;forum_n=6&amp;topic=11758.html&amp;page=0&amp;anchor=19" class="addthx" data-post="187350"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="20" onfocus="this.blur()" href="JavaScript:di('[b]ToBad[/b]','')">ToBad</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/702.gif" alt=""><br><span class=txtSm>Ранг: 450.3 (мудрец), 13thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.67'>Активность: 0.2<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=702">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 мая 2008 00:47 <br><script type="text/javascript">QU('ToBad','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ToBad" target="_blank">Личное сообщение</a> &middot;  <a href="#20" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11758.html&amp;page=0#20');return false;">#20</a> </span><div align=left><br>
Всем спасибо за помощь ! Со структурами тоже разобрался. Удобно, по коду переназначение битов одного байта одной структуры в другую 81 слово занимает, что меньше варианта с логикой. Так же у CodeVision есть своя работа с типом bit. По размеру это ещё не проверял. Пока помогла вставка на асме.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=187451&amp;user=702&amp;forum_n=6&amp;topic=11758.html&amp;page=0&amp;anchor=20" class="addthx" data-post="187451"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="21" onfocus="this.blur()" href="JavaScript:di('[b]Dian[/b]','')">Dian</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 37.4 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.21'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=4566">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 мая 2008 04:37 <br><script type="text/javascript">QU('Dian','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Dian" target="_blank">Личное сообщение</a> &middot;  <a href="#21" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11758.html&amp;page=0#21');return false;">#21</a> </span><div align=left><br>
Если таких конструкций много, то может быть удастся копировать сразу несколько бит?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=187623&amp;user=4566&amp;forum_n=6&amp;topic=11758.html&amp;page=0&amp;anchor=21" class="addthx" data-post="187623"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="22" onfocus="this.blur()" href="JavaScript:di('[b]AlexZ[/b]','')">AlexZ</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 203.3 (наставник)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.9'>Активность: 0.22<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=175">Участник</a><br><font color=blue>UPX Killer -d</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 мая 2008 16:30 <br><script type="text/javascript">QU('AlexZ','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=AlexZ" target="_blank">Личное сообщение</a> &middot;  <a href="#22" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=11758.html&amp;page=0#22');return false;">#22</a> </span><div align=left><br>
Возможно, есть смысл присомтреться к одной особенности ассемблера. Чисто редположение...<br>В масме например не прокатывает инструкция типа shr eax, edx или eax, dl, потому как типа надо константу указывать <img src="img/smilies/s1.gif" alt=""><br>Зато прокатывает shr eax, cl<br>Может быть, и в том асме есть подобные особенности...
<br><br><font size="1"><i>-----<br>Я медленно снимаю с неё UPX... *FF_User*</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=187752&amp;user=175&amp;forum_n=6&amp;topic=11758.html&amp;page=0&amp;anchor=22" class="addthx" data-post="187752"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Помогите оптимизировать манипуляцию с битами на Си</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#23" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="6">
<input type="hidden" name="topic" value="11758">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=11758" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
