<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Подскажите новичку по перехвату Api функций - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Доброго времени суток. Разбираюсь с перехватом API функций через dll инъекцию. В сети нашел интересный пример и на нем сделал библиотечку которая подменяет нужные функции. В частности: GetDriveTypeA, GetVolumeInformationA,">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=1288'>UniSoft</a>, <a target='_blank' href='?action=userinfo&amp;user=55953'>laslo</a>, <a target='_blank' href='?action=userinfo&amp;user=26261'>bartolomeo</a> (+5 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Подскажите новичку по перехвату Api функций</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> <a href="action=vthread&amp;forum=6&amp;topic=19274&amp;page=0.html">&lt;&lt;</a> .  <a href="action=vthread&amp;forum=6&amp;topic=19274&amp;page=0.html">1</a> . <b>2</b> . <a href="action=vthread&amp;forum=6&amp;topic=19274&amp;page=2.html">3</a> . <a href="action=vthread&amp;forum=6&amp;topic=19274&amp;page=2.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]Freeon[/b]','')">Freeon</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 2.2 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.1'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=5046">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 ноября 2011 17:16 <br><script type="text/javascript">QU('Freeon','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Freeon" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19274&amp;page=1#1');return false;">#1</a> </span><div align=left><br>
Доброго времени суток. <br>Разбираюсь с перехватом API функций через dll инъекцию.<br>В сети нашел интересный пример и на нем сделал библиотечку которая подменяет нужные функции.<br>В частности: GetDriveTypeA, GetVolumeInformationA, GetVersion, GetVersionExA<br>Все они находятся в kernel32.dll, что усложняет задачку<br>GetDriveTypeA и GetVersion удалось подменить выводы на нужные, а вот<br>GetVolumeInformationA и GetVersionExA проблемы<br>GetVolumeInformationA  возвращает 0 (наверное потому что не знаю в какой регистр писать и в один ли <img src="img/smilies/s1.gif" alt=""> )<br>А с GetVersionExA  вообще труба каким образом и как там идет возврат.<br>К сожалению приходится пользоватся почти наугад, завести на 64 битном 4 ядерном проце SoftIce не удалось а в виртуалке проблемы с видеодрайвером.<br>Да и мешает еще одна проблема <img src="img/smilies/s1.gif" alt=""> последний раз на асме писал лет 10 назад (уже с трудом что-то вспоминается).<br><br>Прошу помощи подсказками:<br>Каким софтом можно подсмотреть саму функцию kernel32 <br>Советами по поводу вовратов от функции, примером или чем нибудь еще.<br><br>В архиве программка мишень, библиотека, flat assembler и исходники всего.<br><br>http://narod.ru/disk/31656508001/project.zip.html
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=295701&amp;user=5046&amp;forum_n=6&amp;topic=19274&amp;page=1&amp;anchor=1" class="addthx" data-post="295701"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]Alchemistry[/b]','')">Alchemistry</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 145.8 (ветеран), 191thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.05'>Активность: 0.14<span style='color:green'>&nearr;</span>0.36</span><br>Статус: <a href="action=userinfo&amp;user=21411">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 ноября 2011 12:25 <br><script type="text/javascript">QU('Alchemistry','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Alchemistry" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19274&amp;page=1#2');return false;">#2</a> </span><div align=left><br>
<I>bowrouco пишет:<br>Я не знаю что такое двач. </I><br><br>Гм, ну bowrouco может и нет, а какой-нибудь из твоих 100500 клонов видимо да.<br><br><img src="http://2ch.so/pr/arch/src/1313559409904.png" border="0" align="" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=295890&amp;user=21411&amp;forum_n=6&amp;topic=19274&amp;page=1&amp;anchor=2" class="addthx" data-post="295890"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]bowrouco[/b]','')">bowrouco</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 47.7 (посетитель), 17thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.01'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29629">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 ноября 2011 12:30 <br><script type="text/javascript">QU('bowrouco','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=bowrouco" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19274&amp;page=1#3');return false;">#3</a> </span><div align=left><br>
<b>Alchemistry</b><br>Моя деограмка. Но на 2ch.so я никада не ходил. Есть немного форумов, которые я читаю и есчо меньше где я пишу. Двачей, вконтактов и прочей ереси в том списке нет.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=295891&amp;user=29629&amp;forum_n=6&amp;topic=19274&amp;page=1&amp;anchor=3" class="addthx" data-post="295891"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]Maximus[/b]','')">Maximus</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/2775.jpg" alt=""><br><span class=txtSm>Ранг: 392.8 (мудрец), 108thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.75'>Активность: 0.26<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=2775">Участник</a><br><font color=blue>REVENGE сила, БеХоЦе могила</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 ноября 2011 12:31 <br><script type="text/javascript">QU('Maximus','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Maximus" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19274&amp;page=1#4');return false;">#4</a> </span><div align=left><br>
<b>bowrouco</b><br>Давай проще. ПЕКилл до мозга костей практик. На его счету несколько автораспоковщиков самых крутых протекторов, 5000 сломанных и закейгененых программ. Он РЕАЛЬНО делал все то, о чем пишет.<br>Ты же теоретик, который на практике никогда не делал то, о чем пишешь и все твои теории навсегда останутся теориями.<br>Кстати в шапке есть прога, можешь на ее примере показать нам &quot;патч от Инде&quot;?
<br><br><font size="1"><i>-----<br>StarForce и Themida ацтой!</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=295892&amp;user=2775&amp;forum_n=6&amp;topic=19274&amp;page=1&amp;anchor=4" class="addthx" data-post="295892"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]bowrouco[/b]','')">bowrouco</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 47.7 (посетитель), 17thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.01'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29629">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 ноября 2011 12:37 &middot; Поправил: bowrouco <br><script type="text/javascript">QU('bowrouco','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=bowrouco" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19274&amp;page=1#5');return false;">#5</a> </span><div align=left><br>
<b>Maximus</b><br><br>&gt; Он РЕАЛЬНО делал все то, о чем пишет.<br><br>Дык в том и проблема. Может он делал то о чём пишет гдето там, но то о чём он пишет тут он даже не понимает. Я ничего не кейгеню и не пишу что я это делал.<br><br>&gt; Ты же теоретик, который на практике никогда не делал то, о чем пишешь и все твои теории навсегда останутся теориями.<br><br>Многие из моих теорий реализовано в коде. Многие не реализованы изза высокой сложности и большого количества нужных человекочасов для реализации. Но я стараюсь.<br><br>&gt; Кстати в шапке есть прога, можешь на ее примере показать нам &quot;патч от Инде&quot;?<br><br>Для меня сама идея портить код отвратительна, так что мне предложить вам нечего. Вдобавок эта задача примитивна. Да и реализаций даже системных достаточно - вирификатор, хотпатчер всякие либы, от мс была какаято забыл как называется.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=295893&amp;user=29629&amp;forum_n=6&amp;topic=19274&amp;page=1&amp;anchor=5" class="addthx" data-post="295893"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]Alchemistry[/b]','')">Alchemistry</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 145.8 (ветеран), 191thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.05'>Активность: 0.14<span style='color:green'>&nearr;</span>0.36</span><br>Статус: <a href="action=userinfo&amp;user=21411">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 ноября 2011 12:45 &middot; Поправил: Alchemistry <br><script type="text/javascript">QU('Alchemistry','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Alchemistry" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19274&amp;page=1#6');return false;">#6</a> </span><div align=left><br>
<b>bowrouco</b><br><br>Я знаю PE_Kill по его программам, а тебя только по срачам на васме, который я иногда читаю.<br><br>У тебя сейчас прекрасная возможность показать себя и свои техники на практике как и предложил <b>Maximus</b>. Возьми задачу из шапки и сделай. А потом объясни это ТС, так чтобы он понял. Сделаешь - респект. Опять начнешь генерить бред или свалишь из темы - шито поделать десу.<br><br>Блджад Клерк, сколько же у тебя свободного времени.<br><br>upd.<br><br><I>Для меня сама идея портить код отвратительна, так что мне предложить вам нечего. Вдобавок эта задача примитивна. Да и реализаций даже системных достаточно - вирификатор, хотпатчер всякие либы, от мс была какаято забыл как называется. </I><br><br>Ну все ясно, очередной слив.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=295894&amp;user=21411&amp;forum_n=6&amp;topic=19274&amp;page=1&amp;anchor=6" class="addthx" data-post="295894"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]PE_Kill[/b]','')">PE_Kill</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3232.gif" alt=""><br><span class=txtSm>Ранг: 793.4 <font color=magenta>(<b>! !</b>)</font>, 568thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.59'>Активность: 0.74<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3232">Участник</a><br><font color=blue>Шаман</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 ноября 2011 13:00 <br><script type="text/javascript">QU('PE_Kill','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=PE_Kill" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19274&amp;page=1#7');return false;">#7</a> </span><div align=left><br>
Клерк на дваче, ох епт. Что вообще с ним разговаривать. Клерк - есть еще башорг, не пробовал туда ресечить?
<br><br><font size="1"><i>-----<br>Yann Tiersen best and do not fuck</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=295896&amp;user=3232&amp;forum_n=6&amp;topic=19274&amp;page=1&amp;anchor=7" class="addthx" data-post="295896"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]bowrouco[/b]','')">bowrouco</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 47.7 (посетитель), 17thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.01'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29629">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 ноября 2011 13:04 <br><script type="text/javascript">QU('bowrouco','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=bowrouco" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19274&amp;page=1#8');return false;">#8</a> </span><div align=left><br>
<b>Alchemistry</b><br><br>Есть же LdrHotPatchRoutine() - готовый системный функционал, зачем велосипед изобретать.<br><br>Вдобавок главное идея, потом алгоритм для её реализации, потом уже реализация в виде кода. Первое и второе тут никому не нужно, нужен готовый код. Алго то там как такового и нет - енумим потоки, проверяем что ни один из них не стоит на изменяемых инструкциях(чтобы на середине новой не оказался), если это так, то копируем код в буфер, пишем туда стаб и далее изменяем код. До тупого примитивно, что там реализовать, да и зачем мне это. Кстати давным давно, когда я был таким наивным и нубом как вы, я реализовал сие в виде либы. У меня есчо эти древние кодесы остались:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">WaitForSplaysReady&nbsp;<span class="hl_function"><b>proc</b></span>&nbsp;ProcessHandle<span class="hl_char">:</span>HANDLE<span class="hl_char">,</span>&nbsp;Loops<span class="hl_char">:</span>ULONG<span class="hl_char">,</span>&nbsp;SplaysAddress<span class="hl_char">:</span>PVOID<span class="hl_char">,</span>&nbsp;SplaysSize<span class="hl_char">:</span>ULONG</li><li class="hl_l1"><span class="hl_function"><b>Local</b></span>&nbsp;LocalTimeout<span class="hl_char">:</span>LARGE_INTEGER</li><li class="hl_l0"><span class="hl_function"><b>Local</b></span>&nbsp;CurrentFlag<span class="hl_char">:</span>BOOLEAN<span class="hl_comment">;, LastThread:BOOLEAN</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;IsCurrentProcessHandle<span class="hl_char">,</span>&nbsp;ProcessHandle<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;CurrentFlag</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>test</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jnz</b></span>&nbsp;exit_</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cmp</b></span>&nbsp;CurrentFlag<span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>STATUS_INVALID_HANDLE</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jnz</b></span>&nbsp;exit_</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;invoke ZwQueryInformationThread, NtCurrentThread, ThreadAmILastThread, addr LastThread, SizeOf BOOLEAN, NULL</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;test eax,eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;jnz exit_</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;cmp LastThread,eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;mov eax,STATUS_INVALID_PARAMETER_1</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;jz exit_</span></li><li class="hl_l1">valid_<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;InitializeTimeout<span class="hl_char">,</span>&nbsp;<span class="hl_number">20</span><span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;LocalTimeout</li><li class="hl_l1">loop_<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;ZwSuspendProcess<span class="hl_char">,</span>&nbsp;ProcessHandle</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;IsSplaysReady<span class="hl_char">,</span>&nbsp;ProcessHandle<span class="hl_char">,</span>&nbsp;SplaysAddress<span class="hl_char">,</span>&nbsp;SplaysSize</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>test</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jz</b></span>&nbsp;exit_</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;ZwResumeProcess<span class="hl_char">,</span>&nbsp;ProcessHandle</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cmp</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>STATUS_CONFLICTING_ADDRESSES</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jnz</b></span>&nbsp;exit_</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;ZwDelayExecution<span class="hl_char">,</span>&nbsp;<span class="hl_function">FALSE</span><span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;LocalTimeout</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>dec</b></span>&nbsp;Loops</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jnz</b></span>&nbsp;loop_</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>STATUS_TIMEOUT</li><li class="hl_l1">exit_<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">ret</span></li><li class="hl_l1">WaitForSplaysReady&nbsp;<span class="hl_function">endp</span></li>        </ol>
    </div>
</div></div>
<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">NtSplaysFunction&nbsp;<span class="hl_function"><b>proc</b></span>&nbsp;<span class="hl_function"><b>uses</b></span>&nbsp;<span class="hl_registr"><b>ebx</b></span>&nbsp;<span class="hl_registr"><b>esi</b></span>&nbsp;<span class="hl_registr"><b>edi</b></span>&nbsp;SectionHandle<span class="hl_char">:</span>HANDLE<span class="hl_char">,</span>&nbsp;Function<span class="hl_char">:</span>PVOID<span class="hl_char">,</span>&nbsp;Handler<span class="hl_char">:</span>PVOID<span class="hl_char">,</span>&nbsp;CallbackBuffer<span class="hl_char">:</span>PVOID<span class="hl_char">,</span>&nbsp;CallbackBufferSize<span class="hl_char">:</span>PULONG<span class="hl_char">,</span>&nbsp;SavePoint<span class="hl_char">:</span>BOOLEAN<span class="hl_char">,</span>&nbsp;RestoreInformation<span class="hl_char">:</span>PULONG</li><li class="hl_l1"><span class="hl_function"><b>Local</b></span>&nbsp;MapAddress<span class="hl_char">:</span>PVOID<span class="hl_char">,</span>&nbsp;MapSize<span class="hl_char">:</span>ULONG</li><li class="hl_l0"><span class="hl_function"><b>Local</b></span>&nbsp;SystemInformation<span class="hl_char">:</span>SYSTEM_BASIC_INFORMATION</li><li class="hl_l1"><span class="hl_function"><b>Local</b></span>&nbsp;DecodeInformation<span class="hl_char">:</span>DECODE_MACRO</li><li class="hl_l0"><span class="hl_function"><b>Local</b></span>&nbsp;LocalCallbackBuffer<span class="hl_char">[</span>SPLAYS_MINIMUM_SIZE<span class="hl_char">]</span><span class="hl_char">:</span><span class="hl_function">BYTE</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_setseh_</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_IsSupportedCx8_</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;ZwQuerySystemInformation<span class="hl_char">,</span>&nbsp;SystemBasicInformation<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;SystemInformation<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>SizeOf</b></span>&nbsp;SYSTEM_BASIC_INFORMATION<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>NULL</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;PAGE_SIZE</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>test</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span>RestoreInformation</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span>CallbackBufferSize</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jnz</b></span>&nbsp;exit_</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">edx</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_registr"><b>eax</b></span>&nbsp;&nbsp;&nbsp;<span class="hl_comment">;Test write</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">edx</span><span class="hl_char">+</span><span class="hl_number">4</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">ecx</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;MapAddress<span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span>Function</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lea</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span>MapSize</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lea</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span>MapAddress</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_VirtualToPhysicalEbx_</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;PAGE_READWRITE</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>dec</b></span>&nbsp;SystemInformation<span class="hl_char">.</span>PhysicalPageSize</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">edx</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">ecx</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">ebx</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>and</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span>SystemInformation<span class="hl_char">.</span>PhysicalPageSize&nbsp;&nbsp;<span class="hl_comment">;Offset</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;SectionHandle&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lea</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_char">[</span><span class="hl_registr">ebx</span><span class="hl_char">+</span><span class="hl_number">4</span><span class="hl_char">]</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;NtCurrentProcess&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;MapSize<span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>Call</b></span>&nbsp;MapViewOfPhysicalMemorySection</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>test</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jnz</b></span>&nbsp;exit_</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_subsetseh_</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span>MapAddress</li><li class="hl_l1"><span class="hl_comment">;Jump and Call -&gt; chain handling</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">cld</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_number">6</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cmp</b></span>&nbsp;<span class="hl_function"><b>byte</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">ebx</span><span class="hl_char">]</span><span class="hl_char">,</span>OPCODE_JUMP</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lea</b></span>&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span>LocalCallbackBuffer</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span>Function</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span><span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">ebx</span><span class="hl_char">+</span><span class="hl_number">1</span><span class="hl_char">]</span>&nbsp;<span class="hl_comment">;displacement</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lea</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span><span class="hl_char">[</span><span class="hl_registr"><b>edx</b></span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_registr"><b>ecx</b></span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">5</span><span class="hl_char">]</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>je</b></span>&nbsp;write_callback_</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cmp</b></span>&nbsp;<span class="hl_function"><b>byte</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">ebx</span><span class="hl_char">]</span><span class="hl_char">,</span>OPCODE_CALL</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jne</b></span>&nbsp;decode_</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_function"><b>byte</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">edi</span><span class="hl_char">]</span><span class="hl_char">,</span>OPCODE_PUSH</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lea</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span><span class="hl_char">[</span><span class="hl_registr"><b>ecx</b></span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">5</span><span class="hl_char">]</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">edi</span><span class="hl_char">+</span><span class="hl_number">1</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_registr">ecx</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lea</b></span>&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span><span class="hl_char">[</span><span class="hl_registr">edi</span><span class="hl_char">+</span><span class="hl_number">5</span><span class="hl_char">]</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jmp</b></span>&nbsp;write_callback_</li><li class="hl_l1"><span class="hl_comment">;Address_Jmp_E9=@+Disp+5</span></li><li class="hl_l0"><span class="hl_comment">;Disp=Address-@-5</span></li><li class="hl_l1">decode_<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;DecodeMacroSize<span class="hl_char">,</span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span>&nbsp;SIZEOF_JUMP<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;DecodeInformation</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>test</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">cld</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jnz</b></span>&nbsp;err_decode_</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cmp</b></span>&nbsp;DecodeInformation<span class="hl_char">.</span>IpFlag<span class="hl_char">,</span><span class="hl_registr"><b>eax</b></span>&nbsp;&nbsp;&nbsp;<span class="hl_comment">;IP_IGNORE</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>STATUS_DECRYPTION_FAILED</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jne</b></span>&nbsp;err_decode_</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span>Function</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span>DecodeInformation<span class="hl_char">.</span>_Length</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">esi</span><span class="hl_char">,</span><span class="hl_registr">ebx</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span><span class="hl_registr">ecx</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">ecx</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>rep</b></span>&nbsp;<span class="hl_function">movsb</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_number">6</span></li><li class="hl_l0">write_callback_<span class="hl_char">:</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span>CallbackBufferSize</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_function"><b>byte</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">edi</span><span class="hl_char">]</span><span class="hl_char">,</span>OPCODE_PUSH</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">edi</span><span class="hl_char">+</span><span class="hl_number">1</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_registr">edx</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_function"><b>byte</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">edi</span><span class="hl_char">+</span><span class="hl_number">5</span><span class="hl_char">]</span><span class="hl_char">,</span>OPCODE_RET</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span>CallbackBuffer</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">ecx</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_VirtualToPhysicalEdx_</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;PhysicalMemoryOperation<span class="hl_char">,</span>&nbsp;SectionHandle<span class="hl_char">,</span>&nbsp;OPERATION_WRITE<span class="hl_char">,</span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;LocalCallbackBuffer<span class="hl_char">,</span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>test</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">esi</span><span class="hl_char">,</span><span class="hl_registr">ebx</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jnz</b></span>&nbsp;err_decode_</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>xor</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span><span class="hl_registr">edx</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>xor</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>xor</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span><span class="hl_registr">ebx</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>xor</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span><span class="hl_registr">ecx</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span>RestoreInformation</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lock</b></span>&nbsp;<span class="hl_function"><b>cmpxchg8b</b></span>&nbsp;qword&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">Esi</span><span class="hl_char">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;Edx:Eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span>Handler</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>sub</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span>Function</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>sub</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span><span class="hl_number">5</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span><span class="hl_registr">ebx</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>shl</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span><span class="hl_number">8</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>rol</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span><span class="hl_number">8</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;SavePoint<span class="hl_char">=</span><span class="hl_char">=</span><span class="hl_function">NULL</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>or</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span>OPCODE_JUMP</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">else</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>or</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span>OPCODE_CALL</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">endif</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>and</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span><span class="hl_number">11111111b</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lock</b></span>&nbsp;<span class="hl_function"><b>cmpxchg8b</b></span>&nbsp;qword&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">Esi</span><span class="hl_char">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;Edx:Eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">edi</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">edi</span><span class="hl_char">+</span><span class="hl_number">4</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_registr">edx</span></li><li class="hl_l1"><span class="hl_comment">;[Mem64]==Edx:Eax	[Mem64]&lt;-Ecx:Ebx</span></li><li class="hl_l0"><span class="hl_comment">;[Mem64]&lt;&gt;Edx:Eax	Edx:Eax&lt;-[Mem64]</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>xor</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l0">err_decode_<span class="hl_char">:</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_subendseh_</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;ZwUnmapViewOfSection<span class="hl_char">,</span>&nbsp;NtCurrentProcess<span class="hl_char">,</span>&nbsp;MapAddress</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1">exit_<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_endseh_</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">ret</span></li><li class="hl_l0">NtSplaysFunction&nbsp;<span class="hl_function">endp</span></li>        </ol>
    </div>
</div></div>
<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">PsBreakpointControlReady&nbsp;<span class="hl_function"><b>proc</b></span>&nbsp;ProcessHandle<span class="hl_char">:</span>HANDLE<span class="hl_char">,</span>&nbsp;TestOrWaitReady<span class="hl_char">:</span>ULONG<span class="hl_char">,</span>&nbsp;Address<span class="hl_char">:</span>PVOID<span class="hl_char">,</span>&nbsp;BpValue<span class="hl_char">:</span>PCHAR</li><li class="hl_l1"><span class="hl_function"><b>Local</b></span>&nbsp;ReturnLength<span class="hl_char">:</span>ULONG</li><li class="hl_l0"><span class="hl_function"><b>Local</b></span>&nbsp;ReturnByte<span class="hl_char">:</span><span class="hl_function">BYTE</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_setseh_</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lea</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>ReturnLength</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>xor</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>inc</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lea</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>ReturnByte</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;Address</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;ProcessHandle</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>Call</b></span>&nbsp;PsReadVirtualMemoryProtected</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">!</span><span class="hl_registr">Eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lea</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>ReturnLength</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>xor</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>inc</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;BpValue</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;Address</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;TestOrWaitReady</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;ProcessHandle</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>Call</b></span>&nbsp;PsWriteVirtualMemoryProtectedReady</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">!</span><span class="hl_registr">Eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span>BpValue</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">cl</span><span class="hl_char">,</span>ReturnByte</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_function"><b>byte</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">edx</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_registr">cl</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">endif</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">endif</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_endseh_</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">ret</span></li><li class="hl_l1">PsBreakpointControlReady&nbsp;<span class="hl_function">endp</span></li>        </ol>
    </div>
</div></div>
<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">PsWriteVirtualMemoryProtectedReady&nbsp;<span class="hl_function"><b>proc</b></span>&nbsp;ProcessHandle<span class="hl_char">:</span>HANDLE<span class="hl_char">,</span>&nbsp;TestOrWaitReady<span class="hl_char">:</span>ULONG<span class="hl_char">,</span>&nbsp;BaseAddress<span class="hl_char">:</span>PVOID<span class="hl_char">,</span>&nbsp;Buffer<span class="hl_char">:</span>PVOID<span class="hl_char">,</span>&nbsp;BufferLength<span class="hl_char">:</span>ULONG<span class="hl_char">,</span>&nbsp;ReturnLength<span class="hl_char">:</span>PULONG</li><li class="hl_l1"><span class="hl_function"><b>Local</b></span>&nbsp;Protect<span class="hl_char">:</span>ULONG<span class="hl_char">,</span>&nbsp;ProtectBaseAddress<span class="hl_char">:</span>PVOID<span class="hl_char">,</span>&nbsp;ProtectBufferLength<span class="hl_char">:</span>ULONG</li><li class="hl_l0"><span class="hl_function"><b>Local</b></span>&nbsp;AffinityMask<span class="hl_char">:</span>ULONG</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_setseh_</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;AffinityMask<span class="hl_char">,</span><span class="hl_number">1</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;SetProcessAffinityMaskEx<span class="hl_char">,</span>&nbsp;ProcessHandle<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;AffinityMask</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">!</span><span class="hl_registr">Eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;TestOrWaitReady<span class="hl_char">=</span><span class="hl_char">=</span>SPLAYS_READY_TEST</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;IsSplaysReady<span class="hl_char">,</span>&nbsp;ProcessHandle<span class="hl_char">,</span>&nbsp;BaseAddress<span class="hl_char">,</span>&nbsp;BufferLength</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>elseif</b></span>&nbsp;TestOrWaitReady<span class="hl_char">=</span><span class="hl_char">=</span>SPLAYS_READY_WAIT&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;WaitForSplaysReady<span class="hl_char">,</span>&nbsp;ProcessHandle<span class="hl_char">,</span>&nbsp;<span class="hl_number">50</span><span class="hl_char">,</span>&nbsp;BaseAddress<span class="hl_char">,</span>&nbsp;BufferLength</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">endif</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>BaseAddress</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;ProtectBaseAddress<span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>BufferLength</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;ProtectBufferLength<span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;ZwProtectVirtualMemory<span class="hl_char">,</span>&nbsp;ProcessHandle<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;ProtectBaseAddress<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;ProtectBufferLength<span class="hl_char">,</span>&nbsp;PAGE_EXECUTE_READWRITE<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;Protect</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">!</span><span class="hl_registr">Eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;ZwWriteVirtualMemory<span class="hl_char">,</span>&nbsp;ProcessHandle<span class="hl_char">,</span>&nbsp;BaseAddress<span class="hl_char">,</span>&nbsp;Buffer<span class="hl_char">,</span>&nbsp;BufferLength<span class="hl_char">,</span>&nbsp;ReturnLength&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;ZwFlushInstructionCache<span class="hl_char">,</span>&nbsp;ProcessHandle<span class="hl_char">,</span>&nbsp;BaseAddress<span class="hl_char">,</span>&nbsp;BufferLength</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;ZwProtectVirtualMemory<span class="hl_char">,</span>&nbsp;ProcessHandle<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;ProtectBaseAddress<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;ProtectBufferLength<span class="hl_char">,</span>&nbsp;Protect<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;Protect</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">endif</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;SetProcessAffinityMaskEx<span class="hl_char">,</span>&nbsp;ProcessHandle<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;AffinityMask</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">endif</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_endseh_</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">ret</span></li><li class="hl_l0">PsWriteVirtualMemoryProtectedReady&nbsp;&nbsp;<span class="hl_function">endp</span></li>        </ol>
    </div>
</div></div>
<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">NtInstallCallGate&nbsp;<span class="hl_function"><b>proc</b></span>&nbsp;<span class="hl_function"><b>uses</b></span>&nbsp;<span class="hl_registr"><b>ebx</b></span>&nbsp;<span class="hl_registr"><b>esi</b></span>&nbsp;SectionHandle<span class="hl_char">:</span>HANDLE<span class="hl_char">,</span>&nbsp;Processor<span class="hl_char">:</span>ULONG<span class="hl_char">,</span>&nbsp;GateRoutine<span class="hl_char">:</span>PVOID<span class="hl_char">,</span>&nbsp;ResultSelector<span class="hl_char">:</span>PULONG</li><li class="hl_l1"><span class="hl_function"><b>Local</b></span>&nbsp;MappingSize<span class="hl_char">:</span>ULONG<span class="hl_char">,</span>&nbsp;MappingAddress<span class="hl_char">:</span>PVOID</li><li class="hl_l0"><span class="hl_function"><b>Local</b></span>&nbsp;SystemInformation<span class="hl_char">:</span>SYSTEM_BASIC_INFORMATION</li><li class="hl_l1"><span class="hl_function"><b>Local</b></span>&nbsp;ProcessorGdt<span class="hl_char">:</span>GDTR_FIELD</li><li class="hl_l0"><span class="hl_function"><b>Local</b></span>&nbsp;Status<span class="hl_char">:</span>NTSTATUS</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_setseh_</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;ZwQuerySystemInformation<span class="hl_char">,</span>&nbsp;SystemBasicInformation<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;SystemInformation<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>SizeOf</b></span>&nbsp;SYSTEM_BASIC_INFORMATION<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>NULL</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;PAGE_SIZE</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>test</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jnz</b></span>&nbsp;exit_&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>dec</b></span>&nbsp;SystemInformation<span class="hl_char">.</span>PhysicalPageSize</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;ExecuteOnProcessor<span class="hl_char">,</span>&nbsp;Processor<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;QueryProcessorGdtCallback<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;Status<span class="hl_char">,</span>&nbsp;SystemInformation<span class="hl_char">.</span>PhysicalPageSize<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;ProcessorGdt</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>test</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">esi</span><span class="hl_char">,</span>ResultSelector</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jnz</b></span>&nbsp;exit_</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>Status</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>test</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jnz</b></span>&nbsp;exit_</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">esi</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lea</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span>MappingAddress</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;PAGE_READWRITE</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">edx</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lea</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span>MappingSize</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">edx</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">ecx</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;ProcessorGdt<span class="hl_char">.</span>_Base</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>and</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span>SystemInformation<span class="hl_char">.</span>PhysicalPageSize&nbsp;&nbsp;<span class="hl_comment">;Offset</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;SectionHandle&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lea</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_char">[</span><span class="hl_registr">edx</span><span class="hl_char">+</span><span class="hl_number">8192</span><span class="hl_char">*</span><span class="hl_number">8</span><span class="hl_char">]</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;NtCurrentProcess</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">ecx</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>Call</b></span>&nbsp;MapViewOfPhysicalMemorySection</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>test</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jnz</b></span>&nbsp;exit_</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span>MappingAddress</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_subsetseh_</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>movzx</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span>ProcessorGdt<span class="hl_char">.</span>_Limit</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>inc</b></span>&nbsp;<span class="hl_registr">ecx</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span><span class="hl_number">8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;Искл. нулевой дескриптор</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>shr</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span><span class="hl_number">3</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;Число дескрипторов</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>assume</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">:</span>PCALL_GATE_DESCRIPTOR</li><li class="hl_l0"><span class="hl_comment">;Ищем первый свободный дескриптор</span></li><li class="hl_l1">search_<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>test</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">ebx</span><span class="hl_char">]</span><span class="hl_char">.</span>AccessRights<span class="hl_char">,</span><span class="hl_number">10000000b</span>&nbsp;&nbsp;<span class="hl_comment">;Bit P: Present</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jnz</b></span>&nbsp;next_gate_</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cmp</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">ebx</span><span class="hl_char">]</span><span class="hl_char">.</span>OffsetLo<span class="hl_char">,</span><span class="hl_registr">ax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jnz</b></span>&nbsp;next_gate_</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cmp</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">ebx</span><span class="hl_char">]</span><span class="hl_char">.</span>OffsetHi<span class="hl_char">,</span><span class="hl_registr">ax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jnz</b></span>&nbsp;next_gate_</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>GateRoutine&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>movzx</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span><span class="hl_registr">ax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>or</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span><span class="hl_number">10000000000000000000b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;(2^16)*08h	;селектор</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>and</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_number">11111111111111110000000000000000b</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>or</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_number">1110110000000000b</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lock</b></span>&nbsp;<span class="hl_function"><b>xchg</b></span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">ebx</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_registr">edx</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lock</b></span>&nbsp;<span class="hl_function"><b>xchg</b></span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">ebx</span><span class="hl_char">+</span><span class="hl_number">4</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>sub</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span>MappingAddress</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">esi</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_registr">ebx</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>xor</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jmp</b></span>&nbsp;return_</li><li class="hl_l1">next_gate_<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span><span class="hl_number">8</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>loop</b></span>&nbsp;search_</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>STATUS_NOT_FOUND</li><li class="hl_l1">return_<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_subendseh_</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;ZwUnmapViewOfSection<span class="hl_char">,</span>&nbsp;NtCurrentProcess<span class="hl_char">,</span>&nbsp;MappingAddress</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l0">exit_<span class="hl_char">:</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_endseh_</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">ret</span></li><li class="hl_l1">NtInstallCallGate&nbsp;<span class="hl_function">endp</span></li>        </ol>
    </div>
</div></div>
<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">PhysicalMemoryLockExchange8b&nbsp;<span class="hl_function"><b>proc</b></span>&nbsp;<span class="hl_function"><b>uses</b></span>&nbsp;<span class="hl_registr"><b>esi</b></span>&nbsp;<span class="hl_registr"><b>edi</b></span>&nbsp;<span class="hl_registr"><b>ebx</b></span>&nbsp;SectionHandle<span class="hl_char">:</span>HANDLE<span class="hl_char">,</span>&nbsp;PhysicalAddress<span class="hl_char">:</span>PVOID<span class="hl_char">,</span>&nbsp;InOutValue<span class="hl_char">:</span>PLARGE_INTEGER</li><li class="hl_l1"><span class="hl_function"><b>Local</b></span>&nbsp;MappingSize<span class="hl_char">:</span>ULONG<span class="hl_char">,</span>&nbsp;MappingAddress<span class="hl_char">:</span>PVOID</li><li class="hl_l0"><span class="hl_function"><b>Local</b></span>&nbsp;SystemInformation<span class="hl_char">:</span>SYSTEM_BASIC_INFORMATION</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_setseh_</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_IsSupportedCx8_</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">esi</span><span class="hl_char">,</span>PhysicalAddress</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;ZwQuerySystemInformation<span class="hl_char">,</span>&nbsp;SystemBasicInformation<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;SystemInformation<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>SizeOf</b></span>&nbsp;SYSTEM_BASIC_INFORMATION<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>NULL</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;PAGE_SIZE</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>test</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jnz</b></span>&nbsp;exit_</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lea</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span>MappingAddress</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;PAGE_READWRITE</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">edx</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lea</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span>MappingSize&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>dec</b></span>&nbsp;SystemInformation<span class="hl_char">.</span>PhysicalPageSize</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">edx</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">ecx</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">esi</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>and</b></span>&nbsp;<span class="hl_registr">esi</span><span class="hl_char">,</span>SystemInformation<span class="hl_char">.</span>PhysicalPageSize&nbsp;&nbsp;<span class="hl_comment">;Offset</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;SectionHandle&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lea</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_char">[</span><span class="hl_registr">esi</span><span class="hl_char">+</span><span class="hl_number">8</span><span class="hl_char">]</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;NtCurrentProcess&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">ecx</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>Call</b></span>&nbsp;MapViewOfPhysicalMemorySection</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>test</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jnz</b></span>&nbsp;exit_</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_subsetseh_</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span>InOutValue</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">esi</span><span class="hl_char">,</span>MappingAddress</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>xor</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span><span class="hl_registr">edx</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>xor</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>xor</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span><span class="hl_registr">ebx</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>xor</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span><span class="hl_registr">ecx</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lock</b></span>&nbsp;<span class="hl_function"><b>cmpxchg8b</b></span>&nbsp;qword&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">Esi</span><span class="hl_char">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;Edx:Eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span><span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">edi</span><span class="hl_char">]</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span><span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">edi</span><span class="hl_char">+</span><span class="hl_number">4</span><span class="hl_char">]</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lock</b></span>&nbsp;<span class="hl_function"><b>cmpxchg8b</b></span>&nbsp;qword&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">Esi</span><span class="hl_char">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;Edx:Eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">edi</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">edi</span><span class="hl_char">+</span><span class="hl_number">4</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_registr">edx</span></li><li class="hl_l0"><span class="hl_comment">;[Mem64]==Edx:Eax	[Mem64]&lt;-Ecx:Ebx</span></li><li class="hl_l1"><span class="hl_comment">;[Mem64]&lt;&gt;Edx:Eax	Edx:Eax&lt;-[Mem64]</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>xor</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_subendseh_</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;ZwUnmapViewOfSection<span class="hl_char">,</span>&nbsp;NtCurrentProcess<span class="hl_char">,</span>&nbsp;MappingAddress</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1">exit_<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_endseh_</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">ret</span></li><li class="hl_l0">PhysicalMemoryLockExchange8b&nbsp;<span class="hl_function">endp</span></li>        </ol>
    </div>
</div></div>
<br>И есчо с пол мегабайта такого дерьма.<br><br><b>PE_Kill</b><br>Жирно тролите товарищ.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=295897&amp;user=29629&amp;forum_n=6&amp;topic=19274&amp;page=1&amp;anchor=8" class="addthx" data-post="295897"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]Alchemistry[/b]','')">Alchemistry</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 145.8 (ветеран), 191thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.05'>Активность: 0.14<span style='color:green'>&nearr;</span>0.36</span><br>Статус: <a href="action=userinfo&amp;user=21411">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 ноября 2011 13:10 &middot; Поправил: Alchemistry <br><script type="text/javascript">QU('Alchemistry','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Alchemistry" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19274&amp;page=1#9');return false;">#9</a> </span><div align=left><br>
<b>bowrouco</b><br><br><img src="http://s017.radikal.ru/i436/1111/f5/016be856cf49.jpg" border="0" align="" alt=""><br><br>Конкретика, Клерк, конкретика. <br><br>Дано: задача в шапке, двиг IDP + ворох тобой придуманных терминов.<br>Требуется: реализовать православный перехват Инде, объяснить ТС решение.<br>Ах да, решение должно быть рабочим, а не &quot;для идеи&quot;.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=295898&amp;user=21411&amp;forum_n=6&amp;topic=19274&amp;page=1&amp;anchor=9" class="addthx" data-post="295898"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]bowrouco[/b]','')">bowrouco</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 47.7 (посетитель), 17thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.01'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29629">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 ноября 2011 13:10 &middot; Поправил: bowrouco <br><script type="text/javascript">QU('bowrouco','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=bowrouco" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19274&amp;page=1#10');return false;">#10</a> </span><div align=left><br><div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">PsSplaysSystemService&nbsp;<span class="hl_function"><b>proc</b></span>&nbsp;<span class="hl_function"><b>uses</b></span>&nbsp;<span class="hl_registr"><b>ebx</b></span>&nbsp;<span class="hl_registr"><b>esi</b></span>&nbsp;ProcessHandle<span class="hl_char">:</span>HANDLE<span class="hl_char">,</span>&nbsp;MapInformation<span class="hl_char">:</span>PFILE_MAP_INFORMATION<span class="hl_char">,</span>&nbsp;FunctionName<span class="hl_char">:</span>PCHAR<span class="hl_char">,</span>&nbsp;ServiceRva<span class="hl_char">:</span>ULONG<span class="hl_char">,</span>&nbsp;NewFunctionReference<span class="hl_char">:</span>PVOID<span class="hl_char">,</span>&nbsp;ServiceInformation<span class="hl_char">:</span>PSERVICE_INFORMATION<span class="hl_char">,</span>&nbsp;FunctionInformation<span class="hl_char">:</span>PFUNCTION_INFORMATION</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_setseh_</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">esi</span><span class="hl_char">,</span>MapInformation</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>assume</b></span>&nbsp;<span class="hl_registr">esi</span><span class="hl_char">:</span>PFILE_MAP_INFORMATION</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;RtlImageNtHeader<span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">esi</span><span class="hl_char">]</span><span class="hl_char">.</span>ImageBase</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>test</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jz</b></span>&nbsp;err_format_</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>assume</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">:</span>PIMAGE_NT_HEADERS</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span><span class="hl_char">[</span><span class="hl_registr">eax</span><span class="hl_char">]</span><span class="hl_char">.</span>OptionalHeader<span class="hl_char">.</span>ImageBase</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>test</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span><span class="hl_registr">ebx</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jz</b></span>&nbsp;err_format_</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>ServiceRva</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">!</span><span class="hl_registr">Eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;ImageQueryFunctionRvaFromName<span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">esi</span><span class="hl_char">]</span><span class="hl_char">.</span>ImageBase<span class="hl_char">,</span>&nbsp;FunctionName<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;ServiceRva</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>test</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jnz</b></span>&nbsp;exit_</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>ServiceRva</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">endif</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cmp</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">esi</span><span class="hl_char">]</span><span class="hl_char">.</span>ViewSize<span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jbe</b></span>&nbsp;err_format_</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span><span class="hl_registr"><b>eax</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;Адрес функции</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;IsValidSystemService<span class="hl_char">,</span>&nbsp;<span class="hl_registr">ebx</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>test</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jnz</b></span>&nbsp;exit_</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>assume</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">:</span>PSERVICE_CALL_INFORMATION</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span>ServiceInformation</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>assume</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">:</span>PSERVICE_INFORMATION</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_registr">Edx</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_char">[</span><span class="hl_registr">ebx</span><span class="hl_char">]</span><span class="hl_char">.</span>ServiceCode</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>xor</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span><span class="hl_registr">ecx</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">edx</span><span class="hl_char">]</span><span class="hl_char">.</span>ServiceCode<span class="hl_char">,</span><span class="hl_registr">ax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">ebx</span><span class="hl_char">]</span><span class="hl_char">.</span>OpReturn<span class="hl_char">=</span><span class="hl_char">=</span><span class="hl_number">0C2h</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ax</span><span class="hl_char">,</span><span class="hl_char">[</span><span class="hl_registr">ebx</span><span class="hl_char">]</span><span class="hl_char">.</span>RetBytes</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">endif</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">edx</span><span class="hl_char">]</span><span class="hl_char">.</span>SizeOfData<span class="hl_char">,</span><span class="hl_registr">ax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">endif</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span>FunctionInformation</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>assume</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">:</span>PFUNCTION_INFORMATION</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_registr">Edx</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>ServiceRva</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">edx</span><span class="hl_char">]</span><span class="hl_char">.</span>FunctionAddress<span class="hl_char">,</span><span class="hl_registr">ebx</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">edx</span><span class="hl_char">]</span><span class="hl_char">.</span>FunctionRva<span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">endif</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lea</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span><span class="hl_char">[</span><span class="hl_registr">ebx</span><span class="hl_char">]</span><span class="hl_char">.</span>SystemKi</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;PsWriteVirtualMemoryProtected<span class="hl_char">,</span>&nbsp;ProcessHandle<span class="hl_char">,</span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;NewFunctionReference<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>SizeOf</b></span>&nbsp;PVOID<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;FunctionName</li><li class="hl_l0">exit_<span class="hl_char">:</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_endseh_&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">ret</span></li><li class="hl_l1">err_format_<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>STATUS_INVALID_IMAGE_FORMAT</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jmp</b></span>&nbsp;exit_</li><li class="hl_l0">err_code_<span class="hl_char">:</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>STATUS_INVALID_SYSTEM_SERVICE</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jmp</b></span>&nbsp;exit_</li><li class="hl_l1">PsSplaysSystemService&nbsp;<span class="hl_function">endp</span></li>        </ol>
    </div>
</div></div>
<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">ROUTINE_DATA&nbsp;struct</li><li class="hl_l1">pExAllocatePool&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PVOID&nbsp;<span class="hl_char">?</span></li><li class="hl_l0"><span style="word-break: break-all">TotalBytes&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ULONG&nbsp;</span><span class="hl_char">?</span></li><li class="hl_l1">DataForCopy&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PVOID&nbsp;<span class="hl_char">?</span></li><li class="hl_l0"><span style="word-break: break-all">LoadBytes&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ULONG&nbsp;</span><span class="hl_char">?</span></li><li class="hl_l1">Space&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PKERNEL_SPACE&nbsp;<span class="hl_char">?</span></li><li class="hl_l0">ROUTINE_DATA&nbsp;<span class="hl_function">ends</span></li><li class="hl_l1">PROUTINE_DATA&nbsp;typedef&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;ROUTINE_DATA</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">ALLOCATOR_SIZE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>equ</b></span>&nbsp;<span class="hl_char">(</span><span class="hl_function"><b>offset</b></span>&nbsp;AllocatorRoutineData&nbsp;<span class="hl_char">-</span>&nbsp;<span class="hl_function"><b>offset</b></span>&nbsp;AllocatorRoutine<span class="hl_char">)</span></li><li class="hl_l0">ALLOCATOR_FULL_SIZE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>equ</b></span>&nbsp;<span class="hl_char">(</span><span class="hl_char">(</span>ALLOCATOR_SIZE&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_function"><b>SizeOf</b></span>&nbsp;ROUTINE_DATA<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">3</span><span class="hl_char">)</span>&nbsp;<span class="hl_function"><b>And</b></span>&nbsp;<span class="hl_function">not</span><span class="hl_char">(</span><span class="hl_number">3</span><span class="hl_char">)</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">AllocatorRoutine&nbsp;<span class="hl_function"><b>proc</b></span>&nbsp;C</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enter_km</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_GetDeltaOffsetHid_</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lea</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span><span class="hl_char">[</span><span class="hl_registr"><b>ebx</b></span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_function"><b>offset</b></span>&nbsp;AllocatorRoutineData<span class="hl_char">]</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>assume</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">:</span>PROUTINE_DATA</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">ebx</span><span class="hl_char">]</span><span class="hl_char">.</span>TotalBytes</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;NonPagedPool</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>Call</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">ebx</span><span class="hl_char">]</span><span class="hl_char">.</span>pExAllocatePool</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">!</span><span class="hl_registr">Eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>STATUS_INTERNAL_ERROR</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jmp</b></span>&nbsp;exit_</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">endif</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">esi</span><span class="hl_char">,</span><span class="hl_char">[</span><span class="hl_registr">ebx</span><span class="hl_char">]</span><span class="hl_char">.</span>DataForCopy</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span><span class="hl_char">[</span><span class="hl_registr">ebx</span><span class="hl_char">]</span><span class="hl_char">.</span>LoadBytes</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_registr"><b>Esi</b></span>&nbsp;<span class="hl_char">&amp;</span><span class="hl_char">&amp;</span>&nbsp;<span class="hl_registr">Ecx</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">cld</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>rep</b></span>&nbsp;<span class="hl_function">movsb</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">endif</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span><span class="hl_char">[</span><span class="hl_registr">ebx</span><span class="hl_char">]</span><span class="hl_char">.</span>TotalBytes</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span><span class="hl_char">[</span><span class="hl_registr">ebx</span><span class="hl_char">]</span><span class="hl_char">.</span>Space</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>assume</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">:</span>PKERNEL_SPACE</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">ebx</span><span class="hl_char">]</span><span class="hl_char">.</span>VirtualAddress</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">ebx</span><span class="hl_char">]</span><span class="hl_char">.</span>SizeOfSpace<span class="hl_char">,</span><span class="hl_registr">edx</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>xor</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l0">exit_<span class="hl_char">:</span>&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit_km</li><li class="hl_l0">AllocatorRoutine&nbsp;<span class="hl_function">endp</span></li><li class="hl_l1">AllocatorRoutineData&nbsp;ROUTINE_DATA&nbsp;<span class="hl_char">&lt;</span><span class="hl_char">&gt;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">NtAllocateSpaceAndLoadData&nbsp;<span class="hl_function"><b>proc</b></span>&nbsp;<span class="hl_function"><b>uses</b></span>&nbsp;<span class="hl_registr"><b>ebx</b></span>&nbsp;<span class="hl_registr"><b>esi</b></span>&nbsp;<span class="hl_registr"><b>edi</b></span>&nbsp;SectionHandle<span class="hl_char">:</span>HANDLE<span class="hl_char">,</span>&nbsp;NtosMapInformation<span class="hl_char">:</span>PFILE_MAP_INFORMATION<span class="hl_char">,</span>&nbsp;Selector<span class="hl_char">:</span>ULONG<span class="hl_char">,</span>&nbsp;TotalBytes<span class="hl_char">:</span>ULONG<span class="hl_char">,</span>&nbsp;DataForCopy<span class="hl_char">:</span>PVOID<span class="hl_char">,</span>&nbsp;LoadBytes<span class="hl_char">:</span>ULONG<span class="hl_char">,</span>&nbsp;Space<span class="hl_char">:</span>PKERNEL_SPACE</li><li class="hl_l0"><span class="hl_function"><b>Local</b></span>&nbsp;LoadedInformation<span class="hl_char">:</span>FILE_MAP_INFORMATION<span class="hl_char">,</span>&nbsp;NtosLoadedBase<span class="hl_char">:</span>PVOID</li><li class="hl_l1"><span class="hl_function"><b>Local</b></span>&nbsp;Gate<span class="hl_char">:</span>CALL_GATE</li><li class="hl_l0"><span class="hl_function"><b>Local</b></span>&nbsp;Buffer<span class="hl_char">[</span>ALLOCATOR_FULL_SIZE<span class="hl_char">]</span><span class="hl_char">:</span><span class="hl_function">BYTE</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_setseh_</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span>NtosMapInformation</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>assume</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">:</span>PFILE_MAP_INFORMATION</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span>LoadBytes</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>STATUS_INVALID_PARAMETER_4</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>test</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span><span class="hl_registr">edx</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">esi</span><span class="hl_char">,</span>DataForCopy</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span>LoadBytes</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jz</b></span>&nbsp;exit_</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">cld</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_registr"><b>Esi</b></span>&nbsp;<span class="hl_char">&amp;</span><span class="hl_char">&amp;</span>&nbsp;<span class="hl_registr">Ecx</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;TotalBytes<span class="hl_char">&lt;</span><span class="hl_registr">Edx</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>STATUS_BUFFER_TOO_SMALL</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jmp</b></span>&nbsp;exit_</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">endif</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>rep</b></span>&nbsp;<span class="hl_function"><b>lodsb</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;Test read</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">endif</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lea</b></span>&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span>Buffer</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span>ALLOCATOR_SIZE</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lea</b></span>&nbsp;<span class="hl_registr">esi</span><span class="hl_char">,</span>AllocatorRoutine</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">cld</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lea</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span>NtosLoadedBase</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>rep</b></span>&nbsp;<span class="hl_function">movsb</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>TotalBytes</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>assume</b></span>&nbsp;<span class="hl_registr">edi</span><span class="hl_char">:</span>PROUTINE_DATA</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">edx</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">edi</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_function"><b>offset</b></span>&nbsp;FunctionNameList</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">ebx</span><span class="hl_char">]</span><span class="hl_char">.</span>ImageBase</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">edi</span><span class="hl_char">]</span><span class="hl_char">.</span>TotalBytes<span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>Call</b></span>&nbsp;NtosQueryProcedureAddress</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>test</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">esi</span><span class="hl_char">,</span>Space</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>assume</b></span>&nbsp;<span class="hl_registr">esi</span><span class="hl_char">:</span>PKERNEL_SPACE</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jnz</b></span>&nbsp;exit_</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span>DataForCopy</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span>LoadBytes</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">edi</span><span class="hl_char">]</span><span class="hl_char">.</span>Space<span class="hl_char">,</span><span class="hl_registr">esi</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">esi</span><span class="hl_char">]</span><span class="hl_char">.</span>VirtualAddress<span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">esi</span><span class="hl_char">]</span><span class="hl_char">.</span>SizeOfSpace<span class="hl_char">,</span><span class="hl_registr"><b>eax</b></span>&nbsp;<span class="hl_comment">;Test write</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">edi</span><span class="hl_char">]</span><span class="hl_char">.</span>DataForCopy<span class="hl_char">,</span><span class="hl_registr">edx</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">edi</span><span class="hl_char">]</span><span class="hl_char">.</span>LoadBytes<span class="hl_char">,</span><span class="hl_registr">ecx</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;NtExecuteCodeInKernelMode<span class="hl_char">,</span>&nbsp;SectionHandle<span class="hl_char">,</span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span>&nbsp;Selector<span class="hl_char">,</span>&nbsp;NtosLoadedBase<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;Buffer<span class="hl_char">,</span>&nbsp;ALLOCATOR_FULL_SIZE<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;NtosLoadedBase</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">!</span><span class="hl_registr">Eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>NtosLoadedBase</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">endif</span></li><li class="hl_l1">exit_<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_endseh_</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">ret</span></li><li class="hl_l0">FunctionNameList<span class="hl_char">:</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>CHAR</b></span>&nbsp;<span class="hl_quote">&quot;ExAllocatePool&quot;</span><span class="hl_char">,</span><span class="hl_number">0</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>CHAR</b></span>&nbsp;<span class="hl_number">0</span></li><li class="hl_l1">NtAllocateSpaceAndLoadData&nbsp;<span class="hl_function">endp</span></li>        </ol>
    </div>
</div></div>
<br>Хм, занятный кодес последний <img src="img/smilies/s1.gif" alt=""><br><br>&gt; Требуется: реализовать православный перехват Инде, объяснить ТС решение. <br><br>ТС нужен универсальный, сие не реализуемо, ибо решение зависит от кода. Кстате вы говорили про не православные патчи в моей реализации, а не про кошерные решения. У меня небыло задач, где я не знал вызываемых апи заранее <img src="img/smilies/s6.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=295899&amp;user=29629&amp;forum_n=6&amp;topic=19274&amp;page=1&amp;anchor=10" class="addthx" data-post="295899"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]ClockMan[/b]','')">ClockMan</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/17432.jpg" alt=""><br><span class=txtSm>Ранг: 568.2 (<b>!</b>), 465thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.99'>Активность: 0.55<span style='color:green'>&nearr;</span>0.57</span><br>Статус: <a href="action=userinfo&amp;user=17432">Участник</a><br><font color=blue>оптимист</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 ноября 2011 13:15 <br><script type="text/javascript">QU('ClockMan','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ClockMan" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19274&amp;page=1#11');return false;">#11</a> </span><div align=left><br>
<b>bowrouco</b><br>Нефига ты коды постишь раз в 3 сек,ты чё батарейки на прямую к мозгу подключил?<img src="img/smilies/s1.gif" alt=""> <img src="img/smilies/s6.gif" alt=""> <img src="img/smilies/s6.gif" alt="">
<br><br><font size="1"><i>-----<br>Чтобы правильно задать вопрос, нужно знать большую часть  ответа. Р.Шекли.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=295901&amp;user=17432&amp;forum_n=6&amp;topic=19274&amp;page=1&amp;anchor=11" class="addthx" data-post="295901"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]bowrouco[/b]','')">bowrouco</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 47.7 (посетитель), 17thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.01'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29629">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 ноября 2011 13:19 <br><script type="text/javascript">QU('bowrouco','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=bowrouco" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19274&amp;page=1#12');return false;">#12</a> </span><div align=left><br>
<b>ClockMan</b><br><br>Выбрал по теме и запостил, есчо нашёл и опять запостил. Чтоб вы не ждали.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=295903&amp;user=29629&amp;forum_n=6&amp;topic=19274&amp;page=1&amp;anchor=12" class="addthx" data-post="295903"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]Alchemistry[/b]','')">Alchemistry</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 145.8 (ветеран), 191thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.05'>Активность: 0.14<span style='color:green'>&nearr;</span>0.36</span><br>Статус: <a href="action=userinfo&amp;user=21411">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 ноября 2011 13:37 <br><script type="text/javascript">QU('Alchemistry','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Alchemistry" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19274&amp;page=1#13');return false;">#13</a> </span><div align=left><br>
<b>bowrouco</b><br><br><I>ТС нужен универсальный, сие не реализуемо, ибо решение зависит от кода. Кстате вы говорили про не православные патчи в моей реализации, а не про кошерные решения. У меня небыло задач, где я не знал вызываемых апи заранее</I><br><br>Вот ты и сам признал негодность своего двига. Тебе чтобы перенаправить управление на свой обработчик нужно выполнить куеву тучу телодвижений. И так для каждой функции как я понимаю. Универсальности нет как таковой вообще. То есть негодно, выражаясь твоим языком.<br><br>Идем дальше. Смотрю я твой двиг (один из вариантов) и вижу море x86 хардкода, не портируемого. А следовательно негодно.<br><br>Ок, пошли дальше - собственно пейлоад двига, ну типа для чего ты его запилил. Двиг позиционируется как илитный кодес для скрытия от всяких аверских детекторов патчей и замена &quot;негодного&quot; патча (обсуждали раньше - кому интересно двигайте в соседний топ &quot;и снова патчи&quot;). <br><br>Тут остановимся. <br><br>Покажи мне авера, который орет на какие-то там перехваты и на основании этого выдает вердикт - малварь. Что касается разнообразного треша типа твоего любимого гмера - как правило до таких вещей доходит уже тогда когда юзер знает, что у него малварь. То бишь малвари так и так уже не жить - комп отрубается от инета - пейлоада от ботов нету, TTL бота стремительно приближается к нулю. А в энтерпрайз таким хукалкам ход заказан по объективным причинам, ибо там нужна стабильность и куча других вещей не свойственных твоим кодесам.<br><br>Итоги:<br><br>Непортируемый, не универсальный движок, документации внятной нет, статей (даже на васме) по нему нет, цели движка непонятны. Огромное количество хардкода для выполнения банальных операций. <br><br>С другой стороны имеем &quot;не тру&quot; патч с трамплином, поддерживаемый на 100% мс и лишенный всех недостатков &quot;тру патча Инде&quot;. <br><br>Библа их называется Detours. Помимо нее существует туча других движков (некоторые кросс-платформ даже!), между прочим куда надежнее в плане стабильности, чем то что описывается в линках, что накидал PE_Kill во втором посте.<br><br>Ну и че в итоге? А в итоге, православный патч от Инде то негодный оказывается. Потому и никто до сих пор не заюзал. Как и большинство из того что у тебя в log.txt (да я его читаю иногда<img src="img/smilies/s1.gif" alt="">)<br><br>p.s.<br><br>А между прочим ТС выдал список API для перехвата, для тренировки как сам написал.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=295904&amp;user=21411&amp;forum_n=6&amp;topic=19274&amp;page=1&amp;anchor=13" class="addthx" data-post="295904"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]bowrouco[/b]','')">bowrouco</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 47.7 (посетитель), 17thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.01'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29629">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 ноября 2011 13:56 &middot; Поправил: bowrouco <br><script type="text/javascript">QU('bowrouco','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=bowrouco" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19274&amp;page=1#14');return false;">#14</a> </span><div align=left><br>
<b>Alchemistry</b><br>&gt; Вот ты и сам признал негодность своего двига.<br><br>Я признаю что это не годно для вас и ваших дадач. Мне не нужно универсальное. Вы хотите функу Patch(ModuleName&#036;, EntryName&#036;). Чтобы можно было юзать это не зная даже что делает EntryName&#036; и как реализована. Когда я чтото реализую то чётко знаю все функи&lt; которые мне нужно отслеживать. Вы это считаете не годным, пусть будет так. Проблема в том, что для использования тогоже IDP нужно знать реализацию кода, который будет отслеживаться. Есть средства автоматизации, но также не универсальные. Вдобавок IDP причём тут совершенно не понятно, в том семпле это только как один из множества способов получить управление внутри апи, это опорное место для дальнейшей маршрутизации.<br><br>&gt; Смотрю я твой двиг (один из вариантов) и вижу море x86 хардкода, не портируемого. А следовательно негодно.<br><br>Там нет вообще хардкода(хотя кто знает что вы под этим понимаете). Если бы вы посмотрели сурс, то нашли бы там в хидере &quot;MI&quot; - это именно и значит что хардкода нет, нет привязки расстоянию между инструкциями, нет статических данных.<br>Портабельность - это нельзя портировать на x64, там нет LDT. Но замена сегментов не единственное решение, можно использовать дизасм, но так как это тяжёлый код и я не юзаю x64, то мне достаточно текущего движка.<br><br>&gt; GetVersion<br>Это нет смысла даже патчить, версия и её копия лежат в PEB.<br><br>&gt; GetDriveType &amp; GetVolInfo<br>Они наверно использует ProcessDeviceMap и NTRTL для манипуляции путями, например юзают хип. Есть стопяцот способов это отслеживать.<br><br>Но вы главную мысль потеряли как обычно - отложенная передача управления позволяет контролировать апи до и после вызова имеющейся.<br><br>Так бы решал я. Вам же сие не годно, ибо не универсально.<br><br>Но самое главное касается непосредственно этой темы - какие движки левые, если хотпатч это системный механизм, для этого и имеется почти во всех процедурах префикс. Кстати провайдер верификации позволяет сделать это вообще без исполнения кода - задаётся список имён апи и модулей и из дллмейн отдаётся нэйтиву, а там верификатор сам всё запатчит <img src="img/smilies/s2.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=295908&amp;user=29629&amp;forum_n=6&amp;topic=19274&amp;page=1&amp;anchor=14" class="addthx" data-post="295908"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]PE_Kill[/b]','')">PE_Kill</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3232.gif" alt=""><br><span class=txtSm>Ранг: 793.4 <font color=magenta>(<b>! !</b>)</font>, 568thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.59'>Активность: 0.74<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3232">Участник</a><br><font color=blue>Шаман</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 ноября 2011 14:33 <br><script type="text/javascript">QU('PE_Kill','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=PE_Kill" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19274&amp;page=1#15');return false;">#15</a> </span><div align=left><br>
<b>bowrouco</b> епта, какого хрена ты всё на свои задачи переводишь? Этот топик создавал не ты, раз отписался, помоги ТС решить его проблему, закодь функционал. Не можешь - иди на*й с этого топика и с этого форума, твои илитные сорсы ни кому не уперлись.
<br><br><font size="1"><i>-----<br>Yann Tiersen best and do not fuck</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=295911&amp;user=3232&amp;forum_n=6&amp;topic=19274&amp;page=1&amp;anchor=15" class="addthx" data-post="295911"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=29820" title="19-11-2011 10:38, ранг:2.0" target="_blank">SegFault</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]bowrouco[/b]','')">bowrouco</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 47.7 (посетитель), 17thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.01'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29629">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 ноября 2011 14:37 <br><script type="text/javascript">QU('bowrouco','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=bowrouco" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19274&amp;page=1#16');return false;">#16</a> </span><div align=left><br>
<b>PE_Kill</b><br><br>Это вы переводите мои решения на свои задачи. У нас с вами разные цели и разные методы. Я ответил изначально совсем не вам, вы начали задавать вопросы и теперь куда то посылаете. А ТС тоже может получить полезное из этого обсуждения - я написал про хотпатч и верификатор, дело за малым - изучить как оно робит и заюзать.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=295912&amp;user=29629&amp;forum_n=6&amp;topic=19274&amp;page=1&amp;anchor=16" class="addthx" data-post="295912"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]SegFault[/b]','')">SegFault</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 44.8 (посетитель), 19thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 8.95'>Активность: 0.04<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29820">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 ноября 2011 14:43 <br><script type="text/javascript">QU('SegFault','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=SegFault" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19274&amp;page=1#17');return false;">#17</a> </span><div align=left><br>
<I>bowrouco пишет:<br>Кстати давным давно, когда я был таким наивным и нубом </I><br>C тех пор ничего не изменилось.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=295913&amp;user=29820&amp;forum_n=6&amp;topic=19274&amp;page=1&amp;anchor=17" class="addthx" data-post="295913"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]Alchemistry[/b]','')">Alchemistry</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 145.8 (ветеран), 191thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.05'>Активность: 0.14<span style='color:green'>&nearr;</span>0.36</span><br>Статус: <a href="action=userinfo&amp;user=21411">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 ноября 2011 14:52 <br><script type="text/javascript">QU('Alchemistry','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Alchemistry" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19274&amp;page=1#18');return false;">#18</a> </span><div align=left><br>
<b>bowrouco</b><br><br>Стоп приехали. Ты под верификатором понимаешь AVrf/RTL_VERIFIER?<br><br>Ну ты даешь, Инде. ТС нужно простое решение, а ты предлагаешь значит пилить в реестр Image Executions Options параметры загрузки длл-ки, потом пилить собственно калбек и все это дело на нативе лишь для того чтобы менеджер тебе запилил IAT на интересующие тебя API.<br><br>Тебе самому не кажется, что твоя идея реализация сложнее чем поставленная задача на несколько порядков? <img src="img/smilies/s1.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=295915&amp;user=21411&amp;forum_n=6&amp;topic=19274&amp;page=1&amp;anchor=18" class="addthx" data-post="295915"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]bowrouco[/b]','')">bowrouco</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 47.7 (посетитель), 17thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.01'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29629">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 ноября 2011 14:57 <br><script type="text/javascript">QU('bowrouco','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=bowrouco" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19274&amp;page=1#19');return false;">#19</a> </span><div align=left><br>
<b>Alchemistry</b><br><br>Да, AVRF. Опции в конфиг писать не обязательно, можно в обход этого заюзать. Сам пользовательский провайдер предельно прост. Я не предлагаю сложное, как например я грузил провайдер из ресурсов(длл), разбирал апи его инициализации, в зависимости от версии и дёргал вручную. Это сложно. А просто длл запилить куда уж проще.<br><br>Не нравится провайдер - хотпатч есть.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=295917&amp;user=29629&amp;forum_n=6&amp;topic=19274&amp;page=1&amp;anchor=19" class="addthx" data-post="295917"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="20" onfocus="this.blur()" href="JavaScript:di('[b]PE_Kill[/b]','')">PE_Kill</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3232.gif" alt=""><br><span class=txtSm>Ранг: 793.4 <font color=magenta>(<b>! !</b>)</font>, 568thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.59'>Активность: 0.74<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3232">Участник</a><br><font color=blue>Шаман</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 ноября 2011 15:02 <br><script type="text/javascript">QU('PE_Kill','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=PE_Kill" target="_blank">Личное сообщение</a> &middot;  <a href="#20" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19274&amp;page=1#20');return false;">#20</a> </span><div align=left><br>
<I>bowrouco пишет:<br>Не нравится провайдер - хотпатч есть.  </I><br>Так хотпатч же не илитно, и кто его юзает - гавно. Тебя не понять.<br><br><I>bowrouco пишет:<br> У нас с вами разные цели и разные методы. </I><br>Так есть проблема в шапке, реши. Не можешь, какого хера тут делаешь тогда?
<br><br><font size="1"><i>-----<br>Yann Tiersen best and do not fuck</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=295918&amp;user=3232&amp;forum_n=6&amp;topic=19274&amp;page=1&amp;anchor=20" class="addthx" data-post="295918"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="21" onfocus="this.blur()" href="JavaScript:di('[b]Alchemistry[/b]','')">Alchemistry</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 145.8 (ветеран), 191thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.05'>Активность: 0.14<span style='color:green'>&nearr;</span>0.36</span><br>Статус: <a href="action=userinfo&amp;user=21411">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 ноября 2011 15:06 &middot; Поправил: Alchemistry <br><script type="text/javascript">QU('Alchemistry','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Alchemistry" target="_blank">Личное сообщение</a> &middot;  <a href="#21" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19274&amp;page=1#21');return false;">#21</a> </span><div align=left><br>
<I>bowrouco пишет:<br>Не нравится провайдер - хотпатч есть </I><br><br>Оно самое вообще-то ТС и предлагается, если конечно под хотпатчем понимается решение МС, а не какой-нибудь твой термин.<br><br>А насчет верифера - у него специфическое применение как средства диагностики системы самой же системой. Зачем его использовать ТС? Мало того что андок (андок в нормальных приложениях должен отсутствовать нафиг вообще), так еще с тем же успехом, но гораздо проще можно реализовать тот же баянистый IAT, на который дофига примеров в гугле.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=295919&amp;user=21411&amp;forum_n=6&amp;topic=19274&amp;page=1&amp;anchor=21" class="addthx" data-post="295919"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="22" onfocus="this.blur()" href="JavaScript:di('[b]bowrouco[/b]','')">bowrouco</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 47.7 (посетитель), 17thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.01'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29629">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 ноября 2011 15:15 &middot; Поправил: bowrouco <br><script type="text/javascript">QU('bowrouco','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=bowrouco" target="_blank">Личное сообщение</a> &middot;  <a href="#22" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19274&amp;page=1#22');return false;">#22</a> </span><div align=left><br>
<b>PE_Kill</b><br><br>&gt; Так есть проблема в шапке, реши. Не можешь, какого хера тут делаешь тогда?<br><br>Я решил. И привёл код.<br><br>&gt; Так хотпатч же не илитно, и кто его юзает - гавно. Тебя не понять.<br><br>ТС нужен именно патч как сказали. Это его задача и без разницы элитно или нет.<br><br>Какой же ты толстый троль. Хотя вероятно совсем с головой не дружишь, это бы обьяснило то что ты говоришь, либо имеешь ко мне какуюто не нависть, изза этого и так толсто тролишь. Хотя иначе было бы скучно, лучше так.<br><br><b>Alchemistry</b><br><br>&gt; Оно самое вообще-то ТС и предлагается, если конечно под хотпатчем понимается решение МС, а не какой-нибудь твой термин.<br><br>То самое, что реализуется самой осью. Имеется для этого интерфейс - LdrHotPatchRoutine().
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=295921&amp;user=29629&amp;forum_n=6&amp;topic=19274&amp;page=1&amp;anchor=22" class="addthx" data-post="295921"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="23" onfocus="this.blur()" href="JavaScript:di('[b]PE_Kill[/b]','')">PE_Kill</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3232.gif" alt=""><br><span class=txtSm>Ранг: 793.4 <font color=magenta>(<b>! !</b>)</font>, 568thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.59'>Активность: 0.74<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3232">Участник</a><br><font color=blue>Шаман</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 ноября 2011 15:23 <br><script type="text/javascript">QU('PE_Kill','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=PE_Kill" target="_blank">Личное сообщение</a> &middot;  <a href="#23" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19274&amp;page=1#23');return false;">#23</a> </span><div align=left><br>
Клерк, не соскакивай с темы, дай номер колбека, может таr ты не проигноришь: http://exelab.ru/f/action=vthread&amp;forum=7&amp;topic=18520&amp;page=3#9
<br><br><font size="1"><i>-----<br>Yann Tiersen best and do not fuck</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=295922&amp;user=3232&amp;forum_n=6&amp;topic=19274&amp;page=1&amp;anchor=23" class="addthx" data-post="295922"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="24" onfocus="this.blur()" href="JavaScript:di('[b]Alchemistry[/b]','')">Alchemistry</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 145.8 (ветеран), 191thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.05'>Активность: 0.14<span style='color:green'>&nearr;</span>0.36</span><br>Статус: <a href="action=userinfo&amp;user=21411">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 ноября 2011 15:26 <br><script type="text/javascript">QU('Alchemistry','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Alchemistry" target="_blank">Личное сообщение</a> &middot;  <a href="#24" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19274&amp;page=1#24');return false;">#24</a> </span><div align=left><br>
<b>bowrouco</b><br><br>Она андок и хер пойми что у нее с легаси и как она в портах, если вообще есть. Не заявляю, что ее нельзя юзать, но в обычной программе, еще раз говорю, андок приемов не должно быть. Подсаживать нуба с первых же шагов на андок это в корне неверный шаг. Тот же патч можно реализовать своими руками или использовать готовые двиги, коих дофига и больше.<br><br>В общем я давно заметил, что Инди всегда предлагает рвать гланды через <img src="img/smilies/s16.gif" alt=""> вне зависимости от задачи. Будь проще епт.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=295923&amp;user=21411&amp;forum_n=6&amp;topic=19274&amp;page=1&amp;anchor=24" class="addthx" data-post="295923"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="25" onfocus="this.blur()" href="JavaScript:di('[b]bowrouco[/b]','')">bowrouco</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 47.7 (посетитель), 17thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.01'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29629">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 ноября 2011 15:59 <br><script type="text/javascript">QU('bowrouco','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=bowrouco" target="_blank">Личное сообщение</a> &middot;  <a href="#25" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19274&amp;page=1#25');return false;">#25</a> </span><div align=left><br>
<b>PE_Kill</b><br><br>Если вы всё про колбеки, то в конце эмуляции дёргается нулевой. И в процессе обработки иногда тоже. CB_DumpCPUContext - видимо вы авер, раз гдето нашли эти константы, хотя не удивительно, я давно подозревал.<br><br><b>Alchemistry</b><br><br>Какая разница что андок, главное чтоб во всей линейке работала. Хотя я не смотрел как там у неё с совметсимостью, ибо для меня этот функционал интереса не представляет. В любом случае код NT закрыт и всякая попытка его потыкать это андок, мс не приводило бинарный код тойже GetVersion().. Вот теперь и я уже как троль <img src="img/smilies/s6.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=295927&amp;user=29629&amp;forum_n=6&amp;topic=19274&amp;page=1&amp;anchor=25" class="addthx" data-post="295927"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="26" onfocus="this.blur()" href="JavaScript:di('[b]Alchemistry[/b]','')">Alchemistry</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 145.8 (ветеран), 191thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.05'>Активность: 0.14<span style='color:green'>&nearr;</span>0.36</span><br>Статус: <a href="action=userinfo&amp;user=21411">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 ноября 2011 16:12 <br><script type="text/javascript">QU('Alchemistry','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Alchemistry" target="_blank">Личное сообщение</a> &middot;  <a href="#26" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19274&amp;page=1#26');return false;">#26</a> </span><div align=left><br>
<b>bowrouco</b><br><br>hotpatching появился начиная Win2003 SP1, вместе с какой-то версией компилера, не помню точно.<br><br><I> В любом случае код NT закрыт и всякая попытка его потыкать это андок</I><br><br>Ложь, п..оно самое и провокация.<br><br>МС сделала такую замечательную штуку как &quot;документация&quot;. Причем она как правило исчерпывающая по всем необходимым программистам вещам. Плюс Microsoft Press, целое издательство, где печатаются такие авторы как Рихтер, которого ты окрестил ламером и Руссинович.<br><br>Документация и поддержка - то чего у твоих поделий отсутствует в принципе, текстовый документ на народе не вариант.<br><br>MSDN<br><br>+<br><br>http://www.microsoft.com/resources/sharedsource/windowsacademic/researchkernelkit.mspx<br><br>+ <br><br>WinDBG<br><br>+<br><br>политика по отношению к символам.<br><br>+<br><br>еще и еще<br><br><br>Да Инде ты тролль, я знаю.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=295930&amp;user=21411&amp;forum_n=6&amp;topic=19274&amp;page=1&amp;anchor=26" class="addthx" data-post="295930"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="27" onfocus="this.blur()" href="JavaScript:di('[b]bowrouco[/b]','')">bowrouco</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 47.7 (посетитель), 17thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.01'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29629">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 ноября 2011 16:17 &middot; Поправил: bowrouco <br><script type="text/javascript">QU('bowrouco','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=bowrouco" target="_blank">Личное сообщение</a> &middot;  <a href="#27" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19274&amp;page=1#27');return false;">#27</a> </span><div align=left><br>
<b>Alchemistry</b><br><br>WRK это код ядра. Там нету винапи. А пижженый код, когда то утёкший - его балмер не одобряет. С таким же успехом я могу утверждать что всё чего нет в легальной документации, но есть в тех утёкших сурсах легально и документировано. Хотя последнее я и раньше утверждал.<br><br>А с символами + дебуггер + есчо любой нужный инструмент всё становится документированным. Теперь вы понимаете что я должен понимать когда вы мне про документированность говорите.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=295932&amp;user=29629&amp;forum_n=6&amp;topic=19274&amp;page=1&amp;anchor=27" class="addthx" data-post="295932"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="28" onfocus="this.blur()" href="JavaScript:di('[b]Alchemistry[/b]','')">Alchemistry</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 145.8 (ветеран), 191thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.05'>Активность: 0.14<span style='color:green'>&nearr;</span>0.36</span><br>Статус: <a href="action=userinfo&amp;user=21411">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 ноября 2011 16:23 &middot; Поправил: Alchemistry <br><script type="text/javascript">QU('Alchemistry','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Alchemistry" target="_blank">Личное сообщение</a> &middot;  <a href="#28" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19274&amp;page=1#28');return false;">#28</a> </span><div align=left><br>
<b>bowrouco</b><br><br>Ты слышал звон, да не понял где он. Все эти инструменты идут в довесок к легальной документации, а не взамен ее. А что думает Балмер мне по три буквы, мне важно что думают клиенты моего софта. Нет андока - нет проблем с портом, со следующими версиями винды и т.д.<br><br>А ты хочешь сказать я не могу перехватить GetVersion не зная как она реализована внутрене что-ли? Что за бред? <img src="img/smilies/s1.gif" alt=""> Как раз твое илитное двигло тут навернется медным тазом, а вот старые как мир и стабильные методы сработают на ура.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=295933&amp;user=21411&amp;forum_n=6&amp;topic=19274&amp;page=1&amp;anchor=28" class="addthx" data-post="295933"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="29" onfocus="this.blur()" href="JavaScript:di('[b]bowrouco[/b]','')">bowrouco</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 47.7 (посетитель), 17thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.01'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29629">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 ноября 2011 16:26 <br><script type="text/javascript">QU('bowrouco','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=bowrouco" target="_blank">Личное сообщение</a> &middot;  <a href="#29" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19274&amp;page=1#29');return false;">#29</a> </span><div align=left><br>
<b>Alchemistry</b><br><br>Я хочу сказать что андок понятие слишком расплывчатое. Вы привели пример инструментов ресерча, которые делают всё документированным. Реализация GetVersion() не описана, её можно получить ресерчем. Также и эту ExApplyCodePatch() и LdrHP.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=295934&amp;user=29629&amp;forum_n=6&amp;topic=19274&amp;page=1&amp;anchor=29" class="addthx" data-post="295934"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="30" onfocus="this.blur()" href="JavaScript:di('[b]Alchemistry[/b]','')">Alchemistry</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 145.8 (ветеран), 191thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.05'>Активность: 0.14<span style='color:green'>&nearr;</span>0.36</span><br>Статус: <a href="action=userinfo&amp;user=21411">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 ноября 2011 16:31 &middot; Поправил: Alchemistry <br><script type="text/javascript">QU('Alchemistry','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Alchemistry" target="_blank">Личное сообщение</a> &middot;  <a href="#30" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19274&amp;page=1#30');return false;">#30</a> </span><div align=left><br>
<b>bowrouco</b><br><br>А нафига мне знать реализацию функции для ее перехвата??? Ты вообще слышал о таком понятии как абстракция? Инкапсуляция, не? Для перехвата мне нужно знать только ее общее поведение - что она делает и ее интерфейс, то бишь прототип. Все. Для твоего двига же нужно чуть ли не побайтово знать потроха.<br><br>Undocumented function - функция не описанная в оф. документации. Ничего расплывчатого тут нет. Не придумывай.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=295937&amp;user=21411&amp;forum_n=6&amp;topic=19274&amp;page=1&amp;anchor=30" class="addthx" data-post="295937"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="31" onfocus="this.blur()" href="JavaScript:di('[b]ClockMan[/b]','')">ClockMan</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/17432.jpg" alt=""><br><span class=txtSm>Ранг: 568.2 (<b>!</b>), 465thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.99'>Активность: 0.55<span style='color:green'>&nearr;</span>0.57</span><br>Статус: <a href="action=userinfo&amp;user=17432">Участник</a><br><font color=blue>оптимист</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 ноября 2011 16:35 <br><script type="text/javascript">QU('ClockMan','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ClockMan" target="_blank">Личное сообщение</a> &middot;  <a href="#31" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19274&amp;page=1#31');return false;">#31</a> </span><div align=left><br>
Перешлибы уже в личку <img src="img/smilies/s1.gif" alt="">
<br><br><font size="1"><i>-----<br>Чтобы правильно задать вопрос, нужно знать большую часть  ответа. Р.Шекли.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=295938&amp;user=17432&amp;forum_n=6&amp;topic=19274&amp;page=1&amp;anchor=31" class="addthx" data-post="295938"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> <a href="action=vthread&amp;forum=6&amp;topic=19274&amp;page=0.html">&lt;&lt;</a> .  <a href="action=vthread&amp;forum=6&amp;topic=19274&amp;page=0.html">1</a> . <b>2</b> . <a href="action=vthread&amp;forum=6&amp;topic=19274&amp;page=2.html">3</a> . <a href="action=vthread&amp;forum=6&amp;topic=19274&amp;page=2.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Подскажите новичку по перехвату Api функций</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#32" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="6">
<input type="hidden" name="topic" value="19274">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=19274" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
