<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Не работает inject dll (исходник прилагается) - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Здравствуйте. Пытаюсь реализовать загрузку модуля в процесс &quot;Блокнот&quot; по исходникам MS-REM. Я переделал модули под Embarcadero Delphi XE2 ,всё запускается но инжекта не происходит. Работает только внедрение кода">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=31361'>zds</a>, <a target='_blank' href='?action=userinfo&amp;user=1288'>UniSoft</a> (+6 невидимых)</b></span>
</td>
</tr>
</table>

 

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Не работает inject dll (исходник прилагается)</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> .  <b>1</b> . <a href="action=vthread&amp;forum=6&amp;topic=20521&amp;page=1.html">2</a> . <a href="action=vthread&amp;forum=6&amp;topic=20521&amp;page=1.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]CodeMaster[/b]','')">CodeMaster</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 9.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.64'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33320">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 ноября 2012 18:11 <br><script type="text/javascript">QU('CodeMaster','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=CodeMaster" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=20521&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Здравствуйте. Пытаюсь реализовать загрузку модуля в процесс &quot;Блокнот&quot; по исходникам MS-REM.<br>Я переделал модули под Embarcadero Delphi XE2 ,всё запускается но инжекта не происходит.<br>Работает только внедрение кода напрямую через @Main.<br>Исходники и откомпилированные файлы:<br>rghost.ru/41672556
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=314498&amp;user=33320&amp;forum_n=6&amp;topic=20521&amp;page=0&amp;anchor=1" class="addthx" data-post="314498"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]SReg[/b]','')">SReg</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 315.1 (мудрец), 631thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.78'>Активность: 0.3<span style='color:green'>&nearr;</span>0.33</span><br>Статус: <a href="action=userinfo&amp;user=18316">Модератор</a><br><font color=blue>CrackLab</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 ноября 2012 19:44 <br><script type="text/javascript">QU('SReg','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=SReg" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=20521&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
вот, играйся http://rghost.ru/41675128<br>з.ы. выложил херь какую-то...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=314502&amp;user=18316&amp;forum_n=6&amp;topic=20521&amp;page=0&amp;anchor=2" class="addthx" data-post="314502"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]CodeMaster[/b]','')">CodeMaster</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 9.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.64'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33320">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 ноября 2012 20:36 &middot; Поправил: CodeMaster <br><script type="text/javascript">QU('CodeMaster','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=CodeMaster" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=20521&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
Там косяк был что APIAdvancedHook.dll не переименовал в Project11.dll и забыл Unit13.pas выложить.<br>А почему мои файлы не работают даже если имя длл Project11.dll?<br><br>Ещё у меня когда используешь InjectDllEx и InjectDllExAlt вываливается exception. В отладчике выдает что Imagebase=nil поэтому не работает.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=314503&amp;user=33320&amp;forum_n=6&amp;topic=20521&amp;page=0&amp;anchor=3" class="addthx" data-post="314503"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]SReg[/b]','')">SReg</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 315.1 (мудрец), 631thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.78'>Активность: 0.3<span style='color:green'>&nearr;</span>0.33</span><br>Статус: <a href="action=userinfo&amp;user=18316">Модератор</a><br><font color=blue>CrackLab</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 ноября 2012 20:41 &middot; Поправил: SReg <br><script type="text/javascript">QU('SReg','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=SReg" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=20521&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
<b>CodeMaster</b><br>LoadLibraryW потому что нужно было писать в GetProcAddress или же передавать имя как pansichar
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=314504&amp;user=18316&amp;forum_n=6&amp;topic=20521&amp;page=0&amp;anchor=4" class="addthx" data-post="314504"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]CodeMaster[/b]','')">CodeMaster</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 9.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.64'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33320">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 21 ноября 2012 18:03 &middot; Поправил: CodeMaster <br><script type="text/javascript">QU('CodeMaster','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=CodeMaster" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=20521&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
С этим разобрался,работает всё на примере MessageBoxA. Теперь я хочу сохранить в файл протокола на диске названия документов,которые открывает notepad.Но пишется какая-то белиберда:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>library</b></span>&nbsp;Project11<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_function">uses</span></li><li class="hl_l1">&nbsp;&nbsp;System<span class="hl_char">.</span>SysUtils<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;System<span class="hl_char">.</span>Classes<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;Windows<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;Vcl<span class="hl_char">.</span>Dialogs<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;advApiHook&nbsp;<span class="hl_function"><b>in</b></span>&nbsp;<span class="hl_quote">'advApiHook.pas'</span><span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;NativeAPI&nbsp;<span class="hl_function"><b>in</b></span>&nbsp;<span class="hl_quote">'NativeAPI.pas'</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">type</li><li class="hl_l1">OldCode&nbsp;<span class="hl_char">=</span>&nbsp;packed&nbsp;record</li><li class="hl_l0">&nbsp;&nbsp;One<span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>dword</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;two<span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>word</b></span><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;far_jmp&nbsp;<span class="hl_char">=</span>&nbsp;packed&nbsp;record</li><li class="hl_l0">&nbsp;&nbsp;PuhsOp<span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>byte</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;PushArg<span class="hl_char">:</span>&nbsp;pointer<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;RetOp<span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>byte</b></span><span class="hl_comment">;</span></li><li class="hl_l1"><span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">var</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">TrueCreateFileW<span class="hl_char">:</span>&nbsp;function<span class="hl_char">(</span>lpFileName<span class="hl_char">:</span>&nbsp;PWideChar<span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwDesiredAccess</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>DWORD</b></span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwShareMode</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>DWORD</b></span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lpSecurityAttributes</span><span class="hl_char">:</span>&nbsp;PSecurityAttributes<span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwCreationDisposition</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>DWORD</b></span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwFlagsAndAttributes</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>DWORD</b></span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hTemplateFile</span><span class="hl_char">:</span>&nbsp;THandle<span class="hl_char">)</span><span class="hl_char">:</span>&nbsp;THandle<span class="hl_comment">; stdcall;</span></li><li class="hl_l0">JmpCfw<span class="hl_char">,</span>&nbsp;JmpCfa<span class="hl_char">:</span>&nbsp;far_jmp<span class="hl_comment">;</span></li><li class="hl_l1">OldCfw<span class="hl_char">,</span>&nbsp;OldCfa<span class="hl_char">:</span>&nbsp;OldCode<span class="hl_comment">;</span></li><li class="hl_l0">CfwAdr<span class="hl_char">,</span>&nbsp;CfaAdr<span class="hl_char">:</span>&nbsp;pointer<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">function&nbsp;NewCreateFileA<span class="hl_char">(</span>lpFileName<span class="hl_char">:</span>&nbsp;PChar<span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwDesiredAccess</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>DWORD</b></span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwShareMode</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>DWORD</b></span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lpSecurityAttributes</span><span class="hl_char">:</span>&nbsp;PSecurityAttributes<span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwCreationDisposition</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>DWORD</b></span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwFlagsAndAttributes</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>DWORD</b></span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hTemplateFile</span><span class="hl_char">:</span>&nbsp;THandle<span class="hl_char">)</span><span class="hl_char">:</span>&nbsp;THandle<span class="hl_comment">; stdcall;</span></li><li class="hl_l1">var</li><li class="hl_l0">&nbsp;&nbsp;file_name<span class="hl_char">:</span>&nbsp;PWideChar<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;hFile<span class="hl_char">,</span>name_len<span class="hl_char">,</span>zapisano<span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>dword</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;Written<span class="hl_char">:</span>&nbsp;SIZE_T<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;spisok<span class="hl_char">:</span>array&nbsp;<span class="hl_char">[</span><span class="hl_number">0</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_number">255</span><span class="hl_char">]</span>&nbsp;of&nbsp;<span class="hl_function"><b>char</b></span><span class="hl_comment">;</span></li><li class="hl_l0">begin</li><li class="hl_l1">&nbsp;&nbsp;name_len&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;lstrlen<span class="hl_char">(</span>lpFileName<span class="hl_char">)</span>&nbsp;<span class="hl_char">*</span>&nbsp;<span class="hl_function">SizeOf</span><span class="hl_char">(</span>WideChar<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">2</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;GetMem<span class="hl_char">(</span>file_name<span class="hl_char">,</span>&nbsp;name_len<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;StringToWideChar<span class="hl_char">(</span>lpFileName<span class="hl_char">,</span>&nbsp;file_name<span class="hl_char">,</span>&nbsp;name_len<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;UnhookCode<span class="hl_char">(</span>@TrueCreateFileW<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;hFile&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;CreateFile<span class="hl_char">(</span><span class="hl_quote">'C:\protocol.txt'</span><span class="hl_char">,</span>&nbsp;GENERIC_WRITE<span class="hl_char">,</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;nil<span class="hl_char">,</span>&nbsp;OPEN_ALWAYS<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;SetFilePointer<span class="hl_char">(</span>hFile<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;nil<span class="hl_char">,</span>&nbsp;FILE_END<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;WriteFile<span class="hl_char">(</span>hFile<span class="hl_char">,</span>&nbsp;spisok<span class="hl_char">,</span>&nbsp;Length<span class="hl_char">(</span>file_name<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;zapisano<span class="hl_char">,</span>&nbsp;nil<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;WriteProcessMemory<span class="hl_char">(</span>INVALID_HANDLE_VALUE<span class="hl_char">,</span>&nbsp;CfwAdr<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@OldCfw<span class="hl_char">,</span>&nbsp;<span class="hl_function">SizeOf</span><span class="hl_char">(</span>OldCode<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;Written<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;result&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;TrueCreateFileW<span class="hl_char">(</span>file_name<span class="hl_char">,</span>&nbsp;dwDesiredAccess<span class="hl_char">,</span>&nbsp;dwShareMode<span class="hl_char">,</span>&nbsp;lpSecurityAttributes<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwCreationDisposition<span class="hl_char">,</span>&nbsp;dwFlagsAndAttributes<span class="hl_char">,</span>&nbsp;hTemplateFile<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;WriteProcessMemory<span class="hl_char">(</span>INVALID_HANDLE_VALUE<span class="hl_char">,</span>&nbsp;CfwAdr<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@JmpCfw<span class="hl_char">,</span>&nbsp;<span class="hl_function">SizeOf</span><span class="hl_char">(</span>far_jmp<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;Written<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;FreeMem<span class="hl_char">(</span>file_name<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">function&nbsp;NewCreateFileW<span class="hl_char">(</span>lpFileName<span class="hl_char">:</span>&nbsp;PWideChar<span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwDesiredAccess</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>DWORD</b></span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwShareMode</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>DWORD</b></span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lpSecurityAttributes</span><span class="hl_char">:</span>&nbsp;PSecurityAttributes<span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwCreationDisposition</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>DWORD</b></span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwFlagsAndAttributes</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>DWORD</b></span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hTemplateFile</span><span class="hl_char">:</span>&nbsp;THandle<span class="hl_char">)</span><span class="hl_char">:</span>&nbsp;THandle<span class="hl_comment">; stdcall;</span></li><li class="hl_l0">var</li><li class="hl_l1">Written<span class="hl_char">:</span>&nbsp;SIZE_T<span class="hl_comment">;</span></li><li class="hl_l0">begin</li><li class="hl_l1">&nbsp;&nbsp;WriteProcessMemory<span class="hl_char">(</span>INVALID_HANDLE_VALUE<span class="hl_char">,</span>&nbsp;CfwAdr<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@OldCfw<span class="hl_char">,</span>&nbsp;<span class="hl_function">SizeOf</span><span class="hl_char">(</span>OldCode<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;Written<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_char">/</span><span class="hl_char">/</span>здесь&nbsp;мониторим&nbsp;открытие&nbsp;файла</li><li class="hl_l1"><span class="hl_char">/</span><span class="hl_char">/</span>важно<span class="hl_char">:</span>&nbsp;сохраняем&nbsp;код&nbsp;посл<span class="hl_char">.</span>&nbsp;ошибки</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;result&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;CreateFileW<span class="hl_char">(</span>lpFileName<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwDesiredAccess<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwShareMode<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lpSecurityAttributes<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwCreationDisposition<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwFlagsAndAttributes<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hTemplateFile<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;WriteProcessMemory<span class="hl_char">(</span>INVALID_HANDLE_VALUE<span class="hl_char">,</span>&nbsp;CfwAdr<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@JmpCfw<span class="hl_char">,</span>&nbsp;<span class="hl_function">SizeOf</span><span class="hl_char">(</span>far_jmp<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;Written<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;result&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;TrueCreateFileW<span class="hl_char">(</span>lpFileName<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwDesiredAccess<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwShareMode<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lpSecurityAttributes<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwCreationDisposition<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwFlagsAndAttributes<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hTemplateFile<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">UnhookCode<span class="hl_char">(</span>@TrueCreateFileW<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">{<span class="hl_char">$</span>R&nbsp;<span class="hl_char">*</span><span class="hl_char">.</span>res}</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">begin</li><li class="hl_l0">ShowMessage<span class="hl_char">(</span><span class="hl_quote">'Код DLL загружен в тело процесса'</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">HookProc<span class="hl_char">(</span><span class="hl_quote">'kernel32.dll'</span><span class="hl_char">,</span>&nbsp;<span class="hl_quote">'CreateFileW'</span><span class="hl_char">,</span>&nbsp;@NewCreateFileA<span class="hl_char">,</span>@TrueCreateFileW<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_function">end</span><span class="hl_char">.</span></li>        </ol>
    </div>
</div></div>
<br><br>То ли функция не перехватывается,то ли неправильно записывает данные.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=314566&amp;user=33320&amp;forum_n=6&amp;topic=20521&amp;page=0&amp;anchor=5" class="addthx" data-post="314566"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]F_a_u_s_t[/b]','')">F_a_u_s_t</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 0.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 16.12'>Активность: 0.25<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=6">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 21 ноября 2012 18:41 &middot; Поправил: F_a_u_s_t <br><script type="text/javascript">QU('F_a_u_s_t','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=F_a_u_s_t" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=20521&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
<b>CodeMaster</b><br>Ваш код это одна сплошная ошибка.<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">hFile&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;CreateFile<span class="hl_char">(</span><span class="hl_quote">'C:\protocol.txt'</span><span class="hl_char">,</span>&nbsp;GENERIC_WRITE<span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;nil<span class="hl_char">,</span>&nbsp;OPEN_ALWAYS<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span><span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div>
<br>1. Где проверка на валидность хендла:
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>if</b></span>&nbsp;hFIle&nbsp;<span class="hl_char">&lt;</span><span class="hl_char">&gt;</span>&nbsp;INVALID_HANDLE_VALUE&nbsp;then</li>        </ol>
    </div>
</div></div>
 ?<br>2. Какого уя вообще там делает функция открытия лог файла, а не в <b>DLL_PROCESS_ATTACH</b> с закрытием хендла в <b>DLL_PROCESS_DETACH</b> ?<br>3. В место <b>CreateFile</b> разве не нужно вызывать <b>TrueCreateFile</b> в detours покрайне мере так, как здесь не знаю, не пользовался.<br>Add:<br>И что это за неопределенность: <br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">NewCreateFileA</li><li class="hl_l1">NewCreateFileW</li><li class="hl_l0">HookProc<span class="hl_char">(</span><span class="hl_quote">'kernel32.dll'</span><span class="hl_char">,</span>&nbsp;<span class="hl_quote">'CreateFileW'</span><span class="hl_char">,</span>&nbsp;@NewCreateFileA<span class="hl_char">,</span>@TrueCreateFileW<span class="hl_char">)</span><span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div>
<br>Если что в блокноте <b>CreateFileW</b> используется.<br>Ужос, воистину мастер кодер.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=314568&amp;user=6&amp;forum_n=6&amp;topic=20521&amp;page=0&amp;anchor=6" class="addthx" data-post="314568"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]CodeMaster[/b]','')">CodeMaster</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 9.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.64'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33320">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 21 ноября 2012 19:17 <br><script type="text/javascript">QU('CodeMaster','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=CodeMaster" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=20521&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
В оригинале функция TrueCreateFile выглядела так:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">function&nbsp;TrueCreateFileW<span class="hl_char">(</span>lpFileName<span class="hl_char">:</span>&nbsp;PWideChar<span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwDesiredAccess</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>DWORD</b></span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwShareMode</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>DWORD</b></span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lpSecurityAttributes</span><span class="hl_char">:</span>&nbsp;PSecurityAttributes<span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwCreationDisposition</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>DWORD</b></span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwFlagsAndAttributes</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>DWORD</b></span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hTemplateFile</span><span class="hl_char">:</span>&nbsp;THandle<span class="hl_char">)</span><span class="hl_char">:</span>&nbsp;THandle<span class="hl_comment">; stdcall;</span></li><li class="hl_l1">var</li><li class="hl_l0">Written<span class="hl_char">:</span>&nbsp;SIZE_T<span class="hl_comment">;</span></li><li class="hl_l1">begin</li><li class="hl_l0">&nbsp;&nbsp;WriteProcessMemory<span class="hl_char">(</span>INVALID_HANDLE_VALUE<span class="hl_char">,</span>&nbsp;CfwAdr<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@OldCfw<span class="hl_char">,</span>&nbsp;<span class="hl_function">SizeOf</span><span class="hl_char">(</span>OldCode<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;Written<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_char">/</span><span class="hl_char">/</span>здесь&nbsp;мониторим&nbsp;открытие&nbsp;файла</li><li class="hl_l0"><span class="hl_char">/</span><span class="hl_char">/</span>важно<span class="hl_char">:</span>&nbsp;сохраняем&nbsp;код&nbsp;посл<span class="hl_char">.</span>&nbsp;ошибки</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;result&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;CreateFileW<span class="hl_char">(</span>lpFileName<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwDesiredAccess<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwShareMode<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lpSecurityAttributes<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwCreationDisposition<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwFlagsAndAttributes<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hTemplateFile<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;WriteProcessMemory<span class="hl_char">(</span>INVALID_HANDLE_VALUE<span class="hl_char">,</span>&nbsp;CfwAdr<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@JmpCfw<span class="hl_char">,</span>&nbsp;<span class="hl_function">SizeOf</span><span class="hl_char">(</span>far_jmp<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;Written<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div>
<br><br>Но у нас она в процедуре HookProc должна быть var. Вот я и объединил два разных кода в один общий.<br>NewCreateFile должна записать лог в файл,передать управление TrueCreateFile,которая в свою очередь возвращает result=CreateFileW ,т.е. оригинальную функцию или если быть точным pointer на неё<br>Я так это понял.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=314570&amp;user=33320&amp;forum_n=6&amp;topic=20521&amp;page=0&amp;anchor=7" class="addthx" data-post="314570"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]Ratinsh[/b]','')">Ratinsh</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 191.8 (ветеран), 46thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.54'>Активность: 0.17<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3333">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 21 ноября 2012 21:41 <br><script type="text/javascript">QU('Ratinsh','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Ratinsh" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=20521&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
Что-то подобное недавно попадалось на глаза<br>https://www.rohitab.com/discuss/topic/39343-dll-injection-variation-by-code-injection-c/
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=314581&amp;user=3333&amp;forum_n=6&amp;topic=20521&amp;page=0&amp;anchor=8" class="addthx" data-post="314581"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]Alchemistry[/b]','')">Alchemistry</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 145.8 (ветеран), 191thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.05'>Активность: 0.14<span style='color:green'>&nearr;</span>0.36</span><br>Статус: <a href="action=userinfo&amp;user=21411">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 21 ноября 2012 23:14 &middot; Поправил: Alchemistry <br><script type="text/javascript">QU('Alchemistry','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Alchemistry" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=20521&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
<b>CodeMaster</b><br><br>Такое будет работать в однопоточном приложении только.<br><br>Почему она TrueCreateFile, когда это твой обработчик. Он NewCreateFile.<br><br>сделать вот так (а не как в этом наркоманском примере) было не судьба?<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">NewCreateFileW<span class="hl_char">(</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">begin</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">HandleHook<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">result&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;TrueCreateFile<span class="hl_char">(</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div>
<br><br>не?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=314584&amp;user=21411&amp;forum_n=6&amp;topic=20521&amp;page=0&amp;anchor=9" class="addthx" data-post="314584"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]CodeMaster[/b]','')">CodeMaster</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 9.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.64'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33320">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 ноября 2012 18:56 <br><script type="text/javascript">QU('CodeMaster','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=CodeMaster" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=20521&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
Накодил вот что:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>library</b></span>&nbsp;Project11<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_function">uses</span></li><li class="hl_l1">&nbsp;&nbsp;System<span class="hl_char">.</span>SysUtils<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;System<span class="hl_char">.</span>Classes<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;Windows<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;Vcl<span class="hl_char">.</span>Dialogs<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;advApiHook&nbsp;<span class="hl_function"><b>in</b></span>&nbsp;<span class="hl_quote">'advApiHook.pas'</span><span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;NativeAPI&nbsp;<span class="hl_function"><b>in</b></span>&nbsp;<span class="hl_quote">'NativeAPI.pas'</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">type</li><li class="hl_l1">&nbsp;&nbsp;far_jmp&nbsp;<span class="hl_char">=</span>&nbsp;packed&nbsp;record</li><li class="hl_l0">&nbsp;&nbsp;PuhsOp<span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>byte</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;PushArg<span class="hl_char">:</span>&nbsp;pointer<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;RetOp<span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>byte</b></span><span class="hl_comment">;</span></li><li class="hl_l1"><span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">var</li><li class="hl_l0">TrueCreateFileW<span class="hl_char">:</span>&nbsp;function<span class="hl_char">(</span>lpFileName<span class="hl_char">:</span>&nbsp;PWideChar<span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwDesiredAccess</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>DWORD</b></span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwShareMode</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>DWORD</b></span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lpSecurityAttributes</span><span class="hl_char">:</span>&nbsp;PSecurityAttributes<span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwCreationDisposition</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>DWORD</b></span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwFlagsAndAttributes</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>DWORD</b></span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hTemplateFile</span><span class="hl_char">:</span>&nbsp;THandle<span class="hl_char">)</span><span class="hl_char">:</span>&nbsp;THandle<span class="hl_comment">; stdcall;</span></li><li class="hl_l1">JmpMbw<span class="hl_char">,</span>&nbsp;OldMbw<span class="hl_char">:</span>&nbsp;far_jmp<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">function&nbsp;NewCreateFileW<span class="hl_char">(</span>lpFileName<span class="hl_char">:</span>&nbsp;PWideChar<span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwDesiredAccess</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>DWORD</b></span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwShareMode</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>DWORD</b></span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lpSecurityAttributes</span><span class="hl_char">:</span>&nbsp;PSecurityAttributes<span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwCreationDisposition</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>DWORD</b></span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwFlagsAndAttributes</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>DWORD</b></span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hTemplateFile</span><span class="hl_char">:</span>&nbsp;THandle<span class="hl_char">)</span><span class="hl_char">:</span>&nbsp;THandle<span class="hl_comment">; stdcall;</span></li><li class="hl_l0">var</li><li class="hl_l1">&nbsp;&nbsp;hFile<span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>dword</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;fName<span class="hl_char">:</span>&nbsp;String<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;OldProt<span class="hl_char">,</span>NewProt<span class="hl_char">:</span><span class="hl_function"><b>DWORD</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;Written<span class="hl_char">:</span>&nbsp;SIZE_T<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;i<span class="hl_char">:</span>&nbsp;Integer<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;file_name<span class="hl_char">:</span>&nbsp;PAnsiChar<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;name_len<span class="hl_char">,</span>zapisano<span class="hl_char">:</span><span class="hl_function"><b>DWORD</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;namefile<span class="hl_char">:</span>PAnsiChar<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;buff<span class="hl_char">:</span><span class="hl_function"><b>DWORD</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">begin</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;fName<span class="hl_char">:</span><span class="hl_char">=</span>WideCharToString<span class="hl_char">(</span>lpFileName<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WriteProcessMemory<span class="hl_char">(</span>INVALID_HANDLE_VALUE<span class="hl_char">,</span>&nbsp;@TrueCreateFileW<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@OldMbw<span class="hl_char">,</span>&nbsp;<span class="hl_function">SizeOf</span><span class="hl_char">(</span>far_jmp<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;Written<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;result&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;TrueCreateFileW<span class="hl_char">(</span>lpFileName<span class="hl_char">,</span>&nbsp;dwDesiredAccess<span class="hl_char">,</span>&nbsp;dwShareMode<span class="hl_char">,</span>&nbsp;lpSecurityAttributes<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwCreationDisposition<span class="hl_char">,</span>&nbsp;dwFlagsAndAttributes<span class="hl_char">,</span>&nbsp;hTemplateFile<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;lpFileName<span class="hl_char">=</span><span class="hl_quote">'C:\proverka.txt'</span>&nbsp;then</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;begin</li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>GetFileSize<span class="hl_char">(</span>lpFileName<span class="hl_char">,</span>@buff<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;ShowMessage<span class="hl_char">(</span>lpFileName<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;WideCharToMultibyte<span class="hl_char">(</span>CP_ACP<span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span>lpFileName<span class="hl_char">,</span><span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">,</span>namefile<span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span>nil<span class="hl_char">,</span>nil<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;hFile&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;TrueCreateFileW<span class="hl_char">(</span><span class="hl_quote">'C:\protocol.txt'</span><span class="hl_char">,</span>&nbsp;GENERIC_WRITE<span class="hl_char">,</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;nil<span class="hl_char">,</span>&nbsp;OPEN_ALWAYS<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;SetFilePointer<span class="hl_char">(</span>hFile<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;nil<span class="hl_char">,</span>&nbsp;FILE_END<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;ShowMessage<span class="hl_char">(</span>namefile<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">WriteFile<span class="hl_char">(</span>hFile<span class="hl_char">,</span>&nbsp;namefile^<span class="hl_char">,</span>&nbsp;Length<span class="hl_char">(</span>namefile^<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;zapisano<span class="hl_char">,</span>&nbsp;nil<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WriteProcessMemory<span class="hl_char">(</span>INVALID_HANDLE_VALUE<span class="hl_char">,</span>&nbsp;@TrueCreateFileW<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@JmpMbw<span class="hl_char">,</span>&nbsp;<span class="hl_function">SizeOf</span><span class="hl_char">(</span>far_jmp<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;Written<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">Procedure&nbsp;SetHook<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">var</li><li class="hl_l0">hkernel32<span class="hl_char">:</span><span class="hl_function"><b>dword</b></span><span class="hl_comment">;</span></li><li class="hl_l1">Bytes<span class="hl_char">:</span>SIZE_T<span class="hl_comment">;</span></li><li class="hl_l0">OldProt<span class="hl_char">:</span><span class="hl_function"><b>dword</b></span><span class="hl_comment">;</span></li><li class="hl_l1">begin</li><li class="hl_l0">&nbsp;&nbsp;hkernel32<span class="hl_char">:</span><span class="hl_char">=</span>GetModuleHandle<span class="hl_char">(</span><span class="hl_quote">'kernel32.dll'</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;TrueCreateFileW<span class="hl_char">:</span><span class="hl_char">=</span>GetProcAddress<span class="hl_char">(</span>hkernel32<span class="hl_char">,</span><span class="hl_quote">'CreateFileW'</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;ReadProcessMemory<span class="hl_char">(</span>INVALID_HANDLE_VALUE<span class="hl_char">,</span>&nbsp;@TrueCreateFileW<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@OldMbw<span class="hl_char">,</span>&nbsp;<span class="hl_function">SizeOf</span><span class="hl_char">(</span>far_jmp<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;Bytes<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;JmpMbw<span class="hl_char">.</span>PuhsOp<span class="hl_char">:</span><span class="hl_char">=</span><span class="hl_char">$</span><span class="hl_number">68</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;JmpMbw<span class="hl_char">.</span>PushArg<span class="hl_char">:</span><span class="hl_char">=</span>@NewCreateFileW<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;JmpMbw<span class="hl_char">.</span>RetOp<span class="hl_char">:</span><span class="hl_char">=</span><span class="hl_char">$</span>C3<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;VirtualProtectEx<span class="hl_char">(</span>INVALID_HANDLE_VALUE<span class="hl_char">,</span>@TrueCreateFileW<span class="hl_char">,</span><span class="hl_function">SizeOf</span><span class="hl_char">(</span>far_jmp<span class="hl_char">)</span><span class="hl_char">,</span>PAGE_EXECUTE_READWRITE<span class="hl_char">,</span>@OldProt<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;WriteProcessMemory<span class="hl_char">(</span>INVALID_HANDLE_VALUE<span class="hl_char">,</span>&nbsp;@TrueCreateFileW<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@JmpMbw<span class="hl_char">,</span>&nbsp;<span class="hl_function">SizeOf</span><span class="hl_char">(</span>far_jmp<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;Bytes<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;<span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">{<span class="hl_char">$</span>R&nbsp;<span class="hl_char">*</span><span class="hl_char">.</span>res}</li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_char">/</span><span class="hl_char">/</span>входная&nbsp;точка&nbsp;DLL</li><li class="hl_l1">procedure&nbsp;DLLEntryPoint<span class="hl_char">(</span>dwReason<span class="hl_char">:</span><span class="hl_function">DWORD</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">var</li><li class="hl_l1">file_name<span class="hl_char">:</span>&nbsp;PWideChar<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;name_len<span class="hl_char">,</span>zapisano<span class="hl_char">:</span><span class="hl_function"><b>DWORD</b></span><span class="hl_comment">;</span></li><li class="hl_l1">begin</li><li class="hl_l0">&nbsp;&nbsp;case&nbsp;dwReason&nbsp;of</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;DLL_PROCESS_ATTACH<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;begin</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ShowMessage<span class="hl_char">(</span><span class="hl_quote">'Загружен код DLL в адресное пространство процесса'</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetHook<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;DLL_PROCESS_DETACH<span class="hl_char">:</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;begin</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UnhookCode<span class="hl_char">(</span>@TrueCreateFileW<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l1"><span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l0">begin</li><li class="hl_l1">DllProc<span class="hl_char">:</span><span class="hl_char">=</span>@DLLEntryPoint<span class="hl_comment">;</span></li><li class="hl_l0">DLLEntryPoint<span class="hl_char">(</span>DLL_PROCESS_ATTACH<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span class="hl_function">end</span><span class="hl_char">.</span></li>        </ol>
    </div>
</div></div>
<br><br>Перехват работает,но имена файлов в лог не пишутся. И ещё я не пойму как определить размер открываемого файла, нужно вызывать функцию определения хэндла для lpFileName ?<br>Или забить вообще на CreateFileW и перехватывать NtCreateFile?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=314741&amp;user=33320&amp;forum_n=6&amp;topic=20521&amp;page=0&amp;anchor=10" class="addthx" data-post="314741"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]tomac[/b]','')">tomac</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 65.3 (постоянный), 10thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.82'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=6470">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 ноября 2012 23:24 <br><script type="text/javascript">QU('tomac','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=tomac" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=20521&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
<b>CodeMaster</b><br>CloseHandle кто делать будет? С чего ему писаться-то? Второй раз открыть не дает sharing violation, первый раз кеш не сбрасывается. Если и после этого не запишется, отлаживай всё подряд, что возвращает TrueCreateFileW, что WriteFile.<br><br>По коду. Использовать WriteProcessMemory для своего процесса - зачем? Использовать VirtualProtectEx для своего процесса - опять же зачем? <br>ВиртуалПротект надо отменять после записи, да и ставить EXECUTE_READWRITE - не очень хорошая идея.<br><br>Главное: этот код не потокобезопасен.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=314746&amp;user=6470&amp;forum_n=6&amp;topic=20521&amp;page=0&amp;anchor=11" class="addthx" data-post="314746"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]ajax[/b]','')">ajax</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/8830.gif" alt=""><br><span class=txtSm>Ранг: 337.6 (мудрец), 224thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.53'>Активность: 0.21<span style='color:red'>&searr;</span>0.1</span><br>Статус: <a href="action=userinfo&amp;user=8830">Участник</a><br><font color=blue>born to be evil</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 ноября 2012 02:36 &middot; Поправил: ajax <br><script type="text/javascript">QU('ajax','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ajax" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=20521&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
кг/ам. когда-то хотел эти сырки переписать под XE+, но проблем больше, чем с нуля кодить<br>правка: и траблов вылезало гораздо больше, чем у аффтара топика
<br><br><font size="1"><i>-----<br>От многой мудрости много скорби, и умножающий знание умножает печаль</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=314749&amp;user=8830&amp;forum_n=6&amp;topic=20521&amp;page=0&amp;anchor=12" class="addthx" data-post="314749"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]F_a_u_s_t[/b]','')">F_a_u_s_t</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 0.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 16.12'>Активность: 0.25<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=6">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 ноября 2012 13:05 <br><script type="text/javascript">QU('F_a_u_s_t','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=F_a_u_s_t" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=20521&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
<b>CodeMaster</b><br>Что то не заметно особых исправлений, как был образец для <noindex><a href="http://govnokod.ru/" rel="nofollow" target="_blank">элитного</a></noindex> сайта, так им и остался.<br>Хз даже что советовать, взять madcodehook или easyhook под delphi есть враппер или тот же afxcodehook.<br>И что бы кто то помог, не плохо бы указывать где и какая ошибка, а это добавить проверки, в уме не очень компилировать, а delphi под рукой нет, кроме старенькой 2006.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=314760&amp;user=6&amp;forum_n=6&amp;topic=20521&amp;page=0&amp;anchor=13" class="addthx" data-post="314760"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]CodeMaster[/b]','')">CodeMaster</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 9.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.64'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33320">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 ноября 2012 13:21 <br><script type="text/javascript">QU('CodeMaster','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=CodeMaster" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=20521&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
С перехватом вроде всё получилось,имена файлов пишет в протокол. Теперь пытаюсь скопировать содержимое перехваченного файла, но копируется файл в 400 раз большего размера и забитый нулями:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">function&nbsp;NewCreateFileW<span class="hl_char">(</span>lpFileName<span class="hl_char">:</span>&nbsp;PWideChar<span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwDesiredAccess</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>DWORD</b></span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwShareMode</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>DWORD</b></span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lpSecurityAttributes</span><span class="hl_char">:</span>&nbsp;PSecurityAttributes<span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwCreationDisposition</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>DWORD</b></span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwFlagsAndAttributes</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>DWORD</b></span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hTemplateFile</span><span class="hl_char">:</span>&nbsp;THandle<span class="hl_char">)</span><span class="hl_char">:</span>&nbsp;THandle<span class="hl_comment">; stdcall;</span></li><li class="hl_l1">var</li><li class="hl_l0">&nbsp;&nbsp;hFile1<span class="hl_char">,</span>hFile2<span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>dword</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;OldProt<span class="hl_char">,</span>NewProt<span class="hl_char">:</span><span class="hl_function"><b>DWORD</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;Written<span class="hl_char">:</span>&nbsp;SIZE_T<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;i<span class="hl_char">:</span>&nbsp;Integer<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;file_name<span class="hl_char">:</span>&nbsp;PAnsiChar<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;name_len<span class="hl_char">,</span>zapisano<span class="hl_char">:</span><span class="hl_function"><b>DWORD</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;namefile<span class="hl_char">:</span>PAnsiChar<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;buff<span class="hl_char">:</span><span class="hl_function"><b>DWORD</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;readbuf<span class="hl_char">:</span>PWideChar<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;dlina<span class="hl_char">:</span>integer<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">begin</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;WriteProcessMemory<span class="hl_char">(</span>INVALID_HANDLE_VALUE<span class="hl_char">,</span>&nbsp;@TrueCreateFileW<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@OldMbw<span class="hl_char">,</span>&nbsp;<span class="hl_function">SizeOf</span><span class="hl_char">(</span>far_jmp<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;Written<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;result&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;TrueCreateFileW<span class="hl_char">(</span>lpFileName<span class="hl_char">,</span>&nbsp;dwDesiredAccess<span class="hl_char">,</span>&nbsp;dwShareMode<span class="hl_char">,</span>&nbsp;lpSecurityAttributes<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwCreationDisposition<span class="hl_char">,</span>&nbsp;dwFlagsAndAttributes<span class="hl_char">,</span>&nbsp;hTemplateFile<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;lpFileName<span class="hl_char">=</span><span class="hl_quote">'C:\proverka.txt'</span>&nbsp;then</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;begin</li><li class="hl_l0"><span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;&nbsp;ShowMessage<span class="hl_char">(</span>lpFileName<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;hFile1<span class="hl_char">:</span><span class="hl_char">=</span>TrueCreateFileW<span class="hl_char">(</span>lpFileName<span class="hl_char">,</span>GENERIC_READ<span class="hl_char">,</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;nil<span class="hl_char">,</span>&nbsp;OPEN_ALWAYS<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;hFile2<span class="hl_char">:</span><span class="hl_char">=</span>TrueCreateFileW<span class="hl_char">(</span><span class="hl_quote">'C:\test.pak'</span><span class="hl_char">,</span>GENERIC_WRITE<span class="hl_char">,</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;nil<span class="hl_char">,</span>&nbsp;OPEN_ALWAYS<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;SetFilePointer<span class="hl_char">(</span>hFile1<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;nil<span class="hl_char">,</span>&nbsp;FILE_END<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;GetFileSize<span class="hl_char">(</span>hFile1<span class="hl_char">,</span>@buff<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;GetMem<span class="hl_char">(</span>readbuf<span class="hl_char">,</span>buff<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;ReadFile<span class="hl_char">(</span>hFile1<span class="hl_char">,</span>readbuf^<span class="hl_char">,</span>buff<span class="hl_char">,</span>zapisano<span class="hl_char">,</span>nil<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;WriteFile<span class="hl_char">(</span>hFile2<span class="hl_char">,</span>readbuf^<span class="hl_char">,</span>buff<span class="hl_char">,</span>zapisano<span class="hl_char">,</span>nil<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;&nbsp;dlina<span class="hl_char">:</span><span class="hl_char">=</span>lstrlenw<span class="hl_char">(</span>lpFileName<span class="hl_char">)</span><span class="hl_char">+</span><span class="hl_number">2</span><span class="hl_comment">;</span></li><li class="hl_l1"><span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;&nbsp;GetMem<span class="hl_char">(</span>namefile<span class="hl_char">,</span>dlina<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;WideCharToMultiByte<span class="hl_char">(</span>CP_ACP<span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span>lpFileName<span class="hl_char">,</span>dlina<span class="hl_char">,</span>namefile<span class="hl_char">,</span>dlina<span class="hl_char">*</span><span class="hl_number">2</span><span class="hl_char">,</span>nil<span class="hl_char">,</span>nil<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;&nbsp;&nbsp;hFile&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;TrueCreateFileW<span class="hl_char">(</span><span class="hl_quote">'C:\protocol.txt'</span><span class="hl_char">,</span>&nbsp;GENERIC_WRITE<span class="hl_char">,</span></li><li class="hl_l0"><span class="hl_char">/</span><span class="hl_char">/</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;nil<span class="hl_char">,</span>&nbsp;OPEN_ALWAYS<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;&nbsp;&nbsp;SetFilePointer<span class="hl_char">(</span>hFile<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;nil<span class="hl_char">,</span>&nbsp;FILE_END<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;ShowMessage<span class="hl_char">(</span>namefile<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span class="hl_char">/</span><span class="hl_char">/</span>WriteFile<span class="hl_char">(</span>hFile<span class="hl_char">,</span>&nbsp;namefile^<span class="hl_char">,</span>&nbsp;Length<span class="hl_char">(</span>namefile<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;zapisano<span class="hl_char">,</span>&nbsp;nil<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">CloseHandle<span class="hl_char">(</span>hFile1<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">CloseHandle<span class="hl_char">(</span>hFile2<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">FreeMem<span class="hl_char">(</span>readbuf<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WriteProcessMemory<span class="hl_char">(</span>INVALID_HANDLE_VALUE<span class="hl_char">,</span>&nbsp;@TrueCreateFileW<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@JmpMbw<span class="hl_char">,</span>&nbsp;<span class="hl_function">SizeOf</span><span class="hl_char">(</span>far_jmp<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;Written<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li>        </ol>
    </div>
</div></div>
<br><br>Прошу агрессивно не реагировать на косяки,Delphi изучал на коленке.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=314834&amp;user=33320&amp;forum_n=6&amp;topic=20521&amp;page=0&amp;anchor=14" class="addthx" data-post="314834"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]Alchemistry[/b]','')">Alchemistry</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 145.8 (ветеран), 191thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.05'>Активность: 0.14<span style='color:green'>&nearr;</span>0.36</span><br>Статус: <a href="action=userinfo&amp;user=21411">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 ноября 2012 13:33 <br><script type="text/javascript">QU('Alchemistry','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Alchemistry" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=20521&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
<b>CodeMaster</b><br><br>Причем тут дельфе если ты не знаешь даже элементарных основ, а уже поперся в какие-то перехваты, т.е. изменение работы тех самых основ, о которых ты не имеешь, судя по всему, никакого представления. <br><br>Ты даже не знаешь, что переменные могут быть неинициализованны (прям как у тебя), и что GetFileSize в втором параметре это указатель на переменную, в которой возвращается старшее слово размера файла. У тебя что файл больше 4Gb? Тут же следом в пофигмоде у тебя какой-то паскалевский GetMem с этой переменной. В этой мерзости, что является твоим кодом, даже разбираться то лень.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=314835&amp;user=21411&amp;forum_n=6&amp;topic=20521&amp;page=0&amp;anchor=15" class="addthx" data-post="314835"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]Dialog[/b]','')">Dialog</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 1.5 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.01'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=29596">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 ноября 2012 13:53 <br><script type="text/javascript">QU('Dialog','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Dialog" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=20521&amp;page=0#16');return false;">#16</a> </span><div align=left><br>
<b>F_a_u_s_t</b> <b>tomac</b> <b>ajax</b> <b>Alchemistry</b><br>покажите как правильно и потокобезопасно на примере блокнота <img src="img/smilies/s1.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=314836&amp;user=29596&amp;forum_n=6&amp;topic=20521&amp;page=0&amp;anchor=16" class="addthx" data-post="314836"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]CodeMaster[/b]','')">CodeMaster</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 9.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.64'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33320">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 ноября 2012 14:03 <br><script type="text/javascript">QU('CodeMaster','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=CodeMaster" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=20521&amp;page=0#17');return false;">#17</a> </span><div align=left><br>
Ну эту &quot;мерзость&quot; я собирал из форумов по Дельфи,там что по вашему одни идиоты сидят?<br>Укажите в каком месте ошибка и правильный ли сам алгоритм:<br>CreateFile1 для чтения<br>CreateFile2 для записи<br>SetFilePointer для 1 файла<br>GetMem - выделяем буфер в памяти для чтения<br>ReadFile1<br>WriteFile2<br>CloseHandle()<br>FreeMem
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=314838&amp;user=33320&amp;forum_n=6&amp;topic=20521&amp;page=0&amp;anchor=17" class="addthx" data-post="314838"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]CodeMaster[/b]','')">CodeMaster</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 9.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.64'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33320">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 ноября 2012 14:06 <br><script type="text/javascript">QU('CodeMaster','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=CodeMaster" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=20521&amp;page=0#18');return false;">#18</a> </span><div align=left><br>
И ещё я не знаю правильно ли это:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">&nbsp;hFile1<span class="hl_char">:</span><span class="hl_char">=</span>TrueCreateFileW<span class="hl_char">(</span>lpFileName<span class="hl_char">,</span>GENERIC_READ<span class="hl_char">,</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;nil<span class="hl_char">,</span>&nbsp;OPEN_ALWAYS<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span><span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div>
<br>У нас хэндл перехватываемого файла задан не ясно,а через lpFileName. Т.е к примеру чтобы копировались все файл,какие открывает блокнот в течении своей работы
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=314839&amp;user=33320&amp;forum_n=6&amp;topic=20521&amp;page=0&amp;anchor=18" class="addthx" data-post="314839"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]F_a_u_s_t[/b]','')">F_a_u_s_t</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 0.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 16.12'>Активность: 0.25<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=6">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 ноября 2012 15:05 <br><script type="text/javascript">QU('F_a_u_s_t','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=F_a_u_s_t" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=20521&amp;page=0#19');return false;">#19</a> </span><div align=left><br>
<b>Dialog</b><br>Как два пальца, ну вы поняли.<br>Посоны делают так:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">#include&nbsp;<span class="hl_quote">&quot;main.h&quot;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">HANDLE&nbsp;handle_log<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">static&nbsp;HANDLE&nbsp;<span class="hl_char">(</span>WINAPI&nbsp;<span class="hl_char">*</span>OldFunc<span class="hl_char">)</span>&nbsp;<span class="hl_char">(</span>&nbsp;LPCTSTR&nbsp;lpFileName<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;dwDesiredAccess<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;dwShareMode<span class="hl_char">,</span>&nbsp;LPSECURITY_ATTRIBUTES&nbsp;lpSecurityAttributes<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;dwCreationDisposition<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;dwFlagsAndAttributes<span class="hl_char">,</span>&nbsp;HANDLE&nbsp;hTemplateFile<span class="hl_char">)</span>&nbsp;<span class="hl_char">=</span>&nbsp;CreateFileA<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">HANDLE&nbsp;WINAPI&nbsp;NewFunc<span class="hl_char">(</span>&nbsp;LPCTSTR&nbsp;lpFileName<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;dwDesiredAccess<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;dwShareMode<span class="hl_char">,</span>&nbsp;LPSECURITY_ATTRIBUTES&nbsp;lpSecurityAttributes<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;dwCreationDisposition<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;dwFlagsAndAttributes<span class="hl_char">,</span>&nbsp;HANDLE&nbsp;hTemplateFile<span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;written<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>&nbsp;handle_log&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;INVALID_HANDLE_VALUE&nbsp;<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;WriteFile<span class="hl_char">(</span>handle_log<span class="hl_char">,</span>&nbsp;lpFileName<span class="hl_char">,</span>&nbsp;strlen<span class="hl_char">(</span>lpFileName<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>written<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;OldFunc<span class="hl_char">(</span>lpFileName<span class="hl_char">,</span>&nbsp;dwDesiredAccess<span class="hl_char">,</span>&nbsp;dwShareMode<span class="hl_char">,</span>&nbsp;lpSecurityAttributes<span class="hl_char">,</span>&nbsp;dwCreationDisposition<span class="hl_char">,</span>&nbsp;dwFlagsAndAttributes<span class="hl_char">,</span>&nbsp;hTemplateFile<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">}</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">BOOL&nbsp;DllMain<span class="hl_char">(</span>HINSTANCE&nbsp;hinstDLL<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;dwReason<span class="hl_char">,</span>&nbsp;LPVOID&nbsp;lpvReserved<span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;LONG&nbsp;error<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">(</span><span class="hl_function">void</span><span class="hl_char">)</span>hinstDLL<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">(</span><span class="hl_function">void</span><span class="hl_char">)</span>lpvReserved<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>DetourIsHelperProcess<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_function"><b>TRUE</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>dwReason&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;DLL_PROCESS_ATTACH<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handle_log&nbsp;<span class="hl_char">=</span>&nbsp;OldFunc<span class="hl_char">(</span>&nbsp;<span class="hl_quote">&quot;C:\file_open_log.txt&quot;</span><span class="hl_char">,</span>&nbsp;GENERIC_WRITE<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;OPEN_ALWAYS<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span>&nbsp;<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DetourRestoreAfterWith<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DetourTransactionBegin<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DetourUpdateThread<span class="hl_char">(</span>GetCurrentThread<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DetourAttach<span class="hl_char">(</span><span class="hl_char">&amp;</span><span class="hl_char">(</span>PVOID<span class="hl_char">&amp;</span><span class="hl_char">)</span>OldFunc<span class="hl_char">,</span>&nbsp;NewFunc<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error&nbsp;<span class="hl_char">=</span>&nbsp;DetourTransactionCommit<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>error&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;NO_ERROR<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">else</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>else</b></span>&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>dwReason&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;DLL_PROCESS_DETACH<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>&nbsp;handle_log&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;INVALID_HANDLE_VALUE&nbsp;<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle<span class="hl_char">(</span>&nbsp;handle_log&nbsp;<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DetourTransactionBegin<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DetourUpdateThread<span class="hl_char">(</span>GetCurrentThread<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DetourDetach<span class="hl_char">(</span><span class="hl_char">&amp;</span><span class="hl_char">(</span>PVOID<span class="hl_char">&amp;</span><span class="hl_char">)</span>OldFunc<span class="hl_char">,</span>&nbsp;NewFunc<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error&nbsp;<span class="hl_char">=</span>&nbsp;DetourTransactionCommit<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_function"><b>TRUE</b></span><span class="hl_comment">;</span></li><li class="hl_l0">}</li>        </ol>
    </div>
</div></div>
<br>Писал в браузе, но на вид рабочее.<img src="img/smilies/s1.gif" alt=""><br>В том же изи хук практически так же.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=314844&amp;user=6&amp;forum_n=6&amp;topic=20521&amp;page=0&amp;anchor=19" class="addthx" data-post="314844"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=29596" title="28-11-2012 11:07, ранг:1.3" target="_blank">Dialog</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="20" onfocus="this.blur()" href="JavaScript:di('[b]Alchemistry[/b]','')">Alchemistry</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 145.8 (ветеран), 191thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.05'>Активность: 0.14<span style='color:green'>&nearr;</span>0.36</span><br>Статус: <a href="action=userinfo&amp;user=21411">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 ноября 2012 15:54 <br><script type="text/javascript">QU('Alchemistry','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Alchemistry" target="_blank">Личное сообщение</a> &middot;  <a href="#20" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=20521&amp;page=0#20');return false;">#20</a> </span><div align=left><br>
<I>Dialog пишет:<br>покажите как правильно и потокобезопасно на примере блокнота  <br> </I><br><br>Вот целая статья, с примерами Detours и даже внимание, классического сплайсинга.<br>http://www.codeproject.com/Articles/30140/API-Hooking-with-MS-Detours<br><br><b>CodeMaster</b><br><br>Начнем с того, что блокнот никогда не держит файл открытым, а читает он его через проекцию и точно также записывает обратно изменения.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=314851&amp;user=21411&amp;forum_n=6&amp;topic=20521&amp;page=0&amp;anchor=20" class="addthx" data-post="314851"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=29596" title="28-11-2012 11:55, ранг:1.3" target="_blank">Dialog</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="21" onfocus="this.blur()" href="JavaScript:di('[b]CodeMaster[/b]','')">CodeMaster</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 9.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.64'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33320">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 ноября 2012 18:06 <br><script type="text/javascript">QU('CodeMaster','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=CodeMaster" target="_blank">Личное сообщение</a> &middot;  <a href="#21" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=20521&amp;page=0#21');return false;">#21</a> </span><div align=left><br>
Да уж толстее троллинга не придумаешь,обосрать всех и выложить ссылку на другом языке программирования. Нах мне ваши примеры,если я свой код разрабатываю на основе совсем других сорцев?<br>Перехват + инжект у меня работает замечательно, <b>задача перехватить открытый Блокнотом файл и скопировать его на диск.</b><br>Доработанный мною <b>упрощенный вариант кода</b> правильно определяет размер файла,создает его но там одни нули:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">hFile1<span class="hl_char">:</span><span class="hl_char">=</span>TrueCreateFileW<span class="hl_char">(</span><span class="hl_quote">'C:\proverka.txt'</span><span class="hl_char">,</span>GENERIC_READ<span class="hl_char">,</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;nil<span class="hl_char">,</span>&nbsp;OPEN_ALWAYS<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;hFile2<span class="hl_char">:</span><span class="hl_char">=</span>TrueCreateFileW<span class="hl_char">(</span><span class="hl_quote">'C:\test.pak'</span><span class="hl_char">,</span>GENERIC_WRITE<span class="hl_char">,</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;nil<span class="hl_char">,</span>&nbsp;OPEN_ALWAYS<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;SetFilePointer<span class="hl_char">(</span>hFile1<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;nil<span class="hl_char">,</span>&nbsp;FILE_END<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;buff<span class="hl_char">:</span><span class="hl_char">=</span>GetFileSize<span class="hl_char">(</span>hFile1<span class="hl_char">,</span>nil<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;<span class="hl_function">data</span><span class="hl_char">:</span><span class="hl_char">=</span>VirtualAlloc<span class="hl_char">(</span>nil<span class="hl_char">,</span>buff<span class="hl_char">,</span>MEM_COMMIT&nbsp;<span class="hl_function"><b>or</b></span>&nbsp;MEM_RESERVE<span class="hl_char">,</span>PAGE_READWRITE<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;ReadFile<span class="hl_char">(</span>hFile1<span class="hl_char">,</span>data^<span class="hl_char">,</span>buff<span class="hl_char">,</span>zapisano<span class="hl_char">,</span>nil<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;WriteFile<span class="hl_char">(</span>hFile2<span class="hl_char">,</span>data^<span class="hl_char">,</span>buff<span class="hl_char">,</span>zapisano<span class="hl_char">,</span>nil<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">CloseHandle<span class="hl_char">(</span>hFile1<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">CloseHandle<span class="hl_char">(</span>hFile2<span class="hl_char">)</span><span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=314857&amp;user=33320&amp;forum_n=6&amp;topic=20521&amp;page=0&amp;anchor=21" class="addthx" data-post="314857"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="22" onfocus="this.blur()" href="JavaScript:di('[b]F_a_u_s_t[/b]','')">F_a_u_s_t</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 0.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 16.12'>Активность: 0.25<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=6">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 ноября 2012 18:51 <br><script type="text/javascript">QU('F_a_u_s_t','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=F_a_u_s_t" target="_blank">Личное сообщение</a> &middot;  <a href="#22" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=20521&amp;page=0#22');return false;">#22</a> </span><div align=left><br>
<b>CodeMaster</b><br>Простите мастер падавана, ну все же может изволите сделать одолжение и перечитать мои посты, даже укажу что именно.:<br><I>F_a_u_s_t пишет:<br>1. Где проверка на валидность хендла: </I><br><I>F_a_u_s_t пишет:<br>2. Какого уя вообще там делает функция открытия лог файла, а не в DLL_PROCESS_ATTACH с закрытием хендла в DLL_PROCESS_DETACH ? </I><br><I>F_a_u_s_t пишет:<br>взять madcodehook </I><br>Вы уж простите великодушно что мне жаль времени описывать основы.<br>Но <b>madcodehook</b> сполна это компенсирует, в если погуглить то можно найти ломаный компонент или исходники старых версий.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=314858&amp;user=6&amp;forum_n=6&amp;topic=20521&amp;page=0&amp;anchor=22" class="addthx" data-post="314858"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="23" onfocus="this.blur()" href="JavaScript:di('[b]CodeMaster[/b]','')">CodeMaster</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 9.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.64'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33320">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 ноября 2012 19:11 <br><script type="text/javascript">QU('CodeMaster','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=CodeMaster" target="_blank">Личное сообщение</a> &middot;  <a href="#23" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=20521&amp;page=0#23');return false;">#23</a> </span><div align=left><br>
<b>F_a_u_s_t</b><br>1. Она как то влияет на работу кода? У меня работает и без проверки (в сорцах исходных её не было)<br>2. Вообще бред какой-то. DLL_PROCESS_ATTACH у нас инициализирует функцию установки хука и управление передается функции NewCreateFile. Верно? Как же будет работать код,если я его засуну после функции хука в раздел DLL_init? Более того,я пробовал так делать и ничего не работает.<br>Я не пойму вы издеваетесь или правда не понимаете как это работает? Я нуб в кодинге и то уже вроде понял что все операции после хука надо прописывать в тело перехватываемой функции
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=314859&amp;user=33320&amp;forum_n=6&amp;topic=20521&amp;page=0&amp;anchor=23" class="addthx" data-post="314859"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="24" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 ноября 2012 19:11 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#24" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=20521&amp;page=0#24');return false;">#24</a> </span><div align=left><br>
<b>CodeMaster</b><br>Ты сам-то вообще хыть пытался разобрать, что накопи-пастил или просто накидал, попытался это скомпилить и после этого сразу полез на форум жаловаться?<br><I>CodeMaster пишет:<br>SetFilePointer(hFile1, 0, nil, FILE_END);</I><br>Действительно, и почему бы после этого оно не читало файл, прям загадка.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=314860&amp;user=1556&amp;forum_n=6&amp;topic=20521&amp;page=0&amp;anchor=24" class="addthx" data-post="314860"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="25" onfocus="this.blur()" href="JavaScript:di('[b]CodeMaster[/b]','')">CodeMaster</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 9.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.64'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33320">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 ноября 2012 19:22 &middot; Поправил: CodeMaster <br><script type="text/javascript">QU('CodeMaster','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=CodeMaster" target="_blank">Личное сообщение</a> &middot;  <a href="#25" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=20521&amp;page=0#25');return false;">#25</a> </span><div align=left><br>
<b>Archer</b><br>Что не так? Единственное что приходит на ум,вместо FILE_END надо поставить FILE_BEGIN<br>Наверно вот так надо сделать:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">SetFilePointer<span class="hl_char">(</span>hFile1<span class="hl_char">,</span>&nbsp;buff<span class="hl_char">,</span>&nbsp;nil<span class="hl_char">,</span>&nbsp;FILE_BEGIN<span class="hl_char">)</span><span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=314861&amp;user=33320&amp;forum_n=6&amp;topic=20521&amp;page=0&amp;anchor=25" class="addthx" data-post="314861"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="26" onfocus="this.blur()" href="JavaScript:di('[b]F_a_u_s_t[/b]','')">F_a_u_s_t</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 0.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 16.12'>Активность: 0.25<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=6">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 ноября 2012 20:05 <br><script type="text/javascript">QU('F_a_u_s_t','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=F_a_u_s_t" target="_blank">Личное сообщение</a> &middot;  <a href="#26" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=20521&amp;page=0#26');return false;">#26</a> </span><div align=left><br>
[рукалицо]<br>Прочтите пожалуйста по ссылкам маэстро.<br>[/рукалицо]<br><noindex><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365541(v=vs.85).aspx" rel="nofollow" target="_blank">Здесь</a></noindex><br>и<br><noindex><a href="http://vsokovikov.narod.ru/New_MSDN_API/Menage_files/fn_setfilepointer.htm" rel="nofollow" target="_blank">вот здесь</a></noindex><br>Не смею больше троллить, пишите.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=314866&amp;user=6&amp;forum_n=6&amp;topic=20521&amp;page=0&amp;anchor=26" class="addthx" data-post="314866"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="27" onfocus="this.blur()" href="JavaScript:di('[b]Alchemistry[/b]','')">Alchemistry</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 145.8 (ветеран), 191thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.05'>Активность: 0.14<span style='color:green'>&nearr;</span>0.36</span><br>Статус: <a href="action=userinfo&amp;user=21411">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 ноября 2012 20:21 <br><script type="text/javascript">QU('Alchemistry','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Alchemistry" target="_blank">Личное сообщение</a> &middot;  <a href="#27" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=20521&amp;page=0#27');return false;">#27</a> </span><div align=left><br>
<b>CodeMaster</b><br><br>Достопочтеннейший гуру сплайса и маэстро Win32 API, не соблаговолите ли вы объяснить толстому троллю мне вот эти ваши илитные кодесы:<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">hFile1<span class="hl_char">:</span><span class="hl_char">=</span>TrueCreateFileW<span class="hl_char">(</span><span class="hl_quote">'C:\proverka.txt'</span><span class="hl_char">,</span>GENERIC_READ<span class="hl_char">,</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;nil<span class="hl_char">,</span>&nbsp;OPEN_ALWAYS<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;hFile2<span class="hl_char">:</span><span class="hl_char">=</span>TrueCreateFileW<span class="hl_char">(</span><span class="hl_quote">'C:\test.pak'</span><span class="hl_char">,</span>GENERIC_WRITE<span class="hl_char">,</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;nil<span class="hl_char">,</span>&nbsp;OPEN_ALWAYS<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span><span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div>
<br><br>интересует набор флагов, используемый вами, в частности dwShareMode, который вы выставили в 0 и dwCreationDisposition  который вы выставили в OPEN_ALWAYS.<br><br>Я бы дал ссылочку на матчасть, но вы же гуру, а я тролль, и вдобавок матчасть на мсдн о ужас не на дельфе, так что я скромно промолчу.<br><br>Еще вот этот кусочек чистой магии тоже интересен (можно и вариант с FILE_BEGIN). <img src="img/smilies/s1.gif" alt=""><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">SetFilePointer<span class="hl_char">(</span>hFile1<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;nil<span class="hl_char">,</span>&nbsp;FILE_END<span class="hl_char">)</span><span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div>
<br><br>Вы как бэ только что открыли(создали) фаел. И теперь значит мы двигаем маркер. Ок, зачем?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=314867&amp;user=21411&amp;forum_n=6&amp;topic=20521&amp;page=0&amp;anchor=27" class="addthx" data-post="314867"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="28" onfocus="this.blur()" href="JavaScript:di('[b]CodeMaster[/b]','')">CodeMaster</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 9.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.64'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33320">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 ноября 2012 20:30 <br><script type="text/javascript">QU('CodeMaster','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=CodeMaster" target="_blank">Личное сообщение</a> &middot;  <a href="#28" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=20521&amp;page=0#28');return false;">#28</a> </span><div align=left><br>
<I>Alchemistry пишет:<br>Вы как бэ только что открыли(создали) фаел. И теперь значит мы двигаем маркер. Ок, зачем?  </I><br>Я могу вам объяснить задачу:<br>1. Внедряем длл в процесс Блокнот  //сделано<br>2. Из длл запускаем код перехвата CreateFileW   // сделано<br>3. Новая функция NewCreateFileW выполняет наш код:<br>3.1 Записывает имя открытого Блокнотом файла в лог // опционально,работает<br>3.2 Получает размер открытого файла по его хэндлу, устанавливает маркер на требуемое количество байт,выполняет чтение в буфер памяти  // в процессе<br>3.3 Из буфера памяти пишем данные в новый файл на диске // в процессе<br>3.4 Закрываем хэндлы,освобождаем память,выводим сообщение об успешном завершении операции
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=314868&amp;user=33320&amp;forum_n=6&amp;topic=20521&amp;page=0&amp;anchor=28" class="addthx" data-post="314868"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="29" onfocus="this.blur()" href="JavaScript:di('[b]CodeMaster[/b]','')">CodeMaster</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 9.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.64'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33320">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 ноября 2012 21:55 <br><script type="text/javascript">QU('CodeMaster','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=CodeMaster" target="_blank">Личное сообщение</a> &middot;  <a href="#29" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=20521&amp;page=0#29');return false;">#29</a> </span><div align=left><br>
Ну вот хвала яицам,всё работает в упрощенном виде:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">&nbsp;buff<span class="hl_char">:</span><span class="hl_char">=</span>GetFileSize<span class="hl_char">(</span>hFile1<span class="hl_char">,</span>nil<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;SetFilePointer<span class="hl_char">(</span>hFile1<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;nil<span class="hl_char">,</span>&nbsp;FILE_BEGIN<span class="hl_char">)</span><span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div>
<br>когда
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">hFile1<span class="hl_char">:</span><span class="hl_char">=</span>TrueCreateFileW<span class="hl_char">(</span>ЗДЕСЬ&nbsp;ВВЕДЕНО&nbsp;ИМЯ&nbsp;ФАЙЛА&nbsp;В&nbsp;КАВЫЧКАХ<span class="hl_char">,</span>GENERIC_READ<span class="hl_char">,</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;nil<span class="hl_char">,</span>&nbsp;OPEN_ALWAYS<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span><span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div>
<br>Я не могу понять,как сделать чтобы хэндл перехватываемого файла получить.<br>Иными словами,представьте что Блокнот открывает зашифрованный файл и расшифровывает его в памяти,а мы его оттуда хотим утащить.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=314874&amp;user=33320&amp;forum_n=6&amp;topic=20521&amp;page=0&amp;anchor=29" class="addthx" data-post="314874"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="30" onfocus="this.blur()" href="JavaScript:di('[b]F_a_u_s_t[/b]','')">F_a_u_s_t</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 0.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 16.12'>Активность: 0.25<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=6">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 ноября 2012 22:03 <br><script type="text/javascript">QU('F_a_u_s_t','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=F_a_u_s_t" target="_blank">Личное сообщение</a> &middot;  <a href="#30" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=20521&amp;page=0#30');return false;">#30</a> </span><div align=left><br>
<b>CodeMaster</b><br>Про ужос выше не пишу.<br><I>CodeMaster пишет:<br>Я не могу понять,как сделать чтобы хэндл перехватываемого файла получить. </I><br>Хучить сохранения файла или буффер, ваш кэп.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=314876&amp;user=6&amp;forum_n=6&amp;topic=20521&amp;page=0&amp;anchor=30" class="addthx" data-post="314876"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> .  <b>1</b> . <a href="action=vthread&amp;forum=6&amp;topic=20521&amp;page=1.html">2</a> . <a href="action=vthread&amp;forum=6&amp;topic=20521&amp;page=1.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Не работает inject dll (исходник прилагается)</span></td>
</tr></table>
</div>
<a name=newreply></a>
<div align=center>
<table class=forums>
<tr>
<td class=caption4 width="100%"><span class=header>Эта тема закрыта. Ответы больше не принимаются.</span></td>
</tr>
</table>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=20521" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
