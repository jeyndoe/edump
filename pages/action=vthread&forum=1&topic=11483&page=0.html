<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Снятие HASP HL Envelope. Есть ли скрипты для восстановления импорта ? - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Столкнулся с тем, что по уроку «Распаковка конверта HASP/HASP_HL/HARDLOCK» от s0cpy не получается снять конверт на проге защищённой HASP HL. Перечитал тему «И снова HASP Envelope». Импорт подгаженный частично. Видимо многие">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=8344'>Magister Yoda</a>, <a target='_blank' href='?action=userinfo&amp;user=41556'>subword</a> (+9 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/green.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=1&sortBy=0&page=0.html"><b>Основной форум</b></a> <b class=bulletHead>&#8212;&#8250;</b> Снятие HASP HL Envelope. Есть ли скрипты для восстановления импорта ?</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> .  <b>1</b> . <a href="action=vthread&amp;forum=1&amp;topic=11483&amp;page=1.html">2</a> . <a href="action=vthread&amp;forum=1&amp;topic=11483&amp;page=1.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]ToBad[/b]','')">ToBad</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/702.gif" alt=""><br><span class=txtSm>Ранг: 450.3 (мудрец), 13thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.67'>Активность: 0.2<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=702">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 14 марта 2008 01:00 <br><script type="text/javascript">QU('ToBad','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ToBad" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=11483&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Столкнулся с тем, что по уроку «Распаковка конверта HASP/HASP_HL/HARDLOCK» от s0cpy не получается снять конверт на проге защищённой HASP HL. Перечитал тему «И снова HASP Envelope». Импорт подгаженный частично. Видимо многие встречались с подобным, но как я понял из темы, вариант восстановления импорта только ручной предлагается. Вопрос в том, есть ли на паблике скрипты облегчающие восстановления импорта после конверта или автоматизирующие всё что делалось ранее в уроке s0cpy ?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=182920&amp;user=702&amp;forum_n=1&amp;topic=11483&amp;page=0&amp;anchor=1" class="addthx" data-post="182920"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]AlexVel[/b]','')">AlexVel</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 43.2 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.82'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2596">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 14 марта 2008 09:03 <br><script type="text/javascript">QU('AlexVel','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=AlexVel" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=11483&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
На паблике скриптов не встречал. В приватах есть.<br>Вообще конверты HASP HL можно разделить на 2 группы: старые (которые были сделаны инструментами из HASP_HL_CD_1.00 и HASP_HL_CD_1.10) и новые (HASP_HL_CD_1.20 и HASP_HL_CD_1.30).<br>В &quot;старых&quot; конвертах импорт в определенном месте(сразу после декриптовки секций) чистенький  и никаких телодвижений не требуется (все по статье). В &quot;новых&quot; импорт изначально идет загаженным (переходники). Кроме того в импорте новых конвертов есть еще и эмулируемые функции (мне известно как минимум 6 функций, которые эмулируются)
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=182941&amp;user=2596&amp;forum_n=1&amp;topic=11483&amp;page=0&amp;anchor=2" class="addthx" data-post="182941"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]Rustem[/b]','')">Rustem</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 74.1 (постоянный), 34thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.41'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1301">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 14 марта 2008 13:49 <br><script type="text/javascript">QU('Rustem','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Rustem" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=11483&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
<b>ToBad</b><br>Восстанови импорт руками. Там не так сложно. Можно полуавтоматизировать
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=182963&amp;user=1301&amp;forum_n=1&amp;topic=11483&amp;page=0&amp;anchor=3" class="addthx" data-post="182963"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]ToBad[/b]','')">ToBad</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/702.gif" alt=""><br><span class=txtSm>Ранг: 450.3 (мудрец), 13thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.67'>Активность: 0.2<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=702">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 14 марта 2008 14:51 <br><script type="text/javascript">QU('ToBad','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ToBad" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=11483&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
<b>AlexVel</b> у меня видимо новый конверт.<br><br><I><b>Rustem</b> пишет:<br>Восстанови импорт руками. Там не так сложно. Можно полуавтоматизировать </I><br><br>Как полуавтоматизировать ? Функций которые нужно восстановить около 98. Пытался оттрейсить несколько, получилось на одной... Долго по коду прыгал... На второй не вышло. Основная проблема в том, что в момент вызова второй функции программа переходит в DX режим. Экран 640х480, переключится в отладчик нельзя. Когда уже всё полностью загружено, переключится и восстановить режим можно, но тогда уже не вызываются некоторые функции... Я уже думал как нибудь применить керберос. Например мониторить kernel32, а в Ольге вести лог в файл при обращении к переходникам. Потом смотреть по времени вызова после какого переходника какая была вызвана функция... Хотя гиморно я придумал, жаль что скрипты не пишу и плохо Ольгой владею, всё наверняка проще...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=182973&amp;user=702&amp;forum_n=1&amp;topic=11483&amp;page=0&amp;anchor=4" class="addthx" data-post="182973"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]Iron[/b]','')">Iron</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 3.2 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.33'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=15861">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 14 марта 2008 15:01 <br><script type="text/javascript">QU('Iron','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Iron" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=11483&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
У меня есть флешка-видяшка и тутор по снятию НАSP_HL envelоpe.Оба на английском. Могу поделиться.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=182975&amp;user=15861&amp;forum_n=1&amp;topic=11483&amp;page=0&amp;anchor=5" class="addthx" data-post="182975"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]ToBad[/b]','')">ToBad</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/702.gif" alt=""><br><span class=txtSm>Ранг: 450.3 (мудрец), 13thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.67'>Активность: 0.2<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=702">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 14 марта 2008 15:42 <br><script type="text/javascript">QU('ToBad','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ToBad" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=11483&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
<I><b>Iron</b> пишет:<br>У меня есть флешка-видяшка и тутор по снятию НАSP_HL envelоpe.Оба на английском. Могу поделиться. </I><br><br>Давай конечно !
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=182983&amp;user=702&amp;forum_n=1&amp;topic=11483&amp;page=0&amp;anchor=6" class="addthx" data-post="182983"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]AlexVel[/b]','')">AlexVel</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 43.2 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.82'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2596">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 14 марта 2008 16:22 <br><script type="text/javascript">QU('AlexVel','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=AlexVel" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=11483&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
Лучше все таки изучить и написать скриптик под Olly. Там ничего сложного нет.<br>И в дальнейшем пригодится (как скриптик, так и знания).<br>А вообще скрипт получается очень простой (с объвлением переменных и прочей лабудой всего строк на 50).<br>Но скрипт не решает проблемы с эмулируемыми функциями.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=182986&amp;user=2596&amp;forum_n=1&amp;topic=11483&amp;page=0&amp;anchor=7" class="addthx" data-post="182986"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]Iron[/b]','')">Iron</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 3.2 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.33'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=15861">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 14 марта 2008 16:40 &middot; Поправил: Iron <br><script type="text/javascript">QU('Iron','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Iron" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=11483&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
Флешка весит 8 метров,в аттач не влезла.Она на рапиде имеется:<br><br>rapidshare.de/files/38454954/HASPHL_ENVELOPE_SCORM.rar.html &lt;--</a> <br><br>Если не покатит могу почтой отправить<br><br><img src="img/attach.gif" alt=""> <a href="./files/3ae0_14.03.2008_CRACKLAB.rU.tgz">3ae0_14.03.2008_CRACKLAB.rU.tgz</a> - HASP-HL_CRACK.rar
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=182989&amp;user=15861&amp;forum_n=1&amp;topic=11483&amp;page=0&amp;anchor=8" class="addthx" data-post="182989"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]s0cpy[/b]','')">s0cpy</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 146.7 (ветеран), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.36'>Активность: 0.07<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1407">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 14 марта 2008 17:31 <br><script type="text/javascript">QU('s0cpy','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=s0cpy" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=11483&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
<b>Iron</b><br>все это годиться к <I>старые (которые были сделаны инструментами из HASP_HL_CD_1.00 и HASP_HL_CD_1.10) </I> и для конвертов HASP_4...<br><b>AlexVel</b><br><I>А вообще скрипт получается очень простой (с объвлением переменных и прочей лабудой всего строк на 50).  </I><br>ну 50 это че та много... ;)<br>а с эмулируемыми функами не так все сложно...<br>в принципе как вариант, ставим бряк на GetCommandLineA (одна из эмулируемых), упали и смотрим, куда будет &quot;записан&quot; результат выполнения функи. Если в тело секции .protect, то это оно... Трассируем дальше - будут выполняться остальные эмулируемые функи, и их результаты будут писаться в область рядом с результатами GetCommandLineA... Ну а потом собственно практически все прозрачно становиться, за исключением GetTickCount кажется (щас на вскидку не помню тонкостей)...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=182994&amp;user=1407&amp;forum_n=1&amp;topic=11483&amp;page=0&amp;anchor=9" class="addthx" data-post="182994"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]ToBad[/b]','')">ToBad</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/702.gif" alt=""><br><span class=txtSm>Ранг: 450.3 (мудрец), 13thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.67'>Активность: 0.2<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=702">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 24 марта 2008 01:43 <br><script type="text/javascript">QU('ToBad','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ToBad" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=11483&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
Делал так:<br>Все нераспознанные места в импорте ведут на одну функцию которая большая, сложная и очень замученная. По её ходу если трейсить выполняется много левых функций в нескольких потоках и в итоге пробегает одна искомая. Иногда трейслог проходит за пару секунд и весит несколько десяток килобайт, иногда на 10-15 минут и весит 20-30 мб. Всё одна и таже процедурка. Делал всё очень гиморным способом. На входе в эту процедуру делал переназначение на вызов функции _msg из собственной длл, в параметрах вычислял и передавал адрес ячейки импорта откуда пошол вызов. К процессу цеплял kerberos и мониторил kernel32, user32 и свою dll. По логу смотрел что идёт после вызова моей функции. Таким образом восстановил 35 функций, ещё с 3-4 есть вопросы. Написал скриптик который прописывает в нужное место импорта адреса на найденные функи. Скрипт примерно такой:<br><br><code>gpa &quot;CreateFileA&quot;,&quot;kernel32.dll&quot;<br>mov [006840B0],&#036;RESULT<br>gpa &quot;TlsSetValue&quot;,&quot;kernel32.dll&quot;<br>mov [00684130],&#036;RESULT<br>gpa &quot;LoadIconA&quot;,&quot;user32.dll&quot;<br>mov [0068421C],&#036;RESULT<br></code><br><br>Теперь собственно вопрос. Осталось много не распознанных функций, но они при запуске и моих действиях не выполняются. Если я сделаю дамп и оставлю всё так как есть, то это будет запуск до поры до времени и очень скоро всё сбойнёт. Не знаю как быть. Вот что получилось в итоге, ещё масса функций...<br>Может можно как то интуитивно <img src="img/smilies/s1.gif" alt=""> где и что идёт в импорте ? Или я не правильным путём пошол ?<br><br><code>00684000  7373FC55  DDRAW.DirectDrawCreate<br>00684004  7373DBCC  DDRAW.DirectDrawEnumerateExA<br>00684008  00000000<br>0068400C  73ED4C43  DSOUND.DirectSoundCreate<br>00684010  00000000<br>00684014  003B00A0<br>00684018  77F16000  GDI32.CreateCompatibleDC<br>0068401C  003B00B0<br>00684020  77F16E98  GDI32.DeleteDC<br>00684024  003B00C0<br>00684028  003B00C8<br>0068402C  003B00D0<br>00684030  003B00D8<br>00684034  003B00E0<br>00684038  77F161E1  GDI32.GetStockObject<br>0068403C  003B00F0<br>00684040  003B00F8<br>00684044  00000000<br>00684048  003B0148<br>0068404C  7C809BF8  kernel32.MultiByteToWideChar<br>00684050  7C81AB58  kernel32.GetConsoleMode<br>00684054  003B0160<br>00684058  003B0168<br>0068405C  003B0170<br>00684060  7C80CCA8  kernel32.LCMapStringW<br>00684064  003B0180<br>00684068  7C80A490  kernel32.GetStringTypeW<br>0068406C  7C81CB65  kernel32.WriteConsoleA<br>00684070  003B0198<br>00684074  7C83538C  kernel32.WriteConsoleW<br>00684078  7C873FF3  kernel32.GetConsoleCP<br>0068407C  7C80A427  kernel32.QueryPerformanceCounter<br>00684080  7C812ED0  kernel32.GetEnvironmentStringsW<br>00684084  7C814AA7  kernel32.FreeEnvironmentStringsW<br>00684088  003B01C8<br>0068408C  7C81D5F7  kernel32.FreeEnvironmentStringsA<br>00684090  7C834FC7  kernel32.GetTimeZoneInformation<br>00684094  7C80A0D4  kernel32.WideCharToMultiByte<br>00684098  7C81109B  kernel32.IsValidCodePage<br>0068409C  003B01F0<br>006840A0  003B01F8<br>006840A4  003B0200<br>006840A8  003B0208<br>006840AC  003B0210<br>006840B0  7C801A24  kernel32.CreateFileA<br>006840B4  003B0220<br>006840B8  003B0228<br>006840BC  003B0230<br>006840C0  003B0238<br>006840C4  003B0240<br>006840C8  7C80180E  kernel32.ReadFile<br>006840CC  7C80180E  kernel32.ReadFile<br>006840D0  7C809B47  kernel32.CloseHandle<br>006840D4  7C80A017  kernel32.SetEvent<br>006840D8  7C802520  kernel32.WaitForSingleObject<br>006840DC  003B0270<br>006840E0  003B0278<br>006840E4  7C802442  kernel32.Sleep<br>006840E8  7C809EF1  kernel32.InitializeCriticalSection<br>006840EC  7C91188A  ntdll.RtlDeleteCriticalSection<br>006840F0  7C9010ED  ntdll.RtlLeaveCriticalSection<br>006840F4  7C901005  ntdll.RtlEnterCriticalSection<br>006840F8  7C859DCC  kernel32.OutputDebugStringA<br>006840FC  003B02B0<br>00684100  003B02B8<br>00684104  7C80B4CF  kernel32.GetModuleFileNameA<br>00684108  003B02C8<br>0068410C  7C910331  ntdll.RtlGetLastWin32Error<br>00684110  7C910340  ntdll.RtlSetLastWin32Error<br>00684114  003B02E0<br>00684118  003B02E8<br>0068411C  7C835FE5  kernel32.SetCurrentDirectoryA<br>00684120  003B02F8<br>00684124  7C801625  kernel32.DeviceIoControl<br>00684128  003B0308<br>0068412C  003B0310<br>00684130  7C809BC5  kernel32.TlsSetValue<br>00684134  7C809740  kernel32.TlsGetValue<br>00684138  7C812D67  kernel32.TlsAlloc<br>0068413C  003B0330<br>00684140  003B0338<br>00684144  7C809915  kernel32.GetACP<br>00684148  003B0348<br>0068414C  003B0350<br>00684150  7C80ADA0  kernel32.GetProcAddress<br>00684154  003B0360<br>00684158  7C80B6A1  kernel32.GetModuleHandleA<br>0068415C  003B0370<br>00684160  003B0378<br>00684164  7C80ABDE  kernel32.FreeLibrary<br>00684168  003B0388<br>0068416C  003B0390<br>00684170  7C9105D4  ntdll.RtlAllocateHeap<br>00684174  7C80ABC1  kernel32.GetProcessHeap<br>00684178  7C91043D  ntdll.RtlFreeHeap<br>0068417C  7C9179FD  ntdll.RtlReAllocateHeap<br>00684180  003B03B8<br>00684184  003B03C0<br>00684188  7C80BFAD  kernel32.ReleaseSemaphore<br>0068418C  003B03D0<br>00684190  7C937A40  ntdll.RtlUnwind<br>00684194  003B03E0<br>00684198  7C80929C  kernel32.GetTickCount<br>0068419C  003B03F0<br>006841A0  003B03F8<br>006841A4  003B0400<br>006841A8  7C81015E  kernel32.SetUnhandledExceptionFilter<br>006841AC  003B0410<br>006841B0  003B0418<br>006841B4  003B0420<br>006841B8  003B0428<br>006841BC  7C812AA6  kernel32.GetVersionExA<br>006841C0  7C910331  ntdll.RtlGetLastWin32Error<br>006841C4  003B0440<br>006841C8  7C809766  kernel32.InterlockedIncrement<br>006841CC  7C809728  kernel32.GetCurrentThreadId<br>006841D0  7C80977A  kernel32.InterlockedDecrement<br>006841D4  7C9109ED  ntdll.RtlSizeHeap<br>006841D8  003B0468<br>006841DC  7C812B7E  kernel32.HeapCreate<br>006841E0  003B0478<br>006841E4  003B0480<br>006841E8  7C812F01  kernel32.GetStdHandle<br>006841EC  7C80CC97  kernel32.SetHandleCount<br>006841F0  7C810E21  kernel32.GetFileType<br>006841F4  7C812E3E  kernel32.GetCPInfo<br>006841F8  7C809915  kernel32.GetACP<br>006841FC  7C81276F  kernel32.GetOEMCP<br>00684200  00000000<br>00684204  77D3C97C  USER32.PeekMessageA<br>00684208  77D3A8BD  USER32.wsprintfA<br>0068420C  77D3D4FE  USER32.DefWindowProcA<br>00684210  77D44C51  USER32.PostQuitMessage<br>00684214  003B0020<br>00684218  77D3EF79  USER32.LoadCursorA<br>0068421C  77D40946  USER32.LoadIconA<br>00684220  77D3C02B  USER32.SetWindowPos<br>00684224  77D3B6BE  USER32.GetClientRect<br>00684228  77D38FAD  USER32.GetSystemMetrics<br>0068422C  77D4179F  USER32.EnumDisplayDevicesA<br>00684230  77D4A62B  USER32.ChangeDisplaySettingsExA<br>00684234  003B0060<br>00684238  003B0068<br>0068423C  77D3F3C3  USER32.GetAsyncKeyState<br>00684240  77D38C06  USER32.TranslateMessage<br>00684244  77D396C8  USER32.DispatchMessageA<br>00684248  77D3D668  USER32.GetActiveWindow<br>0068424C  77D3FFA8  USER32.CreateWindowExA<br>00684250  77D3D8B4  USER32.ShowWindow<br>00684254  00000000<br>00684258  76B3BA77  WINMM.waveOutSetVolume<br>0068425C  00000000<br>00684260  774EEE46  ole32.CoUninitialize<br>00684264  774F2A44  ole32.CoInitialize<br>00684268  00000000<br>0068426C  10006D80  zlib1.inflateEnd<br>00684270  100057A0  zlib1.inflate<br>00684274  10005640  zlib1.inflateInit_<br></code><br><br>Лог примерно такой получается после обработки:<br><br><code>00684144-VirtualAlloc-GetACP-InterlockedIncrement-GetTickCount-CreateF ileA-LocalAlloc-DeviceIoControl-LocalFree-CloseHandle-CreateFileA<br>00684108-VirtualAlloc-GetTickCount-InterlockedIncrement-GetTickCount-I nterlockedDecrement-GetTickCount-VirtualFree-QueryPerformanceCounter<br>006841C0-VirtualAlloc-GetLastError-InterlockedIncrement-GetTickCount-I nterlockedDecrement-VirtualFree-GetProcessHeap-HeapAlloc<br>006841DC-VirtualAlloc-GetTickCount-InterlockedIncrement-GetTickCount-I nterlockedDecrement-HeapCreate-VirtualFree-GetModuleHandleA<br>00684138-VirtualAlloc-GetTickCount-InterlockedIncrement-GetTickCount-I nterlockedDecrement-TlsAlloc-VirtualFree<br>00684138-VirtualAlloc-GetTickCount-InterlockedIncrement-GetTickCount-I nterlockedDecrement-TlsAlloc-VirtualFree-HeapAlloc-TlsGetValue<br>006841C0-VirtualAlloc-GetLastError-InterlockedIncrement-GetTickCount-I nterlockedDecrement-VirtualFree-HeapAlloc-GetStdHandle<br>006841B8-VirtualAlloc-InterlockedIncrement-GetTickCount-InterlockedDec rement-VirtualFree<br>006840D0-VirtualAlloc-GetTickCount-InterlockedIncrement-GetTickCount-I nterlockedDecrement-CloseHandle-VirtualFree-HeapAlloc-HeapFree<br>0068421C-VirtualAlloc-GetTickCount-InterlockedIncrement-GetTickCount-I nterlockedDecrement-LoadIconA-VirtualFree-LoadCursorA<br>00684214-VirtualAlloc-GetTickCount-InterlockedIncrement-GetTickCount-I nterlockedDecrement-RegisterClassA-VirtualFree-CreateWindowExA<br>00684250-VirtualAlloc-GetTickCount-InterlockedIncrement-GetTickCount-I nterlockedDecrement-ShowWindow-VirtualFree-GetLastError<br></code>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=184101&amp;user=702&amp;forum_n=1&amp;topic=11483&amp;page=0&amp;anchor=10" class="addthx" data-post="184101"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]AlexVel[/b]','')">AlexVel</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 43.2 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.82'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2596">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 24 марта 2008 10:15 <br><script type="text/javascript">QU('AlexVel','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=AlexVel" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=11483&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
Нда. Мы не ищем легких путей, а делаем все через ж..у<br>Если вызывается АПИ функция, то в некотором месте должен проскакивать ее адрес? Логично ?<br>Твоя задача просто найти такое место. И автоматом прогнать ВСЕ функции из импорта (всю табличку переходников)<br>через <I>одну функцию которая большая, сложная и очень замученная</I> (или через другую функцию - которая поменьше и вызывается из этой большой).<br>Подправляешь, натравливаешь imprec - и у тебя нормальный импорт.<br>Таким образом восстановишь почти все функции (кроме эмулируемых -коих всего то MAX=6 шт).<br>А эмулируемые функции уже ручками в imprec назначишь.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=184114&amp;user=2596&amp;forum_n=1&amp;topic=11483&amp;page=0&amp;anchor=11" class="addthx" data-post="184114"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]AlexVel[/b]','')">AlexVel</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 43.2 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.82'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2596">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 24 марта 2008 10:22 &middot; Поправил: AlexVel <br><script type="text/javascript">QU('AlexVel','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=AlexVel" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=11483&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
Посмотри сюда:<br><I>00684170 7C9105D4 ntdll.RtlAllocateHeap<br>00684174 7C80ABC1 kernel32.GetProcessHeap<br>00684178 7C91043D ntdll.RtlFreeHeap<br>0068417C 7C9179FD ntdll.RtlReAllocateHeap<br>00684180 003B03B8<br>00684184 003B03C0<br>00684188 7C80BFAD kernel32.ReleaseSemaphore<br>0068418C 003B03D0<br>00684190 7C937A40 ntdll.RtlUnwind</I><br>видно, что ты криво распознал импорт. функции из ntdll перемешаны с kernel32<br>Согласись, что это подозрительно. Т.е. наверняка не правильно. <br>Вообще редкие Ring3 приложения имеют в импорте ntdll<br>Да и разделения (00000000) между библами не наблюдается, в отличие от<br><I>...<br>00684250 77D3D8B4 USER32.ShowWindow<br>00684254 00000000<br>00684258 76B3BA77 WINMM.waveOutSetVolume<br>0068425C 00000000</I>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=184115&amp;user=2596&amp;forum_n=1&amp;topic=11483&amp;page=0&amp;anchor=12" class="addthx" data-post="184115"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]s0cpy[/b]','')">s0cpy</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 146.7 (ветеран), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.36'>Активность: 0.07<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1407">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 24 марта 2008 11:04 <br><script type="text/javascript">QU('s0cpy','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=s0cpy" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=11483&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
скрипт для восстановления импорта (кроме эмулируемых ф-ций) в аттаче...<br>сначало откройте в каком-нть вьювере и ознакомьтесь. скрипт требует для своей работы некоторую инфу...<br>возникнут вопросы - пишите...<br><b>ToBad</b><br><I>одну функцию которая большая, сложная и очень замученная</I> - ну уж не такая она и страшная... ;)<br>немного почистить обфускацию и все понятно становиться...<br><br><br><img src="img/attach.gif" alt=""> <a href="./files/7197_24.03.2008_CRACKLAB.rU.tgz">7197_24.03.2008_CRACKLAB.rU.tgz</a> - hhl_env_1.2x_1.3x_iatresolver.rar
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=184117&amp;user=1407&amp;forum_n=1&amp;topic=11483&amp;page=0&amp;anchor=13" class="addthx" data-post="184117"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]AlexVel[/b]','')">AlexVel</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 43.2 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.82'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2596">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 24 марта 2008 12:11 <br><script type="text/javascript">QU('AlexVel','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=AlexVel" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=11483&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
<b>AlexVel</b><br><I>А вообще скрипт получается очень простой (с объявлением переменных и прочей лабудой всего строк на 50).</I><br><b>s0cpy</b><br><I>ну 50 это че та много... ;) </I><br>А у самого-то около 80 строк <img src="img/smilies/s2.gif" alt=""><br>Да и у пользователя достаточно спросить только <b>start address of IAT</b><br>А то сейчас тебе вопросы посыплются - а что вводить на запросы скрипта <img src="img/smilies/s2.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=184125&amp;user=2596&amp;forum_n=1&amp;topic=11483&amp;page=0&amp;anchor=14" class="addthx" data-post="184125"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]s0cpy[/b]','')">s0cpy</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 146.7 (ветеран), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.36'>Активность: 0.07<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1407">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 24 марта 2008 12:50 &middot; Поправил: s0cpy <br><script type="text/javascript">QU('s0cpy','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=s0cpy" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=11483&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
<b>AlexVel</b><br><I>А у самого-то около 80 строк </I> - ну поспешил с выводом... <img src="img/smilies/s2.gif" alt=""><br>сорри...<br><br><I>Да и у пользователя достаточно спросить только start address of IAT<br>А то сейчас тебе вопросы посыплются - а что вводить на запросы скрипта </I><br>у тех кто с пониманием все делает, я думаю вопросов не должно возникнуть...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=184126&amp;user=1407&amp;forum_n=1&amp;topic=11483&amp;page=0&amp;anchor=15" class="addthx" data-post="184126"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]ToBad[/b]','')">ToBad</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/702.gif" alt=""><br><span class=txtSm>Ранг: 450.3 (мудрец), 13thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.67'>Активность: 0.2<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=702">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 24 марта 2008 13:32 <br><script type="text/javascript">QU('ToBad','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ToBad" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=11483&amp;page=0#16');return false;">#16</a> </span><div align=left><br>
<I><b>AlexVel</b> пишет:<br>Посмотри сюда:<br>00684170 7C9105D4 ntdll.RtlAllocateHeap<br>00684174 7C80ABC1 kernel32.GetProcessHeap<br>00684178 7C91043D ntdll.RtlFreeHeap<br>0068417C 7C9179FD ntdll.RtlReAllocateHeap<br>00684180 003B03B8<br>00684184 003B03C0<br>00684188 7C80BFAD kernel32.ReleaseSemaphore<br>0068418C 003B03D0<br>00684190 7C937A40 ntdll.RtlUnwind<br>видно, что ты криво распознал импорт. функции из ntdll перемешаны с kernel32<br>Согласись, что это подозрительно. Т.е. наверняка не правильно.  </I><br><br>Я распознавал пока только с kernel32 и user32. В том то и дело, что импорт это оригинальный. Вот он без распознанных функций:<br><br><code>00684000  7373FC55  DDRAW.DirectDrawCreate<br>00684004  7373DBCC  DDRAW.DirectDrawEnumerateExA<br>00684008  00000000<br>0068400C  73ED4C43  DSOUND.DirectSoundCreate<br>00684010  00000000<br>00684014  003B00A0<br>00684018  77F16000  GDI32.CreateCompatibleDC<br>0068401C  003B00B0<br>00684020  77F16E98  GDI32.DeleteDC<br>00684024  003B00C0<br>00684028  003B00C8<br>0068402C  003B00D0<br>00684030  003B00D8<br>00684034  003B00E0<br>00684038  77F161E1  GDI32.GetStockObject<br>0068403C  003B00F0<br>00684040  003B00F8<br>00684044  00000000<br>00684048  003B0148<br>0068404C  003B0150<br>00684050  7C81AB58  kernel32.GetConsoleMode<br>00684054  003B0160<br>00684058  003B0168<br>0068405C  003B0170<br>00684060  003B0178<br>00684064  003B0180<br>00684068  7C80A490  kernel32.GetStringTypeW<br>0068406C  7C81CB65  kernel32.WriteConsoleA<br>00684070  003B0198<br>00684074  7C83538C  kernel32.WriteConsoleW<br>00684078  7C873FF3  kernel32.GetConsoleCP<br>0068407C  003B01B0<br>00684080  003B01B8<br>00684084  7C814AA7  kernel32.FreeEnvironmentStringsW<br>00684088  003B01C8<br>0068408C  7C81D5F7  kernel32.FreeEnvironmentStringsA<br>00684090  7C834FC7  kernel32.GetTimeZoneInformation<br>00684094  003B01E0<br>00684098  7C81109B  kernel32.IsValidCodePage<br>0068409C  003B01F0<br>006840A0  003B01F8<br>006840A4  003B0200<br>006840A8  003B0208<br>006840AC  003B0210<br>006840B0  003B0218<br>006840B4  003B0220<br>006840B8  003B0228<br>006840BC  003B0230<br>006840C0  003B0238<br>006840C4  003B0240<br>006840C8  003B0248<br>006840CC  003B0250<br>006840D0  003B0258<br>006840D4  7C80A017  kernel32.SetEvent<br>006840D8  7C802520  kernel32.WaitForSingleObject<br>006840DC  003B0270<br>006840E0  003B0278<br>006840E4  003B0280<br>006840E8  7C809EF1  kernel32.InitializeCriticalSection<br>006840EC  7C91188A  ntdll.RtlDeleteCriticalSection<br>006840F0  7C9010ED  ntdll.RtlLeaveCriticalSection<br>006840F4  7C901005  ntdll.RtlEnterCriticalSection<br>006840F8  7C859DCC  kernel32.OutputDebugStringA<br>006840FC  003B02B0<br>00684100  003B02B8<br>00684104  003B02C0<br>00684108  003B02C8<br>0068410C  7C910331  ntdll.RtlGetLastWin32Error<br>00684110  7C910340  ntdll.RtlSetLastWin32Error<br>00684114  003B02E0<br>00684118  003B02E8<br>0068411C  7C835FE5  kernel32.SetCurrentDirectoryA<br>00684120  003B02F8<br>00684124  7C801625  kernel32.DeviceIoControl<br>00684128  003B0308<br>0068412C  003B0310<br>00684130  003B0318<br>00684134  003B0320<br>00684138  003B0328<br>0068413C  003B0330<br>00684140  003B0338<br>00684144  003B0340<br>00684148  003B0348<br>0068414C  003B0350<br>00684150  003B0358<br>00684154  003B0360<br>00684158  003B0368<br>0068415C  003B0370<br>00684160  003B0378<br>00684164  7C80ABDE  kernel32.FreeLibrary<br>00684168  003B0388<br>0068416C  003B0390<br>00684170  7C9105D4  ntdll.RtlAllocateHeap<br>00684174  7C80ABC1  kernel32.GetProcessHeap<br>00684178  7C91043D  ntdll.RtlFreeHeap<br>0068417C  7C9179FD  ntdll.RtlReAllocateHeap<br>00684180  003B03B8<br>00684184  003B03C0<br>00684188  7C80BFAD  kernel32.ReleaseSemaphore<br>0068418C  003B03D0<br>00684190  7C937A40  ntdll.RtlUnwind<br>00684194  003B03E0<br>00684198  003B03E8<br>0068419C  003B03F0<br>006841A0  003B03F8<br>006841A4  003B0400<br>006841A8  003B0408<br>006841AC  003B0410<br>006841B0  003B0418<br>006841B4  003B0420<br>006841B8  003B0428<br>006841BC  003B0430<br>006841C0  003B0438<br>006841C4  003B0440<br>006841C8  7C809766  kernel32.InterlockedIncrement<br>006841CC  003B0450<br>006841D0  7C80977A  kernel32.InterlockedDecrement<br>006841D4  7C9109ED  ntdll.RtlSizeHeap<br>006841D8  003B0468<br>006841DC  003B0470<br>006841E0  003B0478<br>006841E4  003B0480<br>006841E8  003B0488<br>006841EC  7C80CC97  kernel32.SetHandleCount<br>006841F0  003B0498<br>006841F4  003B04A0<br>006841F8  003B04A8<br>006841FC  7C81276F  kernel32.GetOEMCP<br>00684200  00000000<br>00684204  003B0000<br>00684208  77D3A8BD  USER32.wsprintfA<br>0068420C  77D3D4FE  USER32.DefWindowProcA<br>00684210  77D44C51  USER32.PostQuitMessage<br>00684214  003B0020<br>00684218  003B0028<br>0068421C  003B0030<br>00684220  77D3C02B  USER32.SetWindowPos<br>00684224  77D3B6BE  USER32.GetClientRect<br>00684228  003B0048<br>0068422C  003B0050<br>00684230  003B0058<br>00684234  003B0060<br>00684238  003B0068<br>0068423C  77D3F3C3  USER32.GetAsyncKeyState<br>00684240  77D38C06  USER32.TranslateMessage<br>00684244  77D396C8  USER32.DispatchMessageA<br>00684248  77D3D668  USER32.GetActiveWindow<br>0068424C  003B0090<br>00684250  003B0098<br>00684254  00000000<br>00684258  76B3BA77  WINMM.waveOutSetVolume<br>0068425C  00000000<br>00684260  774EEE46  ole32.CoUninitialize<br>00684264  774F2A44  ole32.CoInitialize<br>00684268  00000000<br>0068426C  10006D80  zlib1.inflateEnd<br>00684270  100057A0  zlib1.inflate<br>00684274  10005640  zlib1.inflateInit_<br></code><br><br><I><b>s0cpy</b> пишет:<br>скрипт для восстановления импорта (кроме эмулируемых ф-ций) в аттаче...<br>сначало откройте в каком-нть вьювере и ознакомьтесь. скрипт требует для своей работы некоторую инфу...<br>возникнут вопросы - пишите...  </I><br><br>Большое спасибо !!! Буду изучать и прибывать. О результате отпишу обязательно.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=184129&amp;user=702&amp;forum_n=1&amp;topic=11483&amp;page=0&amp;anchor=16" class="addthx" data-post="184129"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]AlexVel[/b]','')">AlexVel</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 43.2 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.82'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2596">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 24 марта 2008 22:00 &middot; Поправил: AlexVel <br><script type="text/javascript">QU('AlexVel','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=AlexVel" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=11483&amp;page=0#17');return false;">#17</a> </span><div align=left><br>
Еще раз говорю. В импорте не должно быть ntdll<br>Например:<br><I>006840EC 7C91188A ntdll.RtlDeleteCriticalSection<br>006840F0 7C9010ED ntdll.RtlLeaveCriticalSection<br>006840F4 7C901005 ntdll.RtlEnterCriticalSection</I><br>На самом деле это (и в таблице импорта они должны выглядеть так):<br>kernel32.DeleteCriticalSection<br>kernel32.LeaveCriticalSection<br>kernel32.EnterCriticalSection<br>которые просто являются переходниками к ntdll<br>Я думаю что Imprec тебе их покажет именно в таком виде.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=184200&amp;user=2596&amp;forum_n=1&amp;topic=11483&amp;page=0&amp;anchor=17" class="addthx" data-post="184200"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]ToBad[/b]','')">ToBad</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/702.gif" alt=""><br><span class=txtSm>Ранг: 450.3 (мудрец), 13thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.67'>Активность: 0.2<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=702">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 марта 2008 10:11 <br><script type="text/javascript">QU('ToBad','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ToBad" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=11483&amp;page=0#18');return false;">#18</a> </span><div align=left><br>
<I><b>AlexVel</b> пишет:<br>В импорте не должно быть ntdll <br>Я думаю что Imprec тебе их покажет именно в таком виде. </I><br><br>Да, ты совершенно прав, теперь после импрека импорт без ntdll.<br><br><b>s0cpy</b> - Большое спасибо за скрипт ! Он очень помог. Всё что нужно было скрипту для работы - понял без проблем. Написано доходчиво.<br><br>Я хочу поблагодарить всех кто помогал мне советами, туторами, информацией и разумеется скриптом. Очень помогло то, что почти каждый ваш комментарий вселял надежду на то, что задача эта не из ряда сложных и что всё просто. Это помогло не бросить тогда, когда было сложно...<br>На данный момент дамп снят, импорт восстановлен, лишние секции удалены и жертва работает. Как и сказано было ранее, оставалось 6 эмулируемых функций. Где то по передаваемым параметрам, где то по функциям до и после эмулируемой, я вычислил 5: GetTickCount, GetProcAddress, ExitProcess, GetCommandLineA, GetModuleHandleA. Шестая не вызывается пока, работает всё и без неё. Думаю её будет легко узнать по примерам вызова (если кто знает - намекните):<br><br><code>CALL DWORD PTR DS:[68416C]<br>TEST EAX,80000000<br>JB 0061782D</code><br><br>и<br><br><code>PUSH ESI<br>CALL DWORD PTR DS:[68416C]<br>MOV ESI,EAX<br>MOV EAX,DWORD PTR DS:[6B6B68]<br>TEST EAX,EAX<br>JE 00617034<br><br>00617034    MOV DWORD PTR DS:[6B6B68],1<br>CALL 006328E6<br><br>006328E6 PUSH EBX<br>PUSH ESI<br>PUSH 006B7727 ; ASCII &quot;kernel32.dll&quot;<br>XOR EBX,EBX<br>JB 00605D89<br>CALL DWORD PTR DS:[684160] ; kernel32.LoadLibraryA<br></code>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=184259&amp;user=702&amp;forum_n=1&amp;topic=11483&amp;page=0&amp;anchor=18" class="addthx" data-post="184259"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]s0cpy[/b]','')">s0cpy</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 146.7 (ветеран), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.36'>Активность: 0.07<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1407">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 марта 2008 11:27 <br><script type="text/javascript">QU('s0cpy','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=s0cpy" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=11483&amp;page=0#19');return false;">#19</a> </span><div align=left><br>
<b>ToBad</b><br><I>CALL DWORD PTR DS:[68416C]<br>TEST EAX,80000000<br>JB 0061782D </I> - похоже на GetVersion...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=184267&amp;user=1407&amp;forum_n=1&amp;topic=11483&amp;page=0&amp;anchor=19" class="addthx" data-post="184267"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="20" onfocus="this.blur()" href="JavaScript:di('[b]ToBad[/b]','')">ToBad</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/702.gif" alt=""><br><span class=txtSm>Ранг: 450.3 (мудрец), 13thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.67'>Активность: 0.2<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=702">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 марта 2008 13:54 &middot; Поправил: ToBad <br><script type="text/javascript">QU('ToBad','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ToBad" target="_blank">Личное сообщение</a> &middot;  <a href="#20" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=11483&amp;page=0#20');return false;">#20</a> </span><div align=left><br>
<I><b>s0cpy</b> пишет:<br>похоже на GetVersion </I><br><br>Да, точно, гугл показал по поиску &quot;GetVersion TEST EAX, 80000000&quot; что это проверка на Win98.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=184290&amp;user=702&amp;forum_n=1&amp;topic=11483&amp;page=0&amp;anchor=20" class="addthx" data-post="184290"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="21" onfocus="this.blur()" href="JavaScript:di('[b]ToBad[/b]','')">ToBad</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/702.gif" alt=""><br><span class=txtSm>Ранг: 450.3 (мудрец), 13thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.67'>Активность: 0.2<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=702">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 марта 2008 18:43 <br><script type="text/javascript">QU('ToBad','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ToBad" target="_blank">Личное сообщение</a> &middot;  <a href="#21" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=11483&amp;page=0#21');return false;">#21</a> </span><div align=left><br>
Сегодня детально разобрался в работе скрипта и потренировался поделать это вручную. Действительно всё очень просто ! Так же посмотрел свои старые трейслоги... Блин всё перед носом было, а я выбрал самый гиморный и бесперспективный способ... Сейчас оглядываюсь назад на проделанную работу и думаю сколько времени убито зря и как я только такой бред выдумал... Стыдно мне... <img src="img/smilies/s14.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=184329&amp;user=702&amp;forum_n=1&amp;topic=11483&amp;page=0&amp;anchor=21" class="addthx" data-post="184329"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="22" onfocus="this.blur()" href="JavaScript:di('[b]AlexVel[/b]','')">AlexVel</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 43.2 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.82'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2596">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 марта 2008 23:16 <br><script type="text/javascript">QU('AlexVel','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=AlexVel" target="_blank">Личное сообщение</a> &middot;  <a href="#22" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=11483&amp;page=0#22');return false;">#22</a> </span><div align=left><br>
<I>оставалось 6 эмулируемых функций. Где то по передаваемым параметрам, где то по функциям до и после эмулируемой, я вычислил 5: GetTickCount, GetProcAddress, ExitProcess, GetCommandLineA, GetModuleHandleA.</I><br>Уверен, что правильно вычислил ?<br>Насчет GetProcAddress, GetVersion, GetCommandLineA - согласен.<br>А вот насчет GetTickCount, ExitProcess, GetModuleHandleA - не уверен, что эти функции эмулируются
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=184357&amp;user=2596&amp;forum_n=1&amp;topic=11483&amp;page=0&amp;anchor=22" class="addthx" data-post="184357"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="23" onfocus="this.blur()" href="JavaScript:di('[b]ToBad[/b]','')">ToBad</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/702.gif" alt=""><br><span class=txtSm>Ранг: 450.3 (мудрец), 13thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.67'>Активность: 0.2<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=702">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 марта 2008 14:47 <br><script type="text/javascript">QU('ToBad','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ToBad" target="_blank">Личное сообщение</a> &middot;  <a href="#23" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=11483&amp;page=0#23');return false;">#23</a> </span><div align=left><br>
<I><b>AlexVel</b> пишет:<br>А вот насчет GetTickCount, ExitProcess, GetModuleHandleA - не уверен, что эти функции эмулируются </I><br><br>ExitProcess думаю точно, вот место:<br><br><code>0041826A    68 090400C0     PUSH C0000409<br>0041826F    FF15 8C845300   CALL DWORD PTR DS:[53848C]               ; <b>kernel32.ExitProcess</b><br>00418275    50              PUSH EAX<br>00418276    FF15 88845300   CALL DWORD PTR DS:[538488]               ; kernel32.TerminateProcess<br>0041827C    C9              LEAVE<br>0041827D    C3              RETN<br></code><br><br>GetTickCount определил тут (конечно есть сомнения, но уже в двух снятых конвертах работает, да и это место недалеко от OEP):<br><br><code>004185EE    50              PUSH EAX<br>004185EF    FF15 A8845300   CALL DWORD PTR DS:[5384A8]               ; kernel32.GetSystemTimeAsFileTime<br>004185F5    8B75 FC         MOV ESI,DWORD PTR SS:[EBP-4]<br>004185F8    3375 F8         XOR ESI,DWORD PTR SS:[EBP-8]<br>004185FB    FF15 50845300   CALL DWORD PTR DS:[538450]               ; <b>kernel32.GetTickCount</b><br>00418601    33F0            XOR ESI,EAX<br>00418603    FF15 A4845300   CALL DWORD PTR DS:[5384A4]               ; kernel32.GetCurrentThreadId<br>00418609    33F0            XOR ESI,EAX<br>0041860B    FF15 A0845300   CALL DWORD PTR DS:[5384A0]               ; kernel32.GetTickCount<br>00418611    33F0            XOR ESI,EAX<br>00418613    8D45 F0         LEA EAX,DWORD PTR SS:[EBP-10]<br>00418616    50              PUSH EAX<br>00418617    FF15 9C845300   CALL DWORD PTR DS:[53849C]               ; kernel32.QueryPerformanceCounter<br>0041861D    8B45 F4         MOV EAX,DWORD PTR SS:[EBP-C]<br>00418620    3345 F0         XOR EAX,DWORD PTR SS:[EBP-10]<br>00418623    33F0            XOR ESI,EAX<br>00418625    3BF7            CMP ESI,EDI<br>00418627    75 07           JNZ SHORT test1.00418630<br></code>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=184414&amp;user=702&amp;forum_n=1&amp;topic=11483&amp;page=0&amp;anchor=23" class="addthx" data-post="184414"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="24" onfocus="this.blur()" href="JavaScript:di('[b]Kiev78[/b]','')">Kiev78</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 67.4 (постоянный), 6thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.92'>Активность: 0.05<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=12727">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 марта 2008 21:56 &middot; Поправил: Kiev78 <br><script type="text/javascript">QU('Kiev78','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Kiev78" target="_blank">Личное сообщение</a> &middot;  <a href="#24" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=11483&amp;page=0#24');return false;">#24</a> </span><div align=left><br>
---
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=184454&amp;user=12727&amp;forum_n=1&amp;topic=11483&amp;page=0&amp;anchor=24" class="addthx" data-post="184454"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="25" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 марта 2008 22:08 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#25" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=11483&amp;page=0#25');return false;">#25</a> </span><div align=left><br>
ГетТикКаунт гораздо больше похож на снятии большой энтропии для чего-нить типа сида для псевдорандома, ну да ладно.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=184457&amp;user=1556&amp;forum_n=1&amp;topic=11483&amp;page=0&amp;anchor=25" class="addthx" data-post="184457"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="26" onfocus="this.blur()" href="JavaScript:di('[b]Kiev78[/b]','')">Kiev78</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 67.4 (постоянный), 6thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.92'>Активность: 0.05<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=12727">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 марта 2008 22:24 &middot; Поправил: Kiev78 <br><script type="text/javascript">QU('Kiev78','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Kiev78" target="_blank">Личное сообщение</a> &middot;  <a href="#26" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=11483&amp;page=0#26');return false;">#26</a> </span><div align=left><br>
---
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=184460&amp;user=12727&amp;forum_n=1&amp;topic=11483&amp;page=0&amp;anchor=26" class="addthx" data-post="184460"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="27" onfocus="this.blur()" href="JavaScript:di('[b]ToBad[/b]','')">ToBad</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/702.gif" alt=""><br><span class=txtSm>Ранг: 450.3 (мудрец), 13thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.67'>Активность: 0.2<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=702">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 марта 2008 23:38 <br><script type="text/javascript">QU('ToBad','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ToBad" target="_blank">Личное сообщение</a> &middot;  <a href="#27" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=11483&amp;page=0#27');return false;">#27</a> </span><div align=left><br>
<I><b>Kiev78</b> пишет:<br>Ты точно ничего не путаешь? </I><br><br>Конечно могу путать, но думаю конкретно в этом месте это не критично. <img src="img/smilies/s1.gif" alt=""><br>Насчёт двух записей одной функции мне тоже интересно узнать...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=184466&amp;user=702&amp;forum_n=1&amp;topic=11483&amp;page=0&amp;anchor=27" class="addthx" data-post="184466"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="28" onfocus="this.blur()" href="JavaScript:di('[b]PE_Kill[/b]','')">PE_Kill</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3232.gif" alt=""><br><span class=txtSm>Ранг: 793.4 <font color=magenta>(<b>! !</b>)</font>, 568thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.59'>Активность: 0.74<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3232">Участник</a><br><font color=blue>Шаман</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 марта 2008 01:11 <br><script type="text/javascript">QU('PE_Kill','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=PE_Kill" target="_blank">Личное сообщение</a> &middot;  <a href="#28" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=11483&amp;page=0#28');return false;">#28</a> </span><div align=left><br>
<I>Kiev78 пишет:<br>реальность наличия 2 записей в ИАТ (по адресам 538450 и 5384A0) для одной АПИ! Мне кажется, автор скорее всего ошибся, или может ошибаюсь я? </I><br>Вполне реально. Delphi например может одну и туже апи и 10 и 20 раз в иат записать. Это всё из за модульности при проектировании и изъяны ООП.
<br><br><font size="1"><i>-----<br>Yann Tiersen best and do not fuck</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=184473&amp;user=3232&amp;forum_n=1&amp;topic=11483&amp;page=0&amp;anchor=28" class="addthx" data-post="184473"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="29" onfocus="this.blur()" href="JavaScript:di('[b]Kiev78[/b]','')">Kiev78</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 67.4 (постоянный), 6thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.92'>Активность: 0.05<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=12727">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 марта 2008 07:15 &middot; Поправил: Kiev78 <br><script type="text/javascript">QU('Kiev78','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Kiev78" target="_blank">Личное сообщение</a> &middot;  <a href="#29" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=11483&amp;page=0#29');return false;">#29</a> </span><div align=left><br>
---
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=184484&amp;user=12727&amp;forum_n=1&amp;topic=11483&amp;page=0&amp;anchor=29" class="addthx" data-post="184484"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="30" onfocus="this.blur()" href="JavaScript:di('[b]AlexVel[/b]','')">AlexVel</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 43.2 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.82'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2596">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 марта 2008 10:09 &middot; Поправил: AlexVel <br><script type="text/javascript">QU('AlexVel','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=AlexVel" target="_blank">Личное сообщение</a> &middot;  <a href="#30" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=11483&amp;page=0#30');return false;">#30</a> </span><div align=left><br>
<I>Delphi например может одну и туже апи и 10 и 20 раз в иат записать. Это всё из за модульности при проектировании и изъяны ООП.</I><br>В данном случае не то что модуль один, так еще и функция одна:<br><I>004185EE 50 PUSH EAX<br>004185EF FF15 A8845300 CALL DWORD PTR DS:[5384A8] ; kernel32.GetSystemTimeAsFileTime<br>004185F5 8B75 FC MOV ESI,DWORD PTR SS:[EBP-4]<br>004185F8 3375 F8 XOR ESI,DWORD PTR SS:[EBP-8]<br>004185FB FF15 50845300 CALL DWORD PTR DS:[538450] ; kernel32.GetTickCount<br>00418601 33F0 XOR ESI,EAX<br>00418603 FF15 A4845300 CALL DWORD PTR DS:[5384A4] ; kernel32.GetCurrentThreadId<br>00418609 33F0 XOR ESI,EAX<br>0041860B FF15 A0845300 CALL DWORD PTR DS:[5384A0] ; kernel32.GetTickCount<br>00418611 33F0 XOR ESI,EAX<br>00418613 8D45 F0 LEA EAX,DWORD PTR SS:[EBP-10]<br>00418616 50 PUSH EAX<br>00418617 FF15 9C845300 CALL DWORD PTR DS:[53849C] ; kernel32.QueryPerformanceCounter</I><br>Вывод: эмулируемая функция идентифицирована НЕ ПРАВИЛЬНО.<br>Вообще-то в данном случае это без сомнения фунция GetCurrentProcessId<br>Ну и ExitProcess соответственно тоже НЕ ПРАВИЛЬНО <img src="img/smilies/s2.gif" alt="">  :<br><I>0041826A 68 090400C0 PUSH C0000409<br>0041826F FF15 8C845300 CALL DWORD PTR DS:[53848C] ; kernel32.ExitProcess<br>00418275 50 PUSH EAX<br>00418276 FF15 88845300 CALL DWORD PTR DS:[538488] ; kernel32.TerminateProcess<br>0041827C C9 LEAVE<br>0041827D C3 RETN</I><br>Вместо ExitProcess д.б. некоторая функция, которая вернула -бы в EAX (т.к. видим последующий вызов TerminateProcess)<br>HANDLE процесса. Думаю, что догадаться не просто, а очень просто
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=184489&amp;user=2596&amp;forum_n=1&amp;topic=11483&amp;page=0&amp;anchor=30" class="addthx" data-post="184489"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> .  <b>1</b> . <a href="action=vthread&amp;forum=1&amp;topic=11483&amp;page=1.html">2</a> . <a href="action=vthread&amp;forum=1&amp;topic=11483&amp;page=1.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/green.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=1&sortBy=0&page=0.html"><b>Основной форум</b></a> <b class=bulletHead>&#8212;&#8250;</b> Снятие HASP HL Envelope. Есть ли скрипты для восстановления импорта ?</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#31" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="1">
<input type="hidden" name="topic" value="11483">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=11483" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
