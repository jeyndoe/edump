<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Аналог hModule своей dll.. - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Непонятное я название темы придумал конечно... Вобщем проблема такая: Есть лоадер и dll. dll записана в виде массива байтов внутрь лоадера. Загружается это безобразие через WPM. Короче говоря: загрузка есть, но нету hModule">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b> (+5 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Аналог hModule своей dll..</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]Troll[/b]','')">Troll</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 12.0 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.77'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=13487">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 октября 2007 14:06 <br><script type="text/javascript">QU('Troll','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Troll" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=10081.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Непонятное я название темы придумал конечно...<br>Вобщем проблема такая:<br>Есть лоадер и dll.<br>dll записана в виде массива байтов внутрь лоадера. Загружается это безобразие через WPM.<br>Короче говоря: загрузка есть, но нету hModule разумеется.<br>А мне надо брать что-то, что может сообщить моей dll &quot;аналог этого hModule&quot;<br>Дело в том что я записывал патч через GetModuleFileName, сейчас это неработает.<br>Также есть проблема с хуками. GetModuleHandle(NULL) не берёт у меня приложение которое я хукаю.<br>Что мне не годится - чтение registry.. Если есть соображения на этот счёт просьба отписаться.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=161109&amp;user=13487&amp;forum_n=6&amp;topic=10081.html&amp;page=0&amp;anchor=1" class="addthx" data-post="161109"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]Alexey Suda-Chen[/b]','')">Alexey Suda-Chen</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.9 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.83'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=13193">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 октября 2007 14:25 <br><script type="text/javascript">QU('Alexey Suda-Chen','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Alexey Suda-Chen" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=10081.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
void *GetHmodule() { return (void*)((size_t)&amp;GetHmodule)&amp;~0x0ffff); }
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=161113&amp;user=13193&amp;forum_n=6&amp;topic=10081.html&amp;page=0&amp;anchor=2" class="addthx" data-post="161113"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]seeq[/b]','')">seeq</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/3067.jpg" alt=""><br><span class=txtSm>Ранг: 105.9 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.64'>Активность: 0.06<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3067">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 октября 2007 14:33 <br><script type="text/javascript">QU('seeq','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=seeq" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=10081.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
<b>Troll</b><br>кроме непонятного названия темы, ты еще ее и непонятно описал проблему.<br>Что такое WPM?<br>Из того, что я понял: ты дллку  загружаешь в ручную, т.е. без Loadlibrary.  Если хочешь, что б заработали функции с hModule внеси инфу о своей dll&#039;ке в PEB.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=161116&amp;user=3067&amp;forum_n=6&amp;topic=10081.html&amp;page=0&amp;anchor=3" class="addthx" data-post="161116"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]asd[/b]','')">asd</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 162.2 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.58'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3241">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 октября 2007 14:39 &middot; Поправил: asd <br><script type="text/javascript">QU('asd','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=asd" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=10081.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
Бред какой-то и нифига не понятно, что тебе надо.<br>hModule численно равен стартовому адресу загрузки модуля.<br>Остальное вообще не понял, что надо. Если тебе нужно просто вызвать дллмайн, то можно её передать начальный адрес загрузки модуля. если хочеш, чтобы с этой длл работали виндовые ф-ии - придётся повозиться.<br><br>add Опередили<img src="img/smilies/s1.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=161117&amp;user=3241&amp;forum_n=6&amp;topic=10081.html&amp;page=0&amp;anchor=4" class="addthx" data-post="161117"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]Troll[/b]','')">Troll</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 12.0 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.77'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=13487">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 октября 2007 14:49 &middot; Поправил: Troll <br><script type="text/javascript">QU('Troll','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Troll" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=10081.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
Да, загружаю вручную. Нет, нельзя мне трогать PEB.. Мне его как-раз таки необходимо было очищать.<br>DllMain вызывается, здесь нет проблем. Я имею ввиду что.. Ай, вот внизу приведу что мне необходимо.<br>Вот-<br>GetModuleFileName(hinstDLL,MyHackDirectory,255);<br>Это раз. Тоесть мне нужно как-то просто получить патч. Как я сказал чтение регистра непоходит.<br>Несрабатывает хук приложения с использованием GetModuleHandle... нету базы.<br>Просто, как я могу это сделать, без hModule моей dll... Возможные варианты<br><br><br><img src="img/smilies/s15.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=161120&amp;user=13487&amp;forum_n=6&amp;topic=10081.html&amp;page=0&amp;anchor=5" class="addthx" data-post="161120"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]S_T_A_S_[/b]','')">S_T_A_S_</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 163.7 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.87'>Активность: 0.07<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=251">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 октября 2007 01:09 <br><script type="text/javascript">QU('S_T_A_S_','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=S_T_A_S_" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=10081.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
GetModuleFileName как раз и берет путь из PEB.LdrData, поэтому не работает для твоего модуля. Пиши подробнее.<br><br><I>Alexey Suda-Chen пишет:<br>void *GetHmodule() { return (void*)((size_t)&amp;GetHmodule)&amp;~0x0ffff); } </I><br>В солидных продуктах можно применить и правильный метод <img src="img/smilies/s1.gif" alt=""> www.google.com/search?q=__ImageBase
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=161374&amp;user=251&amp;forum_n=6&amp;topic=10081.html&amp;page=0&amp;anchor=6" class="addthx" data-post="161374"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]UsAr[/b]','')">UsAr</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 66.8 (постоянный)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.14'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1854">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 октября 2007 10:31 <br><script type="text/javascript">QU('UsAr','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=UsAr" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=10081.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
<b>Troll</b>, можно взять за hModule любое значение, например 0BADC0DEh, и в хуке GetModuleFileName проверять этот параметр, если он 0BADC0DEh, то возврящать то что надо. Если нет, то выполнять оригинальный GetModuleFileName
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=161408&amp;user=1854&amp;forum_n=6&amp;topic=10081.html&amp;page=0&amp;anchor=7" class="addthx" data-post="161408"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]Troll[/b]','')">Troll</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 12.0 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.77'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=13487">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 октября 2007 15:33 <br><script type="text/javascript">QU('Troll','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Troll" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=10081.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
<b>UsAr</b> непонял..<br>Да мне лишь бы как нибудь передать от лоадера патч.. надо уже в DllMain&#039;е его прочитать. Слышал его переадают как третий аргумент lpReserved.<br>Наверное я однако неверно выражаюсь насчёт этого hModule.. Просто у меня были хуки которые требовали свой модуль, но я их сменил, так что мне надо только патч.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=161453&amp;user=13487&amp;forum_n=6&amp;topic=10081.html&amp;page=0&amp;anchor=8" class="addthx" data-post="161453"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]Prince[ART][/b]','')">Prince[ART]</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 16.2 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.8'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=13323">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 октября 2007 22:03 <br><script type="text/javascript">QU('Prince[ART]','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Prince[ART]" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=10081.html&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
<I>Troll пишет:<br>Загружается это безобразие через WPM. </I><br>Кто-нибудь знает еще кроме ТопикСтартера, что это за такой за WPM? – а то он упорно молчит и игнорирует вопросы общественности<br><I>seeq пишет:<br>Что такое WPM? </I><br>ужаснах как тоже стало интересно, плз кто знает, объясните или дайте линк напочитать про этот WPM?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=161517&amp;user=13323&amp;forum_n=6&amp;topic=10081.html&amp;page=0&amp;anchor=9" class="addthx" data-post="161517"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]Troll[/b]','')">Troll</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 12.0 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.77'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=13487">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 октября 2007 22:29 <br><script type="text/javascript">QU('Troll','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Troll" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=10081.html&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
WriteProcessMemory <img src="img/smilies/s5.gif" alt=""> Всё же понятно..<br>Создаётся образ dll, в котором восстанавливаются релоки, импорт, далее это проецируется на процесс, с вызовом DllMain и DLL_PROCESS_ATTACH
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=161522&amp;user=13487&amp;forum_n=6&amp;topic=10081.html&amp;page=0&amp;anchor=10" class="addthx" data-post="161522"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]Prince[ART][/b]','')">Prince[ART]</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 16.2 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.8'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=13323">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 октября 2007 23:45 &middot; Поправил: Prince[ART] <br><script type="text/javascript">QU('Prince[ART]','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Prince[ART]" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=10081.html&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
<b>Troll</b><br>гы, лольная тема! короче, вот что тебе написал UsAr мне понятно, а что ты пишешь хз что это за такое вообще за буквы<br>проще говоря - возьми эту длл засунь в ресурсы этого лоадера, потом скинь на диск в виде <br>путь_имя_dll = GetTempPath + lstrcat (…,имя_dll); // путь к длл - типа постоянная строковая константа<br>LoadResource_dll(FindResource+LoadResource+LockResource+SizeofResource  +CreateFile(путь_имя_dll)+WriteFile+CloseHandle); // так делают все кому надо чтобы длл находилась в теле *.exe<br>И потом когда требуется патч в любом месте вызывай GetTempPath + lstrcat (…,имя_dll);// и при удалении тоже<br>Если на диск скидывать нельзя, тогда пробуй как написал UsAr, по-другому<br><I>S_T_A_S_ пишет:<br>Пиши подробнее. </I><br>А лучше показывай код или еще лучше прицепи аттач со свои лоадером+ключи от дома<br><br>гыгы, можно еще тупо в DllMain перебрать/поискать и сравнить имя этого лоадера с запущенными процессами, если совпало копипастим путь к этому лоадеру, ну как-то так…
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=161532&amp;user=13323&amp;forum_n=6&amp;topic=10081.html&amp;page=0&amp;anchor=11" class="addthx" data-post="161532"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]UsAr[/b]','')">UsAr</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 66.8 (постоянный)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.14'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1854">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 октября 2007 09:29 <br><script type="text/javascript">QU('UsAr','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=UsAr" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=10081.html&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
<b>Troll</b>, ну тогда в томже процессе выделяется память, куда записывается путь.<br>И передавать указатель на этот путь через какое-нибудь неиспользуемое поле в TEB&#039;e/PEB&#039;e. Например есть TEB.Unknown по смещению F88h, вроде как никто их не использует.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=161598&amp;user=1854&amp;forum_n=6&amp;topic=10081.html&amp;page=0&amp;anchor=12" class="addthx" data-post="161598"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]Troll[/b]','')">Troll</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 12.0 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.77'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=13487">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 октября 2007 14:41 <br><script type="text/javascript">QU('Troll','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Troll" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=10081.html&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
На диск скидывать нельзя. Я уже делал через CreateFile-WriteFile, этот метод неподходит. И в ресурсах мою длл тоже нельзя держать. <br><br>Я уже нашёл как это сделать.<br>Передаю при загрузке длл в аргумент lpReserved свою структуру. Параметры которой беру от лоадера.<br>И дальше всё просто.<br>GetFullPathName(lpReserved-&gt;path,MAX_PATH,buffer,&amp;strip);
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=161630&amp;user=13487&amp;forum_n=6&amp;topic=10081.html&amp;page=0&amp;anchor=13" class="addthx" data-post="161630"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]S_T_A_S_[/b]','')">S_T_A_S_</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 163.7 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.87'>Активность: 0.07<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=251">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 октября 2007 00:22 &middot; Поправил: S_T_A_S_ <br><script type="text/javascript">QU('S_T_A_S_','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=S_T_A_S_" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=10081.html&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
В инжектируемой dll можно объявить переменные как экспортируемые, найти их адрес перед инжектом, и записать туда что нужно. Другой вариант - ехе с релоками инжектирует сам себя, при этом все уже инициализированные переменные будут скопированы (только аккуратно с хендлами и поинтерами)
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=161735&amp;user=251&amp;forum_n=6&amp;topic=10081.html&amp;page=0&amp;anchor=14" class="addthx" data-post="161735"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]Troll[/b]','')">Troll</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 12.0 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.77'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=13487">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 октября 2007 19:50 <br><script type="text/javascript">QU('Troll','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Troll" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=10081.html&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
Верно. Только я уже вобщем-то справился способом описанным выше..<br>Извините ребята, конечно название темы совсем не подходящее было выбрано, дело в том что я использовал хуки, которые требовали мой модуль, но метод я сменил, так что вобщем-то проблем больше нет...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=161854&amp;user=13487&amp;forum_n=6&amp;topic=10081.html&amp;page=0&amp;anchor=15" class="addthx" data-post="161854"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Аналог hModule своей dll..</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#16" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="6">
<input type="hidden" name="topic" value="10081">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=10081" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
