<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Как вставить в код новую процедуру. - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Мне необходимо вставить свою процедуру в код программы. Процедура это копия оригинальной, с небольшими изменениям. Т.к. пустого места было не достаточно, я делал все как указано здесь http://exelab.ru/rar/htm.php?n=084 , т.е.">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=28016'>asfa</a>, <a target='_blank' href='?action=userinfo&amp;user=8605'>Rio</a>, <a target='_blank' href='?action=userinfo&amp;user=41701'>_MBK_</a>, <a target='_blank' href='?action=userinfo&amp;user=41144'>Adler</a> (+9 невидимых)</b></span>
</td>
</tr>
</table>

 

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/nub.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=5&sortBy=0&page=0.html"><b>Вопросы новичков</b></a> <b class=bulletHead>&#8212;&#8250;</b> Как вставить в код новую процедуру.</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]yarcom[/b]','')">yarcom</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 3.2 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.11'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=35085">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 июня 2013 06:22 <br><script type="text/javascript">QU('yarcom','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=yarcom" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=21818.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Мне необходимо вставить свою процедуру в код программы. Процедура это копия оригинальной, с небольшими изменениям. Т.к. пустого места было не достаточно, я делал все как указано здесь http://exelab.ru/rar/htm.php?n=084 , т.е. создавал новую секцию, менял точку входа и т.д.  <br>Вопрос который меня немного смущает. Это то что Олли перестал воспринимать оригинальную секцию кода как код... Хотя программа работает и запускается. И еще один неприятный момент. Когда я в свою новую секцию вставляю копию оригинальной процедуры (binary copy- binary paste) , то при всей одинаковости байт, у меня все вызовы вложенных процедур (call адрес) указывают на совершенно левые места. Я смутно догадываюсь от чего это может быть, но как с этим бороться  не понимаю.  Прошу помощи.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=325800&amp;user=35085&amp;forum_n=5&amp;topic=21818.html&amp;page=0&amp;anchor=1" class="addthx" data-post="325800"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]plutos[/b]','')">plutos</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/4773.png" alt=""><br><span class=txtSm>Ранг: 622.6 (<b>!</b>), 521thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.16'>Активность: 0.33<span style='color:green'>&nearr;</span>0.89</span><br>Статус: <a href="action=userinfo&amp;user=4773">Участник</a><br><font color=blue>_Вечный_Студент_</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 июня 2013 06:42 <br><script type="text/javascript">QU('plutos','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=plutos" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=21818.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
Может стоит почитать немного теории о структуре PE file? Благо о ней написано более, чем достаточно.
<br><br><font size="1"><i>-----<br>Give me a HANDLE and I will move the Earth.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=325801&amp;user=4773&amp;forum_n=5&amp;topic=21818.html&amp;page=0&amp;anchor=2" class="addthx" data-post="325801"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]zxcoder[/b]','')">zxcoder</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 0.6 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.18'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=34761">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 июня 2013 06:42 &middot; Поправил: zxcoder <br><script type="text/javascript">QU('zxcoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=zxcoder" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=21818.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
<i class=x>&gt;Это то что Олли перестал воспринимать оригинальную секцию кода как код</i><br>Олли смотрит на BaseOfCode и SizeOfCode в PE заголовке<br><i class=x> &gt;(call адрес) указывают на совершенно левые места</i><br>call может быть как абсолютным (указывается точный адрес перехода), так и относительным (смещение относительно адреса call&#039;a )
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=325802&amp;user=34761&amp;forum_n=5&amp;topic=21818.html&amp;page=0&amp;anchor=3" class="addthx" data-post="325802"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]yarcom[/b]','')">yarcom</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 3.2 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.11'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=35085">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 июня 2013 06:50 <br><script type="text/javascript">QU('yarcom','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=yarcom" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=21818.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
<I>plutos пишет:<br>Может стоит почитать немного теории о структуре PE file? Благо о ней написано более, чем достаточно.  </I><br>Да читал я, даже видео смотрел! Однако там обычно голая теория, перевести в практику ее пока не получается. Поэтому и задаю вопрос в ветку для новичков. Ответы по существу  пожалуйста...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=325803&amp;user=35085&amp;forum_n=5&amp;topic=21818.html&amp;page=0&amp;anchor=4" class="addthx" data-post="325803"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]crypto[/b]','')">crypto</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 188.1 (ветеран), 419thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.61'>Активность: 0.14<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=8210">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 июня 2013 08:31 <br><script type="text/javascript">QU('crypto','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=crypto" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=21818.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
<b>yarcom</b><br>Если изменений немного, то можно попытаться найти &quot;пустые&quot; места в коде и вставлять туда новый код (кусками с jmp-ами на следующий кусок).
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=325804&amp;user=8210&amp;forum_n=5&amp;topic=21818.html&amp;page=0&amp;anchor=5" class="addthx" data-post="325804"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]yarcom[/b]','')">yarcom</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 3.2 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.11'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=35085">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 июня 2013 08:44 &middot; Поправил: yarcom <br><script type="text/javascript">QU('yarcom','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=yarcom" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=21818.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
<I>crypto пишет:<br>Если изменений немного, то можно попытаться найти &quot;пустые&quot; места в коде и вставлять туда новый код (кусками с jmp-ами на следующий кусок).  </I><br>А может существует способ расширить уже имеющуюся секцию кода?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=325805&amp;user=35085&amp;forum_n=5&amp;topic=21818.html&amp;page=0&amp;anchor=6" class="addthx" data-post="325805"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]reversecode[/b]','')">reversecode</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/15381.gif" alt=""><br><span class=txtSm>Ранг: 1053.6 <b><u>(!!!!)</u></b>, 1078thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.43'>Активность: 1.06<span style='color:red'>&searr;</span>0.81</span><br>Статус: <a href="action=userinfo&amp;user=15381">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 июня 2013 08:49 <br><script type="text/javascript">QU('reversecode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=reversecode" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=21818.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
конечно!<br>нужно только будет поправить все релоки
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=325806&amp;user=15381&amp;forum_n=5&amp;topic=21818.html&amp;page=0&amp;anchor=7" class="addthx" data-post="325806"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]yarcom[/b]','')">yarcom</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 3.2 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.11'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=35085">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 июня 2013 09:17 &middot; Поправил: yarcom <br><script type="text/javascript">QU('yarcom','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=yarcom" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=21818.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
<I>reversecode пишет:<br>конечно!<br>нужно только будет поправить все релоки  </I> Чуточку подробнее если можно.  Или ссылку на инструкцию именно к такому случаю. И еще такой момент, даст ли мне это какие-нибудь преимущества по сравнению с созданием новой секции?  Потому как не могу понять в чем причина, но моя &quot;внешняя&quot; функция не работает так как стандартная, хотя все ссылки call переделал на исходные. Т.е. при одинаковом вызове, делаю new origin на моей процедуре, все выполняется также, кроме того что где-то в недрах ntdll выходит непонятный ексепшн. На стандартной все нормально...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=325807&amp;user=35085&amp;forum_n=5&amp;topic=21818.html&amp;page=0&amp;anchor=8" class="addthx" data-post="325807"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]ClockMan[/b]','')">ClockMan</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/17432.jpg" alt=""><br><span class=txtSm>Ранг: 568.2 (<b>!</b>), 464thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.99'>Активность: 0.55<span style='color:green'>&nearr;</span>0.57</span><br>Статус: <a href="action=userinfo&amp;user=17432">Участник</a><br><font color=blue>оптимист</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 июня 2013 09:52 <br><script type="text/javascript">QU('ClockMan','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ClockMan" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=21818.html&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
<I>reversecode пишет:<br>нужно только будет поправить все релоки </I><br>причём релоки к обычному CALL вызову?<br><I>yarcom пишет:<br>о при всей одинаковости байт, у меня все вызовы вложенных процедур (call адрес) указывают на совершенно левые места </I><br>потомучто СALL вызова идут относительно секции кода,для рипанья и вставки кода есть спец плагины для олли.
<br><br><font size="1"><i>-----<br>Чтобы правильно задать вопрос, нужно знать большую часть  ответа. Р.Шекли.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=325808&amp;user=17432&amp;forum_n=5&amp;topic=21818.html&amp;page=0&amp;anchor=9" class="addthx" data-post="325808"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]Zorn[/b]','')">Zorn</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 53.9 (постоянный), 19thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.25'>Активность: 0.04<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=4376">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 июня 2013 09:57 <br><script type="text/javascript">QU('Zorn','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Zorn" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=21818.html&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
<I>yarcom пишет:<br>Процедура это копия оригинальной, с небольшими изменениям. </I><br>Если изменения действительно небольшие, то почему просто не пропатчить эту процедуру ?<br>Для мест где необходима вставка кода можно делать прыжки на код вставленный в пустое место туда/обратно (с исполнением затертых инструкций). <br>И еще не понятно зачем менять точку входа.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=325809&amp;user=4376&amp;forum_n=5&amp;topic=21818.html&amp;page=0&amp;anchor=10" class="addthx" data-post="325809"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]reversecode[/b]','')">reversecode</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/15381.gif" alt=""><br><span class=txtSm>Ранг: 1053.6 <b><u>(!!!!)</u></b>, 1078thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.43'>Активность: 1.06<span style='color:red'>&searr;</span>0.81</span><br>Статус: <a href="action=userinfo&amp;user=15381">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 июня 2013 10:14 &middot; Поправил: reversecode <br><script type="text/javascript">QU('reversecode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=reversecode" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=21818.html&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
<I>ClockMan пишет:<br>причём релоки к обычному CALL вызову? </I><br>он хотел расширить секцию кода что бы вставить свой код в средину,<br>что нужно будет сделать со всем кодом ниже вставки?) править релоки... не один мегабайт <img src="img/smilies/s5.gif" alt=""><br><br><I>yarcom пишет:<br>Просто конец надо немного растянуть...  </I><br>на баш? <img src="img/smilies/s5.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=325810&amp;user=15381&amp;forum_n=5&amp;topic=21818.html&amp;page=0&amp;anchor=11" class="addthx" data-post="325810"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]yarcom[/b]','')">yarcom</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 3.2 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.11'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=35085">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 июня 2013 10:19 &middot; Поправил: yarcom <br><script type="text/javascript">QU('yarcom','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=yarcom" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=21818.html&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
<I>Zorn пишет:<br>Для мест где необходима вставка кода можно делать прыжки на код вставленный в пустое место туда/обратно (с исполнением затертых инструкций). </I><br>не подходит, процедура одна для запуска кучи плагинов, а мне надо конкретный, при условии что остальные тоже будут запускаться. <br><br><I>Zorn пишет: И еще не понятно зачем менять точку входа. </I> Просто делал по инструкции из статьи приведенной выше.  Пробовал не менять, но олли показывает совсем не то что хотелось бы... <br><br><I>reversecode пишет: он хотел расширить секцию кода что бы вставить свой код в средину, </I>Зачем же в середину, можно и конец. Просто конец надо немного растянуть...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=325811&amp;user=35085&amp;forum_n=5&amp;topic=21818.html&amp;page=0&amp;anchor=12" class="addthx" data-post="325811"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]reversecode[/b]','')">reversecode</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/15381.gif" alt=""><br><span class=txtSm>Ранг: 1053.6 <b><u>(!!!!)</u></b>, 1078thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.43'>Активность: 1.06<span style='color:red'>&searr;</span>0.81</span><br>Статус: <a href="action=userinfo&amp;user=15381">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 июня 2013 10:35 <br><script type="text/javascript">QU('reversecode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=reversecode" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=21818.html&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
<b>yarcom</b><br>внимательнее читайте кому и что отвечаете,<br>не надо мне приписывать ответы которые я не говорил
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=325812&amp;user=15381&amp;forum_n=5&amp;topic=21818.html&amp;page=0&amp;anchor=13" class="addthx" data-post="325812"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]yarcom[/b]','')">yarcom</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 3.2 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.11'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=35085">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 июня 2013 10:46 <br><script type="text/javascript">QU('yarcom','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=yarcom" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=21818.html&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
<I>reversecode пишет:<br>внимательнее читайте кому и что отвечаете,<br>не надо мне приписывать ответы которые я не говорил  </I>Прошу прощение, заработался. <br>Но все-таки хотелось бы услышать ответы.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=325813&amp;user=35085&amp;forum_n=5&amp;topic=21818.html&amp;page=0&amp;anchor=14" class="addthx" data-post="325813"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]ajax[/b]','')">ajax</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/8830.gif" alt=""><br><span class=txtSm>Ранг: 337.6 (мудрец), 224thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.53'>Активность: 0.21<span style='color:red'>&searr;</span>0.1</span><br>Статус: <a href="action=userinfo&amp;user=8830">Участник</a><br><font color=blue>born to be evil</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 июня 2013 15:10 <br><script type="text/javascript">QU('ajax','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ajax" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=21818.html&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
<I>yarcom пишет:<br>все вызовы вложенных процедур (call адрес) указывают на совершенно левые места </I><br>при обычных call (E8) надо править относительные адреса. при абсолютных call far (FF 15) - надо корректировать релоки, или менять их на относительные E8. да, еще вариант для абсолютных - типа call &#036;+5, pop eax, add eax,xxx, call eax
<br><br><font size="1"><i>-----<br>От многой мудрости много скорби, и умножающий знание умножает печаль</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=325816&amp;user=8830&amp;forum_n=5&amp;topic=21818.html&amp;page=0&amp;anchor=15" class="addthx" data-post="325816"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]sivorog[/b]','')">sivorog</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 49.7 (посетитель), 19thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 8.49'>Активность: 0.05<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=31142">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 июня 2013 19:04 <br><script type="text/javascript">QU('sivorog','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=sivorog" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=21818.html&amp;page=0#16');return false;">#16</a> </span><div align=left><br>
<b>yarcom</b>   возьми MultiAsm и не парься <img src="img/smilies/s1.gif" alt=""><br>плагин для Олли, всмысле.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=325828&amp;user=31142&amp;forum_n=5&amp;topic=21818.html&amp;page=0&amp;anchor=16" class="addthx" data-post="325828"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]zxcoder[/b]','')">zxcoder</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 0.6 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.18'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=34761">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 июня 2013 23:45 <br><script type="text/javascript">QU('zxcoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=zxcoder" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=21818.html&amp;page=0#17');return false;">#17</a> </span><div align=left><br>
Господа, причем тут вообще релоки ? Автору поста нужно скопировать процедуру в другую секцию, а если мы применим релоки то все call&#039;ы абсолютные в новой процедуре будут указзывать на новые  поправленные невалидные адреса, вся проблема в относительных call&#039;ax их и надо править.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=325832&amp;user=34761&amp;forum_n=5&amp;topic=21818.html&amp;page=0&amp;anchor=17" class="addthx" data-post="325832"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]ksol[/b]','')">ksol</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 102.0 (ветеран), 18thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 8.98'>Активность: 0.07<span style='color:red'>&searr;</span>0.02</span><br>Статус: <a href="action=userinfo&amp;user=29754">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 июня 2013 14:10 <br><script type="text/javascript">QU('ksol','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ksol" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=21818.html&amp;page=0#18');return false;">#18</a> </span><div align=left><br>
<b>yarcom</b><br>В плагине ODbgScript с помощью инструкций alloc, exec - ende<br>можно вставить в программу и выполнить ассемблерный код. Может вам подойдет.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=325860&amp;user=29754&amp;forum_n=5&amp;topic=21818.html&amp;page=0&amp;anchor=18" class="addthx" data-post="325860"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]sigil[/b]','')">sigil</a></b><br></div>
<img src="img/s0.gif" alt=""><br><span class=txtSm>Ранг: -2.1 (нарушитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.18'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=34797">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 июня 2013 14:31 <br><script type="text/javascript">QU('sigil','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=sigil" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=21818.html&amp;page=0#19');return false;">#19</a> </span><div align=left><br>
Я задался тем же вопросом. Вижу такой путь:<br><br>1. получить .asm из Иды.<br>2. выдрать оттуда все сегменты данных, переменные которых нужны<br>3. получить .map из Иды со всеми символами, кроме локальных.<br>4. получить болванки сегментов кода из .map заполненные nop (90h). Все символы будут метками в этих сегментах по нужным смещениям.<br>5. скомпоновать болванки сегментов кода, сегменты данных и все остальные сегменты заменённые на болванки в правильном порядке в одном .asm файле. Проследить, чтобы размеры сегментов совпадали с размерами в исходном экзешнике.<br>6. добавить туда свой сегмент кода в конце, содержащий свой ассемблерный код или stub для вызова C (если это необходимо в силу несовпадения calling convention).<br>7. скомпилировать всё это безобразие, убедиться что новом коде адреса по вызовам и переменным совпадают с адресами в оригинальном экзешнике.<br>8. откусить новый сегмент из нового экзешника, прилепить к старому экзешнику, пересчитать заголовки.<br>9. пропатчить старый код -- заменить старые вызовы на новые.<br>10. запустить всё это безобразие, убедиться что всё зависло, найти все ошибки, исправить.<br><br>Как раз пишу скрипт для осуществления 2. и 4. Вместо 1. и 2. можно также воспользоваться .map файлом для BSS сегмента (неинициализированных данных).
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=325895&amp;user=34797&amp;forum_n=5&amp;topic=21818.html&amp;page=0&amp;anchor=19" class="addthx" data-post="325895"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="20" onfocus="this.blur()" href="JavaScript:di('[b]yarcom[/b]','')">yarcom</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 3.2 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.11'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=35085">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 июня 2013 18:21 &middot; Поправил: yarcom <br><script type="text/javascript">QU('yarcom','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=yarcom" target="_blank">Личное сообщение</a> &middot;  <a href="#20" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=21818.html&amp;page=0#20');return false;">#20</a> </span><div align=left><br>
Всем спасибо. Уже сам разобрался. Сделал так:<br>1. Создал новую секцию.<br>2. Скопировал туда код процедуры. <br>3. Перебил все callы<br>4. Записал в файл. <br>5. Долго мучался с отладкой, в итоге все получилось. )
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=325952&amp;user=35085&amp;forum_n=5&amp;topic=21818.html&amp;page=0&amp;anchor=20" class="addthx" data-post="325952"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="21" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 июня 2013 18:30 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#21" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=21818.html&amp;page=0#21');return false;">#21</a> </span><div align=left><br>
Видимо, на этом можно закрыть.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=325954&amp;user=1556&amp;forum_n=5&amp;topic=21818.html&amp;page=0&amp;anchor=21" class="addthx" data-post="325954"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/nub.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=5&sortBy=0&page=0.html"><b>Вопросы новичков</b></a> <b class=bulletHead>&#8212;&#8250;</b> Как вставить в код новую процедуру.</span></td>
</tr></table>
</div>
<a name=newreply></a>
<div align=center>
<table class=forums>
<tr>
<td class=caption4 width="100%"><span class=header>Эта тема закрыта. Ответы больше не принимаются.</span></td>
</tr>
</table>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=21818" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
