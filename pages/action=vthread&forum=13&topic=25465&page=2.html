<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>VMProtect 3.2: запуcтить приложение и остановить его на указанном адресе - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Доступ к оригинальному коду приложения защищенного любым протектором до недавнего времени выполнялся довольно просто - любой дебагер с защитой от антидебага и далее дело техники, поиск ОЕП, бряк и дамп. Сейчас же протекторы">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b> (+5 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/aspro.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=13&sortBy=0&page=0.html"><b>Протекторы</b></a> <b class=bulletHead>&#8212;&#8250;</b> VMProtect 3.2: запуcтить приложение и остановить его на указанном адресе</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> <a href="action=vthread&amp;forum=13&amp;topic=25465&amp;page=1.html">&lt;&lt;</a> .  <a href="action=vthread&amp;forum=13&amp;topic=25465&amp;page=0.html">1</a> . <a href="action=vthread&amp;forum=13&amp;topic=25465&amp;page=1.html">2</a> . <b>3</b> .</b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]Vamit[/b]','')">Vamit</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/20406.jpg" alt=""><br><span class=txtSm>Ранг: 331.1 (мудрец), 561thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.3'>Активность: 0.19<span style='color:red'>&searr;</span>0.06</span><br>Статус: <a href="action=userinfo&amp;user=20406">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 22 ноября 2018 10:47 <br><script type="text/javascript">QU('Vamit','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vamit" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=25465&amp;page=2#1');return false;">#1</a> </span><div align=left><br>
Доступ к оригинальному коду приложения защищенного любым протектором до недавнего времени выполнялся довольно просто - любой дебагер с защитой от антидебага и далее дело техники, поиск ОЕП, бряк и дамп.<br>Сейчас же протекторы сделали шаг вперед и вся защита от антидебага уже не действует. Конкретный пример, вмпрот версии 3.2 + x64dbg + ScillaHide дает отрицательный результат что при прямом старте, что при аттаче. Драйверный же TitanHide на Windows 10 вообще не удается установить. Пока найдено такое решение вопроса - запуск приложения, дамп его процесса, загрузка в дебаг/дизасм и реверс кода. Довольно хорошая утилитка для этого имеется, например <noindex><a href="https://github.com/glmcdona/Process-Dump" rel="nofollow" target="_blank">--&gt; Process Dump &lt;--</a></noindex>. Но с восстановлением импорта в ней имеются недоработки, местами ломает код самого приложения, но решение тоже имеется - делать два дампа, один с импортом для дизасма, а второй без импорта для дебагера. Всё прекрасно и всё работает, основная задача получить доступ к оригинальному коду для его исследования решена. Но есть одно но, в данном случае теряется начальная инициализация статических переменных, а их первоначальное значение важно для правильного реверса кода. <b>Вопрос, имеются ли какие либо инструменты позволяющие запуcтить приложение и остановить его на указанном адресе?</b><br>Была тут одна интересная тема от Инде по поиску ЕП, но он её закрыл. В принципе, я думаю, эту задачу его визору решить по силам, только нужно изменить формулировку, не искать ОЕП, т.к. в общем случае её может и не быть, а довести приложение до заданного адреса.
<br><br><font size="1"><i>-----<br>Everything is relative...</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=389271&amp;user=20406&amp;forum_n=13&amp;topic=25465&amp;page=2&amp;anchor=1" class="addthx" data-post="389271"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]Vamit[/b]','')">Vamit</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/20406.jpg" alt=""><br><span class=txtSm>Ранг: 331.1 (мудрец), 561thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.3'>Активность: 0.19<span style='color:red'>&searr;</span>0.06</span><br>Статус: <a href="action=userinfo&amp;user=20406">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 06 декабря 2018 23:19 <br><script type="text/javascript">QU('Vamit','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vamit" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=25465&amp;page=2#2');return false;">#2</a> </span><div align=left><br>
Да вы чего, по таким трассам изучать защиту, 55 * 5078 ~= 280тыс инструкций говна, из них будет чистого кода порядка 1000 инструкций.
<br><br><font size="1"><i>-----<br>Everything is relative...</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=389670&amp;user=20406&amp;forum_n=13&amp;topic=25465&amp;page=2&amp;anchor=2" class="addthx" data-post="389670"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 337.5 (мудрец), 348thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 06 декабря 2018 23:40 &middot; Поправил: difexacaw <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=25465&amp;page=2#3');return false;">#3</a> </span><div align=left><br>
<b>gggeorggge</b><br><br>Спасибо.<br><br>Я имел ввиду иное. Такой кусок можно и отладчиком выдрать. Как оно работает в целом, в реальном времени и есчо скажите, не важны нюансы, но оно под данной тулзой доходит до запуска, тоесть пин проходит слой пакера ?<br><br><b>Добавлено спустя 16 минут</b><br><b>Vamit</b><br><br>Если оно работает, то можно свернуть.
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=389671&amp;user=40990&amp;forum_n=13&amp;topic=25465&amp;page=2&amp;anchor=3" class="addthx" data-post="389671"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]ClockMan[/b]','')">ClockMan</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/17432.jpg" alt=""><br><span class=txtSm>Ранг: 568.2 (<b>!</b>), 464thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.99'>Активность: 0.55<span style='color:green'>&nearr;</span>0.57</span><br>Статус: <a href="action=userinfo&amp;user=17432">Участник</a><br><font color=blue>оптимист</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 декабря 2018 00:12 <br><script type="text/javascript">QU('ClockMan','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ClockMan" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=25465&amp;page=2#4');return false;">#4</a> </span><div align=left><br>
<I>Vamit пишет:<br>То что ты писал - это частично и сидит оно далеко и глубоко, после микст кода, и это далеко ещё не всё, а разбирать код в середине вм не зная ни истинных регистров, ни инструкций способны только мозахисты </I><br>Ну да в небо ткнул и угадал........ только почему-то с начала года все ипутся и не могут победить антиотладку как только дерматолаг засунул сиськи под вм, а что там смотреть антидамп, проверку целостности, детект виртуал боксов? так там ничего нового......
<br><br><font size="1"><i>-----<br>Чтобы правильно задать вопрос, нужно знать большую часть  ответа. Р.Шекли.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=389672&amp;user=17432&amp;forum_n=13&amp;topic=25465&amp;page=2&amp;anchor=4" class="addthx" data-post="389672"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 337.5 (мудрец), 348thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 декабря 2018 00:32 &middot; Поправил: difexacaw <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=25465&amp;page=2#5');return false;">#5</a> </span><div align=left><br>
<b>ClockMan</b><br><br>Не нужно обобщать. Антидамп&quot;(анклав, подмена данных через их выборку) он не решил, как и никто иной, понятие ввёл я, как и саму технику. А антиотладка - просто забудь про это, используй норм инструменты.
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=389673&amp;user=40990&amp;forum_n=13&amp;topic=25465&amp;page=2&amp;anchor=5" class="addthx" data-post="389673"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]ARCHANGEL[/b]','')">ARCHANGEL</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/6336.png" alt=""><br><span class=txtSm>Ранг: 681.5 <font color=magenta>(<b>! !</b>)</font>, 405thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.85'>Активность: 0.42<span style='color:red'>&searr;</span>0.21</span><br>Статус: <a href="action=userinfo&amp;user=6336">Участник</a><br><font color=blue>ALIEN Hack Team</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 декабря 2018 01:50 <br><script type="text/javascript">QU('ARCHANGEL','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ARCHANGEL" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=25465&amp;page=2#6');return false;">#6</a> </span><div align=left><br>
<b>difexacaw</b><br><br>Не смог бы в вашем мире по понятиям я жить
<br><br><font size="1"><i>-----<br>Stuck to the plan, always think that we would stand up, never ran.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=389675&amp;user=6336&amp;forum_n=13&amp;topic=25465&amp;page=2&amp;anchor=6" class="addthx" data-post="389675"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]gggeorggge[/b]','')">gggeorggge</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 18.4 (новичок), 3thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.08'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=40819">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 декабря 2018 07:14 &middot; Поправил: gggeorggge <br><script type="text/javascript">QU('gggeorggge','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=gggeorggge" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=25465&amp;page=2#7');return false;">#7</a> </span><div align=left><br>
<I>Vamit пишет:<br>Да вы чего, по таким трассам изучать защиту, 55 * 5078 ~= 280тыс инструкций говна, из них будет чистого кода порядка 1000 инструкций.  </I><br>Это просто пример полной трассировки, никто не мешает превратить это в компактный трейс.<br>Вот в такой например:<br>opcode 0x5f12c8 0x604fcb<br>                                 Read 0 = *(UINT32*)0012FBA4 0<br>                                 Write *(UINT32*)0012FAE8 = 0<br>opcode 0x5e6c0c 0x604fc6<br>                                 Read 0x12ff98 = *(UINT32*)0012FBA8 0<br>                                 Write *(UINT32*)0012FB04 = 0x12ff98<br>opcode 0x5ef943 0x604fc1<br>                                 Read 0x400000 = *(UINT32*)0012FBAC 0<br>                                 Write *(UINT32*)0012FAFC = 0x400000<br>opcode 0x5f1ea6 0x604fbc<br>                                 Read 0x7c809bd7 = *(UINT32*)0012FBB0 0<br>                                 Write *(UINT32*)0012FB20 = 0x7c809bd7
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=389681&amp;user=40819&amp;forum_n=13&amp;topic=25465&amp;page=2&amp;anchor=7" class="addthx" data-post="389681"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]plutos[/b]','')">plutos</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/4773.png" alt=""><br><span class=txtSm>Ранг: 622.6 (<b>!</b>), 521thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.16'>Активность: 0.33<span style='color:green'>&nearr;</span>0.89</span><br>Статус: <a href="action=userinfo&amp;user=4773">Участник</a><br><font color=blue>_Вечный_Студент_</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 декабря 2018 07:54 &middot; Поправил: plutos <br><script type="text/javascript">QU('plutos','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=plutos" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=25465&amp;page=2#8');return false;">#8</a> </span><div align=left><br>
<I>difexacaw пишет:<br>Антидамп&quot;(анклав, подмена данных через их выборку)  </I><br><br>пожалуйста обьясните, что означает термин &quot;анклав&quot; в данном контексте и откуда он взялся, а то я уже совсем запутался.<br>В общепринятом смысле &quot;анклав&quot; - это территория одного государства, полностью окруженная территорией другого. <br>Разнобой в терминологии ведет к непониманию и недоразyмениям.
<br><br><font size="1"><i>-----<br>Give me a HANDLE and I will move the Earth.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=389682&amp;user=4773&amp;forum_n=13&amp;topic=25465&amp;page=2&amp;anchor=8" class="addthx" data-post="389682"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 337.5 (мудрец), 348thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 декабря 2018 08:46 &middot; Поправил: difexacaw <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=25465&amp;page=2#9');return false;">#9</a> </span><div align=left><br>
<b>plutos</b><br><br>Есть 4-ре публикации на васме.<br><br>Суть в том, что память(те данные в ней) существует лишь при её выборке(data fetch). Выборка может быть отслежена и изменена на уровне потока инструкций. Тогда выборка изменяется и таким образом реализуется софтверный анклав. Это не существующая область памяти, либо обычно иная, нежели та, которая адресуется. А так как виртуальный&quot; блок формируется при самой выборке, то никаким образом его нельзя прочитать без выборки в том же режиме. Примеров было достаточно.<br><br><b>Добавлено спустя 40 минут</b><br><b>plutos</b><br><br>Были обсуждения про не ясное описание.<br><br>Если углубиться в тех. детали, то это работает следующим образом.<br><br>Адресная трансляция выполняется на уровне декодера инструкций, у неё есть формат - modrm.<br><br>Адрес кодируется в самой инструкции. Любой тулз, который орабатывает поток инструкций(те каждую) использует адресный декодер. Это вм или например отладчик не важно - на основе опкода(точнее формата) формируется эффективный адрес.<br><br>Далее если изменить какую то часть адресной компоненты, то линейный адрес меняется. К примеру очень давно был мотор, который смещал адреса через сегментацию, используя LDT.<br><br>Адресная компонента может измяться двумя путями - по контексту или по кодировке инструкции. В первом случае для реализации нужен эмулятор, так как адресный регистр может быть приёмником данных(reader), нп: add r,[r]. Во втором случае изменяется поле modrm в инструкции, добавляется адресное смещение. Тогда первой проблемы нет, а обращение происходит в заданную память. В случае защиты памяти от чтения адрес смещается на временный буфер, в который дешифруется читаемый блок.<br><br>Именно это всё я имел ввиду, говоря про вм. Так как у вм есть адресный декодер. Она может быть элементарно изменена для реализации анклавов.<br><br>Но и проблемы там есть, которые не резолвятся для области с указателями, те в целом пе так нельзя обработать по простому.
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=389685&amp;user=40990&amp;forum_n=13&amp;topic=25465&amp;page=2&amp;anchor=9" class="addthx" data-post="389685"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=4773" title="07-12-2018 06:31, ранг:377.7" target="_blank">plutos</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]Vamit[/b]','')">Vamit</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/20406.jpg" alt=""><br><span class=txtSm>Ранг: 331.1 (мудрец), 561thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.3'>Активность: 0.19<span style='color:red'>&searr;</span>0.06</span><br>Статус: <a href="action=userinfo&amp;user=20406">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 декабря 2018 09:50 &middot; Поправил: Vamit <br><script type="text/javascript">QU('Vamit','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vamit" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=25465&amp;page=2#10');return false;">#10</a> </span><div align=left><br>
<i class=x><b>никто не мешает превратить это в компактный трейс</b></i><br>Да, упростить конечно можно всё, что упрощаемо, но только дело в другом, любой трейс не покрывает весь код, а если он ещё и системозависим, то на каждой операционке будет свой трейс. Исходный код нелинейной функции из трейса никогда не получить.
<br><br><font size="1"><i>-----<br>Everything is relative...</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=389686&amp;user=20406&amp;forum_n=13&amp;topic=25465&amp;page=2&amp;anchor=10" class="addthx" data-post="389686"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 337.5 (мудрец), 348thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 декабря 2018 09:58 <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=25465&amp;page=2#11');return false;">#11</a> </span><div align=left><br>
<b>Vamit</b><br><br>&gt; Исходный код нелинейной функции из трейса никогда не получить. <br><br>Не правда. Вы имеете ввиду покрытие - поток ветвлений даёт начало для описания функции. Это входы, по которым строится граф.
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=389687&amp;user=40990&amp;forum_n=13&amp;topic=25465&amp;page=2&amp;anchor=11" class="addthx" data-post="389687"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]Vamit[/b]','')">Vamit</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/20406.jpg" alt=""><br><span class=txtSm>Ранг: 331.1 (мудрец), 561thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.3'>Активность: 0.19<span style='color:red'>&searr;</span>0.06</span><br>Статус: <a href="action=userinfo&amp;user=20406">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 декабря 2018 12:32 <br><script type="text/javascript">QU('Vamit','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vamit" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=25465&amp;page=2#12');return false;">#12</a> </span><div align=left><br>
<i class=x><b>поток ветвлений даёт начало для описания функции.</b></i><br>Наверное не функции, а блока кода в функции, а во вторых внутри вм нет ветвлений, в теме декомпилятора вм я приводил схему как устроен условный переход, трейсеры ни один из них не найдут.
<br><br><font size="1"><i>-----<br>Everything is relative...</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=389688&amp;user=20406&amp;forum_n=13&amp;topic=25465&amp;page=2&amp;anchor=12" class="addthx" data-post="389688"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 337.5 (мудрец), 348thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 декабря 2018 15:07 &middot; Поправил: difexacaw <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=25465&amp;page=2#13');return false;">#13</a> </span><div align=left><br>
<b>Vamit</b><br><br>В теме декомпилятора вм&quot; <img src="img/smilies/s5.gif" alt=""><br><br>Вы наверно забыли <noindex><a href="https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=15906&amp;page=20#26" rel="nofollow" target="_blank">--&gt; Link &lt;--</a></noindex><br><br>- и следующий пост.
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=389689&amp;user=40990&amp;forum_n=13&amp;topic=25465&amp;page=2&amp;anchor=13" class="addthx" data-post="389689"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]Vamit[/b]','')">Vamit</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/20406.jpg" alt=""><br><span class=txtSm>Ранг: 331.1 (мудрец), 561thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.3'>Активность: 0.19<span style='color:red'>&searr;</span>0.06</span><br>Статус: <a href="action=userinfo&amp;user=20406">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 декабря 2018 15:54 &middot; Поправил: Vamit <br><script type="text/javascript">QU('Vamit','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vamit" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=25465&amp;page=2#14');return false;">#14</a> </span><div align=left><br>
<b>difexacaw</b><br>Да вот оно <noindex><a href="https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=15906&amp;page=23#7" rel="nofollow" target="_blank">--&gt; Link &lt;--</a></noindex>, твой пост сразу за ним, т.ч. я думал что ты читал...
<br><br><font size="1"><i>-----<br>Everything is relative...</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=389691&amp;user=20406&amp;forum_n=13&amp;topic=25465&amp;page=2&amp;anchor=14" class="addthx" data-post="389691"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 337.5 (мудрец), 348thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 декабря 2018 16:45 &middot; Поправил: difexacaw <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=25465&amp;page=2#15');return false;">#15</a> </span><div align=left><br>
<b>Vamit</b><br><br>Там же весь цикл вм выделялся конструктором. Визор(трассировкой) выделял входа(на основе которых конструктор покрывает весь код процедуры), затем выполнялась свёртка. А вы говорите не найдут&quot;.
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=389692&amp;user=40990&amp;forum_n=13&amp;topic=25465&amp;page=2&amp;anchor=15" class="addthx" data-post="389692"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]BlackCode[/b]','')">BlackCode</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33766.png" alt=""><br><span class=txtSm>Ранг: 71.5 (постоянный), 95thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.48'>Активность: 0.1<span style='color:green'>&nearr;</span>0.38</span><br>Статус: <a href="action=userinfo&amp;user=33766">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 декабря 2018 17:01 <br><script type="text/javascript">QU('BlackCode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=BlackCode" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=25465&amp;page=2#16');return false;">#16</a> </span><div align=left><br>
<b>difexacaw</b><br>Бро, ты можешь написать конкретику? если ты знаешь и умещь<br>хули ты мозги сектымишь?<br>четко описал вариант решения проблем и все)
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=389693&amp;user=33766&amp;forum_n=13&amp;topic=25465&amp;page=2&amp;anchor=16" class="addthx" data-post="389693"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 337.5 (мудрец), 348thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 декабря 2018 17:07 <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=25465&amp;page=2#17');return false;">#17</a> </span><div align=left><br>
<b>BlackCode</b><br><br>Для этого вы должны чётко спросить, сформулировать тз, а то я и сам общего смысла не понимаю <img src="img/smilies/s1.gif" alt="">
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=389694&amp;user=40990&amp;forum_n=13&amp;topic=25465&amp;page=2&amp;anchor=17" class="addthx" data-post="389694"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]Vamit[/b]','')">Vamit</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/20406.jpg" alt=""><br><span class=txtSm>Ранг: 331.1 (мудрец), 561thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.3'>Активность: 0.19<span style='color:red'>&searr;</span>0.06</span><br>Статус: <a href="action=userinfo&amp;user=20406">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 декабря 2018 21:25 &middot; Поправил: Vamit <br><script type="text/javascript">QU('Vamit','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vamit" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=25465&amp;page=2#18');return false;">#18</a> </span><div align=left><br>
Вот извращенцы, они взяли функу с вызовом sysenter добавили к ней обработку аргументов, микст код (что он делает ещё не разобрал), оформили всё это отдельным примитивом, его завиртуализовали и всунули в ленту пикода вызывающей вм. Получилась двухуровневая вм.<br><br><b>Добавлено спустя 12 минут</b><br>Вот оно тельце этого примитива<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_number">02810096</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>sub</b></span>&nbsp;<span class="hl_registr">esi</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">1</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; смещение указателя ленты пикода</span></li><li class="hl_l1"><span class="hl_number">028100EA</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>movzx</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>byte</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">esi</span><span class="hl_char">]</span>&nbsp;&nbsp;<span class="hl_comment">; чтение из ленты кол-ва аргументов</span></li><li class="hl_l0"><span class="hl_number">02810115</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>xor</b></span>&nbsp;<span class="hl_registr">cl</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>bl</b></span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; декодировка кол-ва аргументов и апдейт хеша</span></li><li class="hl_l1"><span class="hl_number">02810189</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>sub</b></span>&nbsp;<span class="hl_registr">cl</span><span class="hl_char">,</span>&nbsp;0x17</li><li class="hl_l0"><span class="hl_number">028101E0</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>not</b></span>&nbsp;<span class="hl_registr">cl</span></li><li class="hl_l1"><span class="hl_number">0281020A</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">cl</span><span class="hl_char">,</span>&nbsp;0xEE</li><li class="hl_l0"><span class="hl_number">0281022B</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>xor</b></span>&nbsp;<span class="hl_registr">cl</span><span class="hl_char">,</span>&nbsp;0x18</li><li class="hl_l1"><span class="hl_number">028102A4</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>xor</b></span>&nbsp;<span class="hl_registr">bl</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">cl</span></li><li class="hl_l0"><span class="hl_number">028102FC</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>test</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">edi</span><span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;0x00008000&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; edi - указатель стека вм (SVM)</span></li><li class="hl_l1"><span class="hl_number">0281049B</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>jz</b></span>&nbsp;0x0281054C</li><li class="hl_l0"><span class="hl_number">02810E1D</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>call</b></span>&nbsp;<span class="hl_function"><b>far</b></span>&nbsp;0x33<span class="hl_char">:</span>0x01D043F4</li><li class="hl_l1"><span class="hl_number">02810096</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>sub</b></span>&nbsp;<span class="hl_registr">esi</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">4</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="hl_l0"><span class="hl_number">028100DC</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">esi</span><span class="hl_char">]</span>&nbsp;<span class="hl_comment">; чтение из ленты смещения адреса обработчика следующего примитива</span></li><li class="hl_l1"><span class="hl_number">02810108</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>xor</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>ebx</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; декодировка адреса и апдейт хеша</span></li><li class="hl_l0"><span class="hl_number">0281016A</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span>&nbsp;0x5F552FAD</li><li class="hl_l1"><span class="hl_number">02810186</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>rol</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">2</span></li><li class="hl_l0"><span class="hl_number">0281020B</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>sub</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span>&nbsp;0x444623F8</li><li class="hl_l1"><span class="hl_number">02810255</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>bswap</b></span>&nbsp;<span class="hl_registr">edx</span></li><li class="hl_l0"><span class="hl_number">028102CE</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>xor</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">edx</span></li><li class="hl_l1"><span class="hl_number">0281035A</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">ebp</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">edx</span></li><li class="hl_l0"><span class="hl_number">02810377</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr"><b>ebp</b></span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; исполнение следующего примитива</span></li><li class="hl_l1"><span class="hl_number">028103B5</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>ret</b></span>&nbsp;</li><li class="hl_l0"><span class="hl_number">0281054C</span><span class="hl_char">:</span></li><li class="hl_l1"><span class="hl_number">0281058E</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr"><b>esi</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; сохранение адреса ленты (EIP вм)</span></li><li class="hl_l0"><span class="hl_number">02810594</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr"><b>ebp</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; сохранение Offset Prm</span></li><li class="hl_l1"><span class="hl_number">0281059A</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ebp</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>edi</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; SVM в ebp</span></li><li class="hl_l0"><span class="hl_number">028105A6</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr"><b>ebx</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; сохранение хеша</span></li><li class="hl_l1"><span class="hl_number">028105AC</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>ecx</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; кол-во аргументов в стеке вм</span></li><li class="hl_l0"><span class="hl_number">028105B8</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">ebx</span></li><li class="hl_l1"><span class="hl_number">028105DE</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">ebp</span></li><li class="hl_l0"><span class="hl_number">028105C4</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>shl</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">2</span></li><li class="hl_l1"><span class="hl_number">028105F0</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">edx</span></li><li class="hl_l0"><span class="hl_number">0281060D</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr"><b>ebp</b></span>&nbsp;<span class="hl_char">+</span>&nbsp;0xFFFFFFFC<span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>eax</b></span>&nbsp;&nbsp;<span class="hl_comment">; будущий SVM (сдвиг на размер всех аргументов)</span></li><li class="hl_l1"><span class="hl_number">0281065C</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>test</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">ebx</span></li><li class="hl_l0"><span class="hl_number">02810690</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr"><b>ebp</b></span>&nbsp;<span class="hl_char">+</span>&nbsp;0xFFFFFFF8<span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>esp</b></span>&nbsp;&nbsp;<span class="hl_comment">; сохранение реального стека</span></li><li class="hl_l1"><span class="hl_number">028107D2</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>jz</b></span>&nbsp;0x02810BA0</li><li class="hl_l0"><span class="hl_number">02810883</span><span class="hl_char">:</span>&nbsp;</li><li class="hl_l1"><span class="hl_number">028108C5</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr"><b>ebx</b></span>&nbsp;<span class="hl_char">*</span>&nbsp;<span class="hl_number">4</span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_registr"><b>ebp</b></span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">]</span>&nbsp;<span class="hl_comment">; копирование аргументов из SVM в реальный стек</span></li><li class="hl_l0"><span class="hl_number">02810907</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>sub</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">1</span></li><li class="hl_l1"><span class="hl_number">028109C3</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l0"><span class="hl_number">02810AEF</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>jnz</b></span>&nbsp;0x02810883</li><li class="hl_l1"><span class="hl_number">02810BA0</span><span class="hl_char">:</span>&nbsp;</li><li class="hl_l0"><span class="hl_number">02810BE2</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr"><b>ebp</b></span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">]</span></li><li class="hl_l1"><span class="hl_number">02810C9D</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>call</b></span>&nbsp;0x015835B1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; вызов sysenter</span></li><li class="hl_l0"><span class="hl_number">028101F5</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">esp</span><span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr"><b>ebp</b></span>&nbsp;<span class="hl_char">+</span>&nbsp;0xFFFFFFF8<span class="hl_char">]</span>&nbsp;<span class="hl_comment">; восстановление реального стека</span></li><li class="hl_l1"><span class="hl_number">0281020F</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr"><b>ebp</b></span>&nbsp;<span class="hl_char">+</span>&nbsp;0xFFFFFFFC<span class="hl_char">]</span>&nbsp;<span class="hl_comment">; новый SVM (без аргументов)</span></li><li class="hl_l0"><span class="hl_number">0281022C</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">ecx</span></li><li class="hl_l1"><span class="hl_number">0281023E</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr"><b>ecx</b></span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>eax</b></span>&nbsp;<span class="hl_comment">; результат вызова в SVM</span></li><li class="hl_l0"><span class="hl_number">02810256</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_registr"><b>ebx</b></span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; восстановление базовых регистров вм (хеш, OffPrm, пикоде)</span></li><li class="hl_l1"><span class="hl_number">0281025C</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_registr">ebp</span></li><li class="hl_l0"><span class="hl_number">02810262</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_registr">esi</span></li><li class="hl_l1"><span class="hl_number">02810268</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>sub</b></span>&nbsp;<span class="hl_registr">esi</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">4</span></li><li class="hl_l0"><span class="hl_number">028102AE</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">esi</span><span class="hl_char">]</span>&nbsp;&nbsp;<span class="hl_comment">; чтение из ленты смещения адреса обработчика следующего примитива </span></li><li class="hl_l1"><span class="hl_number">028102C9</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>xor</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>ebx</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; декодировка адреса и апдейт хеша</span></li><li class="hl_l0"><span class="hl_number">0281033C</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span>&nbsp;0x5F552FAD</li><li class="hl_l1"><span class="hl_number">02810379</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>rol</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">2</span></li><li class="hl_l0"><span class="hl_number">028103DD</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>sub</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span>&nbsp;0x444623F8</li><li class="hl_l1"><span class="hl_number">02810490</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>bswap</b></span>&nbsp;<span class="hl_registr">ecx</span></li><li class="hl_l0"><span class="hl_number">028104B8</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>xor</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">ecx</span></li><li class="hl_l1"><span class="hl_number">0281052C</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">ebp</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">ecx</span></li><li class="hl_l0"><span class="hl_number">02810549</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">ebp</span></li><li class="hl_l1"><span class="hl_number">02810587</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>ret</b></span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; исполнение следующего примитива</span></li>        </ol>
    </div>
</div></div><br><br><font size="1"><i>-----<br>Everything is relative...</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=389697&amp;user=20406&amp;forum_n=13&amp;topic=25465&amp;page=2&amp;anchor=18" class="addthx" data-post="389697"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 337.5 (мудрец), 348thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 декабря 2018 22:01 &middot; Поправил: difexacaw <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=25465&amp;page=2#19');return false;">#19</a> </span><div align=left><br>
<b>Vamit</b><br><br>&gt; 02810C9D: call 0x015835B1                   ; внутри sysenter<br><br>В это можно было бы поверить, если бы не вызов wow(либо это os-case):<br><br>&gt; 02810E1D: call far 0x33:0x01D043F4<br><br><img src="img/smilies/s6.gif" alt="">
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=389698&amp;user=40990&amp;forum_n=13&amp;topic=25465&amp;page=2&amp;anchor=19" class="addthx" data-post="389698"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="20" onfocus="this.blur()" href="JavaScript:di('[b]Vamit[/b]','')">Vamit</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/20406.jpg" alt=""><br><span class=txtSm>Ранг: 331.1 (мудрец), 561thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.3'>Активность: 0.19<span style='color:red'>&searr;</span>0.06</span><br>Статус: <a href="action=userinfo&amp;user=20406">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 декабря 2018 22:20 &middot; Поправил: Vamit <br><script type="text/javascript">QU('Vamit','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vamit" target="_blank">Личное сообщение</a> &middot;  <a href="#20" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=25465&amp;page=2#20');return false;">#20</a> </span><div align=left><br>
<b>difexacaw</b><br>Что за ерунду ты пишешь, call 0x015835B1 и call far 0x33:0x01D043F4 никак не связаны и находятся в разных ветках исполнения, а внутри этого вызова call far 0x33:0x01D043F4 входят в х64 код и выходят из него там же.<br>Вот только декомпильнуть его не могу, там все под вм, а свипер х64 код не декомпилит.<br><br><b>Добавлено спустя 21 минуту</b><br>Вот он в микст коде вход 64х разрядную вм<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_number">1FFABF3A</span></li><li class="hl_l1"><span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_number">1D043FE</span></li><li class="hl_l0"><span class="hl_function"><b>pushfq</b></span>&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>push</b></span>&nbsp;r11</li><li class="hl_l0"><span class="hl_function"><b>cmp</b></span>&nbsp;<span class="hl_registr">rbp</span><span class="hl_char">,</span>r13</li><li class="hl_l1"><span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">rdi</span></li><li class="hl_l0"><span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">rbp</span></li><li class="hl_l1"><span class="hl_function"><b>push</b></span>&nbsp;r14</li><li class="hl_l0"><span class="hl_function"><b>shl</b></span>&nbsp;<span class="hl_registr">rdi</span><span class="hl_char">,</span>B9</li><li class="hl_l1"><span class="hl_function"><b>rcl</b></span>&nbsp;<span class="hl_registr">rbp</span><span class="hl_char">,</span><span class="hl_registr">cl</span></li><li class="hl_l0"><span class="hl_function"><b>xor</b></span>&nbsp;<span class="hl_registr">rbp</span><span class="hl_char">,</span>r9</li><li class="hl_l1"><span class="hl_function"><b>push</b></span>&nbsp;r8</li><li class="hl_l0"><span class="hl_function"><b>ror</b></span>&nbsp;dil<span class="hl_char">,</span><span class="hl_registr">cl</span></li><li class="hl_l1"><span class="hl_function"><b>rol</b></span>&nbsp;r8w<span class="hl_char">,</span><span class="hl_registr">cl</span></li><li class="hl_l0"><span class="hl_function"><b>movzx</b></span>&nbsp;<span class="hl_registr">bp</span><span class="hl_char">,</span>r13b</li><li class="hl_l1"><span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">rax</span></li><li class="hl_l0"><span class="hl_function"><b>push</b></span>&nbsp;r9</li><li class="hl_l1"><span class="hl_function"><b>add</b></span>&nbsp;r8b<span class="hl_char">,</span>r12b</li><li class="hl_l0"><span class="hl_function"><b>sar</b></span>&nbsp;dil<span class="hl_char">,</span><span class="hl_registr">cl</span></li><li class="hl_l1"><span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">rdi</span><span class="hl_char">,</span><span class="hl_number">2EF40C0B</span></li><li class="hl_l0"><span class="hl_function"><b>push</b></span>&nbsp;r13</li><li class="hl_l1"><span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">rbx</span></li><li class="hl_l0"><span class="hl_function"><b>rcl</b></span>&nbsp;r9b<span class="hl_char">,</span><span class="hl_registr">cl</span></li><li class="hl_l1"><span class="hl_function"><b>push</b></span>&nbsp;r12</li><li class="hl_l0"><span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">rsi</span></li><li class="hl_l1"><span class="hl_function"><b>or</b></span>&nbsp;r12b<span class="hl_char">,</span><span class="hl_registr">bl</span></li><li class="hl_l0"><span class="hl_function"><b>push</b></span>&nbsp;r15</li><li class="hl_l1"><span class="hl_function"><b>mov</b></span>&nbsp;r8b<span class="hl_char">,</span><span class="hl_registr">dl</span></li><li class="hl_l0"><span class="hl_function"><b>rcr</b></span>&nbsp;r9w<span class="hl_char">,</span><span class="hl_registr">cl</span></li><li class="hl_l1"><span class="hl_function"><b>inc</b></span>&nbsp;r12b</li><li class="hl_l0"><span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">rcx</span></li><li class="hl_l1"><span class="hl_function"><b>shld</b></span>&nbsp;<span class="hl_registr">bp</span><span class="hl_char">,</span>r13w<span class="hl_char">,</span><span class="hl_number">4C</span></li><li class="hl_l0"><span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">rdx</span></li><li class="hl_l1"><span class="hl_function"><b>push</b></span>&nbsp;r10</li><li class="hl_l0"><span class="hl_function"><b>test</b></span>&nbsp;r12w<span class="hl_char">,</span><span class="hl_number">2E3E</span></li><li class="hl_l1"><span class="hl_function"><b>or</b></span>&nbsp;dil<span class="hl_char">,</span>C7</li><li class="hl_l0"><span class="hl_function"><b>movsx</b></span>&nbsp;r8d<span class="hl_char">,</span><span class="hl_registr">cx</span></li><li class="hl_l1"><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ebp</span><span class="hl_char">,</span><span class="hl_number">0</span></li><li class="hl_l0"><span class="hl_function"><b>not</b></span>&nbsp;r10</li><li class="hl_l1"><span class="hl_function"><b>movsxd</b></span>&nbsp;<span class="hl_registr">rbp</span><span class="hl_char">,</span><span class="hl_registr">ebp</span></li><li class="hl_l0"><span class="hl_function"><b>bswap</b></span>&nbsp;r12</li><li class="hl_l1"><span class="hl_function"><b>sub</b></span>&nbsp;r9b<span class="hl_char">,</span><span class="hl_registr">al</span></li><li class="hl_l0"><span class="hl_function"><b>movsx</b></span>&nbsp;r9d<span class="hl_char">,</span>r14w</li><li class="hl_l1"><span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">rbp</span></li><li class="hl_l0"><span class="hl_function"><b>xor</b></span>&nbsp;<span class="hl_registr">di</span><span class="hl_char">,</span><span class="hl_registr">ax</span></li><li class="hl_l1"><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">rdi</span><span class="hl_char">,</span>qword&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_registr">ss</span><span class="hl_char">:</span><span class="hl_char">[</span><span class="hl_registr">rsp</span><span class="hl_char">+</span><span class="hl_number">90</span><span class="hl_char">]</span></li><li class="hl_l0"><span class="hl_function"><b>btr</b></span>&nbsp;r10d<span class="hl_char">,</span><span class="hl_registr">ebp</span></li><li class="hl_l1"><span class="hl_function"><b>rcl</b></span>&nbsp;r12<span class="hl_char">,</span><span class="hl_number">66</span></li><li class="hl_l0"><span class="hl_function"><b>sub</b></span>&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span><span class="hl_number">6224FF8</span></li><li class="hl_l1"><span class="hl_function"><b>bswap</b></span>&nbsp;<span class="hl_registr">edi</span></li><li class="hl_l0"><span class="hl_function"><b>xor</b></span>&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span><span class="hl_number">4320612F</span></li><li class="hl_l1"><span class="hl_function"><b>inc</b></span>&nbsp;<span class="hl_registr">edi</span></li><li class="hl_l0"><span class="hl_function"><b>bts</b></span>&nbsp;r9d<span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l1"><span class="hl_function"><b>lea</b></span>&nbsp;<span class="hl_registr">rdi</span><span class="hl_char">,</span>qword&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_registr">ds</span><span class="hl_char">:</span><span class="hl_char">[</span><span class="hl_registr">rdi</span><span class="hl_char">+</span><span class="hl_registr">rbp</span><span class="hl_char">]</span></li><li class="hl_l0"><span class="hl_function"><b>rol</b></span>&nbsp;r12<span class="hl_char">,</span><span class="hl_registr">cl</span></li><li class="hl_l1"><span class="hl_function"><b>mov</b></span>&nbsp;r10<span class="hl_char">,</span><span class="hl_registr">rsp</span></li><li class="hl_l0"><span class="hl_function"><b>mov</b></span>&nbsp;r8b<span class="hl_char">,</span><span class="hl_number">86</span></li><li class="hl_l1"><span class="hl_function"><b>not</b></span>&nbsp;r12b</li><li class="hl_l0"><span class="hl_function"><b>movzx</b></span>&nbsp;<span class="hl_registr">rbx</span><span class="hl_char">,</span>r13w</li><li class="hl_l1"><span class="hl_function"><b>sub</b></span>&nbsp;<span class="hl_registr">rsp</span><span class="hl_char">,</span><span class="hl_number">140</span></li><li class="hl_l0"><span class="hl_function"><b>and</b></span>&nbsp;<span class="hl_registr">rsp</span><span class="hl_char">,</span>FFFFFFFFFFFFFFF0</li><li class="hl_l1"><span class="hl_function"><b>mov</b></span>&nbsp;r12<span class="hl_char">,</span><span class="hl_registr">rdi</span></li><li class="hl_l0"><span class="hl_function"><b>movsx</b></span>&nbsp;<span class="hl_registr">rbx</span><span class="hl_char">,</span><span class="hl_registr">di</span></li><li class="hl_l1"><span class="hl_function"><b>shld</b></span>&nbsp;r9w<span class="hl_char">,</span>r13w<span class="hl_char">,</span>CD</li><li class="hl_l0"><span class="hl_function"><b>mov</b></span>&nbsp;r9b<span class="hl_char">,</span><span class="hl_number">91</span></li><li class="hl_l1"><span class="hl_function"><b>mov</b></span>&nbsp;r8d<span class="hl_char">,</span><span class="hl_number">0</span></li><li class="hl_l0"><span class="hl_function"><b>neg</b></span>&nbsp;r9</li><li class="hl_l1"><span class="hl_function"><b>adc</b></span>&nbsp;r9<span class="hl_char">,</span><span class="hl_number">2B25B31</span></li><li class="hl_l0"><span class="hl_function"><b>movsxd</b></span>&nbsp;r8<span class="hl_char">,</span>r8d</li><li class="hl_l1"><span class="hl_function"><b>sub</b></span>&nbsp;r12<span class="hl_char">,</span>r8</li><li class="hl_l0"><span class="hl_function"><b>lea</b></span>&nbsp;<span class="hl_registr">rbx</span><span class="hl_char">,</span>qword&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_registr">ds</span><span class="hl_char">:</span><span class="hl_char">[</span><span class="hl_number">14172D5D7</span><span class="hl_char">]</span></li><li class="hl_l1"><span class="hl_function"><b>rol</b></span>&nbsp;r9d<span class="hl_char">,</span>EC</li><li class="hl_l0"><span class="hl_function"><b>movzx</b></span>&nbsp;r9w<span class="hl_char">,</span>r9b</li><li class="hl_l1"><span class="hl_function"><b>sub</b></span>&nbsp;<span class="hl_registr">rdi</span><span class="hl_char">,</span><span class="hl_number">4</span></li><li class="hl_l0"><span class="hl_function"><b>mov</b></span>&nbsp;r9d<span class="hl_char">,</span><span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_registr">ds</span><span class="hl_char">:</span><span class="hl_char">[</span><span class="hl_registr">rdi</span><span class="hl_char">]</span></li><li class="hl_l1"><span class="hl_function"><b>xor</b></span>&nbsp;r9d<span class="hl_char">,</span>r12d</li><li class="hl_l0"><span class="hl_function"><b>clc</b></span>&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>cmc</b></span>&nbsp;</li><li class="hl_l0"><span class="hl_function"><b>bswap</b></span>&nbsp;r9d</li><li class="hl_l1"><span class="hl_function"><b>rol</b></span>&nbsp;r9d<span class="hl_char">,</span><span class="hl_number">3</span></li><li class="hl_l0"><span class="hl_function"><b>stc</b></span>&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>xor</b></span>&nbsp;r9d<span class="hl_char">,</span><span class="hl_number">4FF334D8</span></li><li class="hl_l0"><span class="hl_function"><b>cmp</b></span>&nbsp;dil<span class="hl_char">,</span>r11b</li><li class="hl_l1"><span class="hl_function"><b>sub</b></span>&nbsp;r9d<span class="hl_char">,</span><span class="hl_number">41E0598D</span></li><li class="hl_l0"><span class="hl_function"><b>cmc</b></span>&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>cmp</b></span>&nbsp;<span class="hl_registr">dx</span><span class="hl_char">,</span>r8w</li><li class="hl_l0"><span class="hl_function"><b>push</b></span>&nbsp;r12</li><li class="hl_l1"><span class="hl_function"><b>btc</b></span>&nbsp;r12<span class="hl_char">,</span>r12</li><li class="hl_l0"><span class="hl_function"><b>xor</b></span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_registr">ss</span><span class="hl_char">:</span><span class="hl_char">[</span><span class="hl_registr">rsp</span><span class="hl_char">]</span><span class="hl_char">,</span>r9d</li><li class="hl_l1"><span class="hl_function"><b>shl</b></span>&nbsp;r12b<span class="hl_char">,</span><span class="hl_registr">cl</span></li><li class="hl_l0"><span class="hl_function"><b>pop</b></span>&nbsp;r12</li><li class="hl_l1"><span class="hl_function"><b>movsxd</b></span>&nbsp;r9<span class="hl_char">,</span>r9d</li><li class="hl_l0"><span class="hl_function"><b>clc</b></span>&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>test</b></span>&nbsp;r13w<span class="hl_char">,</span>r8w</li><li class="hl_l0"><span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">rbx</span><span class="hl_char">,</span>r9</li><li class="hl_l1"><span class="hl_function"><b>jmp</b></span>&nbsp;<span class="hl_registr">rbx</span></li>        </ol>
    </div>
</div></div>
<br><br>А инструменты под х64 у меня ещё не написаны, нет ни деобфускатора, ни декомпилятора((…<br>Ладно, пока будем разбираться без этого, ещё условие выбора есть (а от чего оно зависит пока не ясно) или через sysenter идет или через микст код.
<br><br><font size="1"><i>-----<br>Everything is relative...</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=389699&amp;user=20406&amp;forum_n=13&amp;topic=25465&amp;page=2&amp;anchor=20" class="addthx" data-post="389699"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="21" onfocus="this.blur()" href="JavaScript:di('[b]ClockMan[/b]','')">ClockMan</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/17432.jpg" alt=""><br><span class=txtSm>Ранг: 568.2 (<b>!</b>), 464thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.99'>Активность: 0.55<span style='color:green'>&nearr;</span>0.57</span><br>Статус: <a href="action=userinfo&amp;user=17432">Участник</a><br><font color=blue>оптимист</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 декабря 2018 00:15 <br><script type="text/javascript">QU('ClockMan','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ClockMan" target="_blank">Личное сообщение</a> &middot;  <a href="#21" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=25465&amp;page=2#21');return false;">#21</a> </span><div align=left><br>
<b>Vamit</b><br>Ты хотябы файл выложил на котором опыты проводишь
<br><br><font size="1"><i>-----<br>Чтобы правильно задать вопрос, нужно знать большую часть  ответа. Р.Шекли.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=389700&amp;user=17432&amp;forum_n=13&amp;topic=25465&amp;page=2&amp;anchor=21" class="addthx" data-post="389700"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="22" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 декабря 2018 05:11 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#22" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=25465&amp;page=2#22');return false;">#22</a> </span><div align=left><br>
<I>Vamit пишет:<br>ещё условие выбора есть (а от чего оно зависит пока не ясно) или через sysenter идет или через микст код </I><br>Видимо, зависит от проверки, работает на WOW64, тогда можно делать переход в x64 и там вызов, либо на нативной x86, тогда вызов напрямую.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=389703&amp;user=1556&amp;forum_n=13&amp;topic=25465&amp;page=2&amp;anchor=22" class="addthx" data-post="389703"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="23" onfocus="this.blur()" href="JavaScript:di('[b]Vamit[/b]','')">Vamit</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/20406.jpg" alt=""><br><span class=txtSm>Ранг: 331.1 (мудрец), 561thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.3'>Активность: 0.19<span style='color:red'>&searr;</span>0.06</span><br>Статус: <a href="action=userinfo&amp;user=20406">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 декабря 2018 10:00 <br><script type="text/javascript">QU('Vamit','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vamit" target="_blank">Личное сообщение</a> &middot;  <a href="#23" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=25465&amp;page=2#23');return false;">#23</a> </span><div align=left><br>
Добавил в тело примитива комментарии (пост #18) для лучшего понимания<br><i class=x><b>Видимо, зависит от проверки, работает на WOW64, тогда можно делать переход в x64 и там вызов, либо на нативной x86, тогда вызов напрямую.</b></i><br>Полностью согласен, в микст коде должна быть та же часть что и приведенная ниже в х86 коде, аргументы же в стеке вм общие.
<br><br><font size="1"><i>-----<br>Everything is relative...</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=389705&amp;user=20406&amp;forum_n=13&amp;topic=25465&amp;page=2&amp;anchor=23" class="addthx" data-post="389705"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="24" onfocus="this.blur()" href="JavaScript:di('[b]Vamit[/b]','')">Vamit</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/20406.jpg" alt=""><br><span class=txtSm>Ранг: 331.1 (мудрец), 561thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.3'>Активность: 0.19<span style='color:red'>&searr;</span>0.06</span><br>Статус: <a href="action=userinfo&amp;user=20406">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 14 декабря 2018 18:08 <br><script type="text/javascript">QU('Vamit','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vamit" target="_blank">Личное сообщение</a> &middot;  <a href="#24" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=25465&amp;page=2#24');return false;">#24</a> </span><div align=left><br>
Вот тут <noindex><a href="https://www.sendspace.com/file/umrg8i" rel="nofollow" target="_blank">--&gt; Link &lt;--</a></noindex> можно взять файлик с полным восстановленным кодом протектора и загрузчика вмпрота, даже пожратая им функа на ОЕП девиртуализовалась.<br>Можно его грузить хоть в Ида, хоть в любой другой дебагер, изучать код и вырабатывать противодействие антиотладке. В общем делайте с ним всё что хотите, только прошу о разобранных и изученных функах сообщать в тему.<br>Код должен быть рабочим, но Свипер не идеален, т.ч. могут встречаться ошибки, о них так же прошу сообщать.
<br><br><font size="1"><i>-----<br>Everything is relative...</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=389849&amp;user=20406&amp;forum_n=13&amp;topic=25465&amp;page=2&amp;anchor=24" class="addthx" data-post="389849"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=17432" title="15-12-2018 05:55, ранг:512.4" target="_blank">ClockMan</a>, <a href="action=userinfo&user=35168" title="15-12-2018 11:59, ранг:75.3" target="_blank">v00doo</a>, <a href="action=userinfo&user=4773" title="15-12-2018 21:57, ранг:380.4" target="_blank">plutos</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="25" onfocus="this.blur()" href="JavaScript:di('[b]plutos[/b]','')">plutos</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/4773.png" alt=""><br><span class=txtSm>Ранг: 622.6 (<b>!</b>), 521thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.16'>Активность: 0.33<span style='color:green'>&nearr;</span>0.89</span><br>Статус: <a href="action=userinfo&amp;user=4773">Участник</a><br><font color=blue>_Вечный_Студент_</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 16 декабря 2018 01:44 <br><script type="text/javascript">QU('plutos','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=plutos" target="_blank">Личное сообщение</a> &middot;  <a href="#25" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=25465&amp;page=2#25');return false;">#25</a> </span><div align=left><br>
вопрос наверное наивный, но все же лучше спросить, чем жить в заблуждении, ведь за спрос не бьют в нос.<br><br>Этот file ProtectVmp32.exe  это результат работы Свипера над другим файлом, который в свою очередь был подвергнут VMProtect? Я правильно понимаю?<br> Если &quot;да&quot;, то можно выложить тот самый первоначальный файлик? Хотелось бы самому проследить всю цепочку преобразований, так до меня легче доходит. <br>А если &quot;нет&quot;, то пожалуйста, поправте!
<br><br><font size="1"><i>-----<br>Give me a HANDLE and I will move the Earth.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=389883&amp;user=4773&amp;forum_n=13&amp;topic=25465&amp;page=2&amp;anchor=25" class="addthx" data-post="389883"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="26" onfocus="this.blur()" href="JavaScript:di('[b]daFix[/b]','')">daFix</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/2777.gif" alt=""><br><span class=txtSm>Ранг: 529.0 (<b>!</b>), 110thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.75'>Активность: 0.29<span style='color:red'>&searr;</span>0.04</span><br>Статус: <a href="action=userinfo&amp;user=2777">Участник</a><br><font color=blue>5KRT</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 16 декабря 2018 02:27 <br><script type="text/javascript">QU('daFix','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=daFix" target="_blank">Личное сообщение</a> &middot;  <a href="#26" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=25465&amp;page=2#26');return false;">#26</a> </span><div align=left><br>
<b>plutos</b><br>Да, это exe одной реальной проги, глянь в свойства файла, увидишь название. <br>На семёрке не взлетает на SYSENTER
<br><br><font size="1"><i>-----<br>Research For Food</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=389884&amp;user=2777&amp;forum_n=13&amp;topic=25465&amp;page=2&amp;anchor=26" class="addthx" data-post="389884"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=4773" title="16-12-2018 00:04, ранг:380.9" target="_blank">plutos</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="27" onfocus="this.blur()" href="JavaScript:di('[b]Vamit[/b]','')">Vamit</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/20406.jpg" alt=""><br><span class=txtSm>Ранг: 331.1 (мудрец), 561thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.3'>Активность: 0.19<span style='color:red'>&searr;</span>0.06</span><br>Статус: <a href="action=userinfo&amp;user=20406">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 16 декабря 2018 10:49 &middot; Поправил: Vamit <br><script type="text/javascript">QU('Vamit','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vamit" target="_blank">Личное сообщение</a> &middot;  <a href="#27" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=25465&amp;page=2#27');return false;">#27</a> </span><div align=left><br>
<i class=x><b>это результат работы Свипера над другим файлом, который в свою очередь был подвергнут VMProtect? Я правильно понимаю?</b></i><br>Неправильно, это первоначальный файл, защищенный вмпротом 3.2, с добавленной секцией в которой весь восстановленный код вплоть до ОЕП. ЕП файла осталась оригинальная, первый вход в вм заменен на jmp в восстановленный код, все ссылки на данные реальны, они обработке не подвергались и расположены на своих местах.<br><br><i class=x><b>На семёрке не взлетает на SYSENTER</b></i><br>Да, тут есть пара ошибок, эту функу из виртуализованного примитива добавлял вручную, короче нужно первый аргумент из стека выгружать в eax, и сдвигать стек на +8, примерно вот так<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_number">028389F2</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span><span class="hl_registr"><b>esp</b></span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">4</span><span class="hl_char">]</span></li><li class="hl_l1"><span class="hl_number">028389F3</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>lea</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span><span class="hl_registr"><b>esp</b></span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">8</span><span class="hl_char">]</span></li><li class="hl_l0"><span class="hl_number">028389F4</span><span class="hl_char">:</span>&nbsp;<span class="hl_function">sysenter</span></li><li class="hl_l1"><span class="hl_number">028389F5</span><span class="hl_char">:</span>&nbsp;<span class="hl_function">ret</span></li>        </ol>
    </div>
</div></div>
<br>Но на Вин10 sysenter не работает, для неё тестируется другое решение.<br><br><b>Добавлено спустя 1 час 18 минут</b><br>При изучении защиты можно использовать наработки <noindex><a href="https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=24749" rel="nofollow" target="_blank">--&gt; из этой темы &lt;--</a></noindex>, они аналогичны и похоже что разработчики вмп большую часть этого кода добавили в свой протектор v3.2<br><br><b>Добавлено спустя 1 час 49 минут</b><br>Может кто знает, что означает старшее слово для syscall вызовов<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_char">.</span><span class="hl_function">code</span><span class="hl_char">:</span><span class="hl_number">02839EB6</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>or</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">2008000h</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; NtSetInformationThread</span></li><li class="hl_l1"><span class="hl_char">.</span><span class="hl_function">code</span><span class="hl_char">:</span><span class="hl_number">02839EBC</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>or</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">[</span><span class="hl_registr">ebp</span><span class="hl_char">+</span>NtClose<span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">8000h</span></li><li class="hl_l0"><span class="hl_char">.</span><span class="hl_function">code</span><span class="hl_char">:</span><span class="hl_number">02839EC3</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>or</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">6008000h</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;NtOpenFile</span></li><li class="hl_l1"><span class="hl_char">.</span><span class="hl_function">code</span><span class="hl_char">:</span><span class="hl_number">02839EC9</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>or</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">esi</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">3008000h</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;NtQueryInformationProcess</span></li><li class="hl_l0"><span class="hl_char">.</span><span class="hl_function">code</span><span class="hl_char">:</span><span class="hl_number">02839ECF</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>or</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">[</span><span class="hl_registr">ebp</span><span class="hl_char">+</span>NtProtectVirtualMemory<span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">1008000h</span></li><li class="hl_l1"><span class="hl_char">.</span><span class="hl_function">code</span><span class="hl_char">:</span><span class="hl_number">02839ED6</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>or</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">[</span><span class="hl_registr">ebp</span><span class="hl_char">+</span>NtMapViewOfSection<span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">4008000h</span></li><li class="hl_l0"><span class="hl_char">.</span><span class="hl_function">code</span><span class="hl_char">:</span><span class="hl_number">02839EDD</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>or</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">[</span><span class="hl_registr">ebp</span><span class="hl_char">+</span>NtUnmapViewOfSection<span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">5008000h</span></li><li class="hl_l1"><span class="hl_char">.</span><span class="hl_function">code</span><span class="hl_char">:</span><span class="hl_number">02839EE4</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>or</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">[</span><span class="hl_registr">ebp</span><span class="hl_char">+</span>NtCreateSection<span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">7008000h</span></li><li class="hl_l0"><span class="hl_char">.</span><span class="hl_function">code</span><span class="hl_char">:</span><span class="hl_number">02839EEB</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>or</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">[</span><span class="hl_registr">ebp</span><span class="hl_char">+</span>NtQueryVirtualMemory<span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">8008000h</span></li>        </ol>
    </div>
</div></div>
<br><br>по маске 0x7FFF находится номер системного вызова, флаг 0x8000 определяет режим, если установлен то вызов через микст код syscall для Wow64 систем, если сброшен, то вызов через sysenter, а вот старшее слово для Wow64 систем мне неизвестно.<br><br><b>Добавлено спустя 7 часов 35 минут</b><br>Вот рабочее решение для syscall и sysenter одном пакете для любой операционки, кому нужно можете изменить код в файле<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_number">028389F0</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span><span class="hl_registr"><b>esp</b></span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">4</span><span class="hl_char">]</span></li><li class="hl_l1"><span class="hl_number">028389F1</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>test</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;0x00008000</li><li class="hl_l0"><span class="hl_number">028389F2</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>jne</b></span>&nbsp;0x028389F6</li><li class="hl_l1"><span class="hl_number">028389F3</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>lea</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span><span class="hl_registr"><b>esp</b></span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">8</span><span class="hl_char">]</span></li><li class="hl_l0"><span class="hl_number">028389F4</span><span class="hl_char">:</span>&nbsp;<span class="hl_function">sysenter</span></li><li class="hl_l1"><span class="hl_number">028389F5</span><span class="hl_char">:</span>&nbsp;<span class="hl_function">ret</span></li><li class="hl_l0"><span class="hl_number">028389F6</span><span class="hl_char">:</span></li><li class="hl_l1"><span class="hl_number">028389F7</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>and</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;0x7fff</li><li class="hl_l0"><span class="hl_number">028389F8</span><span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>jmp</b></span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_registr">fs</span><span class="hl_char">:</span><span class="hl_char">[</span>0xC0<span class="hl_char">]</span></li>        </ol>
    </div>
</div></div><br><br><font size="1"><i>-----<br>Everything is relative...</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=389890&amp;user=20406&amp;forum_n=13&amp;topic=25465&amp;page=2&amp;anchor=27" class="addthx" data-post="389890"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=2777" title="17-12-2018 01:41, ранг:521.0" target="_blank">daFix</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="28" onfocus="this.blur()" href="JavaScript:di('[b]Vamit[/b]','')">Vamit</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/20406.jpg" alt=""><br><span class=txtSm>Ранг: 331.1 (мудрец), 561thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.3'>Активность: 0.19<span style='color:red'>&searr;</span>0.06</span><br>Статус: <a href="action=userinfo&amp;user=20406">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 декабря 2018 11:13 &middot; Поправил: Vamit <br><script type="text/javascript">QU('Vamit','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vamit" target="_blank">Личное сообщение</a> &middot;  <a href="#28" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=25465&amp;page=2#28');return false;">#28</a> </span><div align=left><br>
Первая проверка на Вин10, которая ловит дебагер<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">ULONG&nbsp;pdoh&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l1"><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>do_syscall<span class="hl_char">(</span>NtQueryInformationProcess<span class="hl_char">,</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">,</span>&nbsp;ProcessDebugObjectHandle<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>pdoh<span class="hl_char">,</span>&nbsp;<span class="hl_number">4</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>pdoh<span class="hl_char">)</span>&nbsp;<span class="hl_char">&gt;</span><span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span>&nbsp;<span class="hl_char">|</span><span class="hl_char">|</span>&nbsp;pdoh&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;goto&nbsp;DEBUGGER_IS_DETECTED<span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div>
<br>при наличии дебагера NtQueryInformationProcess возвращает 0, при его отсутствии 0xC0000353 -STATUS_PORT_NOT_SET<br><br><b>Добавлено спустя 22 минуты</b><br>Вторая проверка отключает отладчик от исследуемого процесса<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">do_syscall<span class="hl_char">(</span>NtSetInformationThread<span class="hl_char">,</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">2</span><span class="hl_char">,</span>&nbsp;ThreadHideFromDebugger<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span><span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div>
<br><br><b>Добавлено спустя 1 час 45 минут</b><br>Восстановленная функция 02838DC0 VmpUnpackSection не работает, вместо неё  нужно вызывать оригинальную функу по адресу 01CF9BBA<br><br><b>Добавлено спустя 2 часа 7 минут</b><br>Следующая проверка, которая ловит дебагер, вызывается после распаковки кода секций<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">__try</li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;__asm&nbsp;<span class="hl_function">pushfd</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;__asm&nbsp;<span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_registr">ecx</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;__asm&nbsp;<span class="hl_function"><b>or</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span>&nbsp;V86FLAGS_TRACE</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;__asm&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">ecx</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;__asm&nbsp;<span class="hl_function">popf</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;__asm&nbsp;<span class="hl_function">rdtsc</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;__asm&nbsp;<span class="hl_function">nop</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;goto&nbsp;DEBUGGER_IS_DETECTED<span class="hl_comment">;</span></li><li class="hl_l0">}</li><li class="hl_l1">__except<span class="hl_char">(</span>info&nbsp;<span class="hl_char">=</span>&nbsp;GetExceptionInformation<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;EXCEPTION_EXECUTE_HANDLER<span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>info<span class="hl_char">-</span><span class="hl_char">&gt;</span>ExceptionRecord<span class="hl_char">-</span><span class="hl_char">&gt;</span>ContextFlags&nbsp;<span class="hl_char">&amp;</span>&nbsp;CONTEXT_DEBUG_REGISTERS<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;value&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value&nbsp;<span class="hl_char">|</span><span class="hl_char">=</span>&nbsp;info<span class="hl_char">-</span><span class="hl_char">&gt;</span>ExceptionRecord<span class="hl_char">-</span><span class="hl_char">&gt;</span>Dr2<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value&nbsp;<span class="hl_char">|</span><span class="hl_char">=</span>&nbsp;info<span class="hl_char">-</span><span class="hl_char">&gt;</span>ExceptionRecord<span class="hl_char">-</span><span class="hl_char">&gt;</span>Dr3<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value&nbsp;<span class="hl_char">|</span><span class="hl_char">=</span>&nbsp;info<span class="hl_char">-</span><span class="hl_char">&gt;</span>ExceptionRecord<span class="hl_char">-</span><span class="hl_char">&gt;</span>Dr1<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value&nbsp;<span class="hl_char">|</span><span class="hl_char">=</span>&nbsp;info<span class="hl_char">-</span><span class="hl_char">&gt;</span>ExceptionRecord<span class="hl_char">-</span><span class="hl_char">&gt;</span>Dr0<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>value<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto&nbsp;DEBUGGER_IS_DETECTED<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">}</li>        </ol>
    </div>
</div></div><br><br><font size="1"><i>-----<br>Everything is relative...</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=389899&amp;user=20406&amp;forum_n=13&amp;topic=25465&amp;page=2&amp;anchor=28" class="addthx" data-post="389899"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=4554" title="18-12-2018 06:41, ранг:220.6" target="_blank">HandMill</a>, <a href="action=userinfo&user=3520" title="18-12-2018 17:34, ранг:630.4" target="_blank">mak</a>, <a href="action=userinfo&user=4773" title="10-01-2019 00:34, ранг:387.1" target="_blank">plutos</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="29" onfocus="this.blur()" href="JavaScript:di('[b]hash87szf[/b]','')">hash87szf</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 64.9 (постоянный), 47thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.33'>Активность: 0.12<span style='color:red'>&searr;</span>0.02</span><br>Статус: <a href="action=userinfo&amp;user=34301">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 декабря 2018 20:51 <br><script type="text/javascript">QU('hash87szf','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=hash87szf" target="_blank">Личное сообщение</a> &middot;  <a href="#29" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=25465&amp;page=2#29');return false;">#29</a> </span><div align=left><br><div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;__asm&nbsp;<span class="hl_function">pushfd</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;__asm&nbsp;<span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_registr">ecx</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;__asm&nbsp;<span class="hl_function"><b>or</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span>&nbsp;V86FLAGS_TRACE</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;__asm&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">ecx</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;__asm&nbsp;<span class="hl_function">popf</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;__asm&nbsp;<span class="hl_function">rdtsc</span></li>        </ol>
    </div>
</div></div>
<br>А дебагер эту сэпшн не ловит ли сам?<br>И не совсем понятно как это робит. В TF 0 или 1 (без и с трэйсом) OR&#039;им с V86FLAGS_TRACE (1) и получаем 1, popf, на rdtsc должно single step exception, её ловит дбг не уходя в __except. Или не ловит?<br>Меня б насторожило шо софт сэпшны ставит... или оно там с кучой мусора, мол на сэпшн, ройся?<br><br>Обход вроде у Скиллы норм, передавай singlestep сэпшн софту (он тогда идёт в свой __except) и пряч DRx, так?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=389907&amp;user=34301&amp;forum_n=13&amp;topic=25465&amp;page=2&amp;anchor=29" class="addthx" data-post="389907"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="30" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 337.5 (мудрец), 348thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 декабря 2018 21:15 &middot; Поправил: difexacaw <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#30" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=25465&amp;page=2#30');return false;">#30</a> </span><div align=left><br>
<b>hash87szf</b><br><br>Ну а что тут не понятно, устанавливается TF и в ловушке проверяется дебаг контекст. Так как в ловушке никаких проверок нет, то способ вызова исключения значения не имеет. Рассчитано(#DB) на то, что отладчик сам обработает трап, тем самым не передав управление для обработки ловушки.<br><br>push/pop это морф/макро, нужно что бы сохранить часть контекста, но при этом установить флажок(TF). Иначе было бы push 0x100/popfd.<br><br>&gt; пряч DRx<br><br>А как он их спрячет, если не может мониторить сервисный шлюз(так как он судя по всему перемещён в памяти), те сервисный запрос контекста, нп NtGetContextThread <img src="img/smilies/s11.gif" alt=""><br><br><b>Добавлено спустя 19 минут</b><br><b>Vamit</b><br><br>Что же вы копаетесь в такой мелочи, в штатных способах детекта отладчика, это ведь плагины делают <img src="img/smilies/s15.gif" alt=""><br><br>А что бы вы делали если бы был допустим замер дельты по системному таймингу, те например вызываем ловушку и прерывание, затем измеряем время обработки и их отношение. Результат будет однозначный - дельта в сотни/тысячи крат, при этом без вызова нтапи <img src="img/smilies/s1.gif" alt="">
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=389908&amp;user=40990&amp;forum_n=13&amp;topic=25465&amp;page=2&amp;anchor=30" class="addthx" data-post="389908"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="31" onfocus="this.blur()" href="JavaScript:di('[b]Vamit[/b]','')">Vamit</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/20406.jpg" alt=""><br><span class=txtSm>Ранг: 331.1 (мудрец), 561thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.3'>Активность: 0.19<span style='color:red'>&searr;</span>0.06</span><br>Статус: <a href="action=userinfo&amp;user=20406">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 декабря 2018 22:59 <br><script type="text/javascript">QU('Vamit','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vamit" target="_blank">Личное сообщение</a> &middot;  <a href="#31" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=25465&amp;page=2#31');return false;">#31</a> </span><div align=left><br>
В дополнение к сказанному...<br>Все остальные проверки некритичны, прога распаковалась и запустилась без проблем под дебагером.
<br><br><font size="1"><i>-----<br>Everything is relative...</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=389909&amp;user=20406&amp;forum_n=13&amp;topic=25465&amp;page=2&amp;anchor=31" class="addthx" data-post="389909"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> <a href="action=vthread&amp;forum=13&amp;topic=25465&amp;page=1.html">&lt;&lt;</a> .  <a href="action=vthread&amp;forum=13&amp;topic=25465&amp;page=0.html">1</a> . <a href="action=vthread&amp;forum=13&amp;topic=25465&amp;page=1.html">2</a> . <b>3</b> .</b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/aspro.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=13&sortBy=0&page=0.html"><b>Протекторы</b></a> <b class=bulletHead>&#8212;&#8250;</b> VMProtect 3.2: запуcтить приложение и остановить его на указанном адресе</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#32" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="13">
<input type="hidden" name="topic" value="25465">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=25465" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
