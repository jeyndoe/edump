<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Вопрос по перехвату API - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Всем привет... Есть прекрасные статьи MSRem&#039;а по перехвату. У меня вопрос по 3 части: www.wasm.ru/article.php?article=apihook_3 В прилагающихся файлах есть &quot;Номера всех системных вызовов Windows 2000/XP&quot;:">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=31361'>zds</a>, <a target='_blank' href='?action=userinfo&amp;user=55995'>tyns777</a>, <a target='_blank' href='?action=userinfo&amp;user=55802'>JustLife</a>, <a target='_blank' href='?action=userinfo&amp;user=2094'>2nd</a>, <a target='_blank' href='?action=userinfo&amp;user=33192'>morgot</a>, <a target='_blank' href='?action=userinfo&amp;user=8605'>Rio</a>, <a target='_blank' href='?action=userinfo&amp;user=27081'>CDK123</a> (+4 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Вопрос по перехвату API</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]NeoTall[/b]','')">NeoTall</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 36.8 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.61'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=817">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 22 декабря 2008 23:57 <br><script type="text/javascript">QU('NeoTall','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=NeoTall" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13425.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Всем привет...<br><br>Есть прекрасные статьи MSRem&#039;а по перехвату. У меня вопрос по 3 части:<br>www.wasm.ru/article.php?article=apihook_3<br><br>В прилагающихся файлах есть &quot;Номера всех системных вызовов Windows 2000/XP&quot;: www.wasm.ru/pub/21/files/sysservice.rar <br><b>Так вот вопрос: Как определить Serivce ID для неизвестной функции или функции в Vista?</b>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=214624&amp;user=817&amp;forum_n=6&amp;topic=13425.html&amp;page=0&amp;anchor=1" class="addthx" data-post="214624"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]NeoTall[/b]','')">NeoTall</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 36.8 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.61'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=817">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 декабря 2008 00:09 <br><script type="text/javascript">QU('NeoTall','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=NeoTall" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13425.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
Гугл форева: www.metasploit.com/users/opcode/syscalls.html<br><br>Однако как определить значение для неизвестной функи...непонятно...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=214626&amp;user=817&amp;forum_n=6&amp;topic=13425.html&amp;page=0&amp;anchor=2" class="addthx" data-post="214626"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]Viktoro[/b]','')">Viktoro</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/592.jpg" alt=""><br><span class=txtSm>Ранг: 116.9 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.71'>Активность: 0.04<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=592">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 декабря 2008 00:11 &middot; Поправил: Viktoro <br><script type="text/javascript">QU('Viktoro','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Viktoro" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13425.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
вот таблица... виста присутствует<br>www.metasploit.com/users/opcode/syscalls.html<br><br>определять например так:<br>moyix.blogspot.com/2008/08/auditing-system-call-table.html
<br><br><font size="1"><i>-----<br>Nothing just happens. You choose it to happen.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=214627&amp;user=592&amp;forum_n=6&amp;topic=13425.html&amp;page=0&amp;anchor=3" class="addthx" data-post="214627"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]coderess[/b]','')">coderess</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/16383.jpg" alt=""><br><span class=txtSm>Ранг: 355.4 (мудрец), 55thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.21'>Активность: 0.32<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=16383">Uploader</a><br><font color=blue>5KRT</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 декабря 2008 00:21 &middot; Поправил: coderess <br><script type="text/javascript">QU('coderess','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=coderess" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13425.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
Дизассемблируя kernel32.dll и ntdll.dll, в кернел содердаться WinAPI функции, которые ведут к ntdll.dll, <br>гуляешь по отладчику и получаешь, пример ниже:<br><br><br>ZwQueryInformationProcess:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"></li><li class="hl_l1"><span class="hl_number">7C913921</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">8D45</span>&nbsp;FC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>LEA</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">EAX</span><span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_function"><b>PTR</b></span>&nbsp;<span class="hl_registr">SS</span><span class="hl_char">:</span><span class="hl_char">[</span><span class="hl_registr">EBP</span><span class="hl_char">-</span><span class="hl_number">4</span><span class="hl_char">]</span></li><li class="hl_l0"><span class="hl_number">7C913924</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr"><b>EAX</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;hProcess = FFFFFFFF</span></li><li class="hl_l1"><span class="hl_number">7C913925</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">6A</span>&nbsp;<span class="hl_number">24</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">24</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">;InfoClass = 24 (36.)</span></li><li class="hl_l0"><span class="hl_number">7C913927</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">6A</span>&nbsp;FF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">;Buffer = 0006F1B4</span></li><li class="hl_l1"><span class="hl_number">7C913929</span>&nbsp;&nbsp;&nbsp;&nbsp;E8&nbsp;EDA6FFFF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>CALL</b></span>&nbsp;&nbsp;&nbsp;&nbsp;ntdll<span class="hl_char">.</span>ZwQueryInformationProcess&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;pReqsize = NULL</span></li>        </ol>
    </div>
</div></div>
<br><br>После входа по (F7) <br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"></li><li class="hl_l1"><span class="hl_number">7C90E01B</span>&nbsp;<span class="hl_char">&gt;</span>&nbsp;&nbsp;B8&nbsp;<span class="hl_number">9A000000</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>MOV</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">EAX</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">9A</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; номер сервиса</span></li><li class="hl_l0"><span class="hl_number">7C90E020</span>&nbsp;&nbsp;&nbsp;&nbsp;BA&nbsp;<span class="hl_number">0003FE7F</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>MOV</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">EDX</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">7FFE0300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; адрес шлюза KiFastSystemCall 7FFE0300</span></li><li class="hl_l1"><span class="hl_number">7C90E025</span>&nbsp;&nbsp;&nbsp;&nbsp;FF12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>CALL</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_function"><b>PTR</b></span>&nbsp;<span class="hl_registr">DS</span><span class="hl_char">:</span><span class="hl_char">[</span><span class="hl_registr">EDX</span><span class="hl_char">]</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; вызов ntdll.KiFastSystemCall</span></li><li class="hl_l0"><span class="hl_number">7C90E027</span>&nbsp;&nbsp;&nbsp;&nbsp;C2&nbsp;<span class="hl_number">1400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>RETN</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">14</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li>        </ol>
    </div>
</div></div>
<br>вызывая:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"></li><li class="hl_l1"><span class="hl_function"><b>CALL</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_function"><b>PTR</b></span>&nbsp;<span class="hl_registr">DS</span><span class="hl_char">:</span><span class="hl_char">[</span><span class="hl_registr">EDX</span><span class="hl_char">]</span></li>        </ol>
    </div>
</div></div>
<br><br>мы переходим к SYSENTER (для Windows XP) в Windows 2000, int 2eh<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"></li><li class="hl_l1"><span class="hl_number">7C90EB8B</span>&nbsp;<span class="hl_char">&gt;</span>&nbsp;&nbsp;<span class="hl_number">8BD4</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>MOV</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">EDX</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>ESP</b></span>&nbsp;<span class="hl_comment">;Перед вызовом SYSENTER, EDX=ESP</span></li><li class="hl_l0"><span class="hl_number">7C90EB8D</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">0F34</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>SYSENTER</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;вызываем SYSENTER</span></li><li class="hl_l1"><span class="hl_number">7C90EB8F</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NOP</li><li class="hl_l0"><span class="hl_number">7C90EB90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NOP</li><li class="hl_l1"><span class="hl_number">7C90EB91</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NOP</li><li class="hl_l0"><span class="hl_number">7C90EB92</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NOP</li><li class="hl_l1"><span class="hl_number">7C90EB93</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NOP</li><li class="hl_l0"><span class="hl_number">7C90EB94</span>&nbsp;<span class="hl_char">&gt;</span>&nbsp;&nbsp;C3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETN</li>        </ol>
    </div>
</div></div>
<br><br><br>Несколько замечаний: В сайсе есть такая команда как ntcall, с помощью нее можно просматривать номера<br>системных вызовов и второе точно не помню на каком то из сервис паков используется <br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>CALL</b></span>&nbsp;&nbsp;<span class="hl_registr"><b>EDX</b></span>&nbsp;вместо&nbsp;<span class="hl_function"><b>CALL</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_function"><b>PTR</b></span>&nbsp;<span class="hl_registr">DS</span><span class="hl_char">:</span><span class="hl_char">[</span><span class="hl_registr">EDX</span><span class="hl_char">]</span></li>        </ol>
    </div>
</div></div><br><br><font size="1"><i>-----<br>Gutta cavat lapidem. Feci, quod potui. Faciant meliora potentes</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=214628&amp;user=16383&amp;forum_n=6&amp;topic=13425.html&amp;page=0&amp;anchor=4" class="addthx" data-post="214628"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]NeoTall[/b]','')">NeoTall</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 36.8 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.61'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=817">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 декабря 2008 10:14 <br><script type="text/javascript">QU('NeoTall','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=NeoTall" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13425.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
Всем спасибо, очень помогли. <br><br>Появился еще вопрос, драйвер пытаюсь написать первый раз, т.ч. не обессудьте... <br>Как вызвать beep (или написать &quot;свой низкоуровневый&quot; beep)? Может у кого код завалялся?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=214653&amp;user=817&amp;forum_n=6&amp;topic=13425.html&amp;page=0&amp;anchor=5" class="addthx" data-post="214653"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]coderess[/b]','')">coderess</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/16383.jpg" alt=""><br><span class=txtSm>Ранг: 355.4 (мудрец), 55thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.21'>Активность: 0.32<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=16383">Uploader</a><br><font color=blue>5KRT</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 декабря 2008 11:26 <br><script type="text/javascript">QU('coderess','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=coderess" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13425.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
wasm.ru/article.php?article=drvw2k03
<br><br><font size="1"><i>-----<br>Gutta cavat lapidem. Feci, quod potui. Faciant meliora potentes</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=214662&amp;user=16383&amp;forum_n=6&amp;topic=13425.html&amp;page=0&amp;anchor=6" class="addthx" data-post="214662"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]NeoTall[/b]','')">NeoTall</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 36.8 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.61'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=817">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 декабря 2008 21:27 <br><script type="text/javascript">QU('NeoTall','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=NeoTall" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13425.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
Всем ОГРОМНОЕ СПАСИБО за помощь...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=214739&amp;user=817&amp;forum_n=6&amp;topic=13425.html&amp;page=0&amp;anchor=7" class="addthx" data-post="214739"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]NeoTall[/b]','')">NeoTall</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 36.8 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.61'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=817">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 декабря 2008 09:04 &middot; Поправил: NeoTall <br><script type="text/javascript">QU('NeoTall','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=NeoTall" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13425.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
Всем привет...<br><br>Появился такой вопрос.<br><b>Как унифицировать работу драйвера в системах NT/2k/XP/2k3/Vista?</b><br><br>В аттаче, рабочий (в WinXP) пример от MSRem&#039;а (бинарники, сурсы и утилита загрузки - 28кБ). Однако, как оказалось, он не загружается в Win2k3 (и думаю в Vista тоже). Кто может подсказать, в чем ошибка?<br><br>З.Ы. Пересобирал исходники с помощью Win2k3 DDK (3790.1830) как с настройками &quot;FRE WNET&quot;, так и с настройками &quot;FRE WXP&quot;...результат один.<br><br>Ну, и вопрос на будущее (пока не к спеху):<br><b>Будет ли этот драйвер работать в 64битной системе? Или же его надо пересобирать с &quot;FRE 64&quot;?</b><br><br>Заранее Спасибо... С Наступающими, Всех, Праздниками!!!<br><br><img src="img/attach.gif" alt=""> <a href="./files/86dd_27.12.2008_CRACKLAB.rU.tgz">86dd_27.12.2008_CRACKLAB.rU.tgz</a> - drivers_in_win2003.7z
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=215222&amp;user=817&amp;forum_n=6&amp;topic=13425.html&amp;page=0&amp;anchor=8" class="addthx" data-post="215222"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]Tim[/b]','')">Tim</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 253.9 (наставник)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.91'>Активность: 0.13<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=161">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 декабря 2008 09:41 <br><script type="text/javascript">QU('Tim','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Tim" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13425.html&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
<I>NeoTall пишет:<br>Будет ли этот драйвер работать в 64битной системе? Или же его надо пересобирать с &quot;FRE 64&quot;?  </I><br>конечно пересобирать. и возможно даже код придется чуть поправить (особенно если asm используется)
<br><br><font size="1"><i>-----<br>MicroSoft? Is it some kind of a toilet paper?</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=215223&amp;user=161&amp;forum_n=6&amp;topic=13425.html&amp;page=0&amp;anchor=9" class="addthx" data-post="215223"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]NeoTall[/b]','')">NeoTall</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 36.8 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.61'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=817">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 декабря 2008 09:45 <br><script type="text/javascript">QU('NeoTall','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=NeoTall" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13425.html&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
Ну, это я предполагал, но мне пока это не так важно. Больше интересует первый вопрос. Спасибо.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=215224&amp;user=817&amp;forum_n=6&amp;topic=13425.html&amp;page=0&amp;anchor=10" class="addthx" data-post="215224"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]coderess[/b]','')">coderess</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/16383.jpg" alt=""><br><span class=txtSm>Ранг: 355.4 (мудрец), 55thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.21'>Активность: 0.32<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=16383">Uploader</a><br><font color=blue>5KRT</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 декабря 2008 11:25 <br><script type="text/javascript">QU('coderess','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=coderess" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13425.html&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
<i class=x>В аттаче, рабочий (в WinXP) пример от MSRem&#039;а (бинарники, сурсы и утилита загрузки - 28кБ). Однако, как оказалось, он не загружается в Win2k3 (и думаю в Vista тоже). Кто может подсказать, в чем ошибка? </i><br><br>в Windows Vista введена цифровая подпись на драйверах<br>windowshelp.microsoft.com/Windows/ru-RU/help/5622d7d6-531b-4e76-be48-0059d38339c41049.mspx<br><br>Руководство по подписи драйверов oszone.net/4846_2
<br><br><font size="1"><i>-----<br>Gutta cavat lapidem. Feci, quod potui. Faciant meliora potentes</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=215229&amp;user=16383&amp;forum_n=6&amp;topic=13425.html&amp;page=0&amp;anchor=11" class="addthx" data-post="215229"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]SLV[/b]','')">SLV</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 309.8 (мудрец), 21thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.69'>Активность: 0.17<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=663">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 декабря 2008 14:46 &middot; Поправил: SLV <br><script type="text/javascript">QU('SLV','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=SLV" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13425.html&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
эцп в 64битной висте. ответ почему не работает на других осях прямо в DriverEntry написан.
<br><br><font size="1"><i>-----<br>Shalom ebanats!</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=215240&amp;user=663&amp;forum_n=6&amp;topic=13425.html&amp;page=0&amp;anchor=12" class="addthx" data-post="215240"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]NeoTall[/b]','')">NeoTall</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 36.8 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.61'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=817">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 декабря 2008 10:58 <br><script type="text/javascript">QU('NeoTall','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=NeoTall" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13425.html&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
<b>2 coderess</b><br>С вистой понятно, а как быть с Windows 200<b>3</b> Server?<br><br><b>2 SLV</b><br>Я может и первый раз что-то с драйвером пытаюсь &quot;замутить&quot;, но на такие грабли:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;<span class="hl_char">(</span><span class="hl_char">*</span>NtBuildNumber<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;<span class="hl_number">2195</span>&nbsp;<span class="hl_char">:</span>&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>win&nbsp;2k</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OpenProcId&nbsp;<span class="hl_char">=</span>&nbsp;0x06A<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>break</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;<span class="hl_number">2600</span>&nbsp;<span class="hl_char">:</span>&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>win&nbsp;xp</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OpenProcId&nbsp;<span class="hl_char">=</span>&nbsp;0x07A<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>break</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default&nbsp;<span class="hl_char">:</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;STATUS_NOT_IMPLEMENTED<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>break</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;}</li>        </ol>
    </div>
</div></div>
<br>не наступлю.<br>Добавление:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;<span class="hl_number">3790</span>&nbsp;<span class="hl_char">:</span>&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>win&nbsp;<span class="hl_number">2003</span>&nbsp;server</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OpenProcId&nbsp;<span class="hl_char">=</span>&nbsp;0x080<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>break</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;<span class="hl_number">6000</span>&nbsp;<span class="hl_char">:</span>&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>win&nbsp;vista</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OpenProcId&nbsp;<span class="hl_char">=</span>&nbsp;0x0BF<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>break</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;<span class="hl_number">6001</span>&nbsp;<span class="hl_char">:</span>&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>win&nbsp;vista</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OpenProcId&nbsp;<span class="hl_char">=</span>&nbsp;0x0BF<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>break</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;<span class="hl_number">6002</span>&nbsp;<span class="hl_char">:</span>&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>win&nbsp;vista</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OpenProcId&nbsp;<span class="hl_char">=</span>&nbsp;0x0BF<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>break</b></span><span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div>
        <br>никак не помогает. Я же четко написал &quot;...он <b>не загружается</b> в Win2k3&quot;, а не &quot;<b>не работает</b>&quot;... Вот в чем вопрос!!!
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=215359&amp;user=817&amp;forum_n=6&amp;topic=13425.html&amp;page=0&amp;anchor=13" class="addthx" data-post="215359"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]coderess[/b]','')">coderess</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/16383.jpg" alt=""><br><span class=txtSm>Ранг: 355.4 (мудрец), 55thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.21'>Активность: 0.32<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=16383">Uploader</a><br><font color=blue>5KRT</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 декабря 2008 00:12 &middot; Поправил: coderess <br><script type="text/javascript">QU('coderess','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=coderess" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13425.html&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
Грабли используют: <img src="img/smilies/s2.gif" alt=""><br><br>wasm.ru/forum/viewtopic.php?id=30413<br><br>С Windows 2003 Server не сталкивался, и если уже говорить <br>то весь код приводить нужно, а не отдельные куски...
<br><br><font size="1"><i>-----<br>Gutta cavat lapidem. Feci, quod potui. Faciant meliora potentes</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=215499&amp;user=16383&amp;forum_n=6&amp;topic=13425.html&amp;page=0&amp;anchor=14" class="addthx" data-post="215499"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]NeoTall[/b]','')">NeoTall</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 36.8 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.61'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=817">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 декабря 2008 08:20 <br><script type="text/javascript">QU('NeoTall','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=NeoTall" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13425.html&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
<b>2 coderess</b><br>И что я должен вынести из этого топика? Я его уже читал.<br>Насчет полного кода DriverEntry он есть в аттаче.<br><br>Как оказалось, даже такой драйвер:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">#include&nbsp;<span class="hl_char">&lt;</span>ntddk<span class="hl_char">.</span>h<span class="hl_char">&gt;</span></li><li class="hl_l1"></li><li class="hl_l0">#define&nbsp;DEBUG</li><li class="hl_l1"></li><li class="hl_l0"><span class="hl_char">/</span><span class="hl_char">*</span></li><li class="hl_l1">Создаем&nbsp;макрос&nbsp;для&nbsp;вывода&nbsp;отладочных&nbsp;сообщений&nbsp;</li><li class="hl_l0">в&nbsp;случае&nbsp;компиляции&nbsp;с&nbsp;директивой&nbsp;DEBUG</li><li class="hl_l1"><span class="hl_char">*</span><span class="hl_char">/</span></li><li class="hl_l0"></li><li class="hl_l1">#ifdef&nbsp;DEBUG</li><li class="hl_l0">&nbsp;&nbsp;#define&nbsp;DPRINT&nbsp;DbgPrint</li><li class="hl_l1">#else</li><li class="hl_l0">&nbsp;&nbsp;#define&nbsp;DPRINT</li><li class="hl_l1">#endif</li><li class="hl_l0"></li><li class="hl_l1"></li><li class="hl_l0"><span class="hl_function"><b>VOID</b></span>&nbsp;DriverUnload<span class="hl_char">(</span><span class="hl_function"><b>IN</b></span>&nbsp;PDRIVER_OBJECT&nbsp;DriverObject<span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DPRINT<span class="hl_char">(</span><span class="hl_quote">&quot;Driver unloaded&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return<span class="hl_comment">;</span></li><li class="hl_l0">}</li><li class="hl_l1"></li><li class="hl_l0">NTSTATUS&nbsp;DriverEntry<span class="hl_char">(</span><span class="hl_function"><b>IN</b></span>&nbsp;PDRIVER_OBJECT&nbsp;DriverObject<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>IN</b></span>&nbsp;PUNICODE_STRING&nbsp;RegistryPath<span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DPRINT<span class="hl_char">(</span><span class="hl_quote">&quot;Driver loaded&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;DriverObject<span class="hl_char">-</span><span class="hl_char">&gt;</span>DriverUnload&nbsp;<span class="hl_char">=</span>&nbsp;DriverUnload<span class="hl_comment">;</span></li><li class="hl_l1"></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;STATUS_SUCCESS<span class="hl_comment">;</span></li><li class="hl_l1">}</li>        </ol>
    </div>
</div></div>
<br>не загружается в Windows 2003 Server... Сборку делал как для WXP, так и для WNET.<br><br>Будут ли еще какие-нибудь предложения?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=215527&amp;user=817&amp;forum_n=6&amp;topic=13425.html&amp;page=0&amp;anchor=15" class="addthx" data-post="215527"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]Av0id[/b]','')">Av0id</a></b><br></div>
<img src="img/s8.gif" alt=""><br><span class=txtSm>Ранг: 516.1 (<b>!</b>), 39thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.38'>Активность: 0.28<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1378">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 31 декабря 2008 17:37 <br><script type="text/javascript">QU('Av0id','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Av0id" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13425.html&amp;page=0#16');return false;">#16</a> </span><div align=left><br>
может сертификат нужно чтобы заработал твой драйвер?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=215840&amp;user=1378&amp;forum_n=6&amp;topic=13425.html&amp;page=0&amp;anchor=16" class="addthx" data-post="215840"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]Ratinsh[/b]','')">Ratinsh</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 191.8 (ветеран), 46thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.54'>Активность: 0.17<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3333">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 31 декабря 2008 19:30 <br><script type="text/javascript">QU('Ratinsh','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Ratinsh" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13425.html&amp;page=0#17');return false;">#17</a> </span><div align=left><br>
я не ставил Win2k3, но мож попробовать - у Уолтера Они видел<br><br>extern &quot;C&quot; NTSTATUS ...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=215857&amp;user=3333&amp;forum_n=6&amp;topic=13425.html&amp;page=0&amp;anchor=17" class="addthx" data-post="215857"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]NeoTall[/b]','')">NeoTall</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 36.8 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.61'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=817">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 января 2009 16:14 <br><script type="text/javascript">QU('NeoTall','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=NeoTall" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13425.html&amp;page=0#18');return false;">#18</a> </span><div align=left><br>
Все оказалось гораздо проще. Криво происходила загрузка через ZwLoadDiver.<br><br>Но появился такой вопрос:<br><b>Как винда программно отключает винт? Что надо хукать чтобы предотвратить это?</b>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=216137&amp;user=817&amp;forum_n=6&amp;topic=13425.html&amp;page=0&amp;anchor=18" class="addthx" data-post="216137"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]coderess[/b]','')">coderess</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/16383.jpg" alt=""><br><span class=txtSm>Ранг: 355.4 (мудрец), 55thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.21'>Активность: 0.32<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=16383">Uploader</a><br><font color=blue>5KRT</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 января 2009 17:21 <br><script type="text/javascript">QU('coderess','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=coderess" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13425.html&amp;page=0#19');return false;">#19</a> </span><div align=left><br>
<i class=x>Как винда программно отключает винт?</i><br><br>автоматическое отключение дисков при простое
<br><br><font size="1"><i>-----<br>Gutta cavat lapidem. Feci, quod potui. Faciant meliora potentes</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=216143&amp;user=16383&amp;forum_n=6&amp;topic=13425.html&amp;page=0&amp;anchor=19" class="addthx" data-post="216143"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="20" onfocus="this.blur()" href="JavaScript:di('[b]NeoTall[/b]','')">NeoTall</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 36.8 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.61'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=817">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 января 2009 18:32 <br><script type="text/javascript">QU('NeoTall','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=NeoTall" target="_blank">Личное сообщение</a> &middot;  <a href="#20" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13425.html&amp;page=0#20');return false;">#20</a> </span><div align=left><br>
<b>2 coderess</b><br>Пошутил, да? Я оценил и улыбнулся. Зачем флудить то и меня на это вынуждать?<br><br>Хорошо, задам вопрос по другому:<br><b>Используя какие API, винда программно выключает винт при простое?</b>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=216149&amp;user=817&amp;forum_n=6&amp;topic=13425.html&amp;page=0&amp;anchor=20" class="addthx" data-post="216149"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="21" onfocus="this.blur()" href="JavaScript:di('[b]coderess[/b]','')">coderess</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/16383.jpg" alt=""><br><span class=txtSm>Ранг: 355.4 (мудрец), 55thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.21'>Активность: 0.32<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=16383">Uploader</a><br><font color=blue>5KRT</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 января 2009 19:41 &middot; Поправил: coderess <br><script type="text/javascript">QU('coderess','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=coderess" target="_blank">Личное сообщение</a> &middot;  <a href="#21" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13425.html&amp;page=0#21');return false;">#21</a> </span><div align=left><br>
www.wasm.ru/article.php?article=atazen01
<br><br><font size="1"><i>-----<br>Gutta cavat lapidem. Feci, quod potui. Faciant meliora potentes</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=216158&amp;user=16383&amp;forum_n=6&amp;topic=13425.html&amp;page=0&amp;anchor=21" class="addthx" data-post="216158"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="22" onfocus="this.blur()" href="JavaScript:di('[b]HiEndsoft[/b]','')">HiEndsoft</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 237.0 (наставник), 20thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.74'>Активность: 0.13<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=13651">Участник</a><br><font color=blue>sysenter</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 января 2009 20:15 &middot; Поправил: HiEndsoft <br><script type="text/javascript">QU('HiEndsoft','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=HiEndsoft" target="_blank">Личное сообщение</a> &middot;  <a href="#22" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13425.html&amp;page=0#22');return false;">#22</a> </span><div align=left><br>
<I>NeoTall пишет:<br>Используя какие API, винда программно выключает винт при простое? </I><br>Можно было бы и самому DeviceIOControl  поперехватывать и посмотреть....<br>Вот код на Си (писал когда-то &quot;убивалку&quot; винта в цикле &quot;пуск&quot;-&quot;стоп&quot; шпинделя):<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"></li><li class="hl_l1"><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span></li><li class="hl_l0"><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span></li><li class="hl_l1"><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span></li><li class="hl_l0"><span class="hl_function"><b>char</b></span>&nbsp;ou<span class="hl_char">[</span>0x0С<span class="hl_char">]</span><span class="hl_comment">;</span></li><li class="hl_l1">memset<span class="hl_char">(</span>ou<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span><span class="hl_function">sizeof</span><span class="hl_char">(</span>ou<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">ou<span class="hl_char">[</span><span class="hl_number">6</span><span class="hl_char">]</span><span class="hl_char">=</span>0xe0<span class="hl_comment">;</span></li><li class="hl_l1">DeviceIoControl<span class="hl_char">(</span>hSMARTIOCTL<span class="hl_char">,</span>IOCTL_IDE_PASS_THROUGH<span class="hl_char">,</span><span class="hl_char">(</span>LPVOID<span class="hl_char">)</span>&nbsp;ou<span class="hl_char">,</span>&nbsp;0x0c<span class="hl_char">,</span><span class="hl_char">(</span>LPVOID<span class="hl_char">)</span>&nbsp;iu<span class="hl_char">,</span><span class="hl_function">sizeof</span><span class="hl_char">(</span>iu<span class="hl_char">)</span><span class="hl_char">,</span><span class="hl_char">&amp;</span>BytesReturned<span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">)</span><span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div><br><br><font size="1"><i>-----<br>продавец резиновых утёнков</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=216160&amp;user=13651&amp;forum_n=6&amp;topic=13425.html&amp;page=0&amp;anchor=22" class="addthx" data-post="216160"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="23" onfocus="this.blur()" href="JavaScript:di('[b]NeoTall[/b]','')">NeoTall</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 36.8 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.61'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=817">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 января 2009 14:26 <br><script type="text/javascript">QU('NeoTall','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=NeoTall" target="_blank">Личное сообщение</a> &middot;  <a href="#23" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13425.html&amp;page=0#23');return false;">#23</a> </span><div align=left><br>
Благодарю всех за помощь...однако пока не все как оказалось.<br><br><b>2 HiEndsoft</b><br>А почему Вы используете <i class=x>ou[6]=0xe<b>0</b>;</i>? В статье, которую посоветовал <b>coderess</b>, указано другое значение:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">Ну&nbsp;и&nbsp;наконец&nbsp;<span class="hl_char">-</span>&nbsp;команда&nbsp;остановки&nbsp;винчестера<span class="hl_char">.</span>&nbsp;Все&nbsp;абсолютно&nbsp;аналогично&nbsp;предыдущему&nbsp;пункту<span class="hl_char">,</span>&nbsp;только&nbsp;код&nbsp;<span class="hl_char">-</span>&nbsp;<span class="hl_char">&lt;</span>b<span class="hl_char">&gt;</span>E6h<span class="hl_char">&lt;</span><span class="hl_char">/</span>b<span class="hl_char">&gt;</span><span class="hl_char">,</span>&nbsp;и&nbsp;никаких&nbsp;данных&nbsp;принимать&nbsp;не&nbsp;надо<span class="hl_char">,</span>&nbsp;сразу&nbsp;после&nbsp;посылки&nbsp;в&nbsp;<span class="hl_number">1F7h</span>&nbsp;байта&nbsp;<span class="hl_char">&lt;</span>b<span class="hl_char">&gt;</span>E6h<span class="hl_char">&lt;</span><span class="hl_char">/</span>b<span class="hl_char">&gt;</span>&nbsp;веник&nbsp;отправляется&nbsp;смотреть&nbsp;сладкие&nbsp;сны&nbsp;<span class="hl_char">(</span>&nbsp;процесс&nbsp;осановки&nbsp;будет&nbsp;слышно<span class="hl_char">)</span><span class="hl_char">.</span>&nbsp;Будить&nbsp;его&nbsp;лучше&nbsp;всего&nbsp;сбросом&nbsp;<span class="hl_char">(</span>установкой&nbsp;бита&nbsp;<span class="hl_number">2</span>&nbsp;в&nbsp;<span class="hl_number">3F6h</span><span class="hl_char">)</span><span class="hl_char">.</span></li>        </ol>
    </div>
</div></div>
<br>Да, и в подтверждение этого, скомпилив Ваш код с <i class=x>ou[6]=0xe<b>0</b>;</i> остановки не получилось, а вот с <i class=x>ou[6]=0xe<b>6</b>;</i>, все прошло успешно, диск остановился. ...Да и в DDK:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">#define&nbsp;SCSIOP_DENON_EJECT_DISC&nbsp;&nbsp;&nbsp;&nbsp;0xE6</li>        </ol>
    </div>
</div></div>
<br><br>Теперь как программно остановить диск стало ясно, отлично. Далее я сделал перехват <i class=x>NtDeviceIOControlFile</i> фильтруя значение <i class=x>IOControlCode</i> (на равенство <i class=x>IOCTL_IDE_PASS_THROUGH</i>) и 6-ого байта <i class=x>InputBuffer</i> (на равенство <i class=x>0хЕ6</i>). В результате получил вот что: <br>Если использовать Ваш, <b>HiEndsoft</b>, код (с правкой), то загруженный драйвер прекрасно справляется с задачей, перехватывает <i class=x>NtDeviceIOControlFile</i> (вызов <i class=x>DeviceIOControl</i>) и правильно обрабатывает данные, но <i class=x>если настроить систему питания на отключение дисков при простое, загрузить драйвер, и ждать, то диски как останавливались, так и останавливаются!!!</i><br><br><b>Помогите разобраться. В чем дело? Как блокировать отключение дисков системой при простое?</b>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=216237&amp;user=817&amp;forum_n=6&amp;topic=13425.html&amp;page=0&amp;anchor=23" class="addthx" data-post="216237"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="24" onfocus="this.blur()" href="JavaScript:di('[b]coderess[/b]','')">coderess</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/16383.jpg" alt=""><br><span class=txtSm>Ранг: 355.4 (мудрец), 55thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.21'>Активность: 0.32<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=16383">Uploader</a><br><font color=blue>5KRT</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 января 2009 16:06 <br><script type="text/javascript">QU('coderess','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=coderess" target="_blank">Личное сообщение</a> &middot;  <a href="#24" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13425.html&amp;page=0#24');return false;">#24</a> </span><div align=left><br>
IOCTL_SCSI_PASS_THROUGH подходит как для IDE, так и для SCSI
<br><br><font size="1"><i>-----<br>Gutta cavat lapidem. Feci, quod potui. Faciant meliora potentes</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=216254&amp;user=16383&amp;forum_n=6&amp;topic=13425.html&amp;page=0&amp;anchor=24" class="addthx" data-post="216254"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="25" onfocus="this.blur()" href="JavaScript:di('[b]NeoTall[/b]','')">NeoTall</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 36.8 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.61'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=817">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 января 2009 20:53 <br><script type="text/javascript">QU('NeoTall','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=NeoTall" target="_blank">Личное сообщение</a> &middot;  <a href="#25" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13425.html&amp;page=0#25');return false;">#25</a> </span><div align=left><br>
<I>coderess пишет:<br><br>IOCTL_SCSI_PASS_THROUGH подходит как для IDE, так и для SCSI  </I><br>Неа.<br>Вот кусок кода. Можете смеяться, в С я не очень шарю.<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">NTSTATUS&nbsp;NewNtDeviceIoControlFile<span class="hl_char">(</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>IN</b></span>&nbsp;HANDLE&nbsp;FileHandle<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>IN</b></span>&nbsp;HANDLE&nbsp;Event&nbsp;OPTIONAL<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>IN</b></span>&nbsp;PIO_APC_ROUTINE&nbsp;ApcRoutine&nbsp;OPTIONAL<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>IN</b></span>&nbsp;PVOID&nbsp;ApcContext&nbsp;OPTIONAL<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>OUT</b></span>&nbsp;PIO_STATUS_BLOCK&nbsp;IoStatusBlock<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>IN</b></span>&nbsp;ULONG&nbsp;IoControlCode<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>IN</b></span>&nbsp;PVOID&nbsp;InputBuffer&nbsp;OPTIONAL<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>IN</b></span>&nbsp;ULONG&nbsp;InputBufferLength<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>OUT</b></span>&nbsp;PVOID&nbsp;OutputBuffer&nbsp;OPTIONAL<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>IN</b></span>&nbsp;ULONG&nbsp;OutputBufferLength</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span><span class="hl_char">(</span>IoControlCode&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;IOCTL_IDE_PASS_THROUGH<span class="hl_char">)</span>&nbsp;<span class="hl_char">|</span><span class="hl_char">|</span>&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">(</span>IoControlCode&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;IOCTL_ATA_PASS_THROUGH<span class="hl_char">)</span>&nbsp;<span class="hl_char">|</span><span class="hl_char">|</span>&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">(</span>IoControlCode&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;IOCTL_ATA_PASS_THROUGH_DIRECT<span class="hl_char">)</span>&nbsp;<span class="hl_char">|</span><span class="hl_char">|</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">(</span>IoControlCode&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;IOCTL_SCSI_PASS_THROUGH<span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>BYTE</b></span>&nbsp;<span class="hl_char">*</span>p<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;p&nbsp;<span class="hl_char">=</span>&nbsp;InputBuffer<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;DbgPrint<span class="hl_char">(</span><span class="hl_quote">&quot;Hook works #1... /NtDeviceIoControlFile/&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>p<span class="hl_char">[</span><span class="hl_number">6</span><span class="hl_char">]</span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;0xE6<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DbgPrint<span class="hl_char">(</span><span class="hl_quote">&quot;Hook works #2... /NtDeviceIoControlFile/&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;STATUS_SUCCESS<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;TrueNtDeviceIoControlFile<span class="hl_char">(</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FileHandle<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Event<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ApcRoutine<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ApcContext<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IoStatusBlock<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IoControlCode<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InputBuffer<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InputBufferLength<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OutputBuffer<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OutputBufferLength</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;else</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;TrueNtDeviceIoControlFile<span class="hl_char">(</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FileHandle<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Event<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ApcRoutine<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ApcContext<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IoStatusBlock<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IoControlCode<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InputBuffer<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InputBufferLength<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OutputBuffer<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OutputBufferLength</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">}</li>        </ol>
    </div>
</div></div>
<br>Обрабатываю все возможные варианты IOControl&#039;а. Но системную остановку это не перехватавает. Что еще посоветуете? Могу выложить полный исходник драйвера, если надо...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=216292&amp;user=817&amp;forum_n=6&amp;topic=13425.html&amp;page=0&amp;anchor=25" class="addthx" data-post="216292"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="26" onfocus="this.blur()" href="JavaScript:di('[b]HiEndsoft[/b]','')">HiEndsoft</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 237.0 (наставник), 20thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.74'>Активность: 0.13<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=13651">Участник</a><br><font color=blue>sysenter</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 января 2009 21:46 &middot; Поправил: HiEndsoft <br><script type="text/javascript">QU('HiEndsoft','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=HiEndsoft" target="_blank">Личное сообщение</a> &middot;  <a href="#26" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13425.html&amp;page=0#26');return false;">#26</a> </span><div align=left><br>
<I>NeoTall пишет:<br>А почему Вы используете ou[6]=0xe0;? </I><br>--блин, реально очепятка<br>У меня работает: и SATA и IDE -тормозит с парковкой.<br>Вообще - вариантов помню несколько было...(в каких - то тулзах типа HDDScan сплайсил DeviceIoControl..)<br>Перед этим делаю IOCTL_SCSI_RESCAN_BUS.<br>Еще вариант:
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">ou<span class="hl_char">[</span><span class="hl_number">0</span><span class="hl_char">]</span><span class="hl_char">=</span>0x28<span class="hl_comment">; ou[2]=0x01; ou[12]=0x5;ou[20]=0x28; ou[37]=0xA0;</span></li><li class="hl_l1">ou<span class="hl_char">[</span><span class="hl_number">38</span><span class="hl_char">]</span><span class="hl_char">=</span>0xe2<span class="hl_comment">; //&lt;-OFF</span></li><li class="hl_l0">или</li><li class="hl_l1">ou<span class="hl_char">[</span><span class="hl_number">38</span><span class="hl_char">]</span><span class="hl_char">=</span>0x10<span class="hl_comment">;//-&lt;ON </span></li><li class="hl_l0"><span class="hl_char">/</span><span class="hl_char">/</span>соответственно&nbsp;с&nbsp;dwIoControlCode<span class="hl_char">=</span><span class="hl_char">&lt;</span>b<span class="hl_char">&gt;</span>0x0004D028<span class="hl_char">&lt;</span><span class="hl_char">/</span>b<span class="hl_char">&gt;</span></li>        </ol>
    </div>
</div></div>
<br>В те времена в наличии полного комплекта NTDDK не было, приходилось извращаться.
<br><br><font size="1"><i>-----<br>продавец резиновых утёнков</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=216293&amp;user=13651&amp;forum_n=6&amp;topic=13425.html&amp;page=0&amp;anchor=26" class="addthx" data-post="216293"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="27" onfocus="this.blur()" href="JavaScript:di('[b]NeoTall[/b]','')">NeoTall</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 36.8 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.61'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=817">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 января 2009 16:37 <br><script type="text/javascript">QU('NeoTall','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=NeoTall" target="_blank">Личное сообщение</a> &middot;  <a href="#27" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13425.html&amp;page=0#27');return false;">#27</a> </span><div align=left><br>
Привет...<br><br>Спасибо за подсказки. <br><br>Вот какой еще вопрос возник:<br><b>Какими API винда отключает систему, перезагружает ее или завершает сеанс?</b><br><br>Посмотрел драйвер HideToolz, там MsRem вроде перехватывает:<br><i class=x>ZwSetSystemPowerState<br>ZwShutdownSystem<br>ZwRaiseHardError<br>ZwInitiatePowerAction<br>ExitWindowsEx</i><br>первые 4 я перехватываю, HookAnalyzer правильно определяет перехваченные функи, однако винда все равно перезагружает комп.<br><br>Посоветуйте, как блокировать перезагрузку компа?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=216683&amp;user=817&amp;forum_n=6&amp;topic=13425.html&amp;page=0&amp;anchor=27" class="addthx" data-post="216683"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="28" onfocus="this.blur()" href="JavaScript:di('[b]coderess[/b]','')">coderess</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/16383.jpg" alt=""><br><span class=txtSm>Ранг: 355.4 (мудрец), 55thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.21'>Активность: 0.32<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=16383">Uploader</a><br><font color=blue>5KRT</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 января 2009 17:00 &middot; Поправил: coderess <br><script type="text/javascript">QU('coderess','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=coderess" target="_blank">Личное сообщение</a> &middot;  <a href="#28" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13425.html&amp;page=0#28');return false;">#28</a> </span><div align=left><br>
Я завершал работу системы вызовом ZwShutdownSystem <br>с получением прав на перезагрузку SE_SHUTDOWN_PRIVILEGE<br>Вот пример<br>rootkits.ru/viewtopic.php?id=616<br><br><br>Также с помощью CsrClientCallServer можно, мини описание:<br>bugtraq.ru/library/internals/shut.html<br><br>bugtraq.ru/library/internals/.keep/shut.cpp.txt
<br><br><font size="1"><i>-----<br>Gutta cavat lapidem. Feci, quod potui. Faciant meliora potentes</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=216685&amp;user=16383&amp;forum_n=6&amp;topic=13425.html&amp;page=0&amp;anchor=28" class="addthx" data-post="216685"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="29" onfocus="this.blur()" href="JavaScript:di('[b]NeoTall[/b]','')">NeoTall</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 36.8 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.61'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=817">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 января 2009 17:58 <br><script type="text/javascript">QU('NeoTall','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=NeoTall" target="_blank">Личное сообщение</a> &middot;  <a href="#29" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13425.html&amp;page=0#29');return false;">#29</a> </span><div align=left><br>
<b>coderess</b><br>Спасибо. Попробую перехватить еще и <i class=x>CsrClientCallServer</i>.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=216693&amp;user=817&amp;forum_n=6&amp;topic=13425.html&amp;page=0&amp;anchor=29" class="addthx" data-post="216693"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Вопрос по перехвату API</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#30" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="6">
<input type="hidden" name="topic" value="13425">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=13425" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
