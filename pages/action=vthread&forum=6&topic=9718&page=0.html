<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Проблема с прерыванием АЦП НВЛ-45 - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Есть АЦП НВЛ-45, приобретённый через www.signal.ru. Пишу для него WDM драйвер, т.к. родной не выполняет нужные задачи. Имеется: WinXP, VC++2005, DriverStudio 3.2 Возникла проблема. При срабатывании прерывания (чтение данных">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=39467'>hgdagon</a> (+5 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Проблема с прерыванием АЦП НВЛ-45</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]legos[/b]','')">legos</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.93'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=12677">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 21 августа 2007 16:50 <br><script type="text/javascript">QU('legos','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=legos" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=9718.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Есть АЦП НВЛ-45, приобретённый через www.signal.ru.<br>Пишу для него WDM драйвер,<br>т.к. родной не выполняет нужные задачи.<br>Имеется: WinXP, VC++2005, DriverStudio 3.2<br><br>Возникла проблема. <br>При срабатывании прерывания (чтение данных завершено)<br>запрос на него должен автоматически сниматься<br>при первом чтении из памяти устройства (по документации),<br>а он не снимается - происходит постоянно вызов ISR-процедуры,<br>даже когда в ней провожу конфигурирование платы с запретом прерываний.<br><br>Что можно предпринять в этом случае? <br>Кто-нибудь имел дело с такой платой?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=153553&amp;user=12677&amp;forum_n=6&amp;topic=9718.html&amp;page=0&amp;anchor=1" class="addthx" data-post="153553"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]Chingachguk[/b]','')">Chingachguk</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/8962.jpg" alt=""><br><span class=txtSm>Ранг: 113.0 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.51'>Активность: 0.05<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=8962">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 22 августа 2007 13:50 <br><script type="text/javascript">QU('Chingachguk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Chingachguk" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=9718.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
&gt; Что можно предпринять в этом случае?<br><br>не имел дело с таким девайсом, но вроде как &quot;native&quot; драйвер успешно работает с ним (с обработкой прерывания)? Сними лог обращения к портам/посмотри сам драйвер и найди отличия.
<br><br><font size="1"><i>-----<br>The one derivative you manage is the one I abhore (c) Slipknot</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=153676&amp;user=8962&amp;forum_n=6&amp;topic=9718.html&amp;page=0&amp;anchor=2" class="addthx" data-post="153676"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]overwriter[/b]','')">overwriter</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/8266.jpg" alt=""><br><span class=txtSm>Ранг: 155.4 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.6'>Активность: 0.14<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=8266">Участник</a><br><font color=blue>Робо-Алкаш</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 22 августа 2007 21:53 <br><script type="text/javascript">QU('overwriter','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=overwriter" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=9718.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
А дле чего вообще такой девайс?
<br><br><font size="1"><i>-----<br>Researcher</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=153734&amp;user=8266&amp;forum_n=6&amp;topic=9718.html&amp;page=0&amp;anchor=3" class="addthx" data-post="153734"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]Chingachguk[/b]','')">Chingachguk</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/8962.jpg" alt=""><br><span class=txtSm>Ранг: 113.0 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.51'>Активность: 0.05<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=8962">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 августа 2007 01:17 <br><script type="text/javascript">QU('Chingachguk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Chingachguk" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=9718.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
АЦП вроде бы аналого-цифровой преобразователь... Допустим, сигналы от других цивилизациев с антены в числа переводить <img src="img/smilies/s2.gif" alt="">
<br><br><font size="1"><i>-----<br>The one derivative you manage is the one I abhore (c) Slipknot</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=153765&amp;user=8962&amp;forum_n=6&amp;topic=9718.html&amp;page=0&amp;anchor=4" class="addthx" data-post="153765"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]legos[/b]','')">legos</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.93'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=12677">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 августа 2007 20:22 <br><script type="text/javascript">QU('legos','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=legos" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=9718.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
Что такое native драйвер?<br>И чем снимать лог обращения к портам - просто в отладчике отследить?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=153869&amp;user=12677&amp;forum_n=6&amp;topic=9718.html&amp;page=0&amp;anchor=5" class="addthx" data-post="153869"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]Chingachguk[/b]','')">Chingachguk</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/8962.jpg" alt=""><br><span class=txtSm>Ранг: 113.0 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.51'>Активность: 0.05<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=8962">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 августа 2007 23:53 <br><script type="text/javascript">QU('Chingachguk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Chingachguk" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=9718.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
&quot;native&quot;&#039;ом я назвал тот, который вроде как работает, но не так, как б хотелось.<br><br>Да, в отладчике, но так как драйвер (sys) работает в нулевом кольце (вроде), то перехват (bpio) в софтайсе скорее всего ничего не даст. К тому же из-за лагов (пока выписываешь что читается-пишется) может быть искаженная картинка.<br><br>Тут нужен либо логгер использующий отладочные регистры (DRx) - может, есть такие (я для себя писал в 98), либо возможно что драйвер не сам пишет в порты а через переходники NTKERN.<br><br>Драйвер может сам работать с портами, например:<br><br>mov dx,PORT_BASE<br>mov al,SOME_VALUE<br>out  dx,al<br><br>Но может работать через заглушки (HAL) в NTKERN, это функи (имя примерно) ~WRITE_PORT_USHORT и т.п.<br>Возможно, есть логгера как раз под это или более общие логгера где можно указать перехват именно этих функций.<br><br>Также возможен анализ самого кода драйвера в дизассемблере (IDA, etc).
<br><br><font size="1"><i>-----<br>The one derivative you manage is the one I abhore (c) Slipknot</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=153909&amp;user=8962&amp;forum_n=6&amp;topic=9718.html&amp;page=0&amp;anchor=6" class="addthx" data-post="153909"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]Ratinsh[/b]','')">Ratinsh</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 191.8 (ветеран), 46thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.54'>Активность: 0.17<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3333">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 24 августа 2007 01:45 &middot; Поправил: Ratinsh <br><script type="text/javascript">QU('Ratinsh','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Ratinsh" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=9718.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
почитал здесь<br>www.signal.ru/adc_h/internal/nvl45.htm<br>можно попробовать обнулять 13бит порта 5H <br>и после чтения памяти восстанавливать,<br>и я думаю для начала нужно попробовать в Win98.<br>(а в саппорт обращался - что говорят?)
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=153915&amp;user=3333&amp;forum_n=6&amp;topic=9718.html&amp;page=0&amp;anchor=7" class="addthx" data-post="153915"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]legos[/b]','')">legos</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.93'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=12677">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 24 августа 2007 03:54 <br><script type="text/javascript">QU('legos','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=legos" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=9718.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
Обнуляю 13-й бит 5-го порта при входе в функцию обработки прерывания<br>и считываю произвольный элемент из памяти платы,<br>но прерывание не снимается - эта функция опять вызывается постоянно,<br>комп начинает тормозить, приходится перезагружаться.<br>Специалисты signal.ru после каждого вопроса по плате присылают<br>мне своё руководство и драйвер платы от &quot;Scan Engineering Telecom&quot;<br>с руководством к нему.<br><br>В руководстве платы написано:<br><br>После заполнения требуемого количества памяти устройство NVL45<br>формирует прерывание на линии INTA# и бит готовности,<br>который расположен в нулевом разряде слова, которое читается по адресу порта 6H. <br>Лог. 0  в этом разряде означает, что буфер заполнен полностью.<br>Запрос на прерывание сбрасывается при первом чтении из памяти устройства.<br><br>Логично предположить, что раз 0 - буфер заполнен, то во время заполнения<br>буфера там единица. Я пытался ловить эту единицу, чтобы потом, дождавшись<br>там нуля, определить момент окончания записи (для избежания работы с прерыванием).<br>Но при постоянном опросе бита во-первых все остальные программы &quot;засыпают&quot;,<br>а во-вторых и это не всегда срабатывает - редко, но возникают ситуации,<br>когда единица там так и не появляется.<br><br>Конечно, можно было бы работать по таймеру, но у меня внешняя синхронизация,<br>да и период синхроимпульсов - 700мкс всего, за которые надо всё успеть -<br>и считать и обработать.<br><br><br>В руководстве драйвера от &quot;Scan Engineering Telecom&quot; описана функция:<br><br>BOOL SETPCI_SetIntrParam( SETPCI_HANDLE hSETPCI,DWORD dwAddr,DWORD dwMask);<br>Задает параметры обработчика прерываний драйвера: адрес<br>(!)регистра статуса прерываний(!)<br>и маску определяющую в каком бите проверяется флаг прерывания.<br>Регистр статуса должен быть расположен в нулевом баре устройства,<br>параметр dwAddr должен содержать смещение внутри нулевого бара в<br>32х разрядных словах. Параметр dwMask должен содержать единицу в том<br>бите в котором выставляется флаг прерывания, остальные биты должны быть<br>равны нулю.<br><br>Что за регистр, как с ним работать, где он находится - в руководстве платы ни слова<br>и разработчики молчат.<br>Может его как-то вычислить можно?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=153920&amp;user=12677&amp;forum_n=6&amp;topic=9718.html&amp;page=0&amp;anchor=8" class="addthx" data-post="153920"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]Chingachguk[/b]','')">Chingachguk</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/8962.jpg" alt=""><br><span class=txtSm>Ранг: 113.0 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.51'>Активность: 0.05<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=8962">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 24 августа 2007 11:00 <br><script type="text/javascript">QU('Chingachguk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Chingachguk" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=9718.html&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
Если выложишь (на рапидшару) драйвер sys, который работает (от разработчиков), я могу попробовать посмотреть что там делается.
<br><br><font size="1"><i>-----<br>The one derivative you manage is the one I abhore (c) Slipknot</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=153945&amp;user=8962&amp;forum_n=6&amp;topic=9718.html&amp;page=0&amp;anchor=9" class="addthx" data-post="153945"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]legos[/b]','')">legos</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.93'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=12677">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 августа 2007 14:31 <br><script type="text/javascript">QU('legos','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=legos" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=9718.html&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
Рапидшарой не пользовался<br>Во здесь архив по теме<br>www.s4in.net/pub/
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=154132&amp;user=12677&amp;forum_n=6&amp;topic=9718.html&amp;page=0&amp;anchor=10" class="addthx" data-post="154132"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]Chingachguk[/b]','')">Chingachguk</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/8962.jpg" alt=""><br><span class=txtSm>Ранг: 113.0 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.51'>Активность: 0.05<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=8962">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 августа 2007 15:24 <br><script type="text/javascript">QU('Chingachguk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Chingachguk" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=9718.html&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
Скачал, сначала планирую глянуть SETPCIM.SYS/ просьба уточнить что именно этот драйвер:<br><br>0) Работает корректно;<br>1) Он сделан производителями.
<br><br><font size="1"><i>-----<br>The one derivative you manage is the one I abhore (c) Slipknot</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=154140&amp;user=8962&amp;forum_n=6&amp;topic=9718.html&amp;page=0&amp;anchor=11" class="addthx" data-post="154140"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]legos[/b]','')">legos</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.93'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=12677">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 августа 2007 20:39 <br><script type="text/javascript">QU('legos','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=legos" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=9718.html&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
1. Драйвер от производителя Scan Engineering Telecom<br>0. Работает некорректно с прерываниями
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=154189&amp;user=12677&amp;forum_n=6&amp;topic=9718.html&amp;page=0&amp;anchor=12" class="addthx" data-post="154189"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]Chingachguk[/b]','')">Chingachguk</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/8962.jpg" alt=""><br><span class=txtSm>Ранг: 113.0 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.51'>Активность: 0.05<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=8962">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 августа 2007 20:41 <br><script type="text/javascript">QU('Chingachguk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Chingachguk" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=9718.html&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
Хех, посмотрел немнога.<br><br>Сам драйвер, походу дела что-то с портами делает, и работает именно через WRITE_PORT_USHORT и т.п. т.е. через заглушки. Т.е. лог снять вполне можно, например дописать в сам драйвер логгирующие переходники.<br><br>Основная работа с портами ведется в процедуре DriverUnload (DriverObject-&gt;DriverUnload), при этом возможно чтение какой-то группы данных.<br><br>Тем не менее хочу заметить что вроде как обработка прерывания делается совсем не в драйвере (точнее, оттуда вызывается пользовательский (!!) обработчик). Косвенным доказательством служит то, что большинство аргументов для записи в порт передаются по ссылке или довольно сложно вычисляются: и именно это демонстрирует пример &quot;intr_test&quot; из архива, в котором в main.cpp:<br><br>// пользовательская функция обработки прерываний<br>void MyIntHandler(SETPCI_HANDLE hSETPCI, LPVOID param)<br>{<br>...<br><br>Просьба все же уточнить что именно ты пишешь: свой драйвер? (sys) - где твой код для него? (чтобы было с чем сравнивать).
<br><br><font size="1"><i>-----<br>The one derivative you manage is the one I abhore (c) Slipknot</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=154190&amp;user=8962&amp;forum_n=6&amp;topic=9718.html&amp;page=0&amp;anchor=13" class="addthx" data-post="154190"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]legos[/b]','')">legos</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.93'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=12677">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 августа 2007 21:04 <br><script type="text/javascript">QU('legos','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=legos" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=9718.html&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
Пришлю чуток попозже
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=154200&amp;user=12677&amp;forum_n=6&amp;topic=9718.html&amp;page=0&amp;anchor=14" class="addthx" data-post="154200"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]Chingachguk[/b]','')">Chingachguk</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/8962.jpg" alt=""><br><span class=txtSm>Ранг: 113.0 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.51'>Активность: 0.05<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=8962">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 августа 2007 02:29 &middot; Поправил: Chingachguk <br><script type="text/javascript">QU('Chingachguk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Chingachguk" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=9718.html&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
++<br><br>Посмотрел я этот sys более-менее внимательно. Итого там практически ничего нет <img src="img/smilies/s2.gif" alt=""><br><br>.text:000105D8 ; Also handles:<br>.text:000105D8 ; IRP_MJ_READ<br>.text:000105D8 ; IRP_MJ_INTERNAL_DEVICE_CONTROL<br>.text:000105D8 ; Attributes: bp-based frame<br>.text:000105D8<br>.text:000105D8 ; int __stdcall sub105D8_CREATE_NAMED_PIPE(DEVICE_OBJECT *DeviceObject,PIRP Irp)<br>.text:000105D8 sub105D8_CREATE_NAMED_PIPE proc near    ; DATA XREF: start+4o<br><br>Вот эта процедурина предоставляет что-то вроде интерфейса для обычных (прикладных) прог: чтение порта (READ_PORT_UCHAR/USHORT/ULONG) и то же самое для записи. А какие порты читать или писать - это уж пользователю надо знать <img src="img/smilies/s2.gif" alt=""> Опять-таки это слабовато похоже на обработчик прерывания, который мог бы (например как это делает обработчик прерывания от COM-порта) снять статус &quot;есть данные&quot; через in/out команды.<br><br>Некоторый интерес представляет, уже упоминал, обработчег события UnloadDriver - он может читать какие-то блоки данных с устройства, какие он порты использует - пока не определил.<br><br>Т.е. перехват и логгирование портов вроде бы смысла не имеет - просто там ничего нет <img src="img/smilies/s2.gif" alt=""><br><br>Есть в этом архиве реально рабочий код? Может, это в intr_test? т.е. все в этой самой демо? (DLL)<br><br>+++<br><br>Небольшие вычисления адреса порта, конечно, есть:<br><br>loc_10AFA:<br>                mov     ecx, [esi+eax*4+50h]<br>                cmp     byte ptr [eax+esi+80h], 0<br>                lea     ecx, [ecx+edx*2]<br>                jz      short loc_10B10<br>                movzx   eax, word ptr [ecx]<br>                jmp     short loc_10B40<br>loc_10B10:<br>                push    ecx             ; Port<br>                call    ds:READ_PORT_USHORT<br>                movzx   eax, ax<br>                jmp     short loc_10B40<br>loc_10B1C:<br><br>Или как в вот этом интересном примере с глюком:<br><br>                mov     ecx, [esi+eax*4+50h]<br>                add     ecx, edx<br>                movzx   edx, byte ptr [ecx]<br>                mov     [edi], edx<br>                cmp     byte ptr [eax+esi+80h], 0<br>                jz      short loc_10B36<br>                movzx   eax, byte ptr [ecx]<br>                jmp     short loc_10B40<br>loc_10B36:<br>                push    ecx             ; Port<br>                call    ds:READ_PORT_UCHAR<br>                movzx   eax, al
<br><br><font size="1"><i>-----<br>The one derivative you manage is the one I abhore (c) Slipknot</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=154222&amp;user=8962&amp;forum_n=6&amp;topic=9718.html&amp;page=0&amp;anchor=15" class="addthx" data-post="154222"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Проблема с прерыванием АЦП НВЛ-45</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#16" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="6">
<input type="hidden" name="topic" value="9718">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=9718" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
