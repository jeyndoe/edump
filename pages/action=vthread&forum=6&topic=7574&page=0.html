<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Подключаю фильтр... Проблемы со стеком. - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Есть некая процедура чтения данных. Задача: в самое ее начало добавить call на свою процедуру-фильтр, выполнить (в своей процедуре) команды, вытесненные этим call и обеспечить ret из нее обратно, сохранив нетронутыми стек и все">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=39467'>hgdagon</a>, <a target='_blank' href='?action=userinfo&amp;user=28016'>asfa</a>, <a target='_blank' href='?action=userinfo&amp;user=26261'>bartolomeo</a> (+4 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Подключаю фильтр... Проблемы со стеком.</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]0xy[/b]','')">0xy</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 218.5 (наставник), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.37'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3910">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 24 января 2007 14:38 &middot; Поправил: 0xy <br><script type="text/javascript">QU('0xy','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=0xy" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7574.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Есть некая процедура чтения данных.<br><b>Задача: в самое ее начало добавить call на свою процедуру-фильтр, выполнить (в своей процедуре)  команды, вытесненные этим call и обеспечить ret из нее обратно, сохранив нетронутыми стек и все регистры.</b><br>Процедура-фильтр анализирует запрос и либо возвращает управление оригинальной процедуре чтения, либо сама выдает данные и передает управление тому, кто их запрашивал.<br>Проблема в том, что мой call вытесняет следующие инструкции:<br><code>push ebp<br>mov ebp, esp<br>add esp, -0c</code><br>и у меня не получается выполнить их и затем сделать возврат, не нарушая условий задачи <img src="img/smilies/s14.gif" alt=""><br><br>ps<br>Процедуру добавляю в Ольке
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=117387&amp;user=3910&amp;forum_n=6&amp;topic=7574.html&amp;page=0&amp;anchor=1" class="addthx" data-post="117387"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]=Usacha=[/b]','')">=Usacha=</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 13.5 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.81'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=6539">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 24 января 2007 16:34 &middot; Поправил: =Usacha= <br><script type="text/javascript">QU('=Usacha=','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto==Usacha=" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7574.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
А попробуй в начало доюалять jmp на пустое место и оттуда уже call, а перед ним - то что вытеснил джамп. (мутно обьяснил. см статейки про инлайн-патчи)<br>Если необходимо сохранять регистры, то<br>pushad<br>call<br>popad
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=117395&amp;user=6539&amp;forum_n=6&amp;topic=7574.html&amp;page=0&amp;anchor=2" class="addthx" data-post="117395"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]0xy[/b]','')">0xy</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 218.5 (наставник), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.37'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3910">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 24 января 2007 17:21 &middot; Поправил: 0xy <br><script type="text/javascript">QU('0xy','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=0xy" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7574.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
<I>=Usacha= пишет:<br>А попробуй в начало доюалять jmp на пустое место  </I><br>С jmp всё просто, но некрасиво. И при ковырянии сразу в глаза бросается...<br><br>Пробовал присобачиться так:<br>(Моя) процедура-фильтр:<br><code>pushad<br>...........<br>mov  eax, ss:[esp+20]    сохраняю адрес возврата ниже в стёке<br>mov  ss:[esp+10], eax<br>popad<br>add esp, 4    ; ставлю указатель так, как было в процедуре, к которой я присобачился<br>push ebp      ; выполняю комманды, вытесненные моим Call<br>mov ebp, esp<br>add esp, -10 ; =-0c-4<br>ret</code><br>Но проблема в том, что после выполнения add esp, 4 разрушаются данные в стеке: мой адрес возврата. Хочу узнать, насколько это закономерно? Сохранность данных в стеке ниже esp что, в принципе не гарантируется?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=117398&amp;user=3910&amp;forum_n=6&amp;topic=7574.html&amp;page=0&amp;anchor=3" class="addthx" data-post="117398"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 24 января 2007 23:42 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7574.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
<b>0xy</b><br>Ну не ниже, а выше, поскольку стек вверх ногами. В принципе программы обычно не опираются на то, что лежит в стеке выше, поэтому менять это дело можно. А вот если хитрозадая защита, то может быть она и проверяет стек выше. Для этого тут была тема, в которой чел хотел полностью стек на свой подменить. Если такой гемор не нужен, то забей на то, что верх стека перезаписывается.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=117430&amp;user=1556&amp;forum_n=6&amp;topic=7574.html&amp;page=0&amp;anchor=4" class="addthx" data-post="117430"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]stahh[/b]','')">stahh</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/3117.jpg" alt=""><br><span class=txtSm>Ранг: 127.3 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.62'>Активность: 0.07<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3117">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 января 2007 00:06 <br><script type="text/javascript">QU('stahh','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=stahh" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7574.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
<b>0xy</b>  <br>Твоя <br>push ebp <br>mov ebp, esp <br>add esp, -0c   <br>Откуд-то вызывается? Пиши в пустое место свою ф-цию. В конце своей ф-ции добавь <br>PUSH xxxxxxxx, где ххххххх - адрес  правильной ф-ции. Так аспак делает переход на ОЕП. Рет пойдет в правильную ф-цию и она уже будет работать как надо. Ну, естественно, колл в нее исправь на колл в свою. Если не понял, то приведи кусок с адресами, на адресах будет понятней.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=117438&amp;user=3117&amp;forum_n=6&amp;topic=7574.html&amp;page=0&amp;anchor=5" class="addthx" data-post="117438"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]tundra37[/b]','')">tundra37</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 310.8 (мудрец), 29thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.32'>Активность: 0.43<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=4072">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 января 2007 00:29 <br><script type="text/javascript">QU('tundra37','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=tundra37" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7574.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
call   PROGA<br><br>--------------------<br>пролог PROGA<br>тело     PROGA<br>эпилог PROGA<br>-------------------<br>пролог FILTR<br>тело     FILTR<br><b><u>JMP  тело PROGA</u></b><br>тело     FILTR<br>эпилог FILTR<br>------------------------<br> Заменям    call   PROGA  на     call   FILTR<br><br>  JMP   естественно  надо дополнить восстановлением стека(если нужно)<br> Прологи и эпилоги должны быть одинаковыми естественно(ну за исключением опять же стека).
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=117448&amp;user=4072&amp;forum_n=6&amp;topic=7574.html&amp;page=0&amp;anchor=6" class="addthx" data-post="117448"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]asd[/b]','')">asd</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 162.2 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.58'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3241">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 января 2007 01:15 <br><script type="text/javascript">QU('asd','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=asd" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7574.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
в фильтре:<br>pushad<br>...<br>popad<br>xchg ebp,[esp]               ;адрес возврата в ебп<br>xchg ebx,[esp-14h]        ;сохраняем адрес возврата<br>mov ebp,esp                  ;тут будут локальные переменные<br>add esp,-14h<br>ret                                  возвращаемся
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=117468&amp;user=3241&amp;forum_n=6&amp;topic=7574.html&amp;page=0&amp;anchor=7" class="addthx" data-post="117468"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]0xy[/b]','')">0xy</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 218.5 (наставник), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.37'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3910">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 января 2007 13:43 <br><script type="text/javascript">QU('0xy','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=0xy" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7574.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
<b>stahh</b>, <b>tundra37</b><br>Ваш вариант не устраивает, т.к. этих CALL PROGA у меня куева туча, да к тому же не все они явные!<br><br><b>asd</b><br>Похоже, должно сработать (еще не пробовал). Но я хочу найти <b>универсальное</b> решение задачи, а твой код привязан к конкретному началу процедуры (push ebp; mov ebp,esp; add esp, -0c)<br><br><I>Archer пишет:<br>программы обычно не опираются на то, что лежит в стеке выше, поэтому менять это дело можно </I><br>Дыд я сам хотел на это опереться! <b>А оно почему-то исчезает после безобидной команды add esp,4! <img src="img/smilies/s14.gif" alt=""><br>КАК ЭТО МОЖНО ОБЪЯСНИТЬ?</b> Протов нет ни на проге, ни на Ольке (хотя, возможно, на какой-нить длл-ке и есть?). Второго потока тоже не наблюдается...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=117680&amp;user=3910&amp;forum_n=6&amp;topic=7574.html&amp;page=0&amp;anchor=8" class="addthx" data-post="117680"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]0xy[/b]','')">0xy</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 218.5 (наставник), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.37'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3910">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 января 2007 18:09 &middot; Поправил: 0xy <br><script type="text/javascript">QU('0xy','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=0xy" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7574.html&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
<b>asd</b><br>Не-а, не работает! xchg ebx,[esp-14h] срабатывает только в одну сторону, т.е. как mov. <br>А mov [esp-14], ebx вообще ни чего не делает! Т.е. после его выполнения данные в стеке не изменяются. <img src="img/smilies/s14.gif" alt=""><br>В общем, те же грабли, что и в моём варианте: данные в стеке выше указателя не выживают.<br><b>Чё за маразм такой???:</b> <img src="img/smilies/s14.gif" alt=""> <img src="img/smilies/s15.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=117695&amp;user=3910&amp;forum_n=6&amp;topic=7574.html&amp;page=0&amp;anchor=9" class="addthx" data-post="117695"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]0xy[/b]','')">0xy</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 218.5 (наставник), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.37'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3910">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 января 2007 20:50 <br><script type="text/javascript">QU('0xy','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=0xy" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7574.html&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
Оба-на! Код таки рабочий. А виновницей маразма оказалась Олька!<br><b>Остановившись на любом бряке, Оля портит стек выше esp-10h <img src="img/smilies/s10.gif" alt=""></b><br>Или это только у меня?<br><br>зы<br>Плугины точно не при чем.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=117703&amp;user=3910&amp;forum_n=6&amp;topic=7574.html&amp;page=0&amp;anchor=10" class="addthx" data-post="117703"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]asd[/b]','')">asd</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 162.2 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.58'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3241">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 января 2007 22:30 <br><script type="text/javascript">QU('asd','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=asd" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7574.html&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
<I>0xy пишет:<br>Не-а, не работает! xchg ebx,[esp-14h] </I><br><br>там ебп должно быть, и я не понял, сколько там локальных переменных 3 или 4?<br><br><I>0xy пишет:<br>Но я хочу найти универсальное решение задачи </I><br><br><code><br>pushad<br>mov ebx,[esp+20h];адрес возврата<br>sub ebx,5<br>sub ebx,offset end_code<br>add ebx,offset old_code_end - offset old_code_start<br>neg ebx<br>mov jmp_range,ebx<br>...;тут делай что хочешь<br>popad<br>add esp,4<br>old_code_start:<br>...                                    ;тут старый код<br>old_code_end:<br>db 09eh<br>jmp_range dd 0<br>end_code:<br></code>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=117714&amp;user=3241&amp;forum_n=6&amp;topic=7574.html&amp;page=0&amp;anchor=11" class="addthx" data-post="117714"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]0xy[/b]','')">0xy</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 218.5 (наставник), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.37'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3910">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 января 2007 16:37 <br><script type="text/javascript">QU('0xy','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=0xy" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7574.html&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
<b>asd</b><br><I>asd пишет:<br>там ебп должно быть </I><br>Да эт понятно, опечатка. Я ж написал, что всё работает, но только не под Олей!<br><br>Спасибо за пример, буду вникать.<br><br><b>2 ALL</b><br><b>Кто-нибудь проверил это:</b><br><I>0xy пишет:<br>Остановившись на любом бряке, Оля портит стек выше esp-10h  <br>Или это только у меня?  </I>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=117921&amp;user=3910&amp;forum_n=6&amp;topic=7574.html&amp;page=0&amp;anchor=12" class="addthx" data-post="117921"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]tundra37[/b]','')">tundra37</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 310.8 (мудрец), 29thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.32'>Активность: 0.43<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=4072">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 января 2007 02:54 <br><script type="text/javascript">QU('tundra37','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=tundra37" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7574.html&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
<I>0xy пишет:<br>Остановившись на любом бряке, Оля портит стек выше esp-10h  </I><br> Сделал простой бряк по F2 - стек целехонек. Это же отладчик - он по определению стек не должен трогать, да и у него свой стек - зачем ему стек процесса. А вот плаги и сама программа - запросто.<br> Кстати про антивирусы не забыл и аутпосты - они любят свои DLL везде внедрять.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=117977&amp;user=4072&amp;forum_n=6&amp;topic=7574.html&amp;page=0&amp;anchor=13" class="addthx" data-post="117977"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]HoBleen[/b]','')">HoBleen</a></b><br></div>
<img src="img/s6.gif" alt=""><br><img style="padding-top:3px;" src="av/5110.jpg" alt=""><br><span class=txtSm>Ранг: 240.5 (наставник)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.09'>Активность: 0.19<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=5110">Участник</a><br><font color=blue>Author of ACKiller </font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 января 2007 03:08 <br><script type="text/javascript">QU('HoBleen','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=HoBleen" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7574.html&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
<I>0xy пишет:<br> Оля портит стек выше esp-10h  </I><br>Мб плугин корявый установлен...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=117979&amp;user=5110&amp;forum_n=6&amp;topic=7574.html&amp;page=0&amp;anchor=14" class="addthx" data-post="117979"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]0xy[/b]','')">0xy</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 218.5 (наставник), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.37'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3910">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 января 2007 22:05 &middot; Поправил: 0xy <br><script type="text/javascript">QU('0xy','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=0xy" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7574.html&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
Плагины все отключал. Любителей внедрять dll-тоже.<br><b>Всё показывает именно на Ольку!</b>(м.б. еще зверьё, но не позоже)<br><br><b>Просьба ко всем, кому не лень, проделать такой эксперимент:<br>1. Загрузить в Ольке любую прогу и, стоя на ОЕП, глянуть, что лежит в [esp-14]<br>У меня ВСЕГДА [esp-14]=ds=ss=es=177h<br>2. Попробовать ПРОГРАММНО (MOV) записать туда что-то, и посмотреть, получится ли (у меня остается 177).<br>3. Если получилось, нажмите разок F7 и посмотрите, выживет ли.<br><br>PS<br>Крайне желательно проверить под Win 9x!</b>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=118155&amp;user=3910&amp;forum_n=6&amp;topic=7574.html&amp;page=0&amp;anchor=15" class="addthx" data-post="118155"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 января 2007 23:47 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7574.html&amp;page=0#16');return false;">#16</a> </span><div align=left><br>
<b>0xy</b><br>Если имеешь в виду [esp-14h], то у меня на XР СП0 (система чистая без антивирей, фаеров и т.д.) всё нормально, всё живо, всё на месте.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=118161&amp;user=1556&amp;forum_n=6&amp;topic=7574.html&amp;page=0&amp;anchor=16" class="addthx" data-post="118161"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]0xy[/b]','')">0xy</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 218.5 (наставник), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.37'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3910">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 января 2007 01:30 &middot; Поправил: 0xy <br><script type="text/javascript">QU('0xy','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=0xy" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7574.html&amp;page=0#17');return false;">#17</a> </span><div align=left><br>
Странно <img src="img/smilies/s14.gif" alt=""> У меня такая картина: сразу после загрузки любой проги в Олю (на EP), стек выглядит следующим образом:<br><code>[esp-14]=ss<br>esp<br>efl<br>cs<br>eip<br>ebp<br>eax<br>ecx<br>edx<br>ebx<br>esi<br>edi<br>ds<br>es<br>fs<br>[esp-50]=gs</code><br>Выше лежит еще что-то (не нули)<br>Все эти значения восстанавливаются при любом бряканьи Оли (в т.ч. после F7) Кто это может делать кроме самой Оли?<br><br><b>Archer</b><br>А у тебя после загрузки проги выше esp что-то есть? Или нули?<br><br><b>ps<br>Возможно, Оля так себя ведет только под 9x. Проверьте, у кого есть возможность.</b>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=118175&amp;user=3910&amp;forum_n=6&amp;topic=7574.html&amp;page=0&amp;anchor=17" class="addthx" data-post="118175"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]seeq[/b]','')">seeq</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/3067.jpg" alt=""><br><span class=txtSm>Ранг: 105.9 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.64'>Активность: 0.06<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3067">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 января 2007 02:01 <br><script type="text/javascript">QU('seeq','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=seeq" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7574.html&amp;page=0#18');return false;">#18</a> </span><div align=left><br>
Ответы, не читал. Может уже и подсказали...<br>При использовании call твойя_процедура<br>ты в ней не сможешь выполнить коректно инструкции:<br>push ebp<br>mov ebp, esp<br>add esp, -0c <br>Замени call на push+ret или jmp.<br>Также, можешь попробовать уже готовое решение: madCollection&gt;madCodeHook.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=118178&amp;user=3067&amp;forum_n=6&amp;topic=7574.html&amp;page=0&amp;anchor=18" class="addthx" data-post="118178"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 января 2007 03:26 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7574.html&amp;page=0#19');return false;">#19</a> </span><div align=left><br>
<b>0xy</b><br>Проверил ещё на ХР СП2. Не, не нули, но и ничего особо дельного. Есть нули, есть адреса из kernel, есть вообще бред, вроде f68cfd08. Пробовал ставить бряк и забить адреса, меньше esp нулями, так они и остаются нулями. Так что дело в ОС, наверно.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=118196&amp;user=1556&amp;forum_n=6&amp;topic=7574.html&amp;page=0&amp;anchor=19" class="addthx" data-post="118196"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="20" onfocus="this.blur()" href="JavaScript:di('[b]HoBleen[/b]','')">HoBleen</a></b><br></div>
<img src="img/s6.gif" alt=""><br><img style="padding-top:3px;" src="av/5110.jpg" alt=""><br><span class=txtSm>Ранг: 240.5 (наставник)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.09'>Активность: 0.19<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=5110">Участник</a><br><font color=blue>Author of ACKiller </font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 января 2007 03:33 <br><script type="text/javascript">QU('HoBleen','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=HoBleen" target="_blank">Личное сообщение</a> &middot;  <a href="#20" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7574.html&amp;page=0#20');return false;">#20</a> </span><div align=left><br>
<b>0xy</b><br>Немного не по теме, но:<br>Не советую испольтзовать олю на 9х, т.к. система защиты адресного пространства хромает. Раньше я тоже пробовал на Ме, но система частенько висла. ИМХО, юзай ХР
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=118198&amp;user=5110&amp;forum_n=6&amp;topic=7574.html&amp;page=0&amp;anchor=20" class="addthx" data-post="118198"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="21" onfocus="this.blur()" href="JavaScript:di('[b]stahh[/b]','')">stahh</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/3117.jpg" alt=""><br><span class=txtSm>Ранг: 127.3 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.62'>Активность: 0.07<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3117">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 января 2007 07:30 <br><script type="text/javascript">QU('stahh','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=stahh" target="_blank">Личное сообщение</a> &middot;  <a href="#21" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7574.html&amp;page=0#21');return false;">#21</a> </span><div align=left><br>
Проверил у себя, ХР СП2 - все нормально. Олька стек не трогает. Да и нафик ей стек? Чот у тебя с системой. По поводу того, что не подходит первое решение. Возьми тогда  и вынеси и ф-цию и фильтр в другое место. В начале ф-ции(програмной) вставь колл на свой код. Да и всех делов. Ну правда придется вручную переправить все джампы и коллы, но никаких проблем со стеком тогда уж точно не будет.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=118263&amp;user=3117&amp;forum_n=6&amp;topic=7574.html&amp;page=0&amp;anchor=21" class="addthx" data-post="118263"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="22" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 января 2007 09:16 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#22" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7574.html&amp;page=0#22');return false;">#22</a> </span><div align=left><br>
Вообще говоря, теоретически при постановке бряка или пошаговой трассировке происходит исключение, которое передаётся сначала в 0, а затем в 3 кольцо. Скажу честно, что досконально этот алгоритм я не знаю, но, возможно в 9х виндах стек может портиться из-за этого, поскольку может использоваться стек самого приложения.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=118284&amp;user=1556&amp;forum_n=6&amp;topic=7574.html&amp;page=0&amp;anchor=22" class="addthx" data-post="118284"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="23" onfocus="this.blur()" href="JavaScript:di('[b]0xy[/b]','')">0xy</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 218.5 (наставник), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.37'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3910">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 января 2007 05:52 <br><script type="text/javascript">QU('0xy','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=0xy" target="_blank">Личное сообщение</a> &middot;  <a href="#23" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=7574.html&amp;page=0#23');return false;">#23</a> </span><div align=left><br>
И всё-таки, для окончательного диагноза, у кого есть возможность--проверьте под 9x
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=118466&amp;user=3910&amp;forum_n=6&amp;topic=7574.html&amp;page=0&amp;anchor=23" class="addthx" data-post="118466"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Подключаю фильтр... Проблемы со стеком.</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#24" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="6">
<input type="hidden" name="topic" value="7574">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=7574" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
