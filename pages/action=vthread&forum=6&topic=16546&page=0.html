<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Возврат в KiUserExceptionDispatcher из ISR - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Привет всем добрым людям, вопрос следующего характера: недавно дебажил какой-то Хасповский драйвер, перехватывающий _KiTrap06. Для тех, кто не повторял такие подвиги, скажу, что периодически приложение, защищённое хаспом (правда,">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=55995'>tyns777</a> (+4 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Возврат в KiUserExceptionDispatcher из ISR</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]ARCHANGEL[/b]','')">ARCHANGEL</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/6336.png" alt=""><br><span class=txtSm>Ранг: 681.5 <font color=magenta>(<b>! !</b>)</font>, 405thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.85'>Активность: 0.42<span style='color:red'>&searr;</span>0.21</span><br>Статус: <a href="action=userinfo&amp;user=6336">Участник</a><br><font color=blue>ALIEN Hack Team</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 августа 2010 14:19 <br><script type="text/javascript">QU('ARCHANGEL','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ARCHANGEL" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=16546.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Привет всем добрым людям, вопрос следующего характера: недавно дебажил какой-то Хасповский драйвер, перехватывающий _KiTrap06. Для тех, кто не повторял такие подвиги, скажу, что периодически приложение, защищённое хаспом (правда, справедливо для старых версий) генерит исключение Invalid Opcode, которое перехватывается хасповским дровом, далее идёт работа с ключом (но нам сейчас это неинтересно), а потом происходит возврат из исключения банально через IRET. НО! При таком раскладе исключение не разворачивается в юзермоде. Т.е. для NT-систем не происходит передачи управления на KiUserExceptionDispatcher. Скажите, люди добрые, как можно обработать исключение (или прерывание, думаю, тут не принципиально) так, чтоб возврат в вышеупомянутую юзермодную функцию всё-таки осуществился?
<br><br><font size="1"><i>-----<br>Stuck to the plan, always think that we would stand up, never ran.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=262772&amp;user=6336&amp;forum_n=6&amp;topic=16546.html&amp;page=0&amp;anchor=1" class="addthx" data-post="262772"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]int[/b]','')">int</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 101.0 (ветеран), 344thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.1'>Активность: 1.15<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2449">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 августа 2010 14:28 <br><script type="text/javascript">QU('int','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=int" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=16546.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
Сделать свой драйвер и ловить (через хук) KiDispatchException
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=262773&amp;user=2449&amp;forum_n=6&amp;topic=16546.html&amp;page=0&amp;anchor=2" class="addthx" data-post="262773"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]ARCHANGEL[/b]','')">ARCHANGEL</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/6336.png" alt=""><br><span class=txtSm>Ранг: 681.5 <font color=magenta>(<b>! !</b>)</font>, 405thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.85'>Активность: 0.42<span style='color:red'>&searr;</span>0.21</span><br>Статус: <a href="action=userinfo&amp;user=6336">Участник</a><br><font color=blue>ALIEN Hack Team</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 августа 2010 14:41 <br><script type="text/javascript">QU('ARCHANGEL','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ARCHANGEL" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=16546.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
А как же его ловить, если он, собственно, и не вызывается? Может, его надо как-то вызывать? Сейчас вписал в гугль &quot;KiDispatchException&quot; и получил всё, кроме того, что нужно (( Тут, по-хорошему, прототипчик бы помог и IRQL, на котором это вызывается, или какая-то ссылочка толковая...
<br><br><font size="1"><i>-----<br>Stuck to the plan, always think that we would stand up, never ran.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=262774&amp;user=6336&amp;forum_n=6&amp;topic=16546.html&amp;page=0&amp;anchor=3" class="addthx" data-post="262774"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]n0name[/b]','')">n0name</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 61.4 (постоянный), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.7'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=7411">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 августа 2010 14:46 <br><script type="text/javascript">QU('n0name','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=n0name" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=16546.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
wrk <img src="img/smilies/s1.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=262775&amp;user=7411&amp;forum_n=6&amp;topic=16546.html&amp;page=0&amp;anchor=4" class="addthx" data-post="262775"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]ARCHANGEL[/b]','')">ARCHANGEL</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/6336.png" alt=""><br><span class=txtSm>Ранг: 681.5 <font color=magenta>(<b>! !</b>)</font>, 405thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.85'>Активность: 0.42<span style='color:red'>&searr;</span>0.21</span><br>Статус: <a href="action=userinfo&amp;user=6336">Участник</a><br><font color=blue>ALIEN Hack Team</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 августа 2010 14:55 <br><script type="text/javascript">QU('ARCHANGEL','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ARCHANGEL" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=16546.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
<b>n0name</b><br>А там (в этих долбаных мегабайтах кода) оно всё есть? А то я прямо сейчас не могу проверить...
<br><br><font size="1"><i>-----<br>Stuck to the plan, always think that we would stand up, never ran.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=262776&amp;user=6336&amp;forum_n=6&amp;topic=16546.html&amp;page=0&amp;anchor=5" class="addthx" data-post="262776"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]int[/b]','')">int</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 101.0 (ветеран), 344thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.1'>Активность: 1.15<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2449">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 августа 2010 15:00 <br><script type="text/javascript">QU('int','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=int" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=16546.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
Как я понимаю не вызывается в юзермоде, значит перехватывается в нуле и дальше обрывается. Надо перехватить раньше дрова защиты.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=262777&amp;user=2449&amp;forum_n=6&amp;topic=16546.html&amp;page=0&amp;anchor=6" class="addthx" data-post="262777"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 августа 2010 15:03 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=16546.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
Лучше скажи, что для чего надо. Проще снять хук, может?<br>Вообще странно несколько, как они работают с кодом, который патчит ядро. И как на это смотрит х64 с патчгардом и подписью дров.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=262778&amp;user=1556&amp;forum_n=6&amp;topic=16546.html&amp;page=0&amp;anchor=7" class="addthx" data-post="262778"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]n0name[/b]','')">n0name</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 61.4 (постоянный), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.7'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=7411">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 августа 2010 16:16 <br><script type="text/javascript">QU('n0name','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=n0name" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=16546.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br><div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_function">VOID</span></li><li class="hl_l0">KiDispatchException&nbsp;<span class="hl_char">(</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>IN</b></span>&nbsp;PEXCEPTION_RECORD&nbsp;ExceptionRecord<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>IN</b></span>&nbsp;PKEXCEPTION_FRAME&nbsp;ExceptionFrame<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>IN</b></span>&nbsp;PKTRAP_FRAME&nbsp;TrapFrame<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>IN</b></span>&nbsp;KPROCESSOR_MODE&nbsp;PreviousMode<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>IN</b></span>&nbsp;BOOLEAN&nbsp;FirstChance</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_char">/</span><span class="hl_char">*</span><span class="hl_char">+</span><span class="hl_char">+</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">Routine&nbsp;Description<span class="hl_char">:</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>This</b></span>&nbsp;function&nbsp;is&nbsp;called&nbsp;to&nbsp;dispatch&nbsp;an&nbsp;exception&nbsp;to&nbsp;the&nbsp;proper&nbsp;mode&nbsp;<span class="hl_function">and</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;cause&nbsp;the&nbsp;exception&nbsp;dispatcher&nbsp;to&nbsp;be&nbsp;called<span class="hl_char">.</span>&nbsp;<span class="hl_function"><b>If</b></span>&nbsp;the&nbsp;previous&nbsp;mode&nbsp;is</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;kernel<span class="hl_char">,</span>&nbsp;then&nbsp;the&nbsp;exception&nbsp;dispatcher&nbsp;is&nbsp;called&nbsp;directly&nbsp;to&nbsp;process&nbsp;the</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;exception<span class="hl_char">.</span>&nbsp;Otherwise&nbsp;the&nbsp;exception&nbsp;record<span class="hl_char">,</span>&nbsp;exception&nbsp;frame<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>and</b></span>&nbsp;trap</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;frame&nbsp;contents&nbsp;are&nbsp;copied&nbsp;to&nbsp;the&nbsp;user&nbsp;mode&nbsp;stack<span class="hl_char">.</span>&nbsp;The&nbsp;contents&nbsp;of&nbsp;the</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;exception&nbsp;frame&nbsp;<span class="hl_function"><b>and</b></span>&nbsp;trap&nbsp;are&nbsp;then&nbsp;modified&nbsp;such&nbsp;that&nbsp;when&nbsp;control&nbsp;is</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;returned<span class="hl_char">,</span>&nbsp;execution&nbsp;will&nbsp;commense&nbsp;<span class="hl_function"><b>in</b></span>&nbsp;user&nbsp;mode&nbsp;<span class="hl_function"><b>in</b></span>&nbsp;a&nbsp;routine&nbsp;which&nbsp;will</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>call</b></span>&nbsp;the&nbsp;exception&nbsp;dispatcher<span class="hl_char">.</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">Arguments<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;ExceptionRecord&nbsp;<span class="hl_char">-</span>&nbsp;Supplies&nbsp;a&nbsp;pointer&nbsp;to&nbsp;an&nbsp;exception&nbsp;record<span class="hl_char">.</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;ExceptionFrame&nbsp;<span class="hl_char">-</span>&nbsp;Supplies&nbsp;a&nbsp;pointer&nbsp;to&nbsp;an&nbsp;exception&nbsp;frame<span class="hl_char">.</span>&nbsp;For&nbsp;NT386<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>this</b></span>&nbsp;should&nbsp;be&nbsp;<span class="hl_function">NULL</span><span class="hl_char">.</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;TrapFrame&nbsp;<span class="hl_char">-</span>&nbsp;Supplies&nbsp;a&nbsp;pointer&nbsp;to&nbsp;a&nbsp;trap&nbsp;frame<span class="hl_char">.</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;PreviousMode&nbsp;<span class="hl_char">-</span>&nbsp;Supplies&nbsp;the&nbsp;previous&nbsp;processor&nbsp;mode<span class="hl_char">.</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;FirstChance&nbsp;<span class="hl_char">-</span>&nbsp;Supplies&nbsp;a&nbsp;boolean&nbsp;value&nbsp;that&nbsp;specifies&nbsp;whether&nbsp;<span class="hl_function"><b>this</b></span>&nbsp;is</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;first&nbsp;<span class="hl_char">(</span><span class="hl_function">TRUE</span><span class="hl_char">)</span>&nbsp;<span class="hl_function"><b>or</b></span>&nbsp;second&nbsp;<span class="hl_char">(</span><span class="hl_function">FALSE</span><span class="hl_char">)</span>&nbsp;chance&nbsp;for&nbsp;the&nbsp;exception<span class="hl_char">.</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">Return&nbsp;Value<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">None</span><span class="hl_char">.</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">*</span><span class="hl_char">/</span></li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=262783&amp;user=7411&amp;forum_n=6&amp;topic=16546.html&amp;page=0&amp;anchor=8" class="addthx" data-post="262783"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]V0ldemAr[/b]','')">V0ldemAr</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 65.4 (постоянный), 10thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.95'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=68">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 августа 2010 16:38 &middot; Поправил: V0ldemAr <br><script type="text/javascript">QU('V0ldemAr','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=V0ldemAr" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=16546.html&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
Вызов KeUserExceptionDispatcher будет тогда если исключение небыло обработано в кернел моде вы же сами сказали что хасп драйвер хучит int6 и возвращается через IRET из этого логично предположить что KiDispatchException небудет вызвано. Как вариант вызовите свое int6 исключение и отследите как хасп это обработает должен впринцыпе передать управление ISR в ntoskrnl. (только не ставте бряк на первую инструкцию так как отладчик свалится)<br><br><I>Archer пишет:<br>И как на это смотрит х64 с патчгардом и подписью дров. </I><br>Неработает т.е. непотдерживается... большинство старых донгл защит только x86
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=262785&amp;user=68&amp;forum_n=6&amp;topic=16546.html&amp;page=0&amp;anchor=9" class="addthx" data-post="262785"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]Clerk[/b]','')">Clerk</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 255.8 (наставник), 19thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.86'>Активность: 0.15<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=17964">Участник</a><br><font color=blue>vx</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 августа 2010 18:04 <br><script type="text/javascript">QU('Clerk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Clerk" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=16546.html&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
<b>ARCHANGEL</b><br>&gt; При таком раскладе исключение не разворачивается в юзермоде.<br>Фолт доставляется в лузермод если он возник в нём и не обработан ядром или отладчиком.<br>&gt; возврат из исключения банально через IRET.<br>Это делается средствами Kei386EoiHelper().
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=262788&amp;user=17964&amp;forum_n=6&amp;topic=16546.html&amp;page=0&amp;anchor=10" class="addthx" data-post="262788"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]mak[/b]','')">mak</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3520.jpg" alt=""><br><span class=txtSm>Ранг: 673.3 <font color=magenta>(<b>! !</b>)</font>, 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.48'>Активность: 0.4<span style='color:red'>&searr;</span>0.31</span><br>Статус: <a href="action=userinfo&amp;user=3520">Участник</a><br><font color=blue>CyberMonk</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 августа 2010 22:18 <br><script type="text/javascript">QU('mak','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=mak" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=16546.html&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
Sources of UCL&#039;s Hasp emulator driver. Fixed to compile and work under Win2K. No binaries included. Provided to educational purposes only!<br><br>mamaich.uni.cc/files/MeteoFixed.rar
<br><br><font size="1"><i>-----<br>RE In Progress [!] Coding Hazard [!] Stay Clear of this Cube</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=262800&amp;user=3520&amp;forum_n=6&amp;topic=16546.html&amp;page=0&amp;anchor=11" class="addthx" data-post="262800"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]Clerk[/b]','')">Clerk</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 255.8 (наставник), 19thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.86'>Активность: 0.15<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=17964">Участник</a><br><font color=blue>vx</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 августа 2010 22:53 &middot; Поправил: Clerk <br><script type="text/javascript">QU('Clerk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Clerk" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=16546.html&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
<b>mak</b><br>Там внесистемный трап процессинг, за который автору руки отсечь. Конечно можно поступить как предложил Грейт(использовать KINTERRUPT), вот только это не решит проблему - ENTER_INTERRUPT макро инициирует цепочку сех, изза этого исключения возникающий в этом хэндлере не будут обрабатываться сех, так как цепочка сех предыдущего ISR завершена.<br>Необходимо сформировать код формирующий трап фрейм, после чего могут быть размаскированы прерывания и использоваться сех и подкачиваемая память. А код этот различен в версиях, хотя не проблема некоторые необходимые смещения найти вручную.<br>Тут <noindex><a href="http://files.virustech.org/indy/Code/XcptIp/" rel="nofollow" target="_blank">http://files.virustech.org/indy/Code/XcptIp/</a></noindex> лежит семпл по теме:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_comment">; Надстройка выполняет обработку #UD, возникшего в U-mode. Об</span></li><li class="hl_l1"><span class="hl_comment">; рабатывается инструкция Ud2(0F0B) без префиксов: Eax - соде</span></li><li class="hl_l0"><span class="hl_comment">; ржит ссылку на инструкцию. Длина этой инструкции определяет</span></li><li class="hl_l1"><span class="hl_comment">; ся и возвращается в регистре Eax. При обнаружении инвалидно</span></li><li class="hl_l0"><span class="hl_comment">; й ссылки в юзермоде разворачивается #STATUS_ILLEGAL_INSTRUC</span></li><li class="hl_l1"><span class="hl_comment">; TION(можно изменить код на #AV).</span></li>        </ol>
    </div>
</div></div>
<br><img src="http://files.virustech.org/indy/Code/XcptIp/out.png" border="0" align="" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=262805&amp;user=17964&amp;forum_n=6&amp;topic=16546.html&amp;page=0&amp;anchor=12" class="addthx" data-post="262805"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]mak[/b]','')">mak</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3520.jpg" alt=""><br><span class=txtSm>Ранг: 673.3 <font color=magenta>(<b>! !</b>)</font>, 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.48'>Активность: 0.4<span style='color:red'>&searr;</span>0.31</span><br>Статус: <a href="action=userinfo&amp;user=3520">Участник</a><br><font color=blue>CyberMonk</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 августа 2010 16:27 <br><script type="text/javascript">QU('mak','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=mak" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=16546.html&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
<img src="img/smilies/s1.gif" alt=""> он достаточно старый сам по себе, писался давно, как бы не было думаю поможет Архангелу внести немного ясности в вопрос, тем более непострадественно с хаспом работают, тему по перехвату 6 инта как то тут заводил Hook &amp; Revers int 6 , но задача была специфична, да и тема далеко не пошла. Поэтому мне кажется если сам не разберешься то дело туго ... а подсмотреть было бы классно<br><br>Интересно , нужно глянуть твой код =) <br><br>ПС. Не знаю куда ты ложишь свои работы на народ или виртех, но на народе нет такой расфасовки классной как на вир техе) в плане удобства.
<br><br><font size="1"><i>-----<br>RE In Progress [!] Coding Hazard [!] Stay Clear of this Cube</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=262844&amp;user=3520&amp;forum_n=6&amp;topic=16546.html&amp;page=0&amp;anchor=13" class="addthx" data-post="262844"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]Clerk[/b]','')">Clerk</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 255.8 (наставник), 19thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.86'>Активность: 0.15<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=17964">Участник</a><br><font color=blue>vx</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 августа 2010 17:03 &middot; Поправил: Clerk <br><script type="text/javascript">QU('Clerk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Clerk" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=16546.html&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
<b>mak</b><br>Так всё просто, даже если ISR свои ставить.<br>Исключение разворачивается системой как и сказали выше в KiDispatchException(). Но она не экспортируется, а при трап-процессинге ядро использует стабы для неё, это CommonDispatchExceptionXX(). Они также не экспортируются, но поиск их очень прост:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_comment">;++</span></li><li class="hl_l1"><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_comment">; CommonDispatchException</span></li><li class="hl_l1"><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_comment">; Routine Description:</span></li><li class="hl_l1"><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_comment">;    This routine allocates exception record on stack, sets up exception</span></li><li class="hl_l1"><span class="hl_comment">;    record using specified parameters and finally sets up arguments</span></li><li class="hl_l0"><span class="hl_comment">;    and calls _KiDispatchException.</span></li><li class="hl_l1"><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_comment">;    NOTE:</span></li><li class="hl_l1"><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_comment">;    The purpose of this routine is to save code space.  Use this routine</span></li><li class="hl_l1"><span class="hl_comment">;    only if:</span></li><li class="hl_l0"><span class="hl_comment">;    1. ExceptionRecord is NULL</span></li><li class="hl_l1"><span class="hl_comment">;    2. ExceptionFlags is 0</span></li><li class="hl_l0"><span class="hl_comment">;    3. Number of parameters is less or equal than 3.</span></li><li class="hl_l1"><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_comment">;    Otherwise, you should use DISPATCH_EXCEPTION macro to set up your special</span></li><li class="hl_l1"><span class="hl_comment">;    exception record.</span></li><li class="hl_l0"><span class="hl_comment">;</span></li><li class="hl_l1"><span class="hl_comment">; Arguments:</span></li><li class="hl_l0"><span class="hl_comment">;</span></li><li class="hl_l1"><span class="hl_comment">;    (eax) = ExcepCode - Exception code to put into exception record</span></li><li class="hl_l0"><span class="hl_comment">;    (ebx) = ExceptAddress - Addr of instruction which the hardware exception occurs</span></li><li class="hl_l1"><span class="hl_comment">;    (ecx) = NumParms - Number of additional parameters</span></li><li class="hl_l0"><span class="hl_comment">;    (edx) = Parameter1</span></li><li class="hl_l1"><span class="hl_comment">;    (esi) = Parameter2</span></li><li class="hl_l0"><span class="hl_comment">;    (edi) = Parameter3</span></li><li class="hl_l1"><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_comment">; Return Value:</span></li><li class="hl_l1"><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_comment">;    None.</span></li><li class="hl_l1"><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_comment">;--</span></li><li class="hl_l1">CommonDispatchException0Args<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>xor</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>ecx</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; zero arguments</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>call</b></span>&nbsp;&nbsp;&nbsp;&nbsp;CommonDispatchException</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">CommonDispatchException1Arg0d<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>xor</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>edx</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; zero edx</span></li><li class="hl_l1">CommonDispatchException1Arg<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; one argument</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>call</b></span>&nbsp;&nbsp;&nbsp;&nbsp;CommonDispatchException&nbsp;<span class="hl_comment">; there is no return</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">CommonDispatchException2Args0d<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>xor</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>edx</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; zero edx</span></li><li class="hl_l1">CommonDispatchException2Args<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; two arguments</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>call</b></span>&nbsp;&nbsp;&nbsp;&nbsp;CommonDispatchException&nbsp;<span class="hl_comment">; there is no return</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>public</b></span>&nbsp;CommonDispatchException</li><li class="hl_l0"><span class="hl_function"><b>align</b></span>&nbsp;<span class="hl_function">dword</span></li><li class="hl_l1">CommonDispatchException&nbsp;<span class="hl_function">proc</span></li><li class="hl_l0">cPublicFpo&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;ExceptionRecordLength<span class="hl_char">/</span><span class="hl_number">4</span></li><li class="hl_l1"><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_comment">;       Set up exception record for raising exception</span></li><li class="hl_l1"><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>sub</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">esp</span><span class="hl_char">,</span>&nbsp;ExceptionRecordLength</li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; allocate exception record</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">esp</span><span class="hl_char">]</span><span class="hl_char">+</span>ErExceptionCode<span class="hl_char">,</span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; set up exception code</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>xor</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">esp</span><span class="hl_char">]</span><span class="hl_char">+</span>ErExceptionFlags<span class="hl_char">,</span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; set exception flags</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">esp</span><span class="hl_char">]</span><span class="hl_char">+</span>ErExceptionRecord<span class="hl_char">,</span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; set associated exception record</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">esp</span><span class="hl_char">]</span><span class="hl_char">+</span>ErExceptionAddress<span class="hl_char">,</span>&nbsp;<span class="hl_registr">ebx</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">esp</span><span class="hl_char">]</span><span class="hl_char">+</span>ErNumberParameters<span class="hl_char">,</span>&nbsp;<span class="hl_registr">ecx</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; set number of parameters</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cmp</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>je</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>short</b></span>&nbsp;de00</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lea</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span><span class="hl_registr"><b>esp</b></span>&nbsp;<span class="hl_char">+</span>&nbsp;ErExceptionInformation<span class="hl_char">]</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">[</span><span class="hl_registr">ebx</span><span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">edx</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">[</span><span class="hl_registr">ebx</span><span class="hl_char">+</span><span class="hl_number">4</span><span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">esi</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">[</span><span class="hl_registr">ebx</span><span class="hl_char">+</span><span class="hl_number">8</span><span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">edi</span></li><li class="hl_l0">de00<span class="hl_char">:</span></li><li class="hl_l1"><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_comment">; set up arguments and call _KiDispatchException</span></li><li class="hl_l1"><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>esp</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; (ecx)-&gt;exception record</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_char">.</span>errnz&nbsp;<span class="hl_char">(</span>EFLAGS_V86_MASK&nbsp;<span class="hl_function"><b>AND</b></span>&nbsp;<span class="hl_number">0FF00FFFFh</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>test</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>byte</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">ebp</span><span class="hl_char">]</span><span class="hl_char">+</span>TsEFlags<span class="hl_char">+</span><span class="hl_number">2</span><span class="hl_char">,</span>EFLAGS_V86_MASK<span class="hl_char">/</span><span class="hl_number">010000h</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jz</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>short</b></span>&nbsp;de10</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_number">0FFFFh</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jmp</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>short</b></span>&nbsp;de20</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">de10<span class="hl_char">:</span>&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_char">[</span><span class="hl_registr">ebp</span><span class="hl_char">]</span><span class="hl_char">+</span>TsSegCs</li><li class="hl_l1">de20<span class="hl_char">:</span>&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>and</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>MODE_MASK</li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_comment">; 1 - first chance TRUE</span></li><li class="hl_l0"><span class="hl_comment">; eax - PreviousMode</span></li><li class="hl_l1"><span class="hl_comment">; ebp - trap frame addr</span></li><li class="hl_l0"><span class="hl_comment">; 0 - Null exception frame</span></li><li class="hl_l1"><span class="hl_comment">; ecx - exception record addr</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>stdCall</b></span>&nbsp;_KiDispatchException<span class="hl_char">,</span><span class="hl_char">&lt;</span><span class="hl_registr">ecx</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">ebp</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">1</span><span class="hl_char">&gt;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">esp</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>ebp</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; (esp) -&gt; trap frame</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jmp</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_KiExceptionExit</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">CommonDispatchException&nbsp;<span class="hl_function">endp</span></li>        </ol>
    </div>
</div></div>
<br>trap.asm, модель вызова не меняется в версиях. В кодосекции ядра ищется код [CommonDispatchException0Args % CommonDispatchException] используя маску для процедурных ветвлений. Отсюда можно найти KiDispatchException(), хотя стабов достаточно.<br>-<br>Второй способ доставить фолт в лузермод - непосредственно переход по нужному вектору в IDT. Очищается текущий ядерный стек(пользовательский переключается на него из TSS.Esp0, он уже переключен в ISR) и формируется на его дне IRET-фрейм, после чего выполняется переход по нужному вектору в IDT(например на KiTrap0E для #PF), просто извлекая адрес для перехода из соответствующего дескриптора.<br>-<br>Только вот как и говорил вся проблема в формировании трап-фрейма.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=262847&amp;user=17964&amp;forum_n=6&amp;topic=16546.html&amp;page=0&amp;anchor=14" class="addthx" data-post="262847"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Возврат в KiUserExceptionDispatcher из ISR</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#15" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="6">
<input type="hidden" name="topic" value="16546">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=16546" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
