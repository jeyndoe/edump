<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Проблема с написанием memory patcher’а; процесс жертвы не создается - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Только начинаю учится крэкерству, и вот пришла необходимость написать лоадер. Базой выбрал Билдер, т.к ассемблер знаю совсем плохо. Прога-жертва очень простая (даже не запакована, и требуется изменить в ней только один байт). Но">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=39467'>hgdagon</a>, <a target='_blank' href='?action=userinfo&amp;user=28016'>asfa</a>, <a target='_blank' href='?action=userinfo&amp;user=26261'>bartolomeo</a> (+4 невидимых)</b></span>
</td>
</tr>
</table>

 

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Проблема с написанием memory patcher’а; процесс жертвы не создается</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]Fi1iN[/b]','')">Fi1iN</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 3.8 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.27'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=10910">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 апреля 2007 22:49 <br><script type="text/javascript">QU('Fi1iN','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Fi1iN" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8401.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Только начинаю учится крэкерству, и вот пришла необходимость написать лоадер. Базой выбрал Билдер, т.к ассемблер знаю совсем плохо. Прога-жертва очень простая (даже не запакована, и требуется изменить в ней только один байт). Но на ее основе я хочу понять общую технологию патчинга в памяти. Так как лоадеров раньше не писал, за основу взял статью &quot;Memory Patcher для ASProtect&quot; ALEX’а. Подогнал прогу из статьи под Билдер. Откомпилил. Но работает она неправильно. По неизвестной мне причине процесс, который должен запускать жертву не создается. Видимо что-то не так с параметрами. Жертва естественно находится в той же директории. Листинг функции memorypatch приведен ниже:<br><br><br><br><br>unsigned char <span style="word-break: break-all">ChoosenFile[12]={&#039;c&#039;,&#039;r&#039;,&#039;a&#039;,&#039;c&#039;,&#039;k&#039;,&#039;m&#039;,&#039;e&#039;,&#039;1&#039;,&#039;.&#039;,&#039;e&#039;,&#039;x&#039;,&#039;e&#039;};</span><br><br>long int offset = { 1037 }; // 0000040D - Offset address<br>unsigned char data[2] = { 117, 116 }; // 75h, 74h - Data to be written<br><br>STARTUPINFO *SI;<br>PROCESS_INFORMATION *PI;<br>  if(!CreateProcess(0,ChoosenFile,0,0,false,CREATE_NEW_CONSOLE||NORMAL_P RIORITY_CLASS,0,0,SI,PI)){<br>    Form1-&gt;RichEdit1-&gt;Lines-&gt;Strings[0]=&quot;SHIT!!!&quot;;<br>}<br>else{<br> Form1-&gt;RichEdit1-&gt;Lines-&gt;Strings[0]=&quot;Memory patching...&quot;;<br> SuspendThread(PI-&gt;hThread);<br> WriteProcessMemory(PI-&gt;hProcess,Pointer(offset[0]),&amp;data[1],1,NULL);<br> Form1-&gt;RichEdit1-&gt;Lines-&gt;Strings[0]= Form1-&gt;RichEdit1-&gt;Lines-&gt;Strings[0]+&quot; SUCCESS!&quot;;<br> ResumeThread(PI-&gt;hThread);<br> CloseHandle(PI-&gt;hProcess);<br>}<br><br><br>После запуска в RichEdit&#039;e выдается &quot;SHIT!!!&quot;<br>Помогите разобраться.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=131172&amp;user=10910&amp;forum_n=6&amp;topic=8401.html&amp;page=0&amp;anchor=1" class="addthx" data-post="131172"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]Germsoft[/b]','')">Germsoft</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 0.2 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.26'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=10927">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 апреля 2007 02:45 <br><script type="text/javascript">QU('Germsoft','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Germsoft" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8401.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
Не знаю как это делается в Билдере (и кто это вообще такой). На асме я делал как указано в аттаче.<br><br><img src="img/attach.gif" alt=""> <a href="./files/2c06_07.04.2007_CRACKLAB.rU.tgz">2c06_07.04.2007_CRACKLAB.rU.tgz</a> - cut.rar
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=131194&amp;user=10927&amp;forum_n=6&amp;topic=8401.html&amp;page=0&amp;anchor=2" class="addthx" data-post="131194"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]LifeIsPain[/b]','')">LifeIsPain</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 2.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.26'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=10928">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 апреля 2007 03:10 <br><script type="text/javascript">QU('LifeIsPain','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=LifeIsPain" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8401.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
обожемой<br>а экземпл в мсдне посмотреть не судьба? ты даже описание функции не открывал, я более чем уверен. плюс явное отсутствие понимания программирования под си.<br>плюс правильным тоном лоадеров считается создавать процесс с CREATE_SUSPENDED, дабы не получать шит
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=131196&amp;user=10928&amp;forum_n=6&amp;topic=8401.html&amp;page=0&amp;anchor=3" class="addthx" data-post="131196"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]Fi1iN[/b]','')">Fi1iN</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 3.8 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.27'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=10910">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 апреля 2007 07:40 <br><script type="text/javascript">QU('Fi1iN','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Fi1iN" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8401.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
<I>LifeIsPain пишет:<br>а экземпл в мсдне посмотреть не судьба? ты даже описание функции не открывал, я более чем уверен. плюс явное отсутствие понимания программирования под си. </I><br>Я смотрел хелп по WIN32, и примера создания процесса там небыло, только описание. А нащет отсутствия понимания программирования, дак я и не говорил что мега-крутой программер.<br>Короче из всего что ты тут сказал, по теме является только последннее предложение, со всем остальным можешь идти сам знаешь куда...<br><br><I>Germsoft пишет:<br>На асме я делал как указано в аттаче. </I><br>Пасиб, буду изучать...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=131200&amp;user=10910&amp;forum_n=6&amp;topic=8401.html&amp;page=0&amp;anchor=4" class="addthx" data-post="131200"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]ant_man[/b]','')">ant_man</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 27.7 (посетитель), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.58'>Активность: 0.01=0.01</span><br>Статус: <a href="action=userinfo&amp;user=921">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 апреля 2007 13:25 <br><script type="text/javascript">QU('ant_man','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ant_man" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8401.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
ошибочно используются непроинициализированные указатели в двух последних параметрах.<br><br>пример, который ты не нашел в мсдн:<br><br>void main( VOID )<br>{<br>    STARTUPINFO si;<br>    PROCESS_INFORMATION pi;<br><br>    ZeroMemory( &amp;si, sizeof(si) );<br>    si.cb = sizeof(si);<br>    ZeroMemory( &amp;pi, sizeof(pi) );<br><br>    // Start the child process. <br>    if( !CreateProcess( NULL,   // No module name (use command line). <br>        TEXT(&quot;MyChildProcess&quot;), // Command line. <br>        NULL,             // Process handle not inheritable. <br>        NULL,             // Thread handle not inheritable. <br>        FALSE,            // Set handle inheritance to FALSE. <br>        0,                // No creation flags. <br>        NULL,             // Use parent&#039;s environment block. <br>        NULL,             // Use parent&#039;s starting directory. <br>        &amp;si,              // Pointer to STARTUPINFO structure.<br>        &amp;pi )             // Pointer to PROCESS_INFORMATION structure.<br>    ) <br>    {<br>        printf( &quot;CreateProcess failed (%d).\n&quot;, GetLastError() );<br>        return;<br>    }<br><br>    // Wait until child process exits.<br>    WaitForSingleObject( pi.hProcess, INFINITE );<br><br>    // Close process and thread handles. <br>    CloseHandle( pi.hProcess );<br>    CloseHandle( pi.hThread );<br>}
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=131350&amp;user=921&amp;forum_n=6&amp;topic=8401.html&amp;page=0&amp;anchor=5" class="addthx" data-post="131350"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]Fi1iN[/b]','')">Fi1iN</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 3.8 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.27'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=10910">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 апреля 2007 18:51 <br><script type="text/javascript">QU('Fi1iN','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Fi1iN" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8401.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
<b>ant_man</b><br>Пасиб за краткую справку. В хелпе который есть у меня примеров вообще мало. Надо доставать MSDN.<br><br>Короче разобрался я полностью, пасиб всем. Окончательный вариант функции приведен ниже (на случай если кому понадобится):<br><br>  unsigned char file[] = &quot;crackme1.exe&quot;;<br>  long int address = 0x40100D;   // Адрес функции, которую нужно изменить<br>  unsigned char data[2] = { 0x75, 0x74 };   // jne, je<br>  int error;<br><br>  STARTUPINFO SI;<br>  PROCESS_INFORMATION PI;<br>  ZeroMemory(&amp;SI,sizeof(SI));<br>  SI.cb=sizeof(SI);<br>  ZeroMemory(&amp;PI,sizeof(PI));<br>  if(!CreateProcess(NULL,TEXT(file),NULL,NULL,false,0,NULL,NULL,&amp;SI,&amp;PI) ){<br>    error=GetLastError();<br>    RichEdit1-&gt;Lines-&gt;Strings[0]=&quot;CreateProcess failed! Error #&quot; + IntToStr(error) + &quot;.\n&quot;;<br>  }<br>  else{<br>    SuspendThread(PI.hThread);<br>    ReadProcessMemory(PI.hProcess,Pointer(address),&amp;data[0],1,NULL);<br>    if(data[0]==0x75){<br>      WriteProcessMemory(PI.hProcess,Pointer(address),&amp;data[1],1,NULL);<br>      RichEdit1-&gt;Lines-&gt;Strings[0]=&quot;Successful finish.\n&quot;;<br>    }<br>    else{<br>      RichEdit1-&gt;Lines-&gt;Strings[0]=&quot;Error!\nProbably different file.\n&quot;;<br>    }<br>    ResumeThread(PI.hThread);<br>    WaitForSingleObject(PI.hProcess,INFINITE);<br>    CloseHandle(PI.hProcess);<br>    CloseHandle(PI.hPThread);<br>  }
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=131401&amp;user=10910&amp;forum_n=6&amp;topic=8401.html&amp;page=0&amp;anchor=6" class="addthx" data-post="131401"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Проблема с написанием memory patcher’а; процесс жертвы не создается</span></td>
</tr></table>
</div>
<a name=newreply></a>
<div align=center>
<table class=forums>
<tr>
<td class=caption4 width="100%"><span class=header>Эта тема закрыта. Ответы больше не принимаются.</span></td>
</tr>
</table>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=8401" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
