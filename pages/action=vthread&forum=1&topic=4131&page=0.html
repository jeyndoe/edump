<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Невидимость ключа в реестре и процесса реализованная в sys файле. - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Здравствуйте ! Столкнулся с программой частичная защита которой реализована в файлике c:&#92;windows&#92;system32&#92;drivers&#92;emos.sys Сам emos.exe не виден в процессах и дамперы его не видят и пишет данные данные в реестр в">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=8605'>Rio</a>, <a target='_blank' href='?action=userinfo&amp;user=132'>YDS</a>, <a target='_blank' href='?action=userinfo&amp;user=41701'>_MBK_</a> (+10 невидимых)</b></span>
</td>
</tr>
</table>

 

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/green.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=1&sortBy=0&page=0.html"><b>Основной форум</b></a> <b class=bulletHead>&#8212;&#8250;</b> Невидимость ключа в реестре и процесса реализованная в sys файле.</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]ToBad[/b]','')">ToBad</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/702.gif" alt=""><br><span class=txtSm>Ранг: 450.3 (мудрец), 13thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.67'>Активность: 0.2<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=702">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 марта 2006 02:47 <br><script type="text/javascript">QU('ToBad','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ToBad" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=4131.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Здравствуйте !
<br>Столкнулся с программой частичная защита которой реализована в файлике c:&#92;windows&#92;system32&#92;drivers&#92;emos.sys
<br>Сам emos.exe не виден в процессах и дамперы его не видят и пишет данные данные в реестр в hklm&#92;software&#92;zzz который тоже невидим ни стандартным регедитом ни сторонними продуктами и регмоном не мониторится.
<br>Я понял, что emos.sys осуществляет перехват апи функций и осуществляет всё вышеперечисленное. Я нашёл места где хранятся строки ZZZ и emos.exe
<br>Но проблема в том, что любое изменение в файле emos.sys сказывается критически.
<br>Повторяю абсолютно любое даже в заголовке в надписи This program cannot…. Стоит один байтик поправить и всё.
<br>При попытке запуска через net start emos я вижу сообщение The specified driver is invalid.
<br>Стоит вернуть изменения и запуск происходит.
<br>
<br>Отсюда два вопроса:
<br>1) В драйверах изменение файла контролируется виндой  (у меня XP) или это делает сам emos.sys ? Хотя похоже ответ я знаю. Если в начале кода ставить int 3, а в сайсе bpint 3, то всплытие не происходит и я по прежнему вижу надпись The specified driver is invalid. 
<br>Получается только ставить бряк на одну из функций в начале и править нужные строчки в памяти. Но кем контролируется целостность emos.sys и как это обойти – я не знаю.
<br>
<br>2) Если драйвер не менять и он стартует, то в softice я командами device emos или driver emos вижу много информации, адреса какие то и т.д.
<br>А вот как попасть в контекст драйвера не знаю. Поиском не находится и addr emos естественно не работает.
<br>Если бы это была подгруженная dll, то зная в чьём адресном пространстве она находится я бы её запатчил, а вот по драйверам идей нет. Может что подскажите ?
<br>
<br>Вот ссылка на программу, если кто захочет взглянуть. www.softsecurity.com/download/email_observer/emailobs.zip
<br>Ломать за меня естественно не прошу, за ответы и идеи - буду благодарен.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=55804&amp;user=702&amp;forum_n=1&amp;topic=4131.html&amp;page=0&amp;anchor=1" class="addthx" data-post="55804"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]Fallen Angel[/b]','')">Fallen Angel</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 15.7 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1555">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 марта 2006 06:53 <br><script type="text/javascript">QU('Fallen Angel','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Fallen Angel" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=4131.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
<b>ToBad</b>
<br>Если мне не изменяет память винда проверяет CRC пробитый в драйвере, подправь его после модификации.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=55809&amp;user=1555&amp;forum_n=1&amp;topic=4131.html&amp;page=0&amp;anchor=2" class="addthx" data-post="55809"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]nice[/b]','')">nice</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 384.1 (мудрец)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.96'>Активность: 0.25<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29">Участник</a><br><font color=blue>www.int3.net</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 марта 2006 08:21 <br><script type="text/javascript">QU('nice','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=nice" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=4131.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
<b>ToBad</b>
<br>Всё верно, у драйвера есть свой СРС, можешь егоподправить РЕТулзой или ЛордРЕ  и будет всё ок
<br><br><font size="1"><i>-----<br>Подписи - ЗЛО! Нужно убирать!</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=55813&amp;user=29&amp;forum_n=1&amp;topic=4131.html&amp;page=0&amp;anchor=3" class="addthx" data-post="55813"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]MoonShiner[/b]','')">MoonShiner</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 186.8 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.97'>Активность: 0.04<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 марта 2006 11:15 <br><script type="text/javascript">QU('MoonShiner','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=MoonShiner" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=4131.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
<I>ToBad пишет:
<br>В драйверах изменение файла контролируется виндой (у меня XP) или это делает сам emos.sys  </I>
<br>Винда контролирует целостность драйвера, проверяя его контрольную сумму. Так как запуск поврежденного драйвера - практически 100%-ный синяк. Хотя, если мне не изменяет память, 2к запросто грузила драйверы (ессесно делая синяк) драйвер, состоящий из сплошных нулей.
<br><I>ToBad пишет:
<br>А вот как попасть в контекст драйвера не знаю </I>
<br>Что значит, &quot;попасть в контекст драйвера&quot;? Сделай driver emos и тебе будет написан адрес загрузки этого драйвера. С этого места он размещен в памяти. И ты его увидишь в контексте любого процесса. RTFM короче.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=55833&amp;user=2&amp;forum_n=1&amp;topic=4131.html&amp;page=0&amp;anchor=4" class="addthx" data-post="55833"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]Step[/b]','')">Step</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 64.6 (постоянный)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.78'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2702">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 марта 2006 11:29 <br><script type="text/javascript">QU('Step','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Step" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=4131.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
Первые два поста про CRC. Дальше <b>MoonShiner</b> обьясняет адресс драйвера.
<br>
<br>Контекст процеса - относительно именно процесов. Под контекстом драйвера понимают более деликатную вещь.
<br>Видимо тебе нужен образ драйвера в памяти. Почитай инфу по этому. В двух словах: первые два гигибайта памяти уникальны для каждого процесса, а вот верхние два гига одинаковые для любого процесса. Там находится ядро системы, тоесть, по сути - драйвера. Вызови список модулей командой Айса с ключом -s. Таким образом будут показаны системные модули. Вот там и ищи адресс своего драйвера.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=55836&amp;user=2702&amp;forum_n=1&amp;topic=4131.html&amp;page=0&amp;anchor=5" class="addthx" data-post="55836"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]Error_Log[/b]','')">Error_Log</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 228.7 (наставник), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.05'>Активность: 0.12<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2060">Участник</a><br><font color=blue>malware research</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 марта 2006 19:42 <br><script type="text/javascript">QU('Error_Log','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Error_Log" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=4131.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
<b>ToBad</b> C помощью антивиря AVZ можно узнать какие функции похучены, ну а уже исходя из этого думать дальше... Есть еще утилита Марка Руссиновича RootkitRevealer которая покажет, что спрятанно в реестре от глаз пользователя.
<br><br><font size="1"><i>-----<br>Research is my purpose</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=55894&amp;user=2060&amp;forum_n=1&amp;topic=4131.html&amp;page=0&amp;anchor=6" class="addthx" data-post="55894"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]FKMA[/b]','')">FKMA</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 20.9 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.69'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2918">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 марта 2006 22:34 <br><script type="text/javascript">QU('FKMA','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=FKMA" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=4131.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
Загрузись в safemode, убей в реестре загрузку дравера, перезагрузись нормально, дизассемблируй и смотри, что он делает.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=55906&amp;user=2918&amp;forum_n=1&amp;topic=4131.html&amp;page=0&amp;anchor=7" class="addthx" data-post="55906"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]ToBad[/b]','')">ToBad</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/702.gif" alt=""><br><span class=txtSm>Ранг: 450.3 (мудрец), 13thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.67'>Активность: 0.2<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=702">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 марта 2006 03:17 <br><script type="text/javascript">QU('ToBad','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ToBad" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=4131.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
Спасибо всем ! Со всем разобрался. CRC поправил - всё заработало. Команду сайса mod -s упустил из вида, а с driver emos тоже подзапутался. Сейчас всё понял. Прошу прощенье насчёт некорректно сказанной фразы &quot;попасть в контекст драйвера&quot;, я имел ввиду попасть из сайса в нужное место в коде драйвера что бы пропатчить. Теперь понял как. Отдельное спасибо Error_Log за ссылку на интересную софтину. Заодно и мониторы обновил.
<br>Всем ещё раз спасибо за помощь. Тему закрываю.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=55926&amp;user=702&amp;forum_n=1&amp;topic=4131.html&amp;page=0&amp;anchor=8" class="addthx" data-post="55926"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/green.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=1&sortBy=0&page=0.html"><b>Основной форум</b></a> <b class=bulletHead>&#8212;&#8250;</b> Невидимость ключа в реестре и процесса реализованная в sys файле.</span></td>
</tr></table>
</div>
<a name=newreply></a>
<div align=center>
<table class=forums>
<tr>
<td class=caption4 width="100%"><span class=header>Эта тема закрыта. Ответы больше не принимаются.</span></td>
</tr>
</table>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=4131" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
