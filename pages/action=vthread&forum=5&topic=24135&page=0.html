<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Где начало оверлея - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Есть жертва - ехе-файл с оверлеем. Но в этом файле, на диске, за границей последней секции располагается сначала таблица сертификатов, а уже следом идет этот оверлей (добавленный байт-код). Я пересобрал длл которую грузит">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=6859'>cppasm</a>, <a target='_blank' href='?action=userinfo&amp;user=28016'>asfa</a> (+6 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/nub.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=5&sortBy=0&page=0.html"><b>Вопросы новичков</b></a> <b class=bulletHead>&#8212;&#8250;</b> Где начало оверлея</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> .  <b>1</b> . <a href="action=vthread&amp;forum=5&amp;topic=24135&amp;page=1.html">2</a> . <a href="action=vthread&amp;forum=5&amp;topic=24135&amp;page=1.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]Kuzya69[/b]','')">Kuzya69</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 30.1 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.16'>Активность: 0.07<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29098">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 мая 2016 15:38 &middot; Поправил: Kuzya69 <br><script type="text/javascript">QU('Kuzya69','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Kuzya69" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24135&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Есть жертва - ехе-файл с оверлеем. Но в этом файле, на диске, за границей последней секции располагается сначала таблица сертификатов, а уже следом идет этот оверлей (добавленный байт-код). Я пересобрал длл которую грузит программа-жертва. Длл должна вычитывать оверлей из запускаемого файла. И по таблице, которая хранится в оверлее программы-жертвы, модифицировать код программы-жертвы. То-есть  длл не меняется, а оверлей я могу писать разный под свои нужды в саму программу любой версии. <br>Вопрос. <br>Всегда-ли таблица сертификатов является заключетельными байтами ехе-файла (имеется ввиду файл, только что скомпилированный, пока еще не приписали байты нового оверлея)?<br>Или какой правильный порядок поиска начала оверлея в файле?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=364580&amp;user=29098&amp;forum_n=5&amp;topic=24135&amp;page=0&amp;anchor=1" class="addthx" data-post="364580"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 222thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 мая 2016 15:52 <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24135&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
<noindex><a href="http://kak-iskat.ru/?q=%D0%BE%D0%B2%D0%B5%D1%80%D0%BB%D0%B5%D0%B9" rel="nofollow" target="_blank">--&gt; Link &lt;--</a></noindex>
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=364582&amp;user=24257&amp;forum_n=5&amp;topic=24135&amp;page=0&amp;anchor=2" class="addthx" data-post="364582"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]dosprog[/b]','')">dosprog</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 431.7 (мудрец), 390thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.95'>Активность: 0.73<span style='color:red'>&searr;</span>0.32</span><br>Статус: <a href="action=userinfo&amp;user=35473">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 мая 2016 15:55 <br><script type="text/javascript">QU('dosprog','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=dosprog" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24135&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
Самый нормальный способ поиска оверлея это по его сигнатуре.<br>Всё остальное так или иначе способно глючить.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=364583&amp;user=35473&amp;forum_n=5&amp;topic=24135&amp;page=0&amp;anchor=3" class="addthx" data-post="364583"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]Kuzya69[/b]','')">Kuzya69</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 30.1 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.16'>Активность: 0.07<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29098">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 мая 2016 15:57 &middot; Поправил: Kuzya69 <br><script type="text/javascript">QU('Kuzya69','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Kuzya69" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24135&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
Меня больше не оверлей волнует. А как определить конец файла без учета оверлея. По сути, из определения самого оверлея, получается, что таблица сертификатов это тоже оверлей. Вот и интересует, как мне создать алгоритм, который может отделить только добавленные мной байты, от байт созданных компиллятором.<br><I>dosprog пишет:<br>по его сигнатуре.<br> </I><br>Думал я об этом, чтоб создать сигнатуру, но боюсь, что вдруг сигнатура встретится в той-же самой таблице сертификатов. Если начинать искать оверлей после последней секции. Или в моем-же байт-коде, если вести поиск сигнатуры с конца файла.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=364584&amp;user=29098&amp;forum_n=5&amp;topic=24135&amp;page=0&amp;anchor=4" class="addthx" data-post="364584"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 222thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 мая 2016 16:08 <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24135&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
<I>Kuzya69 пишет:<br>как определить конец файла </I><br>Может, не конец файла, а конец образа?<br><br><I>Kuzya69 пишет:<br>Вот и интересует, как мне создать алгоритм, который может отделить только добавленные мной байты, от байт созданных компиллятором. </I><br><br>Смотрите по концу последней секции в хидере<br><br><I>Kuzya69 пишет:<br>Если начинать искать оверлей после последней секции. </I><br>Ну правильно ж мыслите. Что, тоже скучно? <img src="img/smilies/s5.gif" alt=""><br><br><b>Добавлено спустя 3 минуты</b><br>Пока тему не закрыли... не грамотен в терминах, поэтому - а что-то вроде &quot;миддлвея&quot; как называется? <img src="img/smilies/s1.gif" alt="">
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=364585&amp;user=24257&amp;forum_n=5&amp;topic=24135&amp;page=0&amp;anchor=5" class="addthx" data-post="364585"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]dosprog[/b]','')">dosprog</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 431.7 (мудрец), 390thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.95'>Активность: 0.73<span style='color:red'>&searr;</span>0.32</span><br>Статус: <a href="action=userinfo&amp;user=35473">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 мая 2016 16:12 &middot; Поправил: dosprog <br><script type="text/javascript">QU('dosprog','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=dosprog" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24135&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
<I>Kuzya69 пишет:<br>Думал я об этом, чтоб создать сигнатуру, но боюсь, что вдруг сигнатура встретится в той-же самой таблице сертификатов. Если начинать искать оверлей после последней секции. </I><br><br>Во-первых, не встретится, если сигнатуру выбирать старательно,<br>а во-вторых, ищется она не с конца последней секции вперёд, а с конца файла и назад.<br>Тогда неожиданностей не будет.<br><i class=x><br></i>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=364586&amp;user=35473&amp;forum_n=5&amp;topic=24135&amp;page=0&amp;anchor=6" class="addthx" data-post="364586"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]Kuzya69[/b]','')">Kuzya69</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 30.1 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.16'>Активность: 0.07<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29098">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 мая 2016 16:13 &middot; Поправил: Kuzya69 <br><script type="text/javascript">QU('Kuzya69','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Kuzya69" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24135&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
<I>DenCoder пишет:<br>Может, не конец файла, а конец образа? </I><br>Какой конец образа? Оверлей-же не проецируется в память, приходится маппировать файл в память, и смотреть его побайтно как файл.<br><br><I>DenCoder пишет:<br>Смотрите по концу последней секции в хидере </I><br>Я же писал, сразу за последней секцией идет сначала таблица сертификатов, а уже потом мой оверлей.<br><br><br><I>DenCoder пишет:<br>Ну правильно ж мыслите. Что, тоже скучно?  </I><br>Ну а тут я совсем не понял.<br><br><I>dosprog пишет:<br>а во-вторых, ищется она не с конца последней секции вперёд, а с конца файла и назад.<br>Тогда неожиданностей не быват.  </I><br>Ну я это и подразумевал, слова не те выбрал, я хотел написать &quot;секции в файле&quot; (а не секции в образе).<br>Или если имелось ввиду направление поиска, то именно так я и думал. Конец файла, это же конец его последней секции в файле?<br><br><I>dosprog пишет:<br>Во-первых, не встретится, если сигнатуру выбирать старательно, </I><br>Ну, например, можно показать гарантированный вариант, который не может встретиться в коде программы?<br>Я думал о стринге &quot;overlay&quot;, но все равно не уверен на 100%.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=364587&amp;user=29098&amp;forum_n=5&amp;topic=24135&amp;page=0&amp;anchor=7" class="addthx" data-post="364587"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]dosprog[/b]','')">dosprog</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 431.7 (мудрец), 390thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.95'>Активность: 0.73<span style='color:red'>&searr;</span>0.32</span><br>Статус: <a href="action=userinfo&amp;user=35473">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 мая 2016 16:23 &middot; Поправил: dosprog <br><script type="text/javascript">QU('dosprog','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=dosprog" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24135&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
<I>Kuzya69 пишет:<br>Ну, например, можно показать гарантированный вариант, который не может встретиться в коде программы?<br> </I><br><br><b>db &#039;DoSpRoG&#039;,0</b>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=364588&amp;user=35473&amp;forum_n=5&amp;topic=24135&amp;page=0&amp;anchor=8" class="addthx" data-post="364588"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]Kuzya69[/b]','')">Kuzya69</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 30.1 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.16'>Активность: 0.07<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29098">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 мая 2016 16:32 <br><script type="text/javascript">QU('Kuzya69','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Kuzya69" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24135&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
db &#039;DoSpRoG&#039;,0 = <br><br>0х44,0х6F,0х53,0х70,0х52,0х6F,0х47,0х00 =<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_char">$</span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span><span class="hl_char">&gt;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">&gt;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">44</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>INC</b></span>&nbsp;<span class="hl_registr">ESP</span></li><li class="hl_l1"><span class="hl_char">$</span><span class="hl_char">+</span><span class="hl_number">1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">&gt;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">6F</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>OUTS</b></span>&nbsp;<span class="hl_registr">DX</span><span class="hl_char">,</span><span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_function"><b>PTR</b></span>&nbsp;<span class="hl_registr">ES</span><span class="hl_char">:</span><span class="hl_char">[</span><span class="hl_registr">EDI</span><span class="hl_char">]</span></li><li class="hl_l0"><span class="hl_char">$</span><span class="hl_char">+</span><span class="hl_number">2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">&gt;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">53</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;<span class="hl_registr">EBX</span></li><li class="hl_l1"><span class="hl_char">$</span><span class="hl_char">+</span><span class="hl_number">3</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">&gt;</span>&nbsp;&nbsp;<span class="hl_char">-</span>&nbsp;<span class="hl_number">70</span>&nbsp;<span class="hl_number">52</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>JO</b></span>&nbsp;<span class="hl_function"><b>SHORT</b></span>&nbsp;<span class="hl_char">$</span><span class="hl_char">+</span><span class="hl_number">52</span></li><li class="hl_l0"><span class="hl_char">$</span><span class="hl_char">+</span><span class="hl_number">5</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">&gt;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">6F</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>OUTS</b></span>&nbsp;<span class="hl_registr">DX</span><span class="hl_char">,</span><span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_function"><b>PTR</b></span>&nbsp;<span class="hl_registr">ES</span><span class="hl_char">:</span><span class="hl_char">[</span><span class="hl_registr">EDI</span><span class="hl_char">]</span></li><li class="hl_l1"><span class="hl_char">$</span><span class="hl_char">+</span><span class="hl_number">6</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">&gt;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">47</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>INC</b></span>&nbsp;<span class="hl_registr">EDI</span></li>        </ol>
    </div>
</div></div>
<br><br>Может и встретится, <img src="img/smilies/s1.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=364589&amp;user=29098&amp;forum_n=5&amp;topic=24135&amp;page=0&amp;anchor=9" class="addthx" data-post="364589"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]vden[/b]','')">vden</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 112.9 (ветеран), 186thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.22'>Активность: 0.09<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=28841">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 мая 2016 16:46 &middot; Поправил: vden <br><script type="text/javascript">QU('vden','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=vden" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24135&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
<I>Kuzya69 пишет:<br>за границей последней секции располагается сначала таблица сертификатов, а уже следом идет этот оверлей </I><br>Фактически сертификат в оверлее. Но тут все просто. В data directories явно указано файловое смещение сертификата, не RVA, и размер (IMAGE_DIRECTORY_ENTRY_SECURITY). Складываете смещение + размер = нужное смещение.<br><br>Если сертификата нет, тогда оверлей по смещению конца raw data последней не пустой секции.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=364590&amp;user=28841&amp;forum_n=5&amp;topic=24135&amp;page=0&amp;anchor=10" class="addthx" data-post="364590"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=24257" title="08-05-2016 18:12, ранг:268.8" target="_blank">DenCoder</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]dosprog[/b]','')">dosprog</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 431.7 (мудрец), 390thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.95'>Активность: 0.73<span style='color:red'>&searr;</span>0.32</span><br>Статус: <a href="action=userinfo&amp;user=35473">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 мая 2016 16:48 &middot; Поправил: dosprog <br><script type="text/javascript">QU('dosprog','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=dosprog" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24135&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
<I>Kuzya69 пишет:<br>Может и встретится, </I><br><br>Может случиться вообще что угодно. Но, как правило, не случается.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=364591&amp;user=35473&amp;forum_n=5&amp;topic=24135&amp;page=0&amp;anchor=11" class="addthx" data-post="364591"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]Kuzya69[/b]','')">Kuzya69</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 30.1 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.16'>Активность: 0.07<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29098">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 мая 2016 17:00 &middot; Поправил: Kuzya69 <br><script type="text/javascript">QU('Kuzya69','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Kuzya69" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24135&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
<I>vden пишет:<br>Фактически сертификат в оверлее. Но тут все просто. В data directories явно указано файловое смещение сертификата, не RVA (IMAGE_DIRECTORY_ENTRY_SECURITY). Складываете смещение + размер = нужное смещение.  </I><br>Это все понятно. Именно так я и определил, что там таблица сертификата, а не оверлей левый. А если вариант, что сертификат перенесут в середину файла, или еще какой-нибудь элемент добавят в data directories? Я так и не нашел полного описания всех элементов в data directories. Только стандартные 0х10 штук. А если &quot;NumberOfRvaAndSizes&quot; будет больше 0х10?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=364592&amp;user=29098&amp;forum_n=5&amp;topic=24135&amp;page=0&amp;anchor=12" class="addthx" data-post="364592"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]unknownproject[/b]','')">unknownproject</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 95.1 (постоянный), 247thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.52'>Активность: 0.26<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=27422">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 мая 2016 17:01 <br><script type="text/javascript">QU('unknownproject','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=unknownproject" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24135&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
<I>Kuzya69 пишет:<br>Я думал о стринге &quot;overlay&quot;, но все равно не уверен на 100%.  </I><br>А в чем проблема ? Открылся файл с атрибутом для чтения, например.Считали его размер, определили некоторую переменную, в которую записали размер.Читаем в цикле файл, уменьшая значение этой переменной, т.е. абсолютное смещение.Определили условие для нахождения строки &quot;overlay&quot; и как только смещение укажет на нужную строку, т.е. в буфер упадет нужная строка фиксированного размера в байтах (искомая сигнатура), то сразу прерываем цикл и сохраняем смещение в другую переменную.Ну и, естественно, строка встретится ровно столько раз, сколько она была определена в файле, а вот строки &quot;DoSpRoG&quot; там никогда не будет, если ее намеренно не вписать.
<br><br><font size="1"><i>-----<br>TEST YOUR MIGHT</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=364593&amp;user=27422&amp;forum_n=5&amp;topic=24135&amp;page=0&amp;anchor=13" class="addthx" data-post="364593"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]vden[/b]','')">vden</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 112.9 (ветеран), 186thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.22'>Активность: 0.09<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=28841">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 мая 2016 17:10 &middot; Поправил: vden <br><script type="text/javascript">QU('vden','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=vden" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24135&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
<I>Kuzya69 пишет:<br>Это все понятно. А если вариант, что сертификат перенесут в середину файла, или еще какой-нибудь элемент добавят в data directories? Я так и не нашел полного описания всех элементов в data directories. Только стандартные 0х10 штук. А если &quot;NumberOfRvaAndSizes&quot; будет больше 0х10?  </I><br><br>Ну тогда лучше не гадать, а посмотреть как оригинальная программа ищет оверлей.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=364594&amp;user=28841&amp;forum_n=5&amp;topic=24135&amp;page=0&amp;anchor=14" class="addthx" data-post="364594"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]Kuzya69[/b]','')">Kuzya69</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 30.1 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.16'>Активность: 0.07<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29098">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 мая 2016 17:15 <br><script type="text/javascript">QU('Kuzya69','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Kuzya69" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24135&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
<I>vden пишет:<br>А возможности посмотреть как находит оверлей оригинальная программа нет? </I><br>Ну оригинальная программа не ищет оверлея. Оверлей Я хочу прилеплять, без раздумий. Только нет уверенности, что на очередной версии недоделанный алгоритм поиска оверлея не даст сбой. Поэтому и хочется сделать нормальный, универсальный алгоритм поиска оверлея. Не задумываясь потом, может даже не только для этой программы.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=364596&amp;user=29098&amp;forum_n=5&amp;topic=24135&amp;page=0&amp;anchor=15" class="addthx" data-post="364596"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]vden[/b]','')">vden</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 112.9 (ветеран), 186thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.22'>Активность: 0.09<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=28841">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 мая 2016 17:25 &middot; Поправил: vden <br><script type="text/javascript">QU('vden','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=vden" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24135&amp;page=0#16');return false;">#16</a> </span><div align=left><br>
Такая структура, мне кажется, вполне подойдет:<br><br>Тег начала, Данные, Тег конца, Контрольная сумма, Размер<br><br>А там уже по усмотрению.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=364597&amp;user=28841&amp;forum_n=5&amp;topic=24135&amp;page=0&amp;anchor=16" class="addthx" data-post="364597"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]Kuzya69[/b]','')">Kuzya69</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 30.1 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.16'>Активность: 0.07<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29098">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 мая 2016 17:31 <br><script type="text/javascript">QU('Kuzya69','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Kuzya69" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24135&amp;page=0#17');return false;">#17</a> </span><div align=left><br>
То-есть получается, нет никакой возможности определить где заканчивается оригинальный файл и начинается оверлей в общем случае? Только частные варианты или использование маркеров?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=364599&amp;user=29098&amp;forum_n=5&amp;topic=24135&amp;page=0&amp;anchor=17" class="addthx" data-post="364599"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]Hellspawn[/b]','')">Hellspawn</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/72.gif" alt=""><br><span class=txtSm>Ранг: 990.2 <font color=red>(<b>! ! !</b>)</font>, 380thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.95'>Активность: 0.68<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=72">Модератор</a><br><font color=blue>Author of DiE</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 мая 2016 17:39 <br><script type="text/javascript">QU('Hellspawn','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Hellspawn" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24135&amp;page=0#18');return false;">#18</a> </span><div align=left><br>
<b>Kuzya69</b> что за гадание, а если так, а может вот так. нормально можно оверлей доставать, вот 1 минута гугла: https://www.autoitscript.com/forum/topic/153277-pe-file-overlay-extraction/
<br><br><font size="1"><i>-----<br>[nice coder and reverser]</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=364601&amp;user=72&amp;forum_n=5&amp;topic=24135&amp;page=0&amp;anchor=18" class="addthx" data-post="364601"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]vden[/b]','')">vden</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 112.9 (ветеран), 186thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.22'>Активность: 0.09<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=28841">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 мая 2016 17:40 &middot; Поправил: vden <br><script type="text/javascript">QU('vden','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=vden" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24135&amp;page=0#19');return false;">#19</a> </span><div align=left><br>
Оверлей всегда начинается после данных последней не пустой секции. Другое дело кто и что хочет добавлять в конец файла.<br><br>Если данные будут добавляться несколько раз, очевидно, что нужно хотя бы указывать размер каждого блока.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=364602&amp;user=28841&amp;forum_n=5&amp;topic=24135&amp;page=0&amp;anchor=19" class="addthx" data-post="364602"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="20" onfocus="this.blur()" href="JavaScript:di('[b]Kuzya69[/b]','')">Kuzya69</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 30.1 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.16'>Активность: 0.07<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29098">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 мая 2016 18:15 &middot; Поправил: Kuzya69 <br><script type="text/javascript">QU('Kuzya69','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Kuzya69" target="_blank">Личное сообщение</a> &middot;  <a href="#20" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24135&amp;page=0#20');return false;">#20</a> </span><div align=left><br>
<I>Hellspawn пишет:<br> https://www.autoitscript.com/forum/topic/153277-pe-file-overlay-extraction/  </I><br>Ну в принципе я это спрашивал в самом первом посту. <br>Автор скрипта делает допущение, что последние байты оригинального файла - это конец сертификата. <br>Так и я делаю. Но гложат сомнения, поэтому и открыл тему.<br>Если бы где-то это правило о конце файла было прописано как закон, то я бы не спрашивал.<br>Ведь никто не помешает мне изменить файл так, что свой оверлей я поставлю сразу за последней секцией файла, а сертификат после оверлея. Или сертификат поставить между секциями(тут я конечно не уверен). Но можно будет попробовать на какой-нибудь простенькой программе.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=364603&amp;user=29098&amp;forum_n=5&amp;topic=24135&amp;page=0&amp;anchor=20" class="addthx" data-post="364603"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="21" onfocus="this.blur()" href="JavaScript:di('[b]Hellspawn[/b]','')">Hellspawn</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/72.gif" alt=""><br><span class=txtSm>Ранг: 990.2 <font color=red>(<b>! ! !</b>)</font>, 380thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.95'>Активность: 0.68<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=72">Модератор</a><br><font color=blue>Author of DiE</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 мая 2016 18:29 <br><script type="text/javascript">QU('Hellspawn','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Hellspawn" target="_blank">Личное сообщение</a> &middot;  <a href="#21" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24135&amp;page=0#21');return false;">#21</a> </span><div align=left><br>
<b>Kuzya69</b> и что это меняет? если сертификат будет, то о нем должно быть упоминание в таблице, а там и размер и адрес указаны <img src="img/smilies/s1.gif" alt="">
<br><br><font size="1"><i>-----<br>[nice coder and reverser]</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=364605&amp;user=72&amp;forum_n=5&amp;topic=24135&amp;page=0&amp;anchor=21" class="addthx" data-post="364605"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=8605" title="09-05-2016 09:22, ранг:55.4" target="_blank">Rio</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="22" onfocus="this.blur()" href="JavaScript:di('[b]Kuzya69[/b]','')">Kuzya69</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 30.1 (посетитель)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.16'>Активность: 0.07<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29098">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 мая 2016 18:40 <br><script type="text/javascript">QU('Kuzya69','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Kuzya69" target="_blank">Личное сообщение</a> &middot;  <a href="#22" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24135&amp;page=0#22');return false;">#22</a> </span><div align=left><br>
<I>Hellspawn пишет:<br>и что это меняет? </I><br>Ну да поторопился с придумыванием конфликтной ситуации. <br>Пожалуй только одна ситуация может конфликт дать. <br>Например количество элементов в data directories будет больше 0х10. И мы не знаем какие параметры для этих (больших чем 0х10) элементов заданы (VA или Rwa). И оказывается, что один из элементов стоит за сертификатом.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=364606&amp;user=29098&amp;forum_n=5&amp;topic=24135&amp;page=0&amp;anchor=22" class="addthx" data-post="364606"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="23" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 222thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 мая 2016 20:51 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#23" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24135&amp;page=0#23');return false;">#23</a> </span><div align=left><br>
<I>Kuzya69 пишет:<br>Какой конец образа? Оверлей-же не проецируется в память </I><br>мда... Go to school!<br>Краткий ликбез:<br>Файлы - на диске<br>Образ (исполняемый, будь то dll, exe, ocx, scr, или ещё что) - проецируется nt-загрузчиком в память процесса по разделам. За границы разделов, указанные в массиве структур IMAGE_SECTION_HEADER, не выходит. У MapViewOfFile()/ есть аргумент dwDesiredAccess, когда он FILE_MAP_EXECUTE, то происходит именно так, как я сказал. У более низкоуровневой ZwCreateSection(), которой пользуется загрузчик, также есть dwDesiredAccess, и происходит то же, что выше, когда он равен SECTION_MAP_EXECUTE<br><br><b>Добавлено спустя 2 минуты</b><br><I>Kuzya69 пишет:<br>Но гложат сомнения, поэтому и открыл тему. </I><br>При сомнениях проще взять и проверить!<br><br><b>Добавлено спустя 5 минут</b><br><b>Kuzya69</b><br>По оверлею простой эксперимент с идой - поставьте на загрузке exe или dll галку на manual load и везде отвечаете &quot;да&quot;, пока ида не спросит Вас, нужно ли грузить оверлей. Ильфаку-то поверите? )<br><br><b>Добавлено спустя 19 минут</b><br><I>Kuzya69 пишет:<br>Например количество элементов в data directories будет больше 0х10 </I><br>Оно никогда на винде не будет больше! Потому как в WinNt.h прописано<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">#define&nbsp;IMAGE_NUMBEROF_DIRECTORY_ENTRIES&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">16</span></li>        </ol>
    </div>
</div></div>
<br><br>Ладно, если б не было документировано, понятно ещё - что ж делать, надо спрашивать... Но это всё уже давным давно открыто...<br><br>2004 год. Мне было интересно узнать формат PE Header&#039;а, интернета не было. Съездил на книжный рынок, купил книгу Румянцева &quot;Исследование программ Win32. До дизассемблера и отладчика.&quot; А Вы тут пурги нагнали с вагон!!! <img src="img/smilies/s10.gif" alt="">
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=364609&amp;user=24257&amp;forum_n=5&amp;topic=24135&amp;page=0&amp;anchor=23" class="addthx" data-post="364609"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=29098" title="08-05-2016 18:28, ранг:23.1" target="_blank">Kuzya69</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="24" onfocus="this.blur()" href="JavaScript:di('[b]VT-x[/b]','')">VT-x</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 16.3 (новичок), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.38'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=40334">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 мая 2016 21:10 &middot; Поправил: VT-x <br><script type="text/javascript">QU('VT-x','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=VT-x" target="_blank">Личное сообщение</a> &middot;  <a href="#24" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24135&amp;page=0#24');return false;">#24</a> </span><div align=left><br>
<b>Kuzya69</b><br>Разве сертификат не станет не валидным, если вы файл измените в том же EOF?<br>Оверлей обычно так смотрю<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">PIMAGE_DOS_HEADER&nbsp;pidh<span class="hl_char">=</span>&nbsp;<span class="hl_char">(</span>PIMAGE_DOS_HEADER<span class="hl_char">)</span>lpBuff<span class="hl_comment">;</span></li><li class="hl_l1">PIMAGE_NT_HEADERS&nbsp;pinh<span class="hl_char">=</span>&nbsp;PIMAGE_NT_HEADERS<span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">(</span>lpBuff<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_function">DWORD</span><span class="hl_char">(</span>pidh<span class="hl_char">-</span><span class="hl_char">&gt;</span>e_lfanew<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">PIMAGE_OPTIONAL_HEADER&nbsp;pioh&nbsp;<span class="hl_char">=</span><span class="hl_char">&amp;</span><span class="hl_char">(</span>pinh<span class="hl_char">-</span><span class="hl_char">&gt;</span>OptionalHeader<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span class="hl_char">/</span><span class="hl_char">/</span>Последняя&nbsp;секция</li><li class="hl_l0">PIMAGE_SECTION_HEADER&nbsp;pish&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">(</span>PIMAGE_SECTION_HEADER<span class="hl_char">)</span><span class="hl_char">&amp;</span>lpBuff<span class="hl_char">[</span>pidh<span class="hl_char">-</span><span class="hl_char">&gt;</span>e_lfanew&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>IMAGE_NT_HEADERS<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>IMAGE_SECTION_HEADER<span class="hl_char">)</span>&nbsp;<span class="hl_char">*</span>&nbsp;<span class="hl_char">(</span>pinh<span class="hl_char">-</span><span class="hl_char">&gt;</span>FileHeader<span class="hl_char">.</span>NumberOfSections<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span><span class="hl_char">]</span><span class="hl_comment">;</span></li><li class="hl_l1"><span class="hl_function"><b>DWORD</b></span>&nbsp;dwOvrStartNoAlign&nbsp;<span class="hl_char">=</span>&nbsp;pish<span class="hl_char">-</span><span class="hl_char">&gt;</span>PointerToRawData&nbsp;<span class="hl_char">+</span>&nbsp;pish<span class="hl_char">-</span><span class="hl_char">&gt;</span>SizeOfRawData<span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_function"><b>DWORD</b></span>&nbsp;dwOvrStartAlign&nbsp;<span class="hl_char">=</span>&nbsp;ALIGN_UP<span class="hl_char">(</span>dwOvrStartNoAlign<span class="hl_char">,</span>pioh<span class="hl_char">-</span><span class="hl_char">&gt;</span>SectionAlignment<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span class="hl_function">if</span><span class="hl_char">(</span>dwOvrStart<span class="hl_char">!</span><span class="hl_char">=</span>dwOvrStartNoAlign<span class="hl_char">)</span>&nbsp;<span class="hl_char">/</span><span class="hl_char">*</span><span class="hl_function"><b>not</b></span>&nbsp;aligned<span class="hl_char">*</span><span class="hl_char">/</span>&nbsp;dwNormOvrStart&nbsp;<span class="hl_char">=</span>&nbsp;&nbsp;dwOvrStartAlign<span class="hl_comment">; </span></li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=364610&amp;user=40334&amp;forum_n=5&amp;topic=24135&amp;page=0&amp;anchor=24" class="addthx" data-post="364610"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="25" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 222thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 мая 2016 21:19 <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#25" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24135&amp;page=0#25');return false;">#25</a> </span><div align=left><br>
<b>VT-x</b><br>2 строки лишние <img src="img/smilies/s1.gif" alt=""><br><br>нормально будет<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">dwNormOvrStart&nbsp;<span class="hl_char">=</span>&nbsp;ALIGN_UP<span class="hl_char">(</span><span class="hl_char">(</span>pish<span class="hl_char">-</span><span class="hl_char">&gt;</span>PointerToRawData&nbsp;<span class="hl_char">+</span>&nbsp;pish<span class="hl_char">-</span><span class="hl_char">&gt;</span>SizeOfRawData<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;pioh<span class="hl_char">-</span><span class="hl_char">&gt;</span>SectionAlignment<span class="hl_char">)</span><span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div><br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=364611&amp;user=24257&amp;forum_n=5&amp;topic=24135&amp;page=0&amp;anchor=25" class="addthx" data-post="364611"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="26" onfocus="this.blur()" href="JavaScript:di('[b]VT-x[/b]','')">VT-x</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 16.3 (новичок), 2thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.38'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=40334">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 мая 2016 21:29 <br><script type="text/javascript">QU('VT-x','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=VT-x" target="_blank">Личное сообщение</a> &middot;  <a href="#26" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24135&amp;page=0#26');return false;">#26</a> </span><div align=left><br>
Просто очень часто школоло поделки попадают на вход в крипт с noaligned EOF <img src="img/smilies/s1.gif" alt="">)
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=364612&amp;user=40334&amp;forum_n=5&amp;topic=24135&amp;page=0&amp;anchor=26" class="addthx" data-post="364612"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="27" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 222thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 мая 2016 21:32 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#27" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24135&amp;page=0#27');return false;">#27</a> </span><div align=left><br>
Да, и, кстати, про VirtualSize не забывайте, оно никогда не выровнено по границе. И всё, что свыше VirtualSize, не загрузится )<br><br><b>Добавлено спустя 4 минуты</b><br><I>VT-x пишет:<br>Просто очень часто школоло поделки попадают на вход в крипт с noaligned EOF </I><br>И? У Вас код аналогичен<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">a&nbsp;<span class="hl_char">=</span>&nbsp;c<span class="hl_comment">;</span></li><li class="hl_l1">b&nbsp;<span class="hl_char">=</span>&nbsp;ALIGN_UP<span class="hl_char">(</span>a<span class="hl_char">,</span>&nbsp;ALIGNMENT<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_function">if</span><span class="hl_char">(</span>a&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;b<span class="hl_char">)</span>&nbsp;OverlayStart&nbsp;<span class="hl_char">=</span>&nbsp;b<span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div>
<br>Внимательней посмотрите <img src="img/smilies/s1.gif" alt=""><br><br><b>Добавлено спустя 58 минут</b><br>Проще говоря правильней будет<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">OverlayStart&nbsp;<span class="hl_char">=</span>&nbsp;pish<span class="hl_char">-</span><span class="hl_char">&gt;</span>PointerToRawData&nbsp;<span class="hl_char">+</span>&nbsp;pish<span class="hl_char">-</span><span class="hl_char">&gt;</span>VirtualSize</li>        </ol>
    </div>
</div></div>
<br><br><b>Добавлено спустя 59 минут</b><br>Если не прав - поправьте.<br><br><b>Добавлено спустя 1 час 3 минуты</b><br>Длина оверлея будет:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">OverlaySize&nbsp;<span class="hl_char">=</span>&nbsp;GetFileSize<span class="hl_char">(</span>hFile<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">-</span>&nbsp;pish<span class="hl_char">-</span><span class="hl_char">&gt;</span>PointerToRawData&nbsp;<span class="hl_char">+</span>&nbsp;pish<span class="hl_char">-</span><span class="hl_char">&gt;</span>VirtualSize</li>        </ol>
    </div>
</div></div>
<br><br><b>Добавлено спустя 1 час 6 минут</b><br>Я забыл, что в файлах, накрытых вмпротом, например, не факт, что именно за последней секцией будет оверлей. Правильней будет сказать - <b>за секцией с максимальным конечным адресом</b>
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=364613&amp;user=24257&amp;forum_n=5&amp;topic=24135&amp;page=0&amp;anchor=27" class="addthx" data-post="364613"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="28" onfocus="this.blur()" href="JavaScript:di('[b]Hellspawn[/b]','')">Hellspawn</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/72.gif" alt=""><br><span class=txtSm>Ранг: 990.2 <font color=red>(<b>! ! !</b>)</font>, 380thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.95'>Активность: 0.68<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=72">Модератор</a><br><font color=blue>Author of DiE</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 мая 2016 23:14 <br><script type="text/javascript">QU('Hellspawn','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Hellspawn" target="_blank">Личное сообщение</a> &middot;  <a href="#28" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24135&amp;page=0#28');return false;">#28</a> </span><div align=left><br>
<b>DenCoder</b> поправляю, при чем тут VirtualSize вообще?))) и к последней секции не имеет смысла цепляться, нужно перечислить все. ну и выравнивание учесть желательно для размера.<br><br>вот код https://www.strchr.com/creating_self-extracting_executables<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;For&nbsp;each&nbsp;<span class="hl_function">section</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;maxpointer&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;exesize&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;for<span class="hl_char">(</span><span class="hl_function"><b>int</b></span>&nbsp;i&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_comment">; i &lt; header-&gt;FileHeader.NumberOfSections; i++) {</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>sectiontable<span class="hl_char">-</span><span class="hl_char">&gt;</span>PointerToRawData&nbsp;<span class="hl_char">&gt;</span>&nbsp;maxpointer<span class="hl_char">)</span>&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maxpointer&nbsp;<span class="hl_char">=</span>&nbsp;sectiontable<span class="hl_char">-</span><span class="hl_char">&gt;</span>PointerToRawData<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exesize&nbsp;<span class="hl_char">=</span>&nbsp;sectiontable<span class="hl_char">-</span><span class="hl_char">&gt;</span>PointerToRawData&nbsp;<span class="hl_char">+</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sectiontable<span class="hl_char">-</span><span class="hl_char">&gt;</span>SizeOfRawData<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;sectiontable<span class="hl_char">+</span><span class="hl_char">+</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;Seek&nbsp;to&nbsp;the&nbsp;overlay</li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;filesize&nbsp;<span class="hl_char">=</span>&nbsp;GetFileSize<span class="hl_char">(</span>hFile<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;SetFilePointer<span class="hl_char">(</span>hFile<span class="hl_char">,</span>&nbsp;exesize<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;FILE_BEGIN<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>data</b></span>&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">(</span><span class="hl_function">BYTE</span><span class="hl_char">*</span><span class="hl_char">)</span>malloc<span class="hl_char">(</span>filesize&nbsp;<span class="hl_char">-</span>&nbsp;exesize&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">1</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;ReadFile<span class="hl_char">(</span>hFile<span class="hl_char">,</span>&nbsp;<span class="hl_function">data</span><span class="hl_char">,</span>&nbsp;filesize&nbsp;<span class="hl_char">-</span>&nbsp;exesize<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>read<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;CloseHandle<span class="hl_char">(</span>hFile<span class="hl_char">)</span><span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div><br><br><font size="1"><i>-----<br>[nice coder and reverser]</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=364615&amp;user=72&amp;forum_n=5&amp;topic=24135&amp;page=0&amp;anchor=28" class="addthx" data-post="364615"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=24257" title="08-05-2016 21:15, ранг:268.8" target="_blank">DenCoder</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="29" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 222thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 мая 2016 00:16 <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#29" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24135&amp;page=0#29');return false;">#29</a> </span><div align=left><br>
Ну может чего подзабыл, завтра посмотрю )
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=364616&amp;user=24257&amp;forum_n=5&amp;topic=24135&amp;page=0&amp;anchor=29" class="addthx" data-post="364616"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="30" onfocus="this.blur()" href="JavaScript:di('[b]dosprog[/b]','')">dosprog</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 431.7 (мудрец), 390thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.95'>Активность: 0.73<span style='color:red'>&searr;</span>0.32</span><br>Статус: <a href="action=userinfo&amp;user=35473">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 мая 2016 01:47 &middot; Поправил: dosprog <br><script type="text/javascript">QU('dosprog','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=dosprog" target="_blank">Личное сообщение</a> &middot;  <a href="#30" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=24135&amp;page=0#30');return false;">#30</a> </span><div align=left><br>
<I>Kuzya69 пишет:<br>То-есть получается, нет никакой возможности определить где заканчивается оригинальный файл и начинается оверлей в общем случае?  </I><br><br>Как это - &quot;нет способов?&quot; <br>Конец  последней секции, описанной в заголовке, это и есть начало оверлея.<br>Что-то, гляжу, обсуждение по кругу пошло.<br><br><I>DenCoder пишет:<br>Я забыл, что в файлах, накрытых вмпротом, например, не факт, что именно за последней секцией будет оверлей. Правильней будет сказать - за секцией с максимальным конечным адресом<br> </I><br>Так это и есть <b>последняя секция, описанная заголовке</b>.<br><br><I>Kuzya69 пишет:<br>Ну оригинальная программа не ищет оверлея. Оверлей Я хочу прилеплять, без раздумий.  </I><br><br>Возня с оверлеями это костыльный вариант. <br>Впрочем, если сделать всё по уму, то работать будет.<br><i class=x><br></i>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=364617&amp;user=35473&amp;forum_n=5&amp;topic=24135&amp;page=0&amp;anchor=30" class="addthx" data-post="364617"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> .  <b>1</b> . <a href="action=vthread&amp;forum=5&amp;topic=24135&amp;page=1.html">2</a> . <a href="action=vthread&amp;forum=5&amp;topic=24135&amp;page=1.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/nub.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=5&sortBy=0&page=0.html"><b>Вопросы новичков</b></a> <b class=bulletHead>&#8212;&#8250;</b> Где начало оверлея</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#31" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="5">
<input type="hidden" name="topic" value="24135">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=24135" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
