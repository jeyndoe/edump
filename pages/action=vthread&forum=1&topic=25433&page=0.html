<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Взлом криптографии при обмене данных с устройством - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Введение в тему: Имеется система сервер-программа-устройство клиент, все они общаются друг с другом криптованными данными. Поток данных сервер &lt;-&gt; устройство проходит транзитом через программу с перепаковкой, сами данные">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=31361'>zds</a>, <a target='_blank' href='?action=userinfo&amp;user=28512'>-Sanchez-</a> (+9 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/green.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=1&sortBy=0&page=0.html"><b>Основной форум</b></a> <b class=bulletHead>&#8212;&#8250;</b> Взлом криптографии при обмене данных с устройством</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> .  <b>1</b> . <a href="action=vthread&amp;forum=1&amp;topic=25433&amp;page=1.html">2</a> . <a href="action=vthread&amp;forum=1&amp;topic=25433&amp;page=1.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]Vamit[/b]','')">Vamit</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/20406.jpg" alt=""><br><span class=txtSm>Ранг: 331.1 (мудрец), 561thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.3'>Активность: 0.19<span style='color:red'>&searr;</span>0.06</span><br>Статус: <a href="action=userinfo&amp;user=20406">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 ноября 2018 12:36 &middot; Поправил: Vamit <br><script type="text/javascript">QU('Vamit','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vamit" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=25433&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Введение в тему:<br>Имеется система сервер-программа-устройство клиент, все они общаются друг с другом криптованными данными.<br>Поток данных сервер &lt;-&gt; устройство проходит транзитом через программу с перепаковкой, сами данные при этом не изменяются. Потоки данных сервер &lt;-&gt; программа и программа &lt;-&gt; устройство полностью изучены, возможно посылать им криптованную информацию и получать на неё ответы.<br>Прямой доступ есть только к коду программы, остальные две стороны - черные ящики.<br><br>Схема начала криптообмена сервер-программа:<br>- import openssl_key to rsa_key (openssl_key short 140 bytes)<br>- create symmetric CBC key for cipher AES128 with random IV (16 bytes) and const pseudorandom key (16 bytes)<br>- encrypt RSA key: in const pseudorandom key with random prng to SHA256 for rsa_key<br>- отправка криптованного ключа на сервер<br>Таблица векторов IV у клиента(программа) фиксирована 16 * 16 байт, другая информация на сервер не передается, далее идет только крипт/декрипт пакетов.<br><br>Схема начала криптообмена программа-устройство:<br>- import openssl_key to rsa_key (openssl_key long 609 bytes)<br>- устройству дается команда, на которую оно высылает encrypted RSA key (128 bytes)<br>- decrypt RSA key to hash SHA256 from rsa_key<br>- create symmetric CBC key for cipher AES256 with const IV and decrypted RSA key<br>Таблица векторов IV в программе фиксирована 16 * 16 байт и отлична от таблицы векторов для сервера, другая информация на сервер не передается, далее только крипт/декрипт пакетов.<br>Эти схемы привел только для того чтобы было понятно какие крипто алгоритмы задействованы.<br><br><b>Задача: декриптовать данные в потоке обмена данных с устройством.</b><br>В этом случае имеем следующее:<br>- инициатором криптообмена всегда выступает устройство<br>- первый пакет данных на сервер состоит из двух частей фиксированной длины, первая часть постоянная размером 11 байт (её структура: 1ый байт 01, далее 8 байт назовем как серийный номер устройства, т.к. у разных устройств эти данные отличаются, 10-11 байты 0080), вторая часть пакета размером 448 байт уникальна для каждого сеанса криптообмена<br>- сервер всегда отвечает на первый пакет от устройства даже если этот пакет был подменен и взят от старого сеанса связи<br>- ответ сервера имеет фиксированный размер 384 байта, но информация в ответе уникальна для каждого ответа<br>- на отправленный 2ой пакет от старого сеанса связи сервер уже не отвечает<br><br>Вопрос: возможно ли на основе этих данных вычислить symmetric CBC key для потока данных сервер &lt;-&gt; устройство?
<br><br><font size="1"><i>-----<br>Everything is relative...</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=388739&amp;user=20406&amp;forum_n=1&amp;topic=25433&amp;page=0&amp;anchor=1" class="addthx" data-post="388739"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]Jupiter[/b]','')">Jupiter</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/1379.png" alt=""><br><span class=txtSm>Ранг: 605.2 (<b>!</b>), 341thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.38'>Активность: 0.47<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1379">Модератор</a><br><font color=blue>Research &amp; Development</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 ноября 2018 12:50 <br><script type="text/javascript">QU('Jupiter','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Jupiter" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=25433&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
Я правильно понимаю, что этап &quot;create symmetric CBC key&quot; повторяется для каждой сессии и уникален между сессиями?
<br><br><font size="1"><i>-----<br>EnJoy!</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=388740&amp;user=1379&amp;forum_n=1&amp;topic=25433&amp;page=0&amp;anchor=2" class="addthx" data-post="388740"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]Vamit[/b]','')">Vamit</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/20406.jpg" alt=""><br><span class=txtSm>Ранг: 331.1 (мудрец), 561thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.3'>Активность: 0.19<span style='color:red'>&searr;</span>0.06</span><br>Статус: <a href="action=userinfo&amp;user=20406">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 ноября 2018 13:11 &middot; Поправил: Vamit <br><script type="text/javascript">QU('Vamit','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vamit" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=25433&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
<b>Jupiter</b><br><br>Думаю что да, в приведенных схемах программа эти действия выполняет однократно, но запуск программы тоже можно считать сеансом работы. Причем если программа дает reset устройству, то CBC ключ генерится заново, аналогично и с сервером, если сделать его тест или новое подключение к нему, то CBC ключ генерится и посылается на сервер.<br>Так что получается что symmetric CBC key уникален для каждой сессии с каждой стороной, аналогично, как я думаю, будет и при обмене сервер &lt;-&gt; устройство.<br>В пределах же установленной сессии может передаваться в обе стороны Nое кол-во криптопакетов.<br><br><br>ЗЫ:<br>В схеме сервер-программа<br>create symmetric CBC key for cipher AES128 with random IV (16 bytes) and const pseudorandom key (16 bytes) - тут нет рандомности, это random IV написано не совсем корректно, т.к. это константный вектор, но не из таблицы векторов. И для разных сеансов связи с сервером генерится всегда константный symmetric CBC key.<br><br>В схеме программа-устройство<br>create symmetric CBC key for cipher AES256 with const IV and decrypted RSA key - генерится из принятого от устройства декриптованного хеша SHA256, хеш после декрипта всегда разный, значит и symmetric CBC key для каждого сеанса программа-устройство будет уникальным.
<br><br><font size="1"><i>-----<br>Everything is relative...</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=388741&amp;user=20406&amp;forum_n=1&amp;topic=25433&amp;page=0&amp;anchor=3" class="addthx" data-post="388741"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]Jupiter[/b]','')">Jupiter</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/1379.png" alt=""><br><span class=txtSm>Ранг: 605.2 (<b>!</b>), 341thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.38'>Активность: 0.47<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1379">Модератор</a><br><font color=blue>Research &amp; Development</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 ноября 2018 13:26 <br><script type="text/javascript">QU('Jupiter','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Jupiter" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=25433&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
В таком случае я бы искусственно фиксировал некий &quot;бесконечный&quot; MiTM-сеанс с условным &quot;бесконечным&quot; количеством блоков открытых и шифртекстов, благодаря чему можно было бы более свободно реализовывать атаки на собственно шифр, применяя все доступные способы, включая внедрение в открытый и шифртекст.<br>И вот тут важный момент: если проверяющая сторона не удостоверяется в целостности шифртекста, то можно с некой долей вероятности утверждать, что атака может быть успешной в конечном итоге. По факту CBC без MAC/HMAC (keyed-hash message authentication code) не считается безопасным для реализации. А судя по тому алгоритму, который ты описал, в данной реализации отсутствует MAC/HMAC в явном виде.<br><br><b>Куда копать:</b><br>- Padding oracle attack<br>- Timing vulnerabilities with CBC-mode symmetric decryption using padding (тайминг-атака на CBC с пэддингом без MAC/HMAC)<br><br><b>Ссылочки</b> (остальное сам можешь найти, на каком проще читать):<br>https://blog.gdssecurity.com/labs/2010/9/14/automated-padding-oracle-attacks-with-padbuster.html<br>https://habr.com/post/247527/<br>https://habr.com/post/338072/<br>https://docs.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode<br>https://www.securitylab.ru/analytics/481048.php
<br><br><font size="1"><i>-----<br>EnJoy!</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=388743&amp;user=1379&amp;forum_n=1&amp;topic=25433&amp;page=0&amp;anchor=4" class="addthx" data-post="388743"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=20406" title="04-11-2018 10:34, ранг:286.1" target="_blank">Vamit</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]Vamit[/b]','')">Vamit</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/20406.jpg" alt=""><br><span class=txtSm>Ранг: 331.1 (мудрец), 561thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.3'>Активность: 0.19<span style='color:red'>&searr;</span>0.06</span><br>Статус: <a href="action=userinfo&amp;user=20406">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 ноября 2018 14:13 &middot; Поправил: Vamit <br><script type="text/javascript">QU('Vamit','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vamit" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=25433&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
За ссылки благодарю, но большинство их я уже читал и изучал уязвимость padding oracle attack, но все дело в том что я не знаю с чего начинать атаку, т.к. это первый случай в моей практике...<br>Мне также неизвестно где начинаются криптованные данные, хоть первый пакет от устройства в сервер и содержит уникальную часть 448 байт, но я не представляю что там может быть, но это не данные, т.к. на этот пакет я всегда получаю ответ от сервера.<br>Ответ от сервера тоже нельзя считать криптованными данными (по размеру 384 байта это скорее всего таблица векторов IV (256 байт) и криптованный хеш ключа (128 байт), причем они могут быть и не в оригинальном виде, но это только моё предположение), а на все дальнейшие пакеты от старых сессий сервер не отвечает.
<br><br><font size="1"><i>-----<br>Everything is relative...</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=388744&amp;user=20406&amp;forum_n=1&amp;topic=25433&amp;page=0&amp;anchor=5" class="addthx" data-post="388744"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]bartolomeo[/b]','')">bartolomeo</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 42.8 (посетитель), 16thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.87'>Активность: 0.02<span style='color:green'>&nearr;</span>0.06</span><br>Статус: <a href="action=userinfo&amp;user=26261">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 ноября 2018 15:09 <br><script type="text/javascript">QU('bartolomeo','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=bartolomeo" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=25433&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
можно пример первого пакета от устройства и ответ на него от сервера ?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=388745&amp;user=26261&amp;forum_n=1&amp;topic=25433&amp;page=0&amp;anchor=6" class="addthx" data-post="388745"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]Vamit[/b]','')">Vamit</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/20406.jpg" alt=""><br><span class=txtSm>Ранг: 331.1 (мудрец), 561thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.3'>Активность: 0.19<span style='color:red'>&searr;</span>0.06</span><br>Статус: <a href="action=userinfo&amp;user=20406">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 ноября 2018 15:37 &middot; Поправил: Vamit <br><script type="text/javascript">QU('Vamit','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vamit" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=25433&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
пакеты в прикрепленном файле, хотел обернуть в тэг кода и вывести в посте, но непропорциональный шрифт ломает всю разметку, получается жуть...<br>приведены только данные пакетов, заголовки за ненадобностью отрезаны<br><br>Причем, посылая каждый раз на сервер один и тот же первый пакет, всегда получаю от него уникальный ответ, отличный от предыдущего.<br><br><img src="img/attach.gif" alt=""> <a href="./files/a0ae_04.11.2018_EXELAB.rU.tgz">a0ae_04.11.2018_EXELAB.rU.tgz</a> - FirstPacket.txt
<br><br><font size="1"><i>-----<br>Everything is relative...</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=388747&amp;user=20406&amp;forum_n=1&amp;topic=25433&amp;page=0&amp;anchor=7" class="addthx" data-post="388747"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=26261" title="04-11-2018 12:46, ранг:17.9" target="_blank">bartolomeo</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]bartolomeo[/b]','')">bartolomeo</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 42.8 (посетитель), 16thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.87'>Активность: 0.02<span style='color:green'>&nearr;</span>0.06</span><br>Статус: <a href="action=userinfo&amp;user=26261">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 ноября 2018 15:46 &middot; Поправил: bartolomeo <br><script type="text/javascript">QU('bartolomeo','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=bartolomeo" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=25433&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
ещё нужен первый пакет от устройства но от другой сессии - и ответ на него.<br>желательно от того же устройства.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=388748&amp;user=26261&amp;forum_n=1&amp;topic=25433&amp;page=0&amp;anchor=8" class="addthx" data-post="388748"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=20406" title="04-11-2018 13:02, ранг:287.1" target="_blank">Vamit</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]Vamit[/b]','')">Vamit</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/20406.jpg" alt=""><br><span class=txtSm>Ранг: 331.1 (мудрец), 561thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.3'>Активность: 0.19<span style='color:red'>&searr;</span>0.06</span><br>Статус: <a href="action=userinfo&amp;user=20406">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 ноября 2018 15:59 <br><script type="text/javascript">QU('Vamit','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vamit" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=25433&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
добавил в тот же файл<br><br><img src="img/attach.gif" alt=""> <a href="./files/0aa3_04.11.2018_EXELAB.rU.tgz">0aa3_04.11.2018_EXELAB.rU.tgz</a> - FirstPacket.txt
<br><br><font size="1"><i>-----<br>Everything is relative...</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=388750&amp;user=20406&amp;forum_n=1&amp;topic=25433&amp;page=0&amp;anchor=9" class="addthx" data-post="388750"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]bartolomeo[/b]','')">bartolomeo</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 42.8 (посетитель), 16thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.87'>Активность: 0.02<span style='color:green'>&nearr;</span>0.06</span><br>Статус: <a href="action=userinfo&amp;user=26261">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 ноября 2018 16:24 &middot; Поправил: bartolomeo <br><script type="text/javascript">QU('bartolomeo','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=bartolomeo" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=25433&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
Это очень похоже на Диффи-Хеллмана - <noindex><a href="https://ru.wikipedia.org/wiki/Протокол_Диффи_—_Хеллмана" rel="nofollow" target="_blank">--&gt; Link &lt;--</a></noindex><br><br>Я уже както сталкивался с таким, только у меня первые пакеты были одинаковой длины - здесь же в первом пакете передаётся вместе со значением &quot;А&quot; ещё и простое число &quot;р&quot; и его первообразный корень &quot;g&quot;<br><br>В общем пока нужно выяснить числа &quot;p&quot; и &quot;g&quot; где они расположены в пакете - возможно что числа &quot;р&quot; генерируются такие что их первообразный корень один и тот же и в пакете не передаётся - поэтому предположительно число &quot;р&quot; = 64бит и число &quot;А&quot; 384бит.<br><br>возможно что устройство простые числа не генерит, а берёт из таблицы - можно попробовать наснифать побольше пакетов в надежде увидеть совпадения в первом пакете.<br><br><b>Добавлено спустя 42 минуты</b><br>чёт я перемудрил - число &quot;р&quot; 384 бит должно быть + ещё какое то число 64 бит - может быть IV ? )
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=388751&amp;user=26261&amp;forum_n=1&amp;topic=25433&amp;page=0&amp;anchor=10" class="addthx" data-post="388751"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]Vamit[/b]','')">Vamit</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/20406.jpg" alt=""><br><span class=txtSm>Ранг: 331.1 (мудрец), 561thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.3'>Активность: 0.19<span style='color:red'>&searr;</span>0.06</span><br>Статус: <a href="action=userinfo&amp;user=20406">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 ноября 2018 17:42 &middot; Поправил: Vamit <br><script type="text/javascript">QU('Vamit','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vamit" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=25433&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
&gt; чёт я перемудрил - число &quot;р&quot; 384 бит должно быть<br>наверно всё таки не 384 бита, а 384 байта, а таблица IV векторов быть в любом случае обязана, т.к. заголовок каждого пакета в сообщении содержит индекс одного из 16 векторов<br>Сама таблица должна иметь размер 16 векторов по 16 байт = 256 байт<br>Но я не могу исключать того, что таблица может и не передаваться в сообщении, а быть фиксированной на обеих сторонах.<br>&gt; ещё какое то число 64 бит - может быть IV ?<br>64 бита это 16 байт, может быть один &quot;случайный&quot; вектор IV для генерации ключа, но не из таблицы, или хеш для AES128 из которого генерится ключ, его размер также 16 байт, но это больше похоже на гадание...<br><br>Проснифал первые пакеты в 10 сеансах, глазом кроме рандомного кода отличий не видать)<br><br><b>Добавлено спустя 58 минут</b><br>Могу добавить что программа для криптографии использует библиотеку LibTomCrypt v1.17, поэтому не исключаю, что те же функции используются сервером и устройством.<br>И действительно первые два пакета очень похожи на протокол Диффи-Хеллмана, который может быть реализован на следующих функциях:<br><b>ECC Shared Secret</b><br>To construct a Diffie-Hellman shared secret with a private and public ECC key, use the following function:<br>int ecc_shared_secret(ecc_key *private_key, ecc_key *public_key, unsigned char *out, unsigned long *outlen);<br><b>ECC Diffie-Hellman Encryption</b><br>ECC--DH Encryption is performed by producing a random key, hashing it, and XOR&#039;ing the digest against the plaintext.  It is not strictly ANSI X9.63 compliant but it is very similar.  It has been extended by using an ASN.1 sequence and hash object identifiers to allow portable usage.  The following function encrypts a short string (no longer than the message digest) using this technique:<br>int ecc_encrypt_key(const unsigned char *in, unsigned long  inlen, unsigned char *out, unsigned long *outlen, prng_state *prng, int  wprng, int  hash, ecc_key *key);<br>As the name implies this function encrypts a (symmetric) key, and is not intended for encrypting long messages directly.  It will encrypt the plaintext in the array pointed to by in of length inlen octets.  It uses the public ECC key pointed to by key, and hash algorithm indexed by hash to construct a shared secret which may be XOR&#039;ed against the plaintext.  The ciphertext is stored in the output buffer pointed to by out of length outlen octets.<br>The data is encrypted to the public ECC key such that only the holder of the private key can decrypt the payload.  To have multiple recipients multiple call to this function for each public ECC key is required.<br><b>ECC-DH Decryption</b><br>This function will decrypt an encrypted payload.  The key provided must be the private key corresponding to the public key used during encryption.  If the wrong key is provided the function will not specifically return an error code.  It is important to use some form of challenge response in that case (e.g. compute a MAC of a known string).<br>int ecc_decrypt_key(const unsigned char *in, unsigned long  inlen, unsigned char *out, unsigned long *outlen, ecc_key *key);<br><br>Вот только как проверить это предположение...
<br><br><font size="1"><i>-----<br>Everything is relative...</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=388752&amp;user=20406&amp;forum_n=1&amp;topic=25433&amp;page=0&amp;anchor=11" class="addthx" data-post="388752"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]bartolomeo[/b]','')">bartolomeo</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 42.8 (посетитель), 16thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.87'>Активность: 0.02<span style='color:green'>&nearr;</span>0.06</span><br>Статус: <a href="action=userinfo&amp;user=26261">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 ноября 2018 19:36 <br><script type="text/javascript">QU('bartolomeo','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=bartolomeo" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=25433&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
Если это действительно Диффи-Хеллман - то нужно узнать простое число &quot;р&quot;, которое есть только в &quot;чёрных ящиках&quot;.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=388756&amp;user=26261&amp;forum_n=1&amp;topic=25433&amp;page=0&amp;anchor=12" class="addthx" data-post="388756"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]r_e[/b]','')">r_e</a></b><br></div>
<img src="img/s8.gif" alt=""><br><span class=txtSm>Ранг: 590.4 (<b>!</b>), 408thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.08'>Активность: 0.36<span style='color:red'>&searr;</span>0.18</span><br>Статус: <a href="action=userinfo&amp;user=11966">Модератор</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 ноября 2018 20:06 <br><script type="text/javascript">QU('r_e','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=r_e" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=25433&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
Описание схем в первом посте просто вырвимозг. Вообще непонятно кто на ком стоял.<br>Можно в виде псеводкода изобразить?
<br><br><font size="1"><i>-----<br>старый пень</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=388758&amp;user=11966&amp;forum_n=1&amp;topic=25433&amp;page=0&amp;anchor=13" class="addthx" data-post="388758"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]Vamit[/b]','')">Vamit</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/20406.jpg" alt=""><br><span class=txtSm>Ранг: 331.1 (мудрец), 561thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.3'>Активность: 0.19<span style='color:red'>&searr;</span>0.06</span><br>Статус: <a href="action=userinfo&amp;user=20406">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 ноября 2018 23:13 &middot; Поправил: Vamit <br><script type="text/javascript">QU('Vamit','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vamit" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=25433&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
<b>r_e</b> Ну думал как проще))<br>В виде исходного кода я думаю гуру будет понятней (все функи из LibTomCrypt <noindex><a href="https://opensource.apple.com/source/CommonCrypto/CommonCrypto-55010/Source/libtomcrypt/doc/libTomCryptDoc.pdf" rel="nofollow" target="_blank">--&gt; Link &lt;--</a></noindex>, её исходный код на гите <noindex><a href="https://github.com/libtom/libtomcrypt" rel="nofollow" target="_blank">--&gt; Link &lt;--</a></noindex>)<br>Программа-сервер<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>void</b></span>&nbsp;InitCryptLib<span class="hl_char">(</span><span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;ltc_mp&nbsp;<span class="hl_char">=</span>&nbsp;ltm_desc<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;определяем&nbsp;генератор&nbsp;случайных&nbsp;чисел</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;register_prng<span class="hl_char">(</span><span class="hl_char">&amp;</span>sprng_desc<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;определяем&nbsp;тип&nbsp;хеша</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;register_hash<span class="hl_char">(</span><span class="hl_char">&amp;</span>sha256_desc<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;импортируем&nbsp;openssl&nbsp;rsa&nbsp;key&nbsp;в&nbsp;rsa_key</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;rsa_import<span class="hl_char">(</span>openssl_public_rsa<span class="hl_char">,</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>openssl_public_rsa<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>rsa_public_key<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">}</li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>int</b></span>&nbsp;SendServerKey<span class="hl_char">(</span><span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;UCHAR&nbsp;localIV<span class="hl_char">[</span><span class="hl_char">]</span>&nbsp;<span class="hl_char">=</span>&nbsp;{&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;0xB<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;0x41<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">1</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span>&nbsp;}<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>m_bSendedServerKey<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;псевдо&nbsp;рандомизация<span class="hl_char">,</span>&nbsp;полученный&nbsp;вектор&nbsp;константа</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;UINT&nbsp;seed&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;Randomizing<span class="hl_char">(</span>m_vecRandomKey<span class="hl_char">.</span>begin<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;m_vecRandomKey<span class="hl_char">.</span><span class="hl_function">end</span><span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;seed<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;определяем&nbsp;шифр</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;register_cipher<span class="hl_char">(</span><span class="hl_char">&amp;</span>aes_desc<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;создаем&nbsp;symmetric&nbsp;CBC&nbsp;для&nbsp;себя</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;cbc_start<span class="hl_char">(</span>find_cipher<span class="hl_char">(</span><span class="hl_quote">&quot;aes&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;localIV&nbsp;<span class="hl_char">/</span><span class="hl_char">*</span><span class="hl_char">&amp;</span>IV<span class="hl_char">[</span>m_nIVIndex&nbsp;<span class="hl_char">&lt;</span><span class="hl_char">&lt;</span>&nbsp;<span class="hl_number">4</span><span class="hl_char">]</span><span class="hl_char">*</span><span class="hl_char">/</span><span class="hl_char">,</span>&nbsp;m_vecRandomKey<span class="hl_char">.</span><span class="hl_function">data</span><span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">16</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>m_SymCBC<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;определяем&nbsp;генератор&nbsp;случайных&nbsp;чисел</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;register_prng<span class="hl_char">(</span><span class="hl_char">&amp;</span>sprng_desc<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;определяем&nbsp;тип&nbsp;хеша</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;register_hash<span class="hl_char">(</span><span class="hl_char">&amp;</span>sha256_desc<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;UCHAR<span class="hl_char">*</span>&nbsp;<span class="hl_function"><b>out</b></span>&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function"><b>new</b></span>&nbsp;UCHAR<span class="hl_char">[</span><span class="hl_number">128</span><span class="hl_char">]</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;ULONG&nbsp;outlen&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">128</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;prng_state&nbsp;prng<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;криптуем&nbsp;импортированный&nbsp;ранее&nbsp;rsa&nbsp;ключ</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;res&nbsp;<span class="hl_char">=</span>&nbsp;rsa_encrypt_key<span class="hl_char">(</span>m_vecRandomKey<span class="hl_char">.</span><span class="hl_function">data</span><span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">16</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">out</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>outlen<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>prng<span class="hl_char">,</span>&nbsp;find_prng<span class="hl_char">(</span><span class="hl_quote">&quot;sprng&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;find_hash<span class="hl_char">(</span><span class="hl_quote">&quot;sha256&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>rsa_public_key<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;отправляем&nbsp;ключ&nbsp;на&nbsp;сервер</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;UCHAR<span class="hl_char">*</span>&nbsp;sbuf&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function"><b>new</b></span>&nbsp;UCHAR<span class="hl_char">[</span>outlen&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">2</span><span class="hl_char">]</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;memcpy<span class="hl_char">(</span><span class="hl_char">&amp;</span>sbuf<span class="hl_char">[</span><span class="hl_number">2</span><span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">out</span><span class="hl_char">,</span>&nbsp;outlen<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;sbuf<span class="hl_char">[</span><span class="hl_number">0</span><span class="hl_char">]</span>&nbsp;<span class="hl_char">=</span>&nbsp;sbuf<span class="hl_char">[</span><span class="hl_number">1</span><span class="hl_char">]</span>&nbsp;<span class="hl_char">=</span>&nbsp;0xEF<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;m_pSocket<span class="hl_char">-</span><span class="hl_char">&gt;</span>Write<span class="hl_char">(</span>sbuf<span class="hl_char">,</span>&nbsp;outlen&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">2</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">-</span></li><li class="hl_l1">}</li>        </ol>
    </div>
</div></div>
<br><br>Программа-устройство<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">vCryptor<span class="hl_char">:</span><span class="hl_char">:</span>vCryptor<span class="hl_char">(</span><span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;импортируем&nbsp;openssl&nbsp;rsa&nbsp;key&nbsp;в&nbsp;rsa_key</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;rsa_import<span class="hl_char">(</span>openssl_public_rsa<span class="hl_char">,</span>&nbsp;<span class="hl_number">609</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>m_PublicKey<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;определяем&nbsp;тип&nbsp;хеша</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;register_hash<span class="hl_char">(</span><span class="hl_char">&amp;</span>sha256_desc<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;запоминаем&nbsp;идентификатор&nbsp;хеша</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;m_nHashIdx&nbsp;<span class="hl_char">=</span>&nbsp;find_hash<span class="hl_char">(</span><span class="hl_quote">&quot;sha256&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;признак&nbsp;инициализации&nbsp;криптосистемы</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;m_bCrypt&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function"><b>false</b></span><span class="hl_comment">;</span></li><li class="hl_l0">}</li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;на&nbsp;входе&nbsp;имеем&nbsp;криптованный&nbsp;ключ<span class="hl_char">,</span>&nbsp;высланный&nbsp;устройством</li><li class="hl_l1"><span class="hl_function"><b>int</b></span>&nbsp;vCryptor<span class="hl_char">:</span><span class="hl_char">:</span>CreateSymmetricCBC<span class="hl_char">(</span><span class="hl_function">BYTE</span><span class="hl_char">*</span>&nbsp;pData<span class="hl_char">,</span>&nbsp;size_t&nbsp;nSize<span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>BYTE</b></span>&nbsp;buf<span class="hl_char">[</span><span class="hl_number">256</span><span class="hl_char">]</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;nStatus&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;ULONG&nbsp;szBuf&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">256</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;декриптуем&nbsp;ключ&nbsp;и&nbsp;на&nbsp;выходе&nbsp;получаем&nbsp;хеш&nbsp;SHA256</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>rsa_decrypt_key<span class="hl_char">(</span>pData<span class="hl_char">,</span>&nbsp;nSize<span class="hl_char">,</span>&nbsp;buf<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>szBuf<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;m_nHashIdx<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>nStatus<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>m_PublicKey<span class="hl_char">)</span>&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;CRYPT_OK<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>nStatus&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;<span class="hl_number">1</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_char">-</span><span class="hl_number">2</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;szBuf&nbsp;<span class="hl_char">=</span>&nbsp;min<span class="hl_char">(</span>szBuf<span class="hl_char">,</span>&nbsp;<span class="hl_number">256</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;memcpy<span class="hl_char">(</span>m_DeviceKey<span class="hl_char">,</span>&nbsp;buf<span class="hl_char">,</span>&nbsp;szBuf<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;определяем&nbsp;шифр</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>register_cipher<span class="hl_char">(</span><span class="hl_char">&amp;</span>aes_desc<span class="hl_char">)</span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_char">-</span><span class="hl_number">3</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;m_nIVIndex&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;создаем&nbsp;symmetric&nbsp;CBC&nbsp;для&nbsp;себя</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>cbc_start<span class="hl_char">(</span>find_cipher<span class="hl_char">(</span><span class="hl_quote">&quot;aes&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;IV<span class="hl_char">,</span>&nbsp;m_DeviceKey<span class="hl_char">,</span>&nbsp;<span class="hl_number">32</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>m_SymCBC<span class="hl_char">)</span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;CRYPT_OK<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_bCrypt&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function"><b>true</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l1">}</li>        </ol>
    </div>
</div></div><br><br><font size="1"><i>-----<br>Everything is relative...</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=388770&amp;user=20406&amp;forum_n=1&amp;topic=25433&amp;page=0&amp;anchor=14" class="addthx" data-post="388770"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]r_e[/b]','')">r_e</a></b><br></div>
<img src="img/s8.gif" alt=""><br><span class=txtSm>Ранг: 590.4 (<b>!</b>), 408thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.08'>Активность: 0.36<span style='color:red'>&searr;</span>0.18</span><br>Статус: <a href="action=userinfo&amp;user=11966">Модератор</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 ноября 2018 11:03 <br><script type="text/javascript">QU('r_e','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=r_e" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=25433&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
<b>Vamit</b><br>Из того что ты написал это не DH ни разу, а банальная передача ключа через ассиметрику.<br>Send(RSA(Random(0x10))) + предопределенный IV.<br>Ключи у тебя DER-encoded. Так что размеры что ты привел не являются корректными.<br>1. Распакуй ключи и посмотри реальную длину на предмет факторизации. (сильно сомневаюсь)<br>2. Альтернативой могла бы быть атака на генератор, но только в контролируемом окружении. sprng резолвится в один из вариантов. Соответственно, если отключить виндовый генератор будет работать базовая реализация.<br>https://android.googlesource.com/platform/external/dropbear/+/donut-release/libtomcrypt/src/prngs/rng_get_bytes.c<br><br>Что касается паддинг оракл, то он вроде проводится не на данные а на источник и в твоем случае не применим.
<br><br><font size="1"><i>-----<br>старый пень</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=388779&amp;user=11966&amp;forum_n=1&amp;topic=25433&amp;page=0&amp;anchor=15" class="addthx" data-post="388779"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]Vamit[/b]','')">Vamit</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/20406.jpg" alt=""><br><span class=txtSm>Ранг: 331.1 (мудрец), 561thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.3'>Активность: 0.19<span style='color:red'>&searr;</span>0.06</span><br>Статус: <a href="action=userinfo&amp;user=20406">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 ноября 2018 12:10 &middot; Поправил: Vamit <br><script type="text/javascript">QU('Vamit','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vamit" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=25433&amp;page=0#16');return false;">#16</a> </span><div align=left><br>
<b>r_e</b><br>Вы или не до конца прочитали или не уловили суть. Да, в приведенном исходном коде DH и не пахнет, да и не должно, т.к. тут код инициализации потоков данных программа-сервер и программа-устройство и они прекрасно работают в обе стороны.<br>Но речь идет не об этом, а о третьем потоке данных сервер-устройство, который проходит транзитом через программу и какова его реализация и на каких протоколах он построен - вот это и предстоит выяснить. А что по нему известно описано в первом посте.<br><br>&gt; Что касается паддинг оракл, то он вроде проводится не на данные а на источник и в твоем случае не применим.<br>С этим я полностью согласен
<br><br><font size="1"><i>-----<br>Everything is relative...</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=388781&amp;user=20406&amp;forum_n=1&amp;topic=25433&amp;page=0&amp;anchor=16" class="addthx" data-post="388781"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]r_e[/b]','')">r_e</a></b><br></div>
<img src="img/s8.gif" alt=""><br><span class=txtSm>Ранг: 590.4 (<b>!</b>), 408thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.08'>Активность: 0.36<span style='color:red'>&searr;</span>0.18</span><br>Статус: <a href="action=userinfo&amp;user=11966">Модератор</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 ноября 2018 14:02 <br><script type="text/javascript">QU('r_e','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=r_e" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=25433&amp;page=0#17');return false;">#17</a> </span><div align=left><br>
<b>Vamit</b><br>Да, что-то затупил. Читал по диагонали.<br>И таки да, можно сделать предположение что используется AES256.<br>Судя по ответу сервера в 384 байта можно предположить что это RSA-encrypted данные. Получается печаль печальная. Тогда для начального пакета устройства предположим что это RSA::PK (384 байта) + 64 байта могут быть еще что-то, типа AES IV.<br>Если это просто бегает транзитом и с железом ничего не сделать то шансов на успех маловато. )))
<br><br><font size="1"><i>-----<br>старый пень</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=388785&amp;user=11966&amp;forum_n=1&amp;topic=25433&amp;page=0&amp;anchor=17" class="addthx" data-post="388785"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]Vamit[/b]','')">Vamit</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/20406.jpg" alt=""><br><span class=txtSm>Ранг: 331.1 (мудрец), 561thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.3'>Активность: 0.19<span style='color:red'>&searr;</span>0.06</span><br>Статус: <a href="action=userinfo&amp;user=20406">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 ноября 2018 15:06 <br><script type="text/javascript">QU('Vamit','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vamit" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=25433&amp;page=0#18');return false;">#18</a> </span><div align=left><br>
Я всё таки думаю, что от устройства на сервер в первом пакете должна передаваться таблица векторов IV необходимая для последующего криптообмена, т.к. иметь одну таблицу во всех устройствах и на сервере как-то нелогично - устройств же в сети может быть очень много, а так вполне логично - устройство генерит рандомную таблицу и отправляет её на сервер, это 256 байт.<br>Остается ещё 192 байта. Если бы здесь отправлялся на сервер криптованный RSA хеш CBC ключа, то ответа от сервера в таком случае не нужно - можно сразу уже начинать обмен криптованными данными, да и стойкость такого протокола низка, он годится и реализован для локального обмена данными программа-устройство. Поэтому думаю что здесь передается криптованный ЕСС публичный ключ устройства для реализации DH протокола. Тогда в ответном сообщении от сервера получаем криптованный ЕСС публичный ключ сервера, но вот размер этого сообщения 384 байта велик для ECC ключа. Возможно тут ещё имеется хеш сигнатуры для проверки переданного устройством ключа, чтобы исключить возможную третью сторону в DH обмене ключами.
<br><br><font size="1"><i>-----<br>Everything is relative...</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=388788&amp;user=20406&amp;forum_n=1&amp;topic=25433&amp;page=0&amp;anchor=18" class="addthx" data-post="388788"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]r_e[/b]','')">r_e</a></b><br></div>
<img src="img/s8.gif" alt=""><br><span class=txtSm>Ранг: 590.4 (<b>!</b>), 408thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.08'>Активность: 0.36<span style='color:red'>&searr;</span>0.18</span><br>Статус: <a href="action=userinfo&amp;user=11966">Модератор</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 ноября 2018 16:06 <br><script type="text/javascript">QU('r_e','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=r_e" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=25433&amp;page=0#19');return false;">#19</a> </span><div align=left><br>
<b>Vamit</b><br>Откуда тут ECC нарисовался? Для DH он не нужен (если это не ECDH который вдруг внезапно появился). Если думать что это DH то выходит... Для AES256 тебе надо 32 байта на ключ. Тоесть DH компоненты будут тоже минимум по 32 байта. sizeof(A) + sizeof(p) = 64 байта. Еще есть g неопределенного размера. При передаче этих параметров в открытую ты бы видел структурированные данные в пакете, а ты говоришь что там выглядит как рандом начальные 448 байт.<br>p можно было бы выделить по старшему байту и тесту на простоту, например.
<br><br><font size="1"><i>-----<br>старый пень</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=388790&amp;user=11966&amp;forum_n=1&amp;topic=25433&amp;page=0&amp;anchor=19" class="addthx" data-post="388790"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="20" onfocus="this.blur()" href="JavaScript:di('[b]Vamit[/b]','')">Vamit</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/20406.jpg" alt=""><br><span class=txtSm>Ранг: 331.1 (мудрец), 561thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.3'>Активность: 0.19<span style='color:red'>&searr;</span>0.06</span><br>Статус: <a href="action=userinfo&amp;user=20406">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 ноября 2018 16:19 &middot; Поправил: Vamit <br><script type="text/javascript">QU('Vamit','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vamit" target="_blank">Личное сообщение</a> &middot;  <a href="#20" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=25433&amp;page=0#20');return false;">#20</a> </span><div align=left><br>
<b>r_e</b><br>в 11 посте на этой странице написано откуда взялся ЕСС это Elliptic curve Diffie-Hellman Encryption, т.к. в используемой разработчиками либе LibTomCrypt присутствует только эта реализация DH протокола, они эту либу юзают для криптографии и в программе и в устройстве и городить что-то другое навряд-ли будут.<br><br><b>Добавлено спустя 31 минуту</b><br>Сейчас вот тестирую этот код на подбор ключа соответствующей длины (192 байта)<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">*</span>&nbsp;<span class="hl_function"><b>test</b></span>&nbsp;encrypt_key&nbsp;<span class="hl_char">*</span><span class="hl_char">/</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DO<span class="hl_char">(</span>ecc_make_key<span class="hl_char">(</span><span class="hl_char">&amp;</span>prng<span class="hl_char">,</span>&nbsp;find_prng<span class="hl_char">(</span><span class="hl_quote">&quot;sprng&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;sizes<span class="hl_char">[</span>s<span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>usera<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">*</span>&nbsp;export&nbsp;key&nbsp;<span class="hl_char">*</span><span class="hl_char">/</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>buf<span class="hl_char">[</span><span class="hl_number">0</span><span class="hl_char">]</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DO<span class="hl_char">(</span>ecc_export<span class="hl_char">(</span>buf<span class="hl_char">[</span><span class="hl_number">0</span><span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>x<span class="hl_char">,</span>&nbsp;PK_PUBLIC<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>usera<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DO<span class="hl_char">(</span>ecc_import<span class="hl_char">(</span>buf<span class="hl_char">[</span><span class="hl_number">0</span><span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;x<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>pubKey<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>buf<span class="hl_char">[</span><span class="hl_number">0</span><span class="hl_char">]</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DO<span class="hl_char">(</span>ecc_export<span class="hl_char">(</span>buf<span class="hl_char">[</span><span class="hl_number">0</span><span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>x<span class="hl_char">,</span>&nbsp;PK_PRIVATE<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>usera<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DO<span class="hl_char">(</span>ecc_import<span class="hl_char">(</span>buf<span class="hl_char">[</span><span class="hl_number">0</span><span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;x<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>privKey<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;<span class="hl_char">(</span>x&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_comment">; x &lt; 32; x++)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf<span class="hl_char">[</span><span class="hl_number">0</span><span class="hl_char">]</span><span class="hl_char">[</span>x<span class="hl_char">]</span>&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">(</span>UCHAR<span class="hl_char">)</span>x<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>buf<span class="hl_char">[</span><span class="hl_number">1</span><span class="hl_char">]</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DO<span class="hl_char">(</span>ecc_encrypt_key<span class="hl_char">(</span>buf<span class="hl_char">[</span><span class="hl_number">0</span><span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">32</span><span class="hl_char">,</span>&nbsp;buf<span class="hl_char">[</span><span class="hl_number">1</span><span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>y<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>prng<span class="hl_char">,</span>&nbsp;find_prng<span class="hl_char">(</span><span class="hl_quote">&quot;sprng&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;find_hash<span class="hl_char">(</span><span class="hl_quote">&quot;sha256&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>pubKey<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div>
<br><br>и 192 никак не получается, макс. для ECC521 получаю 196 байт, а предыдущий ECC384 - 160 байт<br>но в нем передается также и индекс используемого хеша (это 4 байта), который в принципе серверу не нужен (юзают обе стороны SHA256 и всё), т.ч. если индекс хеша отрезать, то получим 192 байта
<br><br><font size="1"><i>-----<br>Everything is relative...</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=388791&amp;user=20406&amp;forum_n=1&amp;topic=25433&amp;page=0&amp;anchor=20" class="addthx" data-post="388791"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="21" onfocus="this.blur()" href="JavaScript:di('[b]r_e[/b]','')">r_e</a></b><br></div>
<img src="img/s8.gif" alt=""><br><span class=txtSm>Ранг: 590.4 (<b>!</b>), 408thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.08'>Активность: 0.36<span style='color:red'>&searr;</span>0.18</span><br>Статус: <a href="action=userinfo&amp;user=11966">Модератор</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 ноября 2018 18:24 <br><script type="text/javascript">QU('r_e','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=r_e" target="_blank">Личное сообщение</a> &middot;  <a href="#21" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=25433&amp;page=0#21');return false;">#21</a> </span><div align=left><br>
<b>Vamit</b><br>Обычный DH реализуется на базовых операциях powmod которая 100% присутствует в либе. Так что не стоит городить ECDH если его раньше нигде не использовалось.<br>Опять же. Если бы это был голый ECDH без крипты сверху ты бы видел передачу точек в сыром пакете. Уж их прям на глаз отличить можно.
<br><br><font size="1"><i>-----<br>старый пень</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=388798&amp;user=11966&amp;forum_n=1&amp;topic=25433&amp;page=0&amp;anchor=21" class="addthx" data-post="388798"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="22" onfocus="this.blur()" href="JavaScript:di('[b]bartolomeo[/b]','')">bartolomeo</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 42.8 (посетитель), 16thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.87'>Активность: 0.02<span style='color:green'>&nearr;</span>0.06</span><br>Статус: <a href="action=userinfo&amp;user=26261">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 ноября 2018 21:24 <br><script type="text/javascript">QU('bartolomeo','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=bartolomeo" target="_blank">Личное сообщение</a> &middot;  <a href="#22" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=25433&amp;page=0#22');return false;">#22</a> </span><div align=left><br>
также возможно что это DSA - <noindex><a href="https://en.wikipedia.org/wiki/Digital_Signature_Algorithm" rel="nofollow" target="_blank">--&gt; Link &lt;--</a></noindex><br><br>там участвуют два простых числа 3072 и 256 бит - что больше похоже на размер первого пакета.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=388804&amp;user=26261&amp;forum_n=1&amp;topic=25433&amp;page=0&amp;anchor=22" class="addthx" data-post="388804"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="23" onfocus="this.blur()" href="JavaScript:di('[b]reversecode[/b]','')">reversecode</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/15381.gif" alt=""><br><span class=txtSm>Ранг: 1053.6 <b><u>(!!!!)</u></b>, 1078thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.43'>Активность: 1.06<span style='color:red'>&searr;</span>0.81</span><br>Статус: <a href="action=userinfo&amp;user=15381">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 ноября 2018 21:28 <br><script type="text/javascript">QU('reversecode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=reversecode" target="_blank">Личное сообщение</a> &middot;  <a href="#23" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=25433&amp;page=0#23');return false;">#23</a> </span><div align=left><br>
реализуйте уже кто нибудь инструмент <br>который будет собирать базу данных статистики распределения каких то известных данных<br>и на основе введеных пользователем данных можно будет получать гипотезу о возможной природе данных <br>на основе базы знаний известных данных<br><img src="img/smilies/s5.gif" alt=""><br>это хоть будет иметь какой то математический аппарат<br>а то что вы делаете называется угадыванием с вероятностью 0
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=388805&amp;user=15381&amp;forum_n=1&amp;topic=25433&amp;page=0&amp;anchor=23" class="addthx" data-post="388805"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="24" onfocus="this.blur()" href="JavaScript:di('[b]Vamit[/b]','')">Vamit</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/20406.jpg" alt=""><br><span class=txtSm>Ранг: 331.1 (мудрец), 561thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.3'>Активность: 0.19<span style='color:red'>&searr;</span>0.06</span><br>Статус: <a href="action=userinfo&amp;user=20406">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 ноября 2018 21:57 &middot; Поправил: Vamit <br><script type="text/javascript">QU('Vamit','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vamit" target="_blank">Личное сообщение</a> &middot;  <a href="#24" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=25433&amp;page=0#24');return false;">#24</a> </span><div align=left><br>
<i class=x><b>Если бы это был голый ECDH без крипты сверху ты бы видел передачу точек в сыром пакете</b></i><br>Согласен, на там глазом ничего не видать, так что это что-то криптованное.<br>Даже при передаче криптованного ЕСС ключа я глазом вижу структуру информации под криптом, да тут и криптом-то это назвать нельзя DER encoding 3х параметров: IOD хеша, рандомизированный публичный ключ  и хешированный ключ, первая часть в отличие от остальных легко распознается глазом.<br><i class=x><b>также возможно что это DSA</b></i><br>Возможно много чего может быть, но поясни, зачем тут DSA, он используется или для цифровой подписи или для асимметричного шифрования, ответа на сообщение с ним не требуется, можно сразу начинать криптообмен данными.<br>Первоначально я хочу послать на сервер что-то свое вместо старого пакета от устройства, но это что-то должно быть произведено библиотекой LibTomCrypt, и посмотреть на реакцию сервера. Главное тут подобрать криптоданные совпадающие по размеру с этим пакетом и подходящие под логику обмена, а далее уже можно пробовать.<br><i class=x><b>а то что вы делаете называется угадыванием с вероятностью 0</b></i><br>Не 0, а повыше будет))
<br><br><font size="1"><i>-----<br>Everything is relative...</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=388810&amp;user=20406&amp;forum_n=1&amp;topic=25433&amp;page=0&amp;anchor=24" class="addthx" data-post="388810"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="25" onfocus="this.blur()" href="JavaScript:di('[b]reversecode[/b]','')">reversecode</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/15381.gif" alt=""><br><span class=txtSm>Ранг: 1053.6 <b><u>(!!!!)</u></b>, 1078thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.43'>Активность: 1.06<span style='color:red'>&searr;</span>0.81</span><br>Статус: <a href="action=userinfo&amp;user=15381">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 ноября 2018 22:02 <br><script type="text/javascript">QU('reversecode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=reversecode" target="_blank">Личное сообщение</a> &middot;  <a href="#25" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=25433&amp;page=0#25');return false;">#25</a> </span><div align=left><br>
если протокол ТСП то в начале должно быть длинна данных<br>и машинку посредине и заставить пофрагментировать пакет и посмотреть что будет с обменом
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=388811&amp;user=15381&amp;forum_n=1&amp;topic=25433&amp;page=0&amp;anchor=25" class="addthx" data-post="388811"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="26" onfocus="this.blur()" href="JavaScript:di('[b]Vamit[/b]','')">Vamit</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/20406.jpg" alt=""><br><span class=txtSm>Ранг: 331.1 (мудрец), 561thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.3'>Активность: 0.19<span style='color:red'>&searr;</span>0.06</span><br>Статус: <a href="action=userinfo&amp;user=20406">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 ноября 2018 22:16 &middot; Поправил: Vamit <br><script type="text/javascript">QU('Vamit','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vamit" target="_blank">Личное сообщение</a> &middot;  <a href="#26" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=25433&amp;page=0#26');return false;">#26</a> </span><div align=left><br>
<b>reversecode</b><br>нет тут никакого ТСП, устройство само не может установить связь с сервером, установку связи делает только программа, а устройство общается уже по установленному каналу данных. Без программы сервер ничего не знает об устройстве и наоборот, и сами по себе даже при установленном соединении они ничего друг другу не передают, инициатором их обмена всегда выступает человек выполнив тот или иной запрос.<br>Пользователь давит кнопку, программа посылает команду в устройство, устройство шлет транзитом через программу пакет на сервер и ответ от него так же транзитом уходит в устройство. Пакетов между ними в пределах одной сессии может быть от 5 штук до нескольких сотен - всё зависит от выбранной функции.<br>Программа в транзите осуществляет только перепаковку пакетов без изменения данных (с сервера приходит длинный пакет, который отправляется в устройство несколькими короткими и наоборот)
<br><br><font size="1"><i>-----<br>Everything is relative...</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=388812&amp;user=20406&amp;forum_n=1&amp;topic=25433&amp;page=0&amp;anchor=26" class="addthx" data-post="388812"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="27" onfocus="this.blur()" href="JavaScript:di('[b]reversecode[/b]','')">reversecode</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/15381.gif" alt=""><br><span class=txtSm>Ранг: 1053.6 <b><u>(!!!!)</u></b>, 1078thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.43'>Активность: 1.06<span style='color:red'>&searr;</span>0.81</span><br>Статус: <a href="action=userinfo&amp;user=15381">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 ноября 2018 22:30 <br><script type="text/javascript">QU('reversecode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=reversecode" target="_blank">Личное сообщение</a> &middot;  <a href="#27" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=25433&amp;page=0#27');return false;">#27</a> </span><div align=left><br>
отправить китайцам пусть прошивку снимут
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=388813&amp;user=15381&amp;forum_n=1&amp;topic=25433&amp;page=0&amp;anchor=27" class="addthx" data-post="388813"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="28" onfocus="this.blur()" href="JavaScript:di('[b]f13nd[/b]','')">f13nd</a></b><br></div>
<img src="img/s6.gif" alt=""><br><img style="padding-top:3px;" src="av/8075.png" alt=""><br><span class=txtSm>Ранг: 271.2 (наставник), 331thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.63'>Активность: 0.32<span style='color:green'>&nearr;</span>1.49</span><br>Статус: <a href="action=userinfo&amp;user=8075">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 ноября 2018 23:04 <br><script type="text/javascript">QU('f13nd','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=f13nd" target="_blank">Личное сообщение</a> &middot;  <a href="#28" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=25433&amp;page=0#28');return false;">#28</a> </span><div align=left><br>
<I>Vamit пишет:<br>Мне также неизвестно где начинаются криптованные данные, хоть первый пакет от устройства в сервер и содержит уникальную часть 448 байт, но я не представляю что там может быть, но это не данные, т.к. на этот пакет я всегда получаю ответ от сервера. </I><br><I>Vamit пишет:<br>Причем, посылая каждый раз на сервер один и тот же первый пакет, всегда получаю от него уникальный ответ, отличный от предыдущего. </I><br>Разница скорей всего из-за соли. Очень похоже на то, что там под RSA ключик для симметричного алгоритма, так оно часто и делается. Потому что RSA совершенен, но слишком прожорлив, его гибридят с симметричными алгоритмами. На месте разработчиков я бы так и сделал. Не имея даже открытых ключей (программа в шифровании-расшифровке этого обмена не участвует), я думаю тут совсем нечего ловить. 448 не кратно 128 и 256, это может быть RSA-512, но это ничем скорей всего не поможет.
<br><br><font size="1"><i>-----<br>2 оттенка серого</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=388816&amp;user=8075&amp;forum_n=1&amp;topic=25433&amp;page=0&amp;anchor=28" class="addthx" data-post="388816"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="29" onfocus="this.blur()" href="JavaScript:di('[b]Vamit[/b]','')">Vamit</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/20406.jpg" alt=""><br><span class=txtSm>Ранг: 331.1 (мудрец), 561thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.3'>Активность: 0.19<span style='color:red'>&searr;</span>0.06</span><br>Статус: <a href="action=userinfo&amp;user=20406">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 ноября 2018 23:11 <br><script type="text/javascript">QU('Vamit','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vamit" target="_blank">Личное сообщение</a> &middot;  <a href="#29" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=25433&amp;page=0#29');return false;">#29</a> </span><div align=left><br>
<i class=x><b>отправить китайцам пусть прошивку снимут</b></i><br>Не могут, уже узнавали, ни наши ни китайцы пока ещё не научились ARM Cortex контроллеры вскрывать<br><br><b>Добавлено спустя 8 минут</b><br><i class=x><b>Очень похоже на то, что там под RSA ключик для симметричного алгоритма</b></i><br>Не соглашусь с этим, если бы это было так и я получаю от сервера ответ на первый старый пакет, то он бы с таким же успехом принял бы и ответил на второй старый пакет и на все последующие.
<br><br><font size="1"><i>-----<br>Everything is relative...</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=388817&amp;user=20406&amp;forum_n=1&amp;topic=25433&amp;page=0&amp;anchor=29" class="addthx" data-post="388817"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="30" onfocus="this.blur()" href="JavaScript:di('[b]f13nd[/b]','')">f13nd</a></b><br></div>
<img src="img/s6.gif" alt=""><br><img style="padding-top:3px;" src="av/8075.png" alt=""><br><span class=txtSm>Ранг: 271.2 (наставник), 331thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.63'>Активность: 0.32<span style='color:green'>&nearr;</span>1.49</span><br>Статус: <a href="action=userinfo&amp;user=8075">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 ноября 2018 23:27 <br><script type="text/javascript">QU('f13nd','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=f13nd" target="_blank">Личное сообщение</a> &middot;  <a href="#30" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=25433&amp;page=0#30');return false;">#30</a> </span><div align=left><br>
<I>Vamit пишет:<br>Не соглашусь с этим, если бы это было так и я получаю от сервера ответ на первый старый пакет, то он бы с таким же успехом принял бы и ответил на второй старый пакет и на все последующие. </I><br>Ответ от сервера (512/8)*6 байт и каждый раз разный, то есть солёный. В нем может быть второй ключ к симметричному алгоритму под RSA и он может использоваться для шифрования обмена устройство-&gt;сервер. Тогда второй старый запрос от устройства сервер не примет.
<br><br><font size="1"><i>-----<br>2 оттенка серого</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=388819&amp;user=8075&amp;forum_n=1&amp;topic=25433&amp;page=0&amp;anchor=30" class="addthx" data-post="388819"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> .  <b>1</b> . <a href="action=vthread&amp;forum=1&amp;topic=25433&amp;page=1.html">2</a> . <a href="action=vthread&amp;forum=1&amp;topic=25433&amp;page=1.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/green.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=1&sortBy=0&page=0.html"><b>Основной форум</b></a> <b class=bulletHead>&#8212;&#8250;</b> Взлом криптографии при обмене данных с устройством</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#31" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="1">
<input type="hidden" name="topic" value="25433">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=25433" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
