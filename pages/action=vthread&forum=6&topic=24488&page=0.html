<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>code vs data. - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Здрасти. Задача отличить код от данных. Тоесть имеем указатель на массив, нужно аналитически узнать что это код. Хотелось бы посмотреть что уже сделано. Когда то давно была попытка реализовать, толи deroco, толи есчо кто, не могу">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b> (+6 невидимых)</b></span>
</td>
</tr>
</table>

 

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> code vs data.</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> .  <b>1</b> . <a href="action=vthread&amp;forum=6&amp;topic=24488&amp;page=1.html">2</a> . <a href="action=vthread&amp;forum=6&amp;topic=24488&amp;page=2.html">3</a> . <a href="action=vthread&amp;forum=6&amp;topic=24488&amp;page=1.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 338.5 (мудрец), 349thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 декабря 2016 10:22 &middot; Поправил: difexacaw <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24488&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Здрасти.<br><br>Задача отличить код от данных. Тоесть имеем указатель на массив, нужно аналитически узнать что это код. Хотелось бы посмотреть что уже сделано. Когда то давно была попытка реализовать, толи deroco, толи есчо кто, не могу найти. Анализер иды не годится, он слишком толст и не профайл, а самое главное не умеет разбирать наверно дампы вне пе.
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=370299&amp;user=40990&amp;forum_n=6&amp;topic=24488&amp;page=0&amp;anchor=1" class="addthx" data-post="370299"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]r_e[/b]','')">r_e</a></b><br></div>
<img src="img/s8.gif" alt=""><br><span class=txtSm>Ранг: 590.6 (<b>!</b>), 408thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.08'>Активность: 0.36<span style='color:red'>&searr;</span>0.18</span><br>Статус: <a href="action=userinfo&amp;user=11966">Модератор</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 декабря 2016 10:26 <br><script type="text/javascript">QU('r_e','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=r_e" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24488&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
Банально частотный анализ, если массив достаточно большой.<br>Можно дизасмом пробежаться на предмет валидности.<br>Матчинг типовых блоков, типа push ebp;mov ebp, esp...
<br><br><font size="1"><i>-----<br>старый пень</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=370300&amp;user=11966&amp;forum_n=6&amp;topic=24488&amp;page=0&amp;anchor=2" class="addthx" data-post="370300"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 338.5 (мудрец), 349thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 декабря 2016 10:30 <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24488&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
<b>r_e</b><br><br>Вариантов слишком много, вот хотелось бы посмотреть уже собранные в одном месте <img src="img/smilies/s1.gif" alt="">
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=370301&amp;user=40990&amp;forum_n=6&amp;topic=24488&amp;page=0&amp;anchor=3" class="addthx" data-post="370301"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]black7[/b]','')">black7</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 2.5 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.2'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=34740">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 декабря 2016 22:33 <br><script type="text/javascript">QU('black7','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=black7" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24488&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
Если точка входа = начало массива, то дизасмом пройтись с анализом jcc адресов.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=370323&amp;user=34740&amp;forum_n=6&amp;topic=24488&amp;page=0&amp;anchor=4" class="addthx" data-post="370323"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]VodoleY[/b]','')">VodoleY</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 488.1 (мудрец), 272thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.01'>Активность: 0.35<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=17319">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 декабря 2016 23:26 &middot; Поправил: VodoleY <br><script type="text/javascript">QU('VodoleY','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=VodoleY" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24488&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
<b>black7</b> отлично.. call eax<br>есть такой подход.. я себе делал.. wallker назвал. гуляет по коду.. ток разрезелвить относительные ссылки при этом нельзя.. <br>ТС как бы тут не надоел.. но ставит немногу другую задачу.. анализ сырых данных. в статике увы не все сделать можно.. есть 3 варианта анализа.. статический.. статико динамический.. и выполнение кода в песочнице.. как пример.. но все они не дают 100 проц результата
<br><br><font size="1"><i>-----<br>Наша работа во тьме, Мы делаем, что умеем. Мы отдаем, что имеем, Наша работа во тьме....</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=370325&amp;user=17319&amp;forum_n=6&amp;topic=24488&amp;page=0&amp;anchor=5" class="addthx" data-post="370325"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 338.5 (мудрец), 349thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 24 декабря 2016 00:45 <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24488&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
<b>VodoleY</b><br><br>&gt; все они не дают 100 проц результата <br><br>Почему же, можно выделить критерии, которые однозначно определят что данные это данные, например повторение ветвлений с одинаковым условием или адресация 8/32 с одним и тем же регистром(eg add [eax],al) etc. Не говоря уже про запрещённые/невалид инструкции, префикс лока и др. Если код в пе, то наличие релоков существенно упрощает задачу.<br><br><b>black7</b><br><br>Это самая базовая проверка - не пересечение инструкций.
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=370329&amp;user=40990&amp;forum_n=6&amp;topic=24488&amp;page=0&amp;anchor=6" class="addthx" data-post="370329"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]black7[/b]','')">black7</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 2.5 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.2'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=34740">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 24 декабря 2016 02:16 <br><script type="text/javascript">QU('black7','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=black7" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24488&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
<I>VodoleY пишет:<br>отлично.. call eax </I><br>Я же не говорю про полное покрытие. call eax вообще лесом, EIP +2 и далее. Если трасса получается более менее, то можно посчитать еще энтропию и сделать выводы.<br>Вообще от задачи зависит. Если на входе вообще непонятно что, и не известно, что это может быть, то тут нужна мощная эвристика с сочетанием кучи методов...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=370336&amp;user=34740&amp;forum_n=6&amp;topic=24488&amp;page=0&amp;anchor=7" class="addthx" data-post="370336"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 338.5 (мудрец), 349thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 24 декабря 2016 02:19 <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24488&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
<b>black7</b><br><br>В том и задача. В принципе фундаментальный шаблон я запилил(анализер), но это ничего не решает. Опять же хотелось бы глянуть что реализовано.<br><br><b>Добавлено спустя 3 часа 2 минуты</b><br>Собрал тестовый семпл, фактически шаблон(ядро анализера).<br><br>При тестах на 8-ке при покрытии 80к инструкций фейлов нет. Для начала сделал с релоками. Сюда нужно будет прикрутить табличные проверки на инвалид инструкции и пр. Очень быстрый анализер.<br><br><noindex><a href="https://yadi.sk/d/lCnXbFcV34ekVx" rel="nofollow" target="_blank">--&gt; Link &lt;--</a></noindex> vx
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=370337&amp;user=40990&amp;forum_n=6&amp;topic=24488&amp;page=0&amp;anchor=8" class="addthx" data-post="370337"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]black7[/b]','')">black7</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 2.5 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.2'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=34740">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 24 декабря 2016 16:32 <br><script type="text/javascript">QU('black7','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=black7" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24488&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
<b>difexacaw</b> Ого, Indy, я тебя даже не узнал! Ты научился разговаривать как человек!<br>Думаю, еще лет 5 и ты научишься не создавать тем с вопросами, только чтобы выложить свои исходники на масме.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=370357&amp;user=34740&amp;forum_n=6&amp;topic=24488&amp;page=0&amp;anchor=9" class="addthx" data-post="370357"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=2784" title="25-04-2019 14:06, ранг:0.0" target="_blank">xdf</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 338.5 (мудрец), 349thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 декабря 2016 01:12 <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24488&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
<b>black7</b><br><br>Что это значит ?<br><br>Вопрос открыт, а что выложено - это шаблон и способ тестирования. Эта не простая тема и нужно на что то опираться, как то тестить.<br><br><b>black7</b><br><br>&gt; Если на входе вообще непонятно что<br><br>Исходная задача приводящая к данной - в динамике отделяется код от данных, при передаче управления, это событие детектится. Приложение взято под своего рода трассировку/супервизор. Событие передачи управления на не определённый адрес(код/данные?) имеет огромный тайминг. После этого события оно никогда не наступит, так как адрес помечен содержащий код и иначе обрабатывается - при обнаружении ссылки на него она изменяется. Но это нельзя сделать при инициализации, когда ссылка куда то загружается и используется далее из вне. Для этого необходимо определить что по ссылке код.
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=370369&amp;user=40990&amp;forum_n=6&amp;topic=24488&amp;page=0&amp;anchor=10" class="addthx" data-post="370369"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]rmn[/b]','')">rmn</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 158.4 (ветеран), 123thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.28'>Активность: 0.14<span style='color:green'>&nearr;</span>0.49</span><br>Статус: <a href="action=userinfo&amp;user=1533">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 декабря 2016 02:08 <br><script type="text/javascript">QU('rmn','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=rmn" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24488&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
<b>difexacaw</b><br>Обычно в программах управление на данные не передается. Имеется передача управления? Там код. <img src="img/smilies/s1.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=370371&amp;user=1533&amp;forum_n=6&amp;topic=24488&amp;page=0&amp;anchor=11" class="addthx" data-post="370371"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 338.5 (мудрец), 349thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 декабря 2016 02:22 <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24488&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
<b>rmn</b><br><br>Есть массив векторов, в частности фиксапов(релоков). Их нужно разделить на данные/код. Это нужно сделать до начала выполнения.<br><br><b>Добавлено спустя 1 час 36 минут</b><br>Пока я выделил базовые критерии, позволяющие определить что код не является кодом. Видимо необходимо два таких типа использовать, вероятность: +- код. Так в общем случае однозначно определить код можно только не приемлемым путём - выполнив высокоуровневый анализ, декомпиляция и символьное исполнение(выделить алгос, трек графа данных etc) и прочие не пригодные вещи.<br><br>Проще выделить элементарные критерии, по которым однозначно можно определить что это не код. Пока я выделил следующие группы:<br><br>A. Релоки. Релок может быть только на Disp32 или Imm32.<br><br>B. ModRM:<br><br>Невалид адресация в случае отсутствия комплексной базы в ModRM. Это условия:<br><br>1. !Base или Base = Index. Тогда если нет смещения, то адресация невалид. Иначе выборка из урезанного сегмента(Fs на NT с лимитом 4K).<br><br>2. Адресация ниже стека:<br><br>[esp + SIB -N] -&gt; валид только если есть индекс и scale = 1.<br><br>C. Операнд является частью базового регистра: add [eax],al это nothing конструкции.<br><br>Необходимо использовать причинно следственные зависимости, так например флажки и регистры, к примеру после обнуления флага не может следовать его проверка, eg: xor r,r/jz. Но подобный анализ требует соответствующих ресурсов - дизасм должен возвращать эту инфу.
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=370372&amp;user=40990&amp;forum_n=6&amp;topic=24488&amp;page=0&amp;anchor=12" class="addthx" data-post="370372"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]ajax[/b]','')">ajax</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/8830.gif" alt=""><br><span class=txtSm>Ранг: 337.6 (мудрец), 224thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.53'>Активность: 0.21<span style='color:red'>&searr;</span>0.1</span><br>Статус: <a href="action=userinfo&amp;user=8830">Участник</a><br><font color=blue>born to be evil</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 декабря 2016 22:20 &middot; Поправил: ajax <br><script type="text/javascript">QU('ajax','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ajax" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24488&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
да, по релокам сканить на валидность инструкции -1-2-3... от оффсета. если пара-тройка таких фиксапов - явно код. если нет релоков - все сложнее<br><br>ps: masm32 убивает. это звездец.
<br><br><font size="1"><i>-----<br>От многой мудрости много скорби, и умножающий знание умножает печаль</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=370400&amp;user=8830&amp;forum_n=6&amp;topic=24488&amp;page=0&amp;anchor=13" class="addthx" data-post="370400"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 338.5 (мудрец), 349thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 декабря 2016 02:35 &middot; Поправил: difexacaw <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24488&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
<b>ajax</b><br><br>Для релоков возможны два варианта:<br><br>1. Фиксап на Disp32 в MRM.<br>2. Фиксап на Imm32. Imm32 всегда расположен за Disp32. Тоесть возможны макс два фиксапа для одной инструкции.<br><br>Любой иной случай(фиксап пересекает иструкцию) - невалид.<br><br>&gt; ps: masm32 убивает. это звездец. <br><br>Что именно, названия регистров ?
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=370409&amp;user=40990&amp;forum_n=6&amp;topic=24488&amp;page=0&amp;anchor=14" class="addthx" data-post="370409"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]Nightshade[/b]','')">Nightshade</a></b><br></div>
<img src="img/s6.gif" alt=""><br><img style="padding-top:3px;" src="av/4618.gif" alt=""><br><span class=txtSm>Ранг: 241.9 (наставник), 107thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.19'>Активность: 0.14<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=4618">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 декабря 2016 10:49 <br><script type="text/javascript">QU('Nightshade','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Nightshade" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24488&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
<b>xor r,r/jz</b> такого мусора полно в коде после обфускаторов.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=370416&amp;user=4618&amp;forum_n=6&amp;topic=24488&amp;page=0&amp;anchor=15" class="addthx" data-post="370416"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]Vamit[/b]','')">Vamit</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/20406.jpg" alt=""><br><span class=txtSm>Ранг: 331.1 (мудрец), 561thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.3'>Активность: 0.19<span style='color:red'>&searr;</span>0.06</span><br>Статус: <a href="action=userinfo&amp;user=20406">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 декабря 2016 11:47 <br><script type="text/javascript">QU('Vamit','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vamit" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24488&amp;page=0#16');return false;">#16</a> </span><div align=left><br>
<I>difexacaw пишет:<br>Анализер иды не годится, он слишком толст и не профайл, а самое главное не умеет разбирать наверно дампы вне пе. </I><br>А вы пробовали? Все он умеет разбирать, если правильно настроить. <br>Всё что вы тут пишите это только вероятностная оценка код-данные, 100% результат это никогда не даст. Его можно получить только в реалии, учитывая не только сам код, но и среду его создания и исполнения.<br>Даже Ида не дает 100% результат, как простой пример - таблицы виртуальных функций. А при наличии обфускаторов и вм разделение код-данные стирается практически полностью и разобраться в этой каше сможет только декомпилятор, учитывающий особенности конкретной вм.<br>Поэтому определитесь сначала с конкретной задачей - что, для чего и зачем. Только в этом случае можно создать что-то стоящее в анализе, иначе повторение велосипеда без достижения приемлемого результата.
<br><br><font size="1"><i>-----<br>Everything is relative...</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=370417&amp;user=20406&amp;forum_n=6&amp;topic=24488&amp;page=0&amp;anchor=16" class="addthx" data-post="370417"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 338.5 (мудрец), 349thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 декабря 2016 12:22 &middot; Поправил: difexacaw <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24488&amp;page=0#17');return false;">#17</a> </span><div align=left><br>
<b>Vamit</b><br><br>&gt; разделение код-данные стирается практически полностью и разобраться в этой каше сможет только декомпилятор, учитывающий особенности конкретной вм.<br><br>Только один сложный случай есть, это когда данные перемешаны с кодом, так например включение данных и загрузка ссылки на них через call/db. В иных любых случаях положение инструкций в блоке значения не имеет, они выделяются в графе, данные расположенные между блоками кода не мешают.<br><br>&gt; Всё что вы тут пишите это только вероятностная оценка код-данные, 100% результат это никогда не даст.<br><br>Почему же вероятностная. К примеру обнаружение пересечения инструкций однозначно говорит что это не код. И прочие многие критерии, например описанные в #12. Такие конструкции не могут быть использованы.
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=370418&amp;user=40990&amp;forum_n=6&amp;topic=24488&amp;page=0&amp;anchor=17" class="addthx" data-post="370418"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]8-9-13-80[/b]','')">8-9-13-80</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 2.8 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 1.53'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=47500">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 06 января 2019 22:32 <br><script type="text/javascript">QU('8-9-13-80','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=8-9-13-80" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24488&amp;page=0#18');return false;">#18</a> </span><div align=left><br>
<b>difexacaw</b> по итогу то, какое решение? Какие стратегии решения хороши, какие плохи, чем?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=390404&amp;user=47500&amp;forum_n=6&amp;topic=24488&amp;page=0&amp;anchor=18" class="addthx" data-post="390404"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]ntldr[/b]','')">ntldr</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 369.8 (мудрец), 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.89'>Активность: 0.39<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=12867">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 06 января 2019 23:20 &middot; Поправил: ntldr <br><script type="text/javascript">QU('ntldr','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ntldr" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24488&amp;page=0#19');return false;">#19</a> </span><div align=left><br>
В статике в общем случае - задача не решаема. Код может быть одновременно и данными для другого кода <img src="img/smilies/s1.gif" alt=""> А после отделения кода от данных у вас возникнет задача отделить данные от данных (определить границы массивов, структур, переменных). Это ещё большая жопа.<br><br>Единственное более-менее полноценное решение - информация от компилятора. Компилируем с  ключом /Gy, компилятор кладёт каждую функцию и каждый элемент данных (массив, переменную, структуру, итд) в отдельную секцию COFF объектного файла. COFF&#039;ы элементарно дизассемблируются и превращаются в полный граф программы, описывающий все взаимосвязи кода и данных. С таким описанием легко творить всё что вздумается.<br><br>Работая с чужим кодом - исходим от того что у нас на входе и какая задача решается. Разобрать в статике возможно не всё, да и обычно не нужно. В динамике - любой извратный код можно корректно дизассемблировать и рекомпилировать. Там логика простая: что исполняется в данный момент / исполнялось раньше - то и есть код. Остальное - данные.
<br><br><font size="1"><i>-----<br>PGP key <noindex><a href="https://diskcryptor.net/storage/new_key.asc" rel="nofollow" target="_blank">&lt0x1B6A24550F33E44A&gt</a></noindex></i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=390405&amp;user=12867&amp;forum_n=6&amp;topic=24488&amp;page=0&amp;anchor=19" class="addthx" data-post="390405"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=40990" title="07-01-2019 04:23, ранг:258.7" target="_blank">difexacaw</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="20" onfocus="this.blur()" href="JavaScript:di('[b]f13nd[/b]','')">f13nd</a></b><br></div>
<img src="img/s6.gif" alt=""><br><img style="padding-top:3px;" src="av/8075.png" alt=""><br><span class=txtSm>Ранг: 271.4 (наставник), 331thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.63'>Активность: 0.32<span style='color:green'>&nearr;</span>1.49</span><br>Статус: <a href="action=userinfo&amp;user=8075">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 06 января 2019 23:31 <br><script type="text/javascript">QU('f13nd','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=f13nd" target="_blank">Личное сообщение</a> &middot;  <a href="#20" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24488&amp;page=0#20');return false;">#20</a> </span><div align=left><br>
<I>ntldr пишет:<br>В статике в общем случае - задача не решаема.</I><br>Решаема, если эта задача не умозрительная. Причем технически довольно несложно, можно даже скриптом для иды оформить, заменив слабоватые встроенные средства анализа. Если от точки входа до безусловного перехода/ретёрна нету несуществующих/привилегированных инструкций, обращений по запрещенным адресам памяти и прочей дичи, данные можно считать кодом. Если не ставить целью сотворить неебесное чудо, которое переварит что угодно, в том числе как угодно обфусцированное и на любую архитектуру.
<br><br><font size="1"><i>-----<br>2 оттенка серого</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=390406&amp;user=8075&amp;forum_n=6&amp;topic=24488&amp;page=0&amp;anchor=20" class="addthx" data-post="390406"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="21" onfocus="this.blur()" href="JavaScript:di('[b]ntldr[/b]','')">ntldr</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 369.8 (мудрец), 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.89'>Активность: 0.39<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=12867">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 06 января 2019 23:38 &middot; Поправил: ntldr <br><script type="text/javascript">QU('ntldr','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ntldr" target="_blank">Личное сообщение</a> &middot;  <a href="#21" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24488&amp;page=0#21');return false;">#21</a> </span><div align=left><br>
<I>f13nd пишет:<br>Если не ставить целью сотворить неебесное чудо, которое переварит что угодно, в том числе как угодно обфусцированное и на любую архитектуру.  </I><br>Такое чудо как раз не сильно сложно сотворить. Просто переваривать будет по кусочкам и налету. До изобретения аппаратной виртуализации, виртуальные машины именно так работали.<br><br><b>Добавлено спустя 11 минут</b><br><I>f13nd пишет:<br>Если от точки входа до безусловного перехода/ретёрна нету несуществующих/привилегированных инструкций, обращений по запрещенным адресам памяти и прочей дичи, данные можно считать кодом. </I><br>А теперь представь что твой блок кода закончился на что-то вроде jmp [jump_table + esi*4]. Вот и начались первые сложности, откуда дизасмить дальше и как узнать размер таблицы. Таблицы могут связывать мелкие фрагменты кода (GCC любит таблицы переходов). Попробуй собери из этой каши всю функцию нигде не накосячив. Предположим что даже релоков нет и таблицы переходов (которые являются данными) идут с фрагментами кода вперемешку.<br><br>IDA такое сама до конца не раскручивает, приходится вручную расставлять код/данные. Совсем другое дело когда разбираем COFFы со всеми символами...
<br><br><font size="1"><i>-----<br>PGP key <noindex><a href="https://diskcryptor.net/storage/new_key.asc" rel="nofollow" target="_blank">&lt0x1B6A24550F33E44A&gt</a></noindex></i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=390407&amp;user=12867&amp;forum_n=6&amp;topic=24488&amp;page=0&amp;anchor=21" class="addthx" data-post="390407"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="22" onfocus="this.blur()" href="JavaScript:di('[b]f13nd[/b]','')">f13nd</a></b><br></div>
<img src="img/s6.gif" alt=""><br><img style="padding-top:3px;" src="av/8075.png" alt=""><br><span class=txtSm>Ранг: 271.4 (наставник), 331thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.63'>Активность: 0.32<span style='color:green'>&nearr;</span>1.49</span><br>Статус: <a href="action=userinfo&amp;user=8075">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 06 января 2019 23:55 <br><script type="text/javascript">QU('f13nd','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=f13nd" target="_blank">Личное сообщение</a> &middot;  <a href="#22" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24488&amp;page=0#22');return false;">#22</a> </span><div align=left><br>
<I>ntldr пишет:<br>А теперь представь что твой блок кода закончился на что-то вроде jmp [jump_table + esi*4]. </I><br>Я не жадный, мне достаточно десятка валидных инструкций. Вероятность того, что какие-то данные случайно сложатся во что-то правдоподобно напоминающее код, невелика.
<br><br><font size="1"><i>-----<br>2 оттенка серого</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=390409&amp;user=8075&amp;forum_n=6&amp;topic=24488&amp;page=0&amp;anchor=22" class="addthx" data-post="390409"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="23" onfocus="this.blur()" href="JavaScript:di('[b]ntldr[/b]','')">ntldr</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 369.8 (мудрец), 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.89'>Активность: 0.39<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=12867">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 января 2019 00:03 &middot; Поправил: ntldr <br><script type="text/javascript">QU('ntldr','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ntldr" target="_blank">Личное сообщение</a> &middot;  <a href="#23" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24488&amp;page=0#23');return false;">#23</a> </span><div align=left><br>
X64 код (применительно к отделению его от данных) ещё не радует своей дефолтовой базонезависимостью. В x86 на mov, eax, [variable] будет стоять релок внутри опкода, в x64 релоки остались только там где данные ссылаются на что-то. Меньше инфорации для анализа.<br><br>В x86 так удобно было ходить наоборот, от данных к ссылающемуся на них коду, через релоки.
<br><br><font size="1"><i>-----<br>PGP key <noindex><a href="https://diskcryptor.net/storage/new_key.asc" rel="nofollow" target="_blank">&lt0x1B6A24550F33E44A&gt</a></noindex></i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=390410&amp;user=12867&amp;forum_n=6&amp;topic=24488&amp;page=0&amp;anchor=23" class="addthx" data-post="390410"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="24" onfocus="this.blur()" href="JavaScript:di('[b]ClockMan[/b]','')">ClockMan</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/17432.jpg" alt=""><br><span class=txtSm>Ранг: 568.2 (<b>!</b>), 465thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.99'>Активность: 0.55<span style='color:green'>&nearr;</span>0.57</span><br>Статус: <a href="action=userinfo&amp;user=17432">Участник</a><br><font color=blue>оптимист</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 января 2019 02:43 <br><script type="text/javascript">QU('ClockMan','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ClockMan" target="_blank">Личное сообщение</a> &middot;  <a href="#24" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24488&amp;page=0#24');return false;">#24</a> </span><div align=left><br>
<b>difexacaw</b>Опять вы схватились за кактус голыми руками, если файл стандартный то решение найти просто, а если это полиморф встроенный в фотку голой саши грей то только ручки и голова, либо разработайте нейросеть обучающийся)))
<br><br><font size="1"><i>-----<br>Чтобы правильно задать вопрос, нужно знать большую часть  ответа. Р.Шекли.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=390421&amp;user=17432&amp;forum_n=6&amp;topic=24488&amp;page=0&amp;anchor=24" class="addthx" data-post="390421"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="25" onfocus="this.blur()" href="JavaScript:di('[b]Gideon Vi[/b]','')">Gideon Vi</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/2585.jpg" alt=""><br><span class=txtSm>Ранг: 1131.7 <b><u>(!!!!)</u></b>, 447thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.83'>Активность: 0.67<span style='color:red'>&searr;</span>0.2</span><br>Статус: <a href="action=userinfo&amp;user=2585">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 января 2019 03:53 <br><script type="text/javascript">QU('Gideon Vi','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Gideon Vi" target="_blank">Личное сообщение</a> &middot;  <a href="#25" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24488&amp;page=0#25');return false;">#25</a> </span><div align=left><br>
<b>ClockMan</b>, ты же понимаешь, что говоришь с Инде из 2016-го?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=390423&amp;user=2585&amp;forum_n=6&amp;topic=24488&amp;page=0&amp;anchor=25" class="addthx" data-post="390423"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=17432" title="07-01-2019 01:06, ранг:516.0" target="_blank">ClockMan</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="26" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 338.5 (мудрец), 349thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 января 2019 07:22 <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#26" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24488&amp;page=0#26');return false;">#26</a> </span><div align=left><br>
Никак это не решается на бинарных файлах. Если бы это было возможно, то можно было бы сделать хорошую защиту, удалив из памяти весь исполняемый образ.
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=390432&amp;user=40990&amp;forum_n=6&amp;topic=24488&amp;page=0&amp;anchor=26" class="addthx" data-post="390432"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="27" onfocus="this.blur()" href="JavaScript:di('[b]Vamit[/b]','')">Vamit</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/20406.jpg" alt=""><br><span class=txtSm>Ранг: 331.1 (мудрец), 561thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.3'>Активность: 0.19<span style='color:red'>&searr;</span>0.06</span><br>Статус: <a href="action=userinfo&amp;user=20406">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 января 2019 10:40 <br><script type="text/javascript">QU('Vamit','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vamit" target="_blank">Личное сообщение</a> &middot;  <a href="#27" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24488&amp;page=0#27');return false;">#27</a> </span><div align=left><br>
Не всё так грустно, как вы малюете, если правильно поставить задачу и задать пограничные условия, то она полностью решается статическим эмулятором (полная эмуляция инструкций, регистров, стека, памяти) для любого типа бинарного кода (чистый, обфусцированный, виртуализованный).<br>Простая статика (дизасм с набором доп. условий) заткнется на любых косвенных переходах, а динамика пропустит очень много полезного кода.<br>Это не голословное высказывание, а проверенное решение на коде разных типов.
<br><br><font size="1"><i>-----<br>Everything is relative...</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=390435&amp;user=20406&amp;forum_n=6&amp;topic=24488&amp;page=0&amp;anchor=27" class="addthx" data-post="390435"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="28" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 338.5 (мудрец), 349thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 января 2019 11:03 &middot; Поправил: difexacaw <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#28" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24488&amp;page=0#28');return false;">#28</a> </span><div align=left><br>
<b>Vamit</b><br><br>Вы понимаете что помешались на вирт машинах ?<br><br>А какой толк в данной задаче от части, выделит выборка конкретную область данных. Это никак не поможет узнать лимиты области. Полнейшая чушь.<br><br>Не знаю зачем эту тему подняли, но задача не решаема.<br><br>Я возвращался к этому несколько раз, затем забыл вовсе, решение не возможно. Из последних идей - я думал как использовать ядерную валидацию указателей. Прежде обращения к памяти из км происходит проверка памяти, либо это происходит при самом обращении к ней, в любом случае сервис возвращает статус памяти(#AV: N/A). Но затем я к данной теме больше не возвращался, это врядле возможно реализовать.<br><br>Вся суть в двух проблемах - определить указатель и определить его размер(те адресуемой области).<br>Для процессорных инструкций это просто, все области линейны. Системные сервисы работают иначе, они используют структуры, в которых так же есть указатели на другие структуры. Может и можно определить их размер, последовательным перезапуском сервисов, но что то мне подсказывает что в конце ничего не выйдет хорошего, учитывая сервисы гуя и прочее.<br><br>Не могу сказать конкретно, я это подробно больше не рассматривал. Могу лишь описать основную идею защиты. Анклав(область памяти, состояние которой зависит от ридера) не может быть реализован для обычной секции кода(не известно что передавать в ядро, параметры памяти для каждого сервиса). Именно по выше описанной причине. Иначе возможно убрать из памяти весь образ, зная сервисные параметры формировать их в буферах. Но опять же такое врядле возможно без хардкода.
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=390436&amp;user=40990&amp;forum_n=6&amp;topic=24488&amp;page=0&amp;anchor=28" class="addthx" data-post="390436"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="29" onfocus="this.blur()" href="JavaScript:di('[b]ntldr[/b]','')">ntldr</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 369.8 (мудрец), 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.89'>Активность: 0.39<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=12867">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 января 2019 11:04 &middot; Поправил: ntldr <br><script type="text/javascript">QU('ntldr','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ntldr" target="_blank">Личное сообщение</a> &middot;  <a href="#29" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24488&amp;page=0#29');return false;">#29</a> </span><div align=left><br>
<I>Vamit пишет:<br>она полностью решается статическим эмулятором (полная эмуляция инструкций, регистров, стека, памяти) для любого типа бинарного кода (чистый, обфусцированный, виртуализованный) </I><br>Эмуляция - это уже как-бы не совсем статика. И у эмуляции всегда есть ограничения, невозможно полноценно эмулировать внешнюю среду (это всё что находится дальше процессора и памяти. включает в себя софт, хард и даже пользователя...).<br><br><I>difexacaw пишет:<br>Вся суть в двух проблемах - определить указатель и определить его размер(те адресуемой области). </I><br>Касательно системных структур, хорошая практика отыскивать указатель в секции данных и код который на него ссылается. В структурах переимещаемся по известным оффсетам (захардкожены, либо берутся из PDB символов), либо определяем оффсеты через объект с частично известным содержимым.
<br><br><font size="1"><i>-----<br>PGP key <noindex><a href="https://diskcryptor.net/storage/new_key.asc" rel="nofollow" target="_blank">&lt0x1B6A24550F33E44A&gt</a></noindex></i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=390437&amp;user=12867&amp;forum_n=6&amp;topic=24488&amp;page=0&amp;anchor=29" class="addthx" data-post="390437"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="30" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 338.5 (мудрец), 349thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 января 2019 11:19 <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#30" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24488&amp;page=0#30');return false;">#30</a> </span><div align=left><br>
<b>ntldr</b><br><br>Бессмысленно это. Можно рассмотреть вариант - вызов сервиса, определение адресуемой области, разблокировка её и так рекурсивно. В системе есть несколько мониторов, через которое такое можно сделать.<br>Но учитывая множество нюансов, думаю не выйдет. Хотя при этом могут всплыть косяки в реализации нтапи.
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=390438&amp;user=40990&amp;forum_n=6&amp;topic=24488&amp;page=0&amp;anchor=30" class="addthx" data-post="390438"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> .  <b>1</b> . <a href="action=vthread&amp;forum=6&amp;topic=24488&amp;page=1.html">2</a> . <a href="action=vthread&amp;forum=6&amp;topic=24488&amp;page=2.html">3</a> . <a href="action=vthread&amp;forum=6&amp;topic=24488&amp;page=1.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> code vs data.</span></td>
</tr></table>
</div>
<a name=newreply></a>
<div align=center>
<table class=forums>
<tr>
<td class=caption4 width="100%"><span class=header>Эта тема закрыта. Ответы больше не принимаются.</span></td>
</tr>
</table>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=24488" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
