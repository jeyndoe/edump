<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Вопрос по взлому программы (похоже антитрасер стоит) - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Здраствуйте. Нужда заставила заняться взломом программы. Ранее этим никогда не занимался, а по сему не судите пожалуйста строго за мои глупые вопросы. Итак: Инструменты OllyDbg 1.10 PhantOm 1.15 Olly Advanced В Оле адвансед">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=40607'>vsv1</a>, <a target='_blank' href='?action=userinfo&amp;user=41701'>_MBK_</a> (+3 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/nub.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=5&sortBy=0&page=0.html"><b>Вопросы новичков</b></a> <b class=bulletHead>&#8212;&#8250;</b> Вопрос по взлому программы (похоже антитрасер стоит)</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]darkb[/b]','')">darkb</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 0.2 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.62'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=14354">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 декабря 2007 11:23 <br><script type="text/javascript">QU('darkb','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=darkb" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=10656.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Здраствуйте. Нужда заставила заняться взломом программы. Ранее этим никогда не занимался, а по сему не судите пожалуйста строго за мои глупые вопросы. Итак:<br><br>Инструменты<br>OllyDbg 1.10<br>PhantOm 1.15<br>Olly Advanced<br><br>В Оле адвансед включены все bufixes. В Фантоме &quot;Hide from PEB&quot;, &quot;LoadDriver&quot;, &quot;hook GetTickCount&quot;, &quot;hook RDTSC&quot; и &quot;Custom handler exceptions&quot;.<br><br>Есть программка которая вызывает функцию из защищенной Хаспом библиотеки. Если хасп присутствует - метод возвращает 0 иначе 9.<br><br>Путем тупого трасерта набрел я на такой кусок кода:<br><br>10001FEF   90               NOP<br>10001FF0   6A 64            PUSH 64<br>10001FF2   FFD6             CALL ESI<br>10001FF4   8B4424 04        MOV EAX,DWORD PTR SS:[ESP+4]<br>10001FF8   85C0             TEST EAX,EAX<br>10001FFA  ^74 F4            JE SHORT gwx.10001FF0<br>10001FFC   5E               POP ESI<br><br>Содержимое регистров:<br><br>EAX 00000000<br>ECX 7C80240F KERNEL32.7C80240F<br>EDX 7C90EB94 ntdll.KiFastSystemCallRet<br>EBX 00F93A54<br>ESP 0012E4D4<br>EBP 0012EBB0<br>ESI 7C802442 KERNEL32.Sleep<br>EDI 0012EC54 ASCII &quot;c:\maps\rostsub.chart&quot;<br>EIP 10001FF0 gwx.10001FF0<br>C 0  ES 0023 32bit 0(FFFFFFFF)<br>P 1  CS 001B 32bit 0(FFFFFFFF)<br>A 0  SS 0023 32bit 0(FFFFFFFF)<br>Z 1  DS 0023 32bit 0(FFFFFFFF)<br>S 0  FS 003B 32bit 7FFDF000(FFF)<br>T 0  GS 0000 NULL<br>D 0<br>O 0  LastErr ERROR_SUCCESS (00000000)<br>EFL 00000246 (NO,NB,E,BE,NS,PE,GE,LE)<br>ST0 empty -??? FFFF 005E005E 005E005E<br>ST1 empty -??? FFFF 00D500D5 00D500D5<br>ST2 empty -??? FFFF 00000057 0056004F<br>ST3 empty -??? FFFF 000000C4 00C200B4<br>ST4 empty 0.0<br>ST5 empty 86.000000000000000000<br>ST6 empty 0.2500000000000000000<br>ST7 empty 251.39941406250000000<br>               3 2 1 0      E S P U O Z D I<br>FST 0100  Cond 0 0 0 1  Err 0 0 0 0 0 0 0 0  (LT)<br>FCW 027F  Prec NEAR,53  Mask    1 1 1 1 1 1<br><br>Стэк<br><br>0012E4D4   00F93A00<br>0012E4D8   00000000<br>0012E4DC   10051B4C  RETURN to gwx.10051B4C from gwx.10001FC0<br>0012E4E0   100513E0  gwx.100513E0<br>0012E4E4   0012E4EC<br>0012E4E8   10086777  RETURN to gwx.10086777 from gwx.1008935B<br>0012E4EC   100B08B0  gwx.100B08B0<br>0012E4F0   10051A60  gwx.10051A60<br>0012E4F4   100A7810  gwx.100A7810<br>0012E4F8   00000000<br>0012E4FC   00000C83<br>0012E500   10051160  gwx.10051160<br>0012E504   10051370  gwx.10051370<br>0012E508   10001CD0  gwx.10001CD0<br>0012E50C   1000F9B7  RETURN to gwx.1000F9B7 from gwx.10051AF0<br>0012E510   0012EBA4  Pointer to next SEH record<br>0012E514   100929CE  SE handler<br>0012E518   00000000<br>0012E51C   1001CA1C  RETURN to gwx.1001CA1C from gwx.1000F980<br>0012E520   00F946CC<br>0012E524   00F943F0<br>0012E528   00162910<br>0012E52C   6D5C3A63<br>0012E530   5C737061<br>0012E534   74736F72<br>0012E538   2E627573<br>0012E53C   00696E69<br>0012E540   00150000<br>0012E544   7C910732  RETURN to ntdll.7C910732 from ntdll.7C90EE02<br>0012E548   00000004<br>0012E54C   00150748<br>0012E550   00150000<br>0012E554   001ACFC0<br>0012E558   0012E548<br>0012E55C   7C810603  RETURN to KERNEL32.7C810603 from KERNEL32.7C802501<br><br><br><br>Эспериментально выяснил, что если на момент 10001FEF нет хаспа и в этой точке его вставить, то при отпускании программы все проходит гладко и ключ обнаруживается. И наоборот Если ключа нет до 10001FFC, а потом его вставить, то длл-ка его все равно не видит. Логически рассуждая решил что, именно в этом куске кода и порылся хасп (не бейте ногами!). При попытке трассировать этот кусок трасер влетает в кернельную, чего-то там делает и выходит. Поскольку DWORD PTR SS:[ESP+4] всегда на выходе дает 0, то получается вечный цикл. Стоит в любой момент трасерта отпустить прогу, как она начинает плодить треды, их завершать и выходит из цикла, останавливаясь на 10001FFC (брекпойнт). Любая попытка трасерта опять приводит к бесконечному циклу. Опять же. Глянув на ESI вижу ссылку на KERNEL32.Sleep, что и навело меня на подозрение о присутствии антитрасера. <br><br>Пожалуйста подскажите с какой стороны начать копать? Мне много не надо. Только волшебный пендаль в нужном направлении, а дальше постараюсь разобраться. <img src="img/smilies/s6.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=171434&amp;user=14354&amp;forum_n=5&amp;topic=10656.html&amp;page=0&amp;anchor=1" class="addthx" data-post="171434"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]Bitfry[/b]','')">Bitfry</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 495.3 (мудрец)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.8'>Активность: 0.3<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=410">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 декабря 2007 17:08 <br><script type="text/javascript">QU('Bitfry','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Bitfry" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=10656.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
<b>darkb</b>, слишком маленький кусок кода (и, кстати, хреново представлен, в следующий раз возьми листинг из IDA).<br>Возможно, конечно, кто-то встречался именно с таким случаем и всё сразу тебе расскажет, но лучше на это не рассчитывать.<br><br>Сам посмотри, в этом коде нет ничего особенного:<br><br>10001FEF 90 NOP ; пустышка для выравнивания цикла<br>10001FF0 6A 64 PUSH 64 ; 100mc ожидания<br>10001FF2 FFD6 CALL ESI  ; вызов функции (оптимизация C++)<br>10001FF4 8B4424 04 MOV EAX,DWORD PTR SS:[ESP+4] ; локальная переменная, а что в ней – х.з.<br>10001FF8 85C0 TEST EAX,EAX ; IF Local ==0<br>10001FFA ^74 F4 JE SHORT gwx.10001FF0  ; jmp 10001FF0<br>10001FFC 5E POP ESI ; ENDIF<br><br>Сама функция Slip ничего не возвращает, и трассировать её нет смысла.<br>Видимо, поток усыпает для ожидания &quot;сигнала&quot;.<br>Очевидно, какой-то другой поток должен изменить локаль [ESP+4], а для этого его нужно было как-то проинформировать об этой локали выше (передать указатель). Причём поскольку это именно локальная переменная дело было обязательно в этой функции.<br>А что ещё можно сказать... Не знаю...<br>Давай листинг всей функции из IDA или саму dll.
<br><br><font size="1"><i>-----<br>Всем привет, я вернулся</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=171479&amp;user=410&amp;forum_n=5&amp;topic=10656.html&amp;page=0&amp;anchor=2" class="addthx" data-post="171479"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/nub.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=5&sortBy=0&page=0.html"><b>Вопросы новичков</b></a> <b class=bulletHead>&#8212;&#8250;</b> Вопрос по взлому программы (похоже антитрасер стоит)</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#3" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="5">
<input type="hidden" name="topic" value="10656">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=10656" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
