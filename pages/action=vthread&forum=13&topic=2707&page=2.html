<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Распаковка AsProtect &gt;1.23 - от А до Я. - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Эта тема по распаковке AsProtect&#039;a последних версий, для надругательств выбрана программа: AlfaClock 1.82 сайт программы: www.alfasoftweb.com/rus/ прямая ссылка: www.alfasoftweb.com/rus/AlfaClock_rus.exe В этот раздел можно">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=31361'>zds</a>, <a target='_blank' href='?action=userinfo&amp;user=28512'>-Sanchez-</a> (+9 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/aspro.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=13&sortBy=0&page=0.html"><b>Протекторы</b></a> <b class=bulletHead>&#8212;&#8250;</b> Распаковка AsProtect &gt;1.23 - от А до Я.</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> <a href="action=vthread&amp;forum=13&amp;topic=2707&amp;page=1.html">&lt;&lt;</a> .  <a href="action=vthread&amp;forum=13&amp;topic=2707&amp;page=0.html">1</a> . <a href="action=vthread&amp;forum=13&amp;topic=2707&amp;page=1.html">2</a> . <b>3</b> . <a href="action=vthread&amp;forum=13&amp;topic=2707&amp;page=3.html">4</a> . <a href="action=vthread&amp;forum=13&amp;topic=2707&amp;page=4.html">5</a> . <a href="action=vthread&amp;forum=13&amp;topic=2707&amp;page=3.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]nice[/b]','')">nice</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 384.1 (мудрец)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.96'>Активность: 0.25<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29">Участник</a><br><font color=blue>www.int3.net</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 августа 2005 11:56 &middot; Поправил: nice <br><script type="text/javascript">QU('nice','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=nice" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=2707&amp;page=2#1');return false;">#1</a> </span><div align=left><br>
Эта тема по распаковке AsProtect&#039;a последних версий, для надругательств выбрана программа: AlfaClock 1.82
<br>сайт программы: www.alfasoftweb.com/rus/
<br>прямая ссылка: www.alfasoftweb.com/rus/AlfaClock_rus.exe
<br>
<br>В этот раздел можно постить всё что касается защиты в этой программе, а также скрипты для распаковки, утилиты для снятия, ссылки на статьи.
<br>
<br>За флейм будем наказывать!
<br>
<br>Нашел ОЕР <b>inferno_mteam</b>
<br>004C5444 55 PUSH EBP
<br>004C5445 8BEC MOV EBP,ESP
<br>004C5447 83C4 C0 ADD ESP,-40
<br>004C544A 53 PUSH EBX
<br>004C544B 33C0 XOR EAX,EAX
<br>004C544D 8945 D4 MOV DWORD PTR SS:[EBP-2C],EAX
<br>004C5450 8945 D0 MOV DWORD PTR SS:[EBP-30],EAX
<br>В Ольке можно быстро попасть на ОЕР сл. образом, открываем программу, жмем Ctrl+G (перейти на строку) вбиваем туда ОЕР=04С5444, правой кнопкой мыши: Breakpoint-&gt;Hardware, on execution
<br>после чего отключаем все Exceptions: menu-&gt;Options-&gt;Exceptions и ставим все галочки, .теперь нажите F9 и вы на ОЕР
<br><br><font size="1"><i>-----<br>Подписи - ЗЛО! Нужно убирать!</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=33131&amp;user=29&amp;forum_n=13&amp;topic=2707&amp;page=2&amp;anchor=1" class="addthx" data-post="33131"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]tar4[/b]','')">tar4</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 136.5 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.25'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1631">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 24 сентября 2005 01:08 <br><script type="text/javascript">QU('tar4','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=tar4" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=2707&amp;page=2#2');return false;">#2</a> </span><div align=left><br>
<i>SergSh пишет:
<br>VОЕР после прохода в ESP+4c. Прога Microsoft Visual C++ 6.0. IAT целая. Обкод для восстановления функций IAT сегодня FF15. </i>
<br>Это ты уже по новой проге, на которую я дал ссылку? Или нет? Прогу дампим в месте ее 1-го бряка
<br>в секции кода?
<br><i>SergSh пишет:
<br>т.к CALL Dumped_.006B6394 и есть сама программа. </i>
<br>Правильно. И когда этот Call отрабатывает, идет переход на
<br>/*7B102C*/ CALL Dumped_.0040913C. А у меня нет. И вообще, у меня такое впечатление, что я какую-то
<br>системную библиотеку не подключил. Потому что прога падает, где-то после вызовов Uses32. Да бог
<br>с ней! Я и так много подчеркнул, ее распаковывая.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=36392&amp;user=1631&amp;forum_n=13&amp;topic=2707&amp;page=2&amp;anchor=2" class="addthx" data-post="36392"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]SergSh[/b]','')">SergSh</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 115.3 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.9'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2420">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 24 сентября 2005 04:33 <br><script type="text/javascript">QU('SergSh','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=SergSh" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=2707&amp;page=2#3');return false;">#3</a> </span><div align=left><br>
Да это по Cros.exe. Дампим как только VOEP будет распаковано в памяти. В окне дампа пишим D addr VOEP и Shift+9 пока не увидим распакованные команды с VEOP. Далее переходим на адрес 00401000 делаем поиск келов, восстанавливаем импорт и сниваем дамр.  Нужна ссылка на Сишную прогу запакованную этим Аспром, но без VM, для того, чтобы посмотреть начало. Если у тебя есть, то подкажи. Я думаю так будет быстрее распаковать. А по той проге всё из-за того, что ты не с того места дампил. У меня при закрытии проги вообще наг не выходит.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=36399&amp;user=2420&amp;forum_n=13&amp;topic=2707&amp;page=2&amp;anchor=3" class="addthx" data-post="36399"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]SergSh[/b]','')">SergSh</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 115.3 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.9'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2420">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 сентября 2005 11:09 <br><script type="text/javascript">QU('SergSh','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=SergSh" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=2707&amp;page=2#4');return false;">#4</a> </span><div align=left><br>
Порыскав маленько мне понравился DivX Player.exe запакованный старой версией Аспра, его начало и возьмём за основу. Конечно у меня не очень красиво получилось, но я начинающий:
<br>/*973000*/  PUSH EBP
<br>/*973001*/  MOV EBP,DWORD PTR SS:[ESP+30]
<br>/*973005*/  SUB EBP,-53
<br>/*973008*/  MOV EBP,NOV_1.004B0CD2
<br>/*97300D*/  RCR EBP,0D7
<br>/*973010*/  ADD EBP,DWORD PTR SS:[ESP+18]
<br>/*973014*/  LEA EBP,DWORD PTR SS:[ESP+ESI+29]
<br>/*973018*/  SUB EBP,ESI
<br>/*97301A*/  LEA EBP,DWORD PTR SS:[EBP-29]
<br>/*97301E*/  PUSH -1
<br>/*973020*/  PUSH DWORD PTR SS:[ESP+20]
<br>/*973024*/  PUSHFW
<br>/*973026*/  PUSH ECX
<br>/*973027*/  AND ECX,EBP
<br>/*973029*/  LEA ECX,DWORD PTR SS:[EBP+ESI*2+73]
<br>/*97302D*/  LEA ECX,DWORD PTR DS:[ECX+EBP-73]
<br>/*973031*/  SUB ECX,EBP
<br>/*973033*/  LEA ECX,DWORD PTR SS:[ESP+4A]
<br>/*973037*/  LEA ECX,DWORD PTR DS:[ECX-4A]
<br>/*97303B*/  LEA ECX,DWORD PTR DS:[ECX+EAX+6]
<br>/*97303F*/  SUB ECX,EAX
<br>/*973041*/  PUSH EAX
<br>/*973042*/  ADC EAX,ECX
<br>/*973044*/  LEA EAX,DWORD PTR SS:[EBP+7C3D50]
<br>/*97304A*/  SUB EAX,EBP
<br>/*97304C*/  PUSH EAX
<br>/*97304D*/  POP DWORD PTR DS:[ECX]
<br>/*97304F*/  POP EAX
<br>/*973050*/  POP ECX
<br>/*973051*/  POPFW
<br>/*973053*/  PUSH 4E
<br>/*973055*/  PUSHFW
<br>/*973057*/  PUSH ECX
<br>/*973058*/  OR ECX,EBP
<br>/*97305A*/  XOR ECX,EBP
<br>/*97305C*/  ADD ECX,DWORD PTR SS:[ESP+18]
<br>/*973060*/  SHL ECX,0AE
<br>/*973063*/  LEA ECX,DWORD PTR SS:[ESP+EDX+74]
<br>/*973067*/  SUB ECX,EDX
<br>/*973069*/  LEA ECX,DWORD PTR DS:[ECX+EDX-74]
<br>/*97306D*/  SUB ECX,EDX
<br>/*97306F*/  LEA ECX,DWORD PTR DS:[ECX+6]
<br>/*973072*/  PUSH EDX
<br>/*973073*/  LEA EDX,DWORD PTR DS:[EBX+ECX*2+29]
<br>/*973077*/  SUB EDX,29
<br>/*97307A*/  SUB EDX,ECX
<br>/*97307C*/  LEA EDX,DWORD PTR DS:[EDI+6E5BD8]
<br>/*973082*/  SUB EDX,EDI
<br>/*973084*/  MOV DWORD PTR DS:[ECX],EDX
<br>/*973086*/  POP EDX
<br>/*973087*/  POP ECX
<br>/*973088*/  POPFW
<br>/*97308A*/  MOV EAX,DWORD PTR FS:[0]
<br>/*973090*/  PUSH EAX
<br>/*973091*/  MOV DWORD PTR FS:[0],ESP
<br>/*973098*/  SUB ESP,58
<br>/*97309B*/  PUSH EBX
<br>/*97309C*/  PUSH ESI
<br>/*97309D*/  PUSH EDI
<br>/*97309E*/  MOV DWORD PTR SS:[EBP-18],ESP
<br>/*9730A1*/  CALL DWORD PTR DS:[&lt;&amp;kernel32.GetVersion&gt;]
<br>/*9730A7*/  XOR EDX,EDX
<br>/*9730A9*/  MOV DL,AH
<br>/*9730AB*/  MOV DWORD PTR DS:[899870],EDX
<br>/*9730B1*/  MOV ECX,NOV_1.0048A9EE
<br>/*9730B6*/  SUB ECX,13
<br>/*9730B9*/  ADD ECX,A06AE93C
<br>/*9730BF*/  LEA ECX,DWORD PTR DS:[EAX+4D]
<br>/*9730C2*/  LEA ECX,DWORD PTR DS:[ECX-4D]
<br>/*9730C5*/  AND ECX,0FF
<br>/*9730CB*/  MOV DWORD PTR DS:[89986C],ECX
<br>/*9730D1*/  SHL ECX,8
<br>/*9730D4*/  LEA ECX,DWORD PTR DS:[ECX+EDX]
<br>/*9730D7*/  MOV DWORD PTR DS:[899868],ECX
<br>/*9730DD*/  SHR EAX,10
<br>/*9730E0*/  MOV DWORD PTR DS:[899864],EAX
<br>/*9730E5*/  PUSH 1
<br>/*9730E7*/  CALL NOV_1.006EBB86
<br>/*9730EC*/  POP ECX
<br>/*9730ED*/  TEST EAX,EAX
<br>/*9730EF*/  JNZ SHORT NOV_1.009730F9
<br>/*9730F1*/  PUSH 1C
<br>/*9730F3*/  ADD BYTE PTR DS:[EAX],AL
<br>/*9730F5*/  ADD BYTE PTR DS:[EAX],AL
<br>/*9730F7*/  ADD BYTE PTR DS:[EAX],AL
<br>/*9730F9*/  CALL NOV_1.006ED71C
<br>/*9730FE*/  TEST EAX,EAX
<br>/*973100*/  JNZ SHORT NOV_1.0097310A
<br>/*973102*/  PUSH 10
<br>/*973104*/  ADD BYTE PTR DS:[EAX],AL
<br>/*973106*/  ADD BYTE PTR DS:[EAX],AL
<br>/*973108*/  ADD BYTE PTR DS:[EAX],AL
<br>/*97310A*/  XOR ESI,ESI
<br>/*97310C*/  MOV DWORD PTR SS:[EBP-4],ESI
<br>/*97310F*/  CALL NOV_1.006F6040
<br>/*973114*/  CALL DWORD PTR DS:[&lt;&amp;kernel32.GetCommandLineA&gt;]
<br>/*97311A*/  MOV DWORD PTR DS:[89B0C4],EAX
<br>Следующая процедура полностью проэмулирована в разных участках памяти, поэтому с ней придётся повозится...
<br>Да хотел спросить &quot;Где ВСЕ?&quot;,а то как то неудобно становится.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=36512&amp;user=2420&amp;forum_n=13&amp;topic=2707&amp;page=2&amp;anchor=4" class="addthx" data-post="36512"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]tar4[/b]','')">tar4</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 136.5 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.25'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1631">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 сентября 2005 21:13 <br><script type="text/javascript">QU('tar4','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=tar4" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=2707&amp;page=2#5');return false;">#5</a> </span><div align=left><br>
<i>SergSh пишет:
<br>Если у тебя есть, то подкажи </i>
<br>Есть старая версия ASProtect 1.22 - 1.23 Beta 21 -&gt; Alexey Solodovnikov, находится 
<br>webfile.ru/538899
<br>А вообще, я похожую прогу на  Microsoft Visual C++ 6.0 разбирал, там было следующее начало:
<br>01B86B4F    55              PUSH EBP                 ; 1 команда
<br>01B86B61    8BEC            MOV EBP,ESP              ; 2 команда
<br>01B86B63    6A FF           PUSH -1                  ; 3 команда
<br>01B86B65    68 A82AC200     PUSH 0C22AA8             ; 4-
<br>01B86B6A    68 DCEBAA00     PUSH 0AAEBDC             ; 5-
<br>01B86B6F    64:A1 00000000  MOV EAX,DWORD PTR FS:[0] ; 6-команда (21 байт)
<br>   Итак 21 байт,далее пропускаем мусор
<br>01B86B90    50              PUSH EAX                 ; = еще 1 байт (Итак 22 байта)
<br>01B86BA2    64:8925 0000000&gt;MOV DWORD PTR FS:[0],ESP ; 7- эмуляция ESP
<br>01B86BA9    83EC 58         SUB ESP,58               ; 8- (32 байта)
<br>01B84297    53                PUSH EBX               ; 33 байта
<br>01B842C4    56                PUSH ESI               ; 34 байта
<br>01B842F1    57                PUSH EDI               ; 005616A8  (35 байтов)
<br>01B84303    8965 E8   MOV DWORD PTR SS:[EBP-18],ESP  ; Все 38 байтов!!!
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=36538&amp;user=1631&amp;forum_n=13&amp;topic=2707&amp;page=2&amp;anchor=5" class="addthx" data-post="36538"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]SergSh[/b]','')">SergSh</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 115.3 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.9'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2420">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 сентября 2005 23:10 &middot; Поправил: SergSh <br><script type="text/javascript">QU('SergSh','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=SergSh" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=2707&amp;page=2#6');return false;">#6</a> </span><div align=left><br>
Думаю чистить код необходимости нет т.к. его очень много. За ссылку спасибо.
<br>Принцип восстановления основной ветки такой: с VOEP копируем все байты в чистое место, в вашем дампе с восстановленным импортом, (исключая не нужные прыжки только типа JMP) до первого CALL ( у меня он был CALL 13А0000, у вас будет другим) исключая комманду РUSH перед CALL. Трассируйте этот CALL по F7 пока не вайдёте до команды JMP [esp-4] (трассировать придётся достаточно долго и эти байты копировать не надо), ставим F2 на адресс JMPа и F7. Теперь сного копируем все байты до CALL 13А0000, далее F9, сработал бряк на JMP [esp-4], F7 и т.д. Адреса ведущиие в прогу преобразуем в CALL addr. Адрес команды JMP [esp-4] изменяется с каждым перезапуском проги, но находится там-же +-50 байт. Подскажу, что в CALL 006E4EFB по адресу 40109Е есть прыжёк в память его нужно изменить JMP SHORT 006E4F0D это облегчит восстановление. Структуру самой основной ветки можно подсмотреть в DivX Player.exe, это облегчит задачу по восстановлению циклов. Пока вроде-бы всё получается. Сам код приводить не буду, он занивает много места.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=36540&amp;user=2420&amp;forum_n=13&amp;topic=2707&amp;page=2&amp;anchor=6" class="addthx" data-post="36540"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]tar4[/b]','')">tar4</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 136.5 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.25'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1631">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 сентября 2005 06:13 <br><script type="text/javascript">QU('tar4','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=tar4" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=2707&amp;page=2#7');return false;">#7</a> </span><div align=left><br>
<i>SergSh пишет:
<br> у меня он был CALL 13А0000 </i>
<br>У меня этот адрес  019A1C10   CALL 02180000 (1-е обращение, для определенности). Я пока только изучая прогу.
<br>Трассировал по F7 по немногу.  Переход JMP [esp-4] не нашел (из текста не ясно, где снималось значение [esp]. По нашел очень интересное место, на которое, наверно, и ты наткнулся.
<br>Это:
<br>02180154  CALL NEAR ESI  (или 0218013E CALL NEAR EAX) и так далее. Адрес и команда 
<br>Call &lt;регистр&gt; каждый раз разная, но в принципе, можно написать скрипт, считавающий каждый раз новое месторасположение этой команды.
<br>Я подробно описал это место к тому, что оно очень похоже на call EAX  в предыдущей проге (IcomLover), когда в EAX таблица адресов переходов, по которым выполняется прога. Правда в данном случае, в ЕАХ (или ESI)  фигурирует один адрес - 01787088 (у тебя конечно другой, но последние 4 цифры наверно совпадут).
<br>SergSh пишет:
<br> Теперь сного копируем все байты до CALL 13А0000 [/i]
<br>Извини, не понял. Обращение типа CALL 13А0000 у меня идут из секции  019A1C10 ( у тебя по другому). До следующего обращения CALL 13А0000 я прохожу еще через несколько секций притом
<br>по 10-ку раз (см. trace). Ты предлагаешь это все копировать? Или я не правильно понял?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=36569&amp;user=1631&amp;forum_n=13&amp;topic=2707&amp;page=2&amp;anchor=7" class="addthx" data-post="36569"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]SergSh[/b]','')">SergSh</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 115.3 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.9'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2420">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 сентября 2005 10:26 <br><script type="text/javascript">QU('SergSh','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=SergSh" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=2707&amp;page=2#8');return false;">#8</a> </span><div align=left><br>
Да ты не првилино понял, 01787088 это не надо, трассируй дальше, есть что-то похожее на CALL EAX исполняется в цикле в последнем CALLе этогот цикла и есть JMP [esp-4] так что трассируй. А копировать надо все байты с VOEP до CALL 13А0000 и после JMP [esp-4] до следующего CALL 13А0000 затем бряк на  JMP [esp-4] и т.д. Правда с циклами трудновато,легко запутаться.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=36589&amp;user=2420&amp;forum_n=13&amp;topic=2707&amp;page=2&amp;anchor=8" class="addthx" data-post="36589"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]SergSh[/b]','')">SergSh</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 115.3 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.9'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2420">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 сентября 2005 01:54 <br><script type="text/javascript">QU('SergSh','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=SergSh" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=2707&amp;page=2#9');return false;">#9</a> </span><div align=left><br>
Приведённая выше процедура /*97310F*/ CALL NOV_1.006F6040 не верна, поторапился, пришлось всё начать с нуля. Следи за стеком, по адресу 6ЕАСЕ0 будет RET. Ну очень тяжело идёт.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=36672&amp;user=2420&amp;forum_n=13&amp;topic=2707&amp;page=2&amp;anchor=9" class="addthx" data-post="36672"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]tar4[/b]','')">tar4</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 136.5 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.25'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1631">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 сентября 2005 02:28 <br><script type="text/javascript">QU('tar4','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=tar4" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=2707&amp;page=2#10');return false;">#10</a> </span><div align=left><br>
Я понял, что ты собирался сделать.
<br>У меня ВМ начинается с вызова из секции 019А0000 (размер 5000)  типовых команд Call 02180000 (у тебя
<br>13А0000).  Заканчивается же этот вызов в секции 02190000. В конце этой секции находим:
<br>021900A3  JMP NEAR [DWORD SS:ESP-4], который ведет вновь в область 019А0000. Там несколько команд и вновь   Call 02180000.
<br> Сейчас думаю написать скрипт, переделывающий Call 02180000 в что-то вроде jmp XXXX, где ХХХ - это
<br>адрес, хранящийся в [DWORD SS:ESP-4]. А потом уже можно и дампить. Секцию 019А0000 придется копировать полностью.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=36676&amp;user=1631&amp;forum_n=13&amp;topic=2707&amp;page=2&amp;anchor=10" class="addthx" data-post="36676"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]SergSh[/b]','')">SergSh</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 115.3 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.9'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2420">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 сентября 2005 03:50 &middot; Поправил: SergSh <br><script type="text/javascript">QU('SergSh','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=SergSh" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=2707&amp;page=2#11');return false;">#11</a> </span><div align=left><br>
Попробуй. Но смитри за стеком, т.к. и пропускаем несколько celloв. Особенно посмотри команды типа 
<br>mov ESI,[ESP+8], должно стать mov ESI,[ESP+4].
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=36682&amp;user=2420&amp;forum_n=13&amp;topic=2707&amp;page=2&amp;anchor=11" class="addthx" data-post="36682"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]tar4[/b]','')">tar4</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 136.5 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.25'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1631">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 сентября 2005 04:30 &middot; Поправил: tar4 <br><script type="text/javascript">QU('tar4','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=tar4" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=2707&amp;page=2#12');return false;">#12</a> </span><div align=left><br>
SergSh 
<br>А ты заметил, что при обращении к ВМ и выходе из нее по команде  JMP NEAR [DWORD SS:ESP-4] в вершине стека одно и то же число. И значение регистров остаются прежними. Правда в глубине стека, т.е. изменение локальных переменных все же происходит. Интересно,  а в Олли можно посмотреть изменение переменных, например так же, как и в отладчике Си или дельфи.  В Олли есть опция Inspect,
<br>ты ей пользовался?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=36685&amp;user=1631&amp;forum_n=13&amp;topic=2707&amp;page=2&amp;anchor=12" class="addthx" data-post="36685"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]SergSh[/b]','')">SergSh</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 115.3 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.9'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2420">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 сентября 2005 06:02 <br><script type="text/javascript">QU('SergSh','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=SergSh" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=2707&amp;page=2#13');return false;">#13</a> </span><div align=left><br>
Да заметил. На этой основе и предложил использование JMP NEAR [DWORD SS:ESP-4] в качестве отправной точки при восстановлении. Но я начинающий и этим всё сказано.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=36690&amp;user=2420&amp;forum_n=13&amp;topic=2707&amp;page=2&amp;anchor=13" class="addthx" data-post="36690"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]SergSh[/b]','')">SergSh</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 115.3 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.9'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2420">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 сентября 2005 09:01 <br><script type="text/javascript">QU('SergSh','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=SergSh" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=2707&amp;page=2#14');return false;">#14</a> </span><div align=left><br>
Дошёл до Call 51с630. Там происходит запуск проги, но самое главное идёт дораспаковка файла и следовательно меняется и адрес JMP [esp-4] учти это при написании скрипта. Откуда ты взял это &quot;чудо&quot;, сдаётся мне она запакована дважды. Об этом сведетельствует взня с функциями похожая на создание новой IAT в этом же Callе. 
<br>Said100- если первая команда PUSH EBP, затем JMP ...... то это и есть VOEP/
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=36708&amp;user=2420&amp;forum_n=13&amp;topic=2707&amp;page=2&amp;anchor=14" class="addthx" data-post="36708"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]tar4[/b]','')">tar4</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 136.5 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.25'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1631">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 сентября 2005 20:23 <br><script type="text/javascript">QU('tar4','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=tar4" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=2707&amp;page=2#15');return false;">#15</a> </span><div align=left><br>
<I>SergSh пишет:
<br>сдаётся мне она запакована дважды </I>
<br>На счет дважды не знаю. Но известно, что аспр - это только 1-я линия защиты проги.
<br>Скрипт я практически написал. Но меня смущает то, что по ходу выполнения проги встречаются 3 обращения к ВМ. Я потом прога запускается. А как быть с другими обращениями? Ведь для того, чтобы узнать адрес возврата, надо пройти через ВМ, а я не прохожу? Смысл использования скрипта для определения адреса возврата и патча команды Call 02180000 (обращения к ВМ) теряется. Поэтому пока, я
<br>сдампил прогу, предварительно восстановив некоторые эмулированные аспром апи-функции, полностью подключил секцию 019A0000 (в ней код проги перемешан с мусором аспра, в ней расположена VOEP) и
<br>вручную начал менять вызовы Call 02180000 на Jmp &lt;адрес возврата&gt;. Пока идет, что дальше будет - посмотрим. Может потом соображу, как лучше писать скрипт.
<br>
<br><I>said100 пишет:
<br>Распаковываю Aspr 1.23-rc4 </I>
<br>Ты бы лучше, чем писать кучу кода в топике, дал ссылку. Можно было бы тогда, что-нибудь по делу подсказать. А то там, в основном, мусор.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=36753&amp;user=1631&amp;forum_n=13&amp;topic=2707&amp;page=2&amp;anchor=15" class="addthx" data-post="36753"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]tar4[/b]','')">tar4</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 136.5 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.25'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1631">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 сентября 2005 04:23 <br><script type="text/javascript">QU('tar4','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=tar4" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=2707&amp;page=2#16');return false;">#16</a> </span><div align=left><br>
В общем, я немного поторопился. Переделал скрипт и он проходит через все функции, а не через 3,  как
<br>писал ранее. У меня он вроде отработал, хотя конечно, его надо еще доделывать. Я там написал в примечаниях. Пока результаты выводит в лог-файл. И еще. Хотелось бы услышать идеи по объединению 
<br>скрипта по восстановлению апи-функций и вызовов в ВМ. Ведь прежде, чем дампить, надо восстановить
<br>часть апи-функций. Кстати, напоролся на грабли. Восстановил апи-функции, но не посмотрел, что в скрипте прописано восстановление ввиде jmp XXX, а не Call XXX. Теперь придеться все по-новому делать.<br><br><img src="img/attach.gif" alt=""> <a href="./files/c267_call_vm.osc">c267_call_vm.osc</a>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=36792&amp;user=1631&amp;forum_n=13&amp;topic=2707&amp;page=2&amp;anchor=16" class="addthx" data-post="36792"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]SergSh[/b]','')">SergSh</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 115.3 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.9'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2420">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 сентября 2005 11:31 <br><script type="text/javascript">QU('SergSh','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=SergSh" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=2707&amp;page=2#17');return false;">#17</a> </span><div align=left><br>
Кажется всё понял. Ищем CALL 13А0000 нашли, записали в переменную, New origin here на этот адрес, бряк на  JMP [esp-4] после сработки бряка в EIP записываем адрес из переменной, а на месте CALL 13А0000 вбиваем JMP адрес из JMP [esp-4], примерно всё как с IAT, только возврат искусственный и т.д. Всё будет в одном месте и прога на месте стоит, затем дампим этот  участок памяти, затем восстанавливаем импорт в проге дампим, дописываем к дампу проги новую секцию размером 5000 и с помощью WinHex вставляем дамп памяти в дамп проги, затем ImportRECом прикручиваем импорт. Примерно такой алгоритм, опустив пока дораспаковку и встроенные адреса. Как сразу не сообразил? Старею.  Завтра попробую.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=36820&amp;user=2420&amp;forum_n=13&amp;topic=2707&amp;page=2&amp;anchor=17" class="addthx" data-post="36820"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]tar4[/b]','')">tar4</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 136.5 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.25'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1631">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 сентября 2005 20:34 &middot; Поправил: tar4 <br><script type="text/javascript">QU('tar4','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=tar4" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=2707&amp;page=2#18');return false;">#18</a> </span><div align=left><br>
SergSh
<br>Да, примерно так. По крайней мере первые  3 вызова в ВМ я прошел в легкую. Но потом доработал скрипт и понял, что в ручную это будет очень долго, там более 100 вызовов. Сейчас остановился и пытают доработать в скрипте блок, который будет менять CALL 13А0000 на  JMP (адрес возврата). Там есть сложность. Если  JMP в пределах одной секции - то он имеет два байта, а если в другую (т.е в секцию кода) - то размер команды 5 байт. А есть и те и другие. Значит надо писать еще и алгоритм распознования адреса возврата.
<br><I>said100 пишет:
<br>Сылкук дать немогу так как прога единственная </I>
<br>Раз он купил, значит есть рег. номер. А если ты ломаешь - значит есть в этом резон.
<br>Ведь наверняка шеф не заглядывает сюда.
<br>Ну так выбери минимальную рабочую конфигурацию (exe + др), можешь переименовать  и в webfile.
<br>А иначе я подсказать не могу. Может кто-нибудь другой?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=36843&amp;user=1631&amp;forum_n=13&amp;topic=2707&amp;page=2&amp;anchor=18" class="addthx" data-post="36843"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]SergSh[/b]','')">SergSh</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 115.3 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.9'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2420">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 сентября 2005 22:50 <br><script type="text/javascript">QU('SergSh','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=SergSh" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=2707&amp;page=2#19');return false;">#19</a> </span><div align=left><br>
Я думаю тут стоит подумать а Jmpы ли должны быть. Я больше склоняюсь к CАLLам, а переводить адрес надо обязательно и PUSHа перед CALLом. Кстати подсажи методу, а то я где-то видел, но боюсь долго буду искать.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=36845&amp;user=2420&amp;forum_n=13&amp;topic=2707&amp;page=2&amp;anchor=19" class="addthx" data-post="36845"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="20" onfocus="this.blur()" href="JavaScript:di('[b]SergSh[/b]','')">SergSh</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 115.3 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.9'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2420">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 сентября 2005 03:24 <br><script type="text/javascript">QU('SergSh','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=SergSh" target="_blank">Личное сообщение</a> &middot;  <a href="#20" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=2707&amp;page=2#20');return false;">#20</a> </span><div align=left><br>
Борьбу с  PUSHами я кажется придумал. Было так
<br>/*1340A57*/  PUSH EBP
<br>/*1340A58*/  PUSH 1340AD2
<br>/*1340A5D*/  CALL 013A0000
<br>/*1340A62*/  PUSH EDI
<br>Стало так
<br>/*1340A57*/  PUSH EBP
<br>/*1340A58*/  CALL 013A0000
<br>/*1340A5D*/  JMP SHORT 01340AD2
<br>/*1340A5F*/  NOP
<br>/*1340A60*/  NOP
<br>/*1340A61*/  NOP
<br>/*1340A62*/  PUSH EDI
<br>Байтов всегда хватает и можно всегда писать CALL 013A0000, т.к. первоначально предпологалось там где есть PUSH 1340AD2, то ниже будет JMP. И к тому же в дампе не будет недорозумений и вообщем легко это сделать в скрипте. Я проверил, это работает прекрасно. Остаётся один вопрос как определить нужные байты возпращаемого адреса в дампе, чтобы он стал в место CALL 013A0000. Так ка простог VA-RVA явно не достаточно.  Грамотные научите.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=36861&amp;user=2420&amp;forum_n=13&amp;topic=2707&amp;page=2&amp;anchor=20" class="addthx" data-post="36861"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="21" onfocus="this.blur()" href="JavaScript:di('[b]tar4[/b]','')">tar4</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 136.5 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.25'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1631">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 сентября 2005 03:32 <br><script type="text/javascript">QU('tar4','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=tar4" target="_blank">Личное сообщение</a> &middot;  <a href="#21" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=2707&amp;page=2#21');return false;">#21</a> </span><div align=left><br>
<I>SergSh пишет:
<br>Я больше склоняюсь к CАLLам, </I>
<br>Ты знаешь, я начинал в ручную так, например:
<br>019A02F6    68 79139A01     PUSH 19A1379
<br>019A02FB    E8 00FD7D00     CALL 02180000    (Ret_function = 006E6D36)
<br>меняем на
<br>019A02FB   E9 366AD4FE     JMP 006E6D36  (и все, больше ничего не трогаю).
<br>
<br><I>SergSh пишет:
<br> PUSHа перед CALLом </I>
<br>Но ведь не везде же идет PUSH перед Call, например:
<br>019A047F    59              POP ECX
<br>019A0480    E8 7BFB7D00     CALL 02180000   (Ret_function = 019A1FD0)
<br>меняем на
<br>019A0480   E9 4B1B0000     JMP 019A1FD0
<br>Если использовать в этой конструкции CaLL&gt;&gt;CaLL, то тогда нужно будет перед ней вносить
<br>PUSH (адрес возврата), а это по-моему сложно.
<br>
<br>С другой стороны, что-то пока у меня не очень получается с эмулированием команд Jmp (адрес возврата).
<br>там разные опкоды используются. На короткий переход я написал, а на более длинный - пока нет.
<br>Здесь же нужно интерпретировать опкоды команд, а это уже функции диссассемблера. Ну не на скриптах же это писать! Ну еще попробую.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=36862&amp;user=1631&amp;forum_n=13&amp;topic=2707&amp;page=2&amp;anchor=21" class="addthx" data-post="36862"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="22" onfocus="this.blur()" href="JavaScript:di('[b]tar4[/b]','')">tar4</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 136.5 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.25'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1631">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 сентября 2005 03:44 <br><script type="text/javascript">QU('tar4','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=tar4" target="_blank">Личное сообщение</a> &middot;  <a href="#22" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=2707&amp;page=2#22');return false;">#22</a> </span><div align=left><br>
Писал ответ не видя предыдущего сообщения.
<br>НЕ совсем понял твою задумку.
<br><I>SergSh пишет:
<br>/*1340A58*/ CALL 013A0000 
<br>/*1340A5D*/ JMP SHORT 01340AD2 
<br>/*1340A5F*/ NOP </I>
<br>
<br>Вместо CALL 013A0000  в дампе ты хочешь писать Call (Адрес возврата), так что ли?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=36863&amp;user=1631&amp;forum_n=13&amp;topic=2707&amp;page=2&amp;anchor=22" class="addthx" data-post="36863"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="23" onfocus="this.blur()" href="JavaScript:di('[b]SergSh[/b]','')">SergSh</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 115.3 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.9'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2420">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 сентября 2005 04:23 <br><script type="text/javascript">QU('SergSh','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=SergSh" target="_blank">Личное сообщение</a> &middot;  <a href="#23" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=2707&amp;page=2#23');return false;">#23</a> </span><div align=left><br>
Да. Call (Адрес возврата из JMP [esp-4]). И при этом дамп это участка памяти будет обсалютно корректным и его можно будет прикрутить к проге. Но вопрос о смещении пока открат. Попробуй.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=36864&amp;user=2420&amp;forum_n=13&amp;topic=2707&amp;page=2&amp;anchor=23" class="addthx" data-post="36864"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="24" onfocus="this.blur()" href="JavaScript:di('[b]SergSh[/b]','')">SergSh</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 115.3 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.9'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2420">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 сентября 2005 05:07 <br><script type="text/javascript">QU('SergSh','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=SergSh" target="_blank">Личное сообщение</a> &middot;  <a href="#24" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=2707&amp;page=2#24');return false;">#24</a> </span><div align=left><br>
Для чего это всё я тебе сейчас расскажу. Если делать так как ты говориш, то PUSH 19A1379 так и останется в дампе, и куда потом перейдёт JMP 006E6D36 отработав. Ведь подгружать дамп на тоже место это не серьёзно. В этом вся соль. Просто этот дам работать не будет. Нам надо привязать все относительно существующих адресов, тогда проблема будет решена.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=36870&amp;user=2420&amp;forum_n=13&amp;topic=2707&amp;page=2&amp;anchor=24" class="addthx" data-post="36870"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="25" onfocus="this.blur()" href="JavaScript:di('[b]tar4[/b]','')">tar4</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 136.5 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.25'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1631">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 сентября 2005 05:59 <br><script type="text/javascript">QU('tar4','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=tar4" target="_blank">Личное сообщение</a> &middot;  <a href="#25" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=2707&amp;page=2#25');return false;">#25</a> </span><div align=left><br>
<I>SergSh пишет:
<br> PUSH 19A1379 так и останется в дампе, и куда потом перейдёт JMP 006E6D36 отработав. </I>
<br>Мы наверное, говорим все же о разном. Эту секцию 19a0000-19a5000 я полностью прикручиваю к дампу.
<br>Конечно, она встает на другие адреса, например 0970000-0975000. Но я потом с помощью VirtualAlloc  создаю в у себя в дампе эту область 19a0000-19a5000 и все из секции 0970000-0975000 переношу во вновь созданную область  19a0000-19a5000. Тогда у меня  JMP 006E6D36 отработав в секции кода вновь
<br>возращается в область 19A000-19A500. И не надо ничего менять. Это 10 лишних операторов в начале кода.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=36879&amp;user=1631&amp;forum_n=13&amp;topic=2707&amp;page=2&amp;anchor=25" class="addthx" data-post="36879"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="26" onfocus="this.blur()" href="JavaScript:di('[b]SergSh[/b]','')">SergSh</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 115.3 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.9'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2420">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 сентября 2005 06:44 <br><script type="text/javascript">QU('SergSh','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=SergSh" target="_blank">Личное сообщение</a> &middot;  <a href="#26" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=2707&amp;page=2#26');return false;">#26</a> </span><div align=left><br>
А если эта область память окажется занята? И  с VirtualAlloc не  не всё так просто, даже при указании необходимой области нет гарантии, что она будет выделена в лучшем случае он вернёт 0. Да и мы вроде пытаемся разработать общий для в сех машин способ распаковки. Знатоки рассудите нас.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=36889&amp;user=2420&amp;forum_n=13&amp;topic=2707&amp;page=2&amp;anchor=26" class="addthx" data-post="36889"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="27" onfocus="this.blur()" href="JavaScript:di('[b]tar4[/b]','')">tar4</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 136.5 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.25'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1631">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 сентября 2005 20:52 <br><script type="text/javascript">QU('tar4','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=tar4" target="_blank">Личное сообщение</a> &middot;  <a href="#27" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=2707&amp;page=2#27');return false;">#27</a> </span><div align=left><br>
<I>SergSh пишет:
<br>А если эта область память окажется занята? </I>
<br>Как она может быть занята, если создается аспром в процессе работы. Ведь при создании дампа эти области в дамп не переносятся.
<br><I>SergSh пишет:
<br>даже при указании необходимой области нет гарантии, что она будет выделена в лучшем случае он вернёт 0 </I>
<br>Это я нашел, как обойти. Все выделяется в нужном виде.
<br>Другое дело, что на иной машине эта выделенная область будет располагаться в другом адресе. Как собственно у нас и получается. Тут ты прав. Но и это, в принципе, можно обойти.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=36988&amp;user=1631&amp;forum_n=13&amp;topic=2707&amp;page=2&amp;anchor=27" class="addthx" data-post="36988"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="28" onfocus="this.blur()" href="JavaScript:di('[b]SergSh[/b]','')">SergSh</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 115.3 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.9'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2420">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 октября 2005 07:39 <br><script type="text/javascript">QU('SergSh','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=SergSh" target="_blank">Личное сообщение</a> &middot;  <a href="#28" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=2707&amp;page=2#28');return false;">#28</a> </span><div align=left><br>
Tar4! Ещё один совет для скрипта: каждый CALL 013A0000 необходимо проходить дважды, при этом первый раз необходимо установить флаг Z=0, а второй раз Z=1 и если возвращённые оба раза значения из JMP [esp-4] не равны Следовательно гдето выше в коде есть сравнение и следовательно это необходимо учесть, если же выше сравнения не было то оба значения будут равны, такая методика очень хорошо помогает при распаковке циков. После обнаружения разницы возвращаемых адресов я делал так: ниже, в этом куске памяти, есть достаточно места поэтому я переорентировал  CALL 013A0000 в JMPв низ, а там JNZ addr 1 и JMP addr2 соответственно, но учти что значения флага Z должно контролироваться сначало 0 затем 1, иначе будут разные условные переходы, а это замудряет алгоритм исследования.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=37100&amp;user=2420&amp;forum_n=13&amp;topic=2707&amp;page=2&amp;anchor=28" class="addthx" data-post="37100"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="29" onfocus="this.blur()" href="JavaScript:di('[b]tar4[/b]','')">tar4</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 136.5 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.25'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1631">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 октября 2005 21:05 <br><script type="text/javascript">QU('tar4','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=tar4" target="_blank">Личное сообщение</a> &middot;  <a href="#29" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=2707&amp;page=2#29');return false;">#29</a> </span><div align=left><br>
<I>SergSh пишет:
<br>Каждый CALL 013A0000 необходимо проходить дважды </I>
<br>Спасибо. Похоже именно  на это я как раз и наткнулся. Скрипт я написал, сдампил прогу и начал ее трассировать. Сначало все шло хорошо, но потом возникла ошибка как раз связанная  с JMP [esp-4]. Скрипт не правильно почему-то определил адрес возврата. Я  как раз собирался сегодня разбираться с этим. По-видимому, при повторном прохождении скрипт переписал адрес возврата. Надо это как учитывать.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=37217&amp;user=1631&amp;forum_n=13&amp;topic=2707&amp;page=2&amp;anchor=29" class="addthx" data-post="37217"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="30" onfocus="this.blur()" href="JavaScript:di('[b]SergSh[/b]','')">SergSh</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 115.3 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.9'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2420">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 октября 2005 23:31 <br><script type="text/javascript">QU('SergSh','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=SergSh" target="_blank">Личное сообщение</a> &middot;  <a href="#30" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=2707&amp;page=2#30');return false;">#30</a> </span><div align=left><br>
Ещё один совет. Обрати внимание на адреса, находящиеся в дампе по адресу  862e04 и ниже. В дампе соответственно по этим адресам ничего нет по этому их все надо переориентировать и записать в них данные из оригинала в районе 40 байт. Там всего 8 адресов. В дальнейшем прога  будет их активно юзать. Ещё можно сказать, что предётся переделывать ещё 2 участка памяти, но там методика аналогичная адреса можно видеть по 562b27 и 62b6af соответственно. Вообщем я это вроде всё прошёл но там видимо дальше идут проверки долго возится пока остановился. Но меня не покидают ощущения, что мы делаем не совсем так как надо. К стати дамп надо снимть на VOEP.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=37221&amp;user=2420&amp;forum_n=13&amp;topic=2707&amp;page=2&amp;anchor=30" class="addthx" data-post="37221"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="31" onfocus="this.blur()" href="JavaScript:di('[b]tar4[/b]','')">tar4</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 136.5 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.25'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1631">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 октября 2005 00:28 <br><script type="text/javascript">QU('tar4','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=tar4" target="_blank">Личное сообщение</a> &middot;  <a href="#31" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=2707&amp;page=2#31');return false;">#31</a> </span><div align=left><br>
<I>SergSh пишет:
<br>Обрати внимание на адреса, находящиеся в дампе по адресу 862e04 и ниже. </I>
<br>Я уже наткнулся на это.
<br>Интересно вот что. Я доработал немного скрипт и он теперь проходит по функции два раза и можно визульно увидеть два адреса возврата. И действительно, в некоторых случаях они (адреса) отличаются.
<br>Но ведь в адресе 019A0B8B, где у меня произошла 1-я ошибка,  скрипт по-прежнему указывает одинаковые адреса возврата, а если пройти в ручную - то он другой. Не понимаю, почему.
<br>           n = 00000026
<br>           startscan = 019A0B8B
<br>           aftercalladdr = 02180000
<br>           esp_ = 0177A810
<br>           Ret_function = 019A1F8C     
<br>           Ret_function = 019A1F8C     //Ошибка правильно  Stack [SS:0012FF0C]=019A0AD9
<br>
<br><I>SergSh пишет:
<br>К стати дамп надо снимть на VOEP. </I>
<br>То есть ты хочешь сказать, находясь в эмулированной аспром области (у меня она 019A000-019A5000),
<br>а не на секции кода?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=37223&amp;user=1631&amp;forum_n=13&amp;topic=2707&amp;page=2&amp;anchor=31" class="addthx" data-post="37223"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> <a href="action=vthread&amp;forum=13&amp;topic=2707&amp;page=1.html">&lt;&lt;</a> .  <a href="action=vthread&amp;forum=13&amp;topic=2707&amp;page=0.html">1</a> . <a href="action=vthread&amp;forum=13&amp;topic=2707&amp;page=1.html">2</a> . <b>3</b> . <a href="action=vthread&amp;forum=13&amp;topic=2707&amp;page=3.html">4</a> . <a href="action=vthread&amp;forum=13&amp;topic=2707&amp;page=4.html">5</a> . <a href="action=vthread&amp;forum=13&amp;topic=2707&amp;page=3.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/aspro.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=13&sortBy=0&page=0.html"><b>Протекторы</b></a> <b class=bulletHead>&#8212;&#8250;</b> Распаковка AsProtect &gt;1.23 - от А до Я.</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#32" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="13">
<input type="hidden" name="topic" value="2707">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=2707" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
