<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Не срабатывают никакие остановы. OllyDBG 1.10 - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="В какой-то момент в памяти появляется нужный мне текст. Не могу определить в какой момент. Hardware Breakpoint ставлю - текс появляется как ни в чем не бывало без останова. Memory BP ставлю, F9, Ольга кричит &quot;OllyDbg is">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=42860'>igorcauret</a>, <a target='_blank' href='?action=userinfo&amp;user=8605'>Rio</a> (+6 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/nub.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=5&sortBy=0&page=0.html"><b>Вопросы новичков</b></a> <b class=bulletHead>&#8212;&#8250;</b> Не срабатывают никакие остановы. OllyDBG 1.10</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]volopas[/b]','')">volopas</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.8 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.92'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=21986">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 февраля 2015 00:59 <br><script type="text/javascript">QU('volopas','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=volopas" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23435.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
В какой-то момент в памяти появляется нужный мне текст. Не могу определить в какой момент. Hardware Breakpoint ставлю - текс появляется как ни в чем не бывало без останова. Memory BP ставлю, F9, Ольга кричит &quot;OllyDbg is unable to activate memory breakpoint on address range 02E145A0..02E145A0. Breakpoint is completely removed&quot;.<br><br>ReadFile исключил (Кстати, не откажусь от наставлений, как ловить текст от ReadFile). Что еще может быть?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=352421&amp;user=21986&amp;forum_n=5&amp;topic=23435.html&amp;page=0&amp;anchor=1" class="addthx" data-post="352421"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]TryAga1n[/b]','')">TryAga1n</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 262.5 (наставник), 337thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 8.45'>Активность: 0.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=31275">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 февраля 2015 05:45 <br><script type="text/javascript">QU('TryAga1n','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=TryAga1n" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23435.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
Обратись сюда: <noindex><a href="https://vk.com/club37759929" rel="nofollow" target="_blank">--&gt; Link &lt;--</a></noindex>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=352425&amp;user=31275&amp;forum_n=5&amp;topic=23435.html&amp;page=0&amp;anchor=2" class="addthx" data-post="352425"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]volopas[/b]','')">volopas</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.8 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.92'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=21986">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 февраля 2015 07:00 <br><script type="text/javascript">QU('volopas','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=volopas" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23435.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
Есть функция ReadFile<br>BOOL WINAPI ReadFile(<br>  _In_         HANDLE hFile,<br>  _Out_        LPVOID lpBuffer,<br>  _In_         DWORD nNumberOfBytesToRead,<br>  _Out_opt_    LPDWORD lpNumberOfBytesRead,<br>  _Inout_opt_  LPOVERLAPPED lpOverlapped<br>);<br>Если ставить любые точки останова на lpBuffer, то они не сработают на всех ОС во всех случаях. Ситуация моделируется полностью. При чем тут экстрасенс?<br>Есть ли способ все-таки поймать момент записи в lpBuffer? Как это сделать? Какие еще есть подобные процедуры, где происходит обход точек останова на запись?<br><br><b>Добавлено спустя 13 минут</b><br>LoadString, по -моему, таким же макаром работает, но она также не используется в программе для заполнения памяти.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=352427&amp;user=21986&amp;forum_n=5&amp;topic=23435.html&amp;page=0&amp;anchor=3" class="addthx" data-post="352427"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]ELF_7719116[/b]','')">ELF_7719116</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 419.0 (мудрец), 647thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.73'>Активность: 0.46<span style='color:green'>&nearr;</span>0.51</span><br>Статус: <a href="action=userinfo&amp;user=26651">Участник</a><br><font color=blue>&quotТибериумный реверсинг&quot</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 февраля 2015 07:29 <br><script type="text/javascript">QU('ELF_7719116','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ELF_7719116" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23435.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
<I>volopas пишет:<br>Есть ли способ все-таки поймать момент записи в lpBuffer? </I><br>дык оно в ядре пишется (<b>ZwReadFile</b>), а OllyDbg - это прикладной уровень. Понятное дело, что просто так не достанешь! Разве что, как функа <b>ReadFile</b> отработала и ты стоишь на RET в kernel32, тогда можно поставить останов на буфере и посмотреть, кто берет данные из него.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=352428&amp;user=26651&amp;forum_n=5&amp;topic=23435.html&amp;page=0&amp;anchor=4" class="addthx" data-post="352428"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]volopas[/b]','')">volopas</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.8 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.92'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=21986">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 февраля 2015 07:43 <br><script type="text/javascript">QU('volopas','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=volopas" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23435.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
В том - то и дело, что надо перед тем как текст начинает использоваться его поменять. То есть надо понять откуда он берется в памяти.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=352429&amp;user=21986&amp;forum_n=5&amp;topic=23435.html&amp;page=0&amp;anchor=5" class="addthx" data-post="352429"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]TryAga1n[/b]','')">TryAga1n</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 262.5 (наставник), 337thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 8.45'>Активность: 0.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=31275">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 февраля 2015 08:20 <br><script type="text/javascript">QU('TryAga1n','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=TryAga1n" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23435.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
Всем будет гораздо проще, если ты выложишь таргет и адреса, на которых не срабатывает точка останова
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=352430&amp;user=31275&amp;forum_n=5&amp;topic=23435.html&amp;page=0&amp;anchor=6" class="addthx" data-post="352430"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]reversecode[/b]','')">reversecode</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/15381.gif" alt=""><br><span class=txtSm>Ранг: 1053.6 <b><u>(!!!!)</u></b>, 1078thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.43'>Активность: 1.06<span style='color:red'>&searr;</span>0.81</span><br>Статус: <a href="action=userinfo&amp;user=15381">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 февраля 2015 08:45 <br><script type="text/javascript">QU('reversecode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=reversecode" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23435.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
очередной старфорс которые ломают свиноводы <img src="img/smilies/s5.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=352431&amp;user=15381&amp;forum_n=5&amp;topic=23435.html&amp;page=0&amp;anchor=7" class="addthx" data-post="352431"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]hello[/b]','')">hello</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 20.4 (новичок), 8thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.25'>Активность: 0.03<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=37163">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 февраля 2015 09:07 <br><script type="text/javascript">QU('hello','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=hello" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23435.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
<I>reversecode пишет:<br>очередной старфорс  </I><br>Так старфорс уже подох, вроде. Не надо вспоминать покойных <img src="img/smilies/s5.gif" alt=""><br><b>volopas</b><br>Может страница, на которой ставите точки точки, меняет атрибуты доступа через VirtualProtect или другая антиотладка. В любом случае надо ссылку на программу! Наверняка там какой-то говнопрот, как уже заметил <b>reversecode</b>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=352432&amp;user=37163&amp;forum_n=5&amp;topic=23435.html&amp;page=0&amp;anchor=8" class="addthx" data-post="352432"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]reversecode[/b]','')">reversecode</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/15381.gif" alt=""><br><span class=txtSm>Ранг: 1053.6 <b><u>(!!!!)</u></b>, 1078thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.43'>Активность: 1.06<span style='color:red'>&searr;</span>0.81</span><br>Статус: <a href="action=userinfo&amp;user=15381">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 февраля 2015 09:09 <br><script type="text/javascript">QU('reversecode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=reversecode" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23435.html&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
волопас это свиновод<br>свиноводы ломают только старфорс
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=352433&amp;user=15381&amp;forum_n=5&amp;topic=23435.html&amp;page=0&amp;anchor=9" class="addthx" data-post="352433"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=31275" title="25-02-2015 06:43, ранг:110.1" target="_blank">TryAga1n</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]volopas[/b]','')">volopas</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.8 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.92'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=21986">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 марта 2015 11:44 &middot; Поправил: volopas <br><script type="text/javascript">QU('volopas','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=volopas" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23435.html&amp;page=0#10');return false;">#10</a> </span><div align=left><br><div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">В&nbsp;любом&nbsp;случае&nbsp;надо&nbsp;ссылку&nbsp;на&nbsp;программу<span class="hl_char">!</span>&nbsp;</li>        </ol>
    </div>
</div></div>
<br><br>Данная программа - Microsoft Virtual PC 2007 SP1 - ссылки см . https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23441<br>При попытке поставить memory breakpoint on access ольга делает  VirtualProtectEx<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_number">0012A990</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">004191AC</span>&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_function"><b>CALL</b></span>&nbsp;to&nbsp;VirtualProtectEx&nbsp;from&nbsp;OLLYDBG<span class="hl_char">.</span><span class="hl_number">004191A6</span></li><li class="hl_l1"><span class="hl_number">0012A994</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">00000250</span>&nbsp;&nbsp;<span class="hl_char">|</span>hProcess&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">00000250</span>&nbsp;<span class="hl_char">(</span>window<span class="hl_char">)</span></li><li class="hl_l0"><span class="hl_number">0012A998</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">03AE2000</span>&nbsp;&nbsp;<span class="hl_char">|</span>Address&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">03AE2000</span></li><li class="hl_l1"><span class="hl_number">0012A99C</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">00001000</span>&nbsp;&nbsp;<span class="hl_char">|</span>Size&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">1000</span>&nbsp;<span class="hl_char">(</span><span class="hl_number">4096</span><span class="hl_char">.</span><span class="hl_char">)</span></li><li class="hl_l0"><span class="hl_number">0012A9A0</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">00000001</span>&nbsp;&nbsp;<span class="hl_char">|</span>NewProtect&nbsp;<span class="hl_char">=</span>&nbsp;PAGE_NOACCESS</li><li class="hl_l1"><span class="hl_number">0012A9A4</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">004D8158</span>&nbsp;&nbsp;<span class="hl_char">\</span>pOldProtect&nbsp;<span class="hl_char">=</span>&nbsp;OLLYDBG<span class="hl_char">.</span><span class="hl_number">004D8158</span></li>        </ol>
    </div>
</div></div>
<br>GetLastError показывает 000001E7:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">ERROR_INVALID_ADDRESS&nbsp;<span class="hl_number">487</span>&nbsp;<span class="hl_char">(</span>0x1E7<span class="hl_char">)</span>&nbsp;Attempt&nbsp;to&nbsp;access&nbsp;invalid&nbsp;address<span class="hl_char">.</span></li>        </ol>
    </div>
</div></div>
<br><br><b>Добавлено спустя 12 минут</b><br>Непонятно даже , где прога исполняет код виртуальной среды. Прога создает кучу потоков, постоянно переключается между ними. Оттрасировать не получается.<br><br><b>Добавлено спустя 1 час 29 минут</b><br>Если взять ту же Ольгу , запустить ее внутри виртуальной машины, открыть Ольгой любой EXE (можно саму себя), вбить в EntryPoint любые инструкции по вкусу, то эти инструкции таки появляются в памяти отлаживаемого Virtual PC.exe. Эти секции памяти появляются неясным образом. Поставил IN3 BP на все процедуры выделения памяти - результат нулевой.<br><br>Пока есть 2 проблемы: 1. Механизм выделения памяти под виртуальную машину. 2. Не срабатывают точки останова при обращении к памяти с кодом виртуальной машины во время выполнения этого кода внутри машины (внутри машины в ольге производится RUN)<br><br><b>Добавлено спустя 7 часов 21 минуту</b><br>Прога вызывает <br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_number">0012FC74</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">004FDB8D</span>&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_function"><b>CALL</b></span>&nbsp;to&nbsp;DeviceIoControl&nbsp;from&nbsp;Virtual_<span class="hl_char">.</span><span class="hl_number">004FDB87</span></li><li class="hl_l1"><span class="hl_number">0012FC78</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">00000458</span>&nbsp;&nbsp;<span class="hl_char">|</span>hDevice&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">00000458</span></li><li class="hl_l0"><span class="hl_number">0012FC7C</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">9C402C03</span>&nbsp;&nbsp;<span class="hl_char">|</span>IoControlCode&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">9C402C03</span></li><li class="hl_l1"><span class="hl_number">0012FC80</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">00000000</span>&nbsp;&nbsp;<span class="hl_char">|</span>InBuffer&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function">NULL</span></li><li class="hl_l0"><span class="hl_number">0012FC84</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">00000000</span>&nbsp;&nbsp;<span class="hl_char">|</span>InBufferSize&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span></li><li class="hl_l1"><span class="hl_number">0012FC88</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">00000000</span>&nbsp;&nbsp;<span class="hl_char">|</span>OutBuffer&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function">NULL</span></li><li class="hl_l0"><span class="hl_number">0012FC8C</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">00000000</span>&nbsp;&nbsp;<span class="hl_char">|</span>OutBufferSize&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span></li><li class="hl_l1"><span class="hl_number">0012FC90</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">0012FCA4</span>&nbsp;&nbsp;<span class="hl_char">|</span>pBytesReturned&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0012FCA4</span></li><li class="hl_l0"><span class="hl_number">0012FC94</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">00000000</span>&nbsp;&nbsp;<span class="hl_char">\</span>pOverlapped&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function">NULL</span></li>        </ol>
    </div>
</div></div>
<br>В окне хендлов:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">Handles<span class="hl_char">,</span>&nbsp;item&nbsp;<span class="hl_number">277</span></li><li class="hl_l1">&nbsp;Handle<span class="hl_char">=</span><span class="hl_number">00000458</span></li><li class="hl_l0">&nbsp;Type<span class="hl_char">=</span>File&nbsp;<span class="hl_char">(</span>dev<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;Refs<span class="hl_char">=</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">2</span><span class="hl_char">.</span></li><li class="hl_l0">&nbsp;Access<span class="hl_char">=</span><span class="hl_number">00100080</span>&nbsp;SYNCHRONIZE<span class="hl_char">|</span>READ_ATTRIBUTES</li><li class="hl_l1">&nbsp;Name<span class="hl_char">=</span><span class="hl_char">\</span>Device<span class="hl_char">\</span>VMM</li>        </ol>
    </div>
</div></div>
<br><br>Что это за устройство &quot;\Device\VMM&quot;?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=352588&amp;user=21986&amp;forum_n=5&amp;topic=23435.html&amp;page=0&amp;anchor=10" class="addthx" data-post="352588"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]volopas[/b]','')">volopas</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.8 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.92'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=21986">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 марта 2015 11:26 &middot; Поправил: volopas <br><script type="text/javascript">QU('volopas','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=volopas" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23435.html&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
Обнаружено, что в Vitrual PC.exe делаются следующие <br><br>&gt;004FCA20 /. 55 PUSH EBP ;<br>...<br>&gt;004FCA5A |. E8 E10BFAFF CALL Virtual_.0049D640 ;<br>&gt;&gt;0049D68A . FFD2 CALL EDX<br>&gt;&gt;&gt;004FCFA1 |. E8 3A000000 CALL Virtual_.004FCFE0 ; <br>&gt;&gt;&gt;&gt;004FD051 |. E8 BA9F0100 CALL Virtual_.00517010 ; -103/-102 (4)<br>&gt;&gt;&gt;&gt;&gt;<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_number">00517010</span>&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">$</span>&nbsp;&nbsp;<span class="hl_number">83EC</span>&nbsp;<span class="hl_number">08</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>SUB</b></span>&nbsp;<span class="hl_registr">ESP</span><span class="hl_char">,</span><span class="hl_number">8</span></li><li class="hl_l1"><span class="hl_number">00517013</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">833D</span>&nbsp;C48B6700<span class="hl_char">&gt;</span><span class="hl_function"><b>CMP</b></span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_function"><b>PTR</b></span>&nbsp;<span class="hl_registr">DS</span><span class="hl_char">:</span><span class="hl_char">[</span><span class="hl_number">678BC4</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_char">-</span><span class="hl_number">1</span></li><li class="hl_l0"><span class="hl_number">0051701A</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;C70424&nbsp;<span class="hl_number">000000</span><span class="hl_char">&gt;</span><span class="hl_function"><b>MOV</b></span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_function"><b>PTR</b></span>&nbsp;<span class="hl_registr">SS</span><span class="hl_char">:</span><span class="hl_char">[</span><span class="hl_registr">ESP</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_number">0</span></li><li class="hl_l1"><span class="hl_number">00517021</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">75</span>&nbsp;<span class="hl_number">06</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>JNZ</b></span>&nbsp;<span class="hl_function"><b>SHORT</b></span>&nbsp;Virtual_<span class="hl_char">.</span><span class="hl_number">00517029</span></li><li class="hl_l0"><span class="hl_number">00517023</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">33C0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>XOR</b></span>&nbsp;<span class="hl_registr">EAX</span><span class="hl_char">,</span><span class="hl_registr">EAX</span></li><li class="hl_l1"><span class="hl_number">00517025</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">83C4</span>&nbsp;<span class="hl_number">08</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>ADD</b></span>&nbsp;<span class="hl_registr">ESP</span><span class="hl_char">,</span><span class="hl_number">8</span></li><li class="hl_l0"><span class="hl_number">00517028</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;C3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">RETN</span></li><li class="hl_l1"><span class="hl_number">00517029</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">&gt;</span>&nbsp;&nbsp;<span class="hl_number">56</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;<span class="hl_registr">ESI</span></li><li class="hl_l0"><span class="hl_number">0051702A</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">6A</span>&nbsp;<span class="hl_number">00</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;<span class="hl_number">0</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; /hTemplateFile = NULL</span></li><li class="hl_l1"><span class="hl_number">0051702C</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">68</span>&nbsp;<span class="hl_number">80000040</span>&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;<span class="hl_number">40000080</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; |Attributes = NORMAL|OVERLAPPED</span></li><li class="hl_l0"><span class="hl_number">00517031</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">6A</span>&nbsp;<span class="hl_number">03</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;<span class="hl_number">3</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; |Mode = OPEN_EXISTING</span></li><li class="hl_l1"><span class="hl_number">00517033</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">6A</span>&nbsp;<span class="hl_number">00</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;<span class="hl_number">0</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; |pSecurity = NULL</span></li><li class="hl_l0"><span class="hl_number">00517035</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">6A</span>&nbsp;<span class="hl_number">00</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;<span class="hl_number">0</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; |ShareMode = 0</span></li><li class="hl_l1"><span class="hl_number">00517037</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">6A</span>&nbsp;<span class="hl_number">00</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;<span class="hl_number">0</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; |Access = 0</span></li><li class="hl_l0"><span class="hl_number">00517039</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">68</span>&nbsp;<span class="hl_number">2C696300</span>&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;Virtual_<span class="hl_char">.</span><span class="hl_number">0063692C</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; |FileName = &quot;\.\Global\VMM&quot;</span></li><li class="hl_l1"><span class="hl_number">0051703E</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;FF15&nbsp;<span class="hl_number">78C35F00</span>&nbsp;<span class="hl_function"><b>CALL</b></span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_function"><b>PTR</b></span>&nbsp;<span class="hl_registr">DS</span><span class="hl_char">:</span><span class="hl_char">[</span><span class="hl_char">&lt;</span><span class="hl_char">&amp;</span>KERNEL32<span class="hl_char">.</span>CreateFile<span class="hl_char">&gt;</span><span class="hl_comment">; \CreateFileA</span></li><li class="hl_l0"><span class="hl_number">00517044</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">8BF0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>MOV</b></span>&nbsp;<span class="hl_registr">ESI</span><span class="hl_char">,</span><span class="hl_registr">EAX</span></li><li class="hl_l1"><span class="hl_number">00517046</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">83FE</span>&nbsp;FF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>CMP</b></span>&nbsp;<span class="hl_registr">ESI</span><span class="hl_char">,</span><span class="hl_char">-</span><span class="hl_number">1</span></li><li class="hl_l0"><span class="hl_number">00517049</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">74</span>&nbsp;<span class="hl_number">2C</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>JE</b></span>&nbsp;<span class="hl_function"><b>SHORT</b></span>&nbsp;Virtual_<span class="hl_char">.</span><span class="hl_number">00517077</span></li><li class="hl_l1"><span class="hl_number">0051704B</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">6A</span>&nbsp;<span class="hl_number">00</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;<span class="hl_number">0</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; /pOverlapped = NULL</span></li><li class="hl_l0"><span class="hl_number">0051704D</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">8D4424</span>&nbsp;<span class="hl_number">0C</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>LEA</b></span>&nbsp;<span class="hl_registr">EAX</span><span class="hl_char">,</span><span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_function"><b>PTR</b></span>&nbsp;<span class="hl_registr">SS</span><span class="hl_char">:</span><span class="hl_char">[</span><span class="hl_registr">ESP</span><span class="hl_char">+</span>C<span class="hl_char">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; |</span></li><li class="hl_l1"><span class="hl_number">00517051</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;<span class="hl_registr"><b>EAX</b></span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; |pBytesReturned</span></li><li class="hl_l0"><span class="hl_number">00517052</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">6A</span>&nbsp;<span class="hl_number">04</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;<span class="hl_number">4</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; |OutBufferSize = 4</span></li><li class="hl_l1"><span class="hl_number">00517054</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">8D4C24</span>&nbsp;<span class="hl_number">10</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>LEA</b></span>&nbsp;<span class="hl_registr">ECX</span><span class="hl_char">,</span><span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_function"><b>PTR</b></span>&nbsp;<span class="hl_registr">SS</span><span class="hl_char">:</span><span class="hl_char">[</span><span class="hl_registr">ESP</span><span class="hl_char">+</span><span class="hl_number">10</span><span class="hl_char">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; |</span></li><li class="hl_l0"><span class="hl_number">00517058</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">51</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;<span class="hl_registr"><b>ECX</b></span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; |OutBuffer</span></li><li class="hl_l1"><span class="hl_number">00517059</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">6A</span>&nbsp;<span class="hl_number">04</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;<span class="hl_number">4</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; |InBufferSize = 4</span></li><li class="hl_l0"><span class="hl_number">0051705B</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">8D5424</span>&nbsp;<span class="hl_number">24</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>LEA</b></span>&nbsp;<span class="hl_registr">EDX</span><span class="hl_char">,</span><span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_function"><b>PTR</b></span>&nbsp;<span class="hl_registr">SS</span><span class="hl_char">:</span><span class="hl_char">[</span><span class="hl_registr">ESP</span><span class="hl_char">+</span><span class="hl_number">24</span><span class="hl_char">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; |</span></li><li class="hl_l1"><span class="hl_number">0051705F</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">52</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;<span class="hl_registr"><b>EDX</b></span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; |InBuffer</span></li><li class="hl_l0"><span class="hl_number">00517060</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">68</span>&nbsp;<span class="hl_number">0C28409C</span>&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;<span class="hl_number">9C40280C</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; |IoControlCode = 9C40280C</span></li><li class="hl_l1"><span class="hl_number">00517065</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">56</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;<span class="hl_registr"><b>ESI</b></span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; |hDevice</span></li><li class="hl_l0"><span class="hl_number">00517066</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;FF15&nbsp;<span class="hl_number">14C35F00</span>&nbsp;<span class="hl_function"><b>CALL</b></span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_function"><b>PTR</b></span>&nbsp;<span class="hl_registr">DS</span><span class="hl_char">:</span><span class="hl_char">[</span><span class="hl_char">&lt;</span><span class="hl_char">&amp;</span>KERNEL32<span class="hl_char">.</span>DeviceIoCo<span class="hl_char">&gt;</span><span class="hl_comment">; \DeviceIoControl</span></li><li class="hl_l1"><span class="hl_number">0051706C</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">84C0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>TEST</b></span>&nbsp;<span class="hl_registr">AL</span><span class="hl_char">,</span><span class="hl_registr">AL</span></li><li class="hl_l0"><span class="hl_number">0051706E</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">75</span>&nbsp;<span class="hl_number">0F</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>JNZ</b></span>&nbsp;<span class="hl_function"><b>SHORT</b></span>&nbsp;Virtual_<span class="hl_char">.</span><span class="hl_number">0051707F</span></li><li class="hl_l1"><span class="hl_number">00517070</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">56</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;<span class="hl_registr"><b>ESI</b></span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; /hObject</span></li><li class="hl_l0"><span class="hl_number">00517071</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;FF15&nbsp;C8C45F00&nbsp;<span class="hl_function"><b>CALL</b></span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_function"><b>PTR</b></span>&nbsp;<span class="hl_registr">DS</span><span class="hl_char">:</span><span class="hl_char">[</span><span class="hl_char">&lt;</span><span class="hl_char">&amp;</span>KERNEL32<span class="hl_char">.</span>CloseHandl<span class="hl_char">&gt;</span><span class="hl_comment">; \CloseHandle</span></li><li class="hl_l1"><span class="hl_number">00517077</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">&gt;</span>&nbsp;&nbsp;<span class="hl_number">83C8</span>&nbsp;FF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>OR</b></span>&nbsp;<span class="hl_registr">EAX</span><span class="hl_char">,</span>FFFFFFFF</li><li class="hl_l0"><span class="hl_number">0051707A</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">5E</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>POP</b></span>&nbsp;<span class="hl_registr">ESI</span></li><li class="hl_l1"><span class="hl_number">0051707B</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">83C4</span>&nbsp;<span class="hl_number">08</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>ADD</b></span>&nbsp;<span class="hl_registr">ESP</span><span class="hl_char">,</span><span class="hl_number">8</span></li><li class="hl_l0"><span class="hl_number">0051707E</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;C3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">RETN</span></li><li class="hl_l1"><span class="hl_number">0051707F</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">&gt;</span>&nbsp;&nbsp;<span class="hl_number">85FF</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>TEST</b></span>&nbsp;<span class="hl_registr">EDI</span><span class="hl_char">,</span><span class="hl_registr">EDI</span></li><li class="hl_l0"><span class="hl_number">00517081</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">74</span>&nbsp;<span class="hl_number">06</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>JE</b></span>&nbsp;<span class="hl_function"><b>SHORT</b></span>&nbsp;Virtual_<span class="hl_char">.</span><span class="hl_number">00517089</span></li><li class="hl_l1"><span class="hl_number">00517083</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">8B4424</span>&nbsp;<span class="hl_number">04</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>MOV</b></span>&nbsp;<span class="hl_registr">EAX</span><span class="hl_char">,</span><span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_function"><b>PTR</b></span>&nbsp;<span class="hl_registr">SS</span><span class="hl_char">:</span><span class="hl_char">[</span><span class="hl_registr">ESP</span><span class="hl_char">+</span><span class="hl_number">4</span><span class="hl_char">]</span></li><li class="hl_l0"><span class="hl_number">00517087</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">8907</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>MOV</b></span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_function"><b>PTR</b></span>&nbsp;<span class="hl_registr">DS</span><span class="hl_char">:</span><span class="hl_char">[</span><span class="hl_registr">EDI</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_registr">EAX</span></li><li class="hl_l1"><span class="hl_number">00517089</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">&gt;</span>&nbsp;&nbsp;<span class="hl_number">8BC6</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>MOV</b></span>&nbsp;<span class="hl_registr">EAX</span><span class="hl_char">,</span><span class="hl_registr">ESI</span></li><li class="hl_l0"><span class="hl_number">0051708B</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">5E</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>POP</b></span>&nbsp;<span class="hl_registr">ESI</span></li><li class="hl_l1"><span class="hl_number">0051708C</span>&nbsp;&nbsp;<span class="hl_char">|</span><span class="hl_char">.</span>&nbsp;&nbsp;<span class="hl_number">83C4</span>&nbsp;<span class="hl_number">08</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>ADD</b></span>&nbsp;<span class="hl_registr">ESP</span><span class="hl_char">,</span><span class="hl_number">8</span></li><li class="hl_l0"><span class="hl_number">0051708F</span>&nbsp;&nbsp;<span class="hl_char">\</span><span class="hl_char">.</span>&nbsp;&nbsp;C3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">RETN</span></li><li class="hl_l1">&nbsp;</li>        </ol>
    </div>
</div></div>
<br><br><br>После этого DeviceIoControl создается область в памяти с размером 2000 для которой нельзя поменять доступ (ПКМ &gt; Set access &gt; Full access),<br>нельзя поставить Breakpoint &gt; memory, on access. Указатель на область в памяти возвращается в OutBuffer.<br><br>Что делать , как поставить точку останова?<br><br><b>Добавлено спустя 1 час 1 минуту</b><br>00516C69 |. FFD7 CALL EDI ; \CreateFileA<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_number">0012FAC0</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">00516C6B</span>&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_function"><b>CALL</b></span>&nbsp;to&nbsp;CreateFileA&nbsp;from&nbsp;Virtual_<span class="hl_char">.</span><span class="hl_number">00516C69</span></li><li class="hl_l1"><span class="hl_number">0012FAC4</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">0063692C</span>&nbsp;&nbsp;<span class="hl_char">|</span>FileName&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_quote">&quot;\.\Global\VMM&quot;</span></li><li class="hl_l0"><span class="hl_number">0012FAC8</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">80000000</span>&nbsp;&nbsp;<span class="hl_char">|</span>Access&nbsp;<span class="hl_char">=</span>&nbsp;GENERIC_READ</li><li class="hl_l1"><span class="hl_number">0012FACC</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">00000001</span>&nbsp;&nbsp;<span class="hl_char">|</span>ShareMode&nbsp;<span class="hl_char">=</span>&nbsp;FILE_SHARE_READ</li><li class="hl_l0"><span class="hl_number">0012FAD0</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">00000000</span>&nbsp;&nbsp;<span class="hl_char">|</span>pSecurity&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function">NULL</span></li><li class="hl_l1"><span class="hl_number">0012FAD4</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">00000003</span>&nbsp;&nbsp;<span class="hl_char">|</span>Mode&nbsp;<span class="hl_char">=</span>&nbsp;OPEN_EXISTING</li><li class="hl_l0"><span class="hl_number">0012FAD8</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">40000080</span>&nbsp;&nbsp;<span class="hl_char">|</span>Attributes&nbsp;<span class="hl_char">=</span>&nbsp;NORMAL<span class="hl_char">|</span>OVERLAPPED</li><li class="hl_l1"><span class="hl_number">0012FADC</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">00000000</span>&nbsp;&nbsp;<span class="hl_char">\</span>hTemplateFile&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function">NULL</span></li>        </ol>
    </div>
</div></div>
<br>Возвращает 000001D4 File (dev) 3. 00120089 \Device\VMM<br><br><br><br><br>00516F93 |. FF15 78C35F00 CALL DWORD PTR DS:[&lt;&amp;KERNEL32.CreateFile&gt;; \CreateFileA<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_number">0012FCF0</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">00516F99</span>&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_function"><b>CALL</b></span>&nbsp;to&nbsp;CreateFileA&nbsp;from&nbsp;Virtual_<span class="hl_char">.</span><span class="hl_number">00516F93</span></li><li class="hl_l1"><span class="hl_number">0012FCF4</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">0063692C</span>&nbsp;&nbsp;<span class="hl_char">|</span>FileName&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_quote">&quot;\.\Global\VMM&quot;</span></li><li class="hl_l0"><span class="hl_number">0012FCF8</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">00000000</span>&nbsp;&nbsp;<span class="hl_char">|</span>Access&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span></li><li class="hl_l1"><span class="hl_number">0012FCFC</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">00000000</span>&nbsp;&nbsp;<span class="hl_char">|</span>ShareMode&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span></li><li class="hl_l0"><span class="hl_number">0012FD00</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">00000000</span>&nbsp;&nbsp;<span class="hl_char">|</span>pSecurity&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function">NULL</span></li><li class="hl_l1"><span class="hl_number">0012FD04</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">00000003</span>&nbsp;&nbsp;<span class="hl_char">|</span>Mode&nbsp;<span class="hl_char">=</span>&nbsp;OPEN_EXISTING</li><li class="hl_l0"><span class="hl_number">0012FD08</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">40000080</span>&nbsp;&nbsp;<span class="hl_char">|</span>Attributes&nbsp;<span class="hl_char">=</span>&nbsp;NORMAL<span class="hl_char">|</span>OVERLAPPED</li><li class="hl_l1"><span class="hl_number">0012FD0C</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">00000000</span>&nbsp;&nbsp;<span class="hl_char">\</span>hTemplateFile&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function">NULL</span></li>        </ol>
    </div>
</div></div>
<br>Возвращает 00000380 File (dev) 2. 00100080 \Device\VMM<br><br><br>В InBuffer помещено 000001D4<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_number">0012FCE8</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">00516FC6</span>&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_function"><b>CALL</b></span>&nbsp;to&nbsp;DeviceIoControl&nbsp;from&nbsp;Virtual_<span class="hl_char">.</span><span class="hl_number">00516FC4</span></li><li class="hl_l1"><span class="hl_number">0012FCEC</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">00000380</span>&nbsp;&nbsp;<span class="hl_char">|</span>hDevice&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">00000380</span></li><li class="hl_l0"><span class="hl_number">0012FCF0</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">9C402808</span>&nbsp;&nbsp;<span class="hl_char">|</span>IoControlCode&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">9C402808</span></li><li class="hl_l1"><span class="hl_number">0012FCF4</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">00678BC4</span>&nbsp;&nbsp;<span class="hl_char">|</span>InBuffer&nbsp;<span class="hl_char">=</span>&nbsp;Virtual_<span class="hl_char">.</span><span class="hl_number">00678BC4</span></li><li class="hl_l0"><span class="hl_number">0012FCF8</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">00000004</span>&nbsp;&nbsp;<span class="hl_char">|</span>InBufferSize&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">4</span></li><li class="hl_l1"><span class="hl_number">0012FCFC</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">00000000</span>&nbsp;&nbsp;<span class="hl_char">|</span>OutBuffer&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function">NULL</span></li><li class="hl_l0"><span class="hl_number">0012FD00</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">00000000</span>&nbsp;&nbsp;<span class="hl_char">|</span>OutBufferSize&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span></li><li class="hl_l1"><span class="hl_number">0012FD04</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">0012FD14</span>&nbsp;&nbsp;<span class="hl_char">|</span>pBytesReturned&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0012FD14</span></li><li class="hl_l0"><span class="hl_number">0012FD08</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">00000000</span>&nbsp;&nbsp;<span class="hl_char">\</span>pOverlapped&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function">NULL</span></li>        </ol>
    </div>
</div></div>
<br><br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_number">0012FBBC</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">00517044</span>&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_function"><b>CALL</b></span>&nbsp;to&nbsp;CreateFileA&nbsp;from&nbsp;Virtual_<span class="hl_char">.</span><span class="hl_number">0051703E</span></li><li class="hl_l1"><span class="hl_number">0012FBC0</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">0063692C</span>&nbsp;&nbsp;<span class="hl_char">|</span>FileName&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_quote">&quot;\.\Global\VMM&quot;</span></li><li class="hl_l0"><span class="hl_number">0012FBC4</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">00000000</span>&nbsp;&nbsp;<span class="hl_char">|</span>Access&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span></li><li class="hl_l1"><span class="hl_number">0012FBC8</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">00000000</span>&nbsp;&nbsp;<span class="hl_char">|</span>ShareMode&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span></li><li class="hl_l0"><span class="hl_number">0012FBCC</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">00000000</span>&nbsp;&nbsp;<span class="hl_char">|</span>pSecurity&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function">NULL</span></li><li class="hl_l1"><span class="hl_number">0012FBD0</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">00000003</span>&nbsp;&nbsp;<span class="hl_char">|</span>Mode&nbsp;<span class="hl_char">=</span>&nbsp;OPEN_EXISTING</li><li class="hl_l0"><span class="hl_number">0012FBD4</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">40000080</span>&nbsp;&nbsp;<span class="hl_char">|</span>Attributes&nbsp;<span class="hl_char">=</span>&nbsp;NORMAL<span class="hl_char">|</span>OVERLAPPED</li><li class="hl_l1"><span class="hl_number">0012FBD8</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">00000000</span>&nbsp;&nbsp;<span class="hl_char">\</span>hTemplateFile&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function">NULL</span></li>        </ol>
    </div>
</div></div>
<br>Возвращает 000003DC ....... \Device\VMM<br><br><br>И наконец  InBuffer помещается 00000380<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_number">0012FBB8</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">0051706C</span>&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_function"><b>CALL</b></span>&nbsp;to&nbsp;DeviceIoControl&nbsp;from&nbsp;Virtual_<span class="hl_char">.</span><span class="hl_number">00517066</span></li><li class="hl_l1"><span class="hl_number">0012FBBC</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">000003DC</span>&nbsp;&nbsp;<span class="hl_char">|</span>hDevice&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">000003DC</span></li><li class="hl_l0"><span class="hl_number">0012FBC0</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">9C40280C</span>&nbsp;&nbsp;<span class="hl_char">|</span>IoControlCode&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">9C40280C</span></li><li class="hl_l1"><span class="hl_number">0012FBC4</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">0012FBEC</span>&nbsp;&nbsp;<span class="hl_char">|</span>InBuffer&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0012FBEC</span></li><li class="hl_l0"><span class="hl_number">0012FBC8</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">00000004</span>&nbsp;&nbsp;<span class="hl_char">|</span>InBufferSize&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">4</span></li><li class="hl_l1"><span class="hl_number">0012FBCC</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">0012FBE0</span>&nbsp;&nbsp;<span class="hl_char">|</span>OutBuffer&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0012FBE0</span></li><li class="hl_l0"><span class="hl_number">0012FBD0</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">00000004</span>&nbsp;&nbsp;<span class="hl_char">|</span>OutBufferSize&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">4</span></li><li class="hl_l1"><span class="hl_number">0012FBD4</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">0012FBE4</span>&nbsp;&nbsp;<span class="hl_char">|</span>pBytesReturned&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0012FBE4</span></li><li class="hl_l0"><span class="hl_number">0012FBD8</span>&nbsp;&nbsp;&nbsp;<span class="hl_number">00000000</span>&nbsp;&nbsp;<span class="hl_char">\</span>pOverlapped&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function">NULL</span></li>        </ol>
    </div>
</div></div>
<br>В OutBuffer возвращается указатель на искомый память.<br><br><br><b>Добавлено спустя 1 час 46 минут</b><br>Потом в эту память идет чтения жесткого диска виртуальной машины (файла *.vhd )<br><br>0050B593   Virtual_   Disabled                   CALL DWORD PTR DS:[&lt;&amp;KERNEL32.ReadFile&gt;]              0reading vhd<br><br>004FDF47   Virtual_   Disabled                   MOV DWORD PTR SS:[ESP+20],EAX                         1coping to stack (0012FC6C)<br><br>005C0A68   Virtual_   Disabled                   MOV AL,BYTE PTR DS:[ESI]                              2coping to OutBuffer^
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=352613&amp;user=21986&amp;forum_n=5&amp;topic=23435.html&amp;page=0&amp;anchor=11" class="addthx" data-post="352613"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]volopas[/b]','')">volopas</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.8 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.92'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=21986">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 14 марта 2015 19:15 &middot; Поправил: volopas <br><script type="text/javascript">QU('volopas','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=volopas" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23435.html&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
В файле VMM.sys есть подозрительные строки , которые почему-то находятся в секции .data<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_number">00000240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">2E</span>&nbsp;<span class="hl_number">64</span>&nbsp;<span class="hl_number">61</span>&nbsp;<span class="hl_number">74</span><span class="hl_char">&gt;</span>ASCII&nbsp;<span class="hl_quote">&quot;.data&quot;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; SECTION</span></li><li class="hl_l1"><span class="hl_number">00000248</span>&nbsp;&nbsp;&nbsp;&nbsp;F0A30000&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DD</b></span>&nbsp;<span class="hl_number">0000A3F0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;  VirtualSize = A3F0 (41968.)</span></li><li class="hl_l0"><span class="hl_number">0000024C</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">00900200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DD</b></span>&nbsp;<span class="hl_number">00029000</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;  VirtualAddress = 29000</span></li><li class="hl_l1"><span class="hl_number">00000250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">008C0000</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DD</b></span>&nbsp;<span class="hl_number">00008C00</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;  SizeOfRawData = 8C00 (35840.)</span></li><li class="hl_l0"><span class="hl_number">00000254</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">007E0200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DD</b></span>&nbsp;<span class="hl_number">00027E00</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;  PointerToRawData = 27E00</span></li><li class="hl_l1"><span class="hl_number">00000258</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">00000000</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DD</b></span>&nbsp;<span class="hl_number">00000000</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;  PointerToRelocations = 0</span></li><li class="hl_l0"><span class="hl_number">0000025C</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">00000000</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DD</b></span>&nbsp;<span class="hl_number">00000000</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;  PointerToLineNumbers = 0</span></li><li class="hl_l1"><span class="hl_number">00000260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">0000</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DW</b></span>&nbsp;<span class="hl_number">0000</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;  NumberOfRelocations = 0</span></li><li class="hl_l0"><span class="hl_number">00000262</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">0000</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DW</b></span>&nbsp;<span class="hl_number">0000</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;  NumberOfLineNumbers = 0</span></li><li class="hl_l1"><span class="hl_number">00000264</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">400000C8</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DD</b></span>&nbsp;C8000040&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;  Characteristics = INITIALIZED_DATA|NOT_PAGED|READ|WRITE</span></li>        </ol>
    </div>
</div></div>
<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_number">0002BF2E</span>&nbsp;<span class="hl_number">2E</span><span class="hl_char">:</span><span class="hl_number">8038</span>&nbsp;<span class="hl_number">0F</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>CMP</b></span>&nbsp;<span class="hl_function"><b>BYTE</b></span>&nbsp;<span class="hl_function"><b>PTR</b></span>&nbsp;<span class="hl_registr">CS</span><span class="hl_char">:</span><span class="hl_char">[</span><span class="hl_registr">EAX</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_number">0F</span></li><li class="hl_l1"><span class="hl_number">0002BF32</span>&nbsp;<span class="hl_number">0F85</span>&nbsp;<span class="hl_number">88010000</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>JNZ</b></span>&nbsp;<span class="hl_number">0002C0C0</span></li><li class="hl_l0"><span class="hl_number">0002BF38</span>&nbsp;<span class="hl_number">2E</span><span class="hl_char">:</span><span class="hl_number">8078</span>&nbsp;<span class="hl_number">01</span>&nbsp;C7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>CMP</b></span>&nbsp;<span class="hl_function"><b>BYTE</b></span>&nbsp;<span class="hl_function"><b>PTR</b></span>&nbsp;<span class="hl_registr">CS</span><span class="hl_char">:</span><span class="hl_char">[</span><span class="hl_registr">EAX</span><span class="hl_char">+</span><span class="hl_number">1</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_number">0C7</span></li><li class="hl_l1"><span class="hl_number">0002BF3D</span>&nbsp;<span class="hl_number">75</span>&nbsp;<span class="hl_number">0B</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>JNZ</b></span>&nbsp;<span class="hl_function"><b>SHORT</b></span>&nbsp;<span class="hl_number">0002BF4A</span></li><li class="hl_l0"><span class="hl_number">0002BF3F</span>&nbsp;<span class="hl_number">2E</span><span class="hl_char">:</span><span class="hl_number">8078</span>&nbsp;<span class="hl_number">02</span>&nbsp;C8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>CMP</b></span>&nbsp;<span class="hl_function"><b>BYTE</b></span>&nbsp;<span class="hl_function"><b>PTR</b></span>&nbsp;<span class="hl_registr">CS</span><span class="hl_char">:</span><span class="hl_char">[</span><span class="hl_registr">EAX</span><span class="hl_char">+</span><span class="hl_number">2</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_number">0C8</span></li><li class="hl_l1"><span class="hl_number">0002BF44</span>&nbsp;<span class="hl_number">0F84</span>&nbsp;DA010000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>JE</b></span>&nbsp;<span class="hl_number">0002C124</span></li><li class="hl_l0"><span class="hl_number">0002BF4A</span>&nbsp;<span class="hl_number">2E</span><span class="hl_char">:</span><span class="hl_number">8078</span>&nbsp;<span class="hl_number">01</span>&nbsp;<span class="hl_number">3F</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>CMP</b></span>&nbsp;<span class="hl_function"><b>BYTE</b></span>&nbsp;<span class="hl_function"><b>PTR</b></span>&nbsp;<span class="hl_registr">CS</span><span class="hl_char">:</span><span class="hl_char">[</span><span class="hl_registr">EAX</span><span class="hl_char">+</span><span class="hl_number">1</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_number">3F</span></li><li class="hl_l1"><span class="hl_number">0002BF4F</span>&nbsp;<span class="hl_number">0F85</span>&nbsp;<span class="hl_number">6B010000</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>JNZ</b></span>&nbsp;<span class="hl_number">0002C0C0</span></li>        </ol>
    </div>
</div></div>
<br>Если меняю в стравнении 3F на допустим 3E, зануляю 8 байт по смещению &#036;190 (цифровая подпись) , меняю CheckSum по смещению &#036;150 , подсовываю патченный драйвер в C:\WINDOWS\system32\drivers\ , то виртуальная машина не стартует (консоль запускается , но при попытке стартануть машину, появляется черное окно гостевой ОС (даже в биос не заходит) , Virtual PC.exe грузит проц 100 % и ничего не происходит)<br><br><b>Добавлено спустя 4 часа 9 минут</b><br>Следующим пропатчиванием удалось добиться на первый взгляд стабильной работы <br>0002BF92    75 05           JNZ SHORT 0002BF99<br>0002BF92    9090          nop<br>Видимо, как указано в статье https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23441 , эти опкоды используются не только для выявления виртуальной машины, но и для нужд BIOS. Поэтому видимо биос и не загружался.<br><br>Но существует опасность , що все-таки этим пропатчиванием работа машины может быть нарушена. Поэтому нужна помощь специалистов.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=353008&amp;user=21986&amp;forum_n=5&amp;topic=23435.html&amp;page=0&amp;anchor=12" class="addthx" data-post="353008"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]volopas[/b]','')">volopas</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.8 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.92'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=21986">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 16 марта 2015 14:32 &middot; Поправил: volopas <br><script type="text/javascript">QU('volopas','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=volopas" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23435.html&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
Пришлось столкнутся с проблемой несрабатывания остановов на код драйвера в ядре . Такое может быть ? Какие есть стандартные способы отловить этот момент?<br><br>https://exelab.ru/f/action=vthread&amp;forum=3&amp;topic=17835&amp;page=1#26<br><br>Пробовалось ставить EB FE и СС . Безрезультатно. EB FE просто вешает систему. СС - идет появляется окно ошибки (не MessageBox) <br>Virtual PC <br>---------------------<br>An internal vitrual machine error (3) has occured.<br> The virtual machine will reset now.<br><br><b>Добавлено спустя 15 минут</b><br>Конкретно не срабатывает брейкпоинт на <br>0002BF2E 2E:8038 0F        CMP BYTE PTR CS:[EAX],0F<br>(указан адрес RAW-data. )<br>драйвера vmm.sys.<br><br><b>Добавлено спустя 16 минут</b><br>Просто спецы говорили , что напр. ReadFile работает в ядре и отловить невозможно. А теперь я отлаживаю ядро. В чем опять проблема?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=353065&amp;user=21986&amp;forum_n=5&amp;topic=23435.html&amp;page=0&amp;anchor=13" class="addthx" data-post="353065"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]volopas[/b]','')">volopas</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.8 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.92'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=21986">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 марта 2015 07:57 &middot; Поправил: volopas <br><script type="text/javascript">QU('volopas','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=volopas" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=5&amp;topic=23435.html&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
Специалисты, вы где?<br><br>Вот список процедур драйвера . Какие из них могут провоцировать несрабатывание остановов?<br>ExAllocatePoolWithTag<br>KeClearEvent<br>IoDeleteSymbolicLink<br>ExFreePoolWithTag<br>IoSetDeviceInterfaceState (не стабатывает)<br>RtlInitUnicodeString<br>IoDeleteDevice<br>KeSetEvent (срабатывает слишком часто. Оттрассировать трудно.)<br>KeInitializeEvent<br>IoDetachDevice (не стабатывает)<br>PoSetPowerState<br>RtlFreeUnicodeString<br>IofCompleteRequest (срабатывает слишком часто. Оттрассировать трудно.)<br>KeWaitForSingleObject<br>IoCreateSymbolicLink<br>RtlCopyUnicodeString<br>IoCreateDevice (не срабатывает)<br>IoReleaseCancelSpinLock<br>IofCallDriver<br>IoFreeWorkItem<br>PoRequestPowerIrp<br>IoAllocateWorkItem (Не срабатывает)<br>PoStartNextPowerIrp<br>PoCallDriver<br>IoQueueWorkItem<br>memmove   (срабатывает слишком часто. Оттрассировать трудно.)<br>MmUnmapIoSpace<br>MmMapIoSpace (срабатывает 2 раза, но память 2e 80 38 0f используется после этих 2 срабатываний)<br>MmUnmapLockedPages<br>MmMapLockedPagesSpecifyCache (срабатывает слишком часто. Оттрассировать трудно.)<br>IoBuildPartialMdl (5-6 срабатывание??)<br>MmAllocatePagesForMdl (срабатывает слишком часто. Оттрассировать трудно.)<br>KeQuerySystemTime<br>MmFreePagesFromMdl<br>KeSetImportanceDpc (срабатывает слишком часто. Оттрассировать трудно.)<br>KeRemoveQueueDpc<br>KeInitializeDpc<br>IoFileObjectType<br>ObReferenceObjectByHandle<br>ObfDereferenceObject<br>IoFreeMdl<br>MmGetPhysicalAddress (срабатывает слишком часто. Оттрассировать трудно.)<br>MmProbeAndLockPages (срабатывает слишком часто. Оттрассировать трудно.)<br>MmUnlockPages (срабатывает слишком часто. Оттрассировать трудно.)<br>IoAllocateMdl (срабатывает слишком часто. Оттрассировать трудно.)<br>IoWMIRegistrationControl<br>KeSetTargetProcessorDpc<br>KeQueryActiveProcessors<br>KeDelayExecutionThread<br>KeInsertQueueDpc<br>KeQueryTimeIncrement<br>KeTickCount<br>ExRaiseStatus (не срабатывает)<br>ExfInterlockedRemoveHeadList<br>ExfInterlockedInsertHeadList<br>MmFreeContiguousMemorySpecifyCache<br>ZwQueryValueKey<br>ZwClose<br>KeNumberProcessors<br>MmAllocateContiguousMemorySpecifyCache (Не срабатывает)<br>AllocateContiguousMemorySpecifyCache<br>ZwOpenKey<br><br>DbgPrint<br>ExUnregisterCallback<br>ExRegisterCallback<br>ExCreateCallback (Не срабатывает)<br>DbgBreakPoint (Не срабатывает)<br>MmFreeContiguousMemory<br>MmFreeMappingAddress<br>MmAllocateMappingAddress (Не срабатывает)<br>MmAllocateContiguousMemory (Не срабатывает)<br> <br><br>KfAcquireSpinLock (Не срабатывает)<br>KfReleaseSpinLock<br>ExReleaseFastMutex<br>ExAcquireFastMutex<br>KeGetCurrentIrql<br>KfLowerIrql<br>KfRaiseIrql<br><br>RtlAnsiCharToUnicodeChar (Не срабатывает)<br>KeBugCheckEx (Не срабатывает)<br>memset (срабатывает слишком часто. Оттрассировать трудно.)<br>_aullshr<br>memcpy (срабатывает слишком часто. Оттрассировать трудно.)<br>_allmul<br>_allshl<br>_alldiv<br>RtlUnwind<br><br><b>Добавлено спустя 19 минут</b><br>после этих остановов появляется наг про An internal vitrual machine error (3) has occured.<br>Virtual PC.exe <br>004FE470   Virtual_   Always                     PUSH -0x1<br>004FE565   Virtual_   Always                     CALL Virtual_.004CC320
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=353112&amp;user=21986&amp;forum_n=5&amp;topic=23435.html&amp;page=0&amp;anchor=14" class="addthx" data-post="353112"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/nub.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=5&sortBy=0&page=0.html"><b>Вопросы новичков</b></a> <b class=bulletHead>&#8212;&#8250;</b> Не срабатывают никакие остановы. OllyDBG 1.10</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#15" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="5">
<input type="hidden" name="topic" value="23435">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=23435" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
