<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Несколько слов про обфускацию - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Здавтсвуйте, товарищи. Хотел обсудить неторые вопросы, связанные с обфускацией софта. Представим, что у нас есть пермутация с генератором случайных чисел. Причём мутатор проходит код не один раз, а, скажем, раз 1000. В общем,">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=1288'>UniSoft</a>, <a target='_blank' href='?action=userinfo&amp;user=55953'>laslo</a>, <a target='_blank' href='?action=userinfo&amp;user=26261'>bartolomeo</a> (+5 невидимых)</b></span>
</td>
</tr>
</table>

 

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Несколько слов про обфускацию</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]ARCHANGEL[/b]','')">ARCHANGEL</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/6336.png" alt=""><br><span class=txtSm>Ранг: 681.5 <font color=magenta>(<b>! !</b>)</font>, 405thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.85'>Активность: 0.42<span style='color:red'>&searr;</span>0.21</span><br>Статус: <a href="action=userinfo&amp;user=6336">Участник</a><br><font color=blue>ALIEN Hack Team</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 ноября 2011 23:58 &middot; Поправил: ARCHANGEL <br><script type="text/javascript">QU('ARCHANGEL','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ARCHANGEL" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19277.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Здавтсвуйте, товарищи. Хотел обсудить неторые вопросы, связанные с обфускацией софта. Представим, что у нас есть пермутация с генератором случайных чисел. Причём мутатор проходит код не один раз, а, скажем, раз 1000. В общем, многократно. Допустим, на входе у нас было:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>xor</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l1"><span class="hl_function"><b>inc</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l0"><span class="hl_function">retn</span></li>        </ol>
    </div>
</div></div>
<br><br>После первого прохода:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1"><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">esp</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_number">0</span></li><li class="hl_l0"><span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1"><span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_number">2</span></li><li class="hl_l0"><span class="hl_function"><b>dec</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1"><span class="hl_function">retn</span></li>        </ol>
    </div>
</div></div>
<br><br>Это была чистая мутация, т.е. не было ни одной мусорной инструкции, просто одни инструкции заменялись другими по определённому набору правил. Грубо говоря, у нас в мутаторе есть некое множество инструкций <b>А</b>, которые могут подвергаться мутации. Каждый элемент такого множества расширяется до алгебры, т.е. <b>для всех a, принадлежащих А, носитель состоит из а</b>, сигнатура задаётся конечным, пусть и не очень большим (порядка 5-10 элементов) множеством. Таким образом, имеем множество алгебр <b>В | {b[i],sign}</b>. Т.е. пока всё вполне реально запрограммировать. <br><br>Идём дальше, известно, что шаг пермутатора - мутация с последующим добавлением мусора. Мусор тоже самый примитивный - nop; mov eax,eax; pushfd+popfd и т.д. Т.е. нет цели косить под компиляторы, под другие проты и т.д. Возвращаясь к нашему примеру выше, понятно, что это - только мутация, мутация с мусором выглядела бы вот так:<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function">nop</span></li><li class="hl_l1"><span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l0"><span class="hl_function"><b>xchg</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">edx</span></li><li class="hl_l1"><span class="hl_function"><b>xchg</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">edx</span></li><li class="hl_l0"><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">esp</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_number">0</span></li><li class="hl_l1"><span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l0"><span class="hl_function">pushfd</span></li><li class="hl_l1"><span class="hl_function">popfd</span></li><li class="hl_l0"><span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_number">2</span></li><li class="hl_l1"><span class="hl_function"><b>inc</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l0"><span class="hl_function"><b>dec</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1"><span class="hl_function"><b>dec</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l0"><span class="hl_function">retn</span></li>        </ol>
    </div>
</div></div>
<br><br>И этого следует, что генертор мусора просто делает случайную (на основе генератора случайных чисел) выборку из некоего множества инструкций <b>С</b>. Элементы множества - не обязательно отдельные инструкции, это могут быть пары, тройки и т.д. При одном проходе пермутирующего движка следует вначале вычистить мусор, потом по заранее определённым правилам выполнить обратные преобразования кода. Предположим, что однократное наложение пермутации полностью обратимо. <br><br>Идём дальше, когда пермутация накладывается многократно, мусор, добавленный во время предыдущих проходов, также мутирует. Это приводит к тому, что паттерны, годные для детекта чистого мусора, становятся непригодными. <br><br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr"><b>eax</b></span>&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_function">nop</span></li><li class="hl_l1"><span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l0"><span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr"><b>ecx</b></span>&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1"><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l0"><span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1"><span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">ecx</span></li><li class="hl_l0"><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l1"><span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr"><b>eax</b></span>&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_function"><b>xchg</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">edx</span></li><li class="hl_l0"><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">edx</span></li><li class="hl_l1"><span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_registr">edx</span></li><li class="hl_l0"><span class="hl_function"><b>xchg</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr"><b>edx</b></span>&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;не&nbsp;мутирует</li><li class="hl_l1"><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">esp</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_number">0</span>&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;для&nbsp;простоты&nbsp;остальные&nbsp;инструкции<span class="hl_char">,</span>&nbsp;якобы<span class="hl_char">,</span>&nbsp;не&nbsp;мутируют</li><li class="hl_l0"><span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1"><span class="hl_function">pushfd</span></li><li class="hl_l0"><span class="hl_function">popfd</span></li><li class="hl_l1"><span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_number">2</span></li><li class="hl_l0"><span class="hl_function"><b>inc</b></span>&nbsp;eac</li><li class="hl_l1"><span class="hl_function"><b>dec</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l0"><span class="hl_function"><b>dec</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1"><span class="hl_function">retn</span></li>        </ol>
    </div>
</div></div>
<br><br>Более того, движок пермутатора сохраняет информацию о мутирующих командах, т.е. он знает, что<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr"><b>eax</b></span>&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">edx</span></li><li class="hl_l0"><span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_registr">edx</span></li>        </ol>
    </div>
</div></div>
<br><br>это одна команда xchg eax,edx и может вставить мусор в середину такой команды. Например:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr"><b>eax</b></span>&nbsp;</li><li class="hl_l1"><span class="hl_function">pushfd</span></li><li class="hl_l0"><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">edx</span></li><li class="hl_l1"><span class="hl_function">popfd</span></li><li class="hl_l0"><span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_registr">edx</span></li>        </ol>
    </div>
</div></div>
<br><br>Т.е. на стадии мутации всегда есть структуры, описывающие отдельные команды, и мутатор знает, в  какую конструкцию можно вставить дополнительные инструкции. Естественно, в финальном приложении эта структура будет недоступна. <br><br>К чему я веду. К тому, что в результате таких преобразований наступает момент, когда теряется возможность отделить мусор от немусора, т.к. нельзя сформировать чёткие правила. Структура инструкции дополняется новыми инструкциями, положения которых случайны. Внимание, вопрос - есть ли способ такое заломать после 1000 проходов пермутации?
<br><br><font size="1"><i>-----<br>Stuck to the plan, always think that we would stand up, never ran.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=295764&amp;user=6336&amp;forum_n=6&amp;topic=19277.html&amp;page=0&amp;anchor=1" class="addthx" data-post="295764"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]r_e[/b]','')">r_e</a></b><br></div>
<img src="img/s8.gif" alt=""><br><span class=txtSm>Ранг: 590.6 (<b>!</b>), 408thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.08'>Активность: 0.36<span style='color:red'>&searr;</span>0.18</span><br>Статус: <a href="action=userinfo&amp;user=11966">Модератор</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 ноября 2011 00:29 <br><script type="text/javascript">QU('r_e','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=r_e" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19277.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
Отслеживать data flow, затем анализировать независимые части. Например:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr"><b>eax</b></span>&nbsp;</li><li class="hl_l1"><span class="hl_function">pushfd</span></li><li class="hl_l0"><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">edx</span></li><li class="hl_l1"><span class="hl_function">popfd</span></li><li class="hl_l0"><span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_registr">edx</span></li>        </ol>
    </div>
</div></div>
<br>Был бы разнесен в<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function">pushfd</span></li><li class="hl_l1"><span class="hl_function">popfd</span></li>        </ol>
    </div>
</div></div>
<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr"><b>eax</b></span>&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">edx</span></li><li class="hl_l0"><span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_registr">edx</span></li>        </ol>
    </div>
</div></div>
<br>После чего первый блок был бы удален, как вырожденный,  а второй переходит на вторую итерацию.
<br><br><font size="1"><i>-----<br>старый пень</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=295770&amp;user=11966&amp;forum_n=6&amp;topic=19277.html&amp;page=0&amp;anchor=2" class="addthx" data-post="295770"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]reversecode[/b]','')">reversecode</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/15381.gif" alt=""><br><span class=txtSm>Ранг: 1053.6 <b><u>(!!!!)</u></b>, 1078thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.43'>Активность: 1.06<span style='color:red'>&searr;</span>0.81</span><br>Статус: <a href="action=userinfo&amp;user=15381">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 ноября 2011 00:31 &middot; Поправил: reversecode <br><script type="text/javascript">QU('reversecode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=reversecode" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19277.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
<I>ARCHANGEL пишет:<br>Внимание, вопрос - есть ли способ такое заломать после 1000 проходов пермутации?  </I><br>что подразумевается под этим?<br>если преобразовать в относительно базовый(начальный вид)<br>то теоретически возможно<br>на практике хз, я из инструментов знаю только<br>hexrays, где ильфак заявлял что в версии 1.6 какая то обфускация будет обрабатыватся и приводится к базовому виду - хз у кого есть уже 1.6 проверте<br><br>и второй инструмент это скрипты на питоне optimize, все для тойже ida<br>я не проверял но на картинках они вроде какую то простую обфускацию снимают
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=295771&amp;user=15381&amp;forum_n=6&amp;topic=19277.html&amp;page=0&amp;anchor=3" class="addthx" data-post="295771"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]daFix[/b]','')">daFix</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/2777.gif" alt=""><br><span class=txtSm>Ранг: 529.0 (<b>!</b>), 110thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.75'>Активность: 0.29<span style='color:red'>&searr;</span>0.04</span><br>Статус: <a href="action=userinfo&amp;user=2777">Участник</a><br><font color=blue>5KRT</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 ноября 2011 00:32 &middot; Поправил: daFix <br><script type="text/javascript">QU('daFix','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=daFix" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19277.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
Тут уже нужен мощный оптимизатор. Долго думал как бороться с этим, но до реализации не доходило.<br>В любом случае тут нужен эмулятор кода с последующим анализом состояний процесса после выполнения каждой комманды.<br>Критерии анализа конкретно для вашего кода:<br><b>1.</b>Проверяем с каким регистром работаем. Если несколько комманд подряд работают с одним и тем-же регистром, тогда выделяем блок комманд и оптимизируем его. Для этого как-же потребуется эмулятор.<br><b>2.</b>Смотрим взаимоисключаемые инструкции. Для этого шага так-же потребуется эмулятор.<br><br>И эти два шага крутить очень долго, пока код не свернётся. Но тут надо придумать по каким критериям выбирать участки для анализа. <br>Это только мои размышления на эту тему, не надо ругаться<br><br>Помню, где-то советовали подсовывать код в компиляторы от майкрософта так как в них есть оптимизация и код на выходе будет уже почище <br><br>Поправь &quot;<b>inc eac</b>&quot;
<br><br><font size="1"><i>-----<br>Research For Food</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=295772&amp;user=2777&amp;forum_n=6&amp;topic=19277.html&amp;page=0&amp;anchor=4" class="addthx" data-post="295772"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=6336" title="17-11-2011 20:36, ранг:367.5" target="_blank">ARCHANGEL</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]vden[/b]','')">vden</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 112.9 (ветеран), 186thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.22'>Активность: 0.09<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=28841">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 ноября 2011 00:34 &middot; Поправил: vden <br><script type="text/javascript">QU('vden','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=vden" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19277.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
&lt;ИМХО&gt;Можно например так: перевести исследуемую функцию с асма в промежуточный код. Применить оптимизации: удаление мёртвых переменных, распространение переменных/констант (в цикле, пока возможно). То что получиться можно изучать или перевести в асм. Но этот метод затратный по времени как написания самого движка так и его работы. К примеру мой неоптимизированный движок 1000 инструкций обрабатывал около 5 сек, что мне кажется долго. В некоторых протекторах двухлетней давности очистка была довольно хорошая. Правда там замусоривание и на глаз было видно.&lt;/ИМХО&gt;<br><br>upd. вообщем-то это уже до меня сказали<br><br>upd2. естественно нужно отслеживать стек, поток данных и поток кода. если есть полиморф то больше вручную придётся.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=295773&amp;user=28841&amp;forum_n=6&amp;topic=19277.html&amp;page=0&amp;anchor=5" class="addthx" data-post="295773"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]ARCHANGEL[/b]','')">ARCHANGEL</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/6336.png" alt=""><br><span class=txtSm>Ранг: 681.5 <font color=magenta>(<b>! !</b>)</font>, 405thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.85'>Активность: 0.42<span style='color:red'>&searr;</span>0.21</span><br>Статус: <a href="action=userinfo&amp;user=6336">Участник</a><br><font color=blue>ALIEN Hack Team</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 ноября 2011 00:35 <br><script type="text/javascript">QU('ARCHANGEL','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ARCHANGEL" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19277.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
<b>r_e</b><br>Это потому, что вам известен размер конкретного блока. А теперь представьте, что вам не даны ни начало блока, ни его размер. Возьмёте слишком короткий блок - не захватите <br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function">popfd</span></li><li class="hl_l1"><span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_registr">edx</span></li>        </ol>
    </div>
</div></div>
<br><br>Возьмёте слишком длинный - в анализ могут попасть другие мусорные инструкции, которые выполняют операции с регистром флагов, типа, мусорных cld и т.д. И как в таком случае отличить вырожденный от невырожденного?
<br><br><font size="1"><i>-----<br>Stuck to the plan, always think that we would stand up, never ran.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=295774&amp;user=6336&amp;forum_n=6&amp;topic=19277.html&amp;page=0&amp;anchor=6" class="addthx" data-post="295774"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]ARCHANGEL[/b]','')">ARCHANGEL</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/6336.png" alt=""><br><span class=txtSm>Ранг: 681.5 <font color=magenta>(<b>! !</b>)</font>, 405thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.85'>Активность: 0.42<span style='color:red'>&searr;</span>0.21</span><br>Статус: <a href="action=userinfo&amp;user=6336">Участник</a><br><font color=blue>ALIEN Hack Team</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 ноября 2011 00:56 <br><script type="text/javascript">QU('ARCHANGEL','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ARCHANGEL" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19277.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
<b>reversecode пишет:</b><br><i class=x>что подразумевается под этим?<br>если преобразовать в относительно базовый(начальный вид)</i><br><br>Именно.<br><br><b>daFix пишет:</b><br><i class=x>Тут уже нужен мощный оптимизатор.</i><br><br>Что бы по этому поводу стоящее почитать?<br><br><i class=x>Для этого шага так-же потребуется эмулятор.</i><br><br>Это вообще интерес - они вообще нормальные в природе есть?
<br><br><font size="1"><i>-----<br>Stuck to the plan, always think that we would stand up, never ran.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=295777&amp;user=6336&amp;forum_n=6&amp;topic=19277.html&amp;page=0&amp;anchor=7" class="addthx" data-post="295777"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]daFix[/b]','')">daFix</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/2777.gif" alt=""><br><span class=txtSm>Ранг: 529.0 (<b>!</b>), 110thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.75'>Активность: 0.29<span style='color:red'>&searr;</span>0.04</span><br>Статус: <a href="action=userinfo&amp;user=2777">Участник</a><br><font color=blue>5KRT</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 ноября 2011 01:02 &middot; Поправил: daFix <br><script type="text/javascript">QU('daFix','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=daFix" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19277.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
<I>ARCHANGEL пишет:<br>Это вообще интерес - они вообще нормальные в природе есть? </I><br>Кто-то из тутошних гуру точно кодил эмуль, думаю что он тут отпишется. Вроде даже <b>bowrouco</b><br><br><I>ARCHANGEL пишет:<br>Что бы по этому поводу стоящее почитать? </I><br><b>mak</b> раньше тут выдавал тонны теории по этому поводу, но она далека от реализации была. <br>Сейчас попробую найти одну старую тему, где было много интересных мыслей было<br><br><b>ADDED:</b><br>Интересное по теме <noindex><a href="http://bg.exelab.ru/f/action=vthread&amp;forum=3&amp;topic=15312" rel="nofollow" target="_blank">--&gt; ТЫЦ &lt;--</a></noindex><br><br>Вот она!<br>https://ssl.exelab.ru/f/action=vthread&amp;forum=6&amp;topic=13288&amp;page=0
<br><br><font size="1"><i>-----<br>Research For Food</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=295778&amp;user=2777&amp;forum_n=6&amp;topic=19277.html&amp;page=0&amp;anchor=8" class="addthx" data-post="295778"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]bowrouco[/b]','')">bowrouco</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 47.7 (посетитель), 17thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.01'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29629">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 ноября 2011 01:52 <br><script type="text/javascript">QU('bowrouco','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=bowrouco" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19277.html&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
<b>ARCHANGEL</b><br><br>То что вы описали это не пермутация, а самый простой морфинг. Пермутация заключается в декомпиляции кода - он описывается некоторым языком, далее этот код изменяется и компилируется. Например генерация этого так скажем псевдокода из тела, изменение его и компиляция также не пермутация - это метаморфизм.<br><br>&gt; Более того, движок пермутатора сохраняет информацию о мутирующих командах, т.е. он знает, что..<br><br>Это очень просто решается. Нужны две процедуры. dREGS и dFLAGS. Каждая из них состоит из двух процедур, например INEFLAGS и OUTEFLAGS - это проверяемые и изменяемые флаги. Также и для регистров. Это базовая информация, которую возвращает дизасм. Далее граф анализируется(если не вдаваться в подробности, то это обход всех ветвей от указанной инструкции и определение тех самых dREGS - факт того, что регистр изменяется), если не используются некоторые регистры, то их можно использовать для мусора - это холостые инстуркции. Таким же образом паразитные инструкции удаляются. Если инструкция изменяет регистр, а далее значение этого регситра не используется, а он вновь изменяется, то это паразитная инструкция. Таких условий можно множество задать, по ним находятся блоки удовлетворяющие условиям и удаляются.<br><br>Например push eax/pop eax - значение регситра eax не используется, так как оно обратно в тотже регистр загружается со стека. Это определяется балансом стека.<br><br>push eax/mov eax,edx/pop edx - аналог находится в графе по источнику и изменяемым регистрам. Но это уже требует в нормальном случае описание псевдокодом, тоесть декомпиляцию, иначе просто обработка по таблицам всех условий не эффективна. В промежуточном варианте можно ввести в граф псевдоописатели, тогда такой блок удаляется и на его место вставляется описатель, который идентифицирует каким либо образом этот обмен.<br><br>В общем задача эта весьма сложная. У пермутации есть недостаток - в каждом покалении размер кода сильно растёт, именно изза сложности отделения мусора.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=295783&amp;user=29629&amp;forum_n=6&amp;topic=19277.html&amp;page=0&amp;anchor=9" class="addthx" data-post="295783"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]reversecode[/b]','')">reversecode</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/15381.gif" alt=""><br><span class=txtSm>Ранг: 1053.6 <b><u>(!!!!)</u></b>, 1078thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.43'>Активность: 1.06<span style='color:red'>&searr;</span>0.81</span><br>Статус: <a href="action=userinfo&amp;user=15381">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 ноября 2011 03:04 &middot; Поправил: reversecode <br><script type="text/javascript">QU('reversecode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=reversecode" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19277.html&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
то что описал клерк делает хексрейс, тоесть построение графа+REGS+FLAGS+оптимизация<br>и вот етап оптимизации и выбрасывает не нужные инструкции или приводит их в базовому виду<br>но судить насколько он этот оптимизатор продвинут пока сложно, я пока приостановил реверс хр<br>но сам хексрей в плагинах перед преобразованием в спевдокод<br>выбрасывает массив mbl_array_t который содержит оптимизированый псевдо asm<br>некоторые данны этого массива определить удалось некоторые нет<br><br>да и в принципе декомпиль Vamit-a тоже где то на таких приципах REGS/FLAGS построен<br>с графами вот не знаю есть или нет у него<br>ветвления обрабатываются наверняка<br>но ветвления это не совсем графы<br><br>так что задача в полне посильна и реализуема
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=295787&amp;user=15381&amp;forum_n=6&amp;topic=19277.html&amp;page=0&amp;anchor=10" class="addthx" data-post="295787"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]PE_Kill[/b]','')">PE_Kill</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3232.gif" alt=""><br><span class=txtSm>Ранг: 793.4 <font color=magenta>(<b>! !</b>)</font>, 568thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.59'>Активность: 0.74<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3232">Участник</a><br><font color=blue>Шаман</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 ноября 2011 05:27 &middot; Поправил: PE_Kill <br><script type="text/javascript">QU('PE_Kill','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=PE_Kill" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19277.html&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
<I>ARCHANGEL пишет:<br>К тому, что в результате таких преобразований наступает момент, когда теряется возможность отделить мусор от немусора, т.к. нельзя сформировать чёткие правила.  </I><br>Это заблуждение, т.к. такое возможно лишь при высокоуровневой мутации, да и то очень ограниченно, чего в вашем посте нет.<br><br>На примере кода, который является конечным, всё деморфится банальным обратным анализом, грубо, но работать будет. Т.е. если полностью дизассемблировать блок и идти, от ret назад, то:<br><br>Первый проход:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>nop</b></span>&nbsp;<span class="hl_comment">;push eax/pop eax</span></li><li class="hl_l1"><span class="hl_function"><b>xchg</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span><span class="hl_registr"><b>eax</b></span>&nbsp;<span class="hl_comment">;push ecx/mov ecx,eax/pop eax</span></li><li class="hl_l0"><span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">ecx</span></li><li class="hl_l1"><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l0"><span class="hl_function"><b>xchg</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr"><b>edx</b></span>&nbsp;<span class="hl_comment">;push eax/mov eax,edx/pop edx</span></li><li class="hl_l1"><span class="hl_function"><b>xchg</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">edx</span></li><li class="hl_l0"><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">esp</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_number">0</span></li><li class="hl_l1"><span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l0"><span class="hl_function"><b>nop</b></span>&nbsp;<span class="hl_comment">;pushfd/popfd</span></li><li class="hl_l1"><span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_number">2</span></li><li class="hl_l0"><span class="hl_function"><b>inc</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1"><span class="hl_function"><b>dec</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l0"><span class="hl_function"><b>dec</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1"><span class="hl_function">retn</span></li>        </ol>
    </div>
</div></div>
<br>Второй проход:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>xchg</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l1"><span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_number">0</span>&nbsp;<span class="hl_comment">;push ecx/mov dword ptr [esp],0</span></li><li class="hl_l0"><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l1"><span class="hl_function"><b>nop</b></span>&nbsp;<span class="hl_comment">;xchg eax,edx</span></li><li class="hl_l0"><span class="hl_function"><b>nop</b></span>&nbsp;<span class="hl_comment">;xchg eax,edx</span></li><li class="hl_l1"><span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l0"><span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_number">2</span></li><li class="hl_l1"><span class="hl_function"><b>inc</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l0"><span class="hl_function"><b>dec</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1"><span class="hl_function"><b>dec</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l0"><span class="hl_function">retn</span></li>        </ol>
    </div>
</div></div>
<br>Третий проход:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>nop</b></span>&nbsp;<span class="hl_comment">;xchg ecx,eax/mov ecx,eax</span></li><li class="hl_l1"><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_number">0</span>&nbsp;<span class="hl_comment">;push 0/pop eax</span></li><li class="hl_l0"><span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_number">2</span></li><li class="hl_l1"><span class="hl_function"><b>inc</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l0"><span class="hl_function"><b>dec</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1"><span class="hl_function"><b>dec</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l0"><span class="hl_function">retn</span></li>        </ol>
    </div>
</div></div>
<br><br>Далее подключаем оптимизатор, кодить не сложнее чем деморфер, учитывать только разных конструкций больше. Еще раз, это просто грубая модель.
<br><br><font size="1"><i>-----<br>Yann Tiersen best and do not fuck</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=295788&amp;user=3232&amp;forum_n=6&amp;topic=19277.html&amp;page=0&amp;anchor=11" class="addthx" data-post="295788"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]Vamit[/b]','')">Vamit</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/20406.jpg" alt=""><br><span class=txtSm>Ранг: 331.1 (мудрец), 561thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.3'>Активность: 0.19<span style='color:red'>&searr;</span>0.06</span><br>Статус: <a href="action=userinfo&amp;user=20406">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 ноября 2011 08:27 <br><script type="text/javascript">QU('Vamit','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vamit" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19277.html&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
<b>ARCHANGEL<br>Внимание, вопрос - есть ли способ такое заломать после 1000 проходов пермутации?</b><br>Можно утвердительно ответить, что способ<b>ы</b> есть, если вопрос касается только мутации, но не виртуализации - и здесь не нужны никакие шаблоны, всё делается статическим анализом стека, регистров, флагов и условий переходов (если, конечно мутатор умеет вставлять ложные переходы). Говорили про графы, но для решения этой задачи их строить и решать необязательно есть более простой способ деобфускации - N проходов по коду на каждом из которых посредством анализа состояний регистров (USE, CHANGE, INIT) и отслеживания вершины/содержимого стека вырезаются лишние инструкции с сохранением логики работы кода. N ограничено и не будет превышать кол-во проходов мутатора/обфускатора.<br>Эта логика реализована в VMSweeper и успешно работает...
<br><br><font size="1"><i>-----<br>Everything is relative...</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=295803&amp;user=20406&amp;forum_n=6&amp;topic=19277.html&amp;page=0&amp;anchor=12" class="addthx" data-post="295803"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]bowrouco[/b]','')">bowrouco</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 47.7 (посетитель), 17thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.01'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29629">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 ноября 2011 08:34 <br><script type="text/javascript">QU('bowrouco','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=bowrouco" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19277.html&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
<b>Vamit</b><br><br>&gt; для решения этой задачи их строить и решать необязательно есть более простой способ деобфускации - N проходов по коду<br><br>Граф трассируется для этой цели, это раскрытие ссылок. Иначе каждую инструкцию прижётся вновь дизасмить, также и весь код. Например на одном из проходов нужно определить ссылку на процедуру или есчо какуюто инфу не связанную с текущей инструкцией - придётся вновь весь код анализировать, а это нормально не решается, получится ацкая рекурсия, на которую и стека может не хватить. При изменении любой инструкции придётся пересчитывать все ветвления, в графе ничего не нужно пересчитывать. Таких нюансов слишком много, по мойму без графа сие не решается в принципе, по любому нужно гдето хранить инфу связанную с инструкциями.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=295804&amp;user=29629&amp;forum_n=6&amp;topic=19277.html&amp;page=0&amp;anchor=13" class="addthx" data-post="295804"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]PE_Kill[/b]','')">PE_Kill</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3232.gif" alt=""><br><span class=txtSm>Ранг: 793.4 <font color=magenta>(<b>! !</b>)</font>, 568thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.59'>Активность: 0.74<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3232">Участник</a><br><font color=blue>Шаман</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 ноября 2011 09:24 <br><script type="text/javascript">QU('PE_Kill','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=PE_Kill" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19277.html&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
<I>bowrouco пишет:<br>Таких нюансов слишком много, по мойму без графа сие не решается в принципе, по любому нужно гдето хранить инфу связанную с инструкциями.  </I><br>Тут под графом имеется ввиду группировка инструкций, разбиение на блоки, дробление и прочее. Вот это, в данном случае делать вовсе не обязательно. А инструкции естественно нужно где то хранить, в моем примере достаточно массива с указателями на инструкции, т.е. даже не связный список.
<br><br><font size="1"><i>-----<br>Yann Tiersen best and do not fuck</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=295806&amp;user=3232&amp;forum_n=6&amp;topic=19277.html&amp;page=0&amp;anchor=14" class="addthx" data-post="295806"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 ноября 2011 10:04 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19277.html&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
Выложи большой кусок, а лучше файл, в студию-и будет видно, разморфят обратно или нет.<br>Как вариант-предложить 50 баксов за разморф <img src="img/smilies/s1.gif" alt=""><br>Лично я ничего сложного тут не увидел, всё достаточно тривиально.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=295810&amp;user=1556&amp;forum_n=6&amp;topic=19277.html&amp;page=0&amp;anchor=15" class="addthx" data-post="295810"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]r_e[/b]','')">r_e</a></b><br></div>
<img src="img/s8.gif" alt=""><br><span class=txtSm>Ранг: 590.6 (<b>!</b>), 408thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.08'>Активность: 0.36<span style='color:red'>&searr;</span>0.18</span><br>Статус: <a href="action=userinfo&amp;user=11966">Модератор</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 ноября 2011 13:10 <br><script type="text/javascript">QU('r_e','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=r_e" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19277.html&amp;page=0#16');return false;">#16</a> </span><div align=left><br>
<b>ARCHANGEL</b><br>Если не даны ни начало блока ни его размер - то нечего и анализировать. Любой анализ начинается с ЕП. Для достаточно большого участка кода даже начало не имеет большого значения. Просто на выходе получишь кусок мусора в первом блоке.
<br><br><font size="1"><i>-----<br>старый пень</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=295819&amp;user=11966&amp;forum_n=6&amp;topic=19277.html&amp;page=0&amp;anchor=16" class="addthx" data-post="295819"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]bowrouco[/b]','')">bowrouco</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 47.7 (посетитель), 17thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.01'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29629">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 ноября 2011 19:52 <br><script type="text/javascript">QU('bowrouco','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=bowrouco" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19277.html&amp;page=0#17');return false;">#17</a> </span><div align=left><br>
<b>PE_Kill</b><br><br>Вы товарищ в этом вопросе полный нуб. Также как и про вопрос с WriteConsole(). Незачем писать если ничего не понимаете, набивать себе какойто рейтинг бессмысленно.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=295843&amp;user=29629&amp;forum_n=6&amp;topic=19277.html&amp;page=0&amp;anchor=17" class="addthx" data-post="295843"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]ARCHANGEL[/b]','')">ARCHANGEL</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/6336.png" alt=""><br><span class=txtSm>Ранг: 681.5 <font color=magenta>(<b>! !</b>)</font>, 405thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.85'>Активность: 0.42<span style='color:red'>&searr;</span>0.21</span><br>Статус: <a href="action=userinfo&amp;user=6336">Участник</a><br><font color=blue>ALIEN Hack Team</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 ноября 2011 02:10 <br><script type="text/javascript">QU('ARCHANGEL','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ARCHANGEL" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19277.html&amp;page=0#18');return false;">#18</a> </span><div align=left><br>
В общем, ситуация мне ясна, всем отписавшимся - спасибо. Основную идею я уловил, дальше, полагаю, обсуждать нечего, потому тему прикрою, ибо может начаться дискуссия, отличная от задуманной первоначально. Если появится какая-то дополнительная информация - порошу, чтоб открыли топик.
<br><br><font size="1"><i>-----<br>Stuck to the plan, always think that we would stand up, never ran.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=295868&amp;user=6336&amp;forum_n=6&amp;topic=19277.html&amp;page=0&amp;anchor=18" class="addthx" data-post="295868"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Несколько слов про обфускацию</span></td>
</tr></table>
</div>
<a name=newreply></a>
<div align=center>
<table class=forums>
<tr>
<td class=caption4 width="100%"><span class=header>Эта тема закрыта. Ответы больше не принимаются.</span></td>
</tr>
</table>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=19277" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
