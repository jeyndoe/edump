<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>V8 JavaScript engine - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Добрый вечер. Немного о V8. Согласно ECMA-262 standart стр. 18: в состав идентификатора может входить UnicodeLetter - any character in the Unicode categories &#8213;Uppercase letter (Lu), &#8213;Lowercase letter (Ll),">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=42072'>zombi-vadim</a>, <a target='_blank' href='?action=userinfo&amp;user=31361'>zds</a> (+4 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> V8 JavaScript engine</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]TheNozza[/b]','')">TheNozza</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 23.4 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.32'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=24722">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 31 августа 2013 23:32 <br><script type="text/javascript">QU('TheNozza','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=TheNozza" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22121.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Добрый вечер.<br>Немного о V8.<br><br>Согласно ECMA-262 standart стр. 18:<br>в состав идентификатора может входить UnicodeLetter  - any character in the Unicode categories &#8213;Uppercase letter (Lu), &#8213;Lowercase letter (Ll), &#8213;Titlecase letter (Lt), &#8213;Modifier letter (Lm), &#8213;Other letter (Lo), or &#8213;Letter number (Nl). <br><br>Берём к примеру Ll, по стандарту юникода codepoint&#039;ы этой категории  могут иметь код размером в 2 байта, а также более 2-ух байт - например:<br>1D4BB         ; Ll #       MATHEMATICAL SCRIPT SMALL F<br><br>Lexical analyzer of V8 работает с буфером, в котором текст JavaScript программы хранится в UTF-16 представлении (class Utf16CharacterStream).  Если данные на вход движка идут в ином формате, то они предварительно конвертятся в UTF-16, т.к. при распознавании токенов analyzer оперирует лишь с символами в UTF-16 кодировке.<br><br>Далее, 1D4BB кодпойнт при конверте в utf-16 даст суррогатную пару, состоящую из двух слов по 16 бит каждое: D8D4 DCBB, вместе два слова (или пара) в UTF-16 представляет юникод символ MATHEMATICAL SCRIPT SMALL F. <br><br>Если включить данный кодпойнт в идентификатор Javascript, то при выборке (за одну итерацию из буфера выбирается 16 бит) анализатором первой части суррогатной пары (D8D4) -  и осуществлении проверки &quot;является ли символ допустимым для идентификатора&quot; будет получен ответ &quot;нет&quot;, т.к таблицы допустимых символов составлены без учёта суррогатов. <br><br>Таблицы содержат диапазоны и одиночные коды символов без учёта кодпойнтов, дающих суррогаты, при выполнении скоростного бинарно-интерполяционного поиска по ним анализатор не сможет найти part of a surrogate pair.  <br><br>Вопрос правильно ли это? В стандарте Javascript ведь однозначно сказано: any character in the Unicode categories, без всяких исключений. Значит должно быть разрешено использовать в идентификаторах все символы перечисленных в стандарте категорий, в том числе и символов код которых &gt; FFFF.<br>Что думаете?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=330130&amp;user=24722&amp;forum_n=6&amp;topic=22121.html&amp;page=0&amp;anchor=1" class="addthx" data-post="330130"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]hors[/b]','')">hors</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/31056.jpg" alt=""><br><span class=txtSm>Ранг: 136.0 (ветеран), 360thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 8.52'>Активность: 0.27<span style='color:red'>&searr;</span>0.14</span><br>Статус: <a href="action=userinfo&amp;user=31056">Участник</a><br><font color=blue>Qt Developer</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 31 августа 2013 23:57 <br><script type="text/javascript">QU('hors','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=hors" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22121.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
<I>TheNozza пишет:<br>Значит должно быть разрешено использовать в идентификаторах все символы перечисленных в стандарте категорий, в том числе и символов код которых &gt; FFFF. </I><br><br>Нет. Только от 0 до 0xFFFF
<br><br><font size="1"><i>-----<br>http://ntinfo.biz</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=330134&amp;user=31056&amp;forum_n=6&amp;topic=22121.html&amp;page=0&amp;anchor=2" class="addthx" data-post="330134"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]TheNozza[/b]','')">TheNozza</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 23.4 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.32'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=24722">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 сентября 2013 00:12 &middot; Поправил: TheNozza <br><script type="text/javascript">QU('TheNozza','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=TheNozza" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22121.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
<u>Нет. Только от 0 до 0xFFFF </u><br>С чем же связано такое ограничение? В стандарте ECMA-262 об нём не упоминается.<br>Сам ищу информацию, пытаюсь понять...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=330140&amp;user=24722&amp;forum_n=6&amp;topic=22121.html&amp;page=0&amp;anchor=3" class="addthx" data-post="330140"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]TheNozza[/b]','')">TheNozza</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 23.4 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.32'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=24722">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 сентября 2013 01:05 &middot; Поправил: TheNozza <br><script type="text/javascript">QU('TheNozza','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=TheNozza" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22121.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
Воспроизводится в консоли Google Chrome, который на V8, для этого нужно добавить в идентификатор Javascript переменной  юникод code point  с кодом &gt; FFFF, который в UTF-16 даст суррогатную пару.<br><br>var str&#285899;;<br>SyntaxError: Unexpected token ILLEGAL<br><br>&#285899; - это 1D7CB         ; Ll #       MATHEMATICAL BOLD SMALL DIGAMMA <br><br>Смотрю, эта тема встречается и в продуктах иных компаний, например на apache.org заведён тикет на fix:<br>&quot;Surrogate pairs not treated as single unicode codepoint for display purposes&quot;.  https://issues.apache.org/bugzilla/show_bug.cgi?id=51843&amp;quot%3B&amp;gt%3Bbug
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=330141&amp;user=24722&amp;forum_n=6&amp;topic=22121.html&amp;page=0&amp;anchor=4" class="addthx" data-post="330141"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]Jonny[/b]','')">Jonny</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 36.1 (посетитель), 11thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.61'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=14384">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 сентября 2013 10:33 <br><script type="text/javascript">QU('Jonny','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Jonny" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22121.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
<I>TheNozza пишет:<br>С чем же связано такое ограничение? В стандарте ECMA-262 об нём не упоминается.<br>Сам ищу информацию, пытаюсь понять...<br> </I><br><noindex><a href="http://code.google.com/p/v8/issues/detail?id=1697" rel="nofollow" target="_blank">--&gt; Link &lt;--</a></noindex>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=330151&amp;user=14384&amp;forum_n=6&amp;topic=22121.html&amp;page=0&amp;anchor=5" class="addthx" data-post="330151"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]TheNozza[/b]','')">TheNozza</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 23.4 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.32'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=24722">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 сентября 2013 20:38 <br><script type="text/javascript">QU('TheNozza','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=TheNozza" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22121.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
В коде также указано: const uchar UnicodeData::kMaxCodePoint = 65533;<br><br>Проанализировав исходный код подсистемы, обрабатывающей юникод, (а она напрямую связана с лексером), всё же я пришёл к выводу, что существует более оптимальный алгоритм детекта категории юникод символа. Символы на лексер валятся тысячами, и каждый выбранный из потока символ обрабатывается индивидуально, поэтому крайне важно снизить время обработки до возможного минимума.<br><br>Сейчас детект категории проводится с использованием бинарно-интерполяционного поиска по сортированному массиву. Сложность бинарного поиска элемента в сортированном массиве O(logN).<br>Сложность интерполяционного поиска может колебаться от O(n) в худшем случае, до O(log(logN)) в лучшем, в зависимости от того насколько равномерно распределены данные.<br><br>Совмещённый бинарно-интерполяционный поиск будет иметь сложность где-то посередине между O(log(logN)) и O(logN). <br><br>Он не является классическим алгоритмом (я б даже ту реализацию назвал модифицированным бинарным поиском) и наиболее простой способ оценки - статистический. На массиве из 450 элементов бинарный поиск найдёт элемент в среднем за log2(450) = 8.81 шага, интерполяционный в идеальном случае за log2(log2(450)) = 3,31 шага. Как показывает практика, реализованный алгоритм поиска находит кодпойнт в массиве из 450 элементов в среднем за 6,88 итераций. Это значение как раз лежит посередине.  <br><br>Есть другой вариант реализации. Применить вместо массива кастомный bitset на 2^16 битов. Лишние 8 кб памяти в наше время - это ниочём, тем более в этой ситуации очень важна скорость. <br>Затем заресетить весь битсет в нули. На позициях, номер которых соответствует кодпойнтам заданной категории, выставить биты в 1-цы - всё, битсет проинициализирован. При поиске кодпойнта, а его код 16-битный, например xxxx, нужно чекать xxxx бит в битсете. Сложность поиска тогда будет константная!
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=330190&amp;user=24722&amp;forum_n=6&amp;topic=22121.html&amp;page=0&amp;anchor=6" class="addthx" data-post="330190"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]sendersu[/b]','')">sendersu</a></b><br></div>
<img src="img/s8.gif" alt=""><br><span class=txtSm>Ранг: 512.7 (<b>!</b>), 360thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.56'>Активность: 0.27<span style='color:red'>&searr;</span>0.03</span><br>Статус: <a href="action=userinfo&amp;user=14629">Модератор</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 сентября 2013 21:27 <br><script type="text/javascript">QU('sendersu','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=sendersu" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22121.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
<I>TheNozza пишет:<br>Сложность поиска тогда будет константная! </I><br>O(1) наше все
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=330192&amp;user=14629&amp;forum_n=6&amp;topic=22121.html&amp;page=0&amp;anchor=7" class="addthx" data-post="330192"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]Jonny[/b]','')">Jonny</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 36.1 (посетитель), 11thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.61'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=14384">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 сентября 2013 01:58 &middot; Поправил: Jonny <br><script type="text/javascript">QU('Jonny','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Jonny" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22121.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
<I>TheNozza пишет:<br>Проанализировав исходный код подсистемы, обрабатывающей юникод, (а она напрямую связана с лексером), всё же я пришёл к выводу, что существует более оптимальный алгоритм детекта категории юникод символа. </I> ... и т.д.<br>Вся задача сводится к эффективному поиску значения в разреженном массиве. <br>По любасу для значений юникод-таблицы в прделеах 0 - 0xffff  нужно выделить отдельный lookup массив , а оcт. редкоземельные элементы можно искать и по списку.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=330195&amp;user=14384&amp;forum_n=6&amp;topic=22121.html&amp;page=0&amp;anchor=8" class="addthx" data-post="330195"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]Jonny[/b]','')">Jonny</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 36.1 (посетитель), 11thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.61'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=14384">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 сентября 2013 03:02 <br><script type="text/javascript">QU('Jonny','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Jonny" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22121.html&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
Текущая реализация сканера идентификаторов в V8 выглядит так:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">Token<span class="hl_char">:</span><span class="hl_char">:</span>Value&nbsp;Scanner<span class="hl_char">:</span><span class="hl_char">:</span>ScanIdentifierOrKeyword<span class="hl_char">(</span><span class="hl_char">)</span>&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;ASSERT<span class="hl_char">(</span>unicode_cache_<span class="hl_char">-</span><span class="hl_char">&gt;</span>IsIdentifierStart<span class="hl_char">(</span>c0_<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;LiteralScope&nbsp;literal<span class="hl_char">(</span><span class="hl_function">this</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;Scan&nbsp;identifier&nbsp;start&nbsp;character<span class="hl_char">.</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>c0_&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_quote">'\'</span><span class="hl_char">)</span>&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;uc32&nbsp;c&nbsp;<span class="hl_char">=</span>&nbsp;ScanIdentifierUnicodeEscape<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;Only&nbsp;allow&nbsp;legal&nbsp;identifier&nbsp;start&nbsp;characters<span class="hl_char">.</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>c&nbsp;<span class="hl_char">&lt;</span>&nbsp;<span class="hl_number">0</span>&nbsp;<span class="hl_char">|</span><span class="hl_char">|</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_quote">'\'</span>&nbsp;<span class="hl_char">|</span><span class="hl_char">|</span>&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;No&nbsp;recursive&nbsp;escapes<span class="hl_char">.</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">!</span>unicode_cache_<span class="hl_char">-</span><span class="hl_char">&gt;</span>IsIdentifierStart<span class="hl_char">(</span>c<span class="hl_char">)</span><span class="hl_char">)</span>&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Token<span class="hl_char">:</span><span class="hl_char">:</span>ILLEGAL<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;AddLiteralChar<span class="hl_char">(</span>c<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;ScanIdentifierSuffix<span class="hl_char">(</span><span class="hl_char">&amp;</span>literal<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;uc32&nbsp;first_char&nbsp;<span class="hl_char">=</span>&nbsp;c0_<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;Advance<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;AddLiteralChar<span class="hl_char">(</span>first_char<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;Scan&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;identifier&nbsp;characters<span class="hl_char">.</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>while</b></span>&nbsp;<span class="hl_char">(</span>unicode_cache_<span class="hl_char">-</span><span class="hl_char">&gt;</span>IsIdentifierPart<span class="hl_char">(</span>c0_<span class="hl_char">)</span><span class="hl_char">)</span>&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>c0_&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;<span class="hl_quote">'\'</span><span class="hl_char">)</span>&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uc32&nbsp;next_char&nbsp;<span class="hl_char">=</span>&nbsp;c0_<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Advance<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AddLiteralChar<span class="hl_char">(</span>next_char<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;Fallthrough&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;no&nbsp;longer&nbsp;able&nbsp;to&nbsp;complete&nbsp;keyword<span class="hl_char">.</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;ScanIdentifierSuffix<span class="hl_char">(</span><span class="hl_char">&amp;</span>literal<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;literal<span class="hl_char">.</span>Complete<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>next_<span class="hl_char">.</span>literal_chars<span class="hl_char">-</span><span class="hl_char">&gt;</span>is_ascii<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_char">)</span>&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;Vector<span class="hl_char">&lt;</span><span class="hl_function"><b>const</b></span>&nbsp;<span class="hl_function">char</span><span class="hl_char">&gt;</span>&nbsp;chars&nbsp;<span class="hl_char">=</span>&nbsp;next_<span class="hl_char">.</span>literal_chars<span class="hl_char">-</span><span class="hl_char">&gt;</span>ascii_literal<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;KeywordOrIdentifierToken<span class="hl_char">(</span>chars<span class="hl_char">.</span>start<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_char">,</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chars</span><span class="hl_char">.</span>length<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_char">,</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;harmony_scoping_</span><span class="hl_char">,</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;harmony_modules_</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;}</li>        </ol>
    </div>
</div></div>
<br><br>Проверка того, что символ может являться разрешенным символом в названии идентификаторов, осуществляется по полной таблице unicode.<br>Но не осуществляется проверка того, что символ может являться частью суррогатной пары.<br>Для начала можно попробовать добавить проверку на суррогатную пару, и если так, то сделать 2 Вызова Advance() вместо одного.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=330200&amp;user=14384&amp;forum_n=6&amp;topic=22121.html&amp;page=0&amp;anchor=9" class="addthx" data-post="330200"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]TheNozza[/b]','')">TheNozza</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 23.4 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.32'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=24722">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 сентября 2013 20:34 &middot; Поправил: TheNozza <br><script type="text/javascript">QU('TheNozza','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=TheNozza" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22121.html&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
<i class=x>Проверка того, что символ может являться разрешенным символом в названии идентификаторов, осуществляется по полной таблице unicode.</i><br><br>Там не одна таблица, а много. Для каждой категории символов по несколько массивов(таблиц) с целью ускорения поиска. <br><br>Таблицы эти <b>неполные</b>, в них отсутствуют коды символов (диапазонов символов), дающие суррогатные пары.<br><br>Полная таблица символов различных категорий находится здесь: http://www.unicode.org/Public/UCD/latest/ucd/extracted/DerivedGeneralCategory.txt
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=330213&amp;user=24722&amp;forum_n=6&amp;topic=22121.html&amp;page=0&amp;anchor=10" class="addthx" data-post="330213"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]Jonny[/b]','')">Jonny</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 36.1 (посетитель), 11thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.61'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=14384">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 сентября 2013 22:05 <br><script type="text/javascript">QU('Jonny','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Jonny" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22121.html&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
<I>TheNozza пишет:<br>Там не одна таблица, а много. Для каждой категории символов по несколько массивов(таблиц) с целью ускорения поиска.<br><br>Таблицы эти неполные, в них отсутствуют коды символов (диапазонов символов), дающие суррогатные пары. </I><br>Действительно. там таблиц 8 штук, и описывают они только знаки из базовой плоскости (0x0000-0xFFFF);<br>Например, самая короткая таблица <br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">static&nbsp;<span class="hl_function"><b>const</b></span>&nbsp;int32_t&nbsp;kLetterTable6<span class="hl_char">[</span><span class="hl_number">6</span><span class="hl_char">]</span>&nbsp;<span class="hl_char">=</span>&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_number">1073741824</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">6051</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">1073747888</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">6086</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">1073747915</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">6139</span>&nbsp;}<span class="hl_comment">;  // NOLINT</span></li>        </ol>
    </div>
</div></div>
<br>содержит<br> C000 - D7A3<br>D7B0-D7C6<br>D7CB-D7FB<br>Флаг 0x40000000 в значении указывает на начало диапазона.<br>То есть, получается, что  суррогатные пары вообще не обрабатываются при скане идентификаторов.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=330227&amp;user=14384&amp;forum_n=6&amp;topic=22121.html&amp;page=0&amp;anchor=11" class="addthx" data-post="330227"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]Jonny[/b]','')">Jonny</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 36.1 (посетитель), 11thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.61'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=14384">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 сентября 2013 22:28 &middot; Поправил: Jonny <br><script type="text/javascript">QU('Jonny','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Jonny" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22121.html&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
<I>TheNozza пишет:<br>Согласно ECMA-262 standart стр. 18:<br>в состав идентификатора может входить UnicodeLetter - any character in the Unicode categories &#8213;Uppercase letter (Lu), &#8213;Lowercase letter (Ll), &#8213;Titlecase letter (Lt), &#8213;Modifier letter (Lm), &#8213;Other letter (Lo), or &#8213;Letter number (Nl).<br> </I><br>Чуть повыше, на стр. 13, читаем следующее:<br><i class=x> ECMAScript source text is assumed to be a sequence of 16-bit code units for the purposes of this specification. Such a source text may include sequences of 16-bit code units that are not valid UTF-16 character encodings. </i><br>Об этом подробно рассказано <noindex><a href="http://dheeb.files.wordpress.com/2011/07/gbu.pdf" rel="nofollow" target="_blank">--&gt; тут &lt;--</a></noindex><br><br><i class=x>Javascript &#8800; Java’s Crypt<br>Javascript still uses (or can use: the standard allow for either UTF&#8208;16 or UCS&#8208;2) the broken and ancient UCS&#8208;2 — which is not a valid Unicode encoding!<br>No support for named characters like \N{WHITE SMILING FACE}; you must use magic numbers like \u263A instead. Notice that’s not enough digits.<br>Because literals are specified using exactly four hex digits \uXXXX, Javascript supports only &#185;&#8260;&#8321;&#8327;&#7511;&#688; of Unicode, the 5.88% that occupies Plane Zero.<br>The &#7431;&#7428;&#7437;&#7424;Script standard wickedly defines string values not as sequences of characters, but rather as sequences of 16-bit “code units”.<br>This is super&#8208;nasty.<br>The UTF&#8208;16 n&#233;e UCS&#8208;2 Curse<br>Like several other languages, Javascript suffers from The UTF&#8208;16 Curse.<br>Except that Javascript has an even worse form of it, The UCS&#8208;2 Curse. Things like charCodeAt and fromCharCode only ever deal with 16&#8208;bit quantities, not with real, 21&#8208;bit Unicode code points.<br>Therefore, if you want to print out something like &#119964;, U+1D49C, MATHEMATICAL SCRIPT CAPITAL A, you have to specify not one character but two “char units”: &quot;\uD835\uDC9C&quot;. &#128561;<br># ERROR!!<br>document.write(String.fromCharCode(0x1D49C));<br># needed bogosity<br>document.write(String.fromCharCode(0xD835,0xDC9C));</i><br><br>Javascript Code Unit (16 bit) != Unicode Code Point (20 bit)
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=330229&amp;user=14384&amp;forum_n=6&amp;topic=22121.html&amp;page=0&amp;anchor=12" class="addthx" data-post="330229"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]TheNozza[/b]','')">TheNozza</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 23.4 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.32'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=24722">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 сентября 2013 00:10 <br><script type="text/javascript">QU('TheNozza','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=TheNozza" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22121.html&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
<i class=x>Вся задача сводится к эффективному поиску значения в разреженном массиве.</i><br><br>И какой разреженный массив вы бы выбрали в данной ситуации:<br>a) на базе списка<br>b) на базе двоичного дерева<br>с) с прямой адресацией<br>d) с применением хэш-функции, обеспечивающей равномерное распределение<br>e) иной вариант<br><br>Первоначально я предложил вариант [с прямой адресацией] со сложностью O(1), но с повышенным потреблением памяти. Можно посмотреть ещё в сторону (d), есть вероятность пулучить в нём сложность O(1)(или близкую к ней), нужен более детальный анализ последовательности, а так же построение графиков распределений для различных хэш-функций.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=330237&amp;user=24722&amp;forum_n=6&amp;topic=22121.html&amp;page=0&amp;anchor=13" class="addthx" data-post="330237"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]Jonny[/b]','')">Jonny</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 36.1 (посетитель), 11thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.61'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=14384">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 сентября 2013 02:21 &middot; Поправил: Jonny <br><script type="text/javascript">QU('Jonny','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Jonny" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22121.html&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
Мне кажется , что проще базовой план организовать в виде битсета, как вы и предлагали, остальные элементы вне BMP чекать через hashset с оптимизированной под наши входные данные хеш-функцией.<br>В V8 реализован поиск по сериализованному дереву.  Отсортированное множество(читай сериализованное бинарное дерево) интересующих значений сначала раскидали на поддеревья(8 таблиц).  Далее для уменьшения размера таблиц все диапазоны значений закодировали.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=330248&amp;user=14384&amp;forum_n=6&amp;topic=22121.html&amp;page=0&amp;anchor=14" class="addthx" data-post="330248"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> V8 JavaScript engine</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#15" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="6">
<input type="hidden" name="topic" value="22121">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=22121" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
