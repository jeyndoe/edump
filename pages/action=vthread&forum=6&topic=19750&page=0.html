<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Protect Process - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Собственно задача состоит в том, чтобы защитить свой процесс от завершения в диспетчере задач и не только. Примером может служить процесс smss.exe и реакция диспетчера задач на попытку его завершения. Сразу говорю, гуглил ..">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=7823'>ManHunter</a>, <a target='_blank' href='?action=userinfo&amp;user=1533'>rmn</a>, <a target='_blank' href='?action=userinfo&amp;user=41701'>_MBK_</a>, <a target='_blank' href='?action=userinfo&amp;user=55995'>tyns777</a> (+10 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Protect Process</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> .  <b>1</b> . <a href="action=vthread&amp;forum=6&amp;topic=19750&amp;page=1.html">2</a> . <a href="action=vthread&amp;forum=6&amp;topic=19750&amp;page=1.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]OnLyOnE[/b]','')">OnLyOnE</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/1989.png" alt=""><br><span class=txtSm>Ранг: 462.8 (мудрец), 468thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.08'>Активность: 0.28<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1989">Участник</a><br><font color=blue>Only One!</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 апреля 2012 14:21 &middot; Поправил: OnLyOnE <br><script type="text/javascript">QU('OnLyOnE','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=OnLyOnE" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19750&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Собственно задача состоит в том, чтобы защитить свой процесс от завершения в диспетчере задач и не только.<br>Примером может служить процесс smss.exe и реакция диспетчера задач на попытку его завершения.<br>Сразу говорю, гуглил .. много рассуждений на данную тему, но примера рабочего кода так и не нашел.(может хреново искал?)<br>В общем хотелось бы получить максимально развернутый ответ на поставленный вопрос с примером рабочего кода (язык не важен).<br>Из того что почерпнул в гугле и на васме, что можно хучить TerminateProcess и DebugExitProcess.<br>Вот интересно, есть другие способы кроме хука? Более &quot;цивилизованные&quot;? <img src="img/smilies/s11.gif" alt=""><br><br>P.S. Сразу оговорюсь, мой процесс -&gt; сервис
<br><br><font size="1"><i>-----<br>aLL rIGHTS rEVERSED!</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=303214&amp;user=1989&amp;forum_n=6&amp;topic=19750&amp;page=0&amp;anchor=1" class="addthx" data-post="303214"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]tihiy_grom[/b]','')">tihiy_grom</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 441.3 (мудрец), 297thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.33'>Активность: 0.41<span style='color:red'>&searr;</span>0.04</span><br>Статус: <a href="action=userinfo&amp;user=10534">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 апреля 2012 15:14 &middot; Поправил: tihiy_grom <br><script type="text/javascript">QU('tihiy_grom','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=tihiy_grom" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19750&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
запускай 2 сервиса, чтобы один восстанавливал другого <img src="img/smilies/s1.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=303216&amp;user=10534&amp;forum_n=6&amp;topic=19750&amp;page=0&amp;anchor=2" class="addthx" data-post="303216"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 апреля 2012 15:35 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19750&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
Пример неудачный, smss закостылен по имени в диспетчере. Обзови свой процесс так же, то же самое скажет. Другими менеджерами он спокойно убивается. Нормально это никак не сделаешь, ограничить юзера в правах только, не давай админа.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=303217&amp;user=1556&amp;forum_n=6&amp;topic=19750&amp;page=0&amp;anchor=3" class="addthx" data-post="303217"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]OnLyOnE[/b]','')">OnLyOnE</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/1989.png" alt=""><br><span class=txtSm>Ранг: 462.8 (мудрец), 468thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.08'>Активность: 0.28<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1989">Участник</a><br><font color=blue>Only One!</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 апреля 2012 15:56 &middot; Поправил: OnLyOnE <br><script type="text/javascript">QU('OnLyOnE','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=OnLyOnE" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19750&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
<I>tihiy_grom пишет:<br>запускай 2 сервиса, чтобы один восстанавливал другого</I><br>неудачный вариант, я как-раз стремлюсь к минимизации реализации, а не нагромождения всяких<br>изощренных методов.<br><I>Archer пишет:<br>Обзови свой процесс так же, то же самое скажет </I><br>Эт уже побывал... работает... но как бы тоже метод не исключительный по красоте реализации <img src="img/smilies/s11.gif" alt=""><I><br>Archer пишет:<br>ограничить юзера в правах только, не давай админа</I><br>тоже не вариант, увы..<br>P.S. Пока, в качестве хоть какой-то защиты прикрутил вот такое решение... оно не препятствует завершению процесса,<br>но делает BSOD системе при завершении моего процесса<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">IsCriticalProcess&nbsp;<span class="hl_function"><b>proc</b></span>&nbsp;OnOff</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>local</b></span>&nbsp;hToken<span class="hl_char">:</span><span class="hl_function">dword</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>local</b></span>&nbsp;tkp<span class="hl_char">:</span>TOKEN_PRIVILEGES</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;RtlZeroMemory<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;tkp<span class="hl_char">,</span><span class="hl_function"><b>sizeof</b></span>&nbsp;tkp</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;GetCurrentProcess</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lea</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span>hToken</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;OpenProcessToken<span class="hl_char">,</span><span class="hl_registr">eax</span><span class="hl_char">,</span>TOKEN_ADJUST_PRIVILEGES&nbsp;<span class="hl_char">+</span>&nbsp;TOKEN_QUERY<span class="hl_char">,</span><span class="hl_registr"><b>ebx</b></span>&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_registr"><b>eax</b></span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_function">NULL</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>call</b></span>&nbsp;LastError</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">endif</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;LookupPrivilegeValue<span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">,</span>chr<span class="hl_char">$</span><span class="hl_char">(</span><span class="hl_quote">&quot;SeDebugPrivilege&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;tkp<span class="hl_char">.</span>Privileges<span class="hl_char">[</span><span class="hl_number">0</span><span class="hl_char">]</span><span class="hl_char">.</span>Luid</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_registr"><b>eax</b></span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_function">NULL</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>call</b></span>&nbsp;LastError</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>endif</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;tkp<span class="hl_char">.</span>PrivilegeCount<span class="hl_char">,</span><span class="hl_number">1</span>&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;tkp<span class="hl_char">.</span>Privileges<span class="hl_char">[</span><span class="hl_number">0</span><span class="hl_char">]</span><span class="hl_char">.</span>Attributes<span class="hl_char">,</span>SE_PRIVILEGE_ENABLED&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;AdjustTokenPrivileges<span class="hl_char">,</span>hToken<span class="hl_char">,</span><span class="hl_function">FALSE</span><span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;tkp<span class="hl_char">,</span><span class="hl_function"><b>sizeof</b></span>&nbsp;tkp<span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">,</span><span class="hl_number">0</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;CloseHandle<span class="hl_char">,</span>hToken</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_registr"><b>eax</b></span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_function">NULL</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>call</b></span>&nbsp;LastError</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>endif</b></span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;RtlSetProcessIsCritical<span class="hl_char">,</span>OnOff<span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">,</span><span class="hl_function">FALSE</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">ret</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">IsCriticalProcess&nbsp;<span class="hl_function">endp</span></li>        </ol>
    </div>
</div></div>
<br>НО вопрос по теме остается открытым, т.е. требующего вариантов решения...<img src="img/smilies/s11.gif" alt="">
<br><br><font size="1"><i>-----<br>aLL rIGHTS rEVERSED!</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=303218&amp;user=1989&amp;forum_n=6&amp;topic=19750&amp;page=0&amp;anchor=4" class="addthx" data-post="303218"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]TryAga1n[/b]','')">TryAga1n</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 262.5 (наставник), 337thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 8.45'>Активность: 0.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=31275">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 апреля 2012 16:01 &middot; Поправил: TryAga1n <br><script type="text/javascript">QU('TryAga1n','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=TryAga1n" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19750&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
Похукать NtOpenProcess, ZwTerminateProcess
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=303219&amp;user=31275&amp;forum_n=6&amp;topic=19750&amp;page=0&amp;anchor=5" class="addthx" data-post="303219"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]OnLyOnE[/b]','')">OnLyOnE</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/1989.png" alt=""><br><span class=txtSm>Ранг: 462.8 (мудрец), 468thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.08'>Активность: 0.28<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1989">Участник</a><br><font color=blue>Only One!</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 апреля 2012 16:02 <br><script type="text/javascript">QU('OnLyOnE','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=OnLyOnE" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19750&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
<I>TryAga1n пишет:<br>Похукать NtOpenProcess  </I><br>Пример кода, как?
<br><br><font size="1"><i>-----<br>aLL rIGHTS rEVERSED!</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=303220&amp;user=1989&amp;forum_n=6&amp;topic=19750&amp;page=0&amp;anchor=6" class="addthx" data-post="303220"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]Vovan666[/b]','')">Vovan666</a></b><br></div>
<img src="img/s8.gif" alt=""><br><span class=txtSm>Ранг: 617.3 (<b>!</b>), 677thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.06'>Активность: 0.54<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=5291">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 апреля 2012 16:11 <br><script type="text/javascript">QU('Vovan666','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vovan666" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19750&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
Бред конечно, но например создай тред который со Sleep,100 будет проверять все процессы и если там есть TerminateProcess(и все остальные), блокировать их типа ret в начале.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=303221&amp;user=5291&amp;forum_n=6&amp;topic=19750&amp;page=0&amp;anchor=7" class="addthx" data-post="303221"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]ClockMan[/b]','')">ClockMan</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/17432.jpg" alt=""><br><span class=txtSm>Ранг: 568.2 (<b>!</b>), 465thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.99'>Активность: 0.55<span style='color:green'>&nearr;</span>0.57</span><br>Статус: <a href="action=userinfo&amp;user=17432">Участник</a><br><font color=blue>оптимист</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 апреля 2012 16:13 <br><script type="text/javascript">QU('ClockMan','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ClockMan" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19750&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
<b>OnLyOnE</b><br>Не заморачивайся на защите а то получится как nProtect GameGuard,<br>пиши дровину и прячь свой процесс как олю прячет фантик <img src="img/smilies/s1.gif" alt="">хотя утиль от руссиновича всёравно найдёт его<img src="img/smilies/s3.gif" alt=""><br><I>tihiy_grom пишет:<br>запускай 2 сервиса, чтобы один восстанавливал другого </I><br>да заморожу я эти два процесса а потом кильну,даже пикнуть неуспеют...
<br><br><font size="1"><i>-----<br>Чтобы правильно задать вопрос, нужно знать большую часть  ответа. Р.Шекли.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=303222&amp;user=17432&amp;forum_n=6&amp;topic=19750&amp;page=0&amp;anchor=8" class="addthx" data-post="303222"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]TryAga1n[/b]','')">TryAga1n</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 262.5 (наставник), 337thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 8.45'>Активность: 0.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=31275">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 апреля 2012 16:15 &middot; Поправил: TryAga1n <br><script type="text/javascript">QU('TryAga1n','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=TryAga1n" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19750&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
Только через драйвер<br>http://somebastardstolemyname.wordpress.com/2008/10/04/c-ntopenprocess-hook/<br>-<br>Вообще вопрос этот чисто VX&#039;ерский, так что стоит подомогаться до СЛиВок, он много может рассказать))
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=303223&amp;user=31275&amp;forum_n=6&amp;topic=19750&amp;page=0&amp;anchor=9" class="addthx" data-post="303223"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]OnLyOnE[/b]','')">OnLyOnE</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/1989.png" alt=""><br><span class=txtSm>Ранг: 462.8 (мудрец), 468thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.08'>Активность: 0.28<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1989">Участник</a><br><font color=blue>Only One!</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 апреля 2012 16:30 <br><script type="text/javascript">QU('OnLyOnE','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=OnLyOnE" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19750&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
<I>Vovan666 пишет:<br>Бред конечно, но например создай тред который со Sleep,100 будет проверять все процессы и если там есть TerminateProcess(и все остальные), блокировать их типа ret в начале.  </I><br>Не айс если честно ... так можно и систему подвесить, если во всех процессах хутчить TerminateProcess и иже с ними.. <img src="img/smilies/s11.gif" alt=""><br><I>ClockMan пишет:<br>пиши дровину и прячь свой процесс как олю прячет фантик  </I><br>да мог бы я спрятать, и пример исходника дровины есть... но пока хочу той реализации о которой писал выше..<br><I>TryAga1n пишет:<br>Вообще вопрос этот чисто VX&#039;ерский, так что стоит подомогаться до СЛиВок, он много может рассказать))  </I><br>Ну... не VX&#039;ерский... <img src="img/smilies/s2.gif" alt=""> , просто от &quot;продвинутых&quot; пользователей которые суют нос куда не следует .
<br><br><font size="1"><i>-----<br>aLL rIGHTS rEVERSED!</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=303224&amp;user=1989&amp;forum_n=6&amp;topic=19750&amp;page=0&amp;anchor=10" class="addthx" data-post="303224"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]tihiy_grom[/b]','')">tihiy_grom</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 441.3 (мудрец), 297thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.33'>Активность: 0.41<span style='color:red'>&searr;</span>0.04</span><br>Статус: <a href="action=userinfo&amp;user=10534">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 апреля 2012 16:32 <br><script type="text/javascript">QU('tihiy_grom','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=tihiy_grom" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19750&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
<I>OnLyOnE пишет:<br>Ну... не VX&#039;ерский...  , просто от &quot;продвинутых&quot; пользователей которые суют нос куда не следует . </I><br>ну тогда 2 контролирующих друг друга сервиса тебе вполне хватит
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=303225&amp;user=10534&amp;forum_n=6&amp;topic=19750&amp;page=0&amp;anchor=11" class="addthx" data-post="303225"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]OnLyOnE[/b]','')">OnLyOnE</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/1989.png" alt=""><br><span class=txtSm>Ранг: 462.8 (мудрец), 468thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.08'>Активность: 0.28<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1989">Участник</a><br><font color=blue>Only One!</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 апреля 2012 17:42 <br><script type="text/javascript">QU('OnLyOnE','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=OnLyOnE" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19750&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
<I>tihiy_grom пишет:<br>ну тогда 2 контролирующих друг друга сервиса тебе вполне хватит  </I><br>ну не хочу я писать отладчик..плюс ресурсы дополнительные будет жрать такой тандем <img src="img/smilies/s11.gif" alt="">
<br><br><font size="1"><i>-----<br>aLL rIGHTS rEVERSED!</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=303226&amp;user=1989&amp;forum_n=6&amp;topic=19750&amp;page=0&amp;anchor=12" class="addthx" data-post="303226"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]Dart Sergius[/b]','')">Dart Sergius</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/22828.jpg" alt=""><br><span class=txtSm>Ранг: 105.6 (ветеран), 36thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.72'>Активность: 0.1<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=22828">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 апреля 2012 19:20 <br><script type="text/javascript">QU('Dart Sergius','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Dart Sergius" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19750&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
Поставь обработчик на закрытие твоего сервиса - открытие его снова.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=303228&amp;user=22828&amp;forum_n=6&amp;topic=19750&amp;page=0&amp;anchor=13" class="addthx" data-post="303228"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]NikolayD[/b]','')">NikolayD</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 189.9 (ветеран), 334thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.36'>Активность: 0.3<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=24529">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 апреля 2012 19:38 <br><script type="text/javascript">QU('NikolayD','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=NikolayD" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19750&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
А утилита от Ms-Rem&#039;a не лечит такое?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=303232&amp;user=24529&amp;forum_n=6&amp;topic=19750&amp;page=0&amp;anchor=14" class="addthx" data-post="303232"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]OnLyOnE[/b]','')">OnLyOnE</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/1989.png" alt=""><br><span class=txtSm>Ранг: 462.8 (мудрец), 468thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.08'>Активность: 0.28<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1989">Участник</a><br><font color=blue>Only One!</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 апреля 2012 19:54 &middot; Поправил: OnLyOnE <br><script type="text/javascript">QU('OnLyOnE','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=OnLyOnE" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19750&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
<I>Dart Sergius пишет:<br>Поставь обработчик на закрытие твоего сервиса - открытие его снова.  </I><br>Это, я так понял, во втором процессе? Можно..<br><I>NikolayD пишет:<br>А утилита от Ms-Rem&#039;a не лечит такое?  </I><br>Ну не буду же я таскать с вместе со своим сервисом какую-то утилиту?<img src="img/smilies/s11.gif" alt=""><br>P.S.<br>Но я так и не увидел ни одного даже самого маленького кусочка кода реализации одного из вариантов.<br>Слова.. слова... <img src="img/smilies/s13.gif" alt=""><br>P.P.S. Тайно надеюсь, что топ прочтет глубокоуважаемый системный гуру ntldr и посоветует дельное.. <img src="img/smilies/s4.gif" alt="">
<br><br><font size="1"><i>-----<br>aLL rIGHTS rEVERSED!</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=303237&amp;user=1989&amp;forum_n=6&amp;topic=19750&amp;page=0&amp;anchor=15" class="addthx" data-post="303237"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]Dart Sergius[/b]','')">Dart Sergius</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/22828.jpg" alt=""><br><span class=txtSm>Ранг: 105.6 (ветеран), 36thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.72'>Активность: 0.1<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=22828">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 апреля 2012 20:44 <br><script type="text/javascript">QU('Dart Sergius','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Dart Sergius" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19750&amp;page=0#16');return false;">#16</a> </span><div align=left><br>
<b>OnLyOnE</b>, а в сервисы не обрабатывают сами своё закрытие? Что если заменить обработчик системный на закрытие - своим?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=303243&amp;user=22828&amp;forum_n=6&amp;topic=19750&amp;page=0&amp;anchor=16" class="addthx" data-post="303243"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 апреля 2012 20:53 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19750&amp;page=0#17');return false;">#17</a> </span><div align=left><br>
Можно выставить автоматический рестарт сервиса, если он помер.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=303245&amp;user=1556&amp;forum_n=6&amp;topic=19750&amp;page=0&amp;anchor=17" class="addthx" data-post="303245"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]OnLyOnE[/b]','')">OnLyOnE</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/1989.png" alt=""><br><span class=txtSm>Ранг: 462.8 (мудрец), 468thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.08'>Активность: 0.28<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1989">Участник</a><br><font color=blue>Only One!</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 апреля 2012 21:27 <br><script type="text/javascript">QU('OnLyOnE','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=OnLyOnE" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19750&amp;page=0#18');return false;">#18</a> </span><div align=left><br>
<I>Dart Sergius пишет:<br>OnLyOnE, а в сервисы не обрабатывают сами своё закрытие? Что если заменить обработчик системный на закрытие - своим?  </I><br>естественно есть обработчик,но если мне самому надо будет нужно остановить сервис, я хрен это сделаю если в обработчике намучу рестарт, если я тебя правильно понял..<br><I>Archer пишет:<br>Можно выставить автоматический рестарт сервиса, если он помер.<br> </I><br>Тоже самое, мне надо к примеру самому прибить сервис... ?..
<br><br><font size="1"><i>-----<br>aLL rIGHTS rEVERSED!</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=303249&amp;user=1989&amp;forum_n=6&amp;topic=19750&amp;page=0&amp;anchor=18" class="addthx" data-post="303249"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 апреля 2012 21:42 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19750&amp;page=0#19');return false;">#19</a> </span><div align=left><br>
Помер!=корректно был завершён. Если сам начнёшь тоже прибивать через пень-колоду, таки да, тоже перезапустится.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=303250&amp;user=1556&amp;forum_n=6&amp;topic=19750&amp;page=0&amp;anchor=19" class="addthx" data-post="303250"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="20" onfocus="this.blur()" href="JavaScript:di('[b]OnLyOnE[/b]','')">OnLyOnE</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/1989.png" alt=""><br><span class=txtSm>Ранг: 462.8 (мудрец), 468thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.08'>Активность: 0.28<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1989">Участник</a><br><font color=blue>Only One!</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 апреля 2012 21:55 <br><script type="text/javascript">QU('OnLyOnE','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=OnLyOnE" target="_blank">Личное сообщение</a> &middot;  <a href="#20" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19750&amp;page=0#20');return false;">#20</a> </span><div align=left><br>
<I>Archer пишет:<br>Помер!=корректно был завершён. Если сам начнёшь тоже прибивать через пень-колоду, таки да, тоже перезапустится.  </I><br>Ок, согласен. Пример кода, что ловить в обработчике? Хотя бы частично... плиз <img src="img/smilies/s11.gif" alt="">
<br><br><font size="1"><i>-----<br>aLL rIGHTS rEVERSED!</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=303253&amp;user=1989&amp;forum_n=6&amp;topic=19750&amp;page=0&amp;anchor=20" class="addthx" data-post="303253"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="21" onfocus="this.blur()" href="JavaScript:di('[b]Dart Sergius[/b]','')">Dart Sergius</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/22828.jpg" alt=""><br><span class=txtSm>Ранг: 105.6 (ветеран), 36thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.72'>Активность: 0.1<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=22828">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 апреля 2012 21:56 <br><script type="text/javascript">QU('Dart Sergius','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Dart Sergius" target="_blank">Личное сообщение</a> &middot;  <a href="#21" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19750&amp;page=0#21');return false;">#21</a> </span><div align=left><br>
<b>OnLyOnE</b> а ты перед перезапуском проверяй ключ в реестре или наличие какого-нить файла, если нету - то перезапуск.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=303254&amp;user=22828&amp;forum_n=6&amp;topic=19750&amp;page=0&amp;anchor=21" class="addthx" data-post="303254"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="22" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 апреля 2012 22:12 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#22" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19750&amp;page=0#22');return false;">#22</a> </span><div align=left><br>
Почитай мой пост выше ещё раз. Я не имел в виду обработчики. А имел в виду стандартную виндовую фичу перезапуска сервисов в случае сбоев. Если происходит сбой (внезапно сервис сдох), винда его перезапустит, никакие обработчики трогать не надо.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=303257&amp;user=1556&amp;forum_n=6&amp;topic=19750&amp;page=0&amp;anchor=22" class="addthx" data-post="303257"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=1989" title="08-04-2012 03:50, ранг:342.5" target="_blank">OnLyOnE</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="23" onfocus="this.blur()" href="JavaScript:di('[b]ARCHANGEL[/b]','')">ARCHANGEL</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/6336.png" alt=""><br><span class=txtSm>Ранг: 681.5 <font color=magenta>(<b>! !</b>)</font>, 405thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.85'>Активность: 0.42<span style='color:red'>&searr;</span>0.21</span><br>Статус: <a href="action=userinfo&amp;user=6336">Участник</a><br><font color=blue>ALIEN Hack Team</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 апреля 2012 22:21 &middot; Поправил: ARCHANGEL <br><script type="text/javascript">QU('ARCHANGEL','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ARCHANGEL" target="_blank">Личное сообщение</a> &middot;  <a href="#23" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19750&amp;page=0#23');return false;">#23</a> </span><div align=left><br>
<b>OnLyOnE</b><br><noindex><a href="http://wasm.ru/article.php?article=dumping" rel="nofollow" target="_blank">--&gt; Здесь &lt;--</a></noindex> Ms-Rem показывает, как написать простенький драйвер, перехватывающий NtOpenProcess и не дающий диспетчерам задач из ринг3 грохать твой процесс. В конце есть сорцы. А с перезапуском - мне как-то не очень сама идея. Для того, чтобы нехорошие перцы-малварщики так не делали (не перезапускали свои малварные процессы), можно просто через CreateFile открыть Pe-файл с dwShareMode == 0 и никакой перезапуск такому сервису не поможет. Ибо CreateProcess нормально не отработает по понятным причинам. В случае же драйверного перехвата желательно не давать открыть и csrss.exe, ибо в нём есть все описатели процессов, через которые тоже можно грохнуть защищаемый тобой процесс.
<br><br><font size="1"><i>-----<br>Stuck to the plan, always think that we would stand up, never ran.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=303259&amp;user=6336&amp;forum_n=6&amp;topic=19750&amp;page=0&amp;anchor=23" class="addthx" data-post="303259"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="24" onfocus="this.blur()" href="JavaScript:di('[b]mak[/b]','')">mak</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3520.jpg" alt=""><br><span class=txtSm>Ранг: 673.3 <font color=magenta>(<b>! !</b>)</font>, 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.48'>Активность: 0.4<span style='color:red'>&searr;</span>0.31</span><br>Статус: <a href="action=userinfo&amp;user=3520">Участник</a><br><font color=blue>CyberMonk</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 апреля 2012 23:09 <br><script type="text/javascript">QU('mak','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=mak" target="_blank">Личное сообщение</a> &middot;  <a href="#24" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19750&amp;page=0#24');return false;">#24</a> </span><div align=left><br>
Придет <b>ntldr</b> и скажет, что выхода нет <img src="img/smilies/s5.gif" alt=""><br><br>Нормально это не сделать, все хотят быстро и с малым кодом, лень писать. Полулегально можно перехватом SSDT или инжект в чужой процес, но все это дело может и не сработать, сейчас понаставлено всякого на компьютерах. Поэтому чем проще, тем лучше. <br><br>По нормальному я бы делал Длл с основной начинкой, она как сервис по умолчанию не будет видна в таск менеджере, далее наделать нужных гуи стабов, скажем ГУИ для управления, ГУИ с основным функционалом, далее накатать протокол общения через named pipes, ввести туда стандарт безопасности, таким образом без особого реверса только ты будешь общаться со своим сервисом, через протокол реализовать управление завершения или изменения параметра авторестарта. <br><br>Далее остальная начинка сервиса развертывает все стабы гуи скажем через планировщик задач, либо открытие ехе черех сторонний процесс через инжект и конект к сервису с проверкой. Если даже гуй будет леквидирован пользователем, он не завершит весь главный сервис, сервис легко запустит вновь нужный ему стаб для работы с пользователем. Если же адепт полезет в сервисы проверять или будет наводка на именно тот сервис, то сервис в списке сервисов можно скрыть через структуру SERVICE_RECORD, по принципу сокрытия тоже самое, что сокрытие в таскменеджере, нужно будет лишь перебрать их и найти свой сервис.<br><br>Вот статья на эту тему http://www.codeproject.com/Articles/46670/Service-Hiding<br><br>Также можно посмотреть плагины оллидбг там есть кажется сокрытие через хук опенпроцесс и NtQueryInformationProcess <br><br>Сам сервис при перезапуске<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;Action0<span class="hl_char">.</span>aType<span class="hl_char">,</span>&nbsp;SC_ACTION_RESTART&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;Action0<span class="hl_char">.</span>Delay<span class="hl_char">,</span>&nbsp;<span class="hl_number">0h</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;Action1<span class="hl_char">.</span>aType<span class="hl_char">,</span>&nbsp;SC_ACTION_RESTART&nbsp;&nbsp;</li><li class="hl_l0"><span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;Action1<span class="hl_char">.</span>Delay<span class="hl_char">,</span>&nbsp;<span class="hl_number">0h</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;Action2<span class="hl_char">.</span>aType<span class="hl_char">,</span>&nbsp;SC_ACTION_RESTART&nbsp;&nbsp;</li><li class="hl_l0"><span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;Action2<span class="hl_char">.</span>Delay<span class="hl_char">,</span>&nbsp;<span class="hl_number">0h</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;lpInfo1<span class="hl_char">.</span>dwResetPeriod<span class="hl_char">,</span>&nbsp;<span class="hl_number">1h</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0"><span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;lpInfo1<span class="hl_char">.</span>lpRebootMsg<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;lpInfo1<span class="hl_char">.</span>lpCommand<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0"><span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;lpInfo1<span class="hl_char">.</span>cActions<span class="hl_char">,</span>&nbsp;<span class="hl_number">3</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>lea</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span style="word-break: break-all">&nbsp;Action0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="hl_l0"><span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;lpInfo1<span class="hl_char">.</span>lpsaActions<span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>eax</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>invoke</b></span>&nbsp;ChangeServiceConfig2<span class="hl_char">,</span>&nbsp;ServiceHandle<span class="hl_char">,</span>&nbsp;<span class="hl_number">2</span><span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;lpInfo1</li><li class="hl_l0"><span class="hl_function">ret</span></li>        </ol>
    </div>
</div></div>
<br><br>Все остальное через ControlService управляется как стандартный сервис. Клиент - Сервер техникой и легкой игрой с перехватами можно сделать нормальное сокрытие ИМХО
<br><br><font size="1"><i>-----<br>RE In Progress [!] Coding Hazard [!] Stay Clear of this Cube</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=303265&amp;user=3520&amp;forum_n=6&amp;topic=19750&amp;page=0&amp;anchor=24" class="addthx" data-post="303265"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=1989" title="08-04-2012 03:50, ранг:342.5" target="_blank">OnLyOnE</a>, <a href="action=userinfo&user=21589" title="08-04-2012 08:20, ранг:107.3" target="_blank">_ruzmaz_</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="25" onfocus="this.blur()" href="JavaScript:di('[b]ClockMan[/b]','')">ClockMan</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/17432.jpg" alt=""><br><span class=txtSm>Ранг: 568.2 (<b>!</b>), 465thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.99'>Активность: 0.55<span style='color:green'>&nearr;</span>0.57</span><br>Статус: <a href="action=userinfo&amp;user=17432">Участник</a><br><font color=blue>оптимист</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 апреля 2012 01:12 <br><script type="text/javascript">QU('ClockMan','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ClockMan" target="_blank">Личное сообщение</a> &middot;  <a href="#25" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19750&amp;page=0#25');return false;">#25</a> </span><div align=left><br>
<I>Archer пишет:<br>Можно выставить автоматический рестарт сервиса, если он помер </I><br>Вообще можно выставить и перезагрузку компа например если будет более двух сбоев<br><noindex><a href="http:/./imageshack.us/photo/my-images/718/fig1d.jpg/" rel="nofollow" target="_blank"> <img src="http://img718.imageshack.us/img718/9343/fig1d.jpg" border="0" align="" alt=""></a></noindex><br>но опять это всё обходится штатными утилями виндовс<img src="img/smilies/s1.gif" alt="">
<br><br><font size="1"><i>-----<br>Чтобы правильно задать вопрос, нужно знать большую часть  ответа. Р.Шекли.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=303278&amp;user=17432&amp;forum_n=6&amp;topic=19750&amp;page=0&amp;anchor=25" class="addthx" data-post="303278"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="26" onfocus="this.blur()" href="JavaScript:di('[b]OnLyOnE[/b]','')">OnLyOnE</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/1989.png" alt=""><br><span class=txtSm>Ранг: 462.8 (мудрец), 468thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.08'>Активность: 0.28<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1989">Участник</a><br><font color=blue>Only One!</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 апреля 2012 08:06 <br><script type="text/javascript">QU('OnLyOnE','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=OnLyOnE" target="_blank">Личное сообщение</a> &middot;  <a href="#26" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19750&amp;page=0#26');return false;">#26</a> </span><div align=left><br>
<I>Archer пишет:<br>Почитай мой пост выше ещё раз. Я не имел в виду обработчики. А имел в виду стандартную виндовую фичу перезапуска сервисов в случае сбоев. Если происходит сбой (внезапно сервис сдох), винда его перезапустит, никакие обработчики трогать не надо.<br> </I><br>Я понял, вариант неплохой <img src="img/smilies/s2.gif" alt=""> скорее всего его и реализую.<br><b>mak</b><br>спасибо за код.
<br><br><font size="1"><i>-----<br>aLL rIGHTS rEVERSED!</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=303282&amp;user=1989&amp;forum_n=6&amp;topic=19750&amp;page=0&amp;anchor=26" class="addthx" data-post="303282"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="27" onfocus="this.blur()" href="JavaScript:di('[b]OnLyOnE[/b]','')">OnLyOnE</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/1989.png" alt=""><br><span class=txtSm>Ранг: 462.8 (мудрец), 468thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.08'>Активность: 0.28<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1989">Участник</a><br><font color=blue>Only One!</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 апреля 2012 09:18 <br><script type="text/javascript">QU('OnLyOnE','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=OnLyOnE" target="_blank">Личное сообщение</a> &middot;  <a href="#27" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19750&amp;page=0#27');return false;">#27</a> </span><div align=left><br>
Сделал <img src="img/smilies/s3.gif" alt=""><br>Для &quot;продвинутых&quot; юзверей действительно оптимальное решение &quot;не убиваемого&quot; процесса.<br>Вот мой код (может кому будет интересно)<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">SERVICE_FAILURE_ACTIONS&nbsp;struct</li><li class="hl_l1">dwResetPeriod&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l0">lpRebootMsg&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l1">lpCommand&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l0">cActions&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l1">lpsaActions&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l0">SERVICE_FAILURE_ACTIONS&nbsp;<span class="hl_function">ends</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">SC_ACTION&nbsp;struct</li><li class="hl_l1">aType&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l0">Delay&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l1">SC_ACTION&nbsp;<span class="hl_function">ends</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">SC_ACTIONS&nbsp;struct</li><li class="hl_l0">Action0&nbsp;SC_ACTION&nbsp;<span class="hl_char">&lt;</span><span class="hl_char">&gt;</span></li><li class="hl_l1">Action1&nbsp;SC_ACTION&nbsp;<span class="hl_char">&lt;</span><span class="hl_char">&gt;</span></li><li class="hl_l0">Action2&nbsp;SC_ACTION&nbsp;<span class="hl_char">&lt;</span><span class="hl_char">&gt;</span></li><li class="hl_l1">SC_ACTIONS&nbsp;<span class="hl_function">ends</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">SC_ACTION_RESTART&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">1</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_char">.</span><span class="hl_function">data</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">lpInfo&nbsp;SERVICE_FAILURE_ACTIONS&nbsp;<span class="hl_char">&lt;</span><span class="hl_number">0</span><span class="hl_char">&gt;</span></li><li class="hl_l0">Actions&nbsp;SC_ACTIONS&nbsp;<span class="hl_char">&lt;</span><span class="hl_char">&gt;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_char">.</span><span class="hl_function">code</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>mov</b></span>&nbsp;hServiceBase<span class="hl_char">,</span>FUNC<span class="hl_char">(</span>OpenSCManager<span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">,</span>SC_MANAGER_ALL_ACCESS<span class="hl_char">)</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;hServiceBase&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_function">NULL</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>call</b></span>&nbsp;LastError</li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>invoke</b></span>&nbsp;ExitProcess<span class="hl_char">,</span><span class="hl_char">-</span><span class="hl_number">1</span>&nbsp;</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_char">.</span><span class="hl_function">endif</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>mov</b></span>&nbsp;hService<span class="hl_char">,</span>FUNC<span class="hl_char">(</span>CreateService<span class="hl_char">,</span>hServiceBase<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;ServiceName<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;ServiceDisplayName<span class="hl_char">,</span>SERVICE_ALL_ACCESS<span class="hl_char">,</span><span class="hl_char">\</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SERVICE_WIN32_SHARE_PROCESS</span><span class="hl_char">,</span>SERVICE_AUTO_START<span class="hl_char">,</span>SERVICE_ERROR_NORMAL<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;WindowsPath<span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">)</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;hService&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_function">NULL</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>call</b></span>&nbsp;LastError</li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>invoke</b></span>&nbsp;ExitProcess<span class="hl_char">,</span><span class="hl_char">-</span><span class="hl_number">1</span>&nbsp;</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_char">.</span><span class="hl_function">endif</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>mov</b></span>&nbsp;Actions<span class="hl_char">.</span>Action0<span class="hl_char">.</span>aType<span class="hl_char">,</span>SC_ACTION_RESTART</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>mov</b></span>&nbsp;Actions<span class="hl_char">.</span>Action0<span class="hl_char">.</span>Delay<span class="hl_char">,</span><span class="hl_function">NULL</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>mov</b></span>&nbsp;Actions<span class="hl_char">.</span>Action1<span class="hl_char">.</span>aType<span class="hl_char">,</span>SC_ACTION_RESTART</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>mov</b></span>&nbsp;Actions<span class="hl_char">.</span>Action1<span class="hl_char">.</span>Delay<span class="hl_char">,</span><span class="hl_function">NULL</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>mov</b></span>&nbsp;Actions<span class="hl_char">.</span>Action2<span class="hl_char">.</span>aType<span class="hl_char">,</span>SC_ACTION_RESTART</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>mov</b></span>&nbsp;Actions<span class="hl_char">.</span>Action2<span class="hl_char">.</span>Delay<span class="hl_char">,</span><span class="hl_function">NULL</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>mov</b></span>&nbsp;lpInfo<span class="hl_char">.</span>dwResetPeriod<span class="hl_char">,</span><span class="hl_number">0</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>mov</b></span>&nbsp;lpInfo<span class="hl_char">.</span>lpRebootMsg<span class="hl_char">,</span><span class="hl_number">0</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>mov</b></span>&nbsp;lpInfo<span class="hl_char">.</span>lpCommand<span class="hl_char">,</span><span class="hl_number">0</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>mov</b></span>&nbsp;lpInfo<span class="hl_char">.</span>cActions<span class="hl_char">,</span><span class="hl_number">3</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>lea</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>Actions</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>mov</b></span>&nbsp;lpInfo<span class="hl_char">.</span>lpsaActions<span class="hl_char">,</span><span class="hl_registr"><b>eax</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>invoke</b></span>&nbsp;ChangeServiceConfig2<span class="hl_char">,</span>hService<span class="hl_char">,</span>SERVICE_CONFIG_FAILURE_ACTIONS<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;lpInfo</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_registr"><b>eax</b></span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_function">NULL</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>call</b></span>&nbsp;LastError</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_char">.</span><span class="hl_function"><b>endif</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>invoke</b></span>&nbsp;StartService<span class="hl_char">,</span>hService<span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">,</span><span class="hl_function">NULL</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_registr"><b>eax</b></span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_function">NULL</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>call</b></span>&nbsp;LastError</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_char">.</span><span class="hl_function"><b>endif</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>invoke</b></span>&nbsp;CloseServiceHandle<span class="hl_char">,</span>hService</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>invoke</b></span>&nbsp;CloseServiceHandle<span class="hl_char">,</span>hServiceBase</li>        </ol>
    </div>
</div></div><br><br><font size="1"><i>-----<br>aLL rIGHTS rEVERSED!</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=303283&amp;user=1989&amp;forum_n=6&amp;topic=19750&amp;page=0&amp;anchor=27" class="addthx" data-post="303283"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="28" onfocus="this.blur()" href="JavaScript:di('[b]cosinus[/b]','')">cosinus</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 13.8 (новичок), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.18'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=20919">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 апреля 2012 17:50 &middot; Поправил: cosinus <br><script type="text/javascript">QU('cosinus','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=cosinus" target="_blank">Личное сообщение</a> &middot;  <a href="#28" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19750&amp;page=0#28');return false;">#28</a> </span><div align=left><br>
Дык не решилась проблемка-то. <br>Касаемо действий венды при сбое сервиса, то можно и в реестре сразу править ключи. Которые можно отловить RegMon&#039;ом. Но это &quot;кто-как-хочет&quot;.<br>Но если реально надо защитить процес от кыляния в &quot;диспетчере задач&quot; и других ринг3-утилитах, то лучше сделать так, чтобы имени этого процесса в этих утилита небыло <img src="img/smilies/s1.gif" alt=""><br><b>tasklist</b> в командной строке и <b>tasklist  /svc</b><br>Или же &quot;прятаться&quot; ещё глубже, в тех &quot;отличиях&quot; выводимых консолью.<br>Тоесть лучше спрятаться, тогда перед тем чтобы кильнуть - следует поискать. И поиск через EPROCESS может обламаться <img src="img/smilies/s14.gif" alt=""><br>Думаю у меня получилось изложить ход мысли.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=303308&amp;user=20919&amp;forum_n=6&amp;topic=19750&amp;page=0&amp;anchor=28" class="addthx" data-post="303308"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="29" onfocus="this.blur()" href="JavaScript:di('[b]ARCHANGEL[/b]','')">ARCHANGEL</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/6336.png" alt=""><br><span class=txtSm>Ранг: 681.5 <font color=magenta>(<b>! !</b>)</font>, 405thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.85'>Активность: 0.42<span style='color:red'>&searr;</span>0.21</span><br>Статус: <a href="action=userinfo&amp;user=6336">Участник</a><br><font color=blue>ALIEN Hack Team</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 апреля 2012 18:04 <br><script type="text/javascript">QU('ARCHANGEL','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ARCHANGEL" target="_blank">Личное сообщение</a> &middot;  <a href="#29" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19750&amp;page=0#29');return false;">#29</a> </span><div align=left><br>
<b>cosinus</b><br>Если уж развивать это направление, то любой &quot;продвинутый&quot; юзверь может качнуть RKU, перечислить все процессы и сделать Force Kill + File Erase, и если сервис представлен самостоятельным ехе-файлом, то можно сразу начинать отпевать его. И никакие трюки с EPROCESS тут не работают, ибо RKU юзает списки планировщика.
<br><br><font size="1"><i>-----<br>Stuck to the plan, always think that we would stand up, never ran.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=303310&amp;user=6336&amp;forum_n=6&amp;topic=19750&amp;page=0&amp;anchor=29" class="addthx" data-post="303310"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="30" onfocus="this.blur()" href="JavaScript:di('[b]OnLyOnE[/b]','')">OnLyOnE</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/1989.png" alt=""><br><span class=txtSm>Ранг: 462.8 (мудрец), 468thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.08'>Активность: 0.28<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1989">Участник</a><br><font color=blue>Only One!</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 апреля 2012 19:47 <br><script type="text/javascript">QU('OnLyOnE','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=OnLyOnE" target="_blank">Личное сообщение</a> &middot;  <a href="#30" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19750&amp;page=0#30');return false;">#30</a> </span><div align=left><br>
<I>ARCHANGEL пишет:<br>то любой &quot;продвинутый&quot; юзверь </I><br>Ну вы батенька нагоняете тумана <img src="img/smilies/s5.gif" alt=""><br>Не на столько они у меня продвинутые, иначе не пользовались бы моими услугами <img src="img/smilies/s3.gif" alt="">
<br><br><font size="1"><i>-----<br>aLL rIGHTS rEVERSED!</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=303314&amp;user=1989&amp;forum_n=6&amp;topic=19750&amp;page=0&amp;anchor=30" class="addthx" data-post="303314"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> .  <b>1</b> . <a href="action=vthread&amp;forum=6&amp;topic=19750&amp;page=1.html">2</a> . <a href="action=vthread&amp;forum=6&amp;topic=19750&amp;page=1.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Protect Process</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#31" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="6">
<input type="hidden" name="topic" value="19750">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=19750" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
