<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>gcc -&gt; сгенерить FLIRT сигнатуры - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Народ, подскажите куда копать. Подбираю ключи компилятора, чтобы сгенерить сигнатуры для LUA. Нашел простую функцию в декомпилируемой либе и пытаюсь получить такую же при компиляции исходников. gfind_nodef.cCode:      ">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=1533'>rmn</a>, <a target='_blank' href='?action=userinfo&amp;user=55940'>exp50848</a> (+8 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/green.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=1&sortBy=0&page=0.html"><b>Основной форум</b></a> <b class=bulletHead>&#8212;&#8250;</b> gcc -&gt; сгенерить FLIRT сигнатуры</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]Apokrif[/b]','')">Apokrif</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 171.0 (ветеран), 11thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.5'>Активность: 0.05<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=19416">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 сентября 2015 07:20 &middot; Поправил: Apokrif <br><script type="text/javascript">QU('Apokrif','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Apokrif" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=23752.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Народ, подскажите куда копать.<br>Подбираю ключи компилятора, чтобы сгенерить сигнатуры для LUA.<br>Нашел простую функцию в декомпилируемой либе и пытаюсь получить такую же при компиляции исходников.<br><br><b>gfind_nodef.c</b>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">static&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;gfind_nodef&nbsp;<span class="hl_char">(</span>lua_State&nbsp;<span class="hl_char">*</span>L<span class="hl_char">)</span>&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;return&nbsp;luaL_error<span class="hl_char">(</span>L<span class="hl_char">,</span>&nbsp;LUA_QL<span class="hl_char">(</span><span class="hl_quote">&quot;string.gfind&quot;</span><span class="hl_char">)</span>&nbsp;<span class="hl_quote">&quot; was renamed to &quot;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LUA_QL</span><span class="hl_char">(</span><span class="hl_quote">&quot;string.gmatch&quot;</span><span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">}</li>        </ol>
    </div>
</div></div>
<br>gcc-4.4.3<br>Похоже, что оптимизация полностью отключена (-O0) и есть стек фрэйм (адресация параметров идет через <b>R11</b>)<br><b>lib.so</b><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">0087063C</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STMFD&nbsp;&nbsp;&nbsp;<span class="hl_registr">SP</span><span class="hl_char">!</span><span class="hl_char">,</span>&nbsp;{R11<span class="hl_char">,</span>LR}</li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">00870640</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>ADD</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R11<span class="hl_char">,</span>&nbsp;<span class="hl_registr">SP</span><span class="hl_char">,</span>&nbsp;#4</li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">00870644</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>SUB</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">SP</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">SP</span><span class="hl_char">,</span>&nbsp;#8</li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">00870648</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>STR</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R0<span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span>R11<span class="hl_char">,</span>#var_8<span class="hl_char">]</span></li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">0087064C</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LDR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R0</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span>R11<span class="hl_char">,</span>#var_8<span class="hl_char">]</span></li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">00870650</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LDR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R3</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">=</span><span class="hl_char">(</span>aString_gfindWa&nbsp;<span class="hl_char">-</span>&nbsp;0x87065C<span class="hl_char">)</span></li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">00870654</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>ADD</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R3<span class="hl_char">,</span>&nbsp;PC<span class="hl_char">,</span>&nbsp;R3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; &quot;'string.gfind' was renamed to 'string.g&quot;...</span></li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">00870658</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>MOV</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R1<span class="hl_char">,</span>&nbsp;R3</li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">0087065C</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr"><b>BL</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub_855E74</li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">00870660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>MOV</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R3<span class="hl_char">,</span>&nbsp;R0</li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">00870664</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>MOV</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R0<span class="hl_char">,</span>&nbsp;R3</li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">00870668</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>SUB</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">SP</span><span class="hl_char">,</span>&nbsp;R11<span class="hl_char">,</span>&nbsp;#4</li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">0087066C</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LDMFD&nbsp;&nbsp;&nbsp;<span class="hl_registr">SP</span><span class="hl_char">!</span><span class="hl_char">,</span>&nbsp;{R11<span class="hl_char">,</span>PC}</li>        </ol>
    </div>
</div></div>
<br>У меня (-O0) все почти тоже самое, но НЕТ указателя на стек фрэйм (R11) и адресация параметров идет через <b>SP</b><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">.</span>gfind_nodef<span class="hl_char">:</span><span class="hl_number">000025DC</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>STR</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LR<span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">SP</span><span class="hl_char">,</span>#var_4<span class="hl_char">]</span><span class="hl_char">!</span></li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">.</span>gfind_nodef<span class="hl_char">:</span><span class="hl_number">000025E0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>SUB</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">SP</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">SP</span><span class="hl_char">,</span>&nbsp;#0xC</li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">.</span>gfind_nodef<span class="hl_char">:</span><span class="hl_number">000025E4</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>STR</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R0<span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">SP</span><span class="hl_char">,</span>#0x10<span class="hl_char">+</span>L<span class="hl_char">]</span></li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">.</span>gfind_nodef<span class="hl_char">:</span><span class="hl_number">000025E8</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LDR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R0</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">SP</span><span class="hl_char">,</span>#0x10<span class="hl_char">+</span>L<span class="hl_char">]</span></li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">.</span>gfind_nodef<span class="hl_char">:</span><span class="hl_number">000025EC</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LDR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R3</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">=</span><span class="hl_char">(</span>unk_36F<span class="hl_char">-</span>0x278F<span class="hl_char">)</span></li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">.</span>gfind_nodef<span class="hl_char">:</span><span class="hl_number">000025F0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>ADD</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R3<span class="hl_char">,</span>&nbsp;PC<span class="hl_char">,</span>&nbsp;R3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; &quot;'string.gfind' was renamed to 'string.g&quot;...</span></li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">.</span>gfind_nodef<span class="hl_char">:</span><span class="hl_number">000025F4</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>MOV</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R1<span class="hl_char">,</span>&nbsp;R3</li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">.</span>gfind_nodef<span class="hl_char">:</span><span class="hl_number">000025F8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr"><b>BL</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;luaL_error&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; PIC mode</span></li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">.</span>gfind_nodef<span class="hl_char">:</span><span class="hl_number">000025FC</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>MOV</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R3<span class="hl_char">,</span>&nbsp;R0</li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">.</span>gfind_nodef<span class="hl_char">:</span><span class="hl_number">00002600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>MOV</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R0<span class="hl_char">,</span>&nbsp;R3</li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">.</span>gfind_nodef<span class="hl_char">:</span><span class="hl_number">00002604</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>ADD</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">SP</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">SP</span><span class="hl_char">,</span>&nbsp;#0xC</li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">.</span>gfind_nodef<span class="hl_char">:</span><span class="hl_number">00002608</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LDMFD&nbsp;&nbsp;&nbsp;<span class="hl_registr">SP</span><span class="hl_char">!</span><span class="hl_char">,</span>&nbsp;{PC}</li>        </ol>
    </div>
</div></div>
<br>Все ключи <noindex><a href="https://gcc.gnu.org/onlinedocs/gcc/Optimize-Options.html" rel="nofollow" target="_blank">тут</a></noindex>.<br><b>-fomit-frame-pointer</b><br><i class=x>Don&#039;t keep the frame pointer in a register for functions that don&#039;t need one. This avoids the instructions to save, set up and restore frame pointers; it also makes an extra register available in many functions.</i><br><br>Проверил omit-frame-pointer для -O0<br>-O0 -Q --help=optimizers<br>  -fomit-frame-pointer        		[<b>disabled</b>]<br><br>Или я неправильно понимаю omit-frame-pointer или что-то еще упускаю...<br>Протрахался день и ночь, куда еще копать? <img src="img/smilies/s13.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=358699&amp;user=19416&amp;forum_n=1&amp;topic=23752.html&amp;page=0&amp;anchor=1" class="addthx" data-post="358699"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]reversecode[/b]','')">reversecode</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/15381.gif" alt=""><br><span class=txtSm>Ранг: 1053.6 <b><u>(!!!!)</u></b>, 1078thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.43'>Активность: 1.06<span style='color:red'>&searr;</span>0.81</span><br>Статус: <a href="action=userinfo&amp;user=15381">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 сентября 2015 08:44 <br><script type="text/javascript">QU('reversecode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=reversecode" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=23752.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
это у тебя что то с gcc<br>потому что бай дефолт это<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">LUALIB_API&nbsp;<span class="hl_function"><b>void</b></span>&nbsp;luaL_checkstack&nbsp;<span class="hl_char">(</span>lua_State&nbsp;<span class="hl_char">*</span>L<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;space<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>const</b></span>&nbsp;<span class="hl_function"><b>char</b></span>&nbsp;<span class="hl_char">*</span>msg<span class="hl_char">)</span>&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">*</span>&nbsp;keep&nbsp;some&nbsp;extra&nbsp;space&nbsp;to&nbsp;run&nbsp;error&nbsp;routines<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;needed&nbsp;<span class="hl_char">*</span><span class="hl_char">/</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>const</b></span>&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;extra&nbsp;<span class="hl_char">=</span>&nbsp;LUA_MINSTACK<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span><span class="hl_char">!</span>lua_checkstack<span class="hl_char">(</span>L<span class="hl_char">,</span>&nbsp;space&nbsp;<span class="hl_char">+</span>&nbsp;extra<span class="hl_char">)</span><span class="hl_char">)</span>&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span>msg<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;luaL_error<span class="hl_char">(</span>L<span class="hl_char">,</span>&nbsp;<span class="hl_quote">&quot;stack overflow (%s)&quot;</span><span class="hl_char">,</span>&nbsp;msg<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">else</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;luaL_error<span class="hl_char">(</span>L<span class="hl_char">,</span>&nbsp;<span class="hl_quote">&quot;stack overflow&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;}</li><li class="hl_l1">}</li>        </ol>
    </div>
</div></div>
<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">000105EC</span>&nbsp;sub_105EC</li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">000105EC</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STMFD&nbsp;&nbsp;&nbsp;<span class="hl_registr">SP</span><span class="hl_char">!</span><span class="hl_char">,</span>&nbsp;{R3<span class="hl_char">-</span>R5<span class="hl_char">,</span>LR}</li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">000105F0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>ADD</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R1<span class="hl_char">,</span>&nbsp;R1<span class="hl_char">,</span>&nbsp;#0x14</li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">000105F4</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>MOV</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R4<span class="hl_char">,</span>&nbsp;R2</li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">000105F8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>MOV</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R5<span class="hl_char">,</span>&nbsp;R0</li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">000105FC</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr"><b>BL</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_lua_checkstack_sub_DE9C</li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">00010600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>CMP</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R0<span class="hl_char">,</span>&nbsp;#0</li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">00010604</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LDMNEFD&nbsp;<span class="hl_registr">SP</span><span class="hl_char">!</span><span class="hl_char">,</span>&nbsp;{R3<span class="hl_char">-</span>R5<span class="hl_char">,</span>PC}</li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">00010608</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>CMP</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R4<span class="hl_char">,</span>&nbsp;#0</li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">0001060C</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>MOV</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R0<span class="hl_char">,</span>&nbsp;R5</li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">00010610</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEQ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;loc_10624</span></li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">00010614</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>MOV</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R2<span class="hl_char">,</span>&nbsp;R4</li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">00010618</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LDMFD&nbsp;&nbsp;&nbsp;<span class="hl_registr">SP</span><span class="hl_char">!</span><span class="hl_char">,</span>&nbsp;{R3<span class="hl_char">-</span>R5<span class="hl_char">,</span>LR}</li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">0001061C</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LDR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R1</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">=</span>aStackOverflowS&nbsp;<span class="hl_comment">; &quot;stack overflow (%s)&quot;</span></li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">00010620</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_luaL_error_sub_101AC</span></li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">00010624</span>&nbsp;<span class="hl_comment">; ---------------------------------------------------------------------------</span></li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">00010624</span></li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">00010624</span><span style="word-break: break-all">&nbsp;loc_10624&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; CODE XREF: sub_105EC+24j</span></li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">00010624</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LDR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R1</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">=</span>aStackOverflow&nbsp;<span class="hl_comment">; &quot;stack overflow&quot;</span></li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">00010628</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LDMFD&nbsp;&nbsp;&nbsp;<span class="hl_registr">SP</span><span class="hl_char">!</span><span class="hl_char">,</span>&nbsp;{R3<span class="hl_char">-</span>R5<span class="hl_char">,</span>LR}</li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">0001062C</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_luaL_error_sub_101AC</span></li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">:</span><span class="hl_number">0001062C</span>&nbsp;<span class="hl_comment">; End of function sub_105EC</span></li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=358700&amp;user=15381&amp;forum_n=1&amp;topic=23752.html&amp;page=0&amp;anchor=2" class="addthx" data-post="358700"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]Apokrif[/b]','')">Apokrif</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 171.0 (ветеран), 11thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.5'>Активность: 0.05<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=19416">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 сентября 2015 19:16 &middot; Поправил: Apokrif <br><script type="text/javascript">QU('Apokrif','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Apokrif" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=23752.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
<I>reversecode пишет:<br>это у тебя что то с gcc<br>потому что бай дефолт это</I><br>Извините, я не понял при чём тут &quot;бай дефолт&quot;?<br>В вашем примере все параметры передаются через регистры, а не через стек.<br>У меня в обоих случаях параметры передаются через стек, но адресуются по-разному, через bp/r11 или sp.<br>В остальном весь код с моих вариантах совпадает.<br><br>Для функции из вашего примера, в LUA 5.1.4 она:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">LUALIB_API&nbsp;<span class="hl_function"><b>void</b></span>&nbsp;luaL_checkstack&nbsp;<span class="hl_char">(</span>lua_State&nbsp;<span class="hl_char">*</span>L<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;space<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>const</b></span>&nbsp;<span class="hl_function"><b>char</b></span>&nbsp;<span class="hl_char">*</span>mes<span class="hl_char">)</span>&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">(</span><span class="hl_char">!</span>lua_checkstack<span class="hl_char">(</span>L<span class="hl_char">,</span>&nbsp;space<span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;luaL_error<span class="hl_char">(</span>L<span class="hl_char">,</span>&nbsp;<span class="hl_quote">&quot;stack overflow (%s)&quot;</span><span class="hl_char">,</span>&nbsp;mes<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">}</li>        </ol>
    </div>
</div></div>
<br><br>И gcc4.4.3 БЕЗ оптимизации (-O0) даёт:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">.</span>luaL_checkstack<span class="hl_char">:</span><span class="hl_number">00000770</span>&nbsp;<span class="hl_comment">; void __cdecl luaL_checkstack(lua_State_0 *L, int space, const unsigned __int8 *mes)</span></li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">.</span>luaL_checkstack<span class="hl_char">:</span><span class="hl_number">00000770</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORT&nbsp;luaL_checkstack</li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">.</span>luaL_checkstack<span class="hl_char">:</span><span class="hl_number">00000770</span>&nbsp;luaL_checkstack</li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">.</span>luaL_checkstack<span class="hl_char">:</span><span class="hl_number">00000770</span></li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">.</span>luaL_checkstack<span class="hl_char">:</span><span class="hl_number">00000770</span>&nbsp;mes&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span>0x14</li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">.</span>luaL_checkstack<span class="hl_char">:</span><span class="hl_number">00000770</span>&nbsp;space&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span>0x10</li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">.</span>luaL_checkstack<span class="hl_char">:</span><span class="hl_number">00000770</span>&nbsp;L&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span>0xC</li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">.</span>luaL_checkstack<span class="hl_char">:</span><span class="hl_number">00000770</span>&nbsp;var_4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">4</span></li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">.</span>luaL_checkstack<span class="hl_char">:</span><span class="hl_number">00000770</span></li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">.</span>luaL_checkstack<span class="hl_char">:</span><span class="hl_number">00000770</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>STR</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LR<span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">SP</span><span class="hl_char">,</span>#var_4<span class="hl_char">]</span><span class="hl_char">!</span></li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">.</span>luaL_checkstack<span class="hl_char">:</span><span class="hl_number">00000774</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>SUB</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">SP</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">SP</span><span class="hl_char">,</span>&nbsp;#0x14</li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">.</span>luaL_checkstack<span class="hl_char">:</span><span class="hl_number">00000778</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>STR</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R0<span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">SP</span><span class="hl_char">,</span>#0x18<span class="hl_char">+</span>L<span class="hl_char">]</span></li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">.</span>luaL_checkstack<span class="hl_char">:</span><span class="hl_number">0000077C</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>STR</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R1<span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">SP</span><span class="hl_char">,</span>#0x18<span class="hl_char">+</span>space<span class="hl_char">]</span></li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">.</span>luaL_checkstack<span class="hl_char">:</span><span class="hl_number">00000780</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>STR</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R2<span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">SP</span><span class="hl_char">,</span>#0x18<span class="hl_char">+</span>mes<span class="hl_char">]</span></li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">.</span>luaL_checkstack<span class="hl_char">:</span><span class="hl_number">00000784</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LDR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R0</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">SP</span><span class="hl_char">,</span>#0x18<span class="hl_char">+</span>L<span class="hl_char">]</span></li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">.</span>luaL_checkstack<span class="hl_char">:</span><span class="hl_number">00000788</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LDR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R1</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">SP</span><span class="hl_char">,</span>#0x18<span class="hl_char">+</span>space<span class="hl_char">]</span></li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">.</span>luaL_checkstack<span class="hl_char">:</span><span class="hl_number">0000078C</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr"><b>BL</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lua_checkstack&nbsp;&nbsp;<span class="hl_comment">; PIC mode</span></li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">.</span>luaL_checkstack<span class="hl_char">:</span><span class="hl_number">00000790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>MOV</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R3<span class="hl_char">,</span>&nbsp;R0</li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">.</span>luaL_checkstack<span class="hl_char">:</span><span class="hl_number">00000794</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>CMP</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R3<span class="hl_char">,</span>&nbsp;#0</li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">.</span>luaL_checkstack<span class="hl_char">:</span><span class="hl_number">00000798</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BNE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;loc_7B4</span></li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">.</span>luaL_checkstack<span class="hl_char">:</span><span class="hl_number">0000079C</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LDR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R0</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">SP</span><span class="hl_char">,</span>#0x18<span class="hl_char">+</span>L<span class="hl_char">]</span>&nbsp;<span class="hl_comment">; L</span></li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">.</span>luaL_checkstack<span class="hl_char">:</span><span class="hl_number">000007A0</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LDR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R3</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">=</span><span class="hl_char">(</span>unk_19F<span class="hl_char">-</span>0x88B<span class="hl_char">)</span></li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">.</span>luaL_checkstack<span class="hl_char">:</span><span class="hl_number">000007A4</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>ADD</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R3<span class="hl_char">,</span>&nbsp;PC<span class="hl_char">,</span>&nbsp;R3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; &quot;stack overflow (%s)&quot;</span></li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">.</span>luaL_checkstack<span class="hl_char">:</span><span class="hl_number">000007A8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>MOV</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R1<span class="hl_char">,</span>&nbsp;R3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; fmt</span></li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">.</span>luaL_checkstack<span class="hl_char">:</span><span class="hl_number">000007AC</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LDR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R2</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">SP</span><span class="hl_char">,</span>#0x18<span class="hl_char">+</span>mes<span class="hl_char">]</span></li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">.</span>luaL_checkstack<span class="hl_char">:</span><span class="hl_number">000007B0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr"><b>BL</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;luaL_error&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; PIC mode</span></li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">.</span>luaL_checkstack<span class="hl_char">:</span><span class="hl_number">000007B4</span></li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">.</span>luaL_checkstack<span class="hl_char">:</span><span class="hl_number">000007B4</span><span style="word-break: break-all">&nbsp;loc_7B4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; CODE XREF: luaL_checkstack+28 j</span></li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">.</span>luaL_checkstack<span class="hl_char">:</span><span class="hl_number">000007B4</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>ADD</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">SP</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">SP</span><span class="hl_char">,</span>&nbsp;#0x14</li><li class="hl_l1"><span class="hl_char">.</span>text<span class="hl_char">.</span>luaL_checkstack<span class="hl_char">:</span><span class="hl_number">000007B8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LDMFD&nbsp;&nbsp;&nbsp;<span class="hl_registr">SP</span><span class="hl_char">!</span><span class="hl_char">,</span>&nbsp;{PC}</li><li class="hl_l0"><span class="hl_char">.</span>text<span class="hl_char">.</span>luaL_checkstack<span class="hl_char">:</span><span class="hl_number">000007B8</span>&nbsp;<span class="hl_comment">; End of function luaL_checkstack</span></li>        </ol>
    </div>
</div></div>
<br>Т.е. точно также все параметры передаются через стек, а не через регистры.<br>У вас похоже включена оптимизация (-O)<br>Скомпилите с <b>-frecord-options-in-elf</b> и посмотрите ваши ключи.<br><br>Или вы что-то другое имели ввиду?<br><br><b>Добавлено спустя 1 час 20 минут</b><br>Уф, вроде разобрался! <img src="img/smilies/s5.gif" alt=""><br>Android NDK генерит ключи <i class=x>... -O2 -fomit-frame-pointer ... -O0 ...</i><br>&quot;<i class=x>-O2 -fomit-frame-pointer</i>&quot; - всегда автоматом, даже в debug mode<br>&quot;<i class=x>-O0</i>&quot; - моё<br>В результате получается -fomit-frame-pointer [<b>enabled</b>]<br>Поменял своё на <i class=x>-O0 -f<b>no-omit-frame-pointer</b></i> и получил -fomit-frame-pointer [<b>disabled</b>]<br>И код совпал один в один! <img src="img/smilies/s1.gif" alt=""><br><br><b>Модераторы, вряд ли это тема кому интересно, может просто стереть её?</b>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=358717&amp;user=19416&amp;forum_n=1&amp;topic=23752.html&amp;page=0&amp;anchor=3" class="addthx" data-post="358717"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/green.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=1&sortBy=0&page=0.html"><b>Основной форум</b></a> <b class=bulletHead>&#8212;&#8250;</b> gcc -&gt; сгенерить FLIRT сигнатуры</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#4" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="1">
<input type="hidden" name="topic" value="23752">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=23752" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
