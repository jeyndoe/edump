<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Блог DenCoder&#039;а - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Всем привет! Всем здоровья, достатка, удачи, успехов... всех благ! ) Вот и нашлось немножко времени, чтобы завести блог. Давно хотел, но время для меня на вес золота... С вашего позволения здесь буду описывать процессы">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b> (+5 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/blog.png" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=12&sortBy=0&page=0.html"><b>Дневники и блоги</b></a> <b class=bulletHead>&#8212;&#8250;</b> Блог DenCoder&#039;а</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> <a href="action=vthread&amp;forum=12&amp;topic=23661&amp;page=0.html">&lt;&lt;</a> .  <a href="action=vthread&amp;forum=12&amp;topic=23661&amp;page=0.html">1</a> . <b>2</b> . <a href="action=vthread&amp;forum=12&amp;topic=23661&amp;page=2.html">3</a> . <a href="action=vthread&amp;forum=12&amp;topic=23661&amp;page=2.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 221thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 июля 2015 15:23 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=12&amp;topic=23661&amp;page=1#1');return false;">#1</a> </span><div align=left><br>
Всем привет! Всем здоровья, достатка, удачи, успехов... всех благ! )<br><br>Вот и нашлось немножко времени, чтобы завести блог. Давно хотел, но время для меня на вес золота...<br><br>С вашего позволения здесь буду описывать процессы обхода/взлома/разбора защит, с которыми приходилось сталкиваться. Кому-то может пригодиться, кому-то - нет... Но за время работы немного узнал, что есть такая защита, перед которой некоторые коллеги пасуют - VMProtect. Может, в общем и есть такие страшные версии вмпрота, на которые терять кучу времени бессмысленно - не знаю, я с такими не сталкивался. Но скажу, что очень часто снимать вмпрот или разбирать то, что им накрыто, просто нет необходимости!<br><br>Вмпроты, которые мне попались в мае (сразу 2 подряд) - не такие страшные. Первым из них была накрыта lockpdfu.dll - компонент DRM защиты pdf-ок. Подробнее <noindex><a href="https://exelab.ru/f/?action=vthread&amp;forum=1&amp;topic=22687" rel="nofollow" target="_blank">--&gt; здесь &lt;--</a></noindex>.<br>Человек 2 или 3 года ждал, когда же, наконец, найдётся кто-нибудь, кто даст возможность свободно пользоваться pdf-документами на любом компе и редактировать. И находился некто с других сайтов, кто чуть не кинул... Попробую объяснить морально-идеологический аспект в двух словах прежде всего:<br><br>Человек - учитель, ему необходим учебный материал без ограничений использования с возможностью редактировать. Одна из купленных тетрадей, на файле которой я помогал решить задачу, стоила что-то вроде 70 гривен, использовать можно только на 2х компах и никак нельзя что-то пометить, что-то исправить. Чтобы, например, поделиться с учениками, сколько-то нужно дополнительно проплачивать... мда... куда катится мир, одни то ли бизнесмены, то ли барыги...<br><br>Ставим задачу: перехватить расшифровку запротекченной тетради, записать в отдельную папку оригинальный pdf.<br><br>Из совета Vovan666 <I>запротектил пдф-ку персональной версией, после чего без проблем из памяти AcroRd32 достал чистую pdf-ку.</I> честно говоря, не понял про протект персональной версией, но проверил можно ли что-то из памяти выцепить: даже и обычные pdf-ки в первозданном виде в памяти не хранятся, сигнатур %pdf-1.4 .. %pdf-1.7 нет. То, что находится с такой сигной - какая-то полоска для самого ридера )<br><br>Я пошёл своим путём. Раз нельзя выцепить из памяти - незаметно (для защиты) встанем на место после декрипта и незаметно сольём поток в файл. Звучит просто, но пришлось немного попотеть... <br><br>CreateFile, SetFilePointer, CloseHandle удалось хукнуть джампом без проблем. А вот ветка кода из acrord32.dll, вызывающая чтение функой ReadFile была хукнута в NtReadFile защитой + каким-то магическим образом проверялся crc этой ветки, а также защита не давала поставить ни софт бряк, ни джамп на ReadFile ни до, ни внутри, ни после... в дрова лезть не будем! Софт бряк нельзя поставить, а против харда защита ничего не имеет против! <img src="img/smilies/s1.gif" alt=""> Вспомнил, что имеется такая функция AddVectoredExceptionHandler и быстро нарисовалась идея (что не я - первооткрыватель, знаю, потому и пишу, что вспомнил) поставить 2 харда на ReadFile и после и обрабтать по своему. Потратил немножко времени на кодинг, но удалось, с первой подзадачей справился, осталось только записать файл.<br><br>Записать файл - тут кажется, проще не бывает. Но во-первых под 7кой и выше нужно перевести для этого акроридер в незащищённый режим, чтобы были привилегии, во-вторых - NtWriteFile также хукнута защитой и возвращала жестокий AD. Снимать хук без изучения защиты бесполезно - работать как надо не будет. ReadFile, WriteFile - так защита обменивалась какими-то важными данными. Не стал тратить время на изучение механизмов, сделал проще: против вызова NtWriteFile в месте после хука защита тоже ничего не имела против. Тут, я думаю, подробности излишни, в ntdll индексы всех фунок(nt-сервисов) идут по возрастающей по порядку во всех версиях винды, не встречалось другого(берём адрес хукнутого сервиса, находим следующий/предыдущий, берём оттуда индекс сервиса и минус/плюс 1) <img src="img/smilies/s1.gif" alt=""><br><br>Новичкам с опытом кодинга может быть полезно <img src="img/smilies/s2.gif" alt=""><br><br>В следующий раз (может быть сегодня вечером, может и через года 2) опишу отлом какой-то из версий вмпрота под x64, где тоже есть морально-идеологический аспект
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=356852&amp;user=24257&amp;forum_n=12&amp;topic=23661&amp;page=1&amp;anchor=1" class="addthx" data-post="356852"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=31932" title="02-12-2015 19:11, ранг:3.2" target="_blank">TLN</a>, <a href="action=userinfo&user=42835" title="21-07-2017 00:14, ранг:0.0" target="_blank">Zoeken</a></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 221thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 24 декабря 2015 10:54 <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=12&amp;topic=23661&amp;page=1#2');return false;">#2</a> </span><div align=left><br>
Тут интересную штуку нашёл. Поделюсь позже и может быть!... Но по всему одно из трёх -<br>1) либо это баг вмпрота с 3мя различными вм(2 с декрементом vmp, 1 с инкрементом)<br>2) либо часть ключа проверяется раньше и при верности по вычисленному происходит <b>корректная</b> вторая распаковка(немыслимая гипотеза, но всё же)<br>3) либо в 3ей вм заложен механизм перезаписи указателей на хендлеры примитивов<br><br>Пока продолжаю анализ...
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=361052&amp;user=24257&amp;forum_n=12&amp;topic=23661&amp;page=1&amp;anchor=2" class="addthx" data-post="361052"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 221thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 декабря 2015 16:13 <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=12&amp;topic=23661&amp;page=1#3');return false;">#3</a> </span><div align=left><br>
Стыдно признаться, попробую оправдаться тем, что меня много вещей отвлекли, но это не оправдание... 100% верный вариант - 4) банально глупая ошибка оказалась у меня... <img src="img/smilies/s4.gif" alt="">
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=361279&amp;user=24257&amp;forum_n=12&amp;topic=23661&amp;page=1&amp;anchor=3" class="addthx" data-post="361279"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 221thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 30 декабря 2015 22:25 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=12&amp;topic=23661&amp;page=1#4');return false;">#4</a> </span><div align=left><br>
<I>MasterSoft пишет:<br>Code:<br>type=activation&amp;code=<br>type=deactivation&amp;hash=<br>activation.php?code=<br>deactivation.php?hash= </I><br>Строки шифрованы? Если нет - то в моих экземплярах не нашёл. Перебирать индексы строк и подавать на вход функции дешифратора ленновато под Новый Год <img src="img/smilies/s1.gif" alt="">
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=361529&amp;user=24257&amp;forum_n=12&amp;topic=23661&amp;page=1&amp;anchor=4" class="addthx" data-post="361529"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]MasterSoft[/b]','')">MasterSoft</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 281.8 (наставник), 272thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.17'>Активность: 0.25<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=16624">Участник</a><br><font color=blue>Destroyer of protectors</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 30 декабря 2015 22:28 &middot; Поправил: MasterSoft <br><script type="text/javascript">QU('MasterSoft','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=MasterSoft" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=12&amp;topic=23661&amp;page=1#5');return false;">#5</a> </span><div align=left><br>
<I>DenCoder пишет:<br>Строки шифрованы? Если нет - то в моих экземплярах не нашёл. Перебирать индексы строк и подавать на вход функции дешифратора ленновато под Новый Год   </I><br>да ладно? дайте файл я найду)))<br><br><b>Added:</b><br><I>DenCoder пишет:<br>да нету там вашего!!! <img src="img/smilies/s1.gif" alt=""> </I><br>ну нету так нету, как скажете <img src="img/smilies/s1.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=361530&amp;user=16624&amp;forum_n=12&amp;topic=23661&amp;page=1&amp;anchor=5" class="addthx" data-post="361530"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 221thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 февраля 2016 06:21 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=12&amp;topic=23661&amp;page=1#6');return false;">#6</a> </span><div align=left><br>
<I>MasterSoft пишет:<br>дайте файл я найду)) </I><br>да нету там вашего!!! <img src="img/smilies/s1.gif" alt=""><br><br>Итог за уходящий год и вновь пришедший:<br>VMProtect - ерунда... есть планы и разнятся с поставленными задачами...<br>ARM - ерунда... привыкнуть надо...<br>Hex-Rays - не понимаю тех людей, кто им пользуется... для меня изначальный вид в асме проще для понимания, чем си-код, полученный им...<br>mips - ерунда... с delay slot&#039;ами...<br><br>Отдельно о mips&#039;е:<br>Была поставлена задача. Срок выполнения был оценен расплывчато - от 3х недель до 2 месяцев. И должен сообщить, что достиг-таки того уровня, который позволил мне, не взирая на все проблемы, уложиться в минимальный из поставленных - 3 недели и 2 лня.<br><br>Были проделаны работы:<br>1) выяснение формата редчайшей файловой системы - заказчик выяснил бОльшую часть, я устранил некоторые ошибки<br>2) формат файлов конфигов - полностью на мне необходимый минимум для запуска девайса<br>3) написание утилиты для вставки и редактирования файлов в эту фс<br>4) выяснение конкретных данных, алго преобразования их из употребительного вида в исходный вид в файле...<br>5) прочий реверс в сочетании с ручным декомпилем особо важных частей кода<br>...<br><br>Сейчас <strike>я осознаю</strike> под впечатлением кажущейся мелочности всей проделанной работы. Но на истоке её.............  не было не то что вёсел, да и лодки не было...  Не осознаю полностью, да и незачем это сейчас, какова работа была проделана. Но если б знать бы заранее, каким курсом надо было плыть к цели - за 2-3 дня при должном усердии можно б было достичь причала! Это невозможно было лишь потому, что и некоторые знания заказчика зависели от качества моего реверса... А это всегда неотъемлемое время!<br><br>Какое отличие от всех ранее проделанных работ по другим проектам - впервые за всю свою жизнь не увидел индусского говнокода, и заказчик хорошо железно подкован... Хоть местами своими догадками и мешали друг другу наполовину, сработались отлично в общем!<br><br>Вот и всё! Никакой конкретики несколько лет к ряду, всё только для истории...
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=362931&amp;user=24257&amp;forum_n=12&amp;topic=23661&amp;page=1&amp;anchor=6" class="addthx" data-post="362931"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 221thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 февраля 2016 17:47 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=12&amp;topic=23661&amp;page=1#7');return false;">#7</a> </span><div align=left><br>
<I>DenCoder пишет:<br>VMProtect - ерунда... есть планы и разнятся с поставленными задачами... </I><br>Я часто писал, что где работаю, туда ветер и дует. И всегда есть желанный причал, куда не доплыть галсом на порывах... где можно не только переоборудоваться и запастись провизией...<br><br>Нашёл для себя, что есть парусное дело, законы аэродинамики -  ветер нельзя изменить, но можно повернуть парус! Веков ещё 20 назад сила ветра использовалась в своих целях независимо от его направления. Можно даже плыть и против ветра - бейдевиндом. Маневрируя в нужные моменты плюсом и минусом угла между ветром и курсом...<br><br>И вот вопрос - можно ли по принципу аналогии подчинить себе в реверс-инжиниринге &quot;ветер&quot;? Можно ли придумать такую систему &quot;парусов&quot; и манёвров, чтобы независимо от специфики проекта, мы продолжали двигаться тем же курсом? Если ветер - абстрактный вектор специфики проекта, сила ветра - ход работы над ним, в роли паруса - знания и опыт, то какие манёвры тут есть?...<br><br>Самый главный вопрос - применима ли здесь аналогия? Очень бы хотелось, но, похоже, не в 3х-мерной геометрии это возможно... На аналогии если ехать, можно мозг сломать, но под пиратскую тему она очень подходит. <img src="img/smilies/s1.gif" alt=""><br><br>В общем, в планах &quot;побывать-таки на 9 крупных причалах&quot;. И что-нибудь придумаю!...
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=363086&amp;user=24257&amp;forum_n=12&amp;topic=23661&amp;page=1&amp;anchor=7" class="addthx" data-post="363086"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 221thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 марта 2016 15:46 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=12&amp;topic=23661&amp;page=1#8');return false;">#8</a> </span><div align=left><br>
Столкнулся с FlexLM. Забавно, но как будто копия VMProtect. Логика такая же, только код невиртуализирован:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cmp</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">rbp</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">rbp</span><span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>offset</b></span>&nbsp;causerOfBug_Chunk_bp1R_m9_bp1L</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>xchg</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">rbp</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">rsp</span><span class="hl_char">]</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">rcx</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">rdx</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">rcx</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">rsp</span><span class="hl_char">+</span><span class="hl_number">10h</span><span class="hl_char">]</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">rdx</span><span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>offset</b></span>&nbsp;causerOfBug_Chunk_bp1R_m6</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cmovb</b></span>&nbsp;&nbsp;&nbsp;<span class="hl_registr">rcx</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">rdx</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">[</span><span class="hl_registr">rsp</span><span class="hl_char">+</span><span class="hl_number">10h</span><span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">rcx</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>pop</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">rdx</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>pop</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">rcx</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">retn</span></li>        </ol>
    </div>
</div></div>
<br><br>Примерно такой же вид принял бы девиртуализированный с вмпрота байт-код конца каждой ленты с ветвлением.<br><br>Продолжение следует....
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=363388&amp;user=24257&amp;forum_n=12&amp;topic=23661&amp;page=1&amp;anchor=8" class="addthx" data-post="363388"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 221thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 15 марта 2016 21:04 <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=12&amp;topic=23661&amp;page=1#9');return false;">#9</a> </span><div align=left><br>
Ида лажает на spd (Stack Pointer Delta) на функциях с мелкими фрагментами, размазанными по образу. Написал скрипт для фикса<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">#include&nbsp;<span class="hl_char">&lt;</span>idc<span class="hl_char">.</span>idc<span class="hl_char">&gt;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">static&nbsp;recursFunc<span class="hl_char">(</span>curChunk<span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;auto&nbsp;x<span class="hl_char">,</span>&nbsp;y<span class="hl_char">,</span>&nbsp;arid&nbsp;<span class="hl_char">=</span>&nbsp;GetArrayId<span class="hl_char">(</span><span class="hl_quote">&quot;chunks&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;idx<span class="hl_char">,</span>&nbsp;addLong<span class="hl_char">,</span>&nbsp;forgot<span class="hl_char">,</span>&nbsp;fch<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;do</li><li class="hl_l0">&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;forgot&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;Message<span class="hl_char">(</span><span class="hl_quote">&quot;curChunk %x\n&quot;</span><span class="hl_char">,</span>&nbsp;curChunk<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;<span class="hl_char">=</span>&nbsp;BADADDR<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;for<span class="hl_char">(</span>x&nbsp;<span class="hl_char">=</span>&nbsp;Rfirst<span class="hl_char">(</span>curChunk<span class="hl_char">)</span><span class="hl_comment">; x != BADADDR; x = Rnext(curChunk, x))</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span><span class="hl_char">(</span>XrefType<span class="hl_char">(</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">&amp;</span>&nbsp;0x1f<span class="hl_char">)</span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;fl_JN<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fch&nbsp;<span class="hl_char">=</span>&nbsp;FirstFuncFchunk<span class="hl_char">(</span>curChunk<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">while</span><span class="hl_char">(</span>fch&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;BADADDR<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>x&nbsp;<span class="hl_char">&gt;</span><span class="hl_char">=</span>&nbsp;GetFchunkAttr<span class="hl_char">(</span>fch<span class="hl_char">,</span>&nbsp;FUNCATTR_START<span class="hl_char">)</span>&nbsp;<span class="hl_char">&amp;</span><span class="hl_char">&amp;</span>&nbsp;x&nbsp;<span class="hl_char">&lt;</span><span class="hl_char">=</span>&nbsp;GetFchunkAttr<span class="hl_char">(</span>fch<span class="hl_char">,</span>&nbsp;FUNCATTR_END<span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>break</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fch&nbsp;<span class="hl_char">=</span>&nbsp;NextFuncFchunk<span class="hl_char">(</span>x<span class="hl_char">,</span>&nbsp;fch<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>fch&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;BADADDR<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx&nbsp;<span class="hl_char">=</span>&nbsp;GetFirstIndex<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;arid<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">while</span><span class="hl_char">(</span>idx&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>x&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;GetArrayElement<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;arid<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forgot&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>break</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx&nbsp;<span class="hl_char">=</span>&nbsp;GetNextIndex<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;arid<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>forgot&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span><span class="hl_function">Byte</span><span class="hl_char">(</span>curChunk<span class="hl_char">)</span>&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;0xc3<span class="hl_char">)</span>&nbsp;addLong&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>else</b></span>&nbsp;addLong&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">8</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto&nbsp;xSpd&nbsp;<span class="hl_char">=</span>&nbsp;GetSpd<span class="hl_char">(</span>x<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>__int64<span class="hl_char">(</span>xSpd<span class="hl_char">)</span>&nbsp;<span class="hl_char">&lt;</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span>&nbsp;Message<span class="hl_char">(</span><span class="hl_quote">&quot;next %x spd before -%x\n&quot;</span><span class="hl_char">,</span>&nbsp;x<span class="hl_char">,</span>&nbsp;<span class="hl_char">-</span>GetSpd<span class="hl_char">(</span>x<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>else</b></span>&nbsp;Message<span class="hl_char">(</span><span class="hl_quote">&quot;next %x spd before %x\n&quot;</span><span class="hl_char">,</span>&nbsp;x<span class="hl_char">,</span>&nbsp;GetSpd<span class="hl_char">(</span>x<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>GetSpd<span class="hl_char">(</span>x<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;addLong&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;GetSpd<span class="hl_char">(</span>curChunk<span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AddUserStkPnt<span class="hl_char">(</span>x<span class="hl_char">,</span>&nbsp;&nbsp;GetSpDiff<span class="hl_char">(</span>x<span class="hl_char">)</span>&nbsp;<span class="hl_char">-</span>&nbsp;GetSpd<span class="hl_char">(</span>x<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;GetSpd<span class="hl_char">(</span>curChunk<span class="hl_char">)</span>&nbsp;<span class="hl_char">-</span>&nbsp;addLong<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xSpd&nbsp;<span class="hl_char">=</span>&nbsp;GetSpd<span class="hl_char">(</span>x<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>__int64<span class="hl_char">(</span>xSpd<span class="hl_char">)</span>&nbsp;<span class="hl_char">&lt;</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span>&nbsp;Message<span class="hl_char">(</span><span class="hl_quote">&quot;next %x spd after -%x\n&quot;</span><span class="hl_char">,</span>&nbsp;x<span class="hl_char">,</span>&nbsp;<span class="hl_char">-</span>xSpd<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>else</b></span>&nbsp;Message<span class="hl_char">(</span><span class="hl_quote">&quot;next %x spd after %x\n&quot;</span><span class="hl_char">,</span>&nbsp;x<span class="hl_char">,</span>&nbsp;xSpd<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>y&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;BADADDR<span class="hl_char">)</span>&nbsp;y&nbsp;<span class="hl_char">=</span>&nbsp;x<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">else</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx&nbsp;<span class="hl_char">=</span>&nbsp;GetLastIndex<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;arid<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetArrayLong<span class="hl_char">(</span>arid<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">,</span>&nbsp;x<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>else</b></span>&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span><span class="hl_char">(</span>XrefType<span class="hl_char">(</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">&amp;</span>&nbsp;0x1f<span class="hl_char">)</span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;fl_F<span class="hl_char">)</span>&nbsp;y&nbsp;<span class="hl_char">=</span>&nbsp;x<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>y&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;BADADDR<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx&nbsp;<span class="hl_char">=</span>&nbsp;GetFirstIndex<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;arid<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>idx&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;<span class="hl_char">=</span>&nbsp;GetArrayElement<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;arid<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DelArrayElement<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;arid<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;curChunk&nbsp;<span class="hl_char">=</span>&nbsp;y<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;}while<span class="hl_char">(</span>y&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;BADADDR<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;return&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l0">}</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">static&nbsp;main<span class="hl_char">(</span><span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;auto&nbsp;curChunk<span class="hl_char">,</span>&nbsp;arid<span class="hl_char">,</span>&nbsp;result<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;curChunk&nbsp;<span class="hl_char">=</span>&nbsp;FirstFuncFchunk<span class="hl_char">(</span>ScreenEA<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;do</li><li class="hl_l1">&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;arid&nbsp;<span class="hl_char">=</span>&nbsp;CreateArray<span class="hl_char">(</span><span class="hl_quote">&quot;chunks&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;<span class="hl_char">=</span>&nbsp;recursFunc<span class="hl_char">(</span>curChunk<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;DeleteArray<span class="hl_char">(</span>arid<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;}while<span class="hl_char">(</span>result&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;Message<span class="hl_char">(</span><span class="hl_quote">&quot;Done!&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">}</li>        </ol>
    </div>
</div></div>
<br><br>Скрипт специфический под x86/x64 из-за инструкции ret с кодом 0xc3. Но и под другие платформы можно заюзать, если заменить этот опкод на нужный.<br>Не хватает правда пока фиксов для некоторых иснтрукций, типа lea rsp, [rsp - 8]. Но это нетрудно, если надоест вручную править spd после таких, то вставлю пару строчек.<br><br><b>Добавлено спустя 17 часов 36 минут</b><br>Поправил скрипт, теперь в нём учитываются циклы, и это не зацикливает его в 50% случаев.<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">#include&nbsp;<span class="hl_char">&lt;</span>idc<span class="hl_char">.</span>idc<span class="hl_char">&gt;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">static&nbsp;recursFunc<span class="hl_char">(</span>curChunk<span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;auto&nbsp;x<span class="hl_char">,</span>&nbsp;y<span class="hl_char">,</span>&nbsp;arid&nbsp;<span class="hl_char">=</span>&nbsp;GetArrayId<span class="hl_char">(</span><span class="hl_quote">&quot;chunks&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;arIdComp&nbsp;<span class="hl_char">=</span>&nbsp;GetArrayId<span class="hl_char">(</span><span class="hl_quote">&quot;CompChunks&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;idx<span class="hl_char">,</span>&nbsp;addLong<span class="hl_char">,</span>&nbsp;forgot<span class="hl_char">,</span>&nbsp;fch<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;do</li><li class="hl_l0">&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;forgot&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;Message<span class="hl_char">(</span><span class="hl_quote">&quot;curChunk %x\n&quot;</span><span class="hl_char">,</span>&nbsp;curChunk<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;<span class="hl_char">=</span>&nbsp;BADADDR<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;for<span class="hl_char">(</span>x&nbsp;<span class="hl_char">=</span>&nbsp;Rfirst<span class="hl_char">(</span>curChunk<span class="hl_char">)</span><span class="hl_comment">; x != BADADDR; x = Rnext(curChunk, x))</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span><span class="hl_char">(</span>XrefType<span class="hl_char">(</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">&amp;</span>&nbsp;0x1f<span class="hl_char">)</span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;fl_JN<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fch&nbsp;<span class="hl_char">=</span>&nbsp;FirstFuncFchunk<span class="hl_char">(</span>curChunk<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">while</span><span class="hl_char">(</span>fch&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;BADADDR<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>x&nbsp;<span class="hl_char">&gt;</span><span class="hl_char">=</span>&nbsp;GetFchunkAttr<span class="hl_char">(</span>fch<span class="hl_char">,</span>&nbsp;FUNCATTR_START<span class="hl_char">)</span>&nbsp;<span class="hl_char">&amp;</span><span class="hl_char">&amp;</span>&nbsp;x&nbsp;<span class="hl_char">&lt;</span><span class="hl_char">=</span>&nbsp;GetFchunkAttr<span class="hl_char">(</span>fch<span class="hl_char">,</span>&nbsp;FUNCATTR_END<span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>break</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fch&nbsp;<span class="hl_char">=</span>&nbsp;NextFuncFchunk<span class="hl_char">(</span>x<span class="hl_char">,</span>&nbsp;fch<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>fch&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;BADADDR<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx&nbsp;<span class="hl_char">=</span>&nbsp;GetFirstIndex<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;arid<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">while</span><span class="hl_char">(</span>idx&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>x&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;GetArrayElement<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;arid<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forgot&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>break</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx&nbsp;<span class="hl_char">=</span>&nbsp;GetNextIndex<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;arid<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx&nbsp;<span class="hl_char">=</span>&nbsp;GetFirstIndex<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;arIdComp<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">while</span><span class="hl_char">(</span>idx&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>x&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;GetArrayElement<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;arIdComp<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forgot&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>break</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx&nbsp;<span class="hl_char">=</span>&nbsp;GetNextIndex<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;arIdComp<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>forgot&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span><span class="hl_function">Byte</span><span class="hl_char">(</span>curChunk<span class="hl_char">)</span>&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;0xc3<span class="hl_char">)</span>&nbsp;addLong&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>else</b></span>&nbsp;addLong&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">8</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto&nbsp;xSpd&nbsp;<span class="hl_char">=</span>&nbsp;GetSpd<span class="hl_char">(</span>x<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>__int64<span class="hl_char">(</span>xSpd<span class="hl_char">)</span>&nbsp;<span class="hl_char">&lt;</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span>&nbsp;Message<span class="hl_char">(</span><span class="hl_quote">&quot;next %x spd before -%x\n&quot;</span><span class="hl_char">,</span>&nbsp;x<span class="hl_char">,</span>&nbsp;<span class="hl_char">-</span>GetSpd<span class="hl_char">(</span>x<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>else</b></span>&nbsp;Message<span class="hl_char">(</span><span class="hl_quote">&quot;next %x spd before %x\n&quot;</span><span class="hl_char">,</span>&nbsp;x<span class="hl_char">,</span>&nbsp;GetSpd<span class="hl_char">(</span>x<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>GetSpd<span class="hl_char">(</span>x<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;addLong&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;GetSpd<span class="hl_char">(</span>curChunk<span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AddUserStkPnt<span class="hl_char">(</span>x<span class="hl_char">,</span>&nbsp;&nbsp;GetSpDiff<span class="hl_char">(</span>x<span class="hl_char">)</span>&nbsp;<span class="hl_char">-</span>&nbsp;GetSpd<span class="hl_char">(</span>x<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;GetSpd<span class="hl_char">(</span>curChunk<span class="hl_char">)</span>&nbsp;<span class="hl_char">-</span>&nbsp;addLong<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xSpd&nbsp;<span class="hl_char">=</span>&nbsp;GetSpd<span class="hl_char">(</span>x<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>__int64<span class="hl_char">(</span>xSpd<span class="hl_char">)</span>&nbsp;<span class="hl_char">&lt;</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span>&nbsp;Message<span class="hl_char">(</span><span class="hl_quote">&quot;next %x spd after -%x\n&quot;</span><span class="hl_char">,</span>&nbsp;x<span class="hl_char">,</span>&nbsp;<span class="hl_char">-</span>xSpd<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>else</b></span>&nbsp;Message<span class="hl_char">(</span><span class="hl_quote">&quot;next %x spd after %x\n&quot;</span><span class="hl_char">,</span>&nbsp;x<span class="hl_char">,</span>&nbsp;xSpd<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>y&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;BADADDR<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;<span class="hl_char">=</span>&nbsp;x<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx&nbsp;<span class="hl_char">=</span>&nbsp;GetLastIndex<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;arIdComp<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetArrayLong<span class="hl_char">(</span>arIdComp<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">,</span>&nbsp;x<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">else</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx&nbsp;<span class="hl_char">=</span>&nbsp;GetLastIndex<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;arid<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetArrayLong<span class="hl_char">(</span>arid<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">,</span>&nbsp;x<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>else</b></span>&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span><span class="hl_char">(</span>XrefType<span class="hl_char">(</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">&amp;</span>&nbsp;0x1f<span class="hl_char">)</span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;fl_F<span class="hl_char">)</span>&nbsp;y&nbsp;<span class="hl_char">=</span>&nbsp;x<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>y&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;BADADDR<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx&nbsp;<span class="hl_char">=</span>&nbsp;GetFirstIndex<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;arid<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>idx&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;<span class="hl_char">=</span>&nbsp;GetArrayElement<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;arid<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DelArrayElement<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;arid<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx&nbsp;<span class="hl_char">=</span>&nbsp;GetLastIndex<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;arIdComp<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetArrayLong<span class="hl_char">(</span>arIdComp<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">,</span>&nbsp;y<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;curChunk&nbsp;<span class="hl_char">=</span>&nbsp;y<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;}while<span class="hl_char">(</span>y&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;BADADDR<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;return&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l0">}</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">static&nbsp;main<span class="hl_char">(</span><span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;auto&nbsp;curChunk<span class="hl_char">,</span>&nbsp;arid<span class="hl_char">,</span>&nbsp;arIdComp<span class="hl_char">,</span>&nbsp;result<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;curChunk&nbsp;<span class="hl_char">=</span>&nbsp;FirstFuncFchunk<span class="hl_char">(</span>ScreenEA<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;do</li><li class="hl_l1">&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;arid&nbsp;<span class="hl_char">=</span>&nbsp;CreateArray<span class="hl_char">(</span><span class="hl_quote">&quot;chunks&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;arIdComp&nbsp;<span class="hl_char">=</span>&nbsp;CreateArray<span class="hl_char">(</span><span class="hl_quote">&quot;CompChunks&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;<span class="hl_char">=</span>&nbsp;recursFunc<span class="hl_char">(</span>curChunk<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;DeleteArray<span class="hl_char">(</span>arid<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;DeleteArray<span class="hl_char">(</span>arIdComp<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;}while<span class="hl_char">(</span>result&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;Message<span class="hl_char">(</span><span class="hl_quote">&quot;Done!&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">}</li>        </ol>
    </div>
</div></div>
<br><br>Кото-то может заинтересуется, подумав над скриптом, откуда там может быть 2 джампа (fl_JN от одного и того же адреса). Всё просто:<br>ветвление осуществляется, если проще -<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">rsp</span><span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;loc_addr1</li><li class="hl_l1"><span class="hl_char">[</span>любая&nbsp;проверка&nbsp;условия<span class="hl_char">]</span></li><li class="hl_l0"><span class="hl_function"><b>cmovz</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">rsp</span><span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;loc_addr2</li><li class="hl_l1"><span class="hl_function">retn</span></li>        </ol>
    </div>
</div></div>
<br>Чтобы граф красиво выгдядел, и чтоб не путаться при 200+ фрагментах, очень полезно воспользоваться на адресе с retn такими idc-командами<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">AddCodeXref<span class="hl_char">(</span>ScreenEA<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;loc_addr1<span class="hl_char">,</span>&nbsp;XREF_USER&nbsp;<span class="hl_char">|</span>&nbsp;fl_JN<span class="hl_char">)</span></li><li class="hl_l1">AddCodeXref<span class="hl_char">(</span>ScreenEA<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;loc_addr2<span class="hl_char">,</span>&nbsp;XREF_USER&nbsp;<span class="hl_char">|</span>&nbsp;fl_JN<span class="hl_char">)</span></li>        </ol>
    </div>
</div></div>
<br><br>......<br><br>Может чего в скрипте лишнего написал? Я впервые на них пишу... Перечисление фрагментов неудобно - от меньшего к большему, от того он раздулся. Функция названа RecursFunc() потому, что изначально задумывалось её сделать рекурсивной, но мне показалось, что это будет чревато вылетами бедной иды.<br><br>Отдельный момент вызывает интерес:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">&nbsp;&nbsp;do</li><li class="hl_l1">&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;arid&nbsp;<span class="hl_char">=</span>&nbsp;CreateArray<span class="hl_char">(</span><span class="hl_quote">&quot;chunks&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;arIdComp&nbsp;<span class="hl_char">=</span>&nbsp;CreateArray<span class="hl_char">(</span><span class="hl_quote">&quot;CompChunks&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;<span class="hl_char">=</span>&nbsp;recursFunc<span class="hl_char">(</span>curChunk<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;DeleteArray<span class="hl_char">(</span>arid<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;DeleteArray<span class="hl_char">(</span>arIdComp<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;}while<span class="hl_char">(</span>result&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span><span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div>
<br><br>Почему так? Зачем после первой правки начинать всё сначала? Всё дело в том, что поправив в одном месте spd, необходимо проверить в остальных фрагментах ранее - могут &quot;непредсказуемо&quot; сбиться. Непредсказуемо в кавычках потому, что какая-то логика в &quot;ошибках&quot; иды на самом деле есть. Может, есть какая-то скрытая настройка по части разных сегментов и spd... но это будет отдельная тема...
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=363457&amp;user=24257&amp;forum_n=12&amp;topic=23661&amp;page=1&amp;anchor=9" class="addthx" data-post="363457"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 221thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 16 марта 2016 18:49 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=12&amp;topic=23661&amp;page=1#10');return false;">#10</a> </span><div align=left><br>
Надоело фиксить spd после команд lea rsp, [rsp -/+ 8]. Обновил скрипт. Теперь это делается автоматически.<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">#include&nbsp;<span class="hl_char">&lt;</span>idc<span class="hl_char">.</span>idc<span class="hl_char">&gt;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">static&nbsp;recursFunc<span class="hl_char">(</span>curChunk<span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;auto&nbsp;x<span class="hl_char">,</span>&nbsp;y<span class="hl_char">,</span>&nbsp;arid&nbsp;<span class="hl_char">=</span>&nbsp;GetArrayId<span class="hl_char">(</span><span class="hl_quote">&quot;chunks&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;arIdComp&nbsp;<span class="hl_char">=</span>&nbsp;GetArrayId<span class="hl_char">(</span><span class="hl_quote">&quot;CompChunks&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;idx<span class="hl_char">,</span>&nbsp;addLong<span class="hl_char">,</span>&nbsp;forgot<span class="hl_char">,</span>&nbsp;fch<span class="hl_char">,</span>&nbsp;xSpd<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;do</li><li class="hl_l0">&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;forgot&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;Message<span class="hl_char">(</span><span class="hl_quote">&quot;curChunk %x\n&quot;</span><span class="hl_char">,</span>&nbsp;curChunk<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;<span class="hl_char">=</span>&nbsp;BADADDR<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;for<span class="hl_char">(</span>x&nbsp;<span class="hl_char">=</span>&nbsp;Rfirst<span class="hl_char">(</span>curChunk<span class="hl_char">)</span><span class="hl_comment">; x != BADADDR; x = Rnext(curChunk, x))</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span><span class="hl_char">(</span>XrefType<span class="hl_char">(</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">&amp;</span>&nbsp;0x1f<span class="hl_char">)</span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;fl_JN<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fch&nbsp;<span class="hl_char">=</span>&nbsp;FirstFuncFchunk<span class="hl_char">(</span>curChunk<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">while</span><span class="hl_char">(</span>fch&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;BADADDR<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>x&nbsp;<span class="hl_char">&gt;</span><span class="hl_char">=</span>&nbsp;GetFchunkAttr<span class="hl_char">(</span>fch<span class="hl_char">,</span>&nbsp;FUNCATTR_START<span class="hl_char">)</span>&nbsp;<span class="hl_char">&amp;</span><span class="hl_char">&amp;</span>&nbsp;x&nbsp;<span class="hl_char">&lt;</span><span class="hl_char">=</span>&nbsp;GetFchunkAttr<span class="hl_char">(</span>fch<span class="hl_char">,</span>&nbsp;FUNCATTR_END<span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>break</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fch&nbsp;<span class="hl_char">=</span>&nbsp;NextFuncFchunk<span class="hl_char">(</span>x<span class="hl_char">,</span>&nbsp;fch<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>fch&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;BADADDR<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx&nbsp;<span class="hl_char">=</span>&nbsp;GetFirstIndex<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;arid<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">while</span><span class="hl_char">(</span>idx&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>x&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;GetArrayElement<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;arid<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forgot&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>break</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx&nbsp;<span class="hl_char">=</span>&nbsp;GetNextIndex<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;arid<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx&nbsp;<span class="hl_char">=</span>&nbsp;GetFirstIndex<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;arIdComp<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">while</span><span class="hl_char">(</span>idx&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>x&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;GetArrayElement<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;arIdComp<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forgot&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>break</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx&nbsp;<span class="hl_char">=</span>&nbsp;GetNextIndex<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;arIdComp<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>forgot&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span><span class="hl_function">Byte</span><span class="hl_char">(</span>curChunk<span class="hl_char">)</span>&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;0xc3<span class="hl_char">)</span>&nbsp;addLong&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>else</b></span>&nbsp;addLong&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">8</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xSpd&nbsp;<span class="hl_char">=</span>&nbsp;GetSpd<span class="hl_char">(</span>x<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>__int64<span class="hl_char">(</span>xSpd<span class="hl_char">)</span>&nbsp;<span class="hl_char">&lt;</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span>&nbsp;Message<span class="hl_char">(</span><span class="hl_quote">&quot;next %x spd before -%x\n&quot;</span><span class="hl_char">,</span>&nbsp;x<span class="hl_char">,</span>&nbsp;<span class="hl_char">-</span>GetSpd<span class="hl_char">(</span>x<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>else</b></span>&nbsp;Message<span class="hl_char">(</span><span class="hl_quote">&quot;next %x spd before %x\n&quot;</span><span class="hl_char">,</span>&nbsp;x<span class="hl_char">,</span>&nbsp;GetSpd<span class="hl_char">(</span>x<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>GetSpd<span class="hl_char">(</span>x<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;addLong&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;GetSpd<span class="hl_char">(</span>curChunk<span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AddUserStkPnt<span class="hl_char">(</span>x<span class="hl_char">,</span>&nbsp;&nbsp;GetSpDiff<span class="hl_char">(</span>x<span class="hl_char">)</span>&nbsp;<span class="hl_char">-</span>&nbsp;GetSpd<span class="hl_char">(</span>x<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;GetSpd<span class="hl_char">(</span>curChunk<span class="hl_char">)</span>&nbsp;<span class="hl_char">-</span>&nbsp;addLong<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xSpd&nbsp;<span class="hl_char">=</span>&nbsp;GetSpd<span class="hl_char">(</span>x<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>__int64<span class="hl_char">(</span>xSpd<span class="hl_char">)</span>&nbsp;<span class="hl_char">&lt;</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span>&nbsp;Message<span class="hl_char">(</span><span class="hl_quote">&quot;next %x spd after -%x\n&quot;</span><span class="hl_char">,</span>&nbsp;x<span class="hl_char">,</span>&nbsp;<span class="hl_char">-</span>xSpd<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>else</b></span>&nbsp;Message<span class="hl_char">(</span><span class="hl_quote">&quot;next %x spd after %x\n&quot;</span><span class="hl_char">,</span>&nbsp;x<span class="hl_char">,</span>&nbsp;xSpd<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>y&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;BADADDR<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;<span class="hl_char">=</span>&nbsp;x<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx&nbsp;<span class="hl_char">=</span>&nbsp;GetLastIndex<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;arIdComp<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetArrayLong<span class="hl_char">(</span>arIdComp<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">,</span>&nbsp;x<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">else</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx&nbsp;<span class="hl_char">=</span>&nbsp;GetLastIndex<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;arid<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetArrayLong<span class="hl_char">(</span>arid<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">,</span>&nbsp;x<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>else</b></span>&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span><span class="hl_char">(</span>XrefType<span class="hl_char">(</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">&amp;</span>&nbsp;0x1f<span class="hl_char">)</span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;fl_F<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;<span class="hl_char">=</span>&nbsp;x<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_number">48</span>&nbsp;<span class="hl_number">8D</span>&nbsp;<span class="hl_number">64</span>&nbsp;<span class="hl_number">24</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span><span class="hl_function">Dword</span><span class="hl_char">(</span>curChunk<span class="hl_char">)</span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;0x24648d48<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xSpd&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_function">Byte</span><span class="hl_char">(</span>curChunk&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">4</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>xSpd&nbsp;<span class="hl_char">&gt;</span><span class="hl_char">=</span>&nbsp;0x80<span class="hl_char">)</span>&nbsp;xSpd&nbsp;<span class="hl_char">=</span>&nbsp;xSpd&nbsp;<span class="hl_char">-</span>&nbsp;0x100<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AddUserStkPnt<span class="hl_char">(</span>x<span class="hl_char">,</span>&nbsp;&nbsp;GetSpDiff<span class="hl_char">(</span>x<span class="hl_char">)</span>&nbsp;<span class="hl_char">-</span>&nbsp;GetSpd<span class="hl_char">(</span>x<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;GetSpd<span class="hl_char">(</span>curChunk<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;xSpd<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>y&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;BADADDR<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx&nbsp;<span class="hl_char">=</span>&nbsp;GetFirstIndex<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;arid<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>idx&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;<span class="hl_char">=</span>&nbsp;GetArrayElement<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;arid<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DelArrayElement<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;arid<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx&nbsp;<span class="hl_char">=</span>&nbsp;GetLastIndex<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;arIdComp<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetArrayLong<span class="hl_char">(</span>arIdComp<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">,</span>&nbsp;y<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;curChunk&nbsp;<span class="hl_char">=</span>&nbsp;y<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;}while<span class="hl_char">(</span>y&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;BADADDR<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;return&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l0">}</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">static&nbsp;main<span class="hl_char">(</span><span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;auto&nbsp;curChunk<span class="hl_char">,</span>&nbsp;arid<span class="hl_char">,</span>&nbsp;arIdComp<span class="hl_char">,</span>&nbsp;result<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;curChunk&nbsp;<span class="hl_char">=</span>&nbsp;FirstFuncFchunk<span class="hl_char">(</span>ScreenEA<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;do</li><li class="hl_l1">&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;arid&nbsp;<span class="hl_char">=</span>&nbsp;CreateArray<span class="hl_char">(</span><span class="hl_quote">&quot;chunks&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;arIdComp&nbsp;<span class="hl_char">=</span>&nbsp;CreateArray<span class="hl_char">(</span><span class="hl_quote">&quot;CompChunks&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;<span class="hl_char">=</span>&nbsp;recursFunc<span class="hl_char">(</span>curChunk<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;DeleteArray<span class="hl_char">(</span>arid<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;DeleteArray<span class="hl_char">(</span>arIdComp<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;}while<span class="hl_char">(</span>result&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;Message<span class="hl_char">(</span><span class="hl_quote">&quot;Done!&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">}</li>        </ol>
    </div>
</div></div>
<br><br>Но сейчас функция достигла 174 фрагментов и это ещё, кажется, только половина, и времени на скрипт тратится около 1 минуты. Надо либо фиксить нэйтив иды, либо фикс-плаг писать, но времени на это сейчас нет.<br><br><b>Добавлено спустя 40 минут</b><br>Убрал лишний вывод сообщений и пошустрел скрипт - 5 сек<br><br><b>Добавлено спустя 15 часов 24 минуты</b><br>Странная вещь со скриптом. При количестве фрагментов функции, меньшем 100 он ещё нормально работал. Но вот, наконец, функция раскручена полностью в 197 фрагментов, и граф всё-таки построен так, ветвление через retn и jmp [rsp] не мешает - навигация по коду функции как будто ничего такого и не было. Но стали твориться спонтанные вещи... Теперь не всё правит скрипт...<br><br>Пришлось помучаться! Да да, именно помучаться! Не поизучать нормально характер глюков иды, а помучаться!!! Там нечего изучать - выполняем SetSpDiff() в одном месте - в другом слетает. Что со скриптом? Возможные причины(версии):<br>1) Случайным образом прерывается, не достигая конца<br>2) DeleteArray() не всегда полностью удаляет созданный массив<br>3) DelArrayElement() не всегда удаляет элемент массива, может быть даже не всегда тот<br>4) Что-то ещё вряд ли кому ведомое<br><br>Начиная понимать, что эта мистика чисто из-за багов idc-движка, задался экспериментом:<br>несколько раз запустил скрипт, каждый раз перед этим обнуляя везде spDiff вот так<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">auto&nbsp;fch&nbsp;<span class="hl_char">=</span>&nbsp;FirstFuncFchunk<span class="hl_char">(</span>ScreenEA<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span class="hl_function">while</span><span class="hl_char">(</span>fch&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;BADADDR<span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1">&nbsp;&nbsp;SetSpDiff<span class="hl_char">(</span>fch<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;fch&nbsp;<span class="hl_char">=</span>&nbsp;NextFuncFchunk<span class="hl_char">(</span>fch<span class="hl_char">,</span>&nbsp;fch<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">}</li>        </ol>
    </div>
</div></div>
<br><br>И что же получилось... Я не знаю, каким чудом у вас получается что-то писать на idc, как вы вообще ему верите, но у меня вот такой маленький списочек адресов фрагментов, на которых каждый раз idc не справился со своей задачей:<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_number">41DE1947</span></li><li class="hl_l1"><span class="hl_number">41D18625</span></li><li class="hl_l0"><span class="hl_number">41EAAA6A</span></li><li class="hl_l1"><span class="hl_number">41CCA2AA</span></li>        </ol>
    </div>
</div></div>
<br><br>Была бы проблема со скриптом - адрес каждый раз был бы один и тот же, так как генератора случайных чисел в скрипте нет... Касательно idc - иду в нейтиве править! Надо бы проверить питон...<br><br><b>Добавлено спустя 15 часов 28 минут</b><br>Но вряд ли на это время есть...<br><br><b>Добавлено спустя 16 часов 41 минуту</b><br>Самое интересное - 173 фрагмента в самом наихудшем их расположение потребовали бы таким idc-скриптом, даже если об не прерывался, 2 ^ 173 вызовов recursFunc() <img src="img/smilies/s15.gif" alt=""><br><br>И пришла в голову умная мысль на основе наблюдений, что надо фиксить spd у фрагментов в восходящем их порядке! Т.е. так, как они перечисляются функцией NextFuncFchunk(). Но заранее неизвестно, у какого фрагмента какой должен быть spd. Поэтому их придётся запоминать по мере выполнения в третьем массиве... Пока что из этой функи вытащил столько, с чем можно пробовать и созрели пара вариантов для достижения цели. Если не выгорит, придётся копать выше и тогда уже реализую новый скрипт.<br><br>Цель - пока секрет, позже напишу <img src="img/smilies/s1.gif" alt="">
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=363466&amp;user=24257&amp;forum_n=12&amp;topic=23661&amp;page=1&amp;anchor=10" class="addthx" data-post="363466"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 221thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 марта 2016 21:27 <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=12&amp;topic=23661&amp;page=1#11');return false;">#11</a> </span><div align=left><br>
Выгорело! Иде повезло <img src="img/smilies/s5.gif" alt="">
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=363480&amp;user=24257&amp;forum_n=12&amp;topic=23661&amp;page=1&amp;anchor=11" class="addthx" data-post="363480"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 221thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 21 марта 2016 14:09 <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=12&amp;topic=23661&amp;page=1#12');return false;">#12</a> </span><div align=left><br>
<I>DenCoder пишет:<br>Цель - пока секрет, позже напишу </I><br>Не суеверен особо, но стараюсь держаться поговорки &quot;не говори оп, пока не перепрыгнул&quot;.<br><br>Цель была необычная - исправить &quot;баг&quot; плагина под известное приложение.<br>Повозился немного... Достоинства защиты:<br>1) Неизученные пока методы антидебага<br>2) Противодействие аттачу дебаггером<br>3) Противодействие установке в контексте регистра Dr7 как изнутри, так и извне<br>4) Антипатчинг<br>...<br><br>но поборол! Как? Инжект + AddVectoredExceptionHandler() + PAGE_EXECUTE_READ + маленький встроенный дизасм + взвод TF.... )))<br><br><b>Добавлено спустя 5 минут</b><br>Суть &quot;бага&quot; - то ли защита каким-то образом обнаруживала, что её обошли, то ли недообошли - не знаю, оригинальный кряк делал не я. Но на определённых действиях плагин портил свой код, для чего и понадобилось поудобней представить ту самую функу в 173(или 174) куска. Дальше была просто найдено несколько возможных целей - попытки хукнуть не увенчались успехом... нашёлся способ проще - таблица! с rva правок - ну не палево? )<br><br>....
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=363608&amp;user=24257&amp;forum_n=12&amp;topic=23661&amp;page=1&amp;anchor=12" class="addthx" data-post="363608"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]Hellspawn[/b]','')">Hellspawn</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/72.gif" alt=""><br><span class=txtSm>Ранг: 990.2 <font color=red>(<b>! ! !</b>)</font>, 380thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.95'>Активность: 0.68<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=72">Модератор</a><br><font color=blue>Author of DiE</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 марта 2016 22:13 <br><script type="text/javascript">QU('Hellspawn','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Hellspawn" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=12&amp;topic=23661&amp;page=1#13');return false;">#13</a> </span><div align=left><br>
<I>DenCoder пишет:<br>1) Неизученные пока методы антидебага<br>2) Противодействие аттачу дебаггером<br>3) Противодействие установке в контексте регистра Dr7 как изнутри, так и извне<br>4) Антипатчинг </I><br><br>что там неизученного такого?))) интересно же <img src="img/smilies/s1.gif" alt=""> а вех да, рулит! )
<br><br><font size="1"><i>-----<br>[nice coder and reverser]</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=363792&amp;user=72&amp;forum_n=12&amp;topic=23661&amp;page=1&amp;anchor=13" class="addthx" data-post="363792"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=4554" title="28-03-2016 19:15, ранг:211.1" target="_blank">HandMill</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 221thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 марта 2016 14:35 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=12&amp;topic=23661&amp;page=1#14');return false;">#14</a> </span><div align=left><br>
Да мной не изучено. Не тратил время на изучение, так обошёл, без дебага. <img src="img/smilies/s1.gif" alt=""><br><br>Изучение, возможно, ещё предстоит )<br><br>В противодействии аттачу дебаггером сделал пару проверок на хуки - их не было... дальше - я не гадалка, оставил это дело - бороться с антидебагом, не это была цель.<br><br>Антидебаг в основном построен на 2х известных функциях - IsDebuggerPresent() и CheckRemoteDebuggerPresent(). Но не только, были ещё непонятные эксепшены, которые как ни передавай приложению - дебаг вылетал... Хотя, может, чего-то упустил...<br><br><b>Добавлено спустя 5 минут</b><br><I>Hellspawn пишет:<br>а вех да, рулит! </I><br>Кстати, из возможных противодействий веху - периодическая проверка последнего установленного хендлера и установка своего на переднем плане. В том числе можно и напрямую список проверять, не забывая ксорить с процессКуки... Ни разу такого пока не встречалось...
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=363815&amp;user=24257&amp;forum_n=12&amp;topic=23661&amp;page=1&amp;anchor=14" class="addthx" data-post="363815"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 221thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 06 апреля 2016 14:00 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=12&amp;topic=23661&amp;page=1#15');return false;">#15</a> </span><div align=left><br>
Наконец, выдалась пара свободных дней. Эти дни, конечно, можно отдохнуть, но я б хотел продолжить один из своих забытых проектов. В &quot;борьбе с багами&quot; флекса написался маленький x64-дизасм, помогший обойти дополнительные проверки лицензии. По всем правилам лучше б было разобрать все эти проверки полностью и сделать что-то универсальное типа кейгена, но глюки иды, без которых это и так затратно, вынудили сократить исследования... Из всего можно извлечь пользу. И польза в том, что этот проект не просто напомнил мне о забытом дизасме, который имел только лишь поддержку x86, без fpu и mmx, sse, sse2. А и побудил нацелиться расширить область применения и исправить пробелы. Надеюсь, 2-3 дней хватит хотя бы на основу (в основе структуры и константы, ими управляется логика дизасма, тут уж я люблю так <img src="img/smilies/s1.gif" alt="">), а если нет - попутного мне ветра!<br><br>Преимущества своего дизасма в том, что не надо никого просить исправлять баги. В любое свободное время сел и поправил. В том числе, появляется возможность прикрутить его к вмтрейсеру и сделать из него эволюционное продолжение в направлении &quot;инструмента статической распаковки&quot;(позаимствовал термин у Faust&#039;а), не основанного ни на какой платформе, будь то ида, олли или ещё что. Возможность расширенного сигнатурного анализа с какими угодно масками с проверками по смыслу и т.д...<br><br>Замахи большие, но ветер слабый...
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=364026&amp;user=24257&amp;forum_n=12&amp;topic=23661&amp;page=1&amp;anchor=15" class="addthx" data-post="364026"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 221thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 17 апреля 2016 17:06 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=12&amp;topic=23661&amp;page=1#16');return false;">#16</a> </span><div align=left><br>
Добавил rex-префиксы, удалил несколько инструкций, которых нет под x64, добавил movsxd, cqo и  cdqe. Подправил большую декодирования полей  modR/M и SIB, из-за rex-префиксов над декодингом ещё надо будет поработать...<br><br>Необходимость делать что-то другое, периодически что-то даже новое, не даёт вплотную заняться своим дизасмом. Так вот получил первый опыт по &quot;форсированной&quot; регистрации андроид-приложения, у которого в качестве основной защиты использовался класс LicenseChecker... Запатчил в 2х местах. Патчить код лучше в smali-виде, так надёжнее. Хорошо, что есть справочник по его опкодам, для справки в паре мест пригодилось.<br><br>Благо, какие-то инструменты уже есть. В принципе, всё что надо из них - apktool и SignApk, что-нить удобное для поиска... ну и мозги, конечно. Можно и иду использовать, но почему-то на некоторые методы  она не переходит. Пробовал для подписи заюзать keytool и JarSigner - не хочет на планшете ставиться apk. Также для более удобного чтения кода неплохо бы в джаву преобразовать. dex2jar - первый этап, он нужен для преобразования apk в jar-архив. Дальше нужен декомпилятор, вот тут не повезло немного: jd-gui разбирает коряво некоторые методы, а бывает и целые классы. Посоветовали fernflower, но пока не юзал, мне хватило и этого всего.
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=364249&amp;user=24257&amp;forum_n=12&amp;topic=23661&amp;page=1&amp;anchor=16" class="addthx" data-post="364249"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 221thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 мая 2016 20:24 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=12&amp;topic=23661&amp;page=1#17');return false;">#17</a> </span><div align=left><br>
Тем временем, после выбора очередного проекта и небольшого отдыха<br><noindex><a href="https://exelab.ru/f/action=vthread&amp;forum=13&amp;topic=19719&amp;page=11#31" rel="nofollow" target="_blank">--&gt; Link &lt;--</a></noindex><br><br>Я там не поставил лайк. Ну и? И не поставлю <img src="img/smilies/s5.gif" alt=""><br>И началось выклянчивание через личку. Не удовлетворил ответом - пошли в ход грубости... Я думаю, не стоит выкладывать ради чистоты истории...<br><br>Оставлю только в общих чертах.<br><br>Что ж, клянчили-клянчили, и выклянчили. Выклянчили пост в теме про денуво (пост там попросил сам удалить):<br>Молодец, <b>Bronco</b>!!!<br><br>Только это не повод закидывать меня спамом в личке! У меня своих задач хватает, чем-то помочь могу только по свободе от них.<br><br><I>ELF_7719116 пишет в личке:<br>Я еще поспамлю немного )<br><br>Вопрос: так понимаю есть наработки по вм вмпрота. таки было бы неплохо пустить их для денувки. по крайней мере я могу приспособить будущий софт на денувку под Ваши наработки</I><br><br>Вот блин, не ожидал от тебя ещё.<br>У вас, чё, мания всё выклянчивать? Я не только вмпротом занимаюсь, это не единственное дело-то!<br>Раз Вам не плохо было бы - пускаете свои наработки! А я не вижу в этом никакой выгоды ни для себя, ни для семьи, ни для человечества в целом!<br><br>Чем я хочу заниматься, у меня времени нет, а ещё Вам тут вынь, да положь. Всё, что надыбал по вмпроту, читайте в блоге здесь же. Не дебилы же? Будет у меня время, хорошо, раскрою там непонятные вопросы.<br>=============================================================================<br><br><b>Добавлено спустя 7 минут</b><br>Про что забыл - про желание упомянуть. Теперь очень сложно его вызвать...<br><br>Моё мнение по всему этому - то ли ребята коллективно забухали по скайпу (возможно, это известная конфа), то ли от счастья крыша поехала. У вас много свободного от работы времени - пожалуйста, при чём здесь я? <img src="img/smilies/s5.gif" alt=""><br>Я у Вамита ничего не клянчил, у него почерпнул только некоторые термины... зареганный вмпрот не имею права дать, и даже забудьте про это! Наработки - Вы заметили, что не так часто бывает свободное время, и кое-чем даже не имею права поделиться. В vmprotect 2.xx нет ничего такого, чем смог, тем поделился. Чем делюсь - оно в блоге, в основном для истории, мне же самому полезно бывает, потому как здесь я описываю так, как порой не вспомню.<br><br><b>Добавлено спустя 13 часов 4 минуты</b><br>Как я понял позже, исходя из переписки с ELF_7719116, &quot;проект&quot; встал, потому как запустить распакованное дело от OEP проблемно. Это уместилось в одно небольшое предложение! А не в 5 абзацев, как первоначально у Bronco:<br><br><I><br>Привет!<br>Вопрос как к опытному. Функи_процедуры в Лариске, опечатывали в три слоя или захода.<br>Вторая ВМ имеет таблицу указателей (поксорены), и если я правильно понял, это главное отличие от новой вм.<br>Вопрос 1.<br>Не считая макросов по бекапу регистров на входе в вм, переходы между &quot;блоками&quot; исполняют командой jmp reg. В таблице 256 указателей, без дубликатов порядка 80, не имеющие дубликатов 7, из них 2 возможно уводят в другой цикл, но на них прерываний нет.<br>Как двигло выходит из цикла? <br>Вопрос 2.<br>Учитывая что и опыт и практика у тебя больше моего, может чем то подсобишь в плане вм?<br>Вопрос3.<br>Пикод используется, как символика для скриптового языка ВМДвигла?<br></I><br><br>Мне, честно говоря, пришлось потрудиться, чтоб что-то понять, чтоб на это что-то ответить... Да, донести смысл того, что хочешь, оказывается умение...<br><br>2 человека. Один знает, другой хочет спросить. Неужели трудно сосредоточиться и понятным языком задать вопрос? От этого же зависит ответ! И не только. Ценить время другого, которое тратится на понимание вопроса, не все умеют? Некоторые пишут какую-то абракадабру, несвязную чушь, открывая новый топик, и что самое интересное - находятся люди, которые их непонятным чудом понимают... 1 из 5-10...<br><br>Вот что отвечу на понятый мной вопрос по проблеме(и исключительно потому, что в теме есть 3 адекватных знакомых по их постам здесь, и это не Bronco):<br>В настоящее время вмпротом нет времени продолжать заниматься. Но над проблемой думалось на досуге. В теории запустить дамп можно. Это ведь имелось в виду? Или я опять не понял?<br><br><b>Добавлено спустя 13 часов 26 минут</b><br>Только у вас там, кажется, 3.x - может не совсем подойти.<br><br>В старте дампа из OEP накрытой ранее вмпротом 2.x dll основных 3 проблемы: импорт, таблица релоков и дельта.<br><br>Таблицу релоков можно вставить как секцию. Таблица там - не помню, то ли спрятана, то ли так лежит, но проходя стадии распаковки её можно найти.<br><br>Дельта - необходимый аргумент для вм-диспетчера. Это я упускал всегда из виду - пока серьёзно и не пробовал запускать дампы. Но помню о ней.<br><br>Импорт - на мой взгляд есть самая быстрая реализация, есть правильная. Правильная - это убрать замусоренные стабы на функи и заменить кривые &quot;адреса&quot; на правильные, для чего нужно по всем пройтись... возможно поиском на этой стадии распаковки. Быстрая - оставляем всё, как есть, но перед OEP вставляем свой импортёр - вырванный кусок вм-ленты процесса импорта.<br><br><b>Добавлено спустя 13 часов 30 минут</b><br>Прог для этого готовых нет, а кодом трассировки делиться не стану - он ужасный <img src="img/smilies/s5.gif" alt=""> Обычно я лучше пишу...<br><br><b>Добавлено спустя 13 часов 32 минуты</b><br>Ну и да - если импортёр вставить правильно, то можно избежать поисков в около 100-200 лент проверок crc.
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=364837&amp;user=24257&amp;forum_n=12&amp;topic=23661&amp;page=1&amp;anchor=17" class="addthx" data-post="364837"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 221thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 мая 2016 14:44 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=12&amp;topic=23661&amp;page=1#18');return false;">#18</a> </span><div align=left><br>
Далее волею <strike>зануд и школьников</strike> обстоятельств проект приобретает закрытый характер!
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=364905&amp;user=24257&amp;forum_n=12&amp;topic=23661&amp;page=1&amp;anchor=18" class="addthx" data-post="364905"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 221thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 июня 2016 16:19 <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=12&amp;topic=23661&amp;page=1#19');return false;">#19</a> </span><div align=left><br>
Интересная задача встала - реализовать эксплойт под две версии прошивки для девайса на процессоре MIPS. Прошивка размером 128 кб. С нуля искать уязвимости было бы затяжно. Но код уже был к этому времени изучен в процессе предыдущего реверса для восстановления файлов конфигурации...<br><br>Девайс предоставляет usb-интерфейс для работы с ним, одна из функций которого - запись определённых файлов. Файлы строго определённого формата, суть которого - набор некоторых блоков. Один из блоков - сама начинка, чаще всего это elf, и обязательно должен присутствовать блок с подписью неизвестным ключом из сертификата. Сертификат известен, на факторизация RSA2048 пока на грани фантастики... <br><br>Набор блоков... Первое, что бросилось в глаза - собирается инфа обо всех блоках в файле, и для каждой такой инфы структура размером 0x18 байт на стеке! Второе - контроля число блоков нет, контроль повтора блоков - слабый, проверяются только соседние блоки, они не должны повторяться. Также есть некий блок, размер которого может быть до 128 байт, и после сбора инфы обо всех блоках он также пишется ниже по стеку. И самое важное - хендлер находится под стеком, что значит - опустив стек до хендлера, можно перезаписать его 128 байт!<br><br>На x86 в 128 байт влезло бы достаточно... Но мипс имеет ущербный ассемблер. С одной стороны есть преимущества. Например, инструкция
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span><span class="hl_registr"><b>ebx</b></span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_registr"><b>ecx</b></span>&nbsp;<span class="hl_char">+</span>&nbsp;0x80<span class="hl_char">]</span></li>        </ol>
    </div>
</div></div>
 размером 7 байт на мипсе выглядела бы так
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">addiu&nbsp;<span class="hl_char">$</span>s0<span class="hl_char">,</span>&nbsp;<span class="hl_char">$</span>a0<span class="hl_char">,</span>&nbsp;<span class="hl_char">$</span>a1</li><li class="hl_l1">lw&nbsp;<span class="hl_char">$</span>s0<span class="hl_char">,</span>&nbsp;0x80<span class="hl_char">(</span><span class="hl_char">$</span>s0<span class="hl_char">)</span></li>        </ol>
    </div>
</div></div>
, в mips16 это бы заняло 4 байта. Но есть недостатки:<br>1) хендлер работает в режиме mips32, что значит - все инструкции либо 4 байта, либо 8, если используется расширение. Необходимо сохранить некоторые регистры перед переключением режима с 32 на 16. И x86-инструкция push reg в один байт на mips32 занимает 4.<br>2) Переключение режимов с целью выиграть на размере кода возможно 2мя способами, самый малоёмкий - jalx, 4 байта. Но тогда надо сохранять &#036;ra - адрес возврата, по которому должна перейти какая-то функция, выполнявшаяся на момент вызова хендлера. А это 4 байта. Сам этот адрес вовзрата не сохраняется в мипсе, как на x86 при выполнение call.<br>3) Есть специфические регистры, обмен между которыми что на мипс16, что на мипс32 занимал бы 4 байта. На x86 это всегда 2 байта. Когда надо уложиться в 128 байт, думаешь о каждой мелочи<br>4) Нельзя в одну команду уложиться, чтоб в регистр записать произвольный адрес, если
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>addr</b></span>&nbsp;<span class="hl_char">&amp;</span>&nbsp;0xF0000000&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;pc&nbsp;<span class="hl_char">&amp;</span>&nbsp;0xF0000000</li>        </ol>
    </div>
</div></div>
. Либо, если можно - то это всегда на мипс16 будет 6 байт - 4 байта на адрес за функцией + 2 байта инструкция. Выигрыш такой схемы только если адрес используется больше 2х раз, и функция не больше определённого размера (используется pc-привязка для адресации)<br>...<br><br>Всё это накладывает ограничения такие, что в один эксплойт не уложиться. И схема такая - первая часть эксплойта восстанавливает хендлер и записывает часть кода по свободному адресу. Вторая часть эксплойта делает то же самое, но уже для восстановления хендлера использует часть сохранённого кода и добавляет немного больше кода по свободному адресу. Второй, третьей, ..., (n-1)-ной частями собираем нужный код и последней частью активируем!<br><br>Сама по себе уязвимость странная в том, что на блок отводится 128 байт, когда там хватило бы 8! Не буду писать, что это за блок, но стоит призадуматься - большая вероятность, что это закладка, специально кем-то созданная и оставленная во всех версиях, чтоб когда надо ей кому-то воспользоваться... Я уже не говорю про ноутбуки, планшеты и мобильники... Может быть в мультиварках, телевизорах, пылесосах уже пора искать закладки?
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=365149&amp;user=24257&amp;forum_n=12&amp;topic=23661&amp;page=1&amp;anchor=19" class="addthx" data-post="365149"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=2777" title="05-11-2016 01:14, ранг:493.1" target="_blank">daFix</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="20" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 221thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 16 июня 2016 03:28 <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#20" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=12&amp;topic=23661&amp;page=1#20');return false;">#20</a> </span><div align=left><br>
Решено было перезаписать хвост эксепшен-хендлера, так как это даёт больше места для кода за счёт ненадобности восстанавливать исходный хендлер. Но не всё так просто, пришлось побороться с кешем инструкций, чтоб код в хвосте выполнялся. Чтобы сбросить кеш инструкций, мипсу нужно выполнить побольше условных переходов... Одно мешает с некоторой вероятностью - прерывание от таймера в неподходящий момент...
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=365240&amp;user=24257&amp;forum_n=12&amp;topic=23661&amp;page=1&amp;anchor=20" class="addthx" data-post="365240"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="21" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 221thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 июня 2016 03:18 <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#21" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=12&amp;topic=23661&amp;page=1#21');return false;">#21</a> </span><div align=left><br>
Победа!
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=365279&amp;user=24257&amp;forum_n=12&amp;topic=23661&amp;page=1&amp;anchor=21" class="addthx" data-post="365279"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=4554" title="18-06-2016 08:32, ранг:211.5" target="_blank">HandMill</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="22" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 221thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 30 июня 2016 13:43 <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#22" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=12&amp;topic=23661&amp;page=1#22');return false;">#22</a> </span><div align=left><br>
Глюки иды:<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">ROM<span class="hl_char">:</span><span class="hl_number">80007808</span>&nbsp;<span class="hl_number">028</span>&nbsp;<span class="hl_number">02</span>&nbsp;<span class="hl_number">18</span>&nbsp;F4&nbsp;<span class="hl_number">0E</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jal&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x81003BD0</span></li><li class="hl_l1">ROM<span class="hl_char">:</span><span class="hl_number">8000780C</span>&nbsp;<span class="hl_number">028</span>&nbsp;<span class="hl_number">3E</span>&nbsp;<span class="hl_number">0D</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;la&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_char">$</span>a1<span class="hl_char">,</span>&nbsp;byte_80007900<span class="hl_char">+</span><span class="hl_number">4</span></li><li class="hl_l0">ROM<span class="hl_char">:</span><span class="hl_number">8000780E</span>&nbsp;<span class="hl_number">028</span>&nbsp;<span class="hl_number">3D</span>&nbsp;<span class="hl_number">0C</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;la&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_char">$</span>a0<span class="hl_char">,</span>&nbsp;byte_80007900</li>        </ol>
    </div>
</div></div>
<br><br>На второй инструкции должно быть la      &#036;a1, byte_80007900, потому как инструкция в бранч-слоте.
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=365712&amp;user=24257&amp;forum_n=12&amp;topic=23661&amp;page=1&amp;anchor=22" class="addthx" data-post="365712"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="23" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 221thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 сентября 2016 16:54 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#23" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=12&amp;topic=23661&amp;page=1#23');return false;">#23</a> </span><div align=left><br>
<I>DenCoder пишет:<br>Одно мешает с некоторой вероятностью - прерывание от таймера в неподходящий момент...  </I><br>И было выпущено ещё 2 эксплойта под версии прошивки новее. То, что хендлер прерывания от таймера способен попортить код в неподходящем месте, решается определённым количеством невыровненных по границе 4 байт блоков в файле. Правильный подбор невыровненных блоков позволяет повысить вероятность задержки момента конца их разбора в функции настолько, чтобы попасть в нужный интервал времени, когда хвост хендлера перезаписывается сразу после его отработки. К сожалению, из-за таймера и неопределённости момента заливки файла в девайс 100% успеха недостижимо - 64 байта всегда за разные интервалы времени заливаются по usb, и отчасти виновата винда. Достигнуто было в районе 50-80 в зависимости от версии прошивки.
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=367736&amp;user=24257&amp;forum_n=12&amp;topic=23661&amp;page=1&amp;anchor=23" class="addthx" data-post="367736"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=2777" title="23-10-2016 23:11, ранг:493.1" target="_blank">daFix</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="24" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 221thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 16 декабря 2016 00:09 <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#24" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=12&amp;topic=23661&amp;page=1#24');return false;">#24</a> </span><div align=left><br>
Исследовал один сервис. Антидебага нет, есть самозащита... Такое бывает у антивирусов. Интересна одна вещь - где под x86 приёмы не прокатывают, под x64 - как раз самое то <img src="img/smilies/s1.gif" alt="">
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=370135&amp;user=24257&amp;forum_n=12&amp;topic=23661&amp;page=1&amp;anchor=24" class="addthx" data-post="370135"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="25" onfocus="this.blur()" href="JavaScript:di('[b]daFix[/b]','')">daFix</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/2777.gif" alt=""><br><span class=txtSm>Ранг: 529.0 (<b>!</b>), 110thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.76'>Активность: 0.29<span style='color:red'>&searr;</span>0.04</span><br>Статус: <a href="action=userinfo&amp;user=2777">Участник</a><br><font color=blue>5KRT</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 января 2017 20:03 <br><script type="text/javascript">QU('daFix','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=daFix" target="_blank">Личное сообщение</a> &middot;  <a href="#25" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=12&amp;topic=23661&amp;page=1#25');return false;">#25</a> </span><div align=left><br>
Ден, продолжай писать, интересно было
<br><br><font size="1"><i>-----<br>Research For Food</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=371249&amp;user=2777&amp;forum_n=12&amp;topic=23661&amp;page=1&amp;anchor=25" class="addthx" data-post="371249"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="26" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 221thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 января 2017 13:59 <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#26" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=12&amp;topic=23661&amp;page=1#26');return false;">#26</a> </span><div align=left><br>
Да как-нибудь когда-нибудь... Не обо всём могу писать, но думаю, что где-нибудь уже в марте добавлю что-нибудь о методах борьбы с обфускацией при статическом анализе, либо другое что-то.
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=371311&amp;user=24257&amp;forum_n=12&amp;topic=23661&amp;page=1&amp;anchor=26" class="addthx" data-post="371311"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="27" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 221thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 марта 2017 18:42 <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#27" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=12&amp;topic=23661&amp;page=1#27');return false;">#27</a> </span><div align=left><br>
Пишу скрипт на idc... Пожалел 100 раз, что в своё время не решил реализовывать обработку кода с разделением функций между idc и нативным приложением. Эту возможность можно реализовать, например, через пайпу - открыть канал и писать туда команды для нативного приложения, а по другому каналу можно принимать ответ... Почему именно так лучше? Потому что:<br>1) idc медленный, обработка строк, массивов занимает много больше времени, чем если бы нативно<br>2) idc ограничен в возможностях кодинга, приходится изобретать много чего, чтоб работало как надо
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=372720&amp;user=24257&amp;forum_n=12&amp;topic=23661&amp;page=1&amp;anchor=27" class="addthx" data-post="372720"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="28" onfocus="this.blur()" href="JavaScript:di('[b]difexacaw[/b]','')">difexacaw</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/40990.png" alt=""><br><span class=txtSm>Ранг: 338.5 (мудрец), 349thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.02'>Активность: 2.11<span style='color:green'>&nearr;</span>2.42</span><br>Статус: <a href="action=userinfo&amp;user=40990">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 марта 2017 03:59 &middot; Поправил: difexacaw <br><script type="text/javascript">QU('difexacaw','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=difexacaw" target="_blank">Личное сообщение</a> &middot;  <a href="#28" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=12&amp;topic=23661&amp;page=1#28');return false;">#28</a> </span><div align=left><br>
3. Пайпы(каналы) тоже крайне тормозные. Порты(LPC) на порядки шустрее.
<br><br><font size="1"><i>-----<br>vx</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=372758&amp;user=40990&amp;forum_n=12&amp;topic=23661&amp;page=1&amp;anchor=28" class="addthx" data-post="372758"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="29" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 221thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 марта 2017 17:55 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#29" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=12&amp;topic=23661&amp;page=1#29');return false;">#29</a> </span><div align=left><br>
Вообще лучше, конечно, полностью независимая нативная реализация обработки кода с возможностью обмена информацией с идой. Но это займёт большее время, поскольку обрабатываемый код под процессор ARM.<br><br>Подцель - детектов циклов и занесение их в список для целей дальнейшего поиска в них какого-то адреса. Для реализации этого нужно следить за пройденным путём, и если следующий адрес блока замечен где-то в пути,  то выделять подпуть от того места до конца. На idc алго для этого построен на строках и массивах. Пройденный путь кода, в котором начальные адреса блоков, реализован на idc в виде строки типа<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_number">0000023458</span><span class="hl_char">-</span><span class="hl_number">0000023484</span><span class="hl_char">-</span><span class="hl_number">00000234ac</span><span class="hl_char">-</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span></li>        </ol>
    </div>
</div></div>
.<br><br>Списков в idc нет, поэтому вместо списка массив, для образования которого используются функции GetLastIndex()/SetArrayLong().<br><br>Пройденный путь и подпути можно реализовать и в виде массива idc-функциями GetLastIndex()/SetArrayLong(), каждый массив с элементами цикла содержал бы тогда в имени уникальное строковое представление из одного или нескольких элементов цикла.<br><br>Очень интересно в idaapi реализованы и строки, и массивы - нет ограничения по размеру. И это одна из возможных причин тормозов функций для работы с ними. 1600 блоков и выделение 300 циклов обрабатывается idc-скриптом около 8 сек. Если заменить эти функции на запись в пайпу, адреса блоков будут передаваться внешнему приложению. Весь вопрос - что быстрее? Преобразование адреса в строку и добавление её в другую или отправка/приём? Добавление элемента в idc-массив или отправка/приём?<br><br><I>difexacaw пишет:<br>Порты(LPC) на порядки шустрее. </I><br>Использование LPC требует либо написания плагина для иды, либо перехвата каких-то функций иды(много вариантов, каких именно функций) и это время.<br><br>Другой вариант - использовать питон вместо idc. И некогда все эти варианты тестировать, нужно просто знать.<br><br>Глобальная цель - деобфускация. В замусоривании используются такие приёмы, которые раньше мне не встречались, потому назвал их &quot;лжециклы&quot; и &quot;скрутка&quot;. Суть их объясню ниже. Поправьте, если подобное видели и этому есть общепринятое название.<br><br><b>лжециклы</b><br>всевозможные варианты реализации простой конструкции<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">do</li><li class="hl_l1">{</li><li class="hl_l0"><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span></li><li class="hl_l1">}while<span class="hl_char">(</span><span class="hl_function">false</span><span class="hl_char">)</span><span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div>
<br><br>Например, <br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>int</b></span>&nbsp;a&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">4</span><span class="hl_comment">;</span></li><li class="hl_l1"><span class="hl_function">while</span><span class="hl_char">(</span>a&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">1</span>&nbsp;<span class="hl_char">&lt;</span>&nbsp;<span class="hl_number">6</span><span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1"><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span></li><li class="hl_l0">a&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">5</span><span class="hl_comment">;</span></li><li class="hl_l1">}</li>        </ol>
    </div>
</div></div>
<br><br><b>скрутка</b><br>В разных ветках кода имеется общий код проверки какого-то условия. В одной ветке условие истинно, в другой - ложно.<br><br>Например<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">for<span class="hl_char">(</span><span class="hl_function"><b>int</b></span>&nbsp;i&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_comment">; i &lt; 10; i++)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>1я&nbsp;часть&nbsp;кода&nbsp;цикла&nbsp;<span class="hl_number">1</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span></li><li class="hl_l0">&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;a&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;goto&nbsp;ext_code<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">loop_1<span class="hl_char">:</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>2я&nbsp;часть&nbsp;кода&nbsp;цикла&nbsp;<span class="hl_number">1</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span></li><li class="hl_l1">}</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">for<span class="hl_char">(</span><span class="hl_function"><b>int</b></span>&nbsp;i&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_comment">; i &lt; 10; i++)</span></li><li class="hl_l0">{</li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>1я&nbsp;часть&nbsp;кода&nbsp;цикла&nbsp;<span class="hl_number">2</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span></li><li class="hl_l1">&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;a&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;goto&nbsp;ext_code<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">loop_2<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>2я&nbsp;часть&nbsp;кода&nbsp;цикла&nbsp;<span class="hl_number">2</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span></li><li class="hl_l0">}</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">ext_code<span class="hl_char">:</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>a&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span>&nbsp;goto&nbsp;loop_1<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>else</b></span>&nbsp;goto&nbsp;loop_2<span class="hl_comment">;</span></li>        </ol>
    </div>
</div></div>
<br><br>В представлении графом асм-кода ветви кода выглядят переплетёнными, скрученными, откуда и название.<br><br>Для деобфускации подобного пытался найти что-то готовое, не нашёл.<br><br><b>Добавлено спустя -48 минут</b><br>На текущий момент выделены из 344 циклов<br>24 настоящих, несущих полезную нагрузку<br>24 &quot;лжецикла&quot; с более сложной реализацией, ждут улучшения скрипта/улучшения общего подхода<br><br>Остальные все обработаны - развёрнуты, но на это потребовалось при текущей реализации около 24 часов (с перерывами на сон, перекуры, ...). Работа проделывалась в полуавтоматическом режиме - указывался адрес, по которому скрипт делал своё дело. &quot;Скрутки&quot; были обнаружены в ходе работы. Сколько их - надо модифицировать алго.<br><br><b>Добавлено спустя 2 часа 47 минут</b><br>Определил, чем была произведена обфускация. Был использован Android Clang, основанный на известной компиляторной инфраструктуре LLVM. То есть обфускация производится на этапе компиляции. Попробую от этого оттолнкуться...
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=372790&amp;user=24257&amp;forum_n=12&amp;topic=23661&amp;page=1&amp;anchor=29" class="addthx" data-post="372790"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="30" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 221thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 марта 2017 03:06 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#30" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=12&amp;topic=23661&amp;page=1#30');return false;">#30</a> </span><div align=left><br>
Бывает, видим использование какого-то регистра, сравнение или использование в вычислениях, а в ближайшем окружении выше не видно его установки. Функция огромная! Нужно найти адрес установки регистра. На помощь приходит скрипт(для ARM-инструкций):<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">#include&nbsp;<span class="hl_char">&lt;</span>idc<span class="hl_char">.</span>idc<span class="hl_char">&gt;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">static&nbsp;FindLongInArray<span class="hl_char">(</span>arId<span class="hl_char">,</span>&nbsp;x<span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;auto&nbsp;<span class="hl_function">addr</span><span class="hl_char">,</span>&nbsp;idx<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;idx&nbsp;<span class="hl_char">=</span>&nbsp;GetFirstIndex<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;arId<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function">while</span><span class="hl_char">(</span>idx&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;<span class="hl_char">=</span>&nbsp;GetArrayElement<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;arId<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span><span class="hl_function"><b>addr</b></span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;x<span class="hl_char">)</span>&nbsp;<span class="hl_function"><b>break</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;idx&nbsp;<span class="hl_char">=</span>&nbsp;GetNextIndex<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;arId<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;return&nbsp;idx<span class="hl_comment">;</span></li><li class="hl_l0">}</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">static&nbsp;findAddr<span class="hl_char">(</span>path<span class="hl_char">,</span>&nbsp;<span class="hl_function">addr</span><span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;return&nbsp;strstr<span class="hl_char">(</span>path<span class="hl_char">,</span>&nbsp;sprintf<span class="hl_char">(</span><span class="hl_quote">&quot;%08x&quot;</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">addr</span><span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">}</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">static&nbsp;FindBlock<span class="hl_char">(</span>x<span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1">&nbsp;&nbsp;auto&nbsp;<span class="hl_function">addr</span><span class="hl_char">,</span>&nbsp;block&nbsp;<span class="hl_char">=</span>&nbsp;GetArrayId<span class="hl_char">(</span><span class="hl_quote">&quot;block&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;idx<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;idx&nbsp;<span class="hl_char">=</span>&nbsp;GetFirstIndex<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;block<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function">while</span><span class="hl_char">(</span>idx&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;<span class="hl_char">=</span>&nbsp;GetArrayElement<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;block<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span><span class="hl_function"><b>addr</b></span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;x<span class="hl_char">)</span>&nbsp;<span class="hl_function"><b>break</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;idx&nbsp;<span class="hl_char">=</span>&nbsp;GetNextIndex<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;block<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;return&nbsp;idx<span class="hl_comment">;</span></li><li class="hl_l1">}</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">static&nbsp;FindBlockEnd<span class="hl_char">(</span>x<span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1">&nbsp;&nbsp;auto&nbsp;<span class="hl_function">addr</span><span class="hl_char">,</span>&nbsp;block&nbsp;<span class="hl_char">=</span>&nbsp;GetArrayId<span class="hl_char">(</span><span class="hl_quote">&quot;blockEnd&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;idx<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;idx&nbsp;<span class="hl_char">=</span>&nbsp;GetFirstIndex<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;block<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function">while</span><span class="hl_char">(</span>idx&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;<span class="hl_char">=</span>&nbsp;GetArrayElement<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;block<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span><span class="hl_function"><b>addr</b></span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;x<span class="hl_char">)</span>&nbsp;<span class="hl_function"><b>break</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;idx&nbsp;<span class="hl_char">=</span>&nbsp;GetNextIndex<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;block<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;return&nbsp;idx<span class="hl_comment">;</span></li><li class="hl_l1">}</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">static&nbsp;findBlockByAddr<span class="hl_char">(</span><span class="hl_function">addr</span><span class="hl_char">,</span>&nbsp;addrDn<span class="hl_char">,</span>&nbsp;addrUp<span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1">&nbsp;&nbsp;auto&nbsp;block&nbsp;<span class="hl_char">=</span>&nbsp;GetArrayId<span class="hl_char">(</span><span class="hl_quote">&quot;block&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;blockEnd&nbsp;<span class="hl_char">=</span>&nbsp;GetArrayId<span class="hl_char">(</span><span class="hl_quote">&quot;blockEnd&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;idx<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;idx&nbsp;<span class="hl_char">=</span>&nbsp;GetFirstIndex<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;block<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function">while</span><span class="hl_char">(</span>idx&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;addrDn&nbsp;<span class="hl_char">=</span>&nbsp;GetArrayElement<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;block<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;addrUp&nbsp;<span class="hl_char">=</span>&nbsp;GetArrayElement<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;blockEnd<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>addrDn&nbsp;<span class="hl_char">&lt;</span><span class="hl_char">=</span>&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;<span class="hl_char">&amp;</span><span class="hl_char">&amp;</span>&nbsp;addrUp&nbsp;<span class="hl_char">&gt;</span><span class="hl_char">=</span>&nbsp;<span class="hl_function">addr</span><span class="hl_char">)</span>&nbsp;<span class="hl_function"><b>break</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;idx&nbsp;<span class="hl_char">=</span>&nbsp;GetNextIndex<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;block<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;return&nbsp;idx<span class="hl_comment">;</span></li><li class="hl_l0">}</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">static&nbsp;CollectLoops<span class="hl_char">(</span>curAddr<span class="hl_char">,</span>&nbsp;path<span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;auto&nbsp;x<span class="hl_char">,</span>&nbsp;y<span class="hl_char">,</span>&nbsp;loops&nbsp;<span class="hl_char">=</span>&nbsp;GetArrayId<span class="hl_char">(</span><span class="hl_quote">&quot;loops&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;block&nbsp;<span class="hl_char">=</span>&nbsp;GetArrayId<span class="hl_char">(</span><span class="hl_quote">&quot;block&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;idx<span class="hl_char">,</span>&nbsp;fidx<span class="hl_char">,</span>&nbsp;l<span class="hl_char">,</span>&nbsp;verBack&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;setverBack&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">1</span><span class="hl_char">,</span>&nbsp;blockEnd&nbsp;<span class="hl_char">=</span>&nbsp;GetArrayId<span class="hl_char">(</span><span class="hl_quote">&quot;blockEnd&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;prevAddr<span class="hl_char">,</span>&nbsp;xref<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;idx&nbsp;<span class="hl_char">=</span>&nbsp;GetLastIndex<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;block<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;SetArrayLong<span class="hl_char">(</span>block<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">,</span>&nbsp;curAddr<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>path&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;<span class="hl_quote">&quot;&quot;</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;path&nbsp;<span class="hl_char">=</span>&nbsp;sprintf<span class="hl_char">(</span><span class="hl_quote">&quot;%s-%08x&quot;</span><span class="hl_char">,</span>&nbsp;path<span class="hl_char">,</span>&nbsp;curAddr<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>else</b></span>&nbsp;path&nbsp;<span class="hl_char">=</span>&nbsp;sprintf<span class="hl_char">(</span><span class="hl_quote">&quot;%08x&quot;</span><span class="hl_char">,</span>&nbsp;curAddr<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;do</li><li class="hl_l0">&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>Message<span class="hl_char">(</span><span class="hl_quote">&quot;%x\n&quot;</span><span class="hl_char">,</span>&nbsp;curAddr<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;<span class="hl_char">=</span>&nbsp;Rfirst<span class="hl_char">(</span>curAddr<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>x&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;BADADDR&nbsp;<span class="hl_char">|</span><span class="hl_char">|</span>&nbsp;<span class="hl_char">(</span>xref&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">(</span>XrefType<span class="hl_char">(</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">&amp;</span>&nbsp;0x1f<span class="hl_char">)</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;fl_F&nbsp;<span class="hl_char">&amp;</span><span class="hl_char">&amp;</span>&nbsp;xref&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;fl_JN<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>Message<span class="hl_char">(</span><span class="hl_quote">&quot;End: %x\nPath:%s\n&quot;</span><span class="hl_char">,</span>&nbsp;curAddr<span class="hl_char">,</span>&nbsp;path<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>verBack&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_number">1</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;<span class="hl_char">=</span>&nbsp;RfirstB<span class="hl_char">(</span>curAddr<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span><span class="hl_char">(</span>XrefType<span class="hl_char">(</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">&amp;</span>&nbsp;0x1f<span class="hl_char">)</span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;fl_JN&nbsp;<span class="hl_char">|</span><span class="hl_char">|</span>&nbsp;RnextB<span class="hl_char">(</span>curAddr<span class="hl_char">,</span>&nbsp;y<span class="hl_char">)</span>&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;BADADDR<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetArrayLong<span class="hl_char">(</span>blockEnd<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">,</span>&nbsp;prevAddr<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;<span class="hl_char">=</span>&nbsp;findAddr<span class="hl_char">(</span>path<span class="hl_char">,</span>&nbsp;curAddr<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>l&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>Message<span class="hl_char">(</span><span class="hl_quote">&quot;Loop: %s\n&quot;</span><span class="hl_char">,</span>&nbsp;substr<span class="hl_char">(</span>path<span class="hl_char">,</span>&nbsp;l<span class="hl_char">,</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fidx&nbsp;<span class="hl_char">=</span>&nbsp;GetLastIndex<span class="hl_char">(</span>AR_STR<span class="hl_char">,</span>&nbsp;loops<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetArrayString<span class="hl_char">(</span>loops<span class="hl_char">,</span>&nbsp;fidx<span class="hl_char">,</span>&nbsp;substr<span class="hl_char">(</span>path<span class="hl_char">,</span>&nbsp;l<span class="hl_char">,</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_number">6</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fidx&nbsp;<span class="hl_char">=</span>&nbsp;FindBlock<span class="hl_char">(</span>curAddr<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>fidx&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx&nbsp;<span class="hl_char">=</span>&nbsp;GetLastIndex<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;block<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetArrayLong<span class="hl_char">(</span>block<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">,</span>&nbsp;curAddr<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;path&nbsp;<span class="hl_char">=</span>&nbsp;sprintf<span class="hl_char">(</span><span class="hl_quote">&quot;%s-%08x&quot;</span><span class="hl_char">,</span>&nbsp;path<span class="hl_char">,</span>&nbsp;curAddr<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>else</b></span>&nbsp;return&nbsp;<span class="hl_number">7</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>xref&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;fl_JN<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetArrayLong<span class="hl_char">(</span>blockEnd<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">,</span>&nbsp;curAddr<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;<span class="hl_char">=</span>&nbsp;findAddr<span class="hl_char">(</span>path<span class="hl_char">,</span>&nbsp;x<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>l&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>Message<span class="hl_char">(</span><span class="hl_quote">&quot;Loop: %s\n&quot;</span><span class="hl_char">,</span>&nbsp;substr<span class="hl_char">(</span>path<span class="hl_char">,</span>&nbsp;l<span class="hl_char">,</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fidx&nbsp;<span class="hl_char">=</span>&nbsp;GetLastIndex<span class="hl_char">(</span>AR_STR<span class="hl_char">,</span>&nbsp;loops<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetArrayString<span class="hl_char">(</span>loops<span class="hl_char">,</span>&nbsp;fidx<span class="hl_char">,</span>&nbsp;substr<span class="hl_char">(</span>path<span class="hl_char">,</span>&nbsp;l<span class="hl_char">,</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_number">2</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fidx&nbsp;<span class="hl_char">=</span>&nbsp;FindBlock<span class="hl_char">(</span>x<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>fidx&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx&nbsp;<span class="hl_char">=</span>&nbsp;GetLastIndex<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;block<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetArrayLong<span class="hl_char">(</span>block<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">,</span>&nbsp;x<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;path&nbsp;<span class="hl_char">=</span>&nbsp;sprintf<span class="hl_char">(</span><span class="hl_quote">&quot;%s-%08x&quot;</span><span class="hl_char">,</span>&nbsp;path<span class="hl_char">,</span>&nbsp;x<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curAddr&nbsp;<span class="hl_char">=</span>&nbsp;x<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setverBack&nbsp;<span class="hl_char">=</span>&nbsp;verBack&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>else</b></span>&nbsp;return&nbsp;<span class="hl_number">3</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>else</b></span>&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span><span class="hl_char">(</span>y&nbsp;<span class="hl_char">=</span>&nbsp;Rnext<span class="hl_char">(</span>curAddr<span class="hl_char">,</span>&nbsp;x<span class="hl_char">)</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;BADADDR&nbsp;<span class="hl_char">&amp;</span><span class="hl_char">&amp;</span>&nbsp;<span class="hl_char">(</span>XrefType<span class="hl_char">(</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">&amp;</span>&nbsp;0x1f<span class="hl_char">)</span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;fl_JN<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetArrayLong<span class="hl_char">(</span>blockEnd<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">,</span>&nbsp;curAddr<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;<span class="hl_char">=</span>&nbsp;findAddr<span class="hl_char">(</span>path<span class="hl_char">,</span>&nbsp;y<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>l&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>Message<span class="hl_char">(</span><span class="hl_quote">&quot;Loop: %s\n&quot;</span><span class="hl_char">,</span>&nbsp;substr<span class="hl_char">(</span>path<span class="hl_char">,</span>&nbsp;l<span class="hl_char">,</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fidx&nbsp;<span class="hl_char">=</span>&nbsp;GetLastIndex<span class="hl_char">(</span>AR_STR<span class="hl_char">,</span>&nbsp;loops<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetArrayString<span class="hl_char">(</span>loops<span class="hl_char">,</span>&nbsp;fidx<span class="hl_char">,</span>&nbsp;substr<span class="hl_char">(</span>path<span class="hl_char">,</span>&nbsp;l<span class="hl_char">,</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_number">4</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fidx&nbsp;<span class="hl_char">=</span>&nbsp;FindBlock<span class="hl_char">(</span>y<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>fidx&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span>&nbsp;CollectLoops<span class="hl_char">(</span>y<span class="hl_char">,</span>&nbsp;path<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fidx&nbsp;<span class="hl_char">=</span>&nbsp;FindBlock<span class="hl_char">(</span>x<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>fidx&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx&nbsp;<span class="hl_char">=</span>&nbsp;GetLastIndex<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;block<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetArrayLong<span class="hl_char">(</span>block<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">,</span>&nbsp;x<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;path&nbsp;<span class="hl_char">=</span>&nbsp;sprintf<span class="hl_char">(</span><span class="hl_quote">&quot;%s-%08x&quot;</span><span class="hl_char">,</span>&nbsp;path<span class="hl_char">,</span>&nbsp;x<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curAddr&nbsp;<span class="hl_char">=</span>&nbsp;x<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setverBack&nbsp;<span class="hl_char">=</span>&nbsp;verBack&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>else</b></span>&nbsp;return&nbsp;<span class="hl_number">5</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">else</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prevAddr&nbsp;<span class="hl_char">=</span>&nbsp;curAddr<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curAddr&nbsp;<span class="hl_char">=</span>&nbsp;x<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>setverBack&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_number">1</span><span class="hl_char">)</span>&nbsp;verBack&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>else</b></span>&nbsp;setverBack&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;}while<span class="hl_char">(</span><span class="hl_number">1</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">}</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">static&nbsp;findSetReg<span class="hl_char">(</span><span class="hl_function">addr</span><span class="hl_char">,</span>&nbsp;regnum<span class="hl_char">,</span>&nbsp;addrEnd<span class="hl_char">,</span>&nbsp;backPath<span class="hl_char">,</span>&nbsp;foundAddrsId<span class="hl_char">,</span>&nbsp;passedBlocksId<span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">&nbsp;&nbsp;auto&nbsp;x<span class="hl_char">,</span>&nbsp;y<span class="hl_char">,</span>&nbsp;cmd<span class="hl_char">,</span>&nbsp;addrDn&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">,</span>&nbsp;addrUp<span class="hl_char">,</span>&nbsp;result<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">,</span>&nbsp;fidx<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function">while</span><span class="hl_char">(</span><span class="hl_number">1</span><span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>Если&nbsp;адрес&nbsp;в&nbsp;пределах&nbsp;границ&nbsp;блока</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>addrDn&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span>&nbsp;<span class="hl_char">|</span><span class="hl_char">|</span>&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;<span class="hl_char">&lt;</span>&nbsp;addrDn&nbsp;<span class="hl_char">|</span><span class="hl_char">|</span>&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;<span class="hl_char">&gt;</span>&nbsp;addrUp<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fidx&nbsp;</span><span class="hl_char">=</span>&nbsp;findBlockByAddr<span class="hl_char">(</span><span class="hl_function">addr</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>addrDn<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>addrUp<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function">if</span><span class="hl_char">(</span>fidx&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span>&nbsp;return&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function">if</span><span class="hl_char">(</span>FindLongInArray<span class="hl_char">(</span>passedBlocksId<span class="hl_char">,</span>&nbsp;addrDn<span class="hl_char">)</span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx&nbsp;</span><span class="hl_char">=</span>&nbsp;GetLastIndex<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;passedBlocksId<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetArrayLong</span><span class="hl_char">(</span>passedBlocksId<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">,</span>&nbsp;addrDn<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_char">/</span><span class="hl_char">/</span>если&nbsp;адрес&nbsp;блока&nbsp;уже&nbsp;попадался</li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function">else</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_char">/</span><span class="hl_char">/</span>Message<span class="hl_char">(</span><span class="hl_quote">&quot;BREAK\n\n&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_char">/</span><span class="hl_char">*</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function">if</span><span class="hl_char">(</span>backPath&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;<span class="hl_quote">&quot;&quot;</span><span class="hl_char">)</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function">if</span><span class="hl_char">(</span>findAddr<span class="hl_char">(</span>backPath<span class="hl_char">,</span>&nbsp;addrDn<span class="hl_char">)</span>&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span>&nbsp;return&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;backPath&nbsp;</span><span class="hl_char">=</span>&nbsp;sprintf<span class="hl_char">(</span><span class="hl_quote">&quot;%s-%08x&quot;</span><span class="hl_char">,</span>&nbsp;backPath<span class="hl_char">,</span>&nbsp;addrDn<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>else</b></span>&nbsp;backPath&nbsp;<span class="hl_char">=</span>&nbsp;sprintf<span class="hl_char">(</span><span class="hl_quote">&quot;%08x&quot;</span><span class="hl_char">,</span>&nbsp;addrDn<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_char">*</span><span class="hl_char">/</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_char">/</span><span class="hl_char">/</span>Message<span class="hl_char">(</span><span class="hl_quote">&quot;current block: %d %x-%x\n&quot;</span><span class="hl_char">,</span>&nbsp;fidx<span class="hl_char">,</span>&nbsp;addrDn<span class="hl_char">,</span>&nbsp;addrUp<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>Message<span class="hl_char">(</span><span class="hl_quote">&quot;%x\n&quot;</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">addr</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;cmd&nbsp;<span class="hl_char">=</span>&nbsp;DecodeInstruction<span class="hl_char">(</span><span class="hl_function">addr</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>cmd<span class="hl_char">.</span>itype&nbsp;<span class="hl_char">&lt;</span>&nbsp;0x12&nbsp;<span class="hl_char">|</span><span class="hl_char">|</span>&nbsp;cmd<span class="hl_char">.</span>itype&nbsp;<span class="hl_char">&gt;</span>&nbsp;0x15&nbsp;<span class="hl_char">&amp;</span><span class="hl_char">&amp;</span>&nbsp;cmd<span class="hl_char">.</span>itype&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;0x20<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>пока&nbsp;так</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>GetOpType<span class="hl_char">(</span><span class="hl_function">addr</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;o_reg&nbsp;<span class="hl_char">&amp;</span><span class="hl_char">&amp;</span>&nbsp;GetOperandValue<span class="hl_char">(</span><span class="hl_function">addr</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;regnum<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_char">/</span><span class="hl_char">/</span>Message<span class="hl_char">(</span><span class="hl_quote">&quot;found R%d: %x\n&quot;</span><span class="hl_char">,</span>&nbsp;regnum<span class="hl_char">,</span>&nbsp;<span class="hl_function">addr</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hl_function"><b>addr</b></span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>addrEnd&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span>&nbsp;<span class="hl_char">&amp;</span><span class="hl_char">&amp;</span>&nbsp;addrEnd&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_function">addr</span><span class="hl_char">)</span>&nbsp;return&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;<span class="hl_char">=</span>&nbsp;RfirstB<span class="hl_char">(</span><span class="hl_function">addr</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">while</span><span class="hl_char">(</span>x&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;BADADDR&nbsp;<span class="hl_char">&amp;</span><span class="hl_char">&amp;</span>&nbsp;<span class="hl_char">(</span>XrefType<span class="hl_char">(</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">&amp;</span>&nbsp;0x1f<span class="hl_char">)</span>&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;fl_JN&nbsp;<span class="hl_char">&amp;</span><span class="hl_char">&amp;</span>&nbsp;<span class="hl_char">(</span>XrefType<span class="hl_char">(</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">&amp;</span>&nbsp;0x1f<span class="hl_char">)</span>&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;fl_F<span class="hl_char">)</span>&nbsp;x&nbsp;<span class="hl_char">=</span>&nbsp;RnextB<span class="hl_char">(</span><span class="hl_function">addr</span><span class="hl_char">,</span>&nbsp;x<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>x&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;BADADDR<span class="hl_char">)</span>&nbsp;return&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;<span class="hl_char">=</span>&nbsp;x<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do</li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;</span><span class="hl_char">=</span>&nbsp;RnextB<span class="hl_char">(</span><span class="hl_function">addr</span><span class="hl_char">,</span>&nbsp;y<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function">while</span><span class="hl_char">(</span>y&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;BADADDR&nbsp;<span class="hl_char">&amp;</span><span class="hl_char">&amp;</span>&nbsp;<span class="hl_char">(</span>XrefType<span class="hl_char">(</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">&amp;</span>&nbsp;0x1f<span class="hl_char">)</span>&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;fl_JN&nbsp;<span class="hl_char">&amp;</span><span class="hl_char">&amp;</span>&nbsp;<span class="hl_char">(</span>XrefType<span class="hl_char">(</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">&amp;</span>&nbsp;0x1f<span class="hl_char">)</span>&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;fl_F<span class="hl_char">)</span>&nbsp;y&nbsp;<span class="hl_char">=</span>&nbsp;RnextB<span class="hl_char">(</span><span class="hl_function">addr</span><span class="hl_char">,</span>&nbsp;y<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function">if</span><span class="hl_char">(</span>y&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;BADADDR<span class="hl_char">)</span>&nbsp;<span class="hl_function"><b>break</b></span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;</span><span class="hl_char">=</span>&nbsp;findSetReg<span class="hl_char">(</span>y<span class="hl_char">,</span>&nbsp;regnum<span class="hl_char">,</span>&nbsp;addrEnd<span class="hl_char">,</span>&nbsp;backPath<span class="hl_char">,</span>&nbsp;foundAddrsId<span class="hl_char">,</span>&nbsp;passedBlocksId<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function">if</span><span class="hl_char">(</span>result&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_char">/</span><span class="hl_char">/</span>добавить&nbsp;в&nbsp;массив</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx&nbsp;</span><span class="hl_char">=</span>&nbsp;GetLastIndex<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;foundAddrsId<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;</span><span class="hl_char">=</span>&nbsp;SetArrayLong<span class="hl_char">(</span>foundAddrsId<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">,</span>&nbsp;result<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_char">/</span><span class="hl_char">/</span>Message<span class="hl_char">(</span><span class="hl_quote">&quot;index: %d\nresult: %d\n&quot;</span><span class="hl_char">,</span>&nbsp;idx<span class="hl_char">,</span>&nbsp;result<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;}while<span class="hl_char">(</span><span class="hl_number">1</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;<span class="hl_char">=</span>&nbsp;x<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;}</li><li class="hl_l1">}</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">static&nbsp;main<span class="hl_char">(</span><span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1">&nbsp;&nbsp;auto&nbsp;curAddr<span class="hl_char">,</span>&nbsp;result<span class="hl_char">,</span>&nbsp;block<span class="hl_char">,</span>&nbsp;blockEnd<span class="hl_char">,</span>&nbsp;loops<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">,</span>&nbsp;path&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_quote">&quot;&quot;</span><span class="hl_char">,</span>&nbsp;backPath&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_quote">&quot;&quot;</span><span class="hl_char">,</span>&nbsp;foundAddrsId<span class="hl_char">,</span>&nbsp;passedBlocksId<span class="hl_char">,</span>&nbsp;regnum<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;block&nbsp;<span class="hl_char">=</span>&nbsp;GetArrayId<span class="hl_char">(</span><span class="hl_quote">&quot;block&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>block&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span>&nbsp;DeleteArray<span class="hl_char">(</span>block<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;blockEnd&nbsp;<span class="hl_char">=</span>&nbsp;GetArrayId<span class="hl_char">(</span><span class="hl_quote">&quot;blockEnd&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>blockEnd&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span>&nbsp;DeleteArray<span class="hl_char">(</span>blockEnd<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;loops&nbsp;<span class="hl_char">=</span>&nbsp;GetArrayId<span class="hl_char">(</span><span class="hl_quote">&quot;loops&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>loops&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span>&nbsp;DeleteArray<span class="hl_char">(</span>loops<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>do</li><li class="hl_l1">&nbsp;&nbsp;{</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;loops&nbsp;<span class="hl_char">=</span>&nbsp;CreateArray<span class="hl_char">(</span><span class="hl_quote">&quot;loops&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;block&nbsp;<span class="hl_char">=</span>&nbsp;CreateArray<span class="hl_char">(</span><span class="hl_quote">&quot;block&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;blockEnd&nbsp;<span class="hl_char">=</span>&nbsp;CreateArray<span class="hl_char">(</span><span class="hl_quote">&quot;blockEnd&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;curAddr&nbsp;<span class="hl_char">=</span>&nbsp;FirstFuncFchunk<span class="hl_char">(</span>ScreenEA<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;<span class="hl_char">=</span>&nbsp;CollectLoops<span class="hl_char">(</span>curAddr<span class="hl_char">,</span>&nbsp;path<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;Message<span class="hl_char">(</span><span class="hl_quote">&quot;Циклы и блоки собраны\n%d блоков\n%d циклов\n&quot;</span><span class="hl_char">,</span>&nbsp;GetLastIndex<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;block<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">1</span><span class="hl_char">,</span>&nbsp;GetLastIndex<span class="hl_char">(</span>AR_STR<span class="hl_char">,</span>&nbsp;loops<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">1</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>Найти&nbsp;приравнивание&nbsp;регистра&nbsp;вверх</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;regnum&nbsp;<span class="hl_char">=</span>&nbsp;AskLong<span class="hl_char">(</span><span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_quote">&quot;Enter register number(0-15)&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">if</span><span class="hl_char">(</span>regnum&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;passedBlocksId&nbsp;</span><span class="hl_char">=</span>&nbsp;GetArrayId<span class="hl_char">(</span><span class="hl_quote">&quot;passedBlocks&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function">if</span><span class="hl_char">(</span>passedBlocksId&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span>&nbsp;DeleteArray<span class="hl_char">(</span>passedBlocksId<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;passedBlocksId&nbsp;</span><span class="hl_char">=</span>&nbsp;CreateArray<span class="hl_char">(</span><span class="hl_quote">&quot;passedBlocks&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foundAddrsId&nbsp;</span><span class="hl_char">=</span>&nbsp;GetArrayId<span class="hl_char">(</span><span class="hl_quote">&quot;foundAddresses&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function">if</span><span class="hl_char">(</span>foundAddrsId&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span>&nbsp;DeleteArray<span class="hl_char">(</span>foundAddrsId<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foundAddrsId&nbsp;</span><span class="hl_char">=</span>&nbsp;CreateArray<span class="hl_char">(</span><span class="hl_quote">&quot;foundAddresses&quot;</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curAddr&nbsp;</span><span class="hl_char">=</span>&nbsp;findSetReg<span class="hl_char">(</span>ScreenEA<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;regnum<span class="hl_char">,</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">,</span>&nbsp;backPath<span class="hl_char">,</span>&nbsp;foundAddrsId<span class="hl_char">,</span>&nbsp;passedBlocksId<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_function">if</span><span class="hl_char">(</span>curAddr&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function">if</span><span class="hl_char">(</span>curAddr&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span>&nbsp;Message<span class="hl_char">(</span><span class="hl_quote">&quot;R%d: %x\n&quot;</span><span class="hl_char">,</span>&nbsp;regnum<span class="hl_char">,</span>&nbsp;curAddr<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx&nbsp;</span><span class="hl_char">=</span>&nbsp;GetFirstIndex<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;foundAddrsId<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function">while</span><span class="hl_char">(</span>idx&nbsp;<span class="hl_char">!</span><span class="hl_char">=</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span><span class="hl_char">)</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curAddr&nbsp;</span><span class="hl_char">=</span>&nbsp;GetArrayElement<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;foundAddrsId<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Message</span><span class="hl_char">(</span><span class="hl_quote">&quot;R%d: %x\n&quot;</span><span class="hl_char">,</span>&nbsp;regnum<span class="hl_char">,</span>&nbsp;curAddr<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx&nbsp;</span><span class="hl_char">=</span>&nbsp;GetNextIndex<span class="hl_char">(</span>AR_LONG<span class="hl_char">,</span>&nbsp;foundAddrsId<span class="hl_char">,</span>&nbsp;idx<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DeleteArray</span><span class="hl_char">(</span>foundAddrsId<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DeleteArray</span><span class="hl_char">(</span>passedBlocksId<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;DeleteArray<span class="hl_char">(</span>loops<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;DeleteArray<span class="hl_char">(</span>block<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;DeleteArray<span class="hl_char">(</span>blockEnd<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;}<span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_function">while</span><span class="hl_char">(</span>result&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;Message<span class="hl_char">(</span><span class="hl_quote">&quot;%d Done!\n&quot;</span><span class="hl_char">,</span>&nbsp;result<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">}</li>        </ol>
    </div>
</div></div>
<br><br>В скрипте не учтены инструкции LDM. функция CollectLoops() затормаживает процесс на 5-15 секунд при больших функциях. Интересно было бы увидеть, как это будет выглядеть на питоне, и насколько быстрей будет работать. По питону у меня пока уровень знаний чуть больше 0... Кстати, сбор всех циклов и блоков для целей поиска установки регистра не нужен. Не нужен, как оказалось и в моём скрипте, и в следующей модификации интегрирую функцию в findSetReg, чтобы сбор производился по необходимости.<br><br>Скрипт обновлён 5 марта 2017.<br>Исправлены ошибки в CollectLoops
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=372814&amp;user=24257&amp;forum_n=12&amp;topic=23661&amp;page=1&amp;anchor=30" class="addthx" data-post="372814"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="31" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 221thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 марта 2017 21:07 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#31" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=12&amp;topic=23661&amp;page=1#31');return false;">#31</a> </span><div align=left><br>
Скрипту, конечно, нужна ещё оптимизация, что есть одно из последних дел... <br><br>Чем полезен скрипт?<br><br>Во-первых, экономит время и мозги в нахождении простых вещей.<br><br>Во-вторых, это не просто скрипт, а алгоритм. И его можно переложить на любой другой язык, скриптовый или  компилируемый. Может быть на питоне, может быть на си под capstone... Что сделать - это стратегия!  Язык - это тактика, дело наживное! Не важно как, если не знать, что!<br><br>В-третьих, с небольшими изменениями функции findSetReg() в него можно добавить findSetRegForward(поиск установки регистра вперёд) и findUseReg(поиск использования регистра вперёд), что вместе при должной доработке будет базой для деобфускации в части удаления мусорных инструкций, не управляющих ветвлением...<br><br>Знаю - ничего нового я не открыл, примерно так же и работают деобфускаторы. Но в деобфускации я прохожу какой-то свой собственный путь, жалея время на чтиво(была б возможность параллельно читать теорию - непременно воспользовался бы). На пути иногда посматриваю налево и направо и вижу какие-то элементы теории. Например, прозрачные и непрозрачные предикаты. В VMProtect(также на пример) в невиртуализированном коде как раз используются прозрачные предикаты, в виртуализированном - непрозрачные, но только при несоблюдении условий проверки целостности кода  и если стоит точка останова не первом байте вызываемой из вм апи-функции...<br><br><b>Добавлено спустя -24 минут</b><br>Пытаюсь поймать попутку, останавливают - не туда... Иногда подбрасывают поближе )
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=372854&amp;user=24257&amp;forum_n=12&amp;topic=23661&amp;page=1&amp;anchor=31" class="addthx" data-post="372854"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> <a href="action=vthread&amp;forum=12&amp;topic=23661&amp;page=0.html">&lt;&lt;</a> .  <a href="action=vthread&amp;forum=12&amp;topic=23661&amp;page=0.html">1</a> . <b>2</b> . <a href="action=vthread&amp;forum=12&amp;topic=23661&amp;page=2.html">3</a> . <a href="action=vthread&amp;forum=12&amp;topic=23661&amp;page=2.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/blog.png" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=12&sortBy=0&page=0.html"><b>Дневники и блоги</b></a> <b class=bulletHead>&#8212;&#8250;</b> Блог DenCoder&#039;а</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#32" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="12">
<input type="hidden" name="topic" value="23661">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=23661" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
