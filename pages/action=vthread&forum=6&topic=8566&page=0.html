<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Рушится при Recv в нете но не локалке - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Есть код описанны ниже, это код клиента ....сервер шлет много данных которые потом раскладываются по листвью .... каждые 1024 это название + 4 параметра разделеные символами ...и которые после получения расфасовываются по буферам">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=39467'>hgdagon</a>, <a target='_blank' href='?action=userinfo&amp;user=28016'>asfa</a> (+4 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Рушится при Recv в нете но не локалке</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> .  <b>1</b> . <a href="action=vthread&amp;forum=6&amp;topic=8566&amp;page=1.html">2</a> . <a href="action=vthread&amp;forum=6&amp;topic=8566&amp;page=1.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]mak[/b]','')">mak</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3520.jpg" alt=""><br><span class=txtSm>Ранг: 673.3 <font color=magenta>(<b>! !</b>)</font>, 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.48'>Активность: 0.4<span style='color:red'>&searr;</span>0.31</span><br>Статус: <a href="action=userinfo&amp;user=3520">Участник</a><br><font color=blue>CyberMonk</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 апреля 2007 22:05 &middot; Поправил: mak <br><script type="text/javascript">QU('mak','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=mak" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8566&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Есть код описанны ниже, это код клиента ....сервер шлет много данных которые потом раскладываются по листвью .... каждые 1024 это название + 4 параметра разделеные символами ...и которые после получения расфасовываются по буферам для вставки ..... если поставить перед ресивом месадж бокс ....то будет много месаг ....тоесть есть многопотоковость ....я как то об этом раньше не думал .... получается если данные шлются на локалке ...это код принимает и все ок .....но если в нете ...то тогда клиент рушится ... с ошибкой в области этого кода .....теперь вопрос ......что делать ....как сделать очередь чтоб все по очереди проходили ..или клиент рушится из за ошибки в этом коде ??? Я так подумал что все потоки с одним буфером работают (с одними точнее) и из за этого все рушится ..вот ..Пасиб заранее<br><br><code><br>.ELSEIF ax == FD_READ<br>invoke recv,sock,addr COMANDAIN,1024,0;sizeof COMANDAIN,0<br><br>invoke lstrlen ,addr COMANDAIN<br>mov ecx,eax<br>lea esi,offset [COMANDAIN]<br>lea edi,offset [PARAM1IN]<br>cld<br>XY: cmp byte ptr [esi],&quot;]&quot;<br>jz DALEE<br>movs byte ptr es:[edi],ds:[esi]<br>jmp XX<br>DALEE:<br>cmp byte ptr [esi+1],&quot;[&quot;<br>jz DALEE2<br>movs byte ptr es:[edi],ds:[esi]<br>XX:<br>loop XY<br>jmp FIRST<br>DALEE2:<br>         <br>;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@<br>inc esi<br>inc esi<br>dec ecx<br>dec ecx<br>;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@<br>lea edi,offset [PARAM2IN]<br>cld<br>XYY: cmp byte ptr [esi],&quot;]&quot;<br>jz DAALEE<br>movs byte ptr es:[edi],ds:[esi]<br>jmp XXX<br>DAALEE:<br>cmp byte ptr [esi+1],&quot;[&quot;<br>jz DALEE3<br>movs byte ptr es:[edi],ds:[esi]<br>XXX:<br>loop XYY<br>jmp FIRST<br>DALEE3:<br>           ;  invoke SendMessage,hPROGRESS,PBM_STEPIT,0,0<br>;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@<br>inc esi<br>inc esi<br>dec ecx<br>dec ecx<br>;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@<br>lea edi,offset [PARAM3IN]<br>cld<br>XYYY: cmp byte ptr [esi],&quot;]&quot;<br>jz DAALEEE<br>movs byte ptr es:[edi],ds:[esi]<br>jmp XXXX<br>DAALEEE:<br>cmp byte ptr [esi+1],&quot;[&quot;<br>jz DALEE4<br>movs byte ptr es:[edi],ds:[esi]<br>XXXX:<br>loop XYYY<br>jmp FIRST<br>DALEE4:<br><br>;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@<br>inc esi<br>inc esi<br>dec ecx<br>dec ecx<br>;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@<br>lea edi,offset [PARAM4IN]<br>cld<br>XYYYYY: cmp byte ptr [esi],&quot;]&quot;<br>jz DAALEEEE<br>movs byte ptr es:[edi],ds:[esi]<br>jmp XXXXX<br>DAALEEEE:<br>cmp byte ptr [esi+1],&quot;[&quot;<br>jz DALEE5<br>movs byte ptr es:[edi],ds:[esi]<br>XXXXX:<br>loop XYYYYY<br>jmp FIRST<br>DALEE5:<br>         <br>;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@<br>inc esi<br>inc esi<br>dec ecx<br>dec ecx<br>;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@<br>lea edi,offset [PARAM5IN]<br>cld<br>X5: cmp byte ptr [esi],&quot;]&quot;<br>jz DAALE51<br>movs byte ptr es:[edi],ds:[esi]<br>jmp XXXXXY<br>DAALE51:<br>cmp byte ptr [esi+1],&quot;[&quot;<br>jz FIRST<br>movs byte ptr es:[edi],ds:[esi]<br>XXXXXY:<br>loop X5<br>;####################################################<br>FIRST:</code><br><br>вставка в листвью..но тут вроде сто раз проверено все ок <br><code>listV PROC<br>invoke WIPECLEAR,addr COMANDAIN;call COMANDASCLEAR<br> mov lvi.imask,LVIF_TEXT<br>     mov lvi.iItem,0<br>     mov lvi.iSubItem,0<br>     mov lvi.pszText,offset PARAM2IN  <br>     invoke SendMessage,hList, LVM_INSERTITEM,0, addr lvi<br>  mov     lvi.pszText, offset PARAM2IN<br>   INVOKE     SendMessage, hList, LVM_SETITEM, 0, addr lvi<br>  ;///////////////////////////////////////////////////<br>  mov lvi.imask,LVIF_TEXT<br>  mov lvi.iItem,0<br>   mov lvi.iSubItem,1<br>    mov lvi.pszText,offset PARAM3IN  <br>   INVOKE     SendMessage, hList, LVM_SETITEM, 0, addr lvi<br>  ;/////////////////////////////////////////////////////<br>  ;///////////////////////////////////////////////////<br> mov lvi.imask,LVIF_TEXT<br>     mov lvi.iItem,0<br>     mov lvi.iSubItem,2<br>     mov lvi.pszText,offset PARAM4IN  <br>      INVOKE     SendMessage, hList, LVM_SETITEM, 0, addr lvi 	<br>;///////////////////////////////////////////////////<br>  mov lvi.imask,LVIF_TEXT<br>  mov lvi.iItem,0<br>   mov lvi.iSubItem,3<br>    mov lvi.pszText,offset PARAM5IN  <br>   INVOKE     SendMessage, hList, LVM_SETITEM, 0, addr lvi<br>      invoke WIPECLEAR,addr PARAM1IN<br>   invoke WIPECLEAR,addr PARAM2IN ;call CLEAR2<br>   invoke WIPECLEAR,addr PARAM3IN;call CLEAR3<br>   invoke WIPECLEAR,addr PARAM4IN<br>      invoke WIPECLEAR,addr PARAM5IN;call CLEAR4<br>ret<br>listV ENDP<br></code>
<br><br><font size="1"><i>-----<br>RE In Progress [!] Coding Hazard [!] Stay Clear of this Cube</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=133571&amp;user=3520&amp;forum_n=6&amp;topic=8566&amp;page=0&amp;anchor=1" class="addthx" data-post="133571"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]s0larian[/b]','')">s0larian</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/1737.jpg" alt=""><br><span class=txtSm>Ранг: 387.4 (мудрец)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.19'>Активность: 0.17<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1737">Участник</a><br><font color=blue>системщик</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 апреля 2007 23:54 <br><script type="text/javascript">QU('s0larian','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=s0larian" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8566&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
тяжело читать код, нет полного текста и слишком много низкоуровнего шума. Это весь твой код или ты реверсишь? Может набей прмер на С, посмотрим алго. Ну а потом переведёшь на АСМ, если тебя не устраивает то что выплёвывает компилер.<br><br>P.S. то что показывется много message box-ов не подтверждает многопоточность. Если TCP данные обрабатываются через windows messages, а обработчик вызывает MessageBox() то ты палучишь тучу боксов на экране. MessageBox крутит message pump и ты получаешь дикой длинны call stack.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=133591&amp;user=1737&amp;forum_n=6&amp;topic=8566&amp;page=0&amp;anchor=2" class="addthx" data-post="133591"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]mak[/b]','')">mak</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3520.jpg" alt=""><br><span class=txtSm>Ранг: 673.3 <font color=magenta>(<b>! !</b>)</font>, 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.48'>Активность: 0.4<span style='color:red'>&searr;</span>0.31</span><br>Статус: <a href="action=userinfo&amp;user=3520">Участник</a><br><font color=blue>CyberMonk</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 апреля 2007 17:11 <br><script type="text/javascript">QU('mak','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=mak" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8566&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
Smisl algoritma ......pri sobitii READ proishodit resiv , potom algoritm ishet simvoli ][ i rasdelaet stroku po 5 buferam ...... v konze prozedura dobavlenia v Listviu . Vot      <br><br>K sogaleniu s C ya ne nakom ((((
<br><br><font size="1"><i>-----<br>RE In Progress [!] Coding Hazard [!] Stay Clear of this Cube</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=133686&amp;user=3520&amp;forum_n=6&amp;topic=8566&amp;page=0&amp;anchor=3" class="addthx" data-post="133686"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]s0larian[/b]','')">s0larian</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/1737.jpg" alt=""><br><span class=txtSm>Ранг: 387.4 (мудрец)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.19'>Активность: 0.17<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1737">Участник</a><br><font color=blue>системщик</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 апреля 2007 19:03 <br><script type="text/javascript">QU('s0larian','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=s0larian" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8566&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
ну а где рушиццо? Call stack в студию <img src="img/smilies/s1.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=133712&amp;user=1737&amp;forum_n=6&amp;topic=8566&amp;page=0&amp;anchor=4" class="addthx" data-post="133712"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]mak[/b]','')">mak</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3520.jpg" alt=""><br><span class=txtSm>Ранг: 673.3 <font color=magenta>(<b>! !</b>)</font>, 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.48'>Активность: 0.4<span style='color:red'>&searr;</span>0.31</span><br>Статус: <a href="action=userinfo&amp;user=3520">Участник</a><br><font color=blue>CyberMonk</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 апреля 2007 23:26 <br><script type="text/javascript">QU('mak','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=mak" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8566&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
млин это я узнал от того что приложение мое .....с ошибкой завиршается и ошибка постоянно по этому адресу .... этим адресам точнее .... в том то и дело если начну через отладчик ...то все ок !!!!!
<br><br><font size="1"><i>-----<br>RE In Progress [!] Coding Hazard [!] Stay Clear of this Cube</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=134129&amp;user=3520&amp;forum_n=6&amp;topic=8566&amp;page=0&amp;anchor=5" class="addthx" data-post="134129"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]LifeIsPain[/b]','')">LifeIsPain</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 2.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.26'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=10928">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 апреля 2007 02:01 <br><script type="text/javascript">QU('LifeIsPain','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=LifeIsPain" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8566&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
<b>mak</b> поставь в качестве JIT - ольгу и посмотри где падает.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=134135&amp;user=10928&amp;forum_n=6&amp;topic=8566&amp;page=0&amp;anchor=6" class="addthx" data-post="134135"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]ganjman[/b]','')">ganjman</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 14.1 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.26'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=4332">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 апреля 2007 04:05 <br><script type="text/javascript">QU('ganjman','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ganjman" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8566&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
<b>mak</b><br><i class=x>Есть код описанны ниже, это код клиента ....сервер шлет много данных которые потом раскладываются по листвью .... каждые 1024 это название + 4 параметра разделеные символами ...и которые после получения расфасовываются по буферам для вставки ..... если поставить перед ресивом месадж бокс ....то будет много месаг ....тоесть есть многопотоковость ....я как то об этом раньше не думал .... получается если данные шлются на локалке ...это код принимает и все ок .....но если в нете ...то тогда клиент рушится ... с ошибкой в области этого кода .....теперь вопрос ......что делать ....как сделать очередь чтоб все по очереди проходили ..или клиент рушится из за ошибки в этом коде ??? Я так подумал что все потоки с одним буфером работают (с одними точнее) и из за этого все рушится ..вот ..Пасиб заранее</i><br><br>Вообще, зачотное описание проблемы.<br>Да, и программировать сетевые приложения сейчас, полагаясь на какую-то там мнимую &quot;однопоточность&quot;, это же полный ерундец. Быстрее переписывайте полностью этот свой код.<br><br>А вот за такое вас можно смело вздернуть на рее:<br><code><br>invoke recv,sock,addr COMANDAIN,1024,0;sizeof COMANDAIN,0<br><br>invoke lstrlen ,addr COMANDAIN</code><br><br>Кто вам сказал, что буфер COMANDAIN, будет завершен нулем?!<br>В 99.9% случаев первое падение данного кода будет в вызове lstrlen().
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=134137&amp;user=4332&amp;forum_n=6&amp;topic=8566&amp;page=0&amp;anchor=7" class="addthx" data-post="134137"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]ganjman[/b]','')">ganjman</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 14.1 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.26'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=4332">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 апреля 2007 08:10 <br><script type="text/javascript">QU('ganjman','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ganjman" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8566&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
И еще добавлю по общей схеме написания парсера.<br>Вот так, как вы пишите:<br>;-------------------------------<br>XY:<br><b>cmp byte ptr [esi],&quot;]&quot;</b><br>jz DALEE<br><br>DALEE:<br>cmp byte ptr [esi+1],&quot;[&quot;<br>jz DALEE2<br><br>DALEE2:<br><br>inc esi<br>inc esi<br>dec ecx<br>dec ecx<br>;-------------------------------<br><br>писать нельзя.<br>Ибо, подумайте сами, что будет с вашим кодом, если размер текущего буфера уже == 0 или если символ &quot;]&quot; будет последним символом буфера? Правильно - падение, а если в нулевом кольце - то &quot;синька&quot;.<br>В надежных парсерах перед зачитыванием символа по смещению, нужно проверять, что текущий размер буфера позволяет это делать. Т.е. в конкретном случае перед выделенной строкой минимум должна идти такая проверка:<br><code><br>cmp ecx, 2<br>jl ERROR_BUF_TOO_SMALL<br></code><br><br>Т.е. приведенный вами код, может вызывать падение в абсолютно разных местах, всё зависит от того какой  <b>рендомный</b> треш содержится в буфере <b>переменного</b> размера.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=134143&amp;user=4332&amp;forum_n=6&amp;topic=8566&amp;page=0&amp;anchor=8" class="addthx" data-post="134143"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]mak[/b]','')">mak</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3520.jpg" alt=""><br><span class=txtSm>Ранг: 673.3 <font color=magenta>(<b>! !</b>)</font>, 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.48'>Активность: 0.4<span style='color:red'>&searr;</span>0.31</span><br>Статус: <a href="action=userinfo&amp;user=3520">Участник</a><br><font color=blue>CyberMonk</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 апреля 2007 11:46 &middot; Поправил: mak <br><script type="text/javascript">QU('mak','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=mak" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8566&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
<I>ganjman пишет:<br>Кто вам сказал, что буфер COMANDAIN, будет завершен нулем?! <br>В 99.9% случаев первое падение данного кода будет в вызове lstrlen(). </I><br>Ну думаю хотябы потому что я посылаю строку закончившуюся 0 ..... вот <I>ganjman пишет:<br>Ибо, подумайте сами, что будет с вашим кодом, если размер текущего буфера уже == 0 или если символ &quot;]&quot; будет последним символом буфера? Правильно - падение, а если в нулевом кольце - то &quot;синька&quot;. <br>В надежных парсерах перед зачитыванием символа по смещению, нужно проверять, что текущий размер буфера позволяет это делать. Т.е. в конкретном случае перед выделенной строкой минимум должна идти такая проверка: <br><br>cmp ecx, 2 <br>jl ERROR_BUF_TOO_SMALL  </I><br>Разделитель последним не будет ...так его не посылаю ))) <br>но думаю эту строчку, а так вообще это да .... просто чето я планировал не так ....вначале бралась длина строки ....и заносилась в ECX потом из каждого цыкла выход был не дожидаясь 0 ECX /// то есть заход в следующий цыкл был уже с инфой от другого ЕСХ...вот ...но это актуально <br><br><br>Строка посылается такого вида  --- ххх][xxx][xxx][xxx][xxx<br><br><I>ganjman пишет:<br>А вот за такое вас можно смело вздернуть на рее: <br><br>invoke recv,sock,addr COMANDAIN,1024,0;sizeof COMANDAIN,0 <br><br>invoke lstrlen ,addr COMANDAIN <br><br>Кто вам сказал, что буфер COMANDAIN, будет завершен нулем?! <br>В 99.9% случаев первое падение данного кода будет в вызове lstrlen(). </I><br><br>Может но на локалке все работает отлично ....<br><br>Так а что думаете по поводу этого , что при отсутствии СЛИП 10 на локалке приходит ....около 20 -30 строчек и все .... а остальные нет .... может пакет приходит слепленным а я читаю только 1024 при ФДРИД <br>а остальное удаляется ..... хотя оно бы тогда часть другую приняло ....приходит по алфавиту от А до Д де то .... может не отсылать все подряд пока нет подтверждения<br><br><br><b>Что с буфером моно сделать ....он ведб один а данные приходят быстро ......</b><br>Перерыл много исходников и литературы ...но инфы чето не нашел
<br><br><font size="1"><i>-----<br>RE In Progress [!] Coding Hazard [!] Stay Clear of this Cube</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=134164&amp;user=3520&amp;forum_n=6&amp;topic=8566&amp;page=0&amp;anchor=9" class="addthx" data-post="134164"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]mak[/b]','')">mak</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3520.jpg" alt=""><br><span class=txtSm>Ранг: 673.3 <font color=magenta>(<b>! !</b>)</font>, 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.48'>Активность: 0.4<span style='color:red'>&searr;</span>0.31</span><br>Статус: <a href="action=userinfo&amp;user=3520">Участник</a><br><font color=blue>CyberMonk</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 апреля 2007 12:19 <br><script type="text/javascript">QU('mak','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=mak" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8566&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
<I>LifeIsPain пишет:<br>mak поставь в качестве JIT - ольгу и посмотри где падает. </I><br>Падает постоянно на команде <br><br>movs byte ptr es:[edi],ds:[esi]  любой из цикла ...смотря что шлешь
<br><br><font size="1"><i>-----<br>RE In Progress [!] Coding Hazard [!] Stay Clear of this Cube</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=134167&amp;user=3520&amp;forum_n=6&amp;topic=8566&amp;page=0&amp;anchor=10" class="addthx" data-post="134167"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]WolfHunter[/b]','')">WolfHunter</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 22.2 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.05'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=5300">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 апреля 2007 12:21 <br><script type="text/javascript">QU('WolfHunter','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=WolfHunter" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8566&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
&gt;Ну думаю хотябы потому что я посылаю строку закончившуюся 0 ..... вот<br>Интересно, а что помешает (в будущем) кому-то еще послать строку <b>не заканчивающуюся нулем</b>?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=134168&amp;user=5300&amp;forum_n=6&amp;topic=8566&amp;page=0&amp;anchor=11" class="addthx" data-post="134168"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]SLV[/b]','')">SLV</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 309.8 (мудрец), 21thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.69'>Активность: 0.17<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=663">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 апреля 2007 13:31 <br><script type="text/javascript">QU('SLV','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=SLV" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8566&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
похоже что код не авторский, ни разу не видел чтобы вместо <code>movsb</code> писали <code>movs byte ptr es:[edi],ds:[esi]</code> <img src="img/smilies/s1.gif" alt="">
<br><br><font size="1"><i>-----<br>Shalom ebanats!</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=134175&amp;user=663&amp;forum_n=6&amp;topic=8566&amp;page=0&amp;anchor=12" class="addthx" data-post="134175"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]ganjman[/b]','')">ganjman</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 14.1 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.26'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=4332">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 апреля 2007 14:39 &middot; Поправил: ganjman <br><script type="text/javascript">QU('ganjman','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ganjman" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8566&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
<I>mak пишет:<br>Разделитель последним не будет ...так его не посылаю ))) <br>Строка посылается такого вида --- ххх][xxx][xxx][xxx][xxx </I><br><br><b>Вы</b> не посылаете последним, а в <b>принимающем</b> буфере(который вы и <b>парсите</b>) вполне вероятна такая ситуация! <br>и такой эффект(нехватка нуля в конце) наблюдается вами во всей красе в виде падения приложения.<br>И ничего свехъестественного в этом нет, ибо это сетевое взаимодействие, где есть такие понятия, как потоки и тайм-ауты, и передача приложению принятых данных п-о-р-ц-и-я-м-и, порой абсолютно различного размера!<br><br>Автору топика читать матчасть по <b>безопасному</b> программированию, а также по сетевой модели, взаимодействию и программированию в TCP/IP сетях.<br><br><I>SLV пишет:<br>похоже что код не авторский </I><br>тогда мне вообще не понятно, зачем потребовалось копаться в таком говне.<br><br>Всё. Я кончил.<br><br>PS: кому нульдей под эту уязвимость?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=134185&amp;user=4332&amp;forum_n=6&amp;topic=8566&amp;page=0&amp;anchor=13" class="addthx" data-post="134185"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]mak[/b]','')">mak</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3520.jpg" alt=""><br><span class=txtSm>Ранг: 673.3 <font color=magenta>(<b>! !</b>)</font>, 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.48'>Активность: 0.4<span style='color:red'>&searr;</span>0.31</span><br>Статус: <a href="action=userinfo&amp;user=3520">Участник</a><br><font color=blue>CyberMonk</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 30 апреля 2007 00:09 <br><script type="text/javascript">QU('mak','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=mak" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8566&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
<I>SLV пишет:<br>похоже что код не авторский, ни разу не видел чтобы вместо movsb писали movs byte ptr es:[edi],ds:[esi] </I><br>не видел чтоб movsb пересылали ... в уч. пособиях везде сказано что формирование movsb идет компилятором .... я так делаю ...<I>WolfHunter пишет:<br>&gt;Ну думаю хотябы потому что я посылаю строку закончившуюся 0 ..... вот <br>Интересно, а что помешает (в будущем) кому-то еще послать строку не заканчивающуюся нулем? </I><br> ну да это верно ...то там шифровка будет и все остально продумаем ...я поставил проверку там где сказали все работает отлично ....все данные приходят и уходят ....но к сожалению не многопоточное .... пока ... про сеть уже много перелопатил Спасибо )))))
<br><br><font size="1"><i>-----<br>RE In Progress [!] Coding Hazard [!] Stay Clear of this Cube</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=134268&amp;user=3520&amp;forum_n=6&amp;topic=8566&amp;page=0&amp;anchor=14" class="addthx" data-post="134268"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]Cigan[/b]','')">Cigan</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 160.9 (ветеран), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.89'>Активность: 0.05<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=208">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 30 апреля 2007 10:38 <br><script type="text/javascript">QU('Cigan','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Cigan" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8566&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
<I>mak пишет:<br>Падает постоянно на команде <br><br>movs byte ptr es:[edi],ds:[esi] любой из цикла ...смотря что шлешь </I><br><br>С какой ошибко то хоть падает?<br><br>P.s. Телепатов тут нет. Ну вы поняли о чем я?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=134299&amp;user=208&amp;forum_n=6&amp;topic=8566&amp;page=0&amp;anchor=15" class="addthx" data-post="134299"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]ganjman[/b]','')">ganjman</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 14.1 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.26'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=4332">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 30 апреля 2007 11:21 <br><script type="text/javascript">QU('ganjman','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ganjman" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8566&amp;page=0#16');return false;">#16</a> </span><div align=left><br>
Уважаемый, Cigan, понимаете ли вы, что когда размер буфера определен не верно, а потом происходит его побайтовое копирование в другой буфер лимитированного размера, это &quot;плохо&quot; со всех сторон?<br>Иль ваш мудрый взгляд диагонально проскользил сей бурный опус к блуждающим во тьме познания?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=134305&amp;user=4332&amp;forum_n=6&amp;topic=8566&amp;page=0&amp;anchor=16" class="addthx" data-post="134305"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]mak[/b]','')">mak</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3520.jpg" alt=""><br><span class=txtSm>Ранг: 673.3 <font color=magenta>(<b>! !</b>)</font>, 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.48'>Активность: 0.4<span style='color:red'>&searr;</span>0.31</span><br>Статус: <a href="action=userinfo&amp;user=3520">Участник</a><br><font color=blue>CyberMonk</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 30 апреля 2007 12:31 <br><script type="text/javascript">QU('mak','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=mak" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8566&amp;page=0#17');return false;">#17</a> </span><div align=left><br>
<I>Cigan пишет:<br>mak пишет: <br>Падает постоянно на команде <br><br>movs byte ptr es:[edi],ds:[esi] любой из цикла ...смотря что шлешь <br><br>С какой ошибко то хоть падает? <br><br>P.s. Телепатов тут нет. Ну вы поняли о чем я? </I><br><br>Изначально я хотел передавать управление каждому циклу от другого .....но оказалось что неправильно ....поэтому когда в ecx заканчивался счетчик действие продолжалось ..........поставив проверку Проблема решилась .......<br><br>НО проблем с буфером приема ...когда пакеты приходят слеплееными а я читаю только 1024 ...и остальные канули в пропасть  осталась.... Я никогда неписал такие приложения ..но посмотреть пример тоже негде ... во всех приложениях используется ресив и сенд ..и все . Так как много данных и подряд не пересылаются в примерах.  Может у кого то есть пример прриема всех данных <br>с помощью FDREAD больших размеров для парсинга <br>P.S де же все ... <img src="img/smilies/s14.gif" alt=""><br><br><br><I>ganjman пишет:<br>Уважаемый, Cigan, понимаете ли вы, что когда размер буфера определен не верно, а потом происходит его побайтовое копирование в другой буфер лимитированного размера, это &quot;плохо&quot; со всех сторон? <br>Иль ваш мудрый взгляд диагонально проскользил сей бурный опус к блуждающим во тьме познания? </I><br><img src="img/smilies/s5.gif" alt=""> загнул то
<br><br><font size="1"><i>-----<br>RE In Progress [!] Coding Hazard [!] Stay Clear of this Cube</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=134314&amp;user=3520&amp;forum_n=6&amp;topic=8566&amp;page=0&amp;anchor=17" class="addthx" data-post="134314"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]s0larian[/b]','')">s0larian</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/1737.jpg" alt=""><br><span class=txtSm>Ранг: 387.4 (мудрец)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.19'>Активность: 0.17<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1737">Участник</a><br><font color=blue>системщик</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 30 апреля 2007 19:35 &middot; Поправил: s0larian <br><script type="text/javascript">QU('s0larian','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=s0larian" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8566&amp;page=0#18');return false;">#18</a> </span><div align=left><br>
<b>mak</b>, чувак, во первых, тебе надо проверять что возвращает recv(). Смотри в MSDN доки: htt_://msdn2.microsoft.com/en-us/library/ms740121.aspx<br><br>Ф-ция возвращает кол-во байт, если нет ошибок. Теперь, самое главное, для тех кто в танке: ты никогда не предугадаешь, сколько байт пришло в последнем сетевом пакете. То есть, данные которые посылаются в одной проге будут сначала buffered (nagle) а потом разбиты стеком на пакеты. Точные характеристики этих двух процессов зависят от установок буфферезации сокета, количеста вызовов send(), реализации стека и MTU сетевого драйвера.<br><br>Поэтому, програмер, ты то есть, должен реализовать структурку &quot;сообщение&quot; которая будет известной длинны (или будет включать поле &quot;размер&quot;) и читать из сокета пока не получишь именно нужное (минимальное) кол-во байт, и только потом парсить. Кста, получить ты иногда можешь и несколько сообщений пачкой (то есть когда стек набил их в буфер).<br><br>Bottom line: необходимое кол-во вызовов recv() никогда не известно заранее. Ну а потом, как и пишет <b>ganjman</b>, надо осторожно парсить всё полученное. Капиш?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=134374&amp;user=1737&amp;forum_n=6&amp;topic=8566&amp;page=0&amp;anchor=18" class="addthx" data-post="134374"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]mak[/b]','')">mak</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3520.jpg" alt=""><br><span class=txtSm>Ранг: 673.3 <font color=magenta>(<b>! !</b>)</font>, 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.48'>Активность: 0.4<span style='color:red'>&searr;</span>0.31</span><br>Статус: <a href="action=userinfo&amp;user=3520">Участник</a><br><font color=blue>CyberMonk</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 30 апреля 2007 21:31 <br><script type="text/javascript">QU('mak','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=mak" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8566&amp;page=0#19');return false;">#19</a> </span><div align=left><br>
Ясненько ....просто каждый по своему говорит ....я думал что если шлю 1024 + 1024 ....каждые 1024 становятся в очередь ....а при приеме я читаю 1024 разве функция  не должна сама ждать пока не получит все 1024 ????  Парсинг терь все ок ....... а вот прием хромает ..... исходников нет полезных ??? по теме ....на васме не нашел ...там все просто
<br><br><font size="1"><i>-----<br>RE In Progress [!] Coding Hazard [!] Stay Clear of this Cube</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=134391&amp;user=3520&amp;forum_n=6&amp;topic=8566&amp;page=0&amp;anchor=19" class="addthx" data-post="134391"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="20" onfocus="this.blur()" href="JavaScript:di('[b]s0larian[/b]','')">s0larian</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/1737.jpg" alt=""><br><span class=txtSm>Ранг: 387.4 (мудрец)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.19'>Активность: 0.17<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1737">Участник</a><br><font color=blue>системщик</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 мая 2007 01:30 &middot; Поправил: s0larian <br><script type="text/javascript">QU('s0larian','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=s0larian" target="_blank">Личное сообщение</a> &middot;  <a href="#20" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8566&amp;page=0#20');return false;">#20</a> </span><div align=left><br>
<I>mak пишет:<br>а при приеме я читаю 1024 разве функция не должна сама ждать пока не получит все 1024 ???? </I><br>С чего ты взял что recv(1024) значит &quot;ждать 1024 байта&quot;? Ты доку читал? Там все описано досканально.<br><br>Так вот, <br><code><br>int recv(socket, buff, buff_len, flags)<br></code><br>и buf_len показывает сколько байт API имеет право загнать в твой буфер. В сокт может прийти и 20 кил с момента когда ты последний раз вызывал recv()....<br><br>Ну а если ты хочешь заставить recv() ждать какого-то определённого кол-ва байтов, то вызывай setsockopt()<br><br>З.Ы. ты, кста, попробывал бы написать несколько взамосвязанных, полностью построенных фраз с пунктуаций <img src="img/smilies/s3.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=134426&amp;user=1737&amp;forum_n=6&amp;topic=8566&amp;page=0&amp;anchor=20" class="addthx" data-post="134426"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="21" onfocus="this.blur()" href="JavaScript:di('[b]mak[/b]','')">mak</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3520.jpg" alt=""><br><span class=txtSm>Ранг: 673.3 <font color=magenta>(<b>! !</b>)</font>, 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.48'>Активность: 0.4<span style='color:red'>&searr;</span>0.31</span><br>Статус: <a href="action=userinfo&amp;user=3520">Участник</a><br><font color=blue>CyberMonk</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 мая 2007 21:58 <br><script type="text/javascript">QU('mak','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=mak" target="_blank">Личное сообщение</a> &middot;  <a href="#21" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8566&amp;page=0#21');return false;">#21</a> </span><div align=left><br>
<I>s0larian пишет:<br>mak пишет: <br>а при приеме я читаю 1024 разве функция не должна сама ждать пока не получит все 1024 ???? <br>С чего ты взял что recv(1024) значит &quot;ждать 1024 байта&quot;? Ты доку читал? Там все описано досканально. <br><br>Так вот, <br><br>int recv(socket, buff, buff_len, flags) <br><br>и buf_len показывает сколько байт API имеет право загнать в твой буфер. В сокт может прийти и 20 кил с момента когда ты последний раз вызывал recv().... <br><br>Ну а если ты хочешь заставить recv() ждать какого-то определённого кол-ва байтов, то вызывай setsockopt() <br><br>З.Ы. ты, кста, попробывал бы написать несколько взамосвязанных, полностью построенных фраз с пунктуаций  </I><br>Пасибо за разяснение! <img src="img/smilies/s1.gif" alt=""> А по поводу многопоточного приема есть пример у кого нибудь ???!!! <img src="img/smilies/s14.gif" alt="">
<br><br><font size="1"><i>-----<br>RE In Progress [!] Coding Hazard [!] Stay Clear of this Cube</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=134555&amp;user=3520&amp;forum_n=6&amp;topic=8566&amp;page=0&amp;anchor=21" class="addthx" data-post="134555"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="22" onfocus="this.blur()" href="JavaScript:di('[b]S_T_A_S_[/b]','')">S_T_A_S_</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 163.7 (ветеран)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.87'>Активность: 0.07<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=251">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 мая 2007 11:05 &middot; Поправил: S_T_A_S_ <br><script type="text/javascript">QU('S_T_A_S_','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=S_T_A_S_" target="_blank">Личное сообщение</a> &middot;  <a href="#22" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8566&amp;page=0#22');return false;">#22</a> </span><div align=left><br>
<I>mak пишет:<br>в уч. пособиях везде сказано что формирование movsb идет компилятором .... я так делаю </I><br>Ты не понял <img src="img/smilies/s1.gif" alt=""><br>руками пишут (как и ты сейчас _сам_ <img src="img/smilies/s5.gif" alt=""> сделал) <b>movsb</b> или (значительно реже) <b>movs byte ptr [edi],[esi]</b> А форма <b>movs byte ptr es:[edi],ds:[esi]</b> выдаётся дизассеблерами<br><br><I>ganjman пишет:<br>тогда мне вообще не понятно, зачем потребовалось копаться в таком говне </I><br>Трояна чужего ковыряет небось <img src="img/smilies/s1.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=134619&amp;user=251&amp;forum_n=6&amp;topic=8566&amp;page=0&amp;anchor=22" class="addthx" data-post="134619"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="23" onfocus="this.blur()" href="JavaScript:di('[b]mak[/b]','')">mak</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3520.jpg" alt=""><br><span class=txtSm>Ранг: 673.3 <font color=magenta>(<b>! !</b>)</font>, 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.48'>Активность: 0.4<span style='color:red'>&searr;</span>0.31</span><br>Статус: <a href="action=userinfo&amp;user=3520">Участник</a><br><font color=blue>CyberMonk</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 мая 2007 12:42 <br><script type="text/javascript">QU('mak','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=mak" target="_blank">Личное сообщение</a> &middot;  <a href="#23" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8566&amp;page=0#23');return false;">#23</a> </span><div align=left><br>
<I>S_T_A_S_ пишет:<br>mak пишет: <br>в уч. пособиях везде сказано что формирование movsb идет компилятором .... я так делаю <br>Ты не понял  <br>руками пишут (как и ты сейчас _сам_  сделал) movsb или (значительно реже) movs byte ptr [edi],[esi] А форма movs byte ptr es:[edi],ds:[esi] выдаётся дизассеблерами <br><br>ganjman пишет: <br>тогда мне вообще не понятно, зачем потребовалось копаться в таком говне <br>Трояна чужего ковыряет небось  </I><br><br>Ну нет ...честно я не знал что моно так писать ...так как думал что компилятор формирует такую команду из того что я пишу .....<br><br>Нет не ковыряю ...еслиб это помогло , было бы круто ....раньше пол года назад ковырял ..смотрел как построен обмен ...и оказался как у всех исходников на васме...<br><br>Хоть убей я не пойму почему , когда посылается много инфы доходит не вся .... я сделал многопоточный прием . на каждый ФДРИД свой поток ,для обработки свои буфера. Если даже некоторые приходят слепленными ,как их обработать ????   Ни кто не знает у кого спрашивал <img src="img/smilies/s15.gif" alt="">
<br><br><font size="1"><i>-----<br>RE In Progress [!] Coding Hazard [!] Stay Clear of this Cube</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=134634&amp;user=3520&amp;forum_n=6&amp;topic=8566&amp;page=0&amp;anchor=23" class="addthx" data-post="134634"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="24" onfocus="this.blur()" href="JavaScript:di('[b]s0larian[/b]','')">s0larian</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/1737.jpg" alt=""><br><span class=txtSm>Ранг: 387.4 (мудрец)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.19'>Активность: 0.17<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1737">Участник</a><br><font color=blue>системщик</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 мая 2007 19:16 &middot; Поправил: s0larian <br><script type="text/javascript">QU('s0larian','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=s0larian" target="_blank">Личное сообщение</a> &middot;  <a href="#24" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8566&amp;page=0#24');return false;">#24</a> </span><div align=left><br>
<I>mak пишет:<br>А по поводу многопоточного приема есть пример у кого нибудь ???!! </I><br>То есть? У тебя сколько сокетов? Один сокет должен обрабатываться из одного потока, а иначе ты просто получишь классические raced conditions.<br><br>По поводу приёма/передачи: я же отписал уже, сделай структурку типа:<br><br><code><br>#pragma pack(push)<br>#pragma pack(1)<br><br>enum MessageType<br>{<br>    MSG_HELLO = 100<br>};<br><br>struct MessageHeader<br>{<br>    uint32 size;<br>    MessageType type;<br>};<br><br>struct Hello<br>{<br>   byte version;<br>   uint32 id;<br>   // whatever you want goes here....<br>};<br>#pragma pack(pop)<br></code><br><br>Читаешь сначала sizeof(MessageHeader), потом читаешь ещё header.size байтов. Получив все данные смотришь header.type, и если это MSG_HELLO делаешь cast и разбираешь полученный Hello.<br><br>З.Ы. TCP, концептуально, даёт тебе поток данных и гарантирует доставку и порядок. Понятия &quot;сообщений&quot; тут нет и, следвательно, ты их реализуешь.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=134695&amp;user=1737&amp;forum_n=6&amp;topic=8566&amp;page=0&amp;anchor=24" class="addthx" data-post="134695"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="25" onfocus="this.blur()" href="JavaScript:di('[b]mak[/b]','')">mak</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3520.jpg" alt=""><br><span class=txtSm>Ранг: 673.3 <font color=magenta>(<b>! !</b>)</font>, 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.48'>Активность: 0.4<span style='color:red'>&searr;</span>0.31</span><br>Статус: <a href="action=userinfo&amp;user=3520">Участник</a><br><font color=blue>CyberMonk</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 02 мая 2007 21:58 <br><script type="text/javascript">QU('mak','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=mak" target="_blank">Личное сообщение</a> &middot;  <a href="#25" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8566&amp;page=0#25');return false;">#25</a> </span><div align=left><br>
<I>s0larian пишет:<br>mak пишет: <br>А по поводу многопоточного приема есть пример у кого нибудь ???!! <br>То есть? У тебя сколько сокетов? Один сокет должен обрабатываться из одного потока, а иначе ты просто получишь классические raced conditions. <br><br>По поводу приёма/передачи: я же отписал уже, сделай структурку типа: <br><br><br>#pragma pack(push) <br>#pragma pack(1) <br><br>enum MessageType <br>{ <br>MSG_HELLO = 100 <br>}; <br><br>struct MessageHeader <br>{ <br>uint32 size; <br>MessageType type; <br>}; <br><br>struct Hello <br>{ <br>byte version; <br>uint32 id; <br>// whatever you want goes here.... <br>}; <br>#pragma pack(pop) <br><br><br>Читаешь сначала sizeof(MessageHeader), потом читаешь ещё header.size байтов. Получив все данные смотришь header.type, и если это MSG_HELLO делаешь cast и разбираешь полученный Hello. <br><br>З.Ы. TCP, концептуально, даёт тебе поток данных и гарантирует доставку и порядок. Понятия &quot;сообщений&quot; тут нет и, следвательно, ты их реализуешь. </I><br><br>Плиз переведи на асм  или на асме ничего не заволялось... я так понял ты строку написал ...структуру пакета ??? Я не понимаю С++ или что это ... <img src="img/smilies/s14.gif" alt="">
<br><br><font size="1"><i>-----<br>RE In Progress [!] Coding Hazard [!] Stay Clear of this Cube</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=134720&amp;user=3520&amp;forum_n=6&amp;topic=8566&amp;page=0&amp;anchor=25" class="addthx" data-post="134720"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="26" onfocus="this.blur()" href="JavaScript:di('[b]mak[/b]','')">mak</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3520.jpg" alt=""><br><span class=txtSm>Ранг: 673.3 <font color=magenta>(<b>! !</b>)</font>, 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.48'>Активность: 0.4<span style='color:red'>&searr;</span>0.31</span><br>Статус: <a href="action=userinfo&amp;user=3520">Участник</a><br><font color=blue>CyberMonk</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 мая 2007 13:31 <br><script type="text/javascript">QU('mak','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=mak" target="_blank">Личное сообщение</a> &middot;  <a href="#26" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8566&amp;page=0#26');return false;">#26</a> </span><div align=left><br>
Я понял о чем ты говоришь ..... но смотри .... если я посылаю в нете много этих структур ....уже сформированных ............ доходят только первые .......я попробовал слип в 50 установить и доходит  больше !!!!! как это обьяснить ?  Строка посылается такого вида --- ххх][xxx][xxx][xxx][xxx ...это каждый сенд ....сендов может быть около 250 ...... если они приходят слепелны ...то тогда вид такой будет ? Строка посылается такого вида --- ххх][xxx][xxx][xxx][xxx+ххх][xxx][xxx][xxx][xxx+ххх][xxx][xxx][xxx][xx x<br>и часть я потеряю при парсинге ? ....правильно ???
<br><br><font size="1"><i>-----<br>RE In Progress [!] Coding Hazard [!] Stay Clear of this Cube</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=134984&amp;user=3520&amp;forum_n=6&amp;topic=8566&amp;page=0&amp;anchor=26" class="addthx" data-post="134984"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="27" onfocus="this.blur()" href="JavaScript:di('[b]Unmoored[/b]','')">Unmoored</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 10.2 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.48'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=9253">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 мая 2007 14:32 <br><script type="text/javascript">QU('Unmoored','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Unmoored" target="_blank">Личное сообщение</a> &middot;  <a href="#27" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8566&amp;page=0#27');return false;">#27</a> </span><div align=left><br>
Песдетс... Посылай не <br>xxx][xxx][xxx][xxx][xxx + ... + xxx][xxx][xxx][xxx][xxx<br>а<br>SIG|LEN|xxx][xxx][xxx][xxx][xxx + ... + SIG|LEN|xxx][xxx][xxx][xxx][xxx<br>Короче введи разметку потока. А еще проще заюзать COBS байтстаффинг. Также учти фрагментацию сообщений. Ты можешь просто не считать конец сообщения в свой буфер или конец мог еще не прийти ести размер сообщения &gt; MTU. Для корректного приёма надо влезшую часть сообщения сдвинуть в начало буфера и вызвать recv, где в качестве буфера надо указать &lt;АДРЕС БУФЕРА&gt; + &lt;РАЗМЕР ФРАГМЕНТА&gt;.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=134997&amp;user=9253&amp;forum_n=6&amp;topic=8566&amp;page=0&amp;anchor=27" class="addthx" data-post="134997"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="28" onfocus="this.blur()" href="JavaScript:di('[b]Halt[/b]','')">Halt</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 65.7 (постоянный)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.87'>Активность: 0.05<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=240">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 мая 2007 22:32 &middot; Поправил: Halt <br><script type="text/javascript">QU('Halt','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Halt" target="_blank">Личное сообщение</a> &middot;  <a href="#28" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8566&amp;page=0#28');return false;">#28</a> </span><div align=left><br>
похоже он просто не понимает <img src="img/smilies/s1.gif" alt=""><br>смысл такой ты послал 1024 байта и еще 1024 байта, они ушли нормально, а на компьютере с сервером (или клиентом которому ты их эти 1024 послал) винда вдруг решила дефрагментировать свой загрузочный сектор (это например) в результате чего по команде recv тебе прилетело 15 байт потом через пару секунд еще 15 а потом 2048. Вопрос как узнать сколько посылали(именно не длинну сообщения, а размер отосланных данных (которые возвращает send после выполнения, опять же тут тоже нужна проверка а все ли было отправлено?? и если невсе то дослать остаток) ), т.е. если ты не знаешь то примешь только первые 15 байт и все.. а остальное пролетит мимо выринтов выхода тут 2 либо к соообщению прибавлять контрольный (завершающий) симол (как 0 в конце текстовой строки) либо как уже было сказано выше использовать в пакете длинну сообщения в результате общий вид схемы приема будет такой :<br><br>клиент:<br>отослал 1024<br><br>сервер(при использовании разделяющего символа):<br>принял колько-то <br>посмотрел встречается ли в принятом этот разделяющий символ<br>да  -  скопировал симвлы до него и отправил на обработку. конец.<br>нет - скоппировал принятые данные в переменную (буфер и т.д.) и ждет дальше до тех пор пока либо не примет (по условию ДА) все либо (как делают продвинутые девелоперы) не истечет некоторый таймаут и можно будет смело орать про ошибку сети.<br><br>при условии использования длинны пакета в сообщении условие будет таким:<br>принял сколько-то<br>взял 4 символ (ну или с 4 по 7 например)) (я знаю что там длинна пакета) сравнил с тем что пришло за вычетом данных о самой длинне (которые с 4 до 7 символа) , и за вычетом сигнатуры пакета (а твой ли это вообще пакет или кто-то ддос атаку устроил) (если используешь) в результате :<br>- да, все пришло, - обработка.конец<br>- нет:<br>     -пришло больше добираем из пришедшего данные до длинны сообщения (которая пришла раньше) ну а остальное это уже новый пакет. законченый пакет на обработку и ждем досылки данных длял нового пакета.<br>     - пришло меньше - записываем в буфер и ждем отстатки.<br><br><br>ну в общем вроде получается что-то как-то так... возможно где-то ошибся.... прием и передачу можно сравнить с посылкой текста без пробелов.. т.е. пробел тут либо разделяющий символ.. либо надо перед каждым словом слать его длинну чтоб не запутаться...<br><br>ЗЫ да и еще разделяющий сомвол не должен встречаться в тексте сообщения а иначе будет жопа с ручкой... что в условиях пересылки например ехе файла нереально.. поэтому лучшим выходом будет указание длинны отосланного пакета.<br>да и еще длинна части пакета отвечающая за размер должна быть одинаковой, а иначе непонятно сколько брать... если число меньше - просто ддополняй его нулями в начале ...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=135057&amp;user=240&amp;forum_n=6&amp;topic=8566&amp;page=0&amp;anchor=28" class="addthx" data-post="135057"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="29" onfocus="this.blur()" href="JavaScript:di('[b]mak[/b]','')">mak</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3520.jpg" alt=""><br><span class=txtSm>Ранг: 673.3 <font color=magenta>(<b>! !</b>)</font>, 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.48'>Активность: 0.4<span style='color:red'>&searr;</span>0.31</span><br>Статус: <a href="action=userinfo&amp;user=3520">Участник</a><br><font color=blue>CyberMonk</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 мая 2007 16:11 &middot; Поправил: mak <br><script type="text/javascript">QU('mak','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=mak" target="_blank">Личное сообщение</a> &middot;  <a href="#29" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8566&amp;page=0#29');return false;">#29</a> </span><div align=left><br>
Да я понял .....клиент уже так сделан ....только вот проблема не в получении а в отправке ...на Сервере я отправляю без слип 10  .....и валится .....а при слип 10 на локалке ок ...в инете опять тоже самое ....<br><br>Примера нет ни у кого ?
<br><br><font size="1"><i>-----<br>RE In Progress [!] Coding Hazard [!] Stay Clear of this Cube</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=135118&amp;user=3520&amp;forum_n=6&amp;topic=8566&amp;page=0&amp;anchor=29" class="addthx" data-post="135118"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="30" onfocus="this.blur()" href="JavaScript:di('[b]s0larian[/b]','')">s0larian</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/1737.jpg" alt=""><br><span class=txtSm>Ранг: 387.4 (мудрец)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.19'>Активность: 0.17<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1737">Участник</a><br><font color=blue>системщик</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 мая 2007 19:38 &middot; Поправил: s0larian <br><script type="text/javascript">QU('s0larian','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=s0larian" target="_blank">Личное сообщение</a> &middot;  <a href="#30" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8566&amp;page=0#30');return false;">#30</a> </span><div align=left><br>
<b>mak</b>, ну это уже клиника просто.... мы же с <b>Halt-ом</b> тебе уже всё расписали и разложили.<br><br>1) перечитай наши посты<br>2) напиши и клиента и сервера на С/Delphi/VB<br>3) перепиши код на асме<br>4) 5) 6) поправь там все косяки парсинга и управления памятью <img src="img/smilies/s1.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=135426&amp;user=1737&amp;forum_n=6&amp;topic=8566&amp;page=0&amp;anchor=30" class="addthx" data-post="135426"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> .  <b>1</b> . <a href="action=vthread&amp;forum=6&amp;topic=8566&amp;page=1.html">2</a> . <a href="action=vthread&amp;forum=6&amp;topic=8566&amp;page=1.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Рушится при Recv в нете но не локалке</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#31" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="6">
<input type="hidden" name="topic" value="8566">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=8566" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
