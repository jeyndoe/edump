<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Вопрос по лоадеру - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Уважаемые коллеги, столкнулся со следующей проблемой, подскажите куда копать и как вообще правильно... Ниже приведен кусок кода который: 1. Создает процесс в SUSPENDED состоянии 2. Запускает процесс на 20 мсек и потом опять">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=42072'>zombi-vadim</a>, <a target='_blank' href='?action=userinfo&amp;user=31361'>zds</a> (+4 невидимых)</b></span>
</td>
</tr>
</table>

 

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Вопрос по лоадеру</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]figgler[/b]','')">figgler</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 11.2 (новичок), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.5'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=8982">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 сентября 2013 13:26 &middot; Поправил: figgler <br><script type="text/javascript">QU('figgler','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=figgler" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22142.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Уважаемые коллеги,<br>столкнулся со следующей проблемой, подскажите куда копать и как вообще правильно...<br><br>Ниже приведен кусок кода который:<br>1. Создает процесс в SUSPENDED состоянии<br>2. Запускает процесс на 20 мсек и потом опять останавливает<br>3. Делает снимок запущеного модуля <br>4. Находит адрес таблицы импорта<br>5. В процедуре POKES происходит поиск нужной функции, ее адреса и замена кода<br><br>Проблема:<br><br>пункт 2 - в коде коментарий<br>Это делается для того, чтобы нормально отработала функция снимка модуля - если ее делать сразу после создания процесса, снимок не получается.<br>Если поставить время выполнения процесса (между запуском и остановкой) меньше - процесс не успевает &quot;развернуться&quot; и снимок не выходит, если поставить больше (например 300) то успевает сработать функция которую я хочу изменить в целевой программе.<br>Время это разное (как я понял) для разного &quot;железа&quot; - зависит от быстродействия, загруженности и пр.<br><br>Есть ли какой способ гарантировать развертку процесса и остановку его в момент когда программа еще не начала выполняться...<br><br>Проблема в том, что код который делает снимок модуля (чтобы узнать базовый адрес) выполняется слишком долго и без остановки процесса всегда приводит к тому, что функция которую я меняю уже выпоняется, если же я укажу базовый адрес вручную - все успевает сработать без остановки...<br><br>Возможно я изначально пошел не по тому пути, идея такова:<br><br>1. В целевой программе используется ДЛЛ с функциями которые легко заблокировать заменой точки входа этих функций на РЕТ (изменять саму ДЛЛ нельзя как и основную программу)<br>2. Можно найти адреса этих функций (вызовы в программе) и загрузчиком их изменить, но захотелось автоматизма.<br>3. Загрузчик должен сам найти адреса функций (где они размещены после загрузки ДЛЛ) и заменить код.<br><br>На текущий момент все реализовано, но хотелось бы гарантированного результата...<br><br>Буду рад подсказкам, идеям и вообще...<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>invoke</b></span>&nbsp;CreateProcessA<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>ADDR</b></span>&nbsp;exeName<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">FALSE</span><span class="hl_char">,</span>&nbsp;CREATE_SUSPENDED<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>ADDR</b></span>&nbsp;StartupInfo<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>ADDR</b></span>&nbsp;ProcessInfo</li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_comment">;//NORMAL_PRIORITY_CLASS</span></li><li class="hl_l1"><span class="hl_comment">;//CREATE_SUSPENDED</span></li><li class="hl_l0"><span class="hl_comment">;//IDLE_PRIORITY_CLASS</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_char">.</span><span class="hl_function"><b>IF</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">!</span><span class="hl_char">=</span><span class="hl_number">0</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_comment">;//ЗАПУСК ПРОЦЕССА И ОПЯТЬ ОСТАНОВКА</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>invoke</b></span>&nbsp;ResumeThread<span class="hl_char">,</span>&nbsp;ProcessInfo<span class="hl_char">.</span>hThread</li><li class="hl_l0"><span class="hl_function"><b>invoke</b></span>&nbsp;Sleep<span class="hl_char">,</span>&nbsp;<span class="hl_number">20</span></li><li class="hl_l1"><span class="hl_function"><b>invoke</b></span>&nbsp;SuspendThread<span class="hl_char">,</span>&nbsp;ProcessInfo<span class="hl_char">.</span>hThread</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_function"><b>invoke</b></span>&nbsp;CreateToolhelp32Snapshot<span class="hl_char">,</span>&nbsp;TH32CS_SNAPMODULE<span class="hl_char">,</span>&nbsp;ProcessInfo<span class="hl_char">.</span>dwProcessId</li><li class="hl_l1"><span class="hl_function"><b>cmp</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span></li><li class="hl_l0"><span class="hl_function"><b>je</b></span>&nbsp;someerror</li><li class="hl_l1"><span class="hl_function"><b>mov</b></span>&nbsp;hSnapshoot<span class="hl_char">,</span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>mov</b></span>&nbsp;me32<span class="hl_char">.</span>dwSize<span class="hl_char">,</span>size&nbsp;MODULEENTRY32</li><li class="hl_l0"><span class="hl_function"><b>invoke</b></span>&nbsp;Module32First<span class="hl_char">,</span>&nbsp;&nbsp;hSnapshoot<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;me32</li><li class="hl_l1"><span class="hl_function"><b>cmp</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span></li><li class="hl_l0"><span class="hl_function"><b>je</b></span>&nbsp;someerror</li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_comment">;//me32 содержит данные о нужном модуле</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;me32<span class="hl_char">.</span>modBaseAddr</li><li class="hl_l1"><span class="hl_function"><b>mov</b></span>&nbsp;baseAddr<span class="hl_char">,</span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>invoke</b></span>&nbsp;CloseHandle<span class="hl_char">,</span>&nbsp;hSnapshoot</li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_comment">;baseAddr dd ?</span></li><li class="hl_l0"><span class="hl_comment">;ITA		 dd ?</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_comment">;//get ITA</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_function"><b>invoke</b></span>&nbsp;VirtualAllocEx<span class="hl_char">,</span>&nbsp;ProcessInfo<span class="hl_char">.</span>hProcess<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">10000</span><span class="hl_char">,</span>&nbsp;MEM_COMMIT<span class="hl_char">,</span>&nbsp;PAGE_READONLY&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span>&nbsp;baseAddr</li><li class="hl_l1"><span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">180h</span></li><li class="hl_l0"><span class="hl_function"><b>invoke</b></span>&nbsp;ReadProcessMemory<span class="hl_char">,</span>&nbsp;ProcessInfo<span class="hl_char">.</span>hProcess<span class="hl_char">,</span>&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>ADDR</b></span>&nbsp;szBuff<span class="hl_char">,</span>&nbsp;<span class="hl_number">4</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span>&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>OFFSET</b></span>&nbsp;szBuff&nbsp;</li><li class="hl_l0"><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">ebx</span><span class="hl_char">]</span></li><li class="hl_l1"><span class="hl_function"><b>cmp</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_comment">;// if 0 конец массива</span></li><li class="hl_l0"><span class="hl_function"><b>je</b></span>&nbsp;someerror</li><li class="hl_l1"><span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span>&nbsp;baseAddr<span class="hl_comment">;//ebx содержит ITA (адрес таблицы импорта)</span></li><li class="hl_l0"><span class="hl_function"><b>mov</b></span>&nbsp;ITA<span class="hl_char">,</span>&nbsp;<span class="hl_registr">ebx</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_function"><b>invoke</b></span>&nbsp;POKES&nbsp;<span class="hl_comment">;//меняем код</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">someerror<span class="hl_char">:</span></li><li class="hl_l1"><span class="hl_function"><b>invoke</b></span>&nbsp;VirtualFreeEx<span class="hl_char">,</span>&nbsp;ProcessInfo<span class="hl_char">.</span>hProcess<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">10000</span><span class="hl_char">,</span>&nbsp;MEM_DECOMMIT</li><li class="hl_l0"><span class="hl_function"><b>invoke</b></span>&nbsp;ResumeThread<span class="hl_char">,</span>&nbsp;ProcessInfo<span class="hl_char">.</span>hThread</li><li class="hl_l1"><span class="hl_function"><b>invoke</b></span>&nbsp;ExitProcess<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span></li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=330475&amp;user=8982&amp;forum_n=6&amp;topic=22142.html&amp;page=0&amp;anchor=1" class="addthx" data-post="330475"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]DillerInc[/b]','')">DillerInc</a></b><br></div>
<img src="img/s6.gif" alt=""><br><img style="padding-top:3px;" src="av/1613.gif" alt=""><br><span class=txtSm>Ранг: 283.6 (наставник), 56thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.25'>Активность: 0.13<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1613">Участник</a><br><font color=blue>Author of GeTaOEP</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 сентября 2013 13:48 <br><script type="text/javascript">QU('DillerInc','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DillerInc" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22142.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
<b>figgler</b>, как вариант запустить под отладкой, поставить бряку на EP, поймать её как отладочное событие и далее делать, что вам нужно.<br>Иначе ваш Sleep - это костыль.
<br><br><font size="1"><i>-----<br>the Power of Reversing team</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=330478&amp;user=1613&amp;forum_n=6&amp;topic=22142.html&amp;page=0&amp;anchor=2" class="addthx" data-post="330478"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]Vovan666[/b]','')">Vovan666</a></b><br></div>
<img src="img/s8.gif" alt=""><br><span class=txtSm>Ранг: 617.3 (<b>!</b>), 677thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.06'>Активность: 0.54<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=5291">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 сентября 2013 13:54 <br><script type="text/javascript">QU('Vovan666','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vovan666" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22142.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
попробуй создавать нормальный процесс<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span></li><li class="hl_l1"><span class="hl_char">.</span><span class="hl_function"><b>IF</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">!</span><span class="hl_char">=</span><span class="hl_number">0</span></li><li class="hl_l0"><span class="hl_function"><b>invoke</b></span>&nbsp;WaitForInputIdle<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span>ProcessInfo<span class="hl_char">.</span>hProcess<span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span></li><li class="hl_l1"><span class="hl_function"><b>invoke</b></span>&nbsp;SuspendThread<span class="hl_char">,</span>&nbsp;ProcessInfo<span class="hl_char">.</span>hThread</li><li class="hl_l0"><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span></li>        </ol>
    </div>
</div></div>
<br>А вообще проще дописать чуток кода и стопориться на ОЕП.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=330479&amp;user=5291&amp;forum_n=6&amp;topic=22142.html&amp;page=0&amp;anchor=3" class="addthx" data-post="330479"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=8982" title="10-09-2013 07:03, ранг:6.0" target="_blank">figgler</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]DillerInc[/b]','')">DillerInc</a></b><br></div>
<img src="img/s6.gif" alt=""><br><img style="padding-top:3px;" src="av/1613.gif" alt=""><br><span class=txtSm>Ранг: 283.6 (наставник), 56thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.25'>Активность: 0.13<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1613">Участник</a><br><font color=blue>Author of GeTaOEP</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 сентября 2013 14:11 <br><script type="text/javascript">QU('DillerInc','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DillerInc" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22142.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
<b>Vovan666</b><br>MSDN &gt;&gt; WaitForInputIdle &gt;&gt; the parent process can use the WaitForInputIdle function to determine when the child&#039;s initialization has been completed. For example, the parent process should use the WaitForInputIdle function before trying to find a window associated with the child process<br>...иначе говоря, вы получаете управление после того, как целевая программа войдёт в цикл ожидания сообщений (если она вообще должна в него войти), а это уже может быть далеко от EP.
<br><br><font size="1"><i>-----<br>the Power of Reversing team</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=330484&amp;user=1613&amp;forum_n=6&amp;topic=22142.html&amp;page=0&amp;anchor=4" class="addthx" data-post="330484"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]figgler[/b]','')">figgler</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 11.2 (новичок), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.5'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=8982">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 сентября 2013 14:45 &middot; Поправил: figgler <br><script type="text/javascript">QU('figgler','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=figgler" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22142.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
<b>DillerInc</b><br>Я понимаю что Слип это костыль - поэтому и интересуюсь - явно есть способы сделать это правильно...<br><br><b>Vovan666</b> По поводу стопориться на ОЕП - можно поподробнее алгоритм (если код - вообще прекрасно) - или просто какие апи функции(я), я разберусь...<br><br>Да, как вариант я пробовал менять в точке входа JMP на себя, но опять же чтобы узнать точку входа нужно узнать базовый адрес...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=330486&amp;user=8982&amp;forum_n=6&amp;topic=22142.html&amp;page=0&amp;anchor=5" class="addthx" data-post="330486"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]DillerInc[/b]','')">DillerInc</a></b><br></div>
<img src="img/s6.gif" alt=""><br><img style="padding-top:3px;" src="av/1613.gif" alt=""><br><span class=txtSm>Ранг: 283.6 (наставник), 56thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.25'>Активность: 0.13<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1613">Участник</a><br><font color=blue>Author of GeTaOEP</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 сентября 2013 14:58 <br><script type="text/javascript">QU('DillerInc','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DillerInc" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22142.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
<b>figgler</b>, так я вам предложил один из способов - использовать отладочный цикл.<br><u><noindex><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms681675(v=vs.85).aspx" rel="nofollow" target="_blank">-&gt;Например&lt;-</a></noindex></u><br>Всё зависит от ваших конкретных условий. Если у вас программа палит отладчик, то такой подход само собой неприемлем.<br><br>Чую, что сейчас Вован вам предложит писать с помощью WriteProcessMemory два байта на EP - 0xfeeb - и в таком состоянии отпускать поток. Да, вы застопоритесь на EP, но получите ещё один костыль - очередной Sleep на неопределённое время, чтобы init процесса полностью выполнился.
<br><br><font size="1"><i>-----<br>the Power of Reversing team</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=330487&amp;user=1613&amp;forum_n=6&amp;topic=22142.html&amp;page=0&amp;anchor=6" class="addthx" data-post="330487"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]figgler[/b]','')">figgler</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 11.2 (новичок), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.5'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=8982">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 сентября 2013 15:33 &middot; Поправил: figgler <br><script type="text/javascript">QU('figgler','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=figgler" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22142.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
<b>DillerInc</b> Да, программа &quot;палит отладчик&quot;, поэтому и просил <b>Vovan666</b> больше инфы...<br>Насчет &quot;EP - 0xfeeb&quot; - я так и делал, но опять же вопрос - как узнать нужный адрес ЕР за приемлемое время?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=330488&amp;user=8982&amp;forum_n=6&amp;topic=22142.html&amp;page=0&amp;anchor=7" class="addthx" data-post="330488"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]Vovan666[/b]','')">Vovan666</a></b><br></div>
<img src="img/s8.gif" alt=""><br><span class=txtSm>Ранг: 617.3 (<b>!</b>), 677thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.06'>Активность: 0.54<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=5291">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 сентября 2013 15:46 <br><script type="text/javascript">QU('Vovan666','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vovan666" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22142.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
код не мой но частенько пользуюсь<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_char">.</span><span class="hl_function">const</span></li><li class="hl_l1">hookbytes&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>dw</b></span>&nbsp;<span class="hl_number">0FEEBh</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">FullHook&nbsp;<span class="hl_function"><b>proc</b></span>&nbsp;hookaddr<span class="hl_char">:</span><span class="hl_function">DWORD</span></li><li class="hl_l0"><span class="hl_function"><b>LOCAL</b></span>&nbsp;threadcontext<span class="hl_char">:</span>CONTEXT</li><li class="hl_l1"><span class="hl_function"><b>LOCAL</b></span>&nbsp;backup<span class="hl_char">:</span><span class="hl_function">DWORD</span></li><li class="hl_l0"><span class="hl_function"><b>LOCAL</b></span>&nbsp;backupb<span class="hl_char">:</span><span class="hl_function">WORD</span></li><li class="hl_l1"><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>hookaddr</li><li class="hl_l0"><span class="hl_function"><b>mov</b></span>&nbsp;backup<span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l1"><span class="hl_function"><b>invoke</b></span>&nbsp;ReadProcessMemory<span class="hl_char">,</span>pinfo<span class="hl_char">.</span>hProcess<span class="hl_char">,</span>hookaddr<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;backupb<span class="hl_char">,</span><span class="hl_number">2h</span><span class="hl_char">,</span><span class="hl_number">0</span></li><li class="hl_l0"><span class="hl_function"><b>invoke</b></span>&nbsp;WriteProcessMemory<span class="hl_char">,</span>pinfo<span class="hl_char">.</span>hProcess<span class="hl_char">,</span>hookaddr<span class="hl_char">,</span><span class="hl_function"><b>offset</b></span>&nbsp;hookbytes<span class="hl_char">,</span><span class="hl_number">2h</span><span class="hl_char">,</span><span class="hl_number">0</span></li><li class="hl_l1"><span class="hl_function"><b>invoke</b></span>&nbsp;RtlZeroMemory<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;threadcontext<span class="hl_char">,</span><span class="hl_function"><b>sizeof</b></span>&nbsp;threadcontext</li><li class="hl_l0"><span class="hl_function"><b>invoke</b></span>&nbsp;ResumeThread<span class="hl_char">,</span>pinfo<span class="hl_char">.</span>hThread</li><li class="hl_l1"><span class="hl_function"><b>invoke</b></span>&nbsp;Sleep<span class="hl_char">,</span><span class="hl_number">100</span></li><li class="hl_l0"><span class="hl_function"><b>mov</b></span>&nbsp;threadcontext<span class="hl_char">.</span>ContextFlags<span class="hl_char">,</span>CONTEXT_FULL</li><li class="hl_l1">@@<span class="hl_char">:</span></li><li class="hl_l0"><span class="hl_function"><b>invoke</b></span>&nbsp;GetThreadContext<span class="hl_char">,</span>pinfo<span class="hl_char">.</span>hThread<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;threadcontext</li><li class="hl_l1"><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>hookaddr</li><li class="hl_l0"><span class="hl_function"><b>cmp</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>threadcontext<span class="hl_char">.</span>regEip</li><li class="hl_l1"><span class="hl_function"><b>jnz</b></span>&nbsp;@B</li><li class="hl_l0"><span class="hl_function"><b>invoke</b></span>&nbsp;SuspendThread<span class="hl_char">,</span>pinfo<span class="hl_char">.</span>hThread</li><li class="hl_l1"><span class="hl_function"><b>invoke</b></span>&nbsp;WriteProcessMemory<span class="hl_char">,</span>pinfo<span class="hl_char">.</span>hProcess<span class="hl_char">,</span>backup<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;backupb<span class="hl_char">,</span><span class="hl_number">2h</span><span class="hl_char">,</span><span class="hl_number">0</span></li><li class="hl_l0"><span class="hl_function">ret</span></li><li class="hl_l1">FullHook&nbsp;<span class="hl_function">endp</span></li>        </ol>
    </div>
</div></div>
<br><br>EP читаешь из файла<br>типа так<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>mov</b></span>&nbsp;d&nbsp;<span class="hl_char">[</span>pMem<span class="hl_char">]</span><span class="hl_char">,</span>InputFile<span class="hl_char">(</span><span class="hl_quote">&quot;имя файла&quot;</span><span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span>d&nbsp;<span class="hl_char">[</span>pMem<span class="hl_char">]</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span><span class="hl_char">[</span><span class="hl_registr">edx</span><span class="hl_char">.</span>IMAGE_DOS_HEADER<span class="hl_char">.</span>e_lfanew<span class="hl_char">]</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_char">[</span><span class="hl_registr">edx</span><span class="hl_char">.</span>IMAGE_NT_HEADERS<span class="hl_char">.</span>OptionalHeader<span class="hl_char">.</span>AddressOfEntryPoint<span class="hl_char">]</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;ep<span class="hl_char">,</span><span class="hl_registr">eax</span></li>        </ol>
    </div>
</div></div>
<br><br>ImageBase лучше брать из уже запущенного процесса чтоб на 7 проблем небыло.<br>после создания засуспенженного процесса прочитать EBX+8
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=330489&amp;user=5291&amp;forum_n=6&amp;topic=22142.html&amp;page=0&amp;anchor=8" class="addthx" data-post="330489"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]figgler[/b]','')">figgler</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 11.2 (новичок), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.5'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=8982">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 сентября 2013 15:48 <br><script type="text/javascript">QU('figgler','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=figgler" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22142.html&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
Благодарю, буду пробовать...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=330490&amp;user=8982&amp;forum_n=6&amp;topic=22142.html&amp;page=0&amp;anchor=9" class="addthx" data-post="330490"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]SergX[/b]','')">SergX</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 226.0 (наставник), 67thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.08'>Активность: 0.16<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=11974">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 сентября 2013 21:10 <br><script type="text/javascript">QU('SergX','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=SergX" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22142.html&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
может вместо sleep поствить хук на какой-нибудь api ?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=330505&amp;user=11974&amp;forum_n=6&amp;topic=22142.html&amp;page=0&amp;anchor=10" class="addthx" data-post="330505"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]figgler[/b]','')">figgler</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 11.2 (новичок), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.5'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=8982">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 сентября 2013 22:34 <br><script type="text/javascript">QU('figgler','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=figgler" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22142.html&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
<I>Vovan666 пишет:<br>ImageBase лучше брать из уже запущенного процесса чтоб на 7 проблем небыло.после создания засуспенженного процесса прочитать EBX+8 </I><br><br>Что то тут не то, после создания засуспенженного процесса в EBX - 0 и как ни крути, а прочитать не выходит...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=330512&amp;user=8982&amp;forum_n=6&amp;topic=22142.html&amp;page=0&amp;anchor=11" class="addthx" data-post="330512"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]Vovan666[/b]','')">Vovan666</a></b><br></div>
<img src="img/s8.gif" alt=""><br><span class=txtSm>Ранг: 617.3 (<b>!</b>), 677thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.06'>Активность: 0.54<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=5291">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 сентября 2013 22:43 <br><script type="text/javascript">QU('Vovan666','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vovan666" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22142.html&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
А должен быть указатель на PEB.<br>Надеюсь ты ResumeThread и прочие гадости перед получением GetThreadContext не делаешь?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=330513&amp;user=5291&amp;forum_n=6&amp;topic=22142.html&amp;page=0&amp;anchor=12" class="addthx" data-post="330513"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]figgler[/b]','')">figgler</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 11.2 (новичок), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.5'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=8982">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 сентября 2013 23:03 <br><script type="text/javascript">QU('figgler','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=figgler" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22142.html&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
<b>Vovan666</b> если я правильно понял, то порядок должен быть такой<br><br>CreateProcess<br>GetThreadContext<br>ebx+8 - BaseAddress
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=330516&amp;user=8982&amp;forum_n=6&amp;topic=22142.html&amp;page=0&amp;anchor=13" class="addthx" data-post="330516"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]Vovan666[/b]','')">Vovan666</a></b><br></div>
<img src="img/s8.gif" alt=""><br><span class=txtSm>Ранг: 617.3 (<b>!</b>), 677thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.06'>Активность: 0.54<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=5291">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 сентября 2013 23:07 <br><script type="text/javascript">QU('Vovan666','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vovan666" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22142.html&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
если я правильно понял, то нет.<br>CreateProcess<br>GetThreadContext<br>mov eax,threadcontext.regEbx<br>add eax,8<br>ReadProcessMemory (eax - lpBaseAddress)
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=330517&amp;user=5291&amp;forum_n=6&amp;topic=22142.html&amp;page=0&amp;anchor=14" class="addthx" data-post="330517"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]figgler[/b]','')">figgler</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 11.2 (новичок), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.5'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=8982">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 сентября 2013 23:10 <br><script type="text/javascript">QU('figgler','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=figgler" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22142.html&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
Ok, спасибо... буду копать дальше..
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=330519&amp;user=8982&amp;forum_n=6&amp;topic=22142.html&amp;page=0&amp;anchor=15" class="addthx" data-post="330519"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]Dr0p[/b]','')">Dr0p</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33727.png" alt=""><br><span class=txtSm>Ранг: 72.3 (постоянный), 133thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.5'>Активность: 0.38<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33727">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 08 сентября 2013 02:06 <br><script type="text/javascript">QU('Dr0p','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Dr0p" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22142.html&amp;page=0#16');return false;">#16</a> </span><div align=left><br>
Извращенья.<br><br>Быть может заинфектить свой кодес и не париться ?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=330538&amp;user=33727&amp;forum_n=6&amp;topic=22142.html&amp;page=0&amp;anchor=16" class="addthx" data-post="330538"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]figgler[/b]','')">figgler</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 11.2 (новичок), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.5'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=8982">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 сентября 2013 11:56 &middot; Поправил: figgler <br><script type="text/javascript">QU('figgler','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=figgler" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22142.html&amp;page=0#17');return false;">#17</a> </span><div align=left><br>
<b>Vovan666</b> еще вопрос, пож-ста, по предложенному алгоритму, если не сложно - где я в коде допустил ошибку?<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>invoke</b></span>&nbsp;CreateProcessA<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>ADDR</b></span>&nbsp;exeName<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">FALSE</span><span class="hl_char">,</span>&nbsp;CREATE_SUSPENDED<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>ADDR</b></span>&nbsp;StartupInfo<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>ADDR</b></span>&nbsp;ProcessInfo</li><li class="hl_l1"><span class="hl_function"><b>invoke</b></span>&nbsp;GetThreadContext<span class="hl_char">,</span>ProcessInfo<span class="hl_char">.</span>hThread<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;threadcontext</li><li class="hl_l0"><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>threadcontext<span class="hl_char">.</span>regEbx</li><li class="hl_l1"><span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_number">8</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>invoke</b></span>&nbsp;ReadProcessMemory<span class="hl_char">,</span>&nbsp;ProcessInfo<span class="hl_char">.</span>hProcess<span class="hl_char">,</span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>ADDR</b></span>&nbsp;szBuff<span class="hl_char">,</span>&nbsp;<span class="hl_number">4</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span></li>        </ol>
    </div>
</div></div>
<br><br>На выходе szBuff должен содержать базовый адрес запущеного процесса, но там 0 (если читать память как в приведенном коде)<br><br>Просто заинтересовал способ быстрого получения базового адреса.<br><br>А так подошел способ с <br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>invoke</b></span>&nbsp;WaitForInputIdle<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span>ProcessInfo<span class="hl_char">.</span>hProcess<span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span></li><li class="hl_l1"><span class="hl_function"><b>invoke</b></span>&nbsp;SuspendThread<span class="hl_char">,</span>&nbsp;ProcessInfo<span class="hl_char">.</span>hThread</li>        </ol>
    </div>
</div></div>
<br>теперь все нормально...<br><br>Спасибо.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=330582&amp;user=8982&amp;forum_n=6&amp;topic=22142.html&amp;page=0&amp;anchor=17" class="addthx" data-post="330582"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]Vovan666[/b]','')">Vovan666</a></b><br></div>
<img src="img/s8.gif" alt=""><br><span class=txtSm>Ранг: 617.3 (<b>!</b>), 677thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.06'>Активность: 0.54<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=5291">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 сентября 2013 12:30 <br><script type="text/javascript">QU('Vovan666','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vovan666" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22142.html&amp;page=0#18');return false;">#18</a> </span><div align=left><br><div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>mov</b></span>&nbsp;threadcontext<span class="hl_char">.</span>ContextFlags<span class="hl_char">,</span>CONTEXT_FULL</li><li class="hl_l1"><span class="hl_function"><b>invoke</b></span>&nbsp;GetThreadContext<span class="hl_char">,</span>ProcessInfo<span class="hl_char">.</span>hThread<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;threadcontext</li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=330585&amp;user=5291&amp;forum_n=6&amp;topic=22142.html&amp;page=0&amp;anchor=18" class="addthx" data-post="330585"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]figgler[/b]','')">figgler</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 11.2 (новичок), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.5'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=8982">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 сентября 2013 12:33 <br><script type="text/javascript">QU('figgler','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=figgler" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22142.html&amp;page=0#19');return false;">#19</a> </span><div align=left><br>
Это
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_char">:</span><span class="hl_function"><b>mov</b></span>&nbsp;threadcontext<span class="hl_char">.</span>ContextFlags<span class="hl_char">,</span>CONTEXT_FULL</li>        </ol>
    </div>
</div></div>
 есть в коде раньше, на этапе <br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_char">.</span><span class="hl_function"><b>IF</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">=</span><span class="hl_char">=</span>WM_CREATE</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;&nbsp;SetTimer<span class="hl_char">,</span>&nbsp;hWnd<span class="hl_char">,</span>&nbsp;MAINTIMERID<span class="hl_char">,</span>&nbsp;<span class="hl_number">20</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;RtlZeroMemory<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;threadcontext<span class="hl_char">,</span><span class="hl_function"><b>sizeof</b></span>&nbsp;threadcontext</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;threadcontext<span class="hl_char">.</span>ContextFlags<span class="hl_char">,</span>CONTEXT_FULL</li>        </ol>
    </div>
</div></div>
<br><br>а таймер уже запускает создание процесса...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=330587&amp;user=8982&amp;forum_n=6&amp;topic=22142.html&amp;page=0&amp;anchor=19" class="addthx" data-post="330587"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="20" onfocus="this.blur()" href="JavaScript:di('[b]Vovan666[/b]','')">Vovan666</a></b><br></div>
<img src="img/s8.gif" alt=""><br><span class=txtSm>Ранг: 617.3 (<b>!</b>), 677thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.06'>Активность: 0.54<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=5291">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 сентября 2013 13:10 <br><script type="text/javascript">QU('Vovan666','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vovan666" target="_blank">Личное сообщение</a> &middot;  <a href="#20" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22142.html&amp;page=0#20');return false;">#20</a> </span><div align=left><br>
Запусти &quot;жертву&quot; в ольке поставив в настройках System breakpoint, это аналог CREATE_SUSPENDED, и посмотри равен ли EBX там и после GetThreadContext.<br>Либо скинь в пм свои исходники и жертву, посмотрю где косячишь.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=330590&amp;user=5291&amp;forum_n=6&amp;topic=22142.html&amp;page=0&amp;anchor=20" class="addthx" data-post="330590"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="21" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 сентября 2013 14:32 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#21" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22142.html&amp;page=0#21');return false;">#21</a> </span><div align=left><br>
System breakpoint-это не CREATE_SUSPENDED. Это первый бряк отладчика. И он далеко не равен изначальному CREATE_SUSPENDED.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=330595&amp;user=1556&amp;forum_n=6&amp;topic=22142.html&amp;page=0&amp;anchor=21" class="addthx" data-post="330595"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="22" onfocus="this.blur()" href="JavaScript:di('[b]figgler[/b]','')">figgler</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 11.2 (новичок), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.5'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=8982">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 сентября 2013 11:01 <br><script type="text/javascript">QU('figgler','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=figgler" target="_blank">Личное сообщение</a> &middot;  <a href="#22" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22142.html&amp;page=0#22');return false;">#22</a> </span><div align=left><br>
<b>Vovan666</b> спасибо за помощь...<br><br>почистил код для проверки этого способа (убрал вообще все лишнее) - действительно работает...<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">start<span class="hl_char">:</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;CreateProcessA<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>ADDR</b></span>&nbsp;exeName<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">FALSE</span><span class="hl_char">,</span>&nbsp;CREATE_SUSPENDED<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>ADDR</b></span>&nbsp;StartupInfo<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>ADDR</b></span>&nbsp;ProcessInfo</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>IF</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">!</span><span class="hl_char">=</span><span class="hl_number">0</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;threadcontext<span class="hl_char">.</span>ContextFlags<span class="hl_char">,</span>CONTEXT_FULL</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;GetThreadContext<span class="hl_char">,</span>ProcessInfo<span class="hl_char">.</span>hThread<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;threadcontext</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>threadcontext<span class="hl_char">.</span>regEbx</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_number">8</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;ReadProcessMemory<span class="hl_char">,</span>&nbsp;ProcessInfo<span class="hl_char">.</span>hProcess<span class="hl_char">,</span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>ADDR</b></span>&nbsp;szBuff<span class="hl_char">,</span>&nbsp;<span class="hl_number">4</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>offset</b></span>&nbsp;<span class="hl_char">[</span>szBuff<span class="hl_char">]</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">ebx</span><span class="hl_char">]</span>&nbsp;<span class="hl_comment">;//base addr here</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;TerminateProcess<span class="hl_char">,</span>&nbsp;ProcessInfo<span class="hl_char">.</span>hProcess<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">ENDIF</span></li><li class="hl_l1">exit<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ExitProcess<span class="hl_char">,</span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0"><span class="hl_function"><b>end</b></span>&nbsp;start</li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=330645&amp;user=8982&amp;forum_n=6&amp;topic=22142.html&amp;page=0&amp;anchor=22" class="addthx" data-post="330645"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="23" onfocus="this.blur()" href="JavaScript:di('[b]DillerInc[/b]','')">DillerInc</a></b><br></div>
<img src="img/s6.gif" alt=""><br><img style="padding-top:3px;" src="av/1613.gif" alt=""><br><span class=txtSm>Ранг: 283.6 (наставник), 56thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.25'>Активность: 0.13<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1613">Участник</a><br><font color=blue>Author of GeTaOEP</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 сентября 2013 18:46 <br><script type="text/javascript">QU('DillerInc','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DillerInc" target="_blank">Личное сообщение</a> &middot;  <a href="#23" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22142.html&amp;page=0#23');return false;">#23</a> </span><div align=left><br>
<b>figgler</b>, у тебя поди szBuff глобальная, нет?
<br><br><font size="1"><i>-----<br>the Power of Reversing team</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=330662&amp;user=1613&amp;forum_n=6&amp;topic=22142.html&amp;page=0&amp;anchor=23" class="addthx" data-post="330662"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="24" onfocus="this.blur()" href="JavaScript:di('[b]figgler[/b]','')">figgler</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 11.2 (новичок), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.5'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=8982">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 сентября 2013 22:39 <br><script type="text/javascript">QU('figgler','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=figgler" target="_blank">Личное сообщение</a> &middot;  <a href="#24" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22142.html&amp;page=0#24');return false;">#24</a> </span><div align=left><br>
Да, и что ?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=330683&amp;user=8982&amp;forum_n=6&amp;topic=22142.html&amp;page=0&amp;anchor=24" class="addthx" data-post="330683"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="25" onfocus="this.blur()" href="JavaScript:di('[b]DillerInc[/b]','')">DillerInc</a></b><br></div>
<img src="img/s6.gif" alt=""><br><img style="padding-top:3px;" src="av/1613.gif" alt=""><br><span class=txtSm>Ранг: 283.6 (наставник), 56thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.25'>Активность: 0.13<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1613">Участник</a><br><font color=blue>Author of GeTaOEP</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 сентября 2013 00:02 <br><script type="text/javascript">QU('DillerInc','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DillerInc" target="_blank">Личное сообщение</a> &middot;  <a href="#25" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22142.html&amp;page=0#25');return false;">#25</a> </span><div align=left><br>
Сделай переменную szBuff локальной и посмотри, как у тебя отвалится вызов:<br>invoke ReadProcessMemory, ProcessInfo.hProcess, eax, ADDR szBuff, 4, 0
<br><br><font size="1"><i>-----<br>the Power of Reversing team</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=330689&amp;user=1613&amp;forum_n=6&amp;topic=22142.html&amp;page=0&amp;anchor=25" class="addthx" data-post="330689"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="26" onfocus="this.blur()" href="JavaScript:di('[b]figgler[/b]','')">figgler</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 11.2 (новичок), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.5'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=8982">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 сентября 2013 19:46 &middot; Поправил: figgler <br><script type="text/javascript">QU('figgler','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=figgler" target="_blank">Личное сообщение</a> &middot;  <a href="#26" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22142.html&amp;page=0#26');return false;">#26</a> </span><div align=left><br>
<b>DillerInc</b> Если речь о ошибке выдаваемой компилятором (с локальным буфером) то да - не компилирует..<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">testloader<span class="hl_char">.</span>asm<span class="hl_char">(</span><span class="hl_number">78</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">:</span>&nbsp;error&nbsp;A2133<span class="hl_char">:</span>&nbsp;register&nbsp;value&nbsp;overwritten&nbsp;by&nbsp;<span class="hl_function">INVOKE</span></li>        </ol>
    </div>
</div></div>
<br>В чем фишка?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=330763&amp;user=8982&amp;forum_n=6&amp;topic=22142.html&amp;page=0&amp;anchor=26" class="addthx" data-post="330763"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="27" onfocus="this.blur()" href="JavaScript:di('[b]hors[/b]','')">hors</a></b><br></div>
<img src="img/s5.gif" alt=""><br><img style="padding-top:3px;" src="av/31056.jpg" alt=""><br><span class=txtSm>Ранг: 136.0 (ветеран), 360thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 8.52'>Активность: 0.27<span style='color:red'>&searr;</span>0.14</span><br>Статус: <a href="action=userinfo&amp;user=31056">Участник</a><br><font color=blue>Qt Developer</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 сентября 2013 20:03 &middot; Поправил: hors <br><script type="text/javascript">QU('hors','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=hors" target="_blank">Личное сообщение</a> &middot;  <a href="#27" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22142.html&amp;page=0#27');return false;">#27</a> </span><div align=left><br>
<I>figgler пишет:<br>В чем фишка?  </I><br><br>ADDR в Invoke использует eax. Если используются локальные переменные.
<br><br><font size="1"><i>-----<br>http://ntinfo.biz</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=330766&amp;user=31056&amp;forum_n=6&amp;topic=22142.html&amp;page=0&amp;anchor=27" class="addthx" data-post="330766"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="28" onfocus="this.blur()" href="JavaScript:di('[b]DillerInc[/b]','')">DillerInc</a></b><br></div>
<img src="img/s6.gif" alt=""><br><img style="padding-top:3px;" src="av/1613.gif" alt=""><br><span class=txtSm>Ранг: 283.6 (наставник), 56thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.25'>Активность: 0.13<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1613">Участник</a><br><font color=blue>Author of GeTaOEP</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 сентября 2013 20:27 <br><script type="text/javascript">QU('DillerInc','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DillerInc" target="_blank">Личное сообщение</a> &middot;  <a href="#28" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22142.html&amp;page=0#28');return false;">#28</a> </span><div align=left><br>
<b>figgler</b>,<br><br># имеем #<br>ADDR my_var ; my_var локальная<br># получаем #<br>lea eax, my_var<br>push eax<br><br># имеем #<br>ADDR my_var ; my_var глобальная<br># получаем #<br>push offset my_var ; актуально для x86<br><br>У тебя один из параметров передаётся через eax, который затрётся предыдущим ADDR my_var, если my_var локальная.
<br><br><font size="1"><i>-----<br>the Power of Reversing team</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=330767&amp;user=1613&amp;forum_n=6&amp;topic=22142.html&amp;page=0&amp;anchor=28" class="addthx" data-post="330767"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="29" onfocus="this.blur()" href="JavaScript:di('[b]figgler[/b]','')">figgler</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 11.2 (новичок), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.5'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=8982">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 сентября 2013 20:36 <br><script type="text/javascript">QU('figgler','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=figgler" target="_blank">Личное сообщение</a> &middot;  <a href="#29" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22142.html&amp;page=0#29');return false;">#29</a> </span><div align=left><br>
Мда, ну что тут скажешь... учиться, учитья, учиться...<br><br>Всем спасибо за внимание и информацию...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=330768&amp;user=8982&amp;forum_n=6&amp;topic=22142.html&amp;page=0&amp;anchor=29" class="addthx" data-post="330768"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Вопрос по лоадеру</span></td>
</tr></table>
</div>
<a name=newreply></a>
<div align=center>
<table class=forums>
<tr>
<td class=caption4 width="100%"><span class=header>Эта тема закрыта. Ответы больше не принимаются.</span></td>
</tr>
</table>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=22142" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
