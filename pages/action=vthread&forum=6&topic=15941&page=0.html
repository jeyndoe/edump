<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>CreateRemoteThread - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Всем доброго времени суток! У меня такая проблема пишу инжектор который подгружает длл с помощью функции CreateRemoteThread, но программа использует длл в точке входа которой исполняется код. А моя точка входа в моей длл стартует">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=55995'>tyns777</a>, <a target='_blank' href='?action=userinfo&amp;user=31361'>zds</a>, <a target='_blank' href='?action=userinfo&amp;user=55802'>JustLife</a> (+4 невидимых)</b></span>
</td>
</tr>
</table>

 

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> CreateRemoteThread</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]Neo32[/b]','')">Neo32</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 19.9 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.93'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=17703">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 марта 2010 22:16 <br><script type="text/javascript">QU('Neo32','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Neo32" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15941.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Всем доброго времени суток!<br>У меня такая проблема пишу инжектор который подгружает длл с помощью функции CreateRemoteThread, но программа использует длл в точке входа которой исполняется код. А моя точка входа в моей длл стартует уже после ее вызова. Как исполнить код в другом процессе чтобы он стартовал раньне него?<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>invoke</b></span>&nbsp;&nbsp;&nbsp;CreateProcess<span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">,</span><span class="hl_char">[</span>szFileName<span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">,</span><span class="hl_function">FALSE</span><span class="hl_char">,</span><span class="hl_char">\</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CREATE_SUSPENDED<span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">,</span><span class="hl_char">[</span>lpStartInfo<span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_char">[</span>lpProcessInfo<span class="hl_char">]</span></li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="hl_l1"><span class="hl_comment">;	вставляем патч</span></li><li class="hl_l0"><span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span><span class="hl_char">[</span>lpProcessInfo<span class="hl_char">]</span></li><li class="hl_l1"><span class="hl_function"><b>assume</b></span>&nbsp;&nbsp;&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">:</span>PROCESS_INFORMATION</li><li class="hl_l0"><span class="hl_function"><b>invoke</b></span>&nbsp;&nbsp;&nbsp;VirtualAllocEx<span class="hl_char">,</span><span class="hl_char">[</span><span class="hl_registr">ecx</span><span class="hl_char">.</span>hProcess<span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span>sizeinjector<span class="hl_char">,</span><span class="hl_char">$</span><span class="hl_number">1000</span><span class="hl_char">,</span><span class="hl_char">$</span><span class="hl_number">4</span></li><li class="hl_l1"><span class="hl_function"><b>push</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l0"><span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span><span class="hl_char">[</span>lpProcessInfo<span class="hl_char">]</span></li><li class="hl_l1"><span class="hl_function"><b>invoke</b></span>&nbsp;&nbsp;&nbsp;PatchProcessEx<span class="hl_char">,</span><span class="hl_char">[</span><span class="hl_registr">ecx</span><span class="hl_char">.</span>hProcess<span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_registr">eax</span><span class="hl_char">,</span>sizeinjector<span class="hl_char">,</span><span class="hl_char">[</span>Injector<span class="hl_char">]</span></li><li class="hl_l0"><span class="hl_function"><b>pop</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1"><span class="hl_function"><b>lea</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span><span class="hl_char">[</span>lpThreadId<span class="hl_char">]</span></li><li class="hl_l0"><span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span><span class="hl_char">[</span>lpProcessInfo<span class="hl_char">]</span></li><li class="hl_l1"><span class="hl_function"><b>invoke</b></span>&nbsp;&nbsp;&nbsp;CreateRemoteThread<span class="hl_char">,</span><span class="hl_char">[</span><span class="hl_registr">ecx</span><span class="hl_char">.</span>hProcess<span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span><span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_number">1</span><span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span><span class="hl_registr">ebx</span></li><li class="hl_l0"><span class="hl_function"><b>invoke</b></span>&nbsp;&nbsp;&nbsp;WaitForSingleObject<span class="hl_char">,</span><span class="hl_registr">eax</span><span class="hl_char">,</span>INFINITE</li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_comment">; main inject code, is copy and run in injected process</span></li><li class="hl_l1"><span class="hl_function"><b>proc</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_Injector&nbsp;<span class="hl_function"><b>uses</b></span>&nbsp;<span class="hl_registr"><b>ebx</b></span>&nbsp;<span class="hl_registr"><b>ecx</b></span>&nbsp;<span class="hl_registr"><b>edx</b></span>&nbsp;<span class="hl_registr"><b>esi</b></span>&nbsp;<span class="hl_registr"><b>edi</b></span>&nbsp;<span class="hl_char">,</span>istest</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">int3</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">ret</span></li><li class="hl_l0"><span class="hl_function">endp</span></li><li class="hl_l1">sizeinjector<span class="hl_char">=</span><span class="hl_char">$</span><span class="hl_char">-</span>Injector</li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=253506&amp;user=17703&amp;forum_n=6&amp;topic=15941.html&amp;page=0&amp;anchor=1" class="addthx" data-post="253506"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]HiEndsoft[/b]','')">HiEndsoft</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 237.0 (наставник), 20thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.74'>Активность: 0.13<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=13651">Участник</a><br><font color=blue>sysenter</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 марта 2010 22:38 &middot; Поправил: HiEndsoft <br><script type="text/javascript">QU('HiEndsoft','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=HiEndsoft" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15941.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
флаг CREATE_SUSPENDED - ничего не значит, т.к. загрузчик заранее подгружает все либы к процессу и лишь замораживает осн поток. Проблема может быть как мне кажется решена только в нативе или на уровне дрова.
<br><br><font size="1"><i>-----<br>продавец резиновых утёнков</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=253508&amp;user=13651&amp;forum_n=6&amp;topic=15941.html&amp;page=0&amp;anchor=2" class="addthx" data-post="253508"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 марта 2010 22:41 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15941.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
Ты не прав. К моменту окончания загрузки только основные либы загружены (нтдлл, кернел). Основные либы грузятся после создания ремотпроцесса.<br>Видимо, связано с очередью сообщений, но могу и ошибаться.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=253509&amp;user=1556&amp;forum_n=6&amp;topic=15941.html&amp;page=0&amp;anchor=3" class="addthx" data-post="253509"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]vptrlx[/b]','')">vptrlx</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 56.1 (постоянный), 9thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.91'>Активность: 0.04<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=22056">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 марта 2010 22:42 &middot; Поправил: vptrlx <br><script type="text/javascript">QU('vptrlx','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=vptrlx" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15941.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
если действительно<br><i class=x>флаг CREATE_SUSPENDED - ничего не значит</i><br>то загружать файл вручную / инжектиться в лоадер / если есть возможность просто временно убрать из файла iat, а потом вручную подгрузить только импорт
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=253510&amp;user=22056&amp;forum_n=6&amp;topic=15941.html&amp;page=0&amp;anchor=4" class="addthx" data-post="253510"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]HiEndsoft[/b]','')">HiEndsoft</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 237.0 (наставник), 20thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.74'>Активность: 0.13<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=13651">Участник</a><br><font color=blue>sysenter</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 марта 2010 22:45 &middot; Поправил: HiEndsoft <br><script type="text/javascript">QU('HiEndsoft','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=HiEndsoft" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15941.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
<b>Archer</b><br>бывает, после праздников<img src="img/smilies/s14.gif" alt=""><br>тогда наверное вопрос неясно задан/понят, т.к. такого быть не должно.<br>Очевидно это только случай статический.<br>Единственный (безгеморный) вариант - использовать свой или один из готовых исходников лоадеров, весь гемор будет с совместимостью.
<br><br><font size="1"><i>-----<br>продавец резиновых утёнков</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=253511&amp;user=13651&amp;forum_n=6&amp;topic=15941.html&amp;page=0&amp;anchor=5" class="addthx" data-post="253511"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]DillerInc[/b]','')">DillerInc</a></b><br></div>
<img src="img/s6.gif" alt=""><br><img style="padding-top:3px;" src="av/1613.gif" alt=""><br><span class=txtSm>Ранг: 283.6 (наставник), 56thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.25'>Активность: 0.13<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1613">Участник</a><br><font color=blue>Author of GeTaOEP</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 09 марта 2010 23:00 &middot; Поправил: DillerInc <br><script type="text/javascript">QU('DillerInc','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DillerInc" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15941.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
У меня тоже есть такая проблема.Например,в GeTaOEP - либы, защищённые каким-нибудь протом ловятся обычно без проблем, а простые(незащищённые) - проскакивают мимо, т.е. они подгружаются быстрее, чем мой удалённый поток получит управление.И решения в usermode похоже нет(разве только использовать loader для либы).
<br><br><font size="1"><i>-----<br>the Power of Reversing team</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=253512&amp;user=1613&amp;forum_n=6&amp;topic=15941.html&amp;page=0&amp;anchor=6" class="addthx" data-post="253512"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]Clerk[/b]','')">Clerk</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 255.8 (наставник), 19thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.86'>Активность: 0.15<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=17964">Участник</a><br><font color=blue>vx</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 марта 2010 00:12 <br><script type="text/javascript">QU('Clerk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Clerk" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15941.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
<b>DillerInc</b><br>Нет возможности изменить стартупапк, но можно перенаправить её на диспетчер исключений взведя TF. Это единственное эффективное решение.<br><b>Neo32</b><br>Не понятно что вам нужно.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=253519&amp;user=17964&amp;forum_n=6&amp;topic=15941.html&amp;page=0&amp;anchor=7" class="addthx" data-post="253519"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]mak[/b]','')">mak</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3520.jpg" alt=""><br><span class=txtSm>Ранг: 673.3 <font color=magenta>(<b>! !</b>)</font>, 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.48'>Активность: 0.4<span style='color:red'>&searr;</span>0.31</span><br>Статус: <a href="action=userinfo&amp;user=3520">Участник</a><br><font color=blue>CyberMonk</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 марта 2010 00:26 <br><script type="text/javascript">QU('mak','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=mak" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15941.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
<img src="img/smilies/s1.gif" alt=""> Имеется ввиду вот так ?<br><img src="http://www.codeproject.com/KB/threads/completeinject/completeinject2.png" border="0" align="" alt=""><br><br>Если да то вот тут все есть www.codeproject.com/KB/threads/completeinject.aspx
<br><br><font size="1"><i>-----<br>RE In Progress [!] Coding Hazard [!] Stay Clear of this Cube</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=253523&amp;user=3520&amp;forum_n=6&amp;topic=15941.html&amp;page=0&amp;anchor=8" class="addthx" data-post="253523"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]DillerInc[/b]','')">DillerInc</a></b><br></div>
<img src="img/s6.gif" alt=""><br><img style="padding-top:3px;" src="av/1613.gif" alt=""><br><span class=txtSm>Ранг: 283.6 (наставник), 56thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.25'>Активность: 0.13<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1613">Участник</a><br><font color=blue>Author of GeTaOEP</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 марта 2010 01:16 <br><script type="text/javascript">QU('DillerInc','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DillerInc" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15941.html&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
<b>Clerk</b>, правильно ли я понял, что это альтернатива удалённому потоку?Перехватываем диспетчер исключений,генерируем исключение SINGLE_STEP и в обработчике перехвата грузим свою либу.Так ли?
<br><br><font size="1"><i>-----<br>the Power of Reversing team</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=253527&amp;user=1613&amp;forum_n=6&amp;topic=15941.html&amp;page=0&amp;anchor=9" class="addthx" data-post="253527"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]Neo32[/b]','')">Neo32</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 19.9 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.93'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=17703">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 марта 2010 07:59 &middot; Поправил: Neo32 <br><script type="text/javascript">QU('Neo32','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Neo32" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15941.html&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
<b>Clerk</b><br>Не понятно что вам нужно.<br><br>ситуация такая же:<br>У меня тоже есть такая проблема.Например,в GeTaOEP - либы, защищённые каким-нибудь протом ловятся обычно без проблем, а простые(незащищённые) - проскакивают мимо, т.е. они подгружаются быстрее, чем мой удалённый поток получит управление.И решения в usermode похоже нет(разве только использовать loader для либы).<br><br>и тут еще проскакивал пост про отключение иат, думаю стоит попробовать... Создаешь процесс с CREATE_SUSPENDED , обнуляешь директорию импорта, запускаешь CreateRemoteThread,[ProcessInfo.hProcess],0,0,[LoadLibraryA],eax,0,ebx а потом возвращаешь директорию иат и вручную подгружаешь модули... возможно такое?<br><br>просто CreateRemoteThread подгружает все модули из иат после своего выполнения и причем моя либа отрабатывает не первой
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=253543&amp;user=17703&amp;forum_n=6&amp;topic=15941.html&amp;page=0&amp;anchor=10" class="addthx" data-post="253543"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]Clerk[/b]','')">Clerk</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 255.8 (наставник), 19thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.86'>Активность: 0.15<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=17964">Участник</a><br><font color=blue>vx</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 марта 2010 08:02 <br><script type="text/javascript">QU('Clerk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Clerk" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15941.html&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
<b>DillerInc</b><br>Я в блоге описывал это:<br>Запуск пользовательского потока в обход перехвата диспетчера APC(R3).<br> o Восстанавливаем RtlpCalloutEntryList, для исключения глобальных VEH.<br> o Создаём удалённый поток.<br> o Формируем SEH-фрейм.<br> o Взводим TF в контексте.<br>(Без закрытия списка RtlpCalloutEntryList, там не сложно):<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">SEH_FRAME&nbsp;struct</li><li class="hl_l1">pLink&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PVOID&nbsp;<span class="hl_char">?</span></li><li class="hl_l0">pSeh&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PVOID&nbsp;<span class="hl_char">?</span></li><li class="hl_l1">pSafe&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PVOID&nbsp;<span class="hl_char">?</span></li><li class="hl_l0">rEbp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PVOID&nbsp;<span class="hl_char">?</span></li><li class="hl_l1">SEH_FRAME&nbsp;<span class="hl_function">ends</span></li><li class="hl_l0">PSEH_FRAME&nbsp;typedef&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;SEH_FRAME</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">STACK_FRAME&nbsp;struct</li><li class="hl_l1">Seh&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SEH_FRAME&nbsp;<span class="hl_char">&lt;</span><span class="hl_char">&gt;</span></li><li class="hl_l0">pRet&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PVOID&nbsp;<span class="hl_char">?</span></li><li class="hl_l1"><span class="hl_function"><b>Data</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PVOID&nbsp;<span class="hl_char">?</span></li><li class="hl_l0">STACK_FRAME&nbsp;<span class="hl_function">ends</span></li><li class="hl_l1">PSTACK_FRAME&nbsp;typedef&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;STACK_FRAME</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">REMOTE_SEH&nbsp;<span class="hl_function">macro</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>assume</b></span>&nbsp;<span class="hl_registr">fs</span><span class="hl_char">:</span><span class="hl_function">nothing</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">esp</span><span class="hl_char">,</span><span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr"><b>esp</b></span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_number">2</span><span class="hl_char">*</span><span class="hl_number">4</span><span class="hl_char">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">; ExceptionList.</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">fs</span><span class="hl_char">:</span><span class="hl_char">[</span>TEB<span class="hl_char">.</span>Tib<span class="hl_char">.</span>ExceptionList<span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_function">NULL</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;STACK_FRAME<span class="hl_char">.</span>Seh<span class="hl_char">.</span>pSafe<span class="hl_char">[</span><span class="hl_registr">esp</span><span class="hl_char">]</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>xor</b></span>&nbsp;<span class="hl_registr">ebp</span><span class="hl_char">,</span><span class="hl_registr">ebp</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>ret</b></span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>SEH_FRAME<span class="hl_char">)</span></li><li class="hl_l0"><span class="hl_function">endm</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">SEH4&nbsp;<span class="hl_function"><b>proc</b></span>&nbsp;C</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REMOTE_SEH</li><li class="hl_l0">SEH4&nbsp;<span class="hl_function">endp</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_char">.</span><span class="hl_function">code</span></li><li class="hl_l1">CreateHiddenThread&nbsp;<span class="hl_function"><b>proc</b></span>&nbsp;ProcessHandle<span class="hl_char">:</span>HANDLE<span class="hl_char">,</span>&nbsp;ExceptionHandler<span class="hl_char">:</span>PVOID<span class="hl_char">,</span>&nbsp;StartupRoutine<span class="hl_char">:</span>PVOID<span class="hl_char">,</span>&nbsp;StartupParameter<span class="hl_char">:</span>PVOID</li><li class="hl_l0"><span class="hl_function"><b>Local</b></span>&nbsp;Buffer<span class="hl_char">:</span>STACK_FRAME</li><li class="hl_l1"><span class="hl_function"><b>Local</b></span>&nbsp;ThreadInformation<span class="hl_char">:</span>THREAD_BASIC_INFORMATION</li><li class="hl_l0"><span class="hl_function"><b>Local</b></span>&nbsp;ThreadHandle<span class="hl_char">:</span>HANDLE<span class="hl_char">,</span>&nbsp;ClientId<span class="hl_char">:</span>CLIENT_ID</li><li class="hl_l1"><span class="hl_function"><b>Local</b></span>&nbsp;Context<span class="hl_char">:</span>CONTEXT</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;RtlCreateUserThread<span class="hl_char">,</span>&nbsp;ProcessHandle<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">TRUE</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;PAGE_SIZE<span class="hl_char">*</span><span class="hl_number">2</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;ThreadHandle<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;ClientId</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>test</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jnz</b></span>&nbsp;Exit</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;ZwQueryInformationThread<span class="hl_char">,</span>&nbsp;ThreadHandle<span class="hl_char">,</span>&nbsp;ThreadBasicInformation<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;ThreadInformation<span class="hl_char">,</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>THREAD_BASIC_INFORMATION<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>test</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;Context<span class="hl_char">.</span>ContextFlags<span class="hl_char">,</span>CONTEXT_CONTROL</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jnz</b></span>&nbsp;Kill</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;ZwGetContextThread<span class="hl_char">,</span>&nbsp;ThreadHandle<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;Context</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>test</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span>ExceptionHandler</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span>StartupRoutine</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jnz</b></span>&nbsp;Kill</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;Buffer<span class="hl_char">.</span>Seh<span class="hl_char">.</span>pLink<span class="hl_char">,</span><span class="hl_char">-</span><span class="hl_number">1</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>sub</b></span>&nbsp;Context<span class="hl_char">.</span>regEsp<span class="hl_char">,</span><span class="hl_function">sizeof</span><span class="hl_char">(</span>SEH_FRAME<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;Buffer<span class="hl_char">.</span>Seh<span class="hl_char">.</span>pSeh<span class="hl_char">,</span><span class="hl_registr">ecx</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;Buffer<span class="hl_char">.</span>Seh<span class="hl_char">.</span>pSafe<span class="hl_char">,</span><span class="hl_registr">edx</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span>StartupParameter</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;Buffer<span class="hl_char">.</span>Seh<span class="hl_char">.</span>rEbp<span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;Buffer<span class="hl_char">.</span>pRet<span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;Buffer<span class="hl_char">.</span><span class="hl_function">Data</span><span class="hl_char">,</span><span class="hl_registr">ecx</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;ZwWriteVirtualMemory<span class="hl_char">,</span>&nbsp;ProcessHandle<span class="hl_char">,</span>&nbsp;ThreadInformation<span class="hl_char">.</span>TebBaseAddress<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;Context<span class="hl_char">.</span>regEsp<span class="hl_char">,</span>&nbsp;<span class="hl_number">4</span><span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>NULL</b></span>&nbsp;<span class="hl_comment">; TEB.Tib.ExceptionList</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>test</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jnz</b></span>&nbsp;Kill</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;ZwWriteVirtualMemory<span class="hl_char">,</span>&nbsp;ProcessHandle<span class="hl_char">,</span>&nbsp;Context<span class="hl_char">.</span>regEsp<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;Buffer<span class="hl_char">,</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>STACK_FRAME<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>test</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jnz</b></span>&nbsp;Kill</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>or</b></span>&nbsp;Context<span class="hl_char">.</span>regEFlags<span class="hl_char">,</span>EFLAGS_TF</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;ZwSetContextThread<span class="hl_char">,</span>&nbsp;ThreadHandle<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>addr</b></span>&nbsp;Context</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>test</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jnz</b></span>&nbsp;Kill</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;ZwResumeThread<span class="hl_char">,</span>&nbsp;ThreadHandle<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>test</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jz</b></span>&nbsp;Exit</li><li class="hl_l1">Kill<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;ZwTerminateThread<span class="hl_char">,</span>&nbsp;ThreadHandle<span class="hl_char">,</span>&nbsp;<span class="hl_registr">Eax</span></li><li class="hl_l0"><span class="hl_comment">;	invoke RtlFreeUserThreadStack, ProcessHandle, ThreadHandle	; or TEB.FreeStackOnTermination</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l0">Exit<span class="hl_char">:</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">ret</span></li><li class="hl_l0">CreateHiddenThread&nbsp;<span class="hl_function">endp</span></li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=253544&amp;user=17964&amp;forum_n=6&amp;topic=15941.html&amp;page=0&amp;anchor=11" class="addthx" data-post="253544"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]Clerk[/b]','')">Clerk</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 255.8 (наставник), 19thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.86'>Активность: 0.15<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=17964">Участник</a><br><font color=blue>vx</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 марта 2010 08:05 <br><script type="text/javascript">QU('Clerk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Clerk" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15941.html&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
<b>Neo32</b><br>До перехода потока на пользовательский код он вызывает загрузчик для нотификации модулей, которая последовательно выполняется для модулей из базы данных. Опишите нормально задачу.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=253545&amp;user=17964&amp;forum_n=6&amp;topic=15941.html&amp;page=0&amp;anchor=12" class="addthx" data-post="253545"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]Neo32[/b]','')">Neo32</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 19.9 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.93'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=17703">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 марта 2010 08:19 &middot; Поправил: Neo32 <br><script type="text/javascript">QU('Neo32','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Neo32" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15941.html&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
<b>Clerk</b><br>Опишите нормально задачу.<br><br>До перехода потока на пользовательский код он вызывает загрузчик для нотификации модулей, которая последовательно выполняется для модулей из базы данных, так вот точка входа в моей длл которую я внедряю срабатывает уже после исполнения точек входа в остальных длл, а мне надо чтоб сработала раньше них.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=253546&amp;user=17703&amp;forum_n=6&amp;topic=15941.html&amp;page=0&amp;anchor=13" class="addthx" data-post="253546"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]Clerk[/b]','')">Clerk</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 255.8 (наставник), 19thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.86'>Активность: 0.15<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=17964">Участник</a><br><font color=blue>vx</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 марта 2010 08:30 <br><script type="text/javascript">QU('Clerk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Clerk" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15941.html&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
<b>Neo32</b><br>Повторяю, они вызываются при создании потока, есчо до того как он на ваш код выполнять начнёт.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=253547&amp;user=17964&amp;forum_n=6&amp;topic=15941.html&amp;page=0&amp;anchor=14" class="addthx" data-post="253547"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]Neo32[/b]','')">Neo32</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 19.9 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.93'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=17703">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 марта 2010 08:33 <br><script type="text/javascript">QU('Neo32','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Neo32" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15941.html&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
<b>Clerk</b> тогда как исполнить его раньше?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=253548&amp;user=17703&amp;forum_n=6&amp;topic=15941.html&amp;page=0&amp;anchor=15" class="addthx" data-post="253548"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]__[/b]','')">__</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 115.1 (ветеран), 3thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.73'>Активность: 0.07<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=7172">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 марта 2010 09:23 &middot; Поправил: __ <br><script type="text/javascript">QU('__','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=__" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15941.html&amp;page=0#16');return false;">#16</a> </span><div align=left><br>
<I>DillerInc пишет:<br>И решения в usermode похоже нет(разве только использовать loader для либы). </I><br><br>для XP+ можно попробовать Debug loader, в котором сначала отловить все длл(через отладочные сообщения) и потом<br>пустить процесс на волю.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=253554&amp;user=7172&amp;forum_n=6&amp;topic=15941.html&amp;page=0&amp;anchor=16" class="addthx" data-post="253554"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]Twister[/b]','')">Twister</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 11.1 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.42'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3736">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 марта 2010 09:58 &middot; Поправил: Twister <br><script type="text/javascript">QU('Twister','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Twister" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15941.html&amp;page=0#17');return false;">#17</a> </span><div align=left><br>
<b>Neo32</b><br>Ну если у тебя есть доступ к памяти целевого процесса, то что мешает сделать следующее (я так понимаю тебе необходимо просто скрыть свое присутствие):<br><br>1. Заморозить все потоки процесса.<br>2. Пробежаться по EP всех библиотек загруженных в него и изменить начальные байты так, чтобы эти DllEntry просто возвращали управление, ничего при этом не делая.<br>3. Провести инжект и запуск потока.<br>4. Восстановить оригинальные байты во всех DllMain.<br>5. Запустить ранее замороженные потоки.<br><br>?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=253556&amp;user=3736&amp;forum_n=6&amp;topic=15941.html&amp;page=0&amp;anchor=17" class="addthx" data-post="253556"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]Neo32[/b]','')">Neo32</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 19.9 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.93'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=17703">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 марта 2010 11:24 &middot; Поправил: Neo32 <br><script type="text/javascript">QU('Neo32','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Neo32" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15941.html&amp;page=0#18');return false;">#18</a> </span><div align=left><br>
<b>Twister</b> (я так понимаю тебе необходимо просто скрыть свое присутствие):<br>нет мне не надо скрывать надо запустить раньше любого кода который может выполнить процесс свой код<br><b>Twister</b> 2. Пробежаться по EP всех библиотек загруженных в него и изменить начальные байты так, чтобы эти DllEntry просто возвращали управление, ничего при этом не делая.<br>они обязательно должны свое дело делать <img src="img/smilies/s1.gif" alt=""><br><br>вообщем то я решил сделать так:<br>1. пропатчить директорию импорта,<br>2. запустить процесс с флагом CREATE_SUSPENDED<br>3. внедрить длл,<br>4. в своем коде забить таблицу импорта, подгружая длл что бы у них отработали точки входа<br>5. запустить процесс
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=253566&amp;user=17703&amp;forum_n=6&amp;topic=15941.html&amp;page=0&amp;anchor=18" class="addthx" data-post="253566"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]HiEndsoft[/b]','')">HiEndsoft</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 237.0 (наставник), 20thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.74'>Активность: 0.13<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=13651">Участник</a><br><font color=blue>sysenter</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 марта 2010 11:44 &middot; Поправил: HiEndsoft <br><script type="text/javascript">QU('HiEndsoft','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=HiEndsoft" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15941.html&amp;page=0#19');return false;">#19</a> </span><div align=left><br>
<I>Twister</I><br>Смысла в предложенном вами алгоритме нет абсолютно. Зачем патчить EP если они уже выполнены, т.к. в п 1. вы предлагаете заморозить рабочие потоки (они создаются уже после подгрузки либ и выполнения загрузчиком винды всех своих ф-ций).<br><b>Neo32</b><br>Как вариант ничего, но патчить файло - не универсальный вариант (хотя процесс можно запустить из промапленного). Надо подождать Clerk&#039;a что-то он не досказал кажись
<br><br><font size="1"><i>-----<br>продавец резиновых утёнков</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=253568&amp;user=13651&amp;forum_n=6&amp;topic=15941.html&amp;page=0&amp;anchor=19" class="addthx" data-post="253568"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="20" onfocus="this.blur()" href="JavaScript:di('[b]Twister[/b]','')">Twister</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 11.1 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.42'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3736">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 марта 2010 11:51 &middot; Поправил: Twister <br><script type="text/javascript">QU('Twister','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Twister" target="_blank">Личное сообщение</a> &middot;  <a href="#20" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15941.html&amp;page=0#20');return false;">#20</a> </span><div align=left><br>
&gt;&gt; Смысла в предложенном вами алгоритме нет абсолютно. Зачем патчить EP если они уже выполнены<br><br>DllMain == EP. Я предложил их пропатчить для того, чтобы библиотека не была уведомлена об аттаче трида. Впрочем, раз автору не скрыться надо, а именно выполниться раньше, то способ, конечно, не поможет. А триды заморозить на всякий, для пущей надежности.<br><br>По теме: Вы бы описали конкретную задачу, а не предполагаемый вариант решения. Возможно найдутся другие варианты.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=253569&amp;user=3736&amp;forum_n=6&amp;topic=15941.html&amp;page=0&amp;anchor=20" class="addthx" data-post="253569"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="21" onfocus="this.blur()" href="JavaScript:di('[b]Twister[/b]','')">Twister</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 11.1 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.42'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3736">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 марта 2010 12:09 &middot; Поправил: Twister <br><script type="text/javascript">QU('Twister','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Twister" target="_blank">Личное сообщение</a> &middot;  <a href="#21" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15941.html&amp;page=0#21');return false;">#21</a> </span><div align=left><br>
В принципе, можно вот еще какой вариант предложить:<br><br>Опять же, заморочимся с DllMain всех модулей (их вызов будет происходить в одном потоке), проставим в начале каждого какую-нибудь инструкцию, которая будет генерировать исключение. Дальше перехватим <b>KiUserExceptionDispatcher</b> и запустим наш поток. Начнется нотификация модулей, первый же модуль сгенерит ошибку, мы ее поймаем и &quot;узнаем&quot;. Тут и исполним необходимый нам код, где он будет лежать (в нашей DllMain или еще где) уже дело второе. Потом, конечно, все вернем на место. Я тут не учел VEH-обработчики, но это дело наживное.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=253572&amp;user=3736&amp;forum_n=6&amp;topic=15941.html&amp;page=0&amp;anchor=21" class="addthx" data-post="253572"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="22" onfocus="this.blur()" href="JavaScript:di('[b]mak[/b]','')">mak</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3520.jpg" alt=""><br><span class=txtSm>Ранг: 673.3 <font color=magenta>(<b>! !</b>)</font>, 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.48'>Активность: 0.4<span style='color:red'>&searr;</span>0.31</span><br>Статус: <a href="action=userinfo&amp;user=3520">Участник</a><br><font color=blue>CyberMonk</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 марта 2010 14:35 &middot; Поправил: mak <br><script type="text/javascript">QU('mak','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=mak" target="_blank">Личное сообщение</a> &middot;  <a href="#22" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15941.html&amp;page=0#22');return false;">#22</a> </span><div align=left><br>
<img src="img/smilies/s1.gif" alt=""> есть же готовое решение  <br><b>Let us stop for a moment and consider what we do to inject our DLL into a process in the first place.</b><br>По ссылке выше , то что вы и описали <img src="img/smilies/s11.gif" alt=""><br><br>ПС <b>Twister</b> это не вам <img src="img/smilies/s5.gif" alt=""> а нео
<br><br><font size="1"><i>-----<br>RE In Progress [!] Coding Hazard [!] Stay Clear of this Cube</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=253590&amp;user=3520&amp;forum_n=6&amp;topic=15941.html&amp;page=0&amp;anchor=22" class="addthx" data-post="253590"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="23" onfocus="this.blur()" href="JavaScript:di('[b]Twister[/b]','')">Twister</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 11.1 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.42'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=3736">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 марта 2010 15:06 <br><script type="text/javascript">QU('Twister','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Twister" target="_blank">Личное сообщение</a> &middot;  <a href="#23" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15941.html&amp;page=0#23');return false;">#23</a> </span><div align=left><br>
&gt;&gt; то что вы и описали <br>Эм... Признаюсь честно - по ссылке не ходил.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=253596&amp;user=3736&amp;forum_n=6&amp;topic=15941.html&amp;page=0&amp;anchor=23" class="addthx" data-post="253596"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="24" onfocus="this.blur()" href="JavaScript:di('[b]Clerk[/b]','')">Clerk</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 255.8 (наставник), 19thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.86'>Активность: 0.15<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=17964">Участник</a><br><font color=blue>vx</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 марта 2010 16:01 &middot; Поправил: Clerk <br><script type="text/javascript">QU('Clerk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Clerk" target="_blank">Личное сообщение</a> &middot;  <a href="#24" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15941.html&amp;page=0#24');return false;">#24</a> </span><div align=left><br>
<b>Neo32</b><br>&gt; тогда как исполнить его раньше? <br>Вы не можите выполнить код в модуле раньше чем он будет загружен, а это произойдёт когда поток перейдёт на ваш код. В этом случае нужен стаб.<br>&gt; Заморозить все потоки процесса.<br>Связка <b>NtSuspendProcess</b>/<b>NtResumeThread</b> не обязательна. К примеру ядро знает про критическую секцию <b>LdrpLoaderLock</b> и при завершении треда может её освобождать. Ничего не мешает сделать это удалённо, тогда потоки обратившиеся к загрузчику будут ждать особождения этой кс.<br>&gt; Опять же, заморочимся с DllMain всех модулей (их вызов будет происходить в одном потоке), проставим в начале каждого какую-нибудь инструкцию, которая будет генерировать исключение.<br>Брейк ставить не обязательно, это нужно если вы отладчик. Иначе достаточно манипуляции ссылками - сделать не валидными, что потребует обработки исключений(удалённо VEH поставить нельзя), либо замена ссылки на свой обработчик(выше - стаб).<br>Тут многие смежные вопросы рассмотрены <noindex><a href="http://indy-vx.narod.ru/log.txt" rel="nofollow" target="_blank">http://indy-vx.narod.ru/log.txt</a></noindex>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=253602&amp;user=17964&amp;forum_n=6&amp;topic=15941.html&amp;page=0&amp;anchor=24" class="addthx" data-post="253602"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="25" onfocus="this.blur()" href="JavaScript:di('[b]Neo32[/b]','')">Neo32</a></b><br></div>
<img src="img/s2.gif" alt=""><br><span class=txtSm>Ранг: 19.9 (новичок)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.93'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=17703">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 марта 2010 08:01 &middot; Поправил: Neo32 <br><script type="text/javascript">QU('Neo32','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Neo32" target="_blank">Личное сообщение</a> &middot;  <a href="#25" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=15941.html&amp;page=0#25');return false;">#25</a> </span><div align=left><br>
Всем спасибо за ответы! Думаю тема исчерпана, и ответов больше не будет. Закрываю. Буду обрабатывать  полученный материал
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=253647&amp;user=17703&amp;forum_n=6&amp;topic=15941.html&amp;page=0&amp;anchor=25" class="addthx" data-post="253647"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> CreateRemoteThread</span></td>
</tr></table>
</div>
<a name=newreply></a>
<div align=center>
<table class=forums>
<tr>
<td class=caption4 width="100%"><span class=header>Эта тема закрыта. Ответы больше не принимаются.</span></td>
</tr>
</table>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=15941" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
