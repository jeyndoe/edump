<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Как запустить процесс от SYSTEM в NT5 ? - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Тестил 1 прогу и задумался над такой вещью - почему-то не получается запустить процесс с правами Системы в XP/2000. Как бы оно уже никому не надо, но почему так? Мой код возвращает ACCESS_DENIED, популярные тулзы тоже вылетают с">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=40382'>jinoweb</a> (+4 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Как запустить процесс от SYSTEM в NT5 ?</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]morgot[/b]','')">morgot</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33192.png" alt=""><br><span class=txtSm>Ранг: 69.9 (постоянный), 82thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.69'>Активность: 0.14<span style='color:green'>&nearr;</span>0.73</span><br>Статус: <a href="action=userinfo&amp;user=33192">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 марта 2020 22:11 <br><script type="text/javascript">QU('morgot','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=morgot" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=26394.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Тестил 1 прогу и задумался над такой вещью - почему-то не получается запустить процесс с правами Системы в XP/2000. Как бы оно уже никому не надо, но почему так? Мой код возвращает ACCESS_DENIED, популярные тулзы тоже вылетают с ошибкой. Почему-то на десятке даже можно скопировать токен winlogon&#039;a (ес-но от админа), и запустить софт с правами системы, а на ХР нельзя? Как служба - понятно, можно, но если без службы?<br>Копал кто-то эту тему или может знает, в чем причина?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=404152&amp;user=33192&amp;forum_n=6&amp;topic=26394.html&amp;page=0&amp;anchor=1" class="addthx" data-post="404152"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]BlackCode[/b]','')">BlackCode</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33766.png" alt=""><br><span class=txtSm>Ранг: 71.5 (постоянный), 95thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.48'>Активность: 0.1<span style='color:green'>&nearr;</span>0.38</span><br>Статус: <a href="action=userinfo&amp;user=33766">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 марта 2020 23:20 &middot; Поправил: BlackCode <br><script type="text/javascript">QU('BlackCode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=BlackCode" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=26394.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
<I>morgot пишет:<br>Как служба - понятно, можно, но если без службы? </I><br>Если только первоначально процесс запущен от администратора с привилегией отладки.<br>Тогда можно открыть целевой процесс службы, дублировать токен и имперсонировать его себе.<br>Таким образом вы получите большинство привилегий системного процесса. Но не все.<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">SetDebugPrivilege&nbsp;<span class="hl_function"><b>proc</b></span>&nbsp;<span class="hl_function"><b>uses</b></span>&nbsp;<span class="hl_registr"><b>ecx</b></span>&nbsp;<span class="hl_registr"><b>ebx</b></span>&nbsp;<span class="hl_registr">edx</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>local</b></span>&nbsp;hToken<span class="hl_char">:</span><span class="hl_function">dword</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>local</b></span>&nbsp;tkp<span class="hl_char">:</span>TOKEN_PRIVILEGES</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lea</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span>hToken</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;OpenProcessToken<span class="hl_char">,</span>FUNC<span class="hl_char">(</span>GetCurrentProcess<span class="hl_char">)</span><span class="hl_char">,</span>TOKEN_ADJUST_PRIVILEGES&nbsp;<span class="hl_function"><b>or</b></span>&nbsp;TOKEN_QUERY<span class="hl_char">,</span><span class="hl_registr">ebx</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">if</span><span class="hl_char">(</span><span class="hl_char">!</span><span class="hl_registr">eax</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_function">FALSE</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">endif</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;LookupPrivilegeValue<span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">,</span>chr<span class="hl_char">$</span><span class="hl_char">(</span><span class="hl_quote">&quot;SeDebugPrivilege&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;tkp<span class="hl_char">.</span>Privileges<span class="hl_char">[</span><span class="hl_number">0</span><span class="hl_char">]</span><span class="hl_char">.</span>Luid&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">if</span><span class="hl_char">(</span><span class="hl_char">!</span><span class="hl_registr">eax</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;CloseHandle<span class="hl_char">,</span>hToken</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_function">FALSE</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">ret</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">endif</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;tkp<span class="hl_char">.</span>PrivilegeCount<span class="hl_char">,</span><span class="hl_number">1</span>&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;tkp<span class="hl_char">.</span>Privileges<span class="hl_char">[</span><span class="hl_number">0</span><span class="hl_char">]</span><span class="hl_char">.</span>Attributes<span class="hl_char">,</span>SE_PRIVILEGE_ENABLED</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;AdjustTokenPrivileges<span class="hl_char">,</span>hToken<span class="hl_char">,</span><span class="hl_function">FALSE</span><span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;tkp<span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">,</span><span class="hl_number">0</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">if</span><span class="hl_char">(</span><span class="hl_char">!</span><span class="hl_registr">eax</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;CloseHandle<span class="hl_char">,</span>hToken</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span class="hl_function">FALSE</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">endif</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;CloseHandle<span class="hl_char">,</span>hToken</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">ret</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">SetDebugPrivilege&nbsp;<span class="hl_function">endp</span></li>        </ol>
    </div>
</div></div>
<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">GetLsassID&nbsp;<span class="hl_function"><b>proc</b></span>&nbsp;<span class="hl_function"><b>uses</b></span>&nbsp;<span class="hl_registr"><b>ebx</b></span>&nbsp;<span class="hl_registr"><b>ecx</b></span>&nbsp;<span class="hl_registr"><b>edx</b></span>&nbsp;<span class="hl_registr"><b>esi</b></span>&nbsp;<span class="hl_registr">edi</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>local</b></span>&nbsp;hSnapshot<span class="hl_char">:</span><span class="hl_function">dword</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>local</b></span>&nbsp;hProcess<span class="hl_char">:</span><span class="hl_function">dword</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>local</b></span>&nbsp;uProcess<span class="hl_char">:</span>PROCESSENTRY32</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;RtlZeroMemory<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;uProcess<span class="hl_char">,</span><span class="hl_function"><b>sizeof</b></span>&nbsp;uProcess</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;uProcess<span class="hl_char">.</span>dwSize<span class="hl_char">,</span><span class="hl_function"><b>sizeof</b></span>&nbsp;uProcess</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;hSnapshot<span class="hl_char">,</span>FUNC<span class="hl_char">(</span>CreateToolhelp32Snapshot<span class="hl_char">,</span>TH32CS_SNAPPROCESS<span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;hSnapshot&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;INVALID_HANDLE_VALUE</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;LastError</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">endif</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;Process32First<span class="hl_char">,</span>hSnapshot<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;uProcess</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>while</b></span>&nbsp;<span class="hl_function">TRUE</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;Process32Next<span class="hl_char">,</span>hSnapshot<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;uProcess</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>or</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;zero<span class="hl_char">?</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;LastError</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">endif</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;_strcmpi<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;uProcess<span class="hl_char">.</span>szExeFile<span class="hl_char">,</span>chr<span class="hl_char">$</span><span class="hl_char">(</span><span class="hl_quote">&quot;lsass.exe&quot;</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_registr"><b>eax</b></span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_function">NULL</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>invoke</b></span>&nbsp;CloseHandle<span class="hl_char">,</span>hSnapshot</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">break</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">endif</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">endw</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;uProcess<span class="hl_char">.</span>th32ProcessID</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">GetLsassID&nbsp;<span class="hl_function">endp</span></li>        </ol>
    </div>
</div></div>
<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">SetUserSystem&nbsp;<span class="hl_function"><b>proc</b></span>&nbsp;<span class="hl_function"><b>uses</b></span>&nbsp;<span class="hl_registr"><b>ebx</b></span>&nbsp;<span class="hl_registr"><b>ecx</b></span>&nbsp;<span class="hl_registr"><b>edx</b></span>&nbsp;<span class="hl_registr"><b>esi</b></span>&nbsp;<span class="hl_registr">edi</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>local</b></span>&nbsp;hProcess<span class="hl_char">:</span><span class="hl_function">dword</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>local</b></span>&nbsp;hExistingToken<span class="hl_char">:</span><span class="hl_function">dword</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>local</b></span>&nbsp;hNewToken<span class="hl_char">:</span><span class="hl_function">dword</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>local</b></span>&nbsp;sa<span class="hl_char">:</span>SECURITY_ATTRIBUTES</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;hProcess<span class="hl_char">,</span>FUNC<span class="hl_char">(</span>OpenProcess<span class="hl_char">,</span>PROCESS_QUERY_LIMITED_INFORMATION<span class="hl_char">,</span><span class="hl_function">FALSE</span><span class="hl_char">,</span>FUNC<span class="hl_char">(</span>GetLsassID<span class="hl_char">)</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">!</span>hProcess</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;LastError</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">endif</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;OpenProcessToken<span class="hl_char">,</span>hProcess<span class="hl_char">,</span>MAXIMUM_ALLOWED<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;hExistingToken</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">!</span><span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;LastError</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">endif</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;RtlZeroMemory<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;sa<span class="hl_char">,</span><span class="hl_function"><b>sizeof</b></span>&nbsp;sa</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;sa<span class="hl_char">.</span>nLength<span class="hl_char">,</span><span class="hl_function"><b>sizeof</b></span>&nbsp;sa</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;DuplicateTokenEx<span class="hl_char">,</span>hExistingToken<span class="hl_char">,</span>TOKEN_ALL_ACCESS<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;sa<span class="hl_char">,</span>SecurityImpersonation<span class="hl_char">,</span>TokenPrimary<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;hNewToken</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">!</span><span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;LastError</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">endif</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;ImpersonateLoggedOnUser<span class="hl_char">,</span>hNewToken</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_char">!</span><span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;LastError</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">endif</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;CloseHandle<span class="hl_char">,</span>hExistingToken</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;CloseHandle<span class="hl_char">,</span>hNewToken</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">ret</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">SetUserSystem&nbsp;<span class="hl_function">endp</span></li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=404158&amp;user=33766&amp;forum_n=6&amp;topic=26394.html&amp;page=0&amp;anchor=2" class="addthx" data-post="404158"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=33192" title="18-03-2020 20:58, ранг:51.5" target="_blank">morgot</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]morgot[/b]','')">morgot</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33192.png" alt=""><br><span class=txtSm>Ранг: 69.9 (постоянный), 82thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.69'>Активность: 0.14<span style='color:green'>&nearr;</span>0.73</span><br>Статус: <a href="action=userinfo&amp;user=33192">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 18 марта 2020 23:44 <br><script type="text/javascript">QU('morgot','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=morgot" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=26394.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
<b>BlackCode</b><br>вот у меня код прекрасно работает даже на десятке, но не хочет работать на ХР. Именно на DuplicateTokenEx возвращает access_denied. Пробовал уже разные параметры, все равно ошибка в этой вот апи.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=404160&amp;user=33192&amp;forum_n=6&amp;topic=26394.html&amp;page=0&amp;anchor=3" class="addthx" data-post="404160"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]BlackCode[/b]','')">BlackCode</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33766.png" alt=""><br><span class=txtSm>Ранг: 71.5 (постоянный), 95thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.48'>Активность: 0.1<span style='color:green'>&nearr;</span>0.38</span><br>Статус: <a href="action=userinfo&amp;user=33766">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 марта 2020 00:10 &middot; Поправил: BlackCode <br><script type="text/javascript">QU('BlackCode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=BlackCode" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=26394.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
<b>morgot</b><br><br>Только сейчас проверил под ХР.<br>Разница только в флаге открытия процесса.<br>В ХР надо OpenProcess с флагом PROCESS_ALL_ACCESS выполнить а не с PROCESS_QUERY_LIMITED_INFORMATION.<br>И OpenProcessToken отрабатывает как надо <img src="img/smilies/s2.gif" alt=""><br><br>P.S. И вообще, вот исходники тулз RunAsEx,  ZAccessMan, ZTokenMan для ХР.<br>Там все понятно <img src="img/smilies/s3.gif" alt=""><br><br><img src="img/attach.gif" alt=""> <a href="./files/69bb_19.03.2020_EXELAB.rU.tgz">69bb_19.03.2020_EXELAB.rU.tgz</a> - RunUser_src.zip
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=404161&amp;user=33766&amp;forum_n=6&amp;topic=26394.html&amp;page=0&amp;anchor=4" class="addthx" data-post="404161"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]morgot[/b]','')">morgot</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33192.png" alt=""><br><span class=txtSm>Ранг: 69.9 (постоянный), 82thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.69'>Активность: 0.14<span style='color:green'>&nearr;</span>0.73</span><br>Статус: <a href="action=userinfo&amp;user=33192">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 марта 2020 00:19 <br><script type="text/javascript">QU('morgot','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=morgot" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=26394.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
<b>BlackCode</b><br>странно все это. На ХР действительно запустилось, создал cmd.exe , но повышения нет - т.е. обычная консоль от админа.<br>Можете скинуть свой бинарник?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=404162&amp;user=33192&amp;forum_n=6&amp;topic=26394.html&amp;page=0&amp;anchor=5" class="addthx" data-post="404162"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]BlackCode[/b]','')">BlackCode</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33766.png" alt=""><br><span class=txtSm>Ранг: 71.5 (постоянный), 95thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.48'>Активность: 0.1<span style='color:green'>&nearr;</span>0.38</span><br>Статус: <a href="action=userinfo&amp;user=33766">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 марта 2020 00:23 &middot; Поправил: BlackCode <br><script type="text/javascript">QU('BlackCode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=BlackCode" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=26394.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
<I>morgot пишет:<br>но повышения нет </I><br>Посмотри права процесса в ProcessHacker-е к примеру, если права скопировались, то они должны появиться в твоем процессе, после имперсонации.<br>Ты процесс запускаешь от учетки пользователя с правами админа, надо перезапускать процесс с дублированным токеном. (CreateProcessAsUser) Только тогда процесс будет запущен от учетки, чей токен ты дублировал.<br>Или перезапустить самого себя с дублированным токеном.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=404163&amp;user=33766&amp;forum_n=6&amp;topic=26394.html&amp;page=0&amp;anchor=6" class="addthx" data-post="404163"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]morgot[/b]','')">morgot</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33192.png" alt=""><br><span class=txtSm>Ранг: 69.9 (постоянный), 82thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.69'>Активность: 0.14<span style='color:green'>&nearr;</span>0.73</span><br>Статус: <a href="action=userinfo&amp;user=33192">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 марта 2020 00:36 <br><script type="text/javascript">QU('morgot','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=morgot" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=26394.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
<b>BlackCode</b><br>в SetUserSystem написал invoke CreateProcessAsUser,hNewToken,chr&#036;(&quot;C:\windows\system32\cmd.exe&quot;),edx,edx,edx,edx,CREATE_NEW_CONSOLE,edx,edx,addr s_i,addr p_i<br>cоздает обычную консоль..<br><br>Не могу я с этим разобраться, или усталость ,или не знание какой-то матчасти.<br><br><b>Добавлено спустя 1 минуту</b><br>p.s. за сорцы спасибо, не видел сразу. Щас буду разбираться.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=404164&amp;user=33192&amp;forum_n=6&amp;topic=26394.html&amp;page=0&amp;anchor=7" class="addthx" data-post="404164"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]BlackCode[/b]','')">BlackCode</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33766.png" alt=""><br><span class=txtSm>Ранг: 71.5 (постоянный), 95thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.48'>Активность: 0.1<span style='color:green'>&nearr;</span>0.38</span><br>Статус: <a href="action=userinfo&amp;user=33766">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 марта 2020 00:40 &middot; Поправил: BlackCode <br><script type="text/javascript">QU('BlackCode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=BlackCode" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=26394.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
<I>morgot пишет:<br>Не могу я с этим разобраться </I><br>Посмотри исходники которые я выше дал. Там все понятно, и последовательность вызова АПИ тоже.<br>Смотри исходники RunAsEx. Там есть скомпилированный ехешник. Под ХР он запускается.<br><I>morgot пишет:<br>не знание какой-то матчасти </I><br>Главное - это желание разобраться <img src="img/smilies/s3.gif" alt=""><br><br><b>Добавлено спустя 48 минут</b><br>Вот еще что. Самое главное, для создания полноценного процесса с дублированным токеном от процесса запущенного от сторонней учетной записи, в данном случае SYSTEM,<br>необходимо чтобы <u><b>процесс который дублирует токен и в последствии создает дочерний процесс с данным токеном</b></u> имел привилегию <b>SeTcbPrivilege</b>.<br>Эта привилегия присутствует только у процессов сервисов (служб) соответственно работающих от учетки SYSTEM.<br>У юзермодных процессов этой привилегии нет априори.<br><br>Это получение дубликата токена из процесса сервиса.<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">GetProcessTokenW&nbsp;<span class="hl_function"><b>proc</b></span>&nbsp;<span class="hl_function"><b>uses</b></span>&nbsp;<span class="hl_registr"><b>rbx</b></span>&nbsp;<span class="hl_registr"><b>rcx</b></span>&nbsp;<span class="hl_registr"><b>rdx</b></span>&nbsp;<span class="hl_registr"><b>rsi</b></span>&nbsp;<span class="hl_registr"><b>rdi</b></span>&nbsp;r8&nbsp;r9&nbsp;r10&nbsp;r11&nbsp;r12&nbsp;r13&nbsp;r14&nbsp;r15&nbsp;lpProcessName<span class="hl_char">:</span>LPSTR</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>local</b></span>&nbsp;hToken<span class="hl_char">:</span>qword</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>local</b></span>&nbsp;hNewToken<span class="hl_char">:</span>qword</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>local</b></span>&nbsp;hProcess<span class="hl_char">:</span>qword</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>local</b></span>&nbsp;hSnapshot<span class="hl_char">:</span>qword</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>local</b></span>&nbsp;soa<span class="hl_char">:</span>OBJECT_ATTRIBUTES</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>local</b></span>&nbsp;uProcess<span class="hl_char">:</span>PROCESSENTRY32W</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;memalign&nbsp;<span class="hl_registr">rsp</span><span class="hl_char">,</span><span class="hl_number">16</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;memset<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;uProcess<span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span><span class="hl_function"><b>sizeof</b></span>&nbsp;uProcess</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;uProcess<span class="hl_char">.</span>dwSize<span class="hl_char">,</span><span class="hl_function"><b>sizeof</b></span>&nbsp;PROCESSENTRY32W</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;hSnapshot<span class="hl_char">,</span>FUNC<span class="hl_char">(</span>CreateToolhelp32Snapshot<span class="hl_char">,</span>TH32CS_SNAPPROCESS<span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;hSnapshot&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;INVALID_HANDLE_VALUE</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;DebugLastError</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">endif</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;Process32FirstW<span class="hl_char">,</span>hSnapshot<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;uProcess</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>while</b></span>&nbsp;<span class="hl_function">TRUE</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;Process32NextW<span class="hl_char">,</span>hSnapshot<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;uProcess</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>or</b></span>&nbsp;<span class="hl_registr">rax</span><span class="hl_char">,</span><span class="hl_registr">rax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;zero<span class="hl_char">?</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;DebugLastError</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">endif</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;_wcsicmp<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;uProcess<span class="hl_char">.</span>szExeFile<span class="hl_char">,</span>lpProcessName</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_registr"><b>rax</b></span>&nbsp;<span class="hl_char">=</span><span class="hl_char">=</span>&nbsp;<span class="hl_function">NULL</span></li><li class="hl_l1"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_function"><b>invoke</b></span>&nbsp;CloseHandle<span class="hl_char">,</span>hSnapshot</li><li class="hl_l0"><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_char">.</span><span class="hl_function">break</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">endif</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">endw</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;memset<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;soa<span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span><span class="hl_function"><b>sizeof</b></span>&nbsp;soa</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;soa<span class="hl_char">.</span>_Length<span class="hl_char">,</span><span class="hl_function"><b>sizeof</b></span>&nbsp;soa</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;NtOpenProcess<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;hProcess<span class="hl_char">,</span>PROCESS_QUERY_INFORMATION<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;soa<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;uProcess<span class="hl_char">.</span>th32ProcessID</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;DebugLastError</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">endif</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;NtOpenProcessToken<span class="hl_char">,</span>hProcess<span class="hl_char">,</span>TOKEN_ALL_ACCESS<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;hToken</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;DebugLastError</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">endif</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;NtClose<span class="hl_char">,</span>hProcess</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;DebugLastError</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">endif</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;memset<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;soa<span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span><span class="hl_function"><b>sizeof</b></span>&nbsp;soa</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;soa<span class="hl_char">.</span>_Length<span class="hl_char">,</span><span class="hl_function"><b>sizeof</b></span>&nbsp;soa</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;NtDuplicateToken<span class="hl_char">,</span>hToken<span class="hl_char">,</span>TOKEN_ALL_ACCESS<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;soa<span class="hl_char">,</span>SecurityDelegation<span class="hl_char">,</span>TokenPrimary<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;hNewToken</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;DebugLastError</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">endif</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;NtClose<span class="hl_char">,</span>hToken</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;DebugLastError</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">endif</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;hNewToken</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">GetProcessTokenW&nbsp;<span class="hl_function">endp</span></li>        </ol>
    </div>
</div></div>
<br><br>И еще! Процесс созданный из под сервиса, не имеет доступа к рабочему столу, по этому для того чтобы окно запущенного приложения отображалось,<br>необходимо открыть доступ к рабочему столу для данного приложения.<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">SetDesktopWinStaAccess&nbsp;<span class="hl_function"><b>proc</b></span>&nbsp;<span class="hl_function"><b>uses</b></span>&nbsp;<span class="hl_registr"><b>rbx</b></span>&nbsp;<span class="hl_registr"><b>rcx</b></span>&nbsp;<span class="hl_registr"><b>rdx</b></span>&nbsp;<span class="hl_registr"><b>rsi</b></span>&nbsp;<span class="hl_registr"><b>rdi</b></span>&nbsp;r8&nbsp;r9&nbsp;r10&nbsp;r11&nbsp;r12&nbsp;r13&nbsp;r14&nbsp;r15</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>local</b></span>&nbsp;allAppPackagesSid<span class="hl_char">[</span>SECURITY_DESCRIPTOR_MIN_LENGTH&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>ULONG<span class="hl_char">)</span><span class="hl_char">]</span><span class="hl_char">:</span><span class="hl_function">byte</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;memalign&nbsp;<span class="hl_registr">rsp</span><span class="hl_char">,</span><span class="hl_number">16</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;RtlInitializeSid<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;allAppPackagesSid<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;appPackageAuthority<span class="hl_char">,</span>SECURITY_BUILTIN_APP_PACKAGE_RID_COUNT</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;RtlSubAuthoritySid<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;allAppPackagesSid<span class="hl_char">,</span><span class="hl_number">0</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function">ptr</span><span class="hl_char">[</span><span class="hl_registr">rax</span><span class="hl_char">]</span><span class="hl_char">,</span>SECURITY_APP_PACKAGE_BASE_RID</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;RtlSubAuthoritySid<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;allAppPackagesSid<span class="hl_char">,</span><span class="hl_number">1</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_function">ptr</span><span class="hl_char">[</span><span class="hl_registr">rax</span><span class="hl_char">]</span><span class="hl_char">,</span>SECURITY_BUILTIN_PACKAGE_ANY_PACKAGE</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">rbx</span><span class="hl_char">,</span>FUNC<span class="hl_char">(</span>RtlLengthSid<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;PhSeEveryoneSid<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">rbx</span><span class="hl_char">,</span>FUNC<span class="hl_char">(</span>RtlLengthSid<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;allAppPackagesSid<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">ebx</span><span class="hl_char">,</span>SECURITY_DESCRIPTOR_MIN_LENGTH&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>ACL<span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_char">(</span><span class="hl_number">3</span><span class="hl_char">*</span><span class="hl_function">sizeof</span><span class="hl_char">(</span>ACCESS_ALLOWED_ACE<span class="hl_char">)</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">+</span>&nbsp;<span class="hl_char">(</span><span class="hl_number">2</span><span class="hl_char">*</span><span class="hl_function">sizeof</span><span class="hl_char">(</span><span class="hl_function">DWORD</span><span class="hl_char">)</span><span class="hl_char">)</span>&nbsp;<span class="hl_comment">; allocationLength</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">rdi</span><span class="hl_char">,</span>FUNC<span class="hl_char">(</span>RtlAllocateHeap<span class="hl_char">,</span>FUNC<span class="hl_char">(</span>GetProcessHeap<span class="hl_char">)</span><span class="hl_char">,</span>HEAP_ZERO_MEMORY<span class="hl_char">,</span><span class="hl_registr">ebx</span><span class="hl_char">)</span>&nbsp;<span class="hl_comment">; securityDescriptor</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;RtlCreateSecurityDescriptor<span class="hl_char">,</span><span class="hl_registr">rdi</span><span class="hl_char">,</span>SECURITY_DESCRIPTOR_REVISION</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lea</b></span>&nbsp;<span class="hl_registr">rsi</span><span class="hl_char">,</span><span class="hl_char">[</span><span class="hl_registr">rdi</span><span class="hl_char">+</span>SECURITY_DESCRIPTOR_MIN_LENGTH<span class="hl_char">*</span><span class="hl_number">2</span><span class="hl_char">]</span>&nbsp;<span class="hl_comment">; dacl</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lea</b></span>&nbsp;<span class="hl_registr">rdx</span><span class="hl_char">,</span><span class="hl_char">[</span><span class="hl_registr">rbx</span><span class="hl_char">-</span>SECURITY_DESCRIPTOR_MIN_LENGTH<span class="hl_char">*</span><span class="hl_number">2</span><span class="hl_char">]</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;RtlCreateAcl<span class="hl_char">,</span><span class="hl_registr">rsi</span><span class="hl_char">,</span><span class="hl_registr">rdx</span><span class="hl_char">,</span>ACL_REVISION</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;RtlAddAccessAllowedAce<span class="hl_char">,</span><span class="hl_registr">rsi</span><span class="hl_char">,</span>ACL_REVISION<span class="hl_char">,</span>GENERIC_ALL<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;PhSeEveryoneSid</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;GetWindowsVersion</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_registr"><b>eax</b></span>&nbsp;<span class="hl_char">&gt;</span><span class="hl_char">=</span>&nbsp;WINDOWS_8</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;RtlAddAccessAllowedAce<span class="hl_char">,</span><span class="hl_registr">rsi</span><span class="hl_char">,</span>ACL_REVISION<span class="hl_char">,</span>GENERIC_ALL<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;allAppPackagesSid</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">endif</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;RtlSetDaclSecurityDescriptor<span class="hl_char">,</span><span class="hl_registr">rdi</span><span class="hl_char">,</span><span class="hl_function">TRUE</span><span class="hl_char">,</span><span class="hl_registr">rsi</span><span class="hl_char">,</span><span class="hl_function">FALSE</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">rbx</span><span class="hl_char">,</span>FUNC<span class="hl_char">(</span>OpenWindowStationW<span class="hl_char">,</span>uni<span class="hl_char">$</span><span class="hl_char">(</span><span class="hl_quote">&quot;WinSta0&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span><span class="hl_function">FALSE</span><span class="hl_char">,</span>WRITE_DAC<span class="hl_char">)</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;NtSetSecurityObject<span class="hl_char">,</span><span class="hl_registr">rbx</span><span class="hl_char">,</span>DACL_SECURITY_INFORMATION<span class="hl_char">,</span><span class="hl_registr">rdi</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;CloseWindowStation<span class="hl_char">,</span><span class="hl_registr">rbx</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">rbx</span><span class="hl_char">,</span>FUNC<span class="hl_char">(</span>OpenDesktopW<span class="hl_char">,</span>uni<span class="hl_char">$</span><span class="hl_char">(</span><span class="hl_quote">&quot;Default&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span><span class="hl_function">FALSE</span><span class="hl_char">,</span>WRITE_DAC&nbsp;<span class="hl_function"><b>or</b></span>&nbsp;DESKTOP_READOBJECTS&nbsp;<span class="hl_function"><b>or</b></span>&nbsp;DESKTOP_WRITEOBJECTS<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;NtSetSecurityObject<span class="hl_char">,</span><span class="hl_registr">rbx</span><span class="hl_char">,</span>DACL_SECURITY_INFORMATION<span class="hl_char">,</span><span class="hl_registr">rdi</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;CloseDesktop<span class="hl_char">,</span><span class="hl_registr">rbx</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;RtlFreeHeap<span class="hl_char">,</span>FUNC<span class="hl_char">(</span>GetProcessHeap<span class="hl_char">)</span><span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span><span class="hl_registr">rdi</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">ret</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">SetDesktopWinStaAccess&nbsp;<span class="hl_function">endp</span></li>        </ol>
    </div>
</div></div>
<br><br>Код 64-битный, под х86 легко партируется <img src="img/smilies/s3.gif" alt=""><br>Это все привилегии которые необходимо разрешить для создания полноценного процесса с дублированным токеном, помимо SeTcbPrivilege.<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;EnablePrivilege<span class="hl_char">,</span>chr<span class="hl_char">$</span><span class="hl_char">(</span><span class="hl_quote">&quot;SeAssignPrimaryTokenPrivilege&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span><span class="hl_function">TRUE</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;EnablePrivilege<span class="hl_char">,</span>chr<span class="hl_char">$</span><span class="hl_char">(</span><span class="hl_quote">&quot;SeBackupPrivilege&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span><span class="hl_function">TRUE</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;EnablePrivilege<span class="hl_char">,</span>chr<span class="hl_char">$</span><span class="hl_char">(</span><span class="hl_quote">&quot;SeImpersonatePrivilege&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span><span class="hl_function">TRUE</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;EnablePrivilege<span class="hl_char">,</span>chr<span class="hl_char">$</span><span class="hl_char">(</span><span class="hl_quote">&quot;SeIncreaseQuotaPrivilege&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span><span class="hl_function">TRUE</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;EnablePrivilege<span class="hl_char">,</span>chr<span class="hl_char">$</span><span class="hl_char">(</span><span class="hl_quote">&quot;SeRestorePrivilege&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span><span class="hl_function">TRUE</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;EnablePrivilege<span class="hl_char">,</span>chr<span class="hl_char">$</span><span class="hl_char">(</span><span class="hl_quote">&quot;SeLoadDriverPrivilege&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span><span class="hl_function">TRUE</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;EnablePrivilege<span class="hl_char">,</span>chr<span class="hl_char">$</span><span class="hl_char">(</span><span class="hl_quote">&quot;SeTakeOwnershipPrivilege&quot;</span><span class="hl_char">)</span><span class="hl_char">,</span><span class="hl_function">TRUE</span></li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=404165&amp;user=33766&amp;forum_n=6&amp;topic=26394.html&amp;page=0&amp;anchor=8" class="addthx" data-post="404165"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]mdscorp[/b]','')">mdscorp</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 47.6 (посетитель), 15thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.37'>Активность: 0.03<span style='color:red'>&searr;</span>0.02</span><br>Статус: <a href="action=userinfo&amp;user=24498">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 марта 2020 18:32 <br><script type="text/javascript">QU('mdscorp','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=mdscorp" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=26394.html&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
проще самому залогиниться как систем<br>Экран выбора учётной записи &gt; 5 раз шифт &gt; справка&gt; проводник &quot;explorer.exe&quot;
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=404184&amp;user=24498&amp;forum_n=6&amp;topic=26394.html&amp;page=0&amp;anchor=9" class="addthx" data-post="404184"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]morgot[/b]','')">morgot</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33192.png" alt=""><br><span class=txtSm>Ранг: 69.9 (постоянный), 82thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.69'>Активность: 0.14<span style='color:green'>&nearr;</span>0.73</span><br>Статус: <a href="action=userinfo&amp;user=33192">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 19 марта 2020 21:28 <br><script type="text/javascript">QU('morgot','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=morgot" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=26394.html&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
<b>BlackCode</b><br>Самое удивительно то, что на виста и выше нужно &quot;всего лишь&quot; 1 привилегия и совсем немного кода. Почему так? С другой стороны, понятно, что в ХР можно было от админа создать службу, но все же.<br>За сорцы спасибо <img src="img/smilies/s1.gif" alt=""><br><br><b>mdscorp</b><br>Мне нужно <i class=x>программно</i>, но спасибо, мб пригодится.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=404198&amp;user=33192&amp;forum_n=6&amp;topic=26394.html&amp;page=0&amp;anchor=10" class="addthx" data-post="404198"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]Alchemistry[/b]','')">Alchemistry</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 145.8 (ветеран), 191thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.05'>Активность: 0.14<span style='color:green'>&nearr;</span>0.36</span><br>Статус: <a href="action=userinfo&amp;user=21411">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 20 марта 2020 06:55 <br><script type="text/javascript">QU('Alchemistry','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Alchemistry" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=26394.html&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
<b>BlackCode</b><br>Какой бред ты несешь, ей богу. Не говоря уже о том что твой гавнокод пихает sid everyone туда где его быть не должно от слова совсем.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=404215&amp;user=21411&amp;forum_n=6&amp;topic=26394.html&amp;page=0&amp;anchor=11" class="addthx" data-post="404215"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]BlackCode[/b]','')">BlackCode</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33766.png" alt=""><br><span class=txtSm>Ранг: 71.5 (постоянный), 95thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.48'>Активность: 0.1<span style='color:green'>&nearr;</span>0.38</span><br>Статус: <a href="action=userinfo&amp;user=33766">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 20 марта 2020 09:17 &middot; Поправил: BlackCode <br><script type="text/javascript">QU('BlackCode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=BlackCode" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=26394.html&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
<b>Alchemistry</b><br>Ты это разработчику PocessHacker-a скажи, умник <img src="img/smilies/s2.gif" alt=""><br>Ты свой говнокод покажи... прежде чужой обсерать..<br>Пи@деть не мешки ворочать...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=404217&amp;user=33766&amp;forum_n=6&amp;topic=26394.html&amp;page=0&amp;anchor=12" class="addthx" data-post="404217"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]Alchemistry[/b]','')">Alchemistry</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 145.8 (ветеран), 191thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.05'>Активность: 0.14<span style='color:green'>&nearr;</span>0.36</span><br>Статус: <a href="action=userinfo&amp;user=21411">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 20 марта 2020 09:26 <br><script type="text/javascript">QU('Alchemistry','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Alchemistry" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=26394.html&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
<b>BlackCode</b><br>Напоминаю тебе, дурачок, у WinSta0 и Default десктопа в списке разрешений есть и LocalSystem и Administrators. Твой гавнокод запихал туда еще принудительно Everyone.<br>С удовольствием скажу это и wj32, зови его сюда, только в отличие от тебя рандомного идиота, он меня знает, а тебя нет)
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=404218&amp;user=21411&amp;forum_n=6&amp;topic=26394.html&amp;page=0&amp;anchor=13" class="addthx" data-post="404218"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]BlackCode[/b]','')">BlackCode</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33766.png" alt=""><br><span class=txtSm>Ранг: 71.5 (постоянный), 95thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.48'>Активность: 0.1<span style='color:green'>&nearr;</span>0.38</span><br>Статус: <a href="action=userinfo&amp;user=33766">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 20 марта 2020 09:29 <br><script type="text/javascript">QU('BlackCode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=BlackCode" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=26394.html&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
<b>Alchemistry</b><br>Твоего мнения никто не спрашивал.<br><I>Alchemistry пишет:<br>он меня знает, а тебя нет </I><br>Тебя, пиздабола знает весь форум. <img src="img/smilies/s6.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=404220&amp;user=33766&amp;forum_n=6&amp;topic=26394.html&amp;page=0&amp;anchor=14" class="addthx" data-post="404220"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]Alchemistry[/b]','')">Alchemistry</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 145.8 (ветеран), 191thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.05'>Активность: 0.14<span style='color:green'>&nearr;</span>0.36</span><br>Статус: <a href="action=userinfo&amp;user=21411">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 20 марта 2020 09:33 <br><script type="text/javascript">QU('Alchemistry','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Alchemistry" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=26394.html&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
Кукарекай дальше, мне фиолетово.<br><br><I>BlackCode пишет:<br>Эта привилегия присутствует только у процессов сервисов (служб) соответственно работающих от учетки SYSTEM.<br>У юзермодных процессов этой привилегии нет априори. </I><br><br>Вот это проясни, гуру копирования ты наш)
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=404221&amp;user=21411&amp;forum_n=6&amp;topic=26394.html&amp;page=0&amp;anchor=15" class="addthx" data-post="404221"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Как запустить процесс от SYSTEM в NT5 ?</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#16" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="6">
<input type="hidden" name="topic" value="26394">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=26394" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
