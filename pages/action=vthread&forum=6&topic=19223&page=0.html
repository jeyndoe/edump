<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Остановить Non-Alertable поток - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Как-то можно временно остановить Non-Alertable поток? Мне нужно ему в стек кое-чего прописать, а потом отпустить.">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=1288'>UniSoft</a>, <a target='_blank' href='?action=userinfo&amp;user=55953'>laslo</a>, <a target='_blank' href='?action=userinfo&amp;user=26261'>bartolomeo</a> (+5 невидимых)</b></span>
</td>
</tr>
</table>

 

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Остановить Non-Alertable поток</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> .  <b>1</b> . <a href="action=vthread&amp;forum=6&amp;topic=19223&amp;page=1.html">2</a> . <a href="action=vthread&amp;forum=6&amp;topic=19223&amp;page=1.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]Hexxx[/b]','')">Hexxx</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 481.4 (мудрец), 109thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.37'>Активность: 0.18<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=10168">Участник</a><br><font color=blue>Тот самый :)</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 ноября 2011 15:02 &middot; Поправил: Hexxx <br><script type="text/javascript">QU('Hexxx','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Hexxx" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19223&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Как-то можно временно остановить <b><u>Non-Alertable поток</u></b>? Мне нужно ему в стек кое-чего прописать, а потом отпустить.
<br><br><font size="1"><i>-----<br>Реверсивная инженерия - написание кода идентичного натуральному</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=294735&amp;user=10168&amp;forum_n=6&amp;topic=19223&amp;page=0&amp;anchor=1" class="addthx" data-post="294735"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]vptrlx[/b]','')">vptrlx</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 56.1 (постоянный), 9thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.91'>Активность: 0.04<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=22056">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 ноября 2011 15:27 <br><script type="text/javascript">QU('vptrlx','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=vptrlx" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19223&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
SuspendThread — не то?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=294738&amp;user=22056&amp;forum_n=6&amp;topic=19223&amp;page=0&amp;anchor=2" class="addthx" data-post="294738"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]bowrouco[/b]','')">bowrouco</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 47.7 (посетитель), 17thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.01'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29629">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 ноября 2011 15:55 <br><script type="text/javascript">QU('bowrouco','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=bowrouco" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19223&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
Что делает поток ?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=294742&amp;user=29629&amp;forum_n=6&amp;topic=19223&amp;page=0&amp;anchor=3" class="addthx" data-post="294742"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]Hexxx[/b]','')">Hexxx</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 481.4 (мудрец), 109thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.37'>Активность: 0.18<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=10168">Участник</a><br><font color=blue>Тот самый :)</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 ноября 2011 16:34 &middot; Поправил: Hexxx <br><script type="text/javascript">QU('Hexxx','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Hexxx" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19223&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
<I>vptrlx пишет:<br>SuspendThread — не то? </I><br>SuspendThread работает через APC. Дальше пояснять надо почему Non-Alertable не остановится?<br><br><I>Сообщение посчитали полезным: int </I><br>стыдно товарищ int <img src="img/smilies/s1.gif" alt=""><br><br><I>bowrouco пишет:<br>Что делает поток ? </I><br>Работает.
<br><br><font size="1"><i>-----<br>Реверсивная инженерия - написание кода идентичного натуральному</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=294744&amp;user=10168&amp;forum_n=6&amp;topic=19223&amp;page=0&amp;anchor=4" class="addthx" data-post="294744"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]bowrouco[/b]','')">bowrouco</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 47.7 (посетитель), 17thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.01'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29629">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 ноября 2011 17:05 <br><script type="text/javascript">QU('bowrouco','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=bowrouco" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19223&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
<b>Hexxx</b><br><br>&gt; SuspendThread работает через APC.<br><br>Она работает не через APC, а через special-APC, точнее саспенд-апк. Сие доставляется при возврате из прерываний шедулером. Ну раз не известно какой поток(кпл), чего он делает и саспендтред не робит, то значит и гет/сетконтекстапк тоже работать не будут.. ничего больше не могу предложить.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=294746&amp;user=29629&amp;forum_n=6&amp;topic=19223&amp;page=0&amp;anchor=5" class="addthx" data-post="294746"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]Hexxx[/b]','')">Hexxx</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 481.4 (мудрец), 109thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.37'>Активность: 0.18<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=10168">Участник</a><br><font color=blue>Тот самый :)</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 ноября 2011 17:17 &middot; Поправил: Hexxx <br><script type="text/javascript">QU('Hexxx','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Hexxx" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19223&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
<I>bowrouco пишет:<br>ничего больше не могу предложить. </I><br>Я могу предложить, но мне оно не нравится:<br>делаем Dpc процедуру которая крутится в цикле, дальше каждому процу даем ее. Все, все процы висят намертво, выполняя только эту DPC процедуру. Естественно один проц нужно оставить себе и задрать IRQL до DISPATCH, чтобы не переключилось.<br><br>Так работает, но мне так не нравится, потому что всю систему замораживаю...
<br><br><font size="1"><i>-----<br>Реверсивная инженерия - написание кода идентичного натуральному</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=294750&amp;user=10168&amp;forum_n=6&amp;topic=19223&amp;page=0&amp;anchor=6" class="addthx" data-post="294750"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]bowrouco[/b]','')">bowrouco</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 47.7 (посетитель), 17thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.01'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29629">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 ноября 2011 17:26 &middot; Поправил: bowrouco <br><script type="text/javascript">QU('bowrouco','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=bowrouco" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19223&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
<b>Hexxx</b><br>Значит тред ядерный. Так разрешите доставку апк <img src="img/smilies/s3.gif" alt=""><br><br>&gt; Все, все процы висят намертво, выполняя только эту DPC процедуру.<br><br>С таким успехом можно IPI послать, в этом случае IRQL не имеет значения. В ней все потоки будут остановлены в системе, кроме текущего.<br><br>Всёже зачем вам стек потока, который не известно что выполняет ?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=294754&amp;user=29629&amp;forum_n=6&amp;topic=19223&amp;page=0&amp;anchor=7" class="addthx" data-post="294754"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]Hexxx[/b]','')">Hexxx</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 481.4 (мудрец), 109thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.37'>Активность: 0.18<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=10168">Участник</a><br><font color=blue>Тот самый :)</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 06 ноября 2011 01:05 &middot; Поправил: Hexxx <br><script type="text/javascript">QU('Hexxx','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Hexxx" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19223&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
<I>Hexxx пишет:<br>Так разрешите доставку апк </I><br>Как именно?<br><br><I>bowrouco пишет:<br>Всёже зачем вам стек потока, который не известно что выполняет ? </I><br>Ответ на этот вопрос не связан с первоначальной темой. <img src="img/smilies/s3.gif" alt=""> Я перебираю потоки если нахожу подходящий - правлю ему стек. Знание для каких целей, никак не поможет решить проблему блокирования потока.
<br><br><font size="1"><i>-----<br>Реверсивная инженерия - написание кода идентичного натуральному</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=294769&amp;user=10168&amp;forum_n=6&amp;topic=19223&amp;page=0&amp;anchor=8" class="addthx" data-post="294769"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]vptrlx[/b]','')">vptrlx</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 56.1 (постоянный), 9thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.91'>Активность: 0.04<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=22056">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 06 ноября 2011 01:33 <br><script type="text/javascript">QU('vptrlx','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=vptrlx" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19223&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
<I>Hexxx пишет:<br>SuspendThread работает через APC. Дальше пояснять надо почему Non-Alertable не остановится? </I><br>на заметку:<br>http://www.dcl.hpi.uni-potsdam.de/research/WRK/2009/01/what-does-suspendthread-really-do/index.html<br><br>А проблема-то в чём? некоторые потоки не саспендятся? Может и не надо саспендить те, которые не саспендятся, или искомый именно такой?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=294770&amp;user=22056&amp;forum_n=6&amp;topic=19223&amp;page=0&amp;anchor=9" class="addthx" data-post="294770"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]V0ldemAr[/b]','')">V0ldemAr</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 65.4 (постоянный), 10thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.95'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=68">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 06 ноября 2011 01:37 <br><script type="text/javascript">QU('V0ldemAr','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=V0ldemAr" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19223&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
А почему саспед не работает? Должен работать даже для non-Alertable только надо переключится в системный процесс чтобы PreviousMode был KernelMode.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=294771&amp;user=68&amp;forum_n=6&amp;topic=19223&amp;page=0&amp;anchor=10" class="addthx" data-post="294771"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]bowrouco[/b]','')">bowrouco</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 47.7 (посетитель), 17thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.01'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29629">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 06 ноября 2011 01:40 &middot; Поправил: bowrouco <br><script type="text/javascript">QU('bowrouco','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=bowrouco" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19223&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
<b>V0ldemAr</b><br>Может !IF или есчо какая причина.<br><br>&gt; Знание для каких целей, никак не поможет решить проблему блокирования потока.<br><br>Наоборот, это самое главное и от этого зависит решение. Может можно смаршрутизировать или вообще не трогать стек.<br><br>Да и вообще есть такое понятие как баланс стека и два списка SFC и SEH, по ним можно найти текущий стековый фрейм и не нужно знать текущее значение Esp. Да и дно стека хранится в TSS/EPROCESS. Это наверно такой же лол h**p://rootkits.su/index.php/topic,24.msg471.html#msg471 <img src="img/smilies/s16.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=294772&amp;user=29629&amp;forum_n=6&amp;topic=19223&amp;page=0&amp;anchor=11" class="addthx" data-post="294772"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]Hexxx[/b]','')">Hexxx</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 481.4 (мудрец), 109thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.37'>Активность: 0.18<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=10168">Участник</a><br><font color=blue>Тот самый :)</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 06 ноября 2011 20:15 &middot; Поправил: Hexxx <br><script type="text/javascript">QU('Hexxx','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Hexxx" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19223&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
Я меняю в стеке один из адресов возврата. Пока поток выполняется он может изменить стек, и не важно как ты до стека доберешься. Важно именно остановить выполнение.
<br><br><font size="1"><i>-----<br>Реверсивная инженерия - написание кода идентичного натуральному</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=294795&amp;user=10168&amp;forum_n=6&amp;topic=19223&amp;page=0&amp;anchor=12" class="addthx" data-post="294795"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]bowrouco[/b]','')">bowrouco</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 47.7 (посетитель), 17thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.01'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29629">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 06 ноября 2011 22:33 &middot; Поправил: bowrouco <br><script type="text/javascript">QU('bowrouco','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=bowrouco" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19223&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
<b>Hexxx</b><br>Почитайте руткитсы. Отложенная передача управления сейчас механизм единственно актуальный для юзания в руткитах. Это столь гибкая технология, что позволяет заменить фактически всё ядро так, что подмену никто не заметит. В основе лежит 3 типа маршрутизации. Ваша задача сводится к этому решению, ну если нормально решать без извратов типа DPC. Проблема в не желании рассматривать механизм. На руткитсы ссылка была как прикол, там аверы добавили комент в свой говнокод типо мега привад и при попытке ресерча меня отправят в газовую камеру <img src="img/smilies/s5.gif" alt=""><br>Также и у вас - вы не говорите цель и изначальную задачу, а пытаетесь решить задачу совершенно не приемлемым способом. Аналогично как и патчи - все их юзают, да дерьмо конечно, но они не могут понять что заглянув внутрь, глубже откроется истина.<br>Замена адресов возврата это S-маршрутизация. В вашем же случае вы решили использовать W-маршрутизацию, тоесть потоковое переключение, хотя и немного извращённое. <u>S-rt выполняется обычно в текущем потоке до перехода на целевой код, причём NL понижается, это важно.</u> Поэтому я сразу и спросил про вашу конкретную цель.<br><br>Сабж http://indy-vx.narod.ru/Bin/IDPxSrt.zip<br><br>В семпле не имеет значения мод или апи. Вам главное понять как оно робит в целом, тогда будет профит и вы легко решите свою задачу.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=294799&amp;user=29629&amp;forum_n=6&amp;topic=19223&amp;page=0&amp;anchor=13" class="addthx" data-post="294799"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]Hexxx[/b]','')">Hexxx</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 481.4 (мудрец), 109thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.37'>Активность: 0.18<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=10168">Участник</a><br><font color=blue>Тот самый :)</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 06 ноября 2011 23:14 &middot; Поправил: Hexxx <br><script type="text/javascript">QU('Hexxx','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Hexxx" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19223&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
<I>bowrouco пишет:<br>пытаетесь решить задачу совершенно не приемлемым способом </I><br>После таких слов вспоминается баш:<br><I>xxx: Словно умудренные жизненным опытом стервятники в пустыне, они смотрят вслед проползающим путникам. На вопрос, где можно напиться, они долго обсуждают, нужна ли тебе вода и неизменно приходят к выводу, что нет, тебе, брат, вода ни к чему. Неспешно перечисляют причины, по которым тебе лучше жить без воды. И ни один из них не покажет в какой стороне колодец. <br></I><br>почитаю конечно про эти маршрутизации, но помоему это не совсем то...
<br><br><font size="1"><i>-----<br>Реверсивная инженерия - написание кода идентичного натуральному</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=294806&amp;user=10168&amp;forum_n=6&amp;topic=19223&amp;page=0&amp;anchor=14" class="addthx" data-post="294806"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]bowrouco[/b]','')">bowrouco</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 47.7 (посетитель), 17thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.01'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29629">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 06 ноября 2011 23:25 <br><script type="text/javascript">QU('bowrouco','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=bowrouco" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19223&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
<b>Hexxx</b><br>Потомучто вы не просите воды, ибо секретно.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=294808&amp;user=29629&amp;forum_n=6&amp;topic=19223&amp;page=0&amp;anchor=15" class="addthx" data-post="294808"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]Hexxx[/b]','')">Hexxx</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 481.4 (мудрец), 109thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.37'>Активность: 0.18<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=10168">Участник</a><br><font color=blue>Тот самый :)</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 ноября 2011 00:10 &middot; Поправил: Hexxx <br><script type="text/javascript">QU('Hexxx','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Hexxx" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19223&amp;page=0#16');return false;">#16</a> </span><div align=left><br>
я попросил способ остановить поток, а не найти способ как записать в стек другим образом.
<br><br><font size="1"><i>-----<br>Реверсивная инженерия - написание кода идентичного натуральному</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=294812&amp;user=10168&amp;forum_n=6&amp;topic=19223&amp;page=0&amp;anchor=16" class="addthx" data-post="294812"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]bowrouco[/b]','')">bowrouco</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 47.7 (посетитель), 17thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.01'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29629">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 ноября 2011 00:19 <br><script type="text/javascript">QU('bowrouco','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=bowrouco" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19223&amp;page=0#17');return false;">#17</a> </span><div align=left><br>
<b>Hexxx</b><br>Вы скажите что делает поток, что он делал до нужного вам места и куда вам нужно передать управление. Само собой понятно что в цикле опрашивать все треды это не решение.<br><br>&gt; способ остановить поток<br><br>Поток остановлен если он отложен(задача переключена), это временно, в это время его контекст доступен, это инициируется при исключениях, прерываниях. APC, DPC, IPI, BUGCHECK, MmAccessFault() etc. это второстепенные механизмы, можно инициировать их при необходимости. Стек потока доступен в любой момент времени, он выгружаемый, но этим ядро рулит и не значительно на низких IRQL.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=294817&amp;user=29629&amp;forum_n=6&amp;topic=19223&amp;page=0&amp;anchor=17" class="addthx" data-post="294817"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]Hexxx[/b]','')">Hexxx</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 481.4 (мудрец), 109thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.37'>Активность: 0.18<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=10168">Участник</a><br><font color=blue>Тот самый :)</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 ноября 2011 00:54 &middot; Поправил: Hexxx <br><script type="text/javascript">QU('Hexxx','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Hexxx" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19223&amp;page=0#18');return false;">#18</a> </span><div align=left><br>
В стеке хз-скольких потоков в системе есть адрес моего драйвера, из-за того что я юзаю один хитрый хук. Когда мне нужно выгрузиться, я не могу вечно ждать когда потоки вернутся. Поэтому я убираю свой адрес из стека, пробегаясь по всем потокам и исправляя их стек.  А чтобы никто вдруг случайно не дернулся и не перезаписал стек, который я правлю, я замораживаю всю систему.<br><br><I>bowrouco пишет:<br>можно инициировать их при необходимости </I><br>Пока слабо представляю как можно без последствий на скаку тормознуть отдельный поток <img src="img/smilies/s9.gif" alt=""><br><br>p.s. вы случаем не Clerk aka Indy? Потому что терминологию s-маршрутизация и w-маршрутизация, насколько я смог нагуглить, использует только он. Форсит мем <img src="img/smilies/s1.gif" alt=""> И да, мне эта технология походу не подойдет, мне не нужно получать управление через стек.
<br><br><font size="1"><i>-----<br>Реверсивная инженерия - написание кода идентичного натуральному</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=294823&amp;user=10168&amp;forum_n=6&amp;topic=19223&amp;page=0&amp;anchor=18" class="addthx" data-post="294823"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]bowrouco[/b]','')">bowrouco</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 47.7 (посетитель), 17thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.01'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29629">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 ноября 2011 01:18 <br><script type="text/javascript">QU('bowrouco','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=bowrouco" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19223&amp;page=0#19');return false;">#19</a> </span><div align=left><br>
<b>Hexxx</b><br><br>&gt; мне эта технология походу не подойдет, мне не нужно получать управление через стек. <br><br>Я уже понял по краткому описанию.<br><br>Не могу представить зачем такая манипуляция нужна, стаб в пуле не требует ресурсов. Тогда я бы поступил так - понизил IRQL до пассива, перечислил все потоки в системе(слепок ?), получил ссылку на обьект для каждого, извлёк ссылку на стек из обькта, просканил стек вниз для поиска ссылки там, либо извлёк её из SFC, выполнив бектрейс. Для этого не нужно останавливать ось. Но всёже поступать таким образом очень не тру, даже не годно. Пересмотрите механизм ваших &quot;хуков&quot;.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=294825&amp;user=29629&amp;forum_n=6&amp;topic=19223&amp;page=0&amp;anchor=19" class="addthx" data-post="294825"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="20" onfocus="this.blur()" href="JavaScript:di('[b]Hexxx[/b]','')">Hexxx</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 481.4 (мудрец), 109thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.37'>Активность: 0.18<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=10168">Участник</a><br><font color=blue>Тот самый :)</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 ноября 2011 12:56 &middot; Поправил: Hexxx <br><script type="text/javascript">QU('Hexxx','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Hexxx" target="_blank">Личное сообщение</a> &middot;  <a href="#20" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19223&amp;page=0#20');return false;">#20</a> </span><div align=left><br>
<I>bowrouco пишет:<br>просканил стек вниз для поиска ссылки там</I><br>на живом потоке? как?<br><br><I>bowrouco пишет:<br>Пересмотрите механизм ваших &quot;хуков&quot;. </I><br>пересматривал и не раз, не могу отказаться я от него...
<br><br><font size="1"><i>-----<br>Реверсивная инженерия - написание кода идентичного натуральному</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=294846&amp;user=10168&amp;forum_n=6&amp;topic=19223&amp;page=0&amp;anchor=20" class="addthx" data-post="294846"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="21" onfocus="this.blur()" href="JavaScript:di('[b]bowrouco[/b]','')">bowrouco</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 47.7 (посетитель), 17thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.01'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29629">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 ноября 2011 13:36 &middot; Поправил: bowrouco <br><script type="text/javascript">QU('bowrouco','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=bowrouco" target="_blank">Личное сообщение</a> &middot;  <a href="#21" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19223&amp;page=0#21');return false;">#21</a> </span><div align=left><br>
<b>Hexxx</b><br><br>&gt; на живом потоке? как?<br><br>Любой живой поток имеет стек. Стек такого потока в любой момент времени может быть двух типов обычный или процессорный(DPC-стек). Второй хардварный, например для обработки сисколов или доставки DPC. Стек описан в обьекте, это аллоцированный стек(там обычно т-фрейм лежит), текущие границы стека, в их пределах стек всегда валиден(хотя и может быть выгружен) и дно стека для шедулера(при переключении на другую задачу туда сохраняется текущий Esp). Также для рабочих потоков стек описан в TSS, он туда загружается шедулером. Единственная проблема может быть с теневыми колбеками - стек переключается, поэтому наверно придётся для таких потоков(gui) развернуть стек колбеков.<br><br>&gt; не могу отказаться я от него...<br>Что мешает использовать не выгружаемую память для стаба ?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=294847&amp;user=29629&amp;forum_n=6&amp;topic=19223&amp;page=0&amp;anchor=21" class="addthx" data-post="294847"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="22" onfocus="this.blur()" href="JavaScript:di('[b]Hexxx[/b]','')">Hexxx</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 481.4 (мудрец), 109thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.37'>Активность: 0.18<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=10168">Участник</a><br><font color=blue>Тот самый :)</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 ноября 2011 14:06 &middot; Поправил: Hexxx <br><script type="text/javascript">QU('Hexxx','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Hexxx" target="_blank">Личное сообщение</a> &middot;  <a href="#22" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19223&amp;page=0#22');return false;">#22</a> </span><div align=left><br>
Для меня проблема в том, что когда я сканирую стек потока, поток продолжает выполняться. Т.е. пока я досканирую стек, поток может уже там все перезаписать. И я или перезапишу стек параллельно с ним или вычитаю какую-то хрень. Нельзя заниматься чтением и записью пока потоки бегают. <br>Остальные описанные вещи, меня не напрягают.<br><br><I>bowrouco пишет:<br>Что мешает использовать не выгружаемую память для стаба ? </I><br>политика партии
<br><br><font size="1"><i>-----<br>Реверсивная инженерия - написание кода идентичного натуральному</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=294851&amp;user=10168&amp;forum_n=6&amp;topic=19223&amp;page=0&amp;anchor=22" class="addthx" data-post="294851"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="23" onfocus="this.blur()" href="JavaScript:di('[b]Vovan666[/b]','')">Vovan666</a></b><br></div>
<img src="img/s8.gif" alt=""><br><span class=txtSm>Ранг: 617.3 (<b>!</b>), 677thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.06'>Активность: 0.54<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=5291">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 ноября 2011 14:16 <br><script type="text/javascript">QU('Vovan666','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Vovan666" target="_blank">Личное сообщение</a> &middot;  <a href="#23" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19223&amp;page=0#23');return false;">#23</a> </span><div align=left><br>
У меня недавно была похожая проблема, тупо поставил бряк из TitanEngine и все.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=294852&amp;user=5291&amp;forum_n=6&amp;topic=19223&amp;page=0&amp;anchor=23" class="addthx" data-post="294852"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="24" onfocus="this.blur()" href="JavaScript:di('[b]bowrouco[/b]','')">bowrouco</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 47.7 (посетитель), 17thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.01'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29629">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 ноября 2011 14:26 <br><script type="text/javascript">QU('bowrouco','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=bowrouco" target="_blank">Личное сообщение</a> &middot;  <a href="#24" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19223&amp;page=0#24');return false;">#24</a> </span><div align=left><br>
<b>Hexxx</b><br>&gt;  Т.е. пока я досканирую стек, поток может уже там все перезаписать.<br>А разница, если не известно что в стеке. Там либо есть ваше значение, либо его нет и без разницы что поток остановлен.<br><br>&gt; политика партии<br>Ну да, наверно единственная причина <img src="img/smilies/s6.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=294854&amp;user=29629&amp;forum_n=6&amp;topic=19223&amp;page=0&amp;anchor=24" class="addthx" data-post="294854"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="25" onfocus="this.blur()" href="JavaScript:di('[b]Hexxx[/b]','')">Hexxx</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 481.4 (мудрец), 109thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.37'>Активность: 0.18<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=10168">Участник</a><br><font color=blue>Тот самый :)</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 ноября 2011 14:36 &middot; Поправил: Hexxx <br><script type="text/javascript">QU('Hexxx','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Hexxx" target="_blank">Личное сообщение</a> &middot;  <a href="#25" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19223&amp;page=0#25');return false;">#25</a> </span><div align=left><br>
<I>bowrouco пишет:<br>А разница, если не известно что в стеке. Там либо есть ваше значение, либо его нет и без разницы что поток остановлен. </I><br>т.е. чихать мы хотели на гонки потоков...<br><br><I>Vovan666 пишет:<br>тупо поставил бряк из TitanEngine и все. </I><br>Тупо в kernel mode? Интересно как... TitanEngine уже в ring-0 работает...
<br><br><font size="1"><i>-----<br>Реверсивная инженерия - написание кода идентичного натуральному</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=294855&amp;user=10168&amp;forum_n=6&amp;topic=19223&amp;page=0&amp;anchor=25" class="addthx" data-post="294855"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="26" onfocus="this.blur()" href="JavaScript:di('[b]bowrouco[/b]','')">bowrouco</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 47.7 (посетитель), 17thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.01'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29629">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 ноября 2011 14:43 &middot; Поправил: bowrouco <br><script type="text/javascript">QU('bowrouco','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=bowrouco" target="_blank">Личное сообщение</a> &middot;  <a href="#26" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19223&amp;page=0#26');return false;">#26</a> </span><div align=left><br>
<b>Hexxx</b><br>Имхо вам в ядро есчо рановато лезть).
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=294857&amp;user=29629&amp;forum_n=6&amp;topic=19223&amp;page=0&amp;anchor=26" class="addthx" data-post="294857"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="27" onfocus="this.blur()" href="JavaScript:di('[b]Hexxx[/b]','')">Hexxx</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 481.4 (мудрец), 109thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.37'>Активность: 0.18<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=10168">Участник</a><br><font color=blue>Тот самый :)</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 ноября 2011 14:50 &middot; Поправил: Hexxx <br><script type="text/javascript">QU('Hexxx','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Hexxx" target="_blank">Личное сообщение</a> &middot;  <a href="#27" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19223&amp;page=0#27');return false;">#27</a> </span><div align=left><br>
<I>bowrouco пишет:<br>Имхо вам в ядро есчо рановато лезть). </I><br><br>тро-ло-ло ло-ло-ло охо-хо-хо охо-хо-хо!<br><br>И все же интересно почему такое гиперобобщение на основе одного факта?
<br><br><font size="1"><i>-----<br>Реверсивная инженерия - написание кода идентичного натуральному</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=294859&amp;user=10168&amp;forum_n=6&amp;topic=19223&amp;page=0&amp;anchor=27" class="addthx" data-post="294859"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="28" onfocus="this.blur()" href="JavaScript:di('[b]bowrouco[/b]','')">bowrouco</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 47.7 (посетитель), 17thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.01'>Активность: 0.09<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=29629">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 ноября 2011 16:11 &middot; Поправил: bowrouco <br><script type="text/javascript">QU('bowrouco','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=bowrouco" target="_blank">Личное сообщение</a> &middot;  <a href="#28" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19223&amp;page=0#28');return false;">#28</a> </span><div align=left><br>
<b>Hexxx</b><br><br>&gt; почему такое гиперобобщение на основе одного факта?<br><br>Потому что эта задача нормально не решается. Причина в вашем кривом механизме, иначе не потребовалось бы такое делать. А раз вы не смогли механизм построить корректно, то следовательно и не разбираетесь вообще в оси, так как манипуляции с потоками по своей сути не отличаются в юзермоде и ядре. Вот получается что и обсуждать это смысла нет.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=294862&amp;user=29629&amp;forum_n=6&amp;topic=19223&amp;page=0&amp;anchor=28" class="addthx" data-post="294862"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="29" onfocus="this.blur()" href="JavaScript:di('[b]mak[/b]','')">mak</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/3520.jpg" alt=""><br><span class=txtSm>Ранг: 673.3 <font color=magenta>(<b>! !</b>)</font>, 400thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.48'>Активность: 0.4<span style='color:red'>&searr;</span>0.31</span><br>Статус: <a href="action=userinfo&amp;user=3520">Участник</a><br><font color=blue>CyberMonk</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 ноября 2011 16:40 <br><script type="text/javascript">QU('mak','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=mak" target="_blank">Личное сообщение</a> &middot;  <a href="#29" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19223&amp;page=0#29');return false;">#29</a> </span><div align=left><br>
Насколько мне известно Отложенная передача управления действительно очень гибкая, сам майкрософт писал это в доке, ресирч доки, нужно искать что то типо KiInsertDeferredReadyList по теме шедулинга, там меняли стэк как раз таким образом. <br><br><b>bowrouco</b> пример руткита есть какой-нибудь?
<br><br><font size="1"><i>-----<br>RE In Progress [!] Coding Hazard [!] Stay Clear of this Cube</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=294865&amp;user=3520&amp;forum_n=6&amp;topic=19223&amp;page=0&amp;anchor=29" class="addthx" data-post="294865"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=10168" title="07-11-2011 15:52, ранг:437.4" target="_blank">Hexxx</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="30" onfocus="this.blur()" href="JavaScript:di('[b]Hexxx[/b]','')">Hexxx</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 481.4 (мудрец), 109thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.37'>Активность: 0.18<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=10168">Участник</a><br><font color=blue>Тот самый :)</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 07 ноября 2011 20:53 <br><script type="text/javascript">QU('Hexxx','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Hexxx" target="_blank">Личное сообщение</a> &middot;  <a href="#30" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=19223&amp;page=0#30');return false;">#30</a> </span><div align=left><br>
<I>bowrouco пишет:<br>Потому что эта задача нормально не решается. Причина в вашем кривом механизме, иначе не потребовалось бы такое делать. А раз вы не смогли механизм построить корректно, то следовательно и не разбираетесь вообще в оси, так как манипуляции с потоками по своей сути не отличаются в юзермоде и ядре. Вот получается что и обсуждать это смысла нет. </I><br>Спасибо за диагноз док. А теперь моя очередь: по предложенной задаче вы сначала повели меня не туда куда надо, потом долго выясняли для чего мне это, хотя это было не важно, как я и изначально сказал, когда убедились, что я все-таки знаю чего хочу, не смогли предложить никакого решения, решили меня приравнять к ламеру. Хотелось блеснуть умом, а не вышло. <br>Т.е. вы скорее всего теоретически что-то знаете про ос, но на практике вы эдакий касперски.
<br><br><font size="1"><i>-----<br>Реверсивная инженерия - написание кода идентичного натуральному</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=294871&amp;user=10168&amp;forum_n=6&amp;topic=19223&amp;page=0&amp;anchor=30" class="addthx" data-post="294871"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=15381" title="07-11-2011 16:01, ранг:206.0" target="_blank">reversecode</a></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> .  <b>1</b> . <a href="action=vthread&amp;forum=6&amp;topic=19223&amp;page=1.html">2</a> . <a href="action=vthread&amp;forum=6&amp;topic=19223&amp;page=1.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Остановить Non-Alertable поток</span></td>
</tr></table>
</div>
<a name=newreply></a>
<div align=center>
<table class=forums>
<tr>
<td class=caption4 width="100%"><span class=header>Эта тема закрыта. Ответы больше не принимаются.</span></td>
</tr>
</table>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=19223" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
