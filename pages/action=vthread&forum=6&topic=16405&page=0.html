<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Windows I/o без Kernel32.dll и Advapi32.dll - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Добрый день. Необходимо в Windows XP SP3 распечатать в стандартный поток &quot;some text here&quot; без прямого или косвенного использования kernel32.dll и advapi32.dll (в иделе программа вообще с этими библиотеками слинкована">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=55995'>tyns777</a> (+4 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Windows I/o без Kernel32.dll и Advapi32.dll</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]coin[/b]','')">coin</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 3.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.06'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=25705">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 20 июня 2010 15:52 <br><script type="text/javascript">QU('coin','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=coin" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=16405.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Добрый день. <br>Необходимо в Windows XP SP3 распечатать в стандартный поток &quot;some text here&quot; без прямого или косвенного использования kernel32.dll и advapi32.dll (в иделе программа вообще с этими библиотеками слинкована быть не должна). В распоряжении С и ассемблер x86; Microsoft Visual Studio 2005 и MASM.<br><br>В чем проблема: я математик и программирование для меня всегда было инструментом для кодирования алгоритмов. Никогда не спускался по лестнице абстракции ниже. Вся проблема в том, что я слабо представляю, что значат наложенные ограничения и что я вообще могу использовать.<br><br>В чем сложность: сложно получить ответ от гугла, если в строке поиска указать &quot;bla bla bla без kernel32.dll&quot;. Получаешь непременно с &quot;kernel32.dll&quot;.<br><br>Почему пишу на этот форум:<br>[QUOTE=winasm]<br>You try to make a hello world example wihout kernel.lib?<br>If this correct if not allowed in this forum,this is virus-Technology[/QUOTE]<br><br>Насколько я вижу решение задачи - нужно обойти API используя native API, тоесть прямиком к ntdll.dll.<br>Проблема в том, что даже минимальное приложение на MASM32 у меня не получается собрать без kernel32.dll.<br><br>Я хотябы в правильную сторону смотрю?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=260686&amp;user=25705&amp;forum_n=6&amp;topic=16405.html&amp;page=0&amp;anchor=1" class="addthx" data-post="260686"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 20 июня 2010 16:57 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=16405.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
Плохо стараешься, если не получается без кернела собрать любое приложение. Юзай натив апи, линкуй с нтдлл да и всё, на асме вообще без проблем. Ну если на сях, немножко больше гемора, типа убирать рантайм ещё, свою точку входа определить.<br>И что подразумевается под стандартным потоком? Вывод в консоль? В файл? Вообще любой поток сишный?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=260698&amp;user=1556&amp;forum_n=6&amp;topic=16405.html&amp;page=0&amp;anchor=2" class="addthx" data-post="260698"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]s0l[/b]','')">s0l</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 60.6 (постоянный), 20thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.96'>Активность: 0.07<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=21841">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 20 июня 2010 22:46 &middot; Поправил: s0l <br><script type="text/javascript">QU('s0l','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=s0l" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=16405.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
а что мешает в гугле сделать запрос:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">бла<span class="hl_char">-</span>бла<span class="hl_char">-</span>бла&nbsp;<span class="hl_quote">&quot;без kernel32.dll&quot;</span></li>        </ol>
    </div>
</div></div>
<br>или<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">bla<span class="hl_char">-</span>bla<span class="hl_char">-</span>bla&nbsp;<span class="hl_quote">&quot;without kernel32.dll&quot;</span></li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=260718&amp;user=21841&amp;forum_n=6&amp;topic=16405.html&amp;page=0&amp;anchor=3" class="addthx" data-post="260718"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]coin[/b]','')">coin</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 3.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.06'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=25705">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 21 июня 2010 09:35 <br><script type="text/javascript">QU('coin','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=coin" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=16405.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
<I>Archer пишет:<br>Плохо стараешься, если не получается без кернела собрать любое приложение. Юзай натив апи, линкуй с нтдлл да и всё, на асме вообще без проблем.  </I> <br>Стало стыдно, спасибо. Уполз обратно в пещеру до появления умных вопросов.<br><br><I>Archer пишет:<br>И что подразумевается под стандартным потоком? Вывод в консоль? В файл? Вообще любой поток сишный? </I><br>Ну, вообще, хотелось бы, чтобы программа работала так:<br>при запуске ее C:\&gt;program она выводила на консоль<br>При запуске c:\&gt;program &gt; file она выводила в файл file<br>При запуске c:\&gt;program | more она выводила в трубу.<br>Но это уже потом.<br><br><I>s0l пишет:<br>а что мешает в гугле сделать запрос:<br>Code:<br>бла-бла-бла &quot;без kernel32.dll&quot;</I><br><br>А ты попробуй <img src="img/smilies/s1.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=260726&amp;user=25705&amp;forum_n=6&amp;topic=16405.html&amp;page=0&amp;anchor=4" class="addthx" data-post="260726"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 21 июня 2010 17:10 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=16405.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
Ну если надо фактически любой сишный поток, ну будет несколько больше порнографии с парсингом этого всего дела, но в принципе суть не меняется: выяснить, какие нужны натив апи (отревёрсить нужные функи до самого низа), писать софт на нативе и линковать с нтдлл.<br>Гугли, что такое натив апи, как его вызывать, как линковать, не вижу ничего такого, что гугл бы не дал.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=260739&amp;user=1556&amp;forum_n=6&amp;topic=16405.html&amp;page=0&amp;anchor=5" class="addthx" data-post="260739"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]BaGiE[/b]','')">BaGiE</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/1006.gif" alt=""><br><span class=txtSm>Ранг: 61.7 (постоянный)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.54'>Активность: 0.05<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1006">Участник</a><br><font color=blue>я</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 21 июня 2010 18:50 <br><script type="text/javascript">QU('BaGiE','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=BaGiE" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=16405.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
не знаю поможет или нет, но чтобы записать в консоль надо вызывать CsrClientCallServer с какими то параметрами там (не помню)
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=260745&amp;user=1006&amp;forum_n=6&amp;topic=16405.html&amp;page=0&amp;anchor=6" class="addthx" data-post="260745"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]coin[/b]','')">coin</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 3.0 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.06'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=25705">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 24 июня 2010 22:02 <br><script type="text/javascript">QU('coin','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=coin" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=16405.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
Всем принявшим участие спасибо!<br><br>Задачу решил <b>BaGiE</b>, за что ему честь и хвала!<br><br><img src="img/attach.gif" alt=""> <a href="./files/d626_24.06.2010_CRACKLAB.rU.tgz">d626_24.06.2010_CRACKLAB.rU.tgz</a> - HelloWorld.JPG
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=260988&amp;user=25705&amp;forum_n=6&amp;topic=16405.html&amp;page=0&amp;anchor=7" class="addthx" data-post="260988"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]cppasm[/b]','')">cppasm</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 251.3 (наставник), 81thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.77'>Активность: 0.14<span style='color:red'>&searr;</span>0.11</span><br>Статус: <a href="action=userinfo&amp;user=6859">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 июня 2010 13:10 <br><script type="text/javascript">QU('cppasm','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=cppasm" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=16405.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
Скриншот без вопросов очень ценный, но можно было бы хоть для приличия решение запостить.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=261011&amp;user=6859&amp;forum_n=6&amp;topic=16405.html&amp;page=0&amp;anchor=8" class="addthx" data-post="261011"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]BaGiE[/b]','')">BaGiE</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/1006.gif" alt=""><br><span class=txtSm>Ранг: 61.7 (постоянный)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.54'>Активность: 0.05<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1006">Участник</a><br><font color=blue>я</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 июня 2010 15:44 &middot; Поправил: BaGiE <br><script type="text/javascript">QU('BaGiE','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=BaGiE" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=16405.html&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
<b>cppasm</b><br>я такое решение автору предложил. тестировалось только на xpsp3.<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>format</b></span>&nbsp;PE&nbsp;Console&nbsp;<span class="hl_number">5</span><span class="hl_char">.</span><span class="hl_number">0</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_function"><b>include</b></span>&nbsp;<span class="hl_quote">'win32wx.inc'</span></li><li class="hl_l1"><span class="hl_function"><b>include</b></span>&nbsp;<span class="hl_quote">'encoding/win1251.inc'</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">struct&nbsp;CLIENT_ID</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UniqueProcess&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UniqueThread&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l0"><span class="hl_function">ends</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">struct&nbsp;PORT_MESSAGE</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Length&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZeroInit&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ClientId&nbsp;CLIENT_ID</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Unknown&nbsp;<span class="hl_function"><b>dq</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageId&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CallbackId&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l1"><span class="hl_function">ends</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">struct&nbsp;CSRSS_WRITE_CONSOLE_REQUEST</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Header&nbsp;PORT_MESSAGE</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Unknown&nbsp;<span class="hl_function"><b>dq</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ConsoleHandle&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StdHandle&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Buffer&nbsp;du&nbsp;<span class="hl_number">40</span>&nbsp;<span class="hl_function"><b>dup</b></span>&nbsp;<span class="hl_char">?</span>&nbsp;&nbsp;<span class="hl_comment">; 0x50 bytes max (40 WCHARs)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BufferAddress&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span>&nbsp;<span class="hl_comment">; ???</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BufferLength&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Unknown2&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UnknownFlag&nbsp;<span class="hl_function"><b>db</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IsUnicode&nbsp;<span class="hl_function"><b>db</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Unknown4&nbsp;<span class="hl_function"><b>db</b></span>&nbsp;<span class="hl_number">42</span>&nbsp;<span class="hl_function"><b>dup</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Unknown5&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Unknown6&nbsp;<span class="hl_function"><b>db</b></span>&nbsp;<span class="hl_number">116</span>&nbsp;<span class="hl_function"><b>dup</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l1"><span class="hl_function">ends</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_char">.</span><span class="hl_function">code</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>entry</b></span>&nbsp;Main</li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>proc</b></span>&nbsp;Main</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;locals</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Request&nbsp;CSRSS_WRITE_CONSOLE_REQUEST</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endl</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>xor</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lea</b></span>&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span><span class="hl_char">[</span>Request<span class="hl_char">]</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span><span class="hl_function">sizeof</span><span class="hl_char">.</span>CSRSS_WRITE_CONSOLE_REQUEST</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>rep</b></span>&nbsp;<span class="hl_function">stosb</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>xor</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_char">[</span><span class="hl_registr">fs</span><span class="hl_char">:</span><span class="hl_registr">eax</span><span class="hl_char">+</span>0x30<span class="hl_char">]</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_char">[</span><span class="hl_registr">eax</span><span class="hl_char">+</span>0x10<span class="hl_char">]</span>&nbsp;<span class="hl_comment">; RTL_USER_PROCESS_PARAMETERS</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span><span class="hl_char">[</span><span class="hl_registr">eax</span><span class="hl_char">+</span>0x10<span class="hl_char">]</span>&nbsp;<span class="hl_comment">; ProcessParameters.ConsoleHandle</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_char">[</span>Request<span class="hl_char">.</span>ConsoleHandle<span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_registr">edx</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span><span class="hl_char">[</span><span class="hl_registr">eax</span><span class="hl_char">+</span>0x1c<span class="hl_char">]</span>&nbsp;<span class="hl_comment">; ProcessParameters.StdOutputHandle</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_char">[</span>Request<span class="hl_char">.</span>StdHandle<span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_registr">edx</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_char">[</span>Request<span class="hl_char">.</span>UnknownFlag<span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_number">1</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_char">[</span>Request<span class="hl_char">.</span>IsUnicode<span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_number">1</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_char">[</span>Request<span class="hl_char">.</span>Unknown5<span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_char">-</span><span class="hl_number">1</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lea</b></span>&nbsp;<span class="hl_registr">esi</span><span class="hl_char">,</span><span class="hl_char">[</span>wstrMessage<span class="hl_char">]</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lea</b></span>&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span><span class="hl_char">[</span>Request<span class="hl_char">.</span>Buffer<span class="hl_char">]</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_char">[</span>Request<span class="hl_char">.</span>BufferAddress<span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_registr">edi</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_char">[</span>Request<span class="hl_char">.</span>BufferLength<span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_function">sizeof</span><span class="hl_char">.</span>wstrMessage</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span><span class="hl_function">sizeof</span><span class="hl_char">.</span>wstrMessage&nbsp;<span class="hl_function"><b>shr</b></span>&nbsp;<span class="hl_number">1</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>rep</b></span>&nbsp;<span class="hl_function">movsw</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;CsrClientCallServer<span class="hl_char">,</span><span class="hl_function"><b>addr</b></span>&nbsp;Request<span class="hl_char">,</span><span class="hl_function">NULL</span><span class="hl_char">,</span>0x0002021e<span class="hl_char">,</span>0x0000006c</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">ret</span></li><li class="hl_l1"><span class="hl_function">endp</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_char">.</span><span class="hl_function">data</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wstrMessage&nbsp;du&nbsp;<span class="hl_quote">'Hello, World!'</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">.</span>wstrMessage&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">$</span><span class="hl_char">-</span>wstrMessage</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>data</b></span>&nbsp;<span class="hl_function">import</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>library</b></span>&nbsp;ntdll<span class="hl_char">,</span><span class="hl_quote">'NTDLL.DLL'</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>import</b></span>&nbsp;ntdll<span class="hl_char">,</span><span class="hl_char">\</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CsrClientCallServer<span class="hl_char">,</span><span class="hl_quote">'CsrClientCallServer'</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>end</b></span>&nbsp;<span class="hl_function">data</span></li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=261017&amp;user=1006&amp;forum_n=6&amp;topic=16405.html&amp;page=0&amp;anchor=9" class="addthx" data-post="261017"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]BaGiE[/b]','')">BaGiE</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/1006.gif" alt=""><br><span class=txtSm>Ранг: 61.7 (постоянный)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.54'>Активность: 0.05<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1006">Участник</a><br><font color=blue>я</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 июня 2010 05:58 &middot; Поправил: BaGiE <br><script type="text/javascript">QU('BaGiE','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=BaGiE" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=16405.html&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
кому интересно то вот вариант без CsrClientCallServer и вообще без импортов к тому же на WinXP SP0 тоже заработало как и на SP3 и наверняка на SP1,SP2 робит<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>format</b></span>&nbsp;PE&nbsp;Console&nbsp;<span class="hl_number">5</span><span class="hl_char">.</span><span class="hl_number">0</span>&nbsp;on&nbsp;<span class="hl_quote">'empty.bin'</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_function"><b>include</b></span>&nbsp;<span class="hl_quote">'win32wxp.inc'</span></li><li class="hl_l1"><span class="hl_function"><b>include</b></span>&nbsp;<span class="hl_quote">'encoding/win1251.inc'</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">struct&nbsp;CLIENT_ID</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UniqueProcess&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UniqueThread&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l0"><span class="hl_function">ends</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">struct&nbsp;PORT_MESSAGE</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Length&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZeroInit&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ClientId&nbsp;CLIENT_ID</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Unknown&nbsp;<span class="hl_function"><b>dq</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageId&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CallbackId&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l1"><span class="hl_function">ends</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">struct&nbsp;CSRSS_WRITE_CONSOLE_REQUEST</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Header&nbsp;PORT_MESSAGE</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Unknown&nbsp;<span class="hl_function"><b>dq</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ConsoleHandle&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StdHandle&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Buffer&nbsp;du&nbsp;<span class="hl_number">40</span>&nbsp;<span class="hl_function"><b>dup</b></span>&nbsp;<span class="hl_char">?</span>&nbsp;&nbsp;<span class="hl_comment">; 0x50 bytes max (40 WCHARs)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BufferAddress&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BufferLength&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Unknown2&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UnknownFlag&nbsp;<span class="hl_function"><b>db</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IsUnicode&nbsp;<span class="hl_function"><b>db</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Unknown4&nbsp;<span class="hl_function"><b>db</b></span>&nbsp;<span class="hl_number">42</span>&nbsp;<span class="hl_function"><b>dup</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Unknown5&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Unknown6&nbsp;<span class="hl_function"><b>db</b></span>&nbsp;<span class="hl_number">116</span>&nbsp;<span class="hl_function"><b>dup</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l1"><span class="hl_function">ends</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>section</b></span>&nbsp;<span class="hl_quote">''</span>&nbsp;<span class="hl_function"><b>code</b></span>&nbsp;<span class="hl_function"><b>data</b></span>&nbsp;<span class="hl_function"><b>readable</b></span>&nbsp;<span class="hl_function">executable</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>entry</b></span>&nbsp;_main</li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>proc</b></span>&nbsp;_main</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>stdcall</b></span>&nbsp;_write<span class="hl_char">,</span>0x18<span class="hl_char">,</span>wstrMessage<span class="hl_char">,</span><span class="hl_function">sizeof</span><span class="hl_char">.</span>wstrMessage</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cmp</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>0xc0000008&nbsp;<span class="hl_comment">; handle not valid</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jne</b></span>&nbsp;@f</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>stdcall</b></span>&nbsp;_write<span class="hl_char">,</span>0x07ec<span class="hl_char">,</span>wstrMessage<span class="hl_char">,</span><span class="hl_function">sizeof</span><span class="hl_char">.</span>wstrMessage</li><li class="hl_l1">@@<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">ret</span></li><li class="hl_l0"><span class="hl_function">endp</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_function"><b>proc</b></span>&nbsp;_write&nbsp;<span class="hl_function"><b>uses</b></span>&nbsp;<span class="hl_registr"><b>esi</b></span>&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span>CsrPortHandle<span class="hl_char">:</span><span class="hl_function">DWORD</span><span class="hl_char">,</span>Buf<span class="hl_char">,</span>Length</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>local</b></span>&nbsp;Request<span class="hl_char">:</span>CSRSS_WRITE_CONSOLE_REQUEST</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>xor</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lea</b></span>&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span><span class="hl_char">[</span>Request<span class="hl_char">]</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span><span class="hl_function">sizeof</span><span class="hl_char">.</span>CSRSS_WRITE_CONSOLE_REQUEST</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>rep</b></span>&nbsp;<span class="hl_function">stosb</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>xor</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_char">[</span><span class="hl_registr">fs</span><span class="hl_char">:</span><span class="hl_registr">eax</span><span class="hl_char">+</span>0x30<span class="hl_char">]</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_char">[</span><span class="hl_registr">eax</span><span class="hl_char">+</span>0x10<span class="hl_char">]</span>&nbsp;<span class="hl_comment">; RTL_USER_PROCESS_PARAMETERS</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span><span class="hl_char">[</span><span class="hl_registr">eax</span><span class="hl_char">+</span>0x10<span class="hl_char">]</span>&nbsp;<span class="hl_comment">; ProcessParameters.ConsoleHandle</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_char">[</span>Request<span class="hl_char">.</span>ConsoleHandle<span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_registr">edx</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span><span class="hl_char">[</span><span class="hl_registr">eax</span><span class="hl_char">+</span>0x1c<span class="hl_char">]</span>&nbsp;<span class="hl_comment">; ProcessParameters.StdOutputHandle</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_char">[</span>Request<span class="hl_char">.</span>StdHandle<span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_registr">edx</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_char">[</span>Request<span class="hl_char">.</span>UnknownFlag<span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_number">1</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_char">[</span>Request<span class="hl_char">.</span>IsUnicode<span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_number">1</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">esi</span><span class="hl_char">,</span><span class="hl_char">[</span>Buf<span class="hl_char">]</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lea</b></span>&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span><span class="hl_char">[</span>Request<span class="hl_char">.</span>Buffer<span class="hl_char">]</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span><span class="hl_char">[</span>Length<span class="hl_char">]</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_char">[</span>Request<span class="hl_char">.</span>BufferLength<span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_registr">ecx</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>shr</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span><span class="hl_number">1</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>rep</b></span>&nbsp;<span class="hl_function">movsw</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_char">[</span>Request<span class="hl_char">.</span>Header<span class="hl_char">.</span>Length<span class="hl_char">]</span><span class="hl_char">,</span>0x0098007c</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_char">[</span>Request<span class="hl_char">.</span>Header<span class="hl_char">.</span>CallbackId<span class="hl_char">]</span><span class="hl_char">,</span>0x0002021e</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lea</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span><span class="hl_char">[</span>Request<span class="hl_char">]</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;<span class="hl_registr"><b>edx</b></span>&nbsp;<span class="hl_registr"><b>edx</b></span>&nbsp;<span class="hl_char">[</span>CsrPortHandle<span class="hl_char">]</span>&nbsp;@f</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>0xc8</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>lea</b></span>&nbsp;<span class="hl_registr">edx</span><span class="hl_char">,</span><span class="hl_char">[</span><span class="hl_registr">esp</span><span class="hl_char">+</span><span class="hl_number">4</span><span class="hl_char">]</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>int</b></span>&nbsp;0x2e</li><li class="hl_l0">@@<span class="hl_char">:</span>&nbsp;&nbsp;<span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">esp</span><span class="hl_char">,</span><span class="hl_number">16</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">ret</span></li><li class="hl_l1"><span class="hl_function">endp</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wstrMessage&nbsp;du&nbsp;<span class="hl_quote">'I '</span><span class="hl_char">,</span>0x2665<span class="hl_char">,</span><span class="hl_quote">' FASM : )'</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">.</span>wstrMessage&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">$</span><span class="hl_char">-</span>wstrMessage</li><li class="hl_l1">&nbsp;</li>        </ol>
    </div>
</div></div>
<br><br>//походу еще и баг нашелся на форуме. в {ASM}{/ASM} смайлы пытается тоже подменять на картинки. там в коде в строке смайл <b>du &#039;: )&#039;</b> выглядит как
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">du&nbsp;<span class="hl_quote">'&lt;img src=&quot;http://exelab.ruimg/smilies/s1.gif&quot; border=&quot;0&quot; align=&quot;&quot; alt=&quot;&quot;&gt;'</span></li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=261039&amp;user=1006&amp;forum_n=6&amp;topic=16405.html&amp;page=0&amp;anchor=10" class="addthx" data-post="261039"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]Clerk[/b]','')">Clerk</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 255.8 (наставник), 19thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.86'>Активность: 0.15<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=17964">Участник</a><br><font color=blue>vx</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 июня 2010 12:03 <br><script type="text/javascript">QU('Clerk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Clerk" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=16405.html&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
<noindex><a href="http://wasm.ru/forum/viewtopic.php?id=37637&amp;p=1" rel="nofollow" target="_blank">http://wasm.ru/forum/viewtopic.php?id=37637&amp;p=1</a></noindex><br><noindex><a href="http://wasm.ru/forum/viewtopic.php?pid=383519#p383519" rel="nofollow" target="_blank">http://wasm.ru/forum/viewtopic.php?pid=383519#p383519</a></noindex>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=261045&amp;user=17964&amp;forum_n=6&amp;topic=16405.html&amp;page=0&amp;anchor=11" class="addthx" data-post="261045"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 222thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 июня 2010 14:23 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=16405.html&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
<b>BaGiE</b><br>Раз XP, то можно sysenter вместо int 2E, быстрее будет.
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=261047&amp;user=24257&amp;forum_n=6&amp;topic=16405.html&amp;page=0&amp;anchor=12" class="addthx" data-post="261047"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]Clerk[/b]','')">Clerk</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 255.8 (наставник), 19thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.86'>Активность: 0.15<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=17964">Участник</a><br><font color=blue>vx</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 июня 2010 16:33 <br><script type="text/javascript">QU('Clerk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Clerk" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=16405.html&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
<b>DenCoder</b><br>Шлюзы напрямую юзаются очень редко. Быдло их использовать не может изза проблем с совместимостью.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=261051&amp;user=17964&amp;forum_n=6&amp;topic=16405.html&amp;page=0&amp;anchor=13" class="addthx" data-post="261051"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]BaGiE[/b]','')">BaGiE</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/1006.gif" alt=""><br><span class=txtSm>Ранг: 61.7 (постоянный)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.54'>Активность: 0.05<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1006">Участник</a><br><font color=blue>я</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 июня 2010 06:11 &middot; Поправил: BaGiE <br><script type="text/javascript">QU('BaGiE','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=BaGiE" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=16405.html&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
<b>Clerk</b><br>да, спасибо, но изначально смотрелось только для xp, а в других виндах, видимо, формат и структуры LPC-сообщений другие. на 64-битных виндах читал еще какая-то особенность с LPC есть. а переносить код с WriteConsoleA(W) автор не разрешает к тому же в требованиях именно xp (вопрос совместимости не стоит) и коду поменьше.<br>кстати, может знаете где почитать я не в курсе почему если приложение запускаем непосредственно CsrPortHandle==&#036;18, а если через cmd.exe, например, то &#036;7ec<br>; кстати, разобрался почему. ключевое слово <u>bInheritHandles</u><br><br><b>DenCoder</b><br>да, тут лучше так. вариации по сабжу)
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=261071&amp;user=1006&amp;forum_n=6&amp;topic=16405.html&amp;page=0&amp;anchor=14" class="addthx" data-post="261071"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]Clerk[/b]','')">Clerk</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 255.8 (наставник), 19thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.86'>Активность: 0.15<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=17964">Участник</a><br><font color=blue>vx</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 14 июля 2010 17:46 &middot; Поправил: Clerk <br><script type="text/javascript">QU('Clerk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Clerk" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=16405.html&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
<b>DenCoder</b><br>Зависит от TF. Если выполнен фасткал с взведённым TF, то скорость исполнения падает в 1.48 раза(по сравнению с Int 0x2e). Trap.asm, 1083:<br>&gt; ; This is NOT a performance path.<br>&gt;       PUBLIC _KiFastCallEntry2<br>Иногда это важно.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=261789&amp;user=17964&amp;forum_n=6&amp;topic=16405.html&amp;page=0&amp;anchor=15" class="addthx" data-post="261789"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 222thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 14 июля 2010 21:08 <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=16405.html&amp;page=0#16');return false;">#16</a> </span><div align=left><br>
О, как раз сейчас смотрю KiSystemService, KiFastCallEntry и KiFastCallEntry2. KiFastCallEntry2 отличается от KiFastCallEntry тем, что в нем взводится TF перед джампом на общий фрагмент. Вот вопрос: при каких условиях вызывается KiFastCallEntry2 вместо 1-ой?
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=261795&amp;user=24257&amp;forum_n=6&amp;topic=16405.html&amp;page=0&amp;anchor=16" class="addthx" data-post="261795"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]Clerk[/b]','')">Clerk</a></b><br></div>
<img src="img/s6.gif" alt=""><br><span class=txtSm>Ранг: 255.8 (наставник), 19thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.86'>Активность: 0.15<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=17964">Участник</a><br><font color=blue>vx</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 14 июля 2010 22:06 <br><script type="text/javascript">QU('Clerk','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Clerk" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=16405.html&amp;page=0#17');return false;">#17</a> </span><div align=left><br>
<b>DenCoder</b><br>Сказал ведь что взведён TF. Инструкция Sysenter не маскирует этот флаг, изза чего генерится #DB после смены кпл. ISR #DB проверяет адрес останова и если он равен KiFastCallEntry(), то трап откатывается - управление передаётся на KiFastCallEntry2(), она формирует часть трап-фрейма для поправки флагов, взводит TF, так как при возврате в юзермод он должен быть взведён и продолжает исполнение нормальным путём.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=261796&amp;user=17964&amp;forum_n=6&amp;topic=16405.html&amp;page=0&amp;anchor=17" class="addthx" data-post="261796"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 222thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 14 июля 2010 22:14 <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=16405.html&amp;page=0#18');return false;">#18</a> </span><div align=left><br>
Ага, точно, нашел. Спасибо!
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=261797&amp;user=24257&amp;forum_n=6&amp;topic=16405.html&amp;page=0&amp;anchor=18" class="addthx" data-post="261797"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]Coderess[/b]','')">Coderess</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/16383.jpg" alt=""><br><span class=txtSm>Ранг: 355.4 (мудрец), 55thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.21'>Активность: 0.32<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=16383">Uploader</a><br><font color=blue>5KRT</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 14 июля 2010 22:44 &middot; Поправил: <a href="action=stats#mods">Модератор</a> <br><script type="text/javascript">QU('Coderess','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Coderess" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=16405.html&amp;page=0#19');return false;">#19</a> </span><div align=left><br>
<b><font color="red">От модератора: Если читающий не знает что такое кпл, то ему не форум надо читать...</font></b><br><br>P.S. Для личных вопросов НЕ модератору есть Личные сообщения. В следующий раз бан для профилактики.
<br><br><font size="1"><i>-----<br>Gutta cavat lapidem. Feci, quod potui. Faciant meliora potentes</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=261801&amp;user=16383&amp;forum_n=6&amp;topic=16405.html&amp;page=0&amp;anchor=19" class="addthx" data-post="261801"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="20" onfocus="this.blur()" href="JavaScript:di('[b]Coderess[/b]','')">Coderess</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/16383.jpg" alt=""><br><span class=txtSm>Ранг: 355.4 (мудрец), 55thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.21'>Активность: 0.32<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=16383">Uploader</a><br><font color=blue>5KRT</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 16 июля 2010 17:20 <br><script type="text/javascript">QU('Coderess','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Coderess" target="_blank">Личное сообщение</a> &middot;  <a href="#20" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=16405.html&amp;page=0#20');return false;">#20</a> </span><div align=left><br>
Мой пост можно было и оставить <img src="img/smilies/s16.gif" alt="">
<br><br><font size="1"><i>-----<br>Gutta cavat lapidem. Feci, quod potui. Faciant meliora potentes</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=261890&amp;user=16383&amp;forum_n=6&amp;topic=16405.html&amp;page=0&amp;anchor=20" class="addthx" data-post="261890"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Windows I/o без Kernel32.dll и Advapi32.dll</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#21" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="6">
<input type="hidden" name="topic" value="16405">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=16405" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
