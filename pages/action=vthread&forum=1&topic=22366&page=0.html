<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Обработка исключения на Windows Server 2008 - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Разбираюсь с программой версии bCAD 3.10 http://www.propro.ru/ru/Downloads/Install.aspx Проблема следующая: программа отлично работает в Windows 7, но не работает на Windows Server Начал разбираться почему. Оказывается Windows 7">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=1533'>rmn</a> (+9 невидимых)</b></span>
</td>
</tr>
</table>

 

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/green.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=1&sortBy=0&page=0.html"><b>Основной форум</b></a> <b class=bulletHead>&#8212;&#8250;</b> Обработка исключения на Windows Server 2008</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]Maximus[/b]','')">Maximus</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/2775.jpg" alt=""><br><span class=txtSm>Ранг: 392.8 (мудрец), 108thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.75'>Активность: 0.26<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=2775">Участник</a><br><font color=blue>REVENGE сила, БеХоЦе могила</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 ноября 2013 16:46 <br><script type="text/javascript">QU('Maximus','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Maximus" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=22366.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Разбираюсь с программой версии bCAD 3.10<br>http://www.propro.ru/ru/Downloads/Install.aspx<br><br>Проблема следующая: программа отлично работает в Windows 7, но не работает на Windows Server<br><br>Начал разбираться почему. Оказывается Windows 7 и Windows Server по разному отрабатывают вот такой код:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_number">7C424136</span>&nbsp;&nbsp;<span class="hl_number">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;<span class="hl_registr"><b>EAX</b></span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; Arguments =&gt; OFFSET LOCAL.1</span></li><li class="hl_l1"><span class="hl_number">7C424137</span>&nbsp;&nbsp;<span class="hl_number">6A</span>&nbsp;<span class="hl_number">01</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;<span class="hl_number">1</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; ArgCount = 1</span></li><li class="hl_l0"><span class="hl_number">7C424139</span>&nbsp;&nbsp;<span class="hl_number">6A</span>&nbsp;<span class="hl_number">00</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;<span class="hl_number">0</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; Flags = EXCEPTION_CONTINUABLE</span></li><li class="hl_l1"><span class="hl_number">7C42413B</span>&nbsp;&nbsp;<span class="hl_number">68</span>&nbsp;<span class="hl_number">78563402</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>PUSH</b></span>&nbsp;<span class="hl_number">2345678</span><span style="word-break: break-all">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hl_comment">; Code = 2345678</span></li><li class="hl_l0"><span class="hl_number">7C424140</span>&nbsp;&nbsp;FF15&nbsp;<span class="hl_number">0C10407C</span>&nbsp;&nbsp;<span class="hl_function"><b>CALL</b></span>&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_function"><b>PTR</b></span>&nbsp;<span class="hl_registr">DS</span><span class="hl_char">:</span><span class="hl_char">[</span><span class="hl_char">&lt;</span><span class="hl_char">&amp;</span>KERNEL32<span class="hl_char">.</span>RaiseException<span class="hl_char">&gt;</span><span class="hl_char">]</span>&nbsp;&nbsp;&nbsp;<span class="hl_comment">; KERNEL32.RaiseException</span></li>        </ol>
    </div>
</div></div>
<br><br>Если Windows 7 осталвяет это исключение в себе, то на серверной версии оси вылетает окошко:<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">Сигнатура&nbsp;проблемы<span class="hl_char">:</span></li><li class="hl_l1">&nbsp;&nbsp;Имя&nbsp;события&nbsp;проблемы<span class="hl_char">:</span>&nbsp;&nbsp;&nbsp;&nbsp;APPCRASH</li><li class="hl_l0">&nbsp;&nbsp;Имя&nbsp;приложения<span class="hl_char">:</span>&nbsp;bcjsrv<span class="hl_char">.</span>exe</li><li class="hl_l1">&nbsp;&nbsp;Версия&nbsp;приложения<span class="hl_char">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">3</span><span class="hl_char">.</span><span class="hl_number">10</span><span class="hl_char">.</span><span class="hl_number">1</span><span class="hl_char">.</span><span class="hl_number">1168</span></li><li class="hl_l0">&nbsp;&nbsp;Отметка&nbsp;времени&nbsp;приложения<span class="hl_char">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">4c8f0b1a</span></li><li class="hl_l1">&nbsp;&nbsp;Имя&nbsp;модуля&nbsp;с&nbsp;ошибкой<span class="hl_char">:</span>&nbsp;&nbsp;&nbsp;&nbsp;KERNELBASE<span class="hl_char">.</span>dll</li><li class="hl_l0">&nbsp;&nbsp;Версия&nbsp;модуля&nbsp;с&nbsp;ошибкой<span class="hl_char">:</span>&nbsp;<span class="hl_number">6</span><span class="hl_char">.</span><span class="hl_number">1</span><span class="hl_char">.</span><span class="hl_number">7601</span><span class="hl_char">.</span><span class="hl_number">18229</span></li><li class="hl_l1">&nbsp;&nbsp;Отметка&nbsp;времени&nbsp;модуля&nbsp;с&nbsp;ошибкой<span class="hl_char">:</span>&nbsp;<span class="hl_number">51fb1116</span></li><li class="hl_l0">&nbsp;&nbsp;Код&nbsp;исключения<span class="hl_char">:</span>&nbsp;<span class="hl_number">02345678</span></li><li class="hl_l1">&nbsp;&nbsp;Смещение&nbsp;исключения<span class="hl_char">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">0000c41f</span></li><li class="hl_l0">&nbsp;&nbsp;Версия&nbsp;ОС<span class="hl_char">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">6</span><span class="hl_char">.</span><span class="hl_number">1</span><span class="hl_char">.</span><span class="hl_number">7601</span><span class="hl_char">.</span><span class="hl_number">2</span><span class="hl_char">.</span><span class="hl_number">1</span><span class="hl_char">.</span><span class="hl_number">0</span><span class="hl_char">.</span><span class="hl_number">272</span><span class="hl_char">.</span><span class="hl_number">7</span></li><li class="hl_l1">&nbsp;&nbsp;Код&nbsp;языка<span class="hl_char">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">1049</span></li><li class="hl_l0">&nbsp;&nbsp;Дополнительные&nbsp;сведения&nbsp;<span class="hl_number">1</span><span class="hl_char">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bb0e</li><li class="hl_l1">&nbsp;&nbsp;Дополнительные&nbsp;сведения&nbsp;<span class="hl_number">2</span><span class="hl_char">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bb0efd916a17e3c0bf7af55e87d1fe92</li><li class="hl_l0">&nbsp;&nbsp;Дополнительные&nbsp;сведения&nbsp;<span class="hl_number">3</span><span class="hl_char">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">29a0</span></li><li class="hl_l1">&nbsp;&nbsp;Дополнительные&nbsp;сведения&nbsp;<span class="hl_number">4</span><span class="hl_char">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">29a0f0d23e28c6706a266b5d242f2020</span></li>        </ol>
    </div>
</div></div>
<br><br>Причем под Олькой это окошко не появляется. Проблема возникает только тогда, когда я работаю с программой в обычном режиме, не под отладкой.<br><br>Вопрос: Как мне заставить Windows Server обработать исключение по тихиму?<br>Можно ли как-то переловить и обработать это исключение своим встроенным кодом?
<br><br><font size="1"><i>-----<br>StarForce и Themida ацтой!</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=334414&amp;user=2775&amp;forum_n=1&amp;topic=22366.html&amp;page=0&amp;anchor=1" class="addthx" data-post="334414"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]Dr0p[/b]','')">Dr0p</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33727.png" alt=""><br><span class=txtSm>Ранг: 72.3 (постоянный), 133thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.5'>Активность: 0.38<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33727">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 ноября 2013 17:47 <br><script type="text/javascript">QU('Dr0p','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Dr0p" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=22366.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
Можно, обычный фолт. VEH ставите и ловите его. Ну а если фолт возникает, значит где то что то пошло не так как надо. Надо лечить болезнь, а не устранять симптомы <img src="img/smilies/s8.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=334421&amp;user=33727&amp;forum_n=1&amp;topic=22366.html&amp;page=0&amp;anchor=2" class="addthx" data-post="334421"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=8830" title="27-11-2013 13:54, ранг:184.0" target="_blank">ajax</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]Maximus[/b]','')">Maximus</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/2775.jpg" alt=""><br><span class=txtSm>Ранг: 392.8 (мудрец), 108thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.75'>Активность: 0.26<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=2775">Участник</a><br><font color=blue>REVENGE сила, БеХоЦе могила</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 ноября 2013 17:54 <br><script type="text/javascript">QU('Maximus','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Maximus" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=22366.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
Лечить симптомы должны разработчики приложения, которые имеют исходники, а не я ;)<br><br>&gt;Можно, обычный фолт. VEH ставите и ловите его.<br><br>Где и как его ставить? Можно с примерами?
<br><br><font size="1"><i>-----<br>StarForce и Themida ацтой!</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=334425&amp;user=2775&amp;forum_n=1&amp;topic=22366.html&amp;page=0&amp;anchor=3" class="addthx" data-post="334425"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]Dr0p[/b]','')">Dr0p</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33727.png" alt=""><br><span class=txtSm>Ранг: 72.3 (постоянный), 133thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.5'>Активность: 0.38<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33727">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 ноября 2013 17:57 <br><script type="text/javascript">QU('Dr0p','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Dr0p" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=22366.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
<noindex><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms681420(v=vs.85).aspx" rel="nofollow" target="_blank">--&gt; Link &lt;--</a></noindex>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=334427&amp;user=33727&amp;forum_n=1&amp;topic=22366.html&amp;page=0&amp;anchor=4" class="addthx" data-post="334427"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=2775" title="27-11-2013 16:06, ранг:364.0" target="_blank">Maximus</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]Maximus[/b]','')">Maximus</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/2775.jpg" alt=""><br><span class=txtSm>Ранг: 392.8 (мудрец), 108thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.75'>Активность: 0.26<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=2775">Участник</a><br><font color=blue>REVENGE сила, БеХоЦе могила</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 ноября 2013 18:02 &middot; Поправил: Maximus <br><script type="text/javascript">QU('Maximus','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Maximus" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=22366.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
Какой из VEH мне нужен (continue,  exception)?<br><br>Сработает ли фильтр если я буду его устанавливать через dll, внедренную в адресное пространство программы?<br><br>Что должна возращать моя процедура, чтобы программа не крашилась?
<br><br><font size="1"><i>-----<br>StarForce и Themida ацтой!</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=334430&amp;user=2775&amp;forum_n=1&amp;topic=22366.html&amp;page=0&amp;anchor=5" class="addthx" data-post="334430"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]ajax[/b]','')">ajax</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/8830.gif" alt=""><br><span class=txtSm>Ранг: 337.6 (мудрец), 224thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.53'>Активность: 0.21<span style='color:red'>&searr;</span>0.1</span><br>Статус: <a href="action=userinfo&amp;user=8830">Участник</a><br><font color=blue>born to be evil</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 ноября 2013 18:28 &middot; Поправил: ajax <br><script type="text/javascript">QU('ajax','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ajax" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=22366.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
<b>Maximus</b><br>1. exception<br>2. должен<br>3. EXCEPTION_CONTINUE_EXECUTION<br>типа этого из и-нета. свои сырки сейчас не могу найти<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">unit&nbsp;profs_win32exceptiontrap<span class="hl_comment">;</span></li><li class="hl_l1">{<span class="hl_char">$</span>mode&nbsp;objfpc}</li><li class="hl_l0">interface</li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;increase&nbsp;the&nbsp;reference&nbsp;count&nbsp;<span class="hl_char">(</span>install&nbsp;the&nbsp;handler&nbsp;it&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;it&nbsp;was&nbsp;zero<span class="hl_char">)</span></li><li class="hl_l1">procedure&nbsp;AddHandler<span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;decrease&nbsp;the&nbsp;reference&nbsp;count&nbsp;<span class="hl_function"><b>and</b></span>&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;reaching&nbsp;zero&nbsp;remove&nbsp;the&nbsp;handler</li><li class="hl_l1">procedure&nbsp;RemoveHandler<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">implementation</li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_function">uses</span></li><li class="hl_l0">&nbsp;&nbsp;Windows<span class="hl_char">,</span>&nbsp;SysUtils<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">var</li><li class="hl_l1">&nbsp;&nbsp;ExceptionHandlerRefCount<span class="hl_char">:</span>&nbsp;Integer&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;ExHandle<span class="hl_char">:</span>&nbsp;Pointer<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;ThisModuleHandle<span class="hl_char">:</span>&nbsp;THandle<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;ThisModuleName<span class="hl_char">:</span>&nbsp;AnsiString<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">threadvar</li><li class="hl_l1">&nbsp;&nbsp;ExObject&nbsp;<span class="hl_char">:</span>&nbsp;EExternal<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">function&nbsp;AddVectoredExceptionHandler<span class="hl_char">(</span>FirstHandler<span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>DWORD</b></span><span class="hl_comment">; VectoredHandler: pointer): pointer; stdcall; external 'kernel32.dll' name 'AddVectoredExceptionHandler';</span></li><li class="hl_l0">function&nbsp;RemoveVectoredExceptionHandler<span class="hl_char">(</span>VectoredHandlerHandle<span class="hl_char">:</span>&nbsp;pointer<span class="hl_char">)</span><span class="hl_char">:</span>&nbsp;ULONG<span class="hl_comment">; stdcall; external 'kernel32.dll' name 'RemoveVectoredExceptionHandler';</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">function&nbsp;GetModuleByAddr<span class="hl_char">(</span><span class="hl_function">addr</span><span class="hl_char">:</span>&nbsp;pointer<span class="hl_char">)</span><span class="hl_char">:</span>&nbsp;THandle<span class="hl_comment">;</span></li><li class="hl_l1">var</li><li class="hl_l0">&nbsp;&nbsp;Tmm<span class="hl_char">:</span>&nbsp;TMemoryBasicInformation<span class="hl_comment">;</span></li><li class="hl_l1">begin</li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;VirtualQuery<span class="hl_char">(</span><span class="hl_function">addr</span><span class="hl_char">,</span>&nbsp;@Tmm<span class="hl_char">,</span>&nbsp;<span class="hl_function">SizeOf</span><span class="hl_char">(</span>Tmm<span class="hl_char">)</span><span class="hl_char">)</span>&nbsp;<span class="hl_char">&lt;</span><span class="hl_char">&gt;</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>Tmm<span class="hl_char">)</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;then&nbsp;Result&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;{<span class="hl_char">$</span>hints&nbsp;off}</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>else</b></span>&nbsp;Result&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;THandle<span class="hl_char">(</span>Tmm<span class="hl_char">.</span>AllocationBase<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;{<span class="hl_char">$</span>hints&nbsp;on}</li><li class="hl_l1"><span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">function&nbsp;ExceptionHandler<span class="hl_char">(</span>Info<span class="hl_char">:</span>&nbsp;PEXCEPTION_POINTERS<span class="hl_char">)</span><span class="hl_char">:</span>&nbsp;LongInt<span class="hl_comment">; stdcall;</span></li><li class="hl_l0">var</li><li class="hl_l1">&nbsp;&nbsp;ExCode&nbsp;<span class="hl_char">:</span>&nbsp;<span class="hl_function"><b>DWORD</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;ExAddr&nbsp;<span class="hl_char">:</span>&nbsp;Pointer<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;ExModule&nbsp;<span class="hl_char">:</span>&nbsp;THandle<span class="hl_comment">;</span></li><li class="hl_l0">label</li><li class="hl_l1">&nbsp;&nbsp;lblRaise<span class="hl_comment">;</span></li><li class="hl_l0">begin</li><li class="hl_l1">&nbsp;&nbsp;ExCode&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;Info^<span class="hl_char">.</span>ExceptionRecord^<span class="hl_char">.</span>ExceptionCode<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;ExCode&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">$</span><span class="hl_number">40010006</span>&nbsp;then&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;ignore&nbsp;debug&nbsp;print</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;exit<span class="hl_char">(</span>EXCEPTION_CONTINUE_SEARCH<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;ExAddr&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;Info^<span class="hl_char">.</span>ExceptionRecord^<span class="hl_char">.</span>ExceptionAddress<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;ExModule&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;GetModuleByAddr<span class="hl_char">(</span>ExAddr<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;did&nbsp;it&nbsp;happen&nbsp;<span class="hl_function"><b>in</b></span>&nbsp;the&nbsp;same&nbsp;module&nbsp;where&nbsp;<span class="hl_function"><b>this</b></span>&nbsp;handler&nbsp;resides<span class="hl_char">?</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;ExModule&nbsp;<span class="hl_char">=</span>&nbsp;ThisModuleHandle&nbsp;then&nbsp;begin</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;after&nbsp;preparing&nbsp;a&nbsp;native&nbsp;FPC&nbsp;exception&nbsp;object&nbsp;we&nbsp;will&nbsp;clear&nbsp;the</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;Windows&nbsp;exception&nbsp;<span class="hl_function"><b>and</b></span>&nbsp;manipulate&nbsp;the&nbsp;CPU&nbsp;instruction&nbsp;pointer&nbsp;to&nbsp;point</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span><span style="word-break: break-all">&nbsp;exactly&nbsp;to&nbsp;the&nbsp;place&nbsp;where&nbsp;it&nbsp;will&nbsp;be&nbsp;raised&nbsp;with&nbsp;raise&nbsp;so&nbsp;it&nbsp;can</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;then&nbsp;be&nbsp;properly&nbsp;caught&nbsp;by&nbsp;<span class="hl_function">except</span><span class="hl_char">.</span>&nbsp;We&nbsp;can't just raise it directly</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;from&nbsp;here&nbsp;because&nbsp;we&nbsp;are&nbsp;inside&nbsp;the&nbsp;Windows&nbsp;exception&nbsp;handler&nbsp;<span class="hl_function">and</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;windows&nbsp;expects&nbsp;<span class="hl_function"><b>this</b></span>&nbsp;function&nbsp;to&nbsp;return&nbsp;<span class="hl_function"><b>and</b></span>&nbsp;for&nbsp;Windows&nbsp;the&nbsp;exception</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;is&nbsp;already&nbsp;finished&nbsp;when&nbsp;our&nbsp;FPC&nbsp;<span class="hl_function">try</span><span class="hl_char">/</span>raise<span class="hl_char">/</span><span class="hl_function"><b>except</b></span>&nbsp;mechanism&nbsp;starts<span class="hl_char">.</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;ExObject&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;EExternal<span class="hl_char">.</span>Create<span class="hl_char">(</span><span class="hl_function">Format</span><span class="hl_char">(</span><span class="hl_quote">'Exception %x at %p'</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span>ExCode<span class="hl_char">,</span>&nbsp;ExAddr<span class="hl_char">]</span><span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;{<span class="hl_char">$</span>hints&nbsp;off}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;Info^<span class="hl_char">.</span>ContextRecord^<span class="hl_char">.</span>Eip&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;PtrUInt<span class="hl_char">(</span>@lblRaise<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;{<span class="hl_char">$</span>hints&nbsp;on}</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;exit<span class="hl_char">(</span>EXCEPTION_CONTINUE_EXECUTION<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>end</b></span>&nbsp;<span class="hl_function"><b>else</b></span>&nbsp;begin</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;<span class="hl_function"><b>this</b></span>&nbsp;exception&nbsp;happened&nbsp;somewhere&nbsp;<span class="hl_function">else</span><span class="hl_char">,</span>&nbsp;we&nbsp;might&nbsp;<span class="hl_function"><b>not</b></span>&nbsp;be&nbsp;able&nbsp;to&nbsp;handle&nbsp;it<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span><span style="word-break: break-all">&nbsp;so&nbsp;we&nbsp;will&nbsp;pass&nbsp;it&nbsp;on&nbsp;to&nbsp;the&nbsp;next&nbsp;handler&nbsp;but&nbsp;we&nbsp;still&nbsp;print&nbsp;a&nbsp;message</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span><span style="word-break: break-all">&nbsp;because&nbsp;it&nbsp;might&nbsp;at&nbsp;least&nbsp;be&nbsp;interesting&nbsp;to&nbsp;know&nbsp;about&nbsp;it&nbsp;for&nbsp;debugging</span><span class="hl_char">.</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;OutputDebugString<span class="hl_char">(</span>PChar<span class="hl_char">(</span><span class="hl_function">Format</span><span class="hl_char">(</span><span class="hl_quote">'exception %x at %p in %s -&gt; EXCEPTION_CONTINUE_SEARCH'</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span>ExCode<span class="hl_char">,</span>&nbsp;ExAddr<span class="hl_char">,</span>&nbsp;GetModuleName<span class="hl_char">(</span>ExModule<span class="hl_char">)</span><span class="hl_char">]</span><span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;exit<span class="hl_char">(</span>EXCEPTION_CONTINUE_SEARCH<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;the&nbsp;following&nbsp;will&nbsp;never&nbsp;be&nbsp;reached&nbsp;<span class="hl_char">*</span>during<span class="hl_char">*</span>&nbsp;<span class="hl_function"><b>this</b></span>&nbsp;function&nbsp;<span class="hl_function">call</span><span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;instead&nbsp;it&nbsp;will&nbsp;be&nbsp;jumped&nbsp;to&nbsp;<span class="hl_function"><b>and</b></span>&nbsp;executed&nbsp;<span class="hl_char">*</span>after<span class="hl_char">*</span>&nbsp;the&nbsp;handler&nbsp;has</li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;returned&nbsp;<span class="hl_function"><b>and</b></span>&nbsp;windows&nbsp;restarts&nbsp;execution&nbsp;at&nbsp;the&nbsp;<span class="hl_function"><b>new</b></span>&nbsp;position&nbsp;of&nbsp;eip<span class="hl_char">.</span></li><li class="hl_l0">&nbsp;&nbsp;lblRaise<span class="hl_char">:</span></li><li class="hl_l1">&nbsp;&nbsp;Raise&nbsp;ExObject<span class="hl_comment">; // this can be caught with try/except</span></li><li class="hl_l0"><span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">procedure&nbsp;AddHandler<span class="hl_comment">;</span></li><li class="hl_l1">begin</li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;ExceptionHandlerRefCount&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span>&nbsp;then&nbsp;begin</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;ExHandle&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;AddVectoredExceptionHandler<span class="hl_char">(</span><span class="hl_number">1</span><span class="hl_char">,</span>&nbsp;@ExceptionHandler<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;ThisModuleHandle&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;GetModuleByAddr<span class="hl_char">(</span>@ExceptionHandler<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;ThisModuleName&nbsp;<span class="hl_char">:</span><span class="hl_char">=</span>&nbsp;GetModuleName<span class="hl_char">(</span>ThisModuleHandle<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;OutputDebugString<span class="hl_char">(</span>PChar<span class="hl_char">(</span><span class="hl_function">Format</span><span class="hl_char">(</span><span class="hl_quote">'installed exception handler for %s'</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span>ThisModuleName<span class="hl_char">]</span><span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;ExceptionHandlerRefCount&nbsp;<span class="hl_char">+</span><span class="hl_char">=</span>&nbsp;<span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l1"><span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">procedure&nbsp;RemoveHandler<span class="hl_comment">;</span></li><li class="hl_l0">begin</li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;ExceptionHandlerRefCount&nbsp;<span class="hl_char">&gt;</span>&nbsp;<span class="hl_number">0</span>&nbsp;then&nbsp;begin</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;ExceptionHandlerRefCount&nbsp;<span class="hl_char">-</span><span class="hl_char">=</span>&nbsp;<span class="hl_number">1</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>if</b></span>&nbsp;ExceptionHandlerRefCount&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">0</span>&nbsp;then&nbsp;begin</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RemoveVectoredExceptionHandler<span class="hl_char">(</span>ExHandle<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OutputDebugString<span class="hl_char">(</span>PChar<span class="hl_char">(</span><span class="hl_function">Format</span><span class="hl_char">(</span><span class="hl_quote">'removed exception handler for %s'</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">[</span>ThisModuleName<span class="hl_char">]</span><span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_function"><b>end</b></span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">begin</li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;most&nbsp;non<span class="hl_char">-</span>FPC&nbsp;<span class="hl_function"><b>and</b></span>&nbsp;non<span class="hl_char">-</span>Borland&nbsp;apps&nbsp;do&nbsp;<span class="hl_function"><b>not</b></span>&nbsp;want&nbsp;FPU&nbsp;exceptions</li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span>&nbsp;<span class="hl_char">(</span>they&nbsp;might&nbsp;crash<span class="hl_char">)</span>&nbsp;so&nbsp;we&nbsp;immediately&nbsp;undo&nbsp;FPC's FPU unmasking.</li><li class="hl_l1">&nbsp;&nbsp;Set8087CW<span class="hl_char">(</span>Get8087CW&nbsp;<span class="hl_function"><b>or</b></span>&nbsp;<span class="hl_char">$</span><span class="hl_number">3f</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_function">end</span><span class="hl_char">.</span></li>        </ol>
    </div>
</div></div><br><br><font size="1"><i>-----<br>От многой мудрости много скорби, и умножающий знание умножает печаль</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=334431&amp;user=8830&amp;forum_n=1&amp;topic=22366.html&amp;page=0&amp;anchor=6" class="addthx" data-post="334431"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=2775" title="27-11-2013 16:06, ранг:364.0" target="_blank">Maximus</a>, <a href="action=userinfo&user=10534" title="27-11-2013 20:35, ранг:367.8" target="_blank">tihiy_grom</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]Dr0p[/b]','')">Dr0p</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33727.png" alt=""><br><span class=txtSm>Ранг: 72.3 (постоянный), 133thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.5'>Активность: 0.38<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33727">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 ноября 2013 02:07 &middot; Поправил: Dr0p <br><script type="text/javascript">QU('Dr0p','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Dr0p" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=22366.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
<b>Maximus</b><br><br>&gt; Сработает ли фильтр если я буду его устанавливать через dll, внедренную в адресное пространство программы?<br><br>VEH в отличие от SEH ничем не защищён. Не имеет значения где расположен хэндлер.<br><br>&gt; Что должна возращать моя процедура, чтобы программа не крашилась?<br><br>Для этого нужно знать причину фолта. Полагаю что следует просто вернуть управление(EXCEPTION_CONTINUE_EXECUTION), раз в других версиях робит. Да и вообще, вы не туда копаете. Не нужна никакая обработка, достаточно занопить кидающий фолт код ну или поправить его.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=334446&amp;user=33727&amp;forum_n=1&amp;topic=22366.html&amp;page=0&amp;anchor=7" class="addthx" data-post="334446"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]Maximus[/b]','')">Maximus</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/2775.jpg" alt=""><br><span class=txtSm>Ранг: 392.8 (мудрец), 108thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.75'>Активность: 0.26<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=2775">Участник</a><br><font color=blue>REVENGE сила, БеХоЦе могила</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 ноября 2013 09:56 &middot; Поправил: Maximus <br><script type="text/javascript">QU('Maximus','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Maximus" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=22366.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
<i class=x>Да и вообще, вы не туда копаете. Не нужна никакая обработка, достаточно занопить кидающий фолт код ну или поправить его.</i> <br><br>DrOp, занопил участок, который я кинул первым в листинге. Программа заработала. Тестирую результат.<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_number">7C424136</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">RET</span></li>        </ol>
    </div>
</div></div>
<br><br>Более глубоко копать могут только разработчики, тем более причина такого поведения программы яcна:<br>http://www.voyce.com/index.php/2008/10/01/troubleshooting-an-invalidprogramexception/<br><br>Но им видимо лениво это делать:<br>http://www.propro.ru/forum/viewtopic.php?f=6&amp;t=6510&amp;view=next
<br><br><font size="1"><i>-----<br>StarForce и Themida ацтой!</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=334459&amp;user=2775&amp;forum_n=1&amp;topic=22366.html&amp;page=0&amp;anchor=8" class="addthx" data-post="334459"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]Maximus[/b]','')">Maximus</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/2775.jpg" alt=""><br><span class=txtSm>Ранг: 392.8 (мудрец), 108thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.75'>Активность: 0.26<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=2775">Участник</a><br><font color=blue>REVENGE сила, БеХоЦе могила</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 декабря 2013 17:05 <br><script type="text/javascript">QU('Maximus','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Maximus" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=1&amp;topic=22366.html&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
В итоге написал dll-ку, которая отвязывает прогу от железяки и дает возможность запускать прогу на серверных осях. Тему закрываю.
<br><br><font size="1"><i>-----<br>StarForce и Themida ацтой!</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=335092&amp;user=2775&amp;forum_n=1&amp;topic=22366.html&amp;page=0&amp;anchor=9" class="addthx" data-post="335092"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/green.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=1&sortBy=0&page=0.html"><b>Основной форум</b></a> <b class=bulletHead>&#8212;&#8250;</b> Обработка исключения на Windows Server 2008</span></td>
</tr></table>
</div>
<a name=newreply></a>
<div align=center>
<table class=forums>
<tr>
<td class=caption4 width="100%"><span class=header>Эта тема закрыта. Ответы больше не принимаются.</span></td>
</tr>
</table>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=22366" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
