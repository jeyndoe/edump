<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Перехват API - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="люди добрые помогите!Задача такая нада при вызове определенной API передать управление моей проге. Если у кого есть исходники на masm залейте куданить плизз. зарание сенкс и извините за возможное повторение темы но в поиске я">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=42072'>zombi-vadim</a>, <a target='_blank' href='?action=userinfo&amp;user=31361'>zds</a> (+4 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Перехват API</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> <a href="action=vthread&amp;forum=6&amp;topic=8678&amp;page=0.html">&lt;&lt;</a> .  <a href="action=vthread&amp;forum=6&amp;topic=8678&amp;page=0.html">1</a> . <b>2</b> . <a href="action=vthread&amp;forum=6&amp;topic=8678&amp;page=2.html">3</a> . <a href="action=vthread&amp;forum=6&amp;topic=8678&amp;page=2.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]bitmaster[/b]','')">bitmaster</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 9.6 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.15'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=4843">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 06 мая 2007 20:16 <br><script type="text/javascript">QU('bitmaster','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=bitmaster" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=1#1');return false;">#1</a> </span><div align=left><br>
люди добрые помогите!Задача такая нада при вызове определенной API передать управление моей проге.<br>Если у кого есть исходники на masm залейте куданить плизз.<img src="img/smilies/s15.gif" alt=""><br>зарание сенкс и извините за возможное повторение темы но в поиске я ниче нинашел!<img src="img/smilies/s16.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=135267&amp;user=4843&amp;forum_n=6&amp;topic=8678&amp;page=1&amp;anchor=1" class="addthx" data-post="135267"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]volopas[/b]','')">volopas</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.8 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.92'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=21986">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 июня 2013 16:40 <br><script type="text/javascript">QU('volopas','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=volopas" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=1#2');return false;">#2</a> </span><div align=left><br>
&gt;&gt; который и вызовет LoadLibrary<br>Не пойдет. В таком случае моя библиотека будет в списке загруженных библиотек, что легко обнаружить. Нужно инжектировать DLL &quot;более скрытым способом&quot; , как пишет автор статьи.  Такие процедуры заканчиваются на ...Ex  в advApiHook.pas
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=326747&amp;user=21986&amp;forum_n=6&amp;topic=8678&amp;page=1&amp;anchor=2" class="addthx" data-post="326747"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]Dr0p[/b]','')">Dr0p</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33727.png" alt=""><br><span class=txtSm>Ранг: 72.3 (постоянный), 133thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.5'>Активность: 0.38<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33727">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 июня 2013 18:35 &middot; Поправил: Dr0p <br><script type="text/javascript">QU('Dr0p','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Dr0p" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=1#3');return false;">#3</a> </span><div align=left><br>
<b>ARCHANGEL</b><br>Инде не в курсе, ничо не знаю про местных кулцхэккеров и прочих свиноводов..<br><br><b>SReg</b><br>И ничего не получится. Ядро восстановит контекст треда, так как это стартап контекст и изменить в нём регистры низя(за исключеньем EFlags). Реальный, тот контекст, который будет прогружен в камень после возврата из апк хранится на стеке, а не в т-фрейме.<br><br>&gt; В таком случае моя библиотека будет в списке загруженных библиотек, что легко обнаружить.<br><br>Ежели вашей либы не будет в базе данных, то и она существовать не будет. Лодер не будет обслуживать ваш образ. Если такое обслуживанье не нужно, то и нет смысла юзать модуля. Хотя тут для нубья проблема серьёзная - на дельфях не сгенерить самодостаточный код. Делается проще - стандартно модуль грузится,  в базе данных метим флагом LDRP_COR_OWNS_UNMAP описатель, выгружаем модуль. Проекция останется(возможно нужно будет есчо пометить описатель как статически прилинкованный, либо есчо раз референснуть импорт).<br><br>Да и в вашем случае сокрытие такое бессмысленно, вы ведь через патч портите целостность системных модулей. Это обнаруживают и выпиливают все тулзы проще, чем определяют что модуль внесистемный.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=326755&amp;user=33727&amp;forum_n=6&amp;topic=8678&amp;page=1&amp;anchor=3" class="addthx" data-post="326755"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]SReg[/b]','')">SReg</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 315.1 (мудрец), 631thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.78'>Активность: 0.3<span style='color:green'>&nearr;</span>0.33</span><br>Статус: <a href="action=userinfo&amp;user=18316">Модератор</a><br><font color=blue>CrackLab</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 июня 2013 19:01 &middot; Поправил: SReg <br><script type="text/javascript">QU('SReg','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=SReg" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=1#4');return false;">#4</a> </span><div align=left><br>
<I>Dr0p пишет:<br>И ничего не получится </I><br>ну незнаю, тебе виднее, но я так делал и все работало <img src="img/smilies/s1.gif" alt=""><br><br><I>volopas<br>В таком случае моя библиотека будет в списке загруженных библиотек</I><br>пройдись по пебу найди и потри ее в LDR_DATA_TABLE_ENTRY
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=326758&amp;user=18316&amp;forum_n=6&amp;topic=8678&amp;page=1&amp;anchor=4" class="addthx" data-post="326758"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]Dr0p[/b]','')">Dr0p</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33727.png" alt=""><br><span class=txtSm>Ранг: 72.3 (постоянный), 133thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.5'>Активность: 0.38<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33727">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 26 июня 2013 19:14 <br><script type="text/javascript">QU('Dr0p','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Dr0p" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=1#5');return false;">#5</a> </span><div align=left><br>
<b>SReg</b><br>При старте треда доставляется ядерная апк, пользовательский контекст ложится в стек(тк апк). Если до ресума изменить контекст, то на стек ляжет изменённый, он будет использован после отработки лодера. Ядерный контекст вы не измените. Есть конечно методы, но они не помогут - придётся маршрутизировать, что довольно таки сложно.<br><br>&gt; пройдись по пебу найди и потри ее в LDR_DATA_TABLE_ENTRY <br><br>Тогда например гмер обнаружит паразитный код и покоцанный образ. Тоесть однозначно детект. А модуль - есть лишь один норм метод определить что модуль системный - обратиться к WFP. Но там не составляет труда свой модуль порегать.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=326760&amp;user=33727&amp;forum_n=6&amp;topic=8678&amp;page=1&amp;anchor=5" class="addthx" data-post="326760"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=33253" title="27-06-2013 01:54, ранг:12.6" target="_blank">Abraham</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]volopas[/b]','')">volopas</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.8 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.92'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=21986">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 июня 2013 13:46 <br><script type="text/javascript">QU('volopas','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=volopas" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=1#6');return false;">#6</a> </span><div align=left><br>
Нашел баг в коде. Когда ДЛЛ уже инжектирована, она должна подгрузить системную длл (если еще не подгружено) , найти адрес перехватываемой функции и вставить туда прыжок, но оригинальные байты куда-то сохранить. Если надо вызвать оригинальную функцию , то идет прыжок на эти байты , а потом прыжок на инструкцию , следующую за тем прыжком ,который в начале перехватываемой функции. Проблема в том , что оригинальные байты (там еще подсчитывается сколько опкодов байты занимают) могут содержать вызовы CALL E8 ******** .  И если тупо скопировать байты , то адрес будет совершенно другой. Таким образом вызвать оригинальную функцию невозможно. А внутри перехвата по-любому надо вызывать оригинал, так как переписывать оригинал сильно сложно.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=326784&amp;user=21986&amp;forum_n=6&amp;topic=8678&amp;page=1&amp;anchor=6" class="addthx" data-post="326784"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]Dr0p[/b]','')">Dr0p</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33727.png" alt=""><br><span class=txtSm>Ранг: 72.3 (постоянный), 133thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.5'>Активность: 0.38<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33727">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 июня 2013 01:15 &middot; Поправил: <a href="action=stats#mods">Модератор</a> <br><script type="text/javascript">QU('Dr0p','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Dr0p" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=1#7');return false;">#7</a> </span><div align=left><br>
<b>volopas</b><br>Вы что, даже не знаете как смещенья в ветвленьях вычисляются. ... Вам товарисч в комерц прямая дорога, ибо вы взялись за задачи очевидно не по силам. Знайте что патч удел школоты, вы очередное доказательство сего. Никто шарящий не будет бить образы, за это следует отрезать руки.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=326822&amp;user=33727&amp;forum_n=6&amp;topic=8678&amp;page=1&amp;anchor=7" class="addthx" data-post="326822"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]volopas[/b]','')">volopas</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.8 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.92'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=21986">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 июня 2013 10:38 &middot; Поправил: volopas <br><script type="text/javascript">QU('volopas','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=volopas" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=1#8');return false;">#8</a> </span><div align=left><br>
&gt;&gt; Вы что, даже не знаете как смещенья в ветвленьях вычисляются<br>Знаю, значение полсе E8 - это смещение, считаемое от следующей за CALL команды. Но просто удивляет, что в коде это абсолютно упускается. Нужно переписывать довольно много кода. Нужно распознавать опкоды, а не только считать их длину.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=326830&amp;user=21986&amp;forum_n=6&amp;topic=8678&amp;page=1&amp;anchor=8" class="addthx" data-post="326830"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]Dr0p[/b]','')">Dr0p</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33727.png" alt=""><br><span class=txtSm>Ранг: 72.3 (постоянный), 133thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.5'>Активность: 0.38<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33727">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 июня 2013 20:12 &middot; Поправил: <a href="action=stats#mods">Модератор</a> <br><script type="text/javascript">QU('Dr0p','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Dr0p" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=1#9');return false;">#9</a> </span><div align=left><br>
<b>volopas</b><br>... За патчи следует отрезать руки.<br><br>&gt; Нужно распознавать опкоды, а не только считать их длину. <br>... Про какой есчо дизасм вы говорите. Он вам ... не нужен. Для тупого пропатчиванья кода достаточно элементарного разбора ветвлений, даже дизасм длин не нужен - копипастим в буфер, фиксим оффсеты.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=326879&amp;user=33727&amp;forum_n=6&amp;topic=8678&amp;page=1&amp;anchor=9" class="addthx" data-post="326879"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=33253" title="29-06-2013 20:46, ранг:12.6" target="_blank">Abraham</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 222thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 29 июня 2013 23:04 <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=1#10');return false;">#10</a> </span><div align=left><br>
<b>volopas</b><br>Тебе <b>Dr0p</b> уже давал простое решение, которое я сам хотел выложить:<br><I>Dr0p пишет:<br>Самое элементарное решенье - создаём процесс остановленным, загружаем в контекст ссыль на стаб(в rEax вродь, не помню точно). </I><br>Поясню лишь. В усыплённом на старте процессе в контексте, в поле rEax хранится entry point exe-модуля. Это верно для всех 32бит Nt-систем виндовс, по-крайней мере от XP до 7ки включительно(на 64бит не проверял)! Ищем свободное место в конце секции кода или выделяем такое - не важно, пишем туда код с установкой(ами) хука, нужными действиями и не забываем про джамп на entry point. Всё!<br><br>Такие заявки на &quot;свиноблоге&quot; и такое невежество здесь...<br><br>P.S. Уход с форума означало бы признание вины и что я сдался. Буду аккуратно мстить &quot;чернословам&quot;, которые, не вчитываясь в тему и ни грамма не думая, судят о людях, &quot;авторитетно&quot; вставляя пару гнилых фраз.<br>TryAga1n, try anymore...
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=326937&amp;user=24257&amp;forum_n=6&amp;topic=8678&amp;page=1&amp;anchor=10" class="addthx" data-post="326937"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=4773" title="29-06-2013 19:52, ранг:104.9" target="_blank">plutos</a>, <a href="action=userinfo&user=33253" title="29-06-2013 20:51, ранг:12.6" target="_blank">Abraham</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]Archer[/b]','')">Archer</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/1556.jpg" alt=""><br><span class=txtSm>Ранг: 2014.5 <b><u>(!!!!)</u></b>, 1278thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.27'>Активность: 1.34<span style='color:red'>&searr;</span>0.25</span><br>Статус: <a href="action=userinfo&amp;user=1556">Модератор</a><br><font color=blue>retired</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 30 июня 2013 10:00 <br><script type="text/javascript">QU('Archer','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Archer" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=1#11');return false;">#11</a> </span><div align=left><br>
Посты не в тему стёр, некоторые посты поправил.<br>Во-первых, ТС хватит жаловаться и ныть, возьми и сделай, в гугле овер 9000 примеров инжекта на любой вкус и размер, в том числе и с SUSPENDED, и всё прекрасно работает.<br>Остальным-давайте всё же ближе к теме.<br>И в-третьих, хаять поделия вместе с людьми (уважаемых как минимум в своё время), которые уже не могут ничего на это ответить, по меньшей мере некорректно. Да, в этой статье, как и в примерах кода, далеко не всё учтено, но и писалось это всё в бородатые годы. Не нравится-не пользуйся или напиши лучше.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=326946&amp;user=1556&amp;forum_n=6&amp;topic=8678&amp;page=1&amp;anchor=11" class="addthx" data-post="326946"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=17319" title="30-06-2013 06:13, ранг:220.1" target="_blank">VodoleY</a>, <a href="action=userinfo&user=18316" title="30-06-2013 07:25, ранг:141.7" target="_blank">SReg</a>, <a href="action=userinfo&user=21572" title="30-06-2013 14:25, ранг:50.8" target="_blank">hlmadip</a>, <a href="action=userinfo&user=24257" title="30-06-2013 21:56, ранг:123.3" target="_blank">DenCoder</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]Dr0p[/b]','')">Dr0p</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33727.png" alt=""><br><span class=txtSm>Ранг: 72.3 (постоянный), 133thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.5'>Активность: 0.38<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33727">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 30 июня 2013 10:11 <br><script type="text/javascript">QU('Dr0p','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Dr0p" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=1#12');return false;">#12</a> </span><div align=left><br>
<b>Archer</b><br>Соответствующая оценка поделиям, бородатым или нет не важно, должна быть. Тогда бы не юзалось такое. Причём инжекты это малварные методы, есно у вас не спросят хочешь пользоваться или нет.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=326947&amp;user=33727&amp;forum_n=6&amp;topic=8678&amp;page=1&amp;anchor=12" class="addthx" data-post="326947"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]volopas[/b]','')">volopas</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.8 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.92'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=21986">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 30 июня 2013 17:49 &middot; Поправил: volopas <br><script type="text/javascript">QU('volopas','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=volopas" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=1#13');return false;">#13</a> </span><div align=left><br>
Еще есть вопрос по статье. Там для каждого RemoteThread и для каждой порции данных для этого потока выделяется память по 4 КБ , а на деле используется байтов 20. Потоков создается довольно много: напр. для каждой импортируемой длл-кой функции . Но это еще полбеды. Ее освобождение автор не предусмотрел. Нужно ли беспокоится за эту память? Если освобождать , то нужно как-то проконтролировать, чтобы память не была освобождена , пока в ней выполняется удаленный поток.<br><br>Хотя в функции InjectThread автор статьи предусмотрел возможность подождать результат выполнения удаленного потока. Т. е. можно дождавшись его завершения освободить и память под код потока и память под передаваемые потоку параметры. Но не замедлит ли это работу приложения?<br><br>Может лучше организовать массив из Dword-элементов, который наполнять адресами на выделенную память, а уже после инжекта пройтись по массиву и освободить ? Нет ли опасности , что в момент восстановления основного потока целевого приложения через ResumeThread , какой-то из созданных удаленных потоков будет еще выполняться?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=326958&amp;user=21986&amp;forum_n=6&amp;topic=8678&amp;page=1&amp;anchor=13" class="addthx" data-post="326958"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 222thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 июля 2013 02:11 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=1#14');return false;">#14</a> </span><div align=left><br>
<I>volopas пишет:<br>Т. е. можно дождавшись его завершения освободить и память под код потока и память под передаваемые потоку параметры. Но не замедлит ли это работу приложения? </I><br>Охота попиздеть? - просто делай! Внешние воздействия нисколько не замедляют работу приложений... (в данном случае)<br><br><I>volopas пишет:<br>Еще есть вопрос по статье. </I><br>Если что-то уже читаешь, то по определению у тебя не должно быть вопросов!<br><br><I>volopas пишет:<br>Может лучше организовать массив из Dword-элементов, который наполнять адресами на выделенную память</I><br>примерно так же сделана си-операция new, я реализовывал свой диспетчер памяти - если мозги работают, то сделаешь как надо<br><br><I>volopas пишет:<br>Нет ли опасности , что в момент восстановления основного потока целевого приложения через ResumeThread , какой-то из созданных удаленных потоков будет еще выполняться? </I><br>Синхронизируй, если оно действительно тебе надо!
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=326978&amp;user=24257&amp;forum_n=6&amp;topic=8678&amp;page=1&amp;anchor=14" class="addthx" data-post="326978"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]VodoleY[/b]','')">VodoleY</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 488.1 (мудрец), 272thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.01'>Активность: 0.35<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=17319">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 июля 2013 09:03 <br><script type="text/javascript">QU('VodoleY','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=VodoleY" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=1#15');return false;">#15</a> </span><div align=left><br>
<I>volopas пишет:<br>Еще есть вопрос по статье. Там для каждого RemoteThread и для каждой порции данных для этого потока выделяется память по 4 КБ , а на деле используется байтов 20.  </I><br><br>советую почитать allomem.. попробуйте выделить 20 байт? или 5?.. 1000Н байт это дискретная величина, меньше которой выделить память нельзя
<br><br><font size="1"><i>-----<br>Наша работа во тьме, Мы делаем, что умеем. Мы отдаем, что имеем, Наша работа во тьме....</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=326985&amp;user=17319&amp;forum_n=6&amp;topic=8678&amp;page=1&amp;anchor=15" class="addthx" data-post="326985"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]Dr0p[/b]','')">Dr0p</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33727.png" alt=""><br><span class=txtSm>Ранг: 72.3 (постоянный), 133thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.5'>Активность: 0.38<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33727">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 01 июля 2013 23:52 <br><script type="text/javascript">QU('Dr0p','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Dr0p" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=1#16');return false;">#16</a> </span><div align=left><br>
<b>volopas</b><br><br>&gt; Хотя в функции InjectThread<br><br>Сия метода(там тред стартуется) будет вызвана после инициализации модулей. Также как и apc-инжект, смена контекста. Вы же вещали что нужно патчить кернел апи до её инициализации и статического импорта лодером <img src="img/smilies/s15.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=327027&amp;user=33727&amp;forum_n=6&amp;topic=8678&amp;page=1&amp;anchor=16" class="addthx" data-post="327027"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]volopas[/b]','')">volopas</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.8 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.92'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=21986">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 03 июля 2013 21:59 &middot; Поправил: <a href="action=stats#mods">Модератор</a> <br><script type="text/javascript">QU('volopas','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=volopas" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=1#17');return false;">#17</a> </span><div align=left><br>
&gt;&gt;попробуйте выделить 20 байт? или 5?.. 1000Н байт это дискретная величина, меньше которой выделить память нельзя<br><br>Это понятно. Просто используется менее 1 % и потом не высвобождается. Нужно тогда либо писать в уже выделенную область , либо высвобождать , иначе это кощунство.<br><br>&gt;&gt;Вы же вещали что нужно патчить кернел апи до её инициализации и статического импорта лодером <br><br>Где я такое вещал? Мне надо было перехватить ReadFile до первого ее вызова. А первый вызов не может быть раньше чем импорт kernel32.dll. Вопрос не понял.<br><br><b><font color="red">От модератора: Пользуйся кнопкой &quot;Правка&quot;, не создавай сообщения подряд. </font></b>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=327130&amp;user=21986&amp;forum_n=6&amp;topic=8678&amp;page=1&amp;anchor=17" class="addthx" data-post="327130"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 222thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 июля 2013 09:59 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=1#18');return false;">#18</a> </span><div align=left><br>
<b>volopas</b><br>Ты попробуй, сделай. Как бы ты ни был подкован теорией, надо потратить время и на ошибки, без которых ни у кого не бывает. Будут проблемы - отпишешься.<br><br><I>volopas пишет:<br>Потоков создается довольно много: напр. для каждой импортируемой длл-кой функции </I><br>Честно, это понять не могу. Где для каждой импортируемой длл-кой функции создаётся отдельный поток?<br><br>(Об ЭмСиРэме узнал только, когда попал на этот форум. На тот момент уже около года пользовался методиками инжекта)
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=327142&amp;user=24257&amp;forum_n=6&amp;topic=8678&amp;page=1&amp;anchor=18" class="addthx" data-post="327142"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]volopas[/b]','')">volopas</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.8 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.92'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=21986">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 июля 2013 18:56 &middot; Поправил: volopas <br><script type="text/javascript">QU('volopas','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=volopas" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=1#19');return false;">#19</a> </span><div align=left><br>
&gt;&gt;Честно, это понять не могу. Где для каждой импортируемой длл-кой функции создаётся отдельный поток?<br><br>procedure ProcessImports<br><br>Внутри нее используется GetProcAddressEx , а внутри нее базовая InjectThread, которая и создает удаленный поток
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=327180&amp;user=21986&amp;forum_n=6&amp;topic=8678&amp;page=1&amp;anchor=19" class="addthx" data-post="327180"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="20" onfocus="this.blur()" href="JavaScript:di('[b]SweetLizard[/b]','')">SweetLizard</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: -0.1 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.02'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=35273">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 июля 2013 20:58 &middot; Поправил: SweetLizard <br><script type="text/javascript">QU('SweetLizard','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=SweetLizard" target="_blank">Личное сообщение</a> &middot;  <a href="#20" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=1#20');return false;">#20</a> </span><div align=left><br>
<b>volopas</b><br>Вы даже не понимаете зачем нужна команда Sleep(2000) ,а лезете в многопоточность.<br>Ставьте хук на CreateFile,а потом CopyFile если хотите выдрать файлы из контейнера SFFS или что там у вас за утилита<br>Для синхронизации нужно использовать WaitForSingleObject, иначе ничего у вас работать не будет
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=327182&amp;user=35273&amp;forum_n=6&amp;topic=8678&amp;page=1&amp;anchor=20" class="addthx" data-post="327182"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="21" onfocus="this.blur()" href="JavaScript:di('[b]volopas[/b]','')">volopas</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.8 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.92'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=21986">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 04 июля 2013 21:21 &middot; Поправил: volopas <br><script type="text/javascript">QU('volopas','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=volopas" target="_blank">Личное сообщение</a> &middot;  <a href="#21" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=1#21');return false;">#21</a> </span><div align=left><br>
Еще раз задаю вопросы. <br><br>Почему suspended приложение не может нормально работать, если до resume основного потока запускались другие потоки?<br><br>Обязательно ли высвобождать память , которая выделяется под удаленные потоки?<br><br>Прошу либо давать ответы на эти вопросы, либо молчать.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=327183&amp;user=21986&amp;forum_n=6&amp;topic=8678&amp;page=1&amp;anchor=21" class="addthx" data-post="327183"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="22" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 222thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 июля 2013 01:34 <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#22" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=1#22');return false;">#22</a> </span><div align=left><br>
<I>volopas пишет:<br>Внутри нее используется GetProcAddressEx , а внутри нее базовая InjectThread, которая и создает удаленный поток </I><br><br><I>volopas пишет:<br>Обязательно ли высвобождать память , которая выделяется под удаленные потоки? </I><br>Это некорректный механизм! Создавать каждый раз поток, чтоб только импортировать функу - бред. Вполне достаточно просто создать табличку импорта в процессе-пациенте и одним потоком её заполнить.
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=327187&amp;user=24257&amp;forum_n=6&amp;topic=8678&amp;page=1&amp;anchor=22" class="addthx" data-post="327187"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="23" onfocus="this.blur()" href="JavaScript:di('[b]DillerInc[/b]','')">DillerInc</a></b><br></div>
<img src="img/s6.gif" alt=""><br><img style="padding-top:3px;" src="av/1613.gif" alt=""><br><span class=txtSm>Ранг: 283.6 (наставник), 56thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.25'>Активность: 0.13<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1613">Участник</a><br><font color=blue>Author of GeTaOEP</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 июля 2013 16:30 <br><script type="text/javascript">QU('DillerInc','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DillerInc" target="_blank">Личное сообщение</a> &middot;  <a href="#23" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=1#23');return false;">#23</a> </span><div align=left><br>
<I>volopas пишет:<br>Почему suspended приложение не может нормально работать, если до resume основного потока запускались другие потоки? </I><br>...всё должно работать.<br>Проблема в том, что вы пытаетесь использовать чужие исходники, скорее всего не до конца понимая их. К тому же я считаю, что вашем случае всё можно сделать гораздо проще. Все эти манипуляции с ручной загрузкой либы абсолютно не нужны.<br><br><I>volopas пишет:<br>Обязательно ли высвобождать память , которая выделяется под удаленные потоки? </I><br>...в принципе да, например:<br> * выделяем память под шеллкод<br> * внедряем либу с помощью CreateRemoteThread<br> * освобождаем память, выделнную для шеллкода<br>Здесь удалённый поток выполнится в целевом процессе сразу же, поэтому имеет смысл ждать это событие, чтобы освободить память.<br>Но могут быть нюансы, например:<br> * выделяем память под шеллкод<br> * внедряем либу с помощью QueueUserAPC<br>В данном примере освобождать память не стоит, потому как вероятнее всего apc будет доставлен в целевой процесс только через некоторое время, после того, как пройдёт инициализация процесса. Ждать этого события с помощью WaitForSingleObject, с моей точки зрения, не имеет смысла. Исходя из этого, освобождать память шеллкода нельзя, потому как иначе будет исключение, когда целевой процесс, наконец, решит выполнить ваш шеллкод.
<br><br><font size="1"><i>-----<br>the Power of Reversing team</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=327199&amp;user=1613&amp;forum_n=6&amp;topic=8678&amp;page=1&amp;anchor=23" class="addthx" data-post="327199"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="24" onfocus="this.blur()" href="JavaScript:di('[b]Dr0p[/b]','')">Dr0p</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33727.png" alt=""><br><span class=txtSm>Ранг: 72.3 (постоянный), 133thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.5'>Активность: 0.38<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33727">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 июля 2013 18:37 <br><script type="text/javascript">QU('Dr0p','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Dr0p" target="_blank">Личное сообщение</a> &middot;  <a href="#24" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=1#24');return false;">#24</a> </span><div align=left><br>
<b>DillerInc</b><br><br>&gt;  Все эти манипуляции с ручной загрузкой либы абсолютно не нужны.<br><br>Там небыло лодеров, сурсы мсрема это ущербное кривое гавно дестилетней давности.<br><br>&gt; * выделяем память под шеллкод<br><br>Какой впизду шелл, вы собрались переполнять буфера лодера - так я сразу скажу что их все прочекал вдоль и поперёк, гиблая затея.<br><br>&gt; * внедряем либу с помощью CreateRemoteThread<br>Это созданье треда, какое отношенье там пе формат имеет не понятно.<br><br>&gt; * внедряем либу с помощью QueueUserAPC<br>Опять же. Какое нахуй внедренье ?<br><br>Быть может вам следует ознакомиться с осевыми механизмами, которые позволяют выполнить произвольный код - так тонны их. Даже в юзермодах. Запись в память, ремапы, контексты, треды, секции.. это вообще пиздец. Учите ебланы архитектуру!
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=327216&amp;user=33727&amp;forum_n=6&amp;topic=8678&amp;page=1&amp;anchor=24" class="addthx" data-post="327216"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=8830" title="06-07-2013 01:38, ранг:155.8" target="_blank">ajax</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="25" onfocus="this.blur()" href="JavaScript:di('[b]DillerInc[/b]','')">DillerInc</a></b><br></div>
<img src="img/s6.gif" alt=""><br><img style="padding-top:3px;" src="av/1613.gif" alt=""><br><span class=txtSm>Ранг: 283.6 (наставник), 56thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.25'>Активность: 0.13<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=1613">Участник</a><br><font color=blue>Author of GeTaOEP</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 июля 2013 20:04 <br><script type="text/javascript">QU('DillerInc','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DillerInc" target="_blank">Личное сообщение</a> &middot;  <a href="#25" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=1#25');return false;">#25</a> </span><div align=left><br>
Собственно, чтобы стало ещё понятнее.<br>Т.н. &quot;шеллы&quot; для удалённой загрузки либы излишни. Достаточно воспользоваться <u><noindex><a href="http://www.drdobbs.com/a-safer-alternative-to-terminateprocess/184416547" rel="nofollow" target="_blank">следующим приёмом</a></noindex></u> и избавиться от необходимости городить опкоды, которые бы правильно выполнялись как в x86, так и в x64. В таком случае выделяемая память будет использоваться только для хранения пути загружаемой либы. Указатель на эту память и будет передаваться как параметр удалённому потоку.
<br><br><font size="1"><i>-----<br>the Power of Reversing team</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=327231&amp;user=1613&amp;forum_n=6&amp;topic=8678&amp;page=1&amp;anchor=25" class="addthx" data-post="327231"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="26" onfocus="this.blur()" href="JavaScript:di('[b]SweetLizard[/b]','')">SweetLizard</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: -0.1 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.02'>Активность: 0=0</span><br>Статус: <a href="action=userinfo&amp;user=35273">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 июля 2013 21:08 <br><script type="text/javascript">QU('SweetLizard','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=SweetLizard" target="_blank">Личное сообщение</a> &middot;  <a href="#26" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=1#26');return false;">#26</a> </span><div align=left><br>
Лично я вообще не понимаю,что хочет сделать ТС. Судя по всему,какую то очередную херовину типа трехпедального велосипеда с квадратными колесами.<br>Что нужно сделать для получения рабочего кода:<br>1. понять цель задачи<br>2. взять литературу<br>2.1 книги Рихтера по Windows C++<br>2.2 MSDN майкрософт<br>3. взять компилятор и собственно откомпилировать требуюмую <strike>свино</strike>хероблудятину
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=327233&amp;user=35273&amp;forum_n=6&amp;topic=8678&amp;page=1&amp;anchor=26" class="addthx" data-post="327233"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="27" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 222thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 05 июля 2013 21:28 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#27" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=1#27');return false;">#27</a> </span><div align=left><br>
Из литературы ставлю MSDN на первом месте. Можно обойтись без Рихтера, если пореверсить до глубокого понимания <noindex><a href="http://exelab.ru/download.php?action=get&amp;n=Mjk1" rel="nofollow" target="_blank">--&gt; API Monitor &lt;--</a></noindex>, например.  С какого-то из шпионов <noindex><a href="http://exelab.ru/download.php?action=list&amp;n=MTU=" rel="nofollow" target="_blank">--&gt; отсюда &lt;--</a></noindex> у меня и появился первый опыт в этой тематике. По-моему, kerberos... Ещё через билайн качал эти утилиты 7 лет назад.
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=327234&amp;user=24257&amp;forum_n=6&amp;topic=8678&amp;page=1&amp;anchor=27" class="addthx" data-post="327234"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="28" onfocus="this.blur()" href="JavaScript:di('[b]volopas[/b]','')">volopas</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.8 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.92'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=21986">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 сентября 2013 08:55 &middot; Поправил: volopas <br><script type="text/javascript">QU('volopas','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=volopas" target="_blank">Личное сообщение</a> &middot;  <a href="#28" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=1#28');return false;">#28</a> </span><div align=left><br>
<b>DillerInc</b><br>&gt;&gt; Собственно, чтобы стало ещё понятнее.<br>&gt;&gt; Т.н. &quot;шеллы&quot; для удалённой загрузки либы излишни. Достаточно воспользоваться следующим приёмом &gt;&gt; http://www.drdobbs.com/a-safer-alternative-to-terminateprocess/184416547 <br>Как передать в CreateRemoteThread 2 параметра?<br>На сайте Майкрософт говорят , что нужно делать некую структуру (запись):<br><span style="word-break: break-all">http://social.msdn.microsoft.com/Forums/en-US/ffbf9121-1e2f-490c-acae-b90ceae7b995/createremotethread-how-to-separate-parameters-or-pass-multiple-parameters-to-function</span><br>Я попробовал, но нифига не передается больше 1 параметра. Смотрим в kernel32 в процедуру, отвечающую за вызов потока:<br><img src="http://img844.imageshack.us/img844/3541/8wvf.png" border="0" align="" alt=""><br>Там только 1 push, не зависимо от того, передаем мы указатель на dword, чисто dword или указатель на структуру (запись). Более того, если передавать указатель, то этот указатель находится в адресном пространстве материнского процесса, а не целевого. <br><br><br>Есть ли способ обойти это , не прибегая к шеллу? <br><br><br>Почему модератор на сайте Майкрософт врет?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=331409&amp;user=21986&amp;forum_n=6&amp;topic=8678&amp;page=1&amp;anchor=28" class="addthx" data-post="331409"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="29" onfocus="this.blur()" href="JavaScript:di('[b]Dr0p[/b]','')">Dr0p</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33727.png" alt=""><br><span class=txtSm>Ранг: 72.3 (постоянный), 133thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.5'>Активность: 0.38<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33727">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 сентября 2013 09:15 <br><script type="text/javascript">QU('Dr0p','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Dr0p" target="_blank">Личное сообщение</a> &middot;  <a href="#29" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=1#29');return false;">#29</a> </span><div align=left><br>
<b>volopas</b><br><br>Ссылку на структуру передавайте, ну или можно извращаться(не ясно зачем) - получаем текущий стек и впиливаем в него данные.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=331410&amp;user=33727&amp;forum_n=6&amp;topic=8678&amp;page=1&amp;anchor=29" class="addthx" data-post="331410"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="30" onfocus="this.blur()" href="JavaScript:di('[b]Veliant[/b]','')">Veliant</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 301.4 (мудрец), 194thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.62'>Активность: 0.17<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=3136">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 сентября 2013 09:32 &middot; Поправил: Veliant <br><script type="text/javascript">QU('Veliant','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Veliant" target="_blank">Личное сообщение</a> &middot;  <a href="#30" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=1#30');return false;">#30</a> </span><div align=left><br>
Вы же сами цитируете<br>&gt;&gt;делать некую структуру<br><br>1) Делаете структуру<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">typedef&nbsp;struct&nbsp;_Arguments&nbsp;{</li><li class="hl_l1"><span class="hl_function"><b>int</b></span>&nbsp;arg1<span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_function"><b>int</b></span>&nbsp;arg2<span class="hl_comment">;</span></li><li class="hl_l1">}&nbsp;Arguments<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">Arguments&nbsp;args&nbsp;<span class="hl_char">=</span>&nbsp;{1<span class="hl_char">,</span>2}<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>void</b></span>&nbsp;WINAPI&nbsp;DestFunc<span class="hl_char">(</span>Arguments&nbsp;<span class="hl_char">*</span>args<span class="hl_char">)</span></li><li class="hl_l0">{</li><li class="hl_l1"><span class="hl_char">/</span><span class="hl_char">/</span>args<span class="hl_char">-</span><span class="hl_char">&gt;</span>arg1<span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_char">/</span><span class="hl_char">/</span>args<span class="hl_char">-</span><span class="hl_char">&gt;</span>arg2<span class="hl_comment">;</span></li><li class="hl_l1">}</li>        </ol>
    </div>
</div></div>
<br><br>2)Выделяете память в нужном процессе и копируете туда структуру<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">dstaddr&nbsp;<span class="hl_char">=</span>&nbsp;VirtualAllocEx<span class="hl_char">(</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>args<span class="hl_char">)</span><span class="hl_char">,</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">)</span></li><li class="hl_l1">WriteProcessMemory<span class="hl_char">(</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">,</span>dstaddr<span class="hl_char">,</span>&nbsp;<span class="hl_char">&amp;</span>args<span class="hl_char">,</span>&nbsp;<span class="hl_function">sizeof</span><span class="hl_char">(</span>args<span class="hl_char">)</span>&nbsp;<span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">)</span></li>        </ol>
    </div>
</div></div>
<br><br>3) Повторяете пункт два но для функции DestFunc<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">fnaddr&nbsp;<span class="hl_char">=</span>&nbsp;VirtualAllocEx<span class="hl_char">(</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">,</span>&nbsp;размер_функции<span class="hl_char">,</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">)</span></li><li class="hl_l1">WriteProcessMemory<span class="hl_char">(</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">,</span>fnaddr<span class="hl_char">,</span>&nbsp;DestFunc<span class="hl_char">,</span>&nbsp;размер_функции<span class="hl_char">,</span>&nbsp;<span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">.</span><span class="hl_char">)</span></li>        </ol>
    </div>
</div></div>
<br><br>4) CreateThreadEx(....fnaddr, dstaddr..)
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=331413&amp;user=3136&amp;forum_n=6&amp;topic=8678&amp;page=1&amp;anchor=30" class="addthx" data-post="331413"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="31" onfocus="this.blur()" href="JavaScript:di('[b]volopas[/b]','')">volopas</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 6.8 (гость), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.92'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=21986">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 25 сентября 2013 10:22 <br><script type="text/javascript">QU('volopas','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=volopas" target="_blank">Личное сообщение</a> &middot;  <a href="#31" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=8678&amp;page=1#31');return false;">#31</a> </span><div align=left><br>
Я работаю в Delphi. Приведенный код, конечно понятен и работать не будет, но проверить я это не могу. Поэтому просьба выкладывать исходники в Delphi. Так и Вы и я сможем проверить и убедиться в нормальной работе исходника. Для упрощения моего понимания рассмотрим запуск в удаленном потоке процесса C:\WINDOWS\system32\taskmgr.exe процедуры TerminateProcess: <br>TerminateProcess<br>-hProcess<br>-ExitCode<br><br>То есть процедура известна и ее адрес можно даже задавать &quot;в лоб&quot; на моей ОС. Как передать 2 параметра? Я пробовал передавать адрес. И что получается TerminateProcess прининимает 1 параметр в виде адреса на выделенную память. Пиши в эту память что-либо, не пиши -- результат будет следующий:<br>TerminateProcess (<br>hProcess = адрес в памяти вместо хендла процесса;<br>ExitCode = то, что в стеке ниже , вместо значения LongWord<br>)<br><br>И Вы думаете это будет работать?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=331416&amp;user=21986&amp;forum_n=6&amp;topic=8678&amp;page=1&amp;anchor=31" class="addthx" data-post="331416"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> <a href="action=vthread&amp;forum=6&amp;topic=8678&amp;page=0.html">&lt;&lt;</a> .  <a href="action=vthread&amp;forum=6&amp;topic=8678&amp;page=0.html">1</a> . <b>2</b> . <a href="action=vthread&amp;forum=6&amp;topic=8678&amp;page=2.html">3</a> . <a href="action=vthread&amp;forum=6&amp;topic=8678&amp;page=2.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Перехват API</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#32" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="6">
<input type="hidden" name="topic" value="8678">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=8678" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
