<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Windows7: WriteFile access denied только на дальних секторах. Помогите разобраться. - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Здравствуйте! Есть код записи сектора на PhysicalDrive0 который при записи на дальние сектора выдаёт &quot;access denied&quot; на некоторых Windows 7 машинах. Запуск от админа, в режиме эмуляции windows XP, с разными состояниями">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=8605'>Rio</a>, <a target='_blank' href='?action=userinfo&amp;user=55995'>tyns777</a>, <a target='_blank' href='?action=userinfo&amp;user=42072'>zombi-vadim</a> (+6 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Windows7: WriteFile access denied только на дальних секторах. Помогите разобраться.</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]ToBad[/b]','')">ToBad</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/702.gif" alt=""><br><span class=txtSm>Ранг: 450.3 (мудрец), 13thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.67'>Активность: 0.2<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=702">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 20 февраля 2015 16:00 &middot; Поправил: ToBad <br><script type="text/javascript">QU('ToBad','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ToBad" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=23427.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br>
Здравствуйте!<br>Есть код записи сектора на PhysicalDrive0 который при записи на дальние сектора выдаёт &quot;access denied&quot; на некоторых Windows 7 машинах.<br>Запуск от админа, в режиме эмуляции windows XP, с разными состояниями UAC, с FSCTL_DISMOUNT_VOLUME и FSCTL_LOCK_VOLUME я пробовал. Даже политики копировал с компа где всё работает - ничего не помогло.<br>Ставлю CPConverted.QuadPart:=&#036;6800; - всё работает (читаю и пишу), ставлю в конец диска например (где предварительно записал что-то через WinHex) - работает только чтение!<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function">const</span></li><li class="hl_l1">&nbsp;&nbsp;FILE_DEVICE_CONTROLLER&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">$</span><span class="hl_number">00000004</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;FILE_DEVICE_FILE_SYSTEM&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">$</span><span class="hl_number">00000009</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;FILE_DEVICE_MASS_STORAGE&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">$</span><span class="hl_number">0000002D</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;METHOD_BUFFERED&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">$</span><span class="hl_number">00000000</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;FILE_ANY_ACCESS&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">$</span><span class="hl_number">00000000</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;FILE_READ_ACCESS&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">$</span><span class="hl_number">00000001</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;FILE_WRITE_ACCESS&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">$</span><span class="hl_number">00000002</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;IOCTL_STORAGE_BASE&nbsp;<span class="hl_char">=</span>&nbsp;FILE_DEVICE_MASS_STORAGE<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;IOCTL_SCSI_BASE&nbsp;<span class="hl_char">=</span>&nbsp;FILE_DEVICE_CONTROLLER<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;FSCTL_LOCK_VOLUME&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">(</span>FILE_DEVICE_FILE_SYSTEM&nbsp;<span class="hl_function"><b>shl</b></span>&nbsp;<span class="hl_number">16</span><span class="hl_char">)</span>&nbsp;<span class="hl_function">or</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">(</span>FILE_ANY_ACCESS&nbsp;<span class="hl_function"><b>shl</b></span>&nbsp;<span class="hl_number">14</span><span class="hl_char">)</span>&nbsp;<span class="hl_function"><b>or</b></span>&nbsp;<span class="hl_char">(</span><span class="hl_char">$</span><span class="hl_number">6</span>&nbsp;<span class="hl_function"><b>shl</b></span>&nbsp;<span class="hl_number">2</span><span class="hl_char">)</span>&nbsp;<span class="hl_function"><b>or</b></span>&nbsp;METHOD_BUFFERED<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;FSCTL_DISMOUNT_VOLUME&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_char">(</span>FILE_DEVICE_FILE_SYSTEM&nbsp;<span class="hl_function"><b>shl</b></span>&nbsp;<span class="hl_number">16</span><span class="hl_char">)</span>&nbsp;<span class="hl_function">or</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">(</span>FILE_ANY_ACCESS&nbsp;<span class="hl_function"><b>shl</b></span>&nbsp;<span class="hl_number">14</span><span class="hl_char">)</span>&nbsp;<span class="hl_function"><b>or</b></span>&nbsp;<span class="hl_char">(</span><span class="hl_char">$</span><span class="hl_number">8</span>&nbsp;<span class="hl_function"><b>shl</b></span>&nbsp;<span class="hl_number">2</span><span class="hl_char">)</span>&nbsp;<span class="hl_function"><b>or</b></span>&nbsp;METHOD_BUFFERED<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">var</li><li class="hl_l0">&nbsp;&nbsp;CPConverted<span class="hl_char">:</span>&nbsp;LARGE_INTEGER<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;hDiskFile<span class="hl_char">:</span>&nbsp;thandle<span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;intreadedamount<span class="hl_char">,</span>BytesWritten<span class="hl_char">:</span>&nbsp;cardinal<span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;buf2<span class="hl_char">:</span>&nbsp;array&nbsp;of&nbsp;<span class="hl_function"><b>byte</b></span><span class="hl_comment">;</span></li><li class="hl_l0">begin</li><li class="hl_l1">&nbsp;&nbsp;CPConverted<span class="hl_char">.</span>QuadPart<span class="hl_char">:</span><span class="hl_char">=</span><span class="hl_char">$</span><span class="hl_number">6800</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;hDiskFile<span class="hl_char">:</span><span class="hl_char">=</span>CreateFile<span class="hl_char">(</span><span class="hl_quote">'\.\PhysicalDrive0'</span><span class="hl_char">,</span>&nbsp;GENERIC_READ&nbsp;<span class="hl_function"><b>or</b></span>&nbsp;GENERIC_WRITE<span class="hl_char">,</span>&nbsp;FILE_SHARE_READ&nbsp;<span class="hl_function"><b>or</b></span>&nbsp;FILE_SHARE_WRITE<span class="hl_char">,</span>&nbsp;nil<span class="hl_char">,</span>&nbsp;OPEN_EXISTING<span class="hl_char">,</span>&nbsp;FILE_ATTRIBUTE_NORMAL<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;SetFilePointer<span class="hl_char">(</span>hDiskFile<span class="hl_char">,</span>&nbsp;Longint<span class="hl_char">(</span>CPConverted<span class="hl_char">.</span>LowPart<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;@CPConverted<span class="hl_char">.</span>HighPart<span class="hl_char">,</span>&nbsp;FILE_BEGIN<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_function"><b>not</b></span>&nbsp;DeviceIoControl<span class="hl_char">(</span>hDiskFile<span class="hl_char">,</span>FSCTL_DISMOUNT_VOLUME<span class="hl_char">,</span>&nbsp;nil<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;nil<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;BytesWritten<span class="hl_char">,</span>&nbsp;nil<span class="hl_char">)</span>&nbsp;then&nbsp;Log<span class="hl_char">(</span><span class="hl_quote">'DeviceIoControl (FSCTL_DISMOUNT_VOLUME) Error: '</span>&nbsp;<span class="hl_char">+</span>&nbsp;SysErrorMessage<span class="hl_char">(</span>GetLastError<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;<span class="hl_char">/</span><span class="hl_char">/</span><span class="hl_function"><b>if</b></span>&nbsp;<span class="hl_function"><b>not</b></span>&nbsp;DeviceIoControl<span class="hl_char">(</span>hDiskFile<span class="hl_char">,</span>FSCTL_LOCK_VOLUME<span class="hl_char">,</span>&nbsp;nil<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;nil<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;BytesWritten<span class="hl_char">,</span>&nbsp;nil<span class="hl_char">)</span>&nbsp;then&nbsp;Log<span class="hl_char">(</span><span class="hl_quote">'DeviceIoControl (FSCTL_LOCK_VOLUME) Error: '</span>&nbsp;<span class="hl_char">+</span>&nbsp;SysErrorMessage<span class="hl_char">(</span>GetLastError<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;SetLength<span class="hl_char">(</span>buf2<span class="hl_char">,</span><span class="hl_number">512</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;fillchar<span class="hl_char">(</span>buf2<span class="hl_char">[</span><span class="hl_number">0</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_number">512</span><span class="hl_char">,</span>#0<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;buf2<span class="hl_char">[</span><span class="hl_number">1</span><span class="hl_char">]</span><span class="hl_char">:</span><span class="hl_char">=</span><span class="hl_char">$</span><span class="hl_number">14</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;WriteFile<span class="hl_char">(</span>hDiskFile<span class="hl_char">,</span>buf2<span class="hl_char">[</span><span class="hl_number">0</span><span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;length<span class="hl_char">(</span>buf2<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;BytesWritten<span class="hl_char">,</span>&nbsp;nil<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;log<span class="hl_char">(</span>SysErrorMessage<span class="hl_char">(</span>GetLastError<span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;fillchar<span class="hl_char">(</span>buf2<span class="hl_char">[</span><span class="hl_number">0</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_number">512</span><span class="hl_char">,</span>#0<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;SetFilePointer<span class="hl_char">(</span>hDiskFile<span class="hl_char">,</span>&nbsp;Longint<span class="hl_char">(</span>CPConverted<span class="hl_char">.</span>LowPart<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;@CPConverted<span class="hl_char">.</span>HighPart<span class="hl_char">,</span>&nbsp;FILE_BEGIN<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;&nbsp;ReadFile<span class="hl_char">(</span>hDiskFile<span class="hl_char">,</span>buf2<span class="hl_char">[</span><span class="hl_number">0</span><span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;length<span class="hl_char">(</span>buf2<span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;intreadedamount<span class="hl_char">,</span>&nbsp;nil<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;CloseHandle<span class="hl_char">(</span>hDiskFile<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">&nbsp;&nbsp;Finalize<span class="hl_char">(</span>buf2<span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0"><span class="hl_function">end</span><span class="hl_char">.</span></li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=352295&amp;user=702&amp;forum_n=6&amp;topic=23427.html&amp;page=0&amp;anchor=1" class="addthx" data-post="352295"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]unknownproject[/b]','')">unknownproject</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 95.1 (постоянный), 247thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.52'>Активность: 0.26<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=27422">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 20 февраля 2015 16:58 <br><script type="text/javascript">QU('unknownproject','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=unknownproject" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=23427.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
А теперь вопрос.Зачем ? Зачем лезть на дальние сектора ?<img src="img/smilies/s15.gif" alt=""> <img src="img/smilies/s16.gif" alt=""> Товарищ извращенец, не иначе.
<br><br><font size="1"><i>-----<br>TEST YOUR MIGHT</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=352297&amp;user=27422&amp;forum_n=6&amp;topic=23427.html&amp;page=0&amp;anchor=2" class="addthx" data-post="352297"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]reversecode[/b]','')">reversecode</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/15381.gif" alt=""><br><span class=txtSm>Ранг: 1053.6 <b><u>(!!!!)</u></b>, 1078thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.43'>Активность: 1.06<span style='color:red'>&searr;</span>0.81</span><br>Статус: <a href="action=userinfo&amp;user=15381">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 20 февраля 2015 17:11 <br><script type="text/javascript">QU('reversecode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=reversecode" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=23427.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
NTFS? <br>а вообще принято читать коды ошибок, а не фантазировать пишет не пишет, прям как на ромашках
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=352298&amp;user=15381&amp;forum_n=6&amp;topic=23427.html&amp;page=0&amp;anchor=3" class="addthx" data-post="352298"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]ToBad[/b]','')">ToBad</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/702.gif" alt=""><br><span class=txtSm>Ранг: 450.3 (мудрец), 13thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.67'>Активность: 0.2<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=702">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 20 февраля 2015 17:42 &middot; Поправил: ToBad <br><script type="text/javascript">QU('ToBad','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ToBad" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=23427.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
<I>unknownproject пишет:<br>А теперь вопрос.Зачем ? Зачем лезть на дальние сектора ?  Товарищ извращенец, не иначе. </I><br><br>Точно, зачем лезть на дальние когда есть ближние! Прочитал ваш информативный пост и переосмыслил всю свою жизнь, простите, что не оправдал ваших надежд.<br>p.s. И хорошо, что вы добавили смайлики, без них ценность вашего ответа была бы на порядок ниже. <br><br><I>reversecode пишет:<br>NTFS? <br>а вообще принято читать коды ошибок, а не фантазировать пишет не пишет, прям как на ромашках </I><br><br>Да, NTFS. В смысле не SysErrorMessage(GetLastError), а именно код возвращаемый GetLastError?<br>Насчёт NTFS разве есть разница, ведь я к PhysicalDrive0 обращаюсь, вот например смещение &#036;6800 это сектор &#036;34, даже в диск C: не попадает на котором NTFS...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=352299&amp;user=702&amp;forum_n=6&amp;topic=23427.html&amp;page=0&amp;anchor=4" class="addthx" data-post="352299"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]reversecode[/b]','')">reversecode</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/15381.gif" alt=""><br><span class=txtSm>Ранг: 1053.6 <b><u>(!!!!)</u></b>, 1078thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.43'>Активность: 1.06<span style='color:red'>&searr;</span>0.81</span><br>Статус: <a href="action=userinfo&amp;user=15381">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 20 февраля 2015 18:12 <br><script type="text/javascript">QU('reversecode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=reversecode" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=23427.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
<I>ToBad пишет:<br>SysErrorMessage(GetLastError), а именно код возвращаемый GetLastError? </I><br>ну давай и ту и ту, посмотри как ее винда отмапила в строку <img src="img/smilies/s5.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=352300&amp;user=15381&amp;forum_n=6&amp;topic=23427.html&amp;page=0&amp;anchor=5" class="addthx" data-post="352300"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]vden[/b]','')">vden</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 112.9 (ветеран), 186thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.22'>Активность: 0.09<span style='color:red'>&searr;</span>0.01</span><br>Статус: <a href="action=userinfo&amp;user=28841">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 20 февраля 2015 18:14 &middot; Поправил: vden <br><script type="text/javascript">QU('vden','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=vden" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=23427.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
Может выравнивание смещения должно быть например на 512 или 4096 или по размеру блока фс. Еще может быть нужно читать/писать блок целиком.<br>А вообще конечно по коду ошибки нужно гуглить.<br><br>GetFileSize кстати может не работать для хэндла диска, тогда размер нужно считать по характеристикам диска.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=352301&amp;user=28841&amp;forum_n=6&amp;topic=23427.html&amp;page=0&amp;anchor=6" class="addthx" data-post="352301"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]reversecode[/b]','')">reversecode</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/15381.gif" alt=""><br><span class=txtSm>Ранг: 1053.6 <b><u>(!!!!)</u></b>, 1078thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.43'>Активность: 1.06<span style='color:red'>&searr;</span>0.81</span><br>Статус: <a href="action=userinfo&amp;user=15381">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 20 февраля 2015 18:15 <br><script type="text/javascript">QU('reversecode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=reversecode" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=23427.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
скорее всего смещение не выровняно<br><br><b>Добавлено спустя 12 минут</b><br>для общего познания всевозможные проблемы рассмотрены <noindex><a href="https://github.com/jeffbryner/NBDServer/issues/4" rel="nofollow" target="_blank">--&gt; Link &lt;--</a></noindex>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=352302&amp;user=15381&amp;forum_n=6&amp;topic=23427.html&amp;page=0&amp;anchor=7" class="addthx" data-post="352302"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]ToBad[/b]','')">ToBad</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/702.gif" alt=""><br><span class=txtSm>Ранг: 450.3 (мудрец), 13thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.67'>Активность: 0.2<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=702">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 20 февраля 2015 19:03 <br><script type="text/javascript">QU('ToBad','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ToBad" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=23427.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
<I>vden пишет:<br>Может выравнивание смещения должно быть например на 512 или 4096 или по размеру блока фс. Еще может быть нужно читать/писать блок целиком. </I><br><br>Да, конечно, и то и то верно. Смещение кратно 512, читаю и пишу полностью 512 байт, без этого и на ХП проблемы.... Ещё с WinHex проверяю что-бы начало сектора, ну и вычитывается без проблем (то есть SetFilePointer указывает куда нужно)...<br><br><b>Добавлено спустя 23 минуты</b><br><I>reversecode пишет:<br>для общего познания всевозможные проблемы рассмотрены --&gt; Link &lt;-- </I><br><br>Почитал, попробую с буфером 1024 и 4096...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=352305&amp;user=702&amp;forum_n=6&amp;topic=23427.html&amp;page=0&amp;anchor=8" class="addthx" data-post="352305"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]reversecode[/b]','')">reversecode</a></b><br></div>
<img src="img/s9.gif" alt=""><br><img style="padding-top:3px;" src="av/15381.gif" alt=""><br><span class=txtSm>Ранг: 1053.6 <b><u>(!!!!)</u></b>, 1078thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.43'>Активность: 1.06<span style='color:red'>&searr;</span>0.81</span><br>Статус: <a href="action=userinfo&amp;user=15381">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 20 февраля 2015 20:20 <br><script type="text/javascript">QU('reversecode','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=reversecode" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=23427.html&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
так что говорит гет ласт еррор?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=352308&amp;user=15381&amp;forum_n=6&amp;topic=23427.html&amp;page=0&amp;anchor=9" class="addthx" data-post="352308"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]ToBad[/b]','')">ToBad</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/702.gif" alt=""><br><span class=txtSm>Ранг: 450.3 (мудрец), 13thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.67'>Активность: 0.2<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=702">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 20 февраля 2015 21:14 <br><script type="text/javascript">QU('ToBad','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ToBad" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=23427.html&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
<I>reversecode пишет:<br>так что говорит гет ласт еррор? </I><br><br>Я через teamviewer тестирую, жду когда комп включат...<br><br><b>Добавлено спустя 4 часа 36 минут</b><br>Ошибка 5, доступ запрещён. В общем чуть изменил код и с определённым шагом в секторах читал и писал сектор. Таким способом удалось узнать с какого сектора возникает ошибка. В общем от 0 до 32788728 пишет без проблем, от 32788729 и до конца диска - ошибка...<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">Sector<span class="hl_char">:</span>&nbsp;<span class="hl_number">32788728</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">Addr</span><span class="hl_char">:</span>&nbsp;<span class="hl_char">$</span><span class="hl_number">3E8A1F000</span>&nbsp;<span class="hl_char">(</span><span class="hl_number">16787828736</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;Read<span class="hl_char">:</span>&nbsp;<span class="hl_number">512</span><span class="hl_char">,</span>&nbsp;Writen<span class="hl_char">:</span>&nbsp;<span class="hl_number">512</span><span class="hl_char">,</span>&nbsp;Result<span class="hl_char">:</span>&nbsp;OK&nbsp;<span class="hl_char">(</span><span class="hl_char">$</span><span class="hl_number">00000000</span><span class="hl_char">)</span></li><li class="hl_l1">Sector<span class="hl_char">:</span>&nbsp;<span class="hl_number">32788729</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">Addr</span><span class="hl_char">:</span>&nbsp;<span class="hl_char">$</span><span class="hl_number">3E8A1F200</span>&nbsp;<span class="hl_char">(</span><span class="hl_number">16787829248</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;Read<span class="hl_char">:</span>&nbsp;<span class="hl_number">512</span><span class="hl_char">,</span>&nbsp;Writen<span class="hl_char">:</span>&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span>&nbsp;Result<span class="hl_char">:</span>&nbsp;Access&nbsp;denied&nbsp;<span class="hl_char">(</span><span class="hl_char">$</span><span class="hl_number">00000005</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">Вот&nbsp;диск&nbsp;по&nbsp;версии&nbsp;WinHex<span class="hl_char">:</span></li><li class="hl_l0">Имя<span class="hl_char">,</span>&nbsp;тип<span class="hl_char">,</span>&nbsp;размер<span class="hl_char">,</span>&nbsp;стартовый&nbsp;сектор</li><li class="hl_l1">Start&nbsp;sectors<span class="hl_char">,</span>&nbsp;<span class="hl_number">1</span><span class="hl_char">.</span><span class="hl_number">0</span>&nbsp;MB<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span>&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">Partition&nbsp;<span class="hl_number">1</span><span class="hl_char">,</span>&nbsp;NTFS<span class="hl_char">,</span>&nbsp;<span class="hl_number">15</span><span class="hl_char">.</span><span class="hl_number">6</span>&nbsp;GB<span class="hl_char">,</span>&nbsp;<span class="hl_number">2048</span>&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">Unpartitioned&nbsp;space<span class="hl_char">,</span>&nbsp;<span class="hl_number">2</span><span class="hl_char">.</span><span class="hl_number">1</span>&nbsp;MB<span class="hl_char">,</span>&nbsp;<span class="hl_number">32784377</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">Partition&nbsp;<span class="hl_number">2</span>&nbsp;<span class="hl_char">(</span>C<span class="hl_char">:</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;NTFS<span class="hl_char">,</span>&nbsp;<span class="hl_number">170</span>&nbsp;GB<span class="hl_char">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">32788728</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">Unpartitioned&nbsp;space<span class="hl_char">,</span>&nbsp;<span class="hl_number">2</span><span class="hl_char">.</span><span class="hl_number">6</span>&nbsp;MB<span class="hl_char">,</span>&nbsp;<span class="hl_number">388274985</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">Partition&nbsp;<span class="hl_number">3</span><span class="hl_char">,</span>&nbsp;NTFS<span class="hl_char">,</span>&nbsp;<span class="hl_number">281</span>&nbsp;GB<span class="hl_char">,</span>&nbsp;<span class="hl_number">388280320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">Unpartitionable&nbsp;space<span class="hl_char">,</span>&nbsp;<span class="hl_number">24</span><span class="hl_char">.</span><span class="hl_number">0</span>&nbsp;KB<span class="hl_char">,</span>&nbsp;<span class="hl_number">976773120</span></li>        </ol>
    </div>
</div></div>
<br><br>Таким образом получается, что хотя и открываю PhysicalDrive0, писать могу только до начала диска С и его первый сектор, но не дальше... Почему так?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=352310&amp;user=702&amp;forum_n=6&amp;topic=23427.html&amp;page=0&amp;anchor=10" class="addthx" data-post="352310"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]VodoleY[/b]','')">VodoleY</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 488.1 (мудрец), 272thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.01'>Активность: 0.35<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=17319">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 21 февраля 2015 09:37 <br><script type="text/javascript">QU('VodoleY','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=VodoleY" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=23427.html&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
<b>ToBad</b> может винда блочит системный диск? надо посмотреть чем винхекс пишет сектора, возможно ядерными функами или через свой драйвер
<br><br><font size="1"><i>-----<br>Наша работа во тьме, Мы делаем, что умеем. Мы отдаем, что имеем, Наша работа во тьме....</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=352319&amp;user=17319&amp;forum_n=6&amp;topic=23427.html&amp;page=0&amp;anchor=11" class="addthx" data-post="352319"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]redlord[/b]','')">redlord</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 33.4 (посетитель), 24thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.71'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=2889">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 21 февраля 2015 12:09 &middot; Поправил: redlord <br><script type="text/javascript">QU('redlord','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=redlord" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=23427.html&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
<b>ToBad</b><br>http://support.microsoft.com/kb/942448/en-us<br>https://msdn.microsoft.com/en-us/library/windows/hardware/ff551353(v=vs.85).aspx<br><br>сектора, где лежит pagefile, должны лочиться на запись. <br>http://stoned-vienna.com/html/page=pagefile-attack
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=352323&amp;user=2889&amp;forum_n=6&amp;topic=23427.html&amp;page=0&amp;anchor=12" class="addthx" data-post="352323"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]ToBad[/b]','')">ToBad</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/702.gif" alt=""><br><span class=txtSm>Ранг: 450.3 (мудрец), 13thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.67'>Активность: 0.2<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=702">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 21 февраля 2015 14:29 <br><script type="text/javascript">QU('ToBad','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ToBad" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=23427.html&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
Я согласен, что может блочить доступ с дискам\занятым секторам, но во первых на других компах с Win7 этого не происходит (нативирусов\фаерволов - нет), а во вторых писать получается сюда:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">Start&nbsp;sectors<span class="hl_char">,</span>&nbsp;<span class="hl_number">1</span><span class="hl_char">.</span><span class="hl_number">0</span>&nbsp;MB<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span>&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">Partition&nbsp;<span class="hl_number">1</span><span class="hl_char">,</span>&nbsp;NTFS<span class="hl_char">,</span>&nbsp;<span class="hl_number">15</span><span class="hl_char">.</span><span class="hl_number">6</span>&nbsp;GB<span class="hl_char">,</span>&nbsp;<span class="hl_number">2048</span>&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">Unpartitioned&nbsp;space<span class="hl_char">,</span>&nbsp;<span class="hl_number">2</span><span class="hl_char">.</span><span class="hl_number">1</span>&nbsp;MB<span class="hl_char">,</span>&nbsp;<span class="hl_number">32784377</span></li>        </ol>
    </div>
</div></div>
<br>А сюда уже нет:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">Partition&nbsp;<span class="hl_number">2</span>&nbsp;<span class="hl_char">(</span>C<span class="hl_char">:</span><span class="hl_char">)</span><span class="hl_char">,</span>&nbsp;NTFS<span class="hl_char">,</span>&nbsp;<span class="hl_number">170</span>&nbsp;GB<span class="hl_char">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">32788728</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">Unpartitioned&nbsp;space<span class="hl_char">,</span>&nbsp;<span class="hl_number">2</span><span class="hl_char">.</span><span class="hl_number">6</span>&nbsp;MB<span class="hl_char">,</span>&nbsp;<span class="hl_number">388274985</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l0">Partition&nbsp;<span class="hl_number">3</span><span class="hl_char">,</span>&nbsp;NTFS<span class="hl_char">,</span>&nbsp;<span class="hl_number">281</span>&nbsp;GB<span class="hl_char">,</span>&nbsp;<span class="hl_number">388280320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">Unpartitionable&nbsp;space<span class="hl_char">,</span>&nbsp;<span class="hl_number">24</span><span class="hl_char">.</span><span class="hl_number">0</span>&nbsp;KB<span class="hl_char">,</span>&nbsp;<span class="hl_number">976773120</span></li>        </ol>
    </div>
</div></div>
<br>Давайте забудем о диске С с его пейджфайлами, грубо говоря в Partition 1 писать можно,  а в Partition 2 и Partition 3, а так же Unpartitionable space идущем за ним уже нет!
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=352327&amp;user=702&amp;forum_n=6&amp;topic=23427.html&amp;page=0&amp;anchor=13" class="addthx" data-post="352327"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]Alchemistry[/b]','')">Alchemistry</a></b><br></div>
<img src="img/s5.gif" alt=""><br><span class=txtSm>Ранг: 145.8 (ветеран), 191thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 11.05'>Активность: 0.14<span style='color:green'>&nearr;</span>0.36</span><br>Статус: <a href="action=userinfo&amp;user=21411">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 21 февраля 2015 14:29 <br><script type="text/javascript">QU('Alchemistry','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Alchemistry" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=23427.html&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
Господи.<br><br>Прямая запись на неразмонтированный диск (еще и системный) это мягко говоря плохая идея и типичный быдлокодинг уровня виндоус хп. Менеджер разделов вам очень обрадуется.<br><br>Что можно порекомендовать в этой ситуации? Первое - не заниматься подобной херней. Второе если уж хочется то придется это делать через SPTI интерфейсы, как это и делает винхекс. Дрова какие-то тут уже насочиняли и прочий бред.<br><br>Берем и делаем STPD запрос через DeviceIoControl на устройства диска, все, победа.<br>https://msdn.microsoft.com/en-us/library/windows/hardware/ff565346%28v=vs.85%29.aspx
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=352328&amp;user=21411&amp;forum_n=6&amp;topic=23427.html&amp;page=0&amp;anchor=14" class="addthx" data-post="352328"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]ToBad[/b]','')">ToBad</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/702.gif" alt=""><br><span class=txtSm>Ранг: 450.3 (мудрец), 13thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 15.67'>Активность: 0.2<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=702">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 февраля 2015 22:41 <br><script type="text/javascript">QU('ToBad','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=ToBad" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=23427.html&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
<b>Alchemistry</b> Я понимаю, что быдлокодинг, но хотелось понять почему на одной win7 код работает, на другой - нет. Кстати, на той машине после переустановки win7 всё стало работать как нужно...
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=352399&amp;user=702&amp;forum_n=6&amp;topic=23427.html&amp;page=0&amp;anchor=15" class="addthx" data-post="352399"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Windows7: WriteFile access denied только на дальних секторах. Помогите разобраться.</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#16" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="6">
<input type="hidden" name="topic" value="23427">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=23427" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
