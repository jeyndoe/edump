<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Программа под отладчиком работает не так как без отладчика. Магия? - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Code:       .386.model&nbsp;&nbsp;flat,&nbsp;stdcalloption&nbsp;&nbsp;casemap:none&nbsp;include&nbsp;&nbsp;&nbsp;&nbsp;\masm32\include\windows.incinclude&nbsp;&nbsp;&nbsp;&nbsp;\masm32\include\kernel32.incincludelib&nbsp;\masm32\l">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=40382'>jinoweb</a> (+4 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Программа под отладчиком работает не так как без отладчика. Магия?</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]philimonix[/b]','')">philimonix</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 4.6 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.3'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=40485">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 марта 2016 04:32 <br><script type="text/javascript">QU('philimonix','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=philimonix" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24075.html&amp;page=0#1');return false;">#1</a> </span><div align=left><br><div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_char">.</span><span class="hl_number">386</span></li><li class="hl_l1"><span class="hl_char">.</span><span class="hl_function"><b>model</b></span>&nbsp;&nbsp;<span class="hl_function">flat</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">stdcall</span></li><li class="hl_l0"><span class="hl_function"><b>option</b></span>&nbsp;&nbsp;casemap<span class="hl_char">:</span><span class="hl_function">none</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_function"><b>include</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">\</span>masm32<span class="hl_char">\</span>include<span class="hl_char">\</span>windows<span class="hl_char">.</span><span class="hl_function">inc</span></li><li class="hl_l1"><span class="hl_function"><b>include</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">\</span>masm32<span class="hl_char">\</span>include<span class="hl_char">\</span>kernel32<span class="hl_char">.</span><span class="hl_function">inc</span></li><li class="hl_l0"><span class="hl_function"><b>includelib</b></span>&nbsp;<span class="hl_char">\</span>masm32<span class="hl_char">\</span>lib<span class="hl_char">\</span>user32<span class="hl_char">.</span>lib</li><li class="hl_l1"><span class="hl_function"><b>includelib</b></span>&nbsp;<span class="hl_char">\</span>masm32<span class="hl_char">\</span>lib<span class="hl_char">\</span>kernel32<span class="hl_char">.</span>lib</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">GetFName&nbsp;<span class="hl_function">proto</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_char">.</span><span class="hl_function">data</span></li><li class="hl_l0">fHandle&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l1">stdout&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l0">cWritten&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l1">error&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>BYTE</b></span>&nbsp;&nbsp;<span class="hl_quote">&quot;Нет такого файла&quot;</span></li><li class="hl_l0">noname&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>BYTE</b></span>&nbsp;&nbsp;<span class="hl_quote">&quot;Укажите имя файла&quot;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_char">.</span><span class="hl_function">code</span></li><li class="hl_l1">start<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;main&nbsp;<span class="hl_function">proc</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;&nbsp;GetStdHandle<span class="hl_char">,</span>&nbsp;STD_OUTPUT_HANDLE</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stdout<span class="hl_char">,</span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;&nbsp;GetFName</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cmp</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jz</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;empty</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;&nbsp;CreateFile<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GENERIC_READ<span class="hl_char">,</span>&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OPEN_EXISTING<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FILE_ATTRIBUTE_NORMAL<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">0</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cmp</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>INVALID_HANDLE_VALUE</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jz</b></span>&nbsp;&nbsp;exit</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fHandle<span class="hl_char">,</span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;&nbsp;CloseHandle<span class="hl_char">,</span>&nbsp;fHandle</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;&nbsp;ExitProcess<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;exit<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;&nbsp;WriteConsoleA<span class="hl_char">,</span>&nbsp;stdout<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>ADDR</b></span>&nbsp;error<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>sizeof</b></span>&nbsp;error<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>ADDR</b></span>&nbsp;cWritten<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;&nbsp;ExitProcess<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;empty<span class="hl_char">:</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;&nbsp;WriteConsoleA<span class="hl_char">,</span>&nbsp;stdout<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>ADDR</b></span>&nbsp;noname<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>sizeof</b></span>&nbsp;noname<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>ADDR</b></span>&nbsp;cWritten<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;&nbsp;ExitProcess<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;main&nbsp;<span class="hl_function">endp</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;GetFName&nbsp;<span class="hl_function">proc</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;&nbsp;GetCommandLine</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>eax</b></span>&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">edi</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">al</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span>&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span><span class="hl_char">-</span><span class="hl_number">1</span>&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">cld</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>repne</b></span>&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>scasb</b></span>&nbsp;<span class="hl_comment">;ищем нулевой символ, чтобы определить конец командной строки</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>not</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">ecx</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>pop</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr"><b>edi</b></span>&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">al</span><span class="hl_char">,</span><span class="hl_number">20h</span>&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>repne</b></span>&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>scasb</b></span>&nbsp;<span class="hl_comment">;ищем пробел, чтобы отделить параметр, переданный в командной строке</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>dec</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr"><b>edi</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;проверяем ..</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cmp</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>byte</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">edi</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_number">0</span>&nbsp;&nbsp;<span class="hl_comment">;.. не ноль ли мы нашли вместо пробела</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jz</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;empty&nbsp;<span class="hl_comment">;.. если ноль, то параметра не было.. </span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>inc</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr"><b>edi</b></span>&nbsp;<span class="hl_comment">;.. если не ноль, то переходим к первому символу параметра</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr"><b>edi</b></span>&nbsp;<span class="hl_comment">;возвращаем адрес начала строки с параметром</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">ret</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;empty<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_char">-</span><span class="hl_number">1</span>&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">ret</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;GetFName&nbsp;<span class="hl_function">endp</span></li><li class="hl_l1"><span class="hl_function"><b>end</b></span>&nbsp;start</li>        </ol>
    </div>
</div></div>
<br>Прога запускается в консоли. Получает параметр. Если параметр не передать, то выводится &quot;Укажите имя файла&quot;. Если параметр передан, то прога должна вывести &quot;Нет такого файла&quot; в том случае, если параметр не является именем существующего файла. Если же параметр является именем существующего файла, то никакого вывода не должно быть, прога просто отрабатывает и завершается. <br>Но! Если я не передаю параметр, то всё происходит правильно, и прога выдаёт &quot;Укажите имя файла&quot;. А вот если я передаю ей параметр, то она в любом случае выдаёт &quot;Нет такого файла&quot;, даже если параметр является именем существующего файла. Но если запустить прогу под отладчиком и передать правильный параметр, то она завершается правильно (если проследить за поиском строки, то видно, что название параметра обрабатывается верно, и в регистре EAX действительно передаётся верный адрес.. и прога переходит на нужную ветку исполнения, и завершается верно). В качестве отладчика использую OllyDbg.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=363732&amp;user=40485&amp;forum_n=6&amp;topic=24075.html&amp;page=0&amp;anchor=1" class="addthx" data-post="363732"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]plutos[/b]','')">plutos</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/4773.png" alt=""><br><span class=txtSm>Ранг: 622.6 (<b>!</b>), 521thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.16'>Активность: 0.33<span style='color:green'>&nearr;</span>0.89</span><br>Статус: <a href="action=userinfo&amp;user=4773">Участник</a><br><font color=blue>_Вечный_Студент_</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 марта 2016 06:42 <br><script type="text/javascript">QU('plutos','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=plutos" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24075.html&amp;page=0#2');return false;">#2</a> </span><div align=left><br>
А как вы передаете параметер программе если она запущена под OllyDbg?
<br><br><font size="1"><i>-----<br>Give me a HANDLE and I will move the Earth.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=363733&amp;user=4773&amp;forum_n=6&amp;topic=24075.html&amp;page=0&amp;anchor=2" class="addthx" data-post="363733"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]philimonix[/b]','')">philimonix</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 4.6 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.3'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=40485">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 марта 2016 06:53 <br><script type="text/javascript">QU('philimonix','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=philimonix" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24075.html&amp;page=0#3');return false;">#3</a> </span><div align=left><br>
<I>plutos пишет:<br>А как вы передаете параметер программе если она запущена под OllyDbg?  </I><br>Открываем OllyDbg, заходим в меню File -&gt; Open. Выбираем нужную программу, а чуть ниже имени программы есть строчка Arguments. <br>На, а можно просто в консоли набрать &quot;ollydbg programma.exe argument&quot;.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=363734&amp;user=40485&amp;forum_n=6&amp;topic=24075.html&amp;page=0&amp;anchor=3" class="addthx" data-post="363734"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]plutos[/b]','')">plutos</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/4773.png" alt=""><br><span class=txtSm>Ранг: 622.6 (<b>!</b>), 521thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.16'>Активность: 0.33<span style='color:green'>&nearr;</span>0.89</span><br>Статус: <a href="action=userinfo&amp;user=4773">Участник</a><br><font color=blue>_Вечный_Студент_</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 марта 2016 07:01 &middot; Поправил: plutos <br><script type="text/javascript">QU('plutos','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=plutos" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24075.html&amp;page=0#4');return false;">#4</a> </span><div align=left><br>
Да, с параметрами в отладчике все правильно. <br><br>Хотел пробежаться по коду в той же ollyDbg, но меня почему-то AVG anti-virus на вашу программу сильно ругается: <br>Downloader Tibs Summary  <br>Downloader Tibs is a malicious application that allows hackers to remotely access you computer system letting them modify files, steal personal information and install more unwanted software. These kinds of threats, called Trojan horse, must be sent to you by someone or carried by another program. They may also arrive thanks to unwanted downloads on infected websites or installed with online games or other internet-driven applications. Most Trojan horses can be detected and removed by AVG.
<br><br><font size="1"><i>-----<br>Give me a HANDLE and I will move the Earth.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=363735&amp;user=4773&amp;forum_n=6&amp;topic=24075.html&amp;page=0&amp;anchor=4" class="addthx" data-post="363735"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]philimonix[/b]','')">philimonix</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 4.6 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.3'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=40485">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 марта 2016 07:22 <br><script type="text/javascript">QU('philimonix','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=philimonix" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24075.html&amp;page=0#5');return false;">#5</a> </span><div align=left><br>
<I>plutos пишет:<br>но меня почему-то AVG anti-virus на вашу программу сильно ругается. У вас нет?  </I><br>Я не пользуюсь антивирусами <img src="img/smilies/s1.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=363736&amp;user=40485&amp;forum_n=6&amp;topic=24075.html&amp;page=0&amp;anchor=5" class="addthx" data-post="363736"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]plutos[/b]','')">plutos</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/4773.png" alt=""><br><span class=txtSm>Ранг: 622.6 (<b>!</b>), 521thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.16'>Активность: 0.33<span style='color:green'>&nearr;</span>0.89</span><br>Статус: <a href="action=userinfo&amp;user=4773">Участник</a><br><font color=blue>_Вечный_Студент_</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 марта 2016 07:47 &middot; Поправил: plutos <br><script type="text/javascript">QU('plutos','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=plutos" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24075.html&amp;page=0#6');return false;">#6</a> </span><div align=left><br>
<I>philimonix пишет:<br>выдаёт &quot;Нет такого файла&quot;, даже если параметр является именем существующего файла </I><br><br>Добавьте вот такой код сразу после вызова CreateFile.<br> Может вы посылаете имя файла, который действительно существует, но что-то не срабатывает как надо в CreateFile.<br>Скажем, у одного процесса нет достаточных привилегий (to OPEN_EXISTING), а у другого есть, и т.д.<br> Ведь &quot;под отладчиком&quot; это один процесс, а  &quot;без отладчика&quot; уже совсем другой.<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>LOCAL</b></span>&nbsp;&nbsp;&nbsp;dwLastErr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">:</span><span class="hl_function">DWORD</span><span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;szError<span class="hl_char">[</span><span class="hl_number">1024</span><span class="hl_char">]</span>&nbsp;&nbsp;&nbsp;<span class="hl_char">:</span><span class="hl_function">BYTE</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;GetLastError</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;dwLastErr<span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;FormatMessage<span class="hl_char">,</span>FORMAT_MESSAGE_FROM_SYSTEM<span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span>dwLastErr<span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span><span class="hl_function"><b>ADDR</b></span>&nbsp;szError<span class="hl_char">,</span><span class="hl_number">1024</span><span class="hl_char">,</span><span class="hl_number">0</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;<span class="hl_function">str</span><span class="hl_char">$</span><span class="hl_char">(</span>dwLastErr<span class="hl_char">)</span><span class="hl_char">,</span><span class="hl_quote">&quot; &quot;</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;<span class="hl_function"><b>ADDR</b></span>&nbsp;szError<span class="hl_char">,</span><span class="hl_number">13</span><span class="hl_char">,</span><span class="hl_number">10</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;</li>        </ol>
    </div>
</div></div><br><br><font size="1"><i>-----<br>Give me a HANDLE and I will move the Earth.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=363737&amp;user=4773&amp;forum_n=6&amp;topic=24075.html&amp;page=0&amp;anchor=6" class="addthx" data-post="363737"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]philimonix[/b]','')">philimonix</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 4.6 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.3'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=40485">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 марта 2016 08:10 <br><script type="text/javascript">QU('philimonix','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=philimonix" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24075.html&amp;page=0#7');return false;">#7</a> </span><div align=left><br>
<I>plutos пишет:<br>Добавьте вот такой код сразу после вызова CreateFile. </I><br>Что-то много ругани от компилятора из-за этих строчек.<br><br><img src="img/attach.gif" alt=""> <a href="./files/7c26_27.03.2016_EXELAB.rU.tgz">7c26_27.03.2016_EXELAB.rU.tgz</a> - ругань.png
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=363738&amp;user=40485&amp;forum_n=6&amp;topic=24075.html&amp;page=0&amp;anchor=7" class="addthx" data-post="363738"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]Prober[/b]','')">Prober</a></b><br></div>
<img src="img/s4.gif" alt=""><br><span class=txtSm>Ранг: 51.8 (постоянный), 58thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 13.33'>Активность: 0.03=0.03</span><br>Статус: <a href="action=userinfo&amp;user=10543">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 марта 2016 08:22 <br><script type="text/javascript">QU('Prober','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Prober" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24075.html&amp;page=0#8');return false;">#8</a> </span><div align=left><br>
<b>philimonix</b>, сделайте на си простейшую программу (можно и на MASM, просто на си короче и быстрее):<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>void</b></span>&nbsp;main<span class="hl_char">(</span><span class="hl_function">void</span><span class="hl_char">)</span></li><li class="hl_l1">{</li><li class="hl_l0">printf<span class="hl_char">(</span><span class="hl_quote">&quot;%s\n&quot;</span><span class="hl_char">,</span>&nbsp;GetCommandLine<span class="hl_char">(</span><span class="hl_char">)</span><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l1">return<span class="hl_comment">;</span></li><li class="hl_l0">}</li>        </ol>
    </div>
</div></div>
<br>Запустите её из-под CMD, а потом в отладчике, сразу увидите разницу.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=363739&amp;user=10543&amp;forum_n=6&amp;topic=24075.html&amp;page=0&amp;anchor=8" class="addthx" data-post="363739"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]plutos[/b]','')">plutos</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/4773.png" alt=""><br><span class=txtSm>Ранг: 622.6 (<b>!</b>), 521thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.16'>Активность: 0.33<span style='color:green'>&nearr;</span>0.89</span><br>Статус: <a href="action=userinfo&amp;user=4773">Участник</a><br><font color=blue>_Вечный_Студент_</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 марта 2016 08:37 &middot; Поправил: plutos <br><script type="text/javascript">QU('plutos','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=plutos" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24075.html&amp;page=0#9');return false;">#9</a> </span><div align=left><br>
<I>philimonix пишет:<br>Что-то много ругани от компилятора из-за этих строчек. </I><br><br>уберите директиву <strike>LOCAL</strike>  и убедитесь, что эти две строчки <br><br>dwLastErr       :DWORD,<br>szError[1024]   :BYTE<br><br>находятся в секции .data.<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_char">.</span><span class="hl_function">data</span></li><li class="hl_l1">fHandle&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l0">stdout&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l1">cWritten&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l0">error&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>BYTE</b></span>&nbsp;&nbsp;<span class="hl_quote">&quot;Нет такого файла&quot;</span></li><li class="hl_l1">noname&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>BYTE</b></span>&nbsp;&nbsp;<span class="hl_quote">&quot;Укажите имя файла&quot;</span></li><li class="hl_l0">dwLastErr&nbsp;<span class="hl_function">DWORD</span><span class="hl_char">,</span></li><li class="hl_l1">szError<span class="hl_char">[</span><span class="hl_number">1024</span><span class="hl_char">]</span>&nbsp;<span class="hl_function">BYTE</span></li><li class="hl_l0">&nbsp;</li>        </ol>
    </div>
</div></div><br><br><font size="1"><i>-----<br>Give me a HANDLE and I will move the Earth.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=363740&amp;user=4773&amp;forum_n=6&amp;topic=24075.html&amp;page=0&amp;anchor=9" class="addthx" data-post="363740"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]philimonix[/b]','')">philimonix</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 4.6 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.3'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=40485">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 марта 2016 08:52 &middot; Поправил: philimonix <br><script type="text/javascript">QU('philimonix','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=philimonix" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24075.html&amp;page=0#10');return false;">#10</a> </span><div align=left><br>
<I>plutos пишет:<br>dwLastErr :DWORD,<br>szError[1024] :BYTE<br> </I><br>На такие строчки тоже ругается.. Я вот так ещё попробовал:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">dwLastErr&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l1">szError&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>BYTE</b></span>&nbsp;<span class="hl_number">1024</span>&nbsp;<span class="hl_function"><b>dup</b></span>&nbsp;<span class="hl_char">(</span><span class="hl_char">?</span><span class="hl_char">)</span></li>        </ol>
    </div>
</div></div>
<br><br>.. тогда перестал ругаться на эти строчки и стал ругаться на print.. <br><br><img src="img/attach.gif" alt=""> <a href="./files/e743_27.03.2016_EXELAB.rU.tgz">e743_27.03.2016_EXELAB.rU.tgz</a> - 123.png
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=363741&amp;user=40485&amp;forum_n=6&amp;topic=24075.html&amp;page=0&amp;anchor=10" class="addthx" data-post="363741"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]plutos[/b]','')">plutos</a></b><br></div>
<img src="img/s8.gif" alt=""><br><img style="padding-top:3px;" src="av/4773.png" alt=""><br><span class=txtSm>Ранг: 622.6 (<b>!</b>), 521thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 14.16'>Активность: 0.33<span style='color:green'>&nearr;</span>0.89</span><br>Статус: <a href="action=userinfo&amp;user=4773">Участник</a><br><font color=blue>_Вечный_Студент_</font></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 марта 2016 09:17 &middot; Поправил: plutos <br><script type="text/javascript">QU('plutos','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=plutos" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24075.html&amp;page=0#11');return false;">#11</a> </span><div align=left><br>
А что касается print, то можно обойтись и без нее (иначе мы еще больше запутаемся).<br><br>уберите 3 строчки<br><strike>invoke FormatMessage,FORMAT_MESSAGE_FROM_SYSTEM,0,dwLastErr,0,ADDR szError,1024,0<br> print str&#036;(dwLastErr),&quot; &quot;<br> print ADDR szError,13,10<br></strike><br>и посмотрите, что будет в регистре eax после вызова GetLastError. Там должен быть код ошибки. потом посмотрите, какой именно ошибке этот код соответствует вот на этой странице:<br>https://msdn.microsoft.com/en-us/library/windows/desktop/ms681382(v=vs.85).aspx
<br><br><font size="1"><i>-----<br>Give me a HANDLE and I will move the Earth.</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=363742&amp;user=4773&amp;forum_n=6&amp;topic=24075.html&amp;page=0&amp;anchor=11" class="addthx" data-post="363742"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]philimonix[/b]','')">philimonix</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 4.6 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.3'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=40485">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 марта 2016 11:56 &middot; Поправил: philimonix <br><script type="text/javascript">QU('philimonix','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=philimonix" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24075.html&amp;page=0#12');return false;">#12</a> </span><div align=left><br>
<I>plutos пишет:<br>и посмотрите, что будет в регистре eax после вызова GetLastError. Там должен быть код ошибки.  </I><br>Убрал всё непонятное, просто добавил вызов GetLastError() после вызова CreateFile(). В EAX оказался ноль. Я так понимаю, это означает, что CreateFile() отработала без нареканий. Специально потом вызвал программу с неправильным аргументом, тогда GetLastError поместила в EAX двойку, что значит &quot;файл не найден&quot;. Получается, что CreateFile работает верно. <br><br>Ещё нюанс. Добавил вот такой код в секцию .data<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">buf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>db</b></span>&nbsp;<span class="hl_number">32</span>&nbsp;<span class="hl_function">dup</span><span class="hl_char">(</span><span class="hl_char">?</span><span class="hl_char">)</span></li><li class="hl_l1">formatStr&nbsp;<span class="hl_function"><b>db</b></span>&nbsp;<span class="hl_quote">&quot;%d&quot;</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span></li>        </ol>
    </div>
</div></div>
<br>И вот такой код в секцию .code<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>invoke</b></span>&nbsp;&nbsp;GetLastError</li><li class="hl_l1"><span class="hl_function"><b>invoke</b></span>&nbsp;&nbsp;wsprintf<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>ADDR</b></span>&nbsp;buf<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>ADDR</b></span>&nbsp;formatStr<span class="hl_char">,</span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l0"><span class="hl_function"><b>invoke</b></span>&nbsp;&nbsp;WriteConsoleA<span class="hl_char">,</span>&nbsp;stdout<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>ADDR</b></span>&nbsp;buf<span class="hl_char">,</span>&nbsp;<span class="hl_number">32</span><span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>ADDR</b></span>&nbsp;cWritten<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span></li>        </ol>
    </div>
</div></div>
<br>В консоль выводится двойка, что означает &quot;файл не найден&quot;, а если запускать в отладчике, то в EAX оказывается ноль. <br><br><I>Prober пишет:<br>Запустите её из-под CMD, а потом в отладчике, сразу увидите разницу. </I><br>Видимо, всё дело в том, что хоть программа одна и та же, но процессы разные.. получается, что одна и та же прога выполняется в разных контекстах, потому и результаты различны. Но, даже если так, хотелось бы всё-таки разобраться во всех нюансах. Если всё так, то тогда должна быть ошибка в коде, которая почему-то исправляется отладчиком. <br><br>Короче, я совсем уже запутался)))
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=363746&amp;user=40485&amp;forum_n=6&amp;topic=24075.html&amp;page=0&amp;anchor=12" class="addthx" data-post="363746"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]dosprog[/b]','')">dosprog</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 431.7 (мудрец), 390thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.95'>Активность: 0.73<span style='color:red'>&searr;</span>0.32</span><br>Статус: <a href="action=userinfo&amp;user=35473">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 марта 2016 12:20 &middot; Поправил: dosprog <br><script type="text/javascript">QU('dosprog','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=dosprog" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24075.html&amp;page=0#13');return false;">#13</a> </span><div align=left><br>
<I>philimonix пишет:<br>Короче, я совсем уже запутался)))  </I><br><br>Не надо путаться.<br><br>Просто так неаккуратно разбор строки не делают. Это путь к трудноустранимым глюкам.<br>OllyDbg вставляет перед аргументом ОДИН символ пробела,<br>тогда как в реальности система вставляет ДВА символа пробела.<br>Отсюда и плясать.  <br><br><br>Вот это будет работать, но название этому <b>говнокод</b>, уж сорри:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_char">.</span><span class="hl_number">386</span></li><li class="hl_l1"><span class="hl_char">.</span><span class="hl_function"><b>model</b></span>&nbsp;&nbsp;<span class="hl_function">flat</span><span class="hl_char">,</span>&nbsp;<span class="hl_function">stdcall</span></li><li class="hl_l0"><span class="hl_function"><b>option</b></span>&nbsp;&nbsp;casemap<span class="hl_char">:</span><span class="hl_function">none</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_function"><b>include</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">\</span>masm32<span class="hl_char">\</span>include<span class="hl_char">\</span>windows<span class="hl_char">.</span><span class="hl_function">inc</span></li><li class="hl_l1"><span class="hl_function"><b>include</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">\</span>masm32<span class="hl_char">\</span>include<span class="hl_char">\</span>kernel32<span class="hl_char">.</span><span class="hl_function">inc</span></li><li class="hl_l0"><span class="hl_function"><b>includelib</b></span>&nbsp;<span class="hl_char">\</span>masm32<span class="hl_char">\</span>lib<span class="hl_char">\</span>user32<span class="hl_char">.</span>lib</li><li class="hl_l1"><span class="hl_function"><b>includelib</b></span>&nbsp;<span class="hl_char">\</span>masm32<span class="hl_char">\</span>lib<span class="hl_char">\</span>kernel32<span class="hl_char">.</span>lib</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">GetFName&nbsp;<span class="hl_function">proto</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_char">.</span><span class="hl_function">data</span></li><li class="hl_l0">fHandle&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l1">stdout&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l0">cWritten&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l1">error&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>BYTE</b></span>&nbsp;&nbsp;<span class="hl_quote">&quot;File not found&quot;</span></li><li class="hl_l0">noname&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>BYTE</b></span>&nbsp;&nbsp;<span class="hl_quote">&quot;Give me file name...&quot;</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">sz_ok&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>BYTE</b></span>&nbsp;&nbsp;<span class="hl_quote">&quot;Opened OK.&quot;</span></li><li class="hl_l1">fname&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>db</b></span>&nbsp;<span class="hl_number">200h</span>&nbsp;<span class="hl_function">dup</span><span class="hl_char">(</span><span class="hl_char">?</span><span class="hl_char">)</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_char">.</span><span class="hl_function">code</span></li><li class="hl_l0">start<span class="hl_char">:</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">main&nbsp;<span class="hl_function">proc</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;&nbsp;GetStdHandle<span class="hl_char">,</span>&nbsp;STD_OUTPUT_HANDLE</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stdout<span class="hl_char">,</span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;&nbsp;GetFName</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cmp</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;<span class="hl_char">-</span><span class="hl_number">1</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jz</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;empty</li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;&nbsp;CreateFile<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GENERIC_READ<span class="hl_char">,</span>&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">0</span><span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">NULL</span><span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OPEN_EXISTING<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FILE_ATTRIBUTE_NORMAL<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_number">0</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cmp</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>INVALID_HANDLE_VALUE</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jz</b></span>&nbsp;&nbsp;exit</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;&nbsp;WriteConsoleA<span class="hl_char">,</span>&nbsp;stdout<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>ADDR</b></span>&nbsp;sz_ok<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>sizeof</b></span>&nbsp;sz_ok<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>ADDR</b></span>&nbsp;cWritten<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fHandle<span class="hl_char">,</span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;&nbsp;CloseHandle<span class="hl_char">,</span>&nbsp;fHandle</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;&nbsp;ExitProcess<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;exit<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;&nbsp;WriteConsoleA<span class="hl_char">,</span>&nbsp;stdout<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>ADDR</b></span>&nbsp;error<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>sizeof</b></span>&nbsp;error<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>ADDR</b></span>&nbsp;cWritten<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;&nbsp;ExitProcess<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;empty<span class="hl_char">:</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;&nbsp;WriteConsoleA<span class="hl_char">,</span>&nbsp;stdout<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>ADDR</b></span>&nbsp;noname<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>sizeof</b></span>&nbsp;noname<span class="hl_char">,</span>&nbsp;<span class="hl_function"><b>ADDR</b></span>&nbsp;cWritten<span class="hl_char">,</span>&nbsp;<span class="hl_function">NULL</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;&nbsp;ExitProcess<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span></li><li class="hl_l1">main&nbsp;<span class="hl_function">endp</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">GetFName&nbsp;<span class="hl_function">proc</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;&nbsp;GetCommandLine</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>eax</b></span>&nbsp;</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr"><b>edi</b></span>&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">al</span><span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span>&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span><span class="hl_char">-</span><span class="hl_number">1</span>&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">cld</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>repne</b></span>&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>scasb</b></span>&nbsp;<span class="hl_comment">;ищем нулевой символ, чтобы определить конец командной строки</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>not</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">ecx</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>pop</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr"><b>edi</b></span>&nbsp;</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">al</span><span class="hl_char">,</span><span class="hl_number">20h</span>&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>repne</b></span>&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>scasb</b></span>&nbsp;<span class="hl_comment">;ищем пробел, чтобы отделить параметр, переданный в командной строке</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>dec</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr"><b>edi</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_comment">;проверяем ..</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">@@eat_blanks<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>inc</b></span>&nbsp;<span class="hl_registr">edi</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cmp</b></span>&nbsp;<span class="hl_function"><b>byte</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">edi</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_quote">' '</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jz</b></span>&nbsp;@@eat_blanks</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>dec</b></span>&nbsp;<span class="hl_registr">edi</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cmp</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>byte</b></span>&nbsp;<span class="hl_function"><b>ptr</b></span>&nbsp;<span class="hl_char">[</span><span class="hl_registr">edi</span><span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_number">0</span>&nbsp;&nbsp;<span class="hl_comment">;.. не ноль ли мы нашли вместо пробела</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jz</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;empty&nbsp;<span class="hl_comment">;.. если ноль, то параметра не было..</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>inc</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr"><b>edi</b></span>&nbsp;<span class="hl_comment">;.. если не ноль, то переходим к первому символу параметра</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr"><b>edi</b></span>&nbsp;<span class="hl_comment">;возвращаем адрес начала строки с параметром</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>push</b></span>&nbsp;&nbsp;<span class="hl_registr">edi</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">esi</span><span class="hl_char">,</span><span class="hl_registr">edi</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span><span class="hl_function"><b>offset</b></span>&nbsp;fname</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>xor</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l1">@@cp_next<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cld</b></span>&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">lodsb</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">stosw</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>dec</b></span>&nbsp;<span class="hl_registr">edi</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cmp</b></span>&nbsp;<span class="hl_registr">al</span><span class="hl_char">,</span><span class="hl_number">0</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jz</b></span>&nbsp;@@cp_ok</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cmp</b></span>&nbsp;<span class="hl_registr">al</span><span class="hl_char">,</span><span class="hl_quote">' '</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jz</b></span>&nbsp;@@cp_ok</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cmp</b></span>&nbsp;<span class="hl_registr">al</span><span class="hl_char">,</span><span class="hl_number">8</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jz</b></span>&nbsp;@@cp_ok</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jmp</b></span>&nbsp;@@cp_next</li><li class="hl_l1">@@cp_ok<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>pop</b></span>&nbsp;<span class="hl_registr">edi</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_function"><b>offset</b></span>&nbsp;fname</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">ret</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;empty<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_char">-</span><span class="hl_number">1</span>&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">ret</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;GetFName&nbsp;<span class="hl_function">endp</span></li><li class="hl_l0"><span class="hl_function"><b>end</b></span>&nbsp;start</li>        </ol>
    </div>
</div></div>
<br><br>Ото и вся магия..
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=363747&amp;user=35473&amp;forum_n=6&amp;topic=24075.html&amp;page=0&amp;anchor=13" class="addthx" data-post="363747"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]philimonix[/b]','')">philimonix</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 4.6 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.3'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=40485">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 марта 2016 12:36 <br><script type="text/javascript">QU('philimonix','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=philimonix" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24075.html&amp;page=0#14');return false;">#14</a> </span><div align=left><br>
<I>dosprog пишет:<br>Просто так неаккуратно разбор строки не делают. Это путь к трудноустранимым глюкам. </I><br>Это я уже понял)) Просто это пример из книги. А я такой человек, что если столкнулся с такой ерундой, то у меня всё зудит до тех пор пока не пойму в чём дело))<br>Забавненько)) Ваш код правильно работает в консоли, но неправильно под отладчиком)) Теперь всё наоборот) Но теперь уже видно, что отладчик &quot;съедает&quot; первый символ параметра. <br><br>Полегчало немного)) Спасибо))
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=363748&amp;user=40485&amp;forum_n=6&amp;topic=24075.html&amp;page=0&amp;anchor=14" class="addthx" data-post="363748"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]dosprog[/b]','')">dosprog</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 431.7 (мудрец), 390thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.95'>Активность: 0.73<span style='color:red'>&searr;</span>0.32</span><br>Статус: <a href="action=userinfo&amp;user=35473">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 марта 2016 12:38 &middot; Поправил: dosprog <br><script type="text/javascript">QU('dosprog','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=dosprog" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24075.html&amp;page=0#15');return false;">#15</a> </span><div align=left><br>
<I>philimonix пишет:<br>Это я уже понял)) Просто это пример из книги.  </I><br><br>Тогда понятно. .<br><br><I>philimonix пишет:<br>что отладчик &quot;съедает&quot; первый символ параметра.<br> </I><br>Программа кривая его съедает, а не отладчик..<br><br><br><I>philimonix пишет:<br>Ваш код правильно работает в консоли, но неправильно под отладчиком)) </I><br><br>Поправил. Теперь всё в порядке в обоих случаях (сравнительно..)
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=363749&amp;user=35473&amp;forum_n=6&amp;topic=24075.html&amp;page=0&amp;anchor=15" class="addthx" data-post="363749"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]VodoleY[/b]','')">VodoleY</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 488.1 (мудрец), 272thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.01'>Активность: 0.35<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=17319">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 марта 2016 12:40 <br><script type="text/javascript">QU('VodoleY','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=VodoleY" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24075.html&amp;page=0#16');return false;">#16</a> </span><div align=left><br>
<I>philimonix пишет:<br>Но теперь уже видно, что отладчик &quot;съедает&quot; первый символ параметра. <br> </I><br>отладчики ничего не сьедают. это или руки кривые.. или понимание процесса отсутсвует.. все что может сьесть отладчик.. это эксепшены.
<br><br><font size="1"><i>-----<br>Наша работа во тьме, Мы делаем, что умеем. Мы отдаем, что имеем, Наша работа во тьме....</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=363750&amp;user=17319&amp;forum_n=6&amp;topic=24075.html&amp;page=0&amp;anchor=16" class="addthx" data-post="363750"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]philimonix[/b]','')">philimonix</a></b><br></div>
<img src="img/s1.gif" alt=""><br><span class=txtSm>Ранг: 4.6 (гость)<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 4.3'>Активность: 0.01<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=40485">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 27 марта 2016 12:51 &middot; Поправил: philimonix <br><script type="text/javascript">QU('philimonix','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=philimonix" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24075.html&amp;page=0#17');return false;">#17</a> </span><div align=left><br>
<I>VodoleY пишет:<br> это или руки кривые.. или понимание процесса отсутсвует..  </I><br>Ну, я только начинаю учиться)) Конечно же, понимание процесса пока оставляет желать лучшего. Но, думаю, это просто дело времени)<br><br><I>dosprog пишет:<br>Тогда понятно. . </I><br>Учебники с ошибками в исходниках ещё полезнее чем правильные и грамотные)) Пока ковыряешься с такой ерундой, поучаешь больше опыта и понимания, чем если бы разбирал сразу правильно написанные программы))<br><br><b>Добавлено спустя 17 часов 37 минут</b><br>Если кому интересно, есть ещё один вариант решения. Подсказали на другом форуме. <br>Процедура GetFName() ищет первый пробел в строке, хотя надо бы искать последний. И тогда никаких проблем не возникает. <br>Вот так надо переписать эту процедуру:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">GetFName&nbsp;<span class="hl_function">proc</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;&nbsp;GetCommandLine</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr"><b>eax</b></span>&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>xor</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr"><b>eax</b></span><span class="hl_comment">;al, 0 </span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>or</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span><span class="hl_char">-</span><span class="hl_number">1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>repne</b></span>&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>scasb</b></span>&nbsp;<span class="hl_comment">;ищем нулевой символ, чтобы определить конец командной строки</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>not</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">ecx</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">al</span><span class="hl_char">,</span><span class="hl_number">20h</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>std</b></span>&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>repne</b></span>&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>scasb</b></span>&nbsp;<span class="hl_comment">;ищем последний пробел, чтобы отделить параметр, переданный в командной строке</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>add</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span><span class="hl_number">2</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cld</b></span>&nbsp;&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jecxz</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;empty&nbsp;<span class="hl_comment">;.. если ноль, то параметра не было.. </span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_registr"><b>edi</b></span>&nbsp;<span class="hl_comment">;возвращаем адрес начала параметра</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">ret</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;empty<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>or</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_char">-</span><span class="hl_number">1</span>&nbsp;</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">ret</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;GetFName&nbsp;<span class="hl_function">endp</span></li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=363751&amp;user=40485&amp;forum_n=6&amp;topic=24075.html&amp;page=0&amp;anchor=17" class="addthx" data-post="363751"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]VodoleY[/b]','')">VodoleY</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 488.1 (мудрец), 272thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 12.01'>Активность: 0.35<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=17319">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 28 марта 2016 08:49 &middot; Поправил: VodoleY <br><script type="text/javascript">QU('VodoleY','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=VodoleY" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24075.html&amp;page=0#18');return false;">#18</a> </span><div align=left><br>
<b>philimonix</b> встает вопрос.. отладчик тут причем? ошибки в коде не надо на дебагер валить<br>ЗЫ  GetFName() .. вы не путайте теплое с мягким.. спецификацию 8+3 еще никто не отменял.. если вы путь к файлу в формате лонг нейм указываете.. будьте добры его в ковычки запердолить. и хватить бороться с мельницами
<br><br><font size="1"><i>-----<br>Наша работа во тьме, Мы делаем, что умеем. Мы отдаем, что имеем, Наша работа во тьме....</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=363770&amp;user=17319&amp;forum_n=6&amp;topic=24075.html&amp;page=0&amp;anchor=18" class="addthx" data-post="363770"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=8830" title="28-03-2016 06:29, ранг:242.8" target="_blank">ajax</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]dosprog[/b]','')">dosprog</a></b><br></div>
<img src="img/s7.gif" alt=""><br><span class=txtSm>Ранг: 431.7 (мудрец), 390thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 6.95'>Активность: 0.73<span style='color:red'>&searr;</span>0.32</span><br>Статус: <a href="action=userinfo&amp;user=35473">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 30 марта 2016 02:28 &middot; Поправил: dosprog <br><script type="text/javascript">QU('dosprog','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=dosprog" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=24075.html&amp;page=0#19');return false;">#19</a> </span><div align=left><br>
<I>philimonix пишет:<br>Процедура GetFName() ищет первый пробел в строке, хотя надо бы искать последний.  </I><br><br>См. фрагмент кода из прошлого поста, он этим и занимается:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">@@cp_next<span class="hl_char">:</span></li>        </ol>
    </div>
</div></div>
<br><br><I>philimonix пишет:<br>Если кому интересно, есть ещё один вариант решения.  </I><br><br>Не интересно, если честно.<br>Эта процедура однозначно не на десять строчек, такие костыльные варианты лучше не использовать.<br>Что могу порекомендовать - найти какую-то утиль, где нормально реализован разбор строки, и вынуть его оттуда.<br>Не надо изобретать - всё уже давно изобретено до нас, как написал <b>VodoleY</b>.<br><i class=x><br></i>
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=363849&amp;user=35473&amp;forum_n=6&amp;topic=24075.html&amp;page=0&amp;anchor=19" class="addthx" data-post="363849"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=35168" title="30-03-2016 15:26, ранг:29.2" target="_blank">v00doo</a></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Программа под отладчиком работает не так как без отладчика. Магия?</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#20" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="6">
<input type="hidden" name="topic" value="24075">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=24075" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
