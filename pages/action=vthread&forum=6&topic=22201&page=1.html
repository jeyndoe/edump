<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Программа работает только внутри отладчика - eXeL@B</title>
<meta NAME="DESCRIPTION" CONTENT="Есть код: Code:       proc&nbsp;check;invoke RegisterHotKey,0,1,0x0004,0x41;invoke RegisterHotKey,0,2,0x0004,0x4cstart3:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invoke&nbsp;AdjustTokenPrivileges,[phToken],0,PrivilegeCount&n">
<meta NAME="KEYWORDS" CONTENT="x64_dbg windbg ollydbg ida скачать взлом отладчик ассемблер дизассемблер крэкер cracker реверсер keygen кейген кодер патч патчер крэкми лоадер брутфорсер протектор распаковщик пароль ключ ключфайл шпион oep key защита программа winapi faq hiew windasm softice winhex">
<META NAME="Document-state" CONTENT="Dynamic">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
<link rel="SHORTCUT ICON" href="/favicon.ico">
<meta name="viewport" content="width=device-width">
<link href="./skin/s0.css" type="text/css" rel="STYLESHEET">
<link href="./skin/code.css" type="text/css" rel="STYLESHEET">
<script type="text/javascript" src="./js/jq.js"></script>
<link rel="alternate" type="application/rss+xml" title="eXeL@B" href="./rss.php">
<style type="text/css">.username div .dops{display:none;}</style>
<link href="../menu.css" type="text/css" rel="stylesheet">
</head>

<body>
<a id="to_top"></a>
<div id="wrapper">
 
<div class="mob-hamburger"><span></span></div>
 
</center></div><script type='text/javascript'>
function lst(){var i=0;var htm='';var a='';var timer=setInterval(function(){if(i<10){i=i+10;}else{clearInterval(timer);i=0;}document.getElementById('kurs_container').style.marginLeft='-'+i+'px';},100);}
document.addEventListener('DOMContentLoaded',function(event){setTimeout(lst,1500);setInterval(lst,10000);});
</script></div></div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery(".mob-hamburger").on("click", function() {
        jQuery(".mob-hamburger").toggleClass("active");
        jQuery("#site-navigation").slideToggle();
		if (jQuery('.mob-hamburger').hasClass('active')) {
			var i = jQuery('#site-navigation').offset().top;
		} else { 
			var i = 0;
		}
			
		jQuery("html, body").animate({ scrollTop: i }, 600);
    });
	var btn = jQuery('#to_top');
	jQuery(window).scroll(function() {
		if (jQuery(window).scrollTop() > 300) {
			btn.addClass('show');
		} else {
			btn.removeClass('show');
		}
	});
	btn.on('click', function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, '300');
	});
});
</script>
 
<div id="content">
<div align=center style="margin-top:15px">

<table class=tbTransparent>
<tr><td class=tbTransparent>
<span class=txtSm>Сейчас на форуме: <b><a target='_blank' href='?action=userinfo&amp;user=42072'>zombi-vadim</a>, <a target='_blank' href='?action=userinfo&amp;user=31361'>zds</a> (+4 невидимых)</b></span>
</td>
</tr>
</table>

<table class=forums>
 
</tr></table>

</div><br>
<script language="javascript" type="text/javascript" charset="windows-1251" src="templates/base.js"></script>

<div align=center><table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Программа работает только внутри отладчика</span></td>
</tr></table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> <a href="action=vthread&amp;forum=6&amp;topic=22201&amp;page=0.html">&lt;&lt;</a> .  <a href="action=vthread&amp;forum=6&amp;topic=22201&amp;page=0.html">1</a> . <b>2</b> . <a href="action=vthread&amp;forum=6&amp;topic=22201&amp;page=2.html">3</a> . <a href="action=vthread&amp;forum=6&amp;topic=22201&amp;page=3.html">4</a> . <a href="action=vthread&amp;forum=6&amp;topic=22201&amp;page=2.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width="15%" class=caption4><span class=txtSm><b>Посл.ответ</b></span></td>
<td width="85%" class=caption4><span class=txtSm><b>Сообщение</b></span></td></tr>
<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="1" onfocus="this.blur()" href="JavaScript:di('[b]Envy12[/b]','')">Envy12</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 25.9 (посетитель), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.75'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=26595">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 23 сентября 2013 20:27 &middot; Поправил: Envy12 <br><script type="text/javascript">QU('Envy12','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Envy12" target="_blank">Личное сообщение</a> &middot;  <a href="#1" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22201&amp;page=1#1');return false;">#1</a> </span><div align=left><br>
Есть код:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>proc</b></span>&nbsp;check</li><li class="hl_l1"><span class="hl_comment">;invoke RegisterHotKey,0,1,0x0004,0x41</span></li><li class="hl_l0"><span class="hl_comment">;invoke RegisterHotKey,0,2,0x0004,0x4c</span></li><li class="hl_l1">start3<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;AdjustTokenPrivileges<span class="hl_char">,</span><span class="hl_char">[</span>phToken<span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span>PrivilegeCount&nbsp;<span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span><span class="hl_number">0</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">[</span>prcs<span class="hl_char">.</span>dwSize<span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_function">sizeof</span><span class="hl_char">.</span>PROCESSENTRY32</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;CreateToolhelp32Snapshot<span class="hl_char">,</span>&nbsp;TH32CS_SNAPPROCESS<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">[</span>hSnapshot<span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;Process32First<span class="hl_char">,</span><span class="hl_registr">eax</span><span class="hl_char">,</span>prcs</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span><span class="hl_char">[</span>memhandle2<span class="hl_char">]</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">loop1<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;GetMessage<span class="hl_char">,</span>msg<span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span><span class="hl_number">0</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cmp</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span><span class="hl_number">1</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>je</b></span>&nbsp;stop</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_char">[</span><span class="hl_registr">edi</span><span class="hl_char">]</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cmp</b></span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_char">[</span>prcs<span class="hl_char">.</span>szExeFile<span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jnz</b></span>&nbsp;kill2</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span><span class="hl_number">4</span></li><li class="hl_l1">next<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;Process32Next<span class="hl_char">,</span><span class="hl_char">[</span>hSnapshot<span class="hl_char">]</span><span class="hl_char">,</span>prcs</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cmp</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_number">0</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jne</b></span>&nbsp;&nbsp;&nbsp;&nbsp;loop1</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jmp</b></span>&nbsp;start3</li><li class="hl_l0">kill2<span class="hl_char">:</span></li><li class="hl_l1"><span class="hl_function"><b>stdcall</b></span>&nbsp;kill1</li><li class="hl_l0"><span class="hl_function"><b>jmp</b></span>&nbsp;next</li><li class="hl_l1">stop<span class="hl_char">:</span></li><li class="hl_l0"><span class="hl_function"><b>invoke</b></span>&nbsp;GetMessage<span class="hl_char">,</span>msg<span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span><span class="hl_number">0</span></li><li class="hl_l1"><span class="hl_function"><b>cmp</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span><span class="hl_number">2</span></li><li class="hl_l0"><span class="hl_function"><b>jnz</b></span>&nbsp;next</li><li class="hl_l1"><span class="hl_function"><b>invoke</b></span>&nbsp;Sleep<span class="hl_char">,</span><span class="hl_number">1200000</span></li><li class="hl_l0"><span class="hl_function"><b>jmp</b></span>&nbsp;next</li><li class="hl_l1"><span class="hl_function">ret</span></li><li class="hl_l0"><span class="hl_function">endp</span></li>        </ol>
    </div>
</div></div>
<br>Первые 2 стркои закоментил тк с ними функция отказывается работать вне отладчика, без них все ок, как в отладчике так и без. В чем тут дело?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=331298&amp;user=26595&amp;forum_n=6&amp;topic=22201&amp;page=1&amp;anchor=1" class="addthx" data-post="331298"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr><td class=caption4 colspan=2></td></tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="2" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 222thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 октября 2013 08:33 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#2" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22201&amp;page=1#2');return false;">#2</a> </span><div align=left><br>
Есть
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">Privilege&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>db</b></span>&nbsp;<span class="hl_quote">'SeDebugPrivilege'</span><span class="hl_char">,</span><span class="hl_number">0</span></li>        </ol>
    </div>
</div></div>
, а нигде не используется во всех версиях кода.<br><br>Смотрим MSDN<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">BOOL&nbsp;WINAPI&nbsp;AdjustTokenPrivileges<span class="hl_char">(</span></li><li class="hl_l1">&nbsp;&nbsp;__in&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HANDLE&nbsp;TokenHandle<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;__in&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BOOL&nbsp;DisableAllPrivileges<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;__in_opt&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PTOKEN_PRIVILEGES&nbsp;NewState<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;__in&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>DWORD</b></span>&nbsp;BufferLength<span class="hl_char">,</span></li><li class="hl_l1">&nbsp;&nbsp;__out_opt&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PTOKEN_PRIVILEGES&nbsp;PreviousState<span class="hl_char">,</span></li><li class="hl_l0">&nbsp;&nbsp;__out_opt&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PDWORD&nbsp;ReturnLength</li><li class="hl_l1"><span class="hl_char">)</span><span class="hl_comment">;</span></li><li class="hl_l0">&nbsp;</li>        </ol>
    </div>
</div></div>
<br><br>Где у тебя указатель на привилегии? Вместо него у тебя PrivilegeCount почему-то. Если переменной PrivilegeCount хотел передать аргумент BufferLength(если б даже и своей очередью), то неправильно. BufferLength - длина структуры TOKEN_PRIVILEGES, в которой массив из одного или более LUID_AND_ATTRIBUTES, а не число привилегий!...<br><br>Читай внимательно MSDN и переделывай! За это даже оценку не поставишь. Если будешь на полпути, поделюсь исходником <img src="img/smilies/s1.gif" alt="">
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=332048&amp;user=24257&amp;forum_n=6&amp;topic=22201&amp;page=1&amp;anchor=2" class="addthx" data-post="332048"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:inline"> | Сообщение посчитали полезным: <span class="total_thx"><a href="action=userinfo&user=26595" title="10-10-2013 04:48, ранг:14.1" target="_blank">Envy12</a></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="3" onfocus="this.blur()" href="JavaScript:di('[b]Envy12[/b]','')">Envy12</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 25.9 (посетитель), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.75'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=26595">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 октября 2013 08:46 <br><script type="text/javascript">QU('Envy12','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Envy12" target="_blank">Личное сообщение</a> &middot;  <a href="#3" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22201&amp;page=1#3');return false;">#3</a> </span><div align=left><br>
pause1, messagebox появляется а программа не останавливается на слипе, идет дальше, процедуру вызываю через инжект.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=332049&amp;user=26595&amp;forum_n=6&amp;topic=22201&amp;page=1&amp;anchor=3" class="addthx" data-post="332049"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="4" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 222thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 октября 2013 09:02 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#4" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22201&amp;page=1#4');return false;">#4</a> </span><div align=left><br>
<I>Envy12 пишет:<br>pause1, messagebox появляется а программа не останавливается на слипе, идет дальше, процедуру вызываю через инжект. </I><br>Посмотри, что творится в процессе-&quot;жертве&quot;<br><br>Хотя вообще-то самого инжекта и не видно...<br><br>fasm - это единственный язык, который &quot;знаешь&quot;?
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=332050&amp;user=24257&amp;forum_n=6&amp;topic=22201&amp;page=1&amp;anchor=4" class="addthx" data-post="332050"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="5" onfocus="this.blur()" href="JavaScript:di('[b]Envy12[/b]','')">Envy12</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 25.9 (посетитель), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.75'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=26595">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 октября 2013 10:14 &middot; Поправил: Envy12 <br><script type="text/javascript">QU('Envy12','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Envy12" target="_blank">Личное сообщение</a> &middot;  <a href="#5" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22201&amp;page=1#5');return false;">#5</a> </span><div align=left><br>
<b>DenCoder</b><br>Вот так:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">struct&nbsp;LUID</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LowPart&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HighPart&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l1"><span class="hl_function">ends</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">struct&nbsp;LUID_AND_ATTRIBUTES</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Luid&nbsp;LUID</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Attributes&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l0"><span class="hl_function">ends</span></li><li class="hl_l1">nope&nbsp;<span class="hl_function"><b>db</b></span>&nbsp;<span class="hl_number">0</span></li><li class="hl_l0">struct&nbsp;TOKEN_PRIVELEGES</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PrivilegeCount&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_number">2</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Priveleges&nbsp;LUID_AND_ATTRIBUTES</li><li class="hl_l1"><span class="hl_function">ends</span></li>        </ol>
    </div>
</div></div>
<br> правильно?<br>Я смотрел что там происходит, поставил бряк на входе в процедуру, после messagebox выходит из процедуры и дальше работает.<br>&quot;Знаю&quot; еще парочку других: pure basic, autoit. Глянул другую прогу, оказалось, что CreateToolhelp32Snapshot может работать и без AdjustTokenPrivileges<img src="img/smilies/s5.gif" alt=""><br>Я не успеваю нажать OK в окне, как процесс уже идет дальше, наверно, что-то не так с адресом возврата.<br>PS Смотрю я это в CE, тк в ольке все нормально работает =\
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=332053&amp;user=26595&amp;forum_n=6&amp;topic=22201&amp;page=1&amp;anchor=5" class="addthx" data-post="332053"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="6" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 222thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 октября 2013 11:38 <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#6" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22201&amp;page=1#6');return false;">#6</a> </span><div align=left><br>
<I>Envy12 пишет:<br>оказалось, что CreateToolhelp32Snapshot может работать и без AdjustTokenPrivileges </I><br>Вообще-то да. В твоём коде бардак, и себя и других в заблуждения вводишь.<br><br><I>Envy12 пишет:<br>Я не успеваю нажать OK в окне, как процесс уже идет дальше, </I><br>Процесс, наверное, многопоточный.
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=332058&amp;user=24257&amp;forum_n=6&amp;topic=22201&amp;page=1&amp;anchor=6" class="addthx" data-post="332058"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="7" onfocus="this.blur()" href="JavaScript:di('[b]Envy12[/b]','')">Envy12</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 25.9 (посетитель), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.75'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=26595">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 октября 2013 14:18 <br><script type="text/javascript">QU('Envy12','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Envy12" target="_blank">Личное сообщение</a> &middot;  <a href="#7" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22201&amp;page=1#7');return false;">#7</a> </span><div align=left><br>
Инжект делаю с помощью virtualalloc + createremotethread,<br>push pause1 <br>ret<br>Болоше никаких потоков там нет. А код этот я не писал.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=332062&amp;user=26595&amp;forum_n=6&amp;topic=22201&amp;page=1&amp;anchor=7" class="addthx" data-post="332062"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="8" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 222thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 октября 2013 14:52 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#8" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22201&amp;page=1#8');return false;">#8</a> </span><div align=left><br>
<I>Envy12 пишет:<br>Болоше никаких потоков там нет </I><br>А основной поток процесса? Процесс усыпляется перед инжектом?
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=332064&amp;user=24257&amp;forum_n=6&amp;topic=22201&amp;page=1&amp;anchor=8" class="addthx" data-post="332064"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="9" onfocus="this.blur()" href="JavaScript:di('[b]Envy12[/b]','')">Envy12</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 25.9 (посетитель), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.75'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=26595">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 октября 2013 15:08 &middot; Поправил: Envy12 <br><script type="text/javascript">QU('Envy12','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Envy12" target="_blank">Личное сообщение</a> &middot;  <a href="#9" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22201&amp;page=1#9');return false;">#9</a> </span><div align=left><br>
<I>DenCoder пишет:<br>А основной поток процесса? Процесс усыпляется перед инжектом?  </I><br>Он должен уснуть после инжекта.<br>Инжект входит в процедуру, вызывается окно, программа переходит в основную процедуру check, без слипа.<br>Процесс уже может находится в слипе, тк в у меня в цикле есть слип, и скорее всего мой инжект срабатывает в момент слипа и следующий слип не работает.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=332066&amp;user=26595&amp;forum_n=6&amp;topic=22201&amp;page=1&amp;anchor=9" class="addthx" data-post="332066"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="10" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 222thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 10 октября 2013 22:27 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#10" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22201&amp;page=1#10');return false;">#10</a> </span><div align=left><br>
<I>Envy12 пишет:<br>Он должен уснуть после инжекта.Инжект входит в процедуру, вызывается окно, программа переходит в основную процедуру check, без слипа. </I><br>С чего ты взял-то? <img src="img/smilies/s5.gif" alt=""><br>Если CreateRemoteThread используешь, то она создаёт отдельный поток в процессе, а главный продолжает работать. В то время как созданный поток выдаёт тебе MessageBox и входит после него в Sleep, главный поток также продолжает работать. У твоего Sleep, кстати, 3 600 000 задержка - это ж 1 час ждать.<br><br><I>Envy12 пишет:<br>у меня в цикле есть слип, и скорее всего мой инжект срабатывает в момент слипа и следующий слип не работает </I><br>Я так понял, хочешь разобраться по готовому исходнику и наваять что-нить интересное? Смотришь, что будет если так или так поменять в коде? )) Без понимания принипов работы функций вряд ли получится )<br>Sleep, к примеру, усыпляет только тот поток, из которого вызван.<br><br>Лучше напиши алгоритм по-русски, что нужно сделать... А вообще, случайно не малварь написать хочешь? )
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=332072&amp;user=24257&amp;forum_n=6&amp;topic=22201&amp;page=1&amp;anchor=10" class="addthx" data-post="332072"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="11" onfocus="this.blur()" href="JavaScript:di('[b]Envy12[/b]','')">Envy12</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 25.9 (посетитель), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.75'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=26595">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 октября 2013 14:23 &middot; Поправил: Envy12 <br><script type="text/javascript">QU('Envy12','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Envy12" target="_blank">Личное сообщение</a> &middot;  <a href="#11" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22201&amp;page=1#11');return false;">#11</a> </span><div align=left><br>
Это программа моя разработка, за исключением поиска процессов. Ну в принципе если убрать sleep 3600000 получится малварь, хоть и весьма нубская. Как можно остановить главный поток на время слипа?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=332099&amp;user=26595&amp;forum_n=6&amp;topic=22201&amp;page=1&amp;anchor=11" class="addthx" data-post="332099"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="12" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 222thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 октября 2013 14:34 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#12" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22201&amp;page=1#12');return false;">#12</a> </span><div align=left><br>
<I>Envy12 пишет:<br>Как можно остановить главный поток на время слипа? </I><br><noindex><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms686345(v=vs.85).aspx" rel="nofollow" target="_blank">--&gt; SuspendThread &lt;--</a></noindex>, если инжект в уже запущенный процесс. Если так, то потоков там может быть несколько. При остановке главного потока остальные не останавятся, поэтому если требуется остановить остальные, то используй их перечисление с помощью того же toolhelp32.<br><br><I>Envy12 пишет:<br>за исключением поиска процессов.  </I><br>СильнО сказано! По 4 первым символам имени образа не всегда идентифицируешь правильно единственный нужный процесс! Что мешает полное сравнение имени сделать?
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=332102&amp;user=24257&amp;forum_n=6&amp;topic=22201&amp;page=1&amp;anchor=12" class="addthx" data-post="332102"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="13" onfocus="this.blur()" href="JavaScript:di('[b]Envy12[/b]','')">Envy12</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 25.9 (посетитель), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.75'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=26595">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 октября 2013 17:58 &middot; Поправил: Envy12 <br><script type="text/javascript">QU('Envy12','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Envy12" target="_blank">Личное сообщение</a> &middot;  <a href="#13" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22201&amp;page=1#13');return false;">#13</a> </span><div align=left><br>
<I>DenCoder пишет:<br>СильнО сказано! По 4 первым символам имени образа не всегда идентифицируешь правильно единственный нужный процесс! Что мешает полное сравнение имени сделать?  </I><br>Это не принципиально, лень матушка мешает.<br>Сделал вот так:<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_normal">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>proc</b></span>&nbsp;pause1</li><li class="hl_l1"><span class="hl_function"><b>invoke</b></span>&nbsp;SuspendThread<span class="hl_char">,</span><span class="hl_char">[</span>hthread<span class="hl_char">]</span></li><li class="hl_l0"><span class="hl_function"><b>invoke</b></span>&nbsp;MessageBoxA<span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span>caption<span class="hl_char">,</span><span class="hl_number">0</span></li><li class="hl_l1"><span class="hl_function"><b>invoke</b></span>&nbsp;Sleep<span class="hl_char">,</span><span class="hl_number">1200000</span></li><li class="hl_l0"><span class="hl_function"><b>invoke</b></span>&nbsp;ResumeThread<span class="hl_char">,</span><span class="hl_char">[</span>hthread<span class="hl_char">]</span></li><li class="hl_l1"><span class="hl_function"><b>jmp</b></span>&nbsp;start3</li><li class="hl_l0"><span class="hl_function">endp</span></li>        </ol>
    </div>
</div></div>
<br>после окна код опять запускается<img src="img/smilies/s14.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=332104&amp;user=26595&amp;forum_n=6&amp;topic=22201&amp;page=1&amp;anchor=13" class="addthx" data-post="332104"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="14" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 222thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 октября 2013 18:28 <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#14" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22201&amp;page=1#14');return false;">#14</a> </span><div align=left><br>
Да открой уже процесс, который инжектишь, в отладчике, поставь бряки, где надо и смотри, что происходит.
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=332105&amp;user=24257&amp;forum_n=6&amp;topic=22201&amp;page=1&amp;anchor=14" class="addthx" data-post="332105"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="15" onfocus="this.blur()" href="JavaScript:di('[b]Envy12[/b]','')">Envy12</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 25.9 (посетитель), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.75'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=26595">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 11 октября 2013 19:40 <br><script type="text/javascript">QU('Envy12','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Envy12" target="_blank">Личное сообщение</a> &middot;  <a href="#15" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22201&amp;page=1#15');return false;">#15</a> </span><div align=left><br>
<I>DenCoder пишет:<br>Да открой уже процесс, который инжектишь </I><br>Что там смотреть? Основной поток стартует после мсг и все.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=332111&amp;user=26595&amp;forum_n=6&amp;topic=22201&amp;page=1&amp;anchor=15" class="addthx" data-post="332111"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="16" onfocus="this.blur()" href="JavaScript:di('[b]Dr0p[/b]','')">Dr0p</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33727.png" alt=""><br><span class=txtSm>Ранг: 72.3 (постоянный), 133thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.5'>Активность: 0.38<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33727">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 октября 2013 14:37 <br><script type="text/javascript">QU('Dr0p','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Dr0p" target="_blank">Личное сообщение</a> &middot;  <a href="#16" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22201&amp;page=1#16');return false;">#16</a> </span><div align=left><br>
<b>DenCoder</b><br><br>&gt; При остановке главного потока остальные не останавятся, поэтому если требуется остановить остальные, то используй их перечисление с помощью того же toolhelp32.<br><br>NtSuspendProcess:<br><br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0">NTSTATUS</li><li class="hl_l1">NtSuspendProcess&nbsp;<span class="hl_char">(</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;__in&nbsp;HANDLE&nbsp;ProcessHandle</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">)</span></li><li class="hl_l0"><span class="hl_char">/</span><span class="hl_char">*</span><span class="hl_char">+</span><span class="hl_char">+</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">Routine&nbsp;Description<span class="hl_char">:</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>This</b></span>&nbsp;function&nbsp;suspends&nbsp;all&nbsp;<span class="hl_function">none</span><span class="hl_char">-</span>exiting&nbsp;threads&nbsp;<span class="hl_function"><b>in</b></span>&nbsp;the&nbsp;target&nbsp;process</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">Arguments<span class="hl_char">:</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;ProcessHandle&nbsp;<span class="hl_char">-</span>&nbsp;Supplies&nbsp;an&nbsp;open&nbsp;handle&nbsp;to&nbsp;the&nbsp;process&nbsp;to&nbsp;be&nbsp;suspended</li><li class="hl_l1">&nbsp;</li><li class="hl_l0">Return&nbsp;Value<span class="hl_char">:</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;NTSTATUS&nbsp;<span class="hl_char">-</span>&nbsp;Status&nbsp;of&nbsp;operation</li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_char">-</span><span class="hl_char">-</span><span class="hl_char">*</span><span class="hl_char">/</span></li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=332114&amp;user=33727&amp;forum_n=6&amp;topic=22201&amp;page=1&amp;anchor=16" class="addthx" data-post="332114"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="17" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 222thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 октября 2013 17:42 <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#17" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22201&amp;page=1#17');return false;">#17</a> </span><div align=left><br>
<b>Dr0p</b><br>Мы не рассматриваем сейчас андок функс<br><br><I>Envy12 пишет:<br>Основной поток стартует после мсг и все. </I><br>Основной поток никогда не стартует после мсг! Любое созданное окно привязывается только к потоку, который его создал!<br>Читай:<br><noindex><a href="http://www.kurzenkov.com/articles/multithreading1.html" rel="nofollow" target="_blank">--&gt; Процессы и потоки &lt;--</a></noindex><br><noindex><a href="http://trubetskoy1.narod.ru/translate/Translation.html#multythread" rel="nofollow" target="_blank">--&gt; Многопоточные приложения &lt;--</a></noindex>
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=332118&amp;user=24257&amp;forum_n=6&amp;topic=22201&amp;page=1&amp;anchor=17" class="addthx" data-post="332118"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="18" onfocus="this.blur()" href="JavaScript:di('[b]Envy12[/b]','')">Envy12</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 25.9 (посетитель), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.75'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=26595">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 октября 2013 18:20 &middot; Поправил: Envy12 <br><script type="text/javascript">QU('Envy12','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Envy12" target="_blank">Личное сообщение</a> &middot;  <a href="#18" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22201&amp;page=1#18');return false;">#18</a> </span><div align=left><br>
<b>DenCoder</b><br>Так, как только открывается окно, функция check продолжает работать, до тех пор пока я не нажму кнопку в окне, после этого опять останавливается. Могу выложить весь код, чтобы вы сами убедились в этом.<br><b>Dr0p</b><br>А зачем toolhelp32? Я могу в хендл функцие дать результат GetCurrentThreadId?
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=332119&amp;user=26595&amp;forum_n=6&amp;topic=22201&amp;page=1&amp;anchor=18" class="addthx" data-post="332119"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="19" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 222thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 октября 2013 18:41 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#19" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22201&amp;page=1#19');return false;">#19</a> </span><div align=left><br>
<I>Envy12 пишет:<br>Я могу в хендл функцие дать результат GetCurrentThreadId? </I><br><img src="img/smilies/s1.gif" alt=""> нет! ид потока нужно передать в OpenThread(), чтобы получить хендл.<br><br><I>Envy12 пишет:<br>А зачем toolhelp32? </I><br>Ты меня удивляешь - перечисляешь процессы с помощью него и не знаешь, как оно называется? )) Аналогично им можно перечислять кучи, модули и потоки<br><br><I>Envy12 пишет:<br>Могу выложить весь код, чтобы вы сами убедились в этом. </I><br>Давно пора, а то гадать надоедает.<br><br><I>Envy12 пишет:<br>DenCoder пишет:Да открой уже процесс, который инжектишь<br>Что там смотреть? </I><br>Последовательность выполнения, возможные коды ошибок... Другими словами - владел бы отладчиком, топик был бы короче и возможно даже был бы интереснее ))
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=332120&amp;user=24257&amp;forum_n=6&amp;topic=22201&amp;page=1&amp;anchor=19" class="addthx" data-post="332120"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="20" onfocus="this.blur()" href="JavaScript:di('[b]Envy12[/b]','')">Envy12</a></b><br></div>
<img src="img/s3.gif" alt=""><br><span class=txtSm>Ранг: 25.9 (посетитель), 1thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 9.75'>Активность: 0.02<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=26595">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 октября 2013 18:47 <br><script type="text/javascript">QU('Envy12','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Envy12" target="_blank">Личное сообщение</a> &middot;  <a href="#20" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22201&amp;page=1#20');return false;">#20</a> </span><div align=left><br>
<I>DenCoder пишет:<br>Последовательность выполнения, возможные коды ошибок... Другими словами - владел бы отладчиком, топик был бы короче и возможно даже был бы интереснее ))  </I><br>Я немного владею олей, но как я говорил выше, она в этом случае безполезна.<br>
<div class="hl_container">
<div class="hl_header">Code:</div>
<div class="hl_scroll_part_large">
    <div class="hl_normal"> 
        <ol class="hl_main"><li class="hl_l0"><span class="hl_function"><b>format</b></span>&nbsp;PE&nbsp;GUI&nbsp;<span class="hl_number">4</span><span class="hl_char">.</span><span class="hl_number">0</span></li><li class="hl_l1"><span class="hl_function"><b>include</b></span>&nbsp;<span class="hl_quote">'win32a.inc'</span></li><li class="hl_l0"><span class="hl_function"><b>entry</b></span>&nbsp;start</li><li class="hl_l1"><span class="hl_function"><b>section</b></span>&nbsp;<span class="hl_quote">'.text'</span>&nbsp;<span class="hl_function"><b>code</b></span>&nbsp;<span class="hl_function"><b>readable</b></span>&nbsp;<span class="hl_function">executable</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>proc</b></span>&nbsp;init</li><li class="hl_l0">start1<span class="hl_char">:</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;GetCurrentThreadId</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_char">[</span>hthread<span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;HeapCreate<span class="hl_char">,</span>0x00040000<span class="hl_char">,</span><span class="hl_number">400</span><span class="hl_char">,</span>0x256</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>0x688</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_char">[</span>memhandle2<span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">[</span>prcs<span class="hl_char">.</span>dwSize<span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_function">sizeof</span><span class="hl_char">.</span>PROCESSENTRY32</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;CreateToolhelp32Snapshot<span class="hl_char">,</span>&nbsp;TH32CS_SNAPPROCESS<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">[</span>hSnapshot<span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;Process32First<span class="hl_char">,</span><span class="hl_registr">eax</span><span class="hl_char">,</span>prcs</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span><span class="hl_char">[</span>memhandle2<span class="hl_char">]</span></li><li class="hl_l1"><span class="hl_char">.</span><span class="hl_function">loop</span><span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">esi</span><span class="hl_char">,</span>prcs<span class="hl_char">.</span>szExeFile</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function">movsd</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>inc</b></span>&nbsp;<span class="hl_char">[</span>count<span class="hl_char">]</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_char">.</span>next<span class="hl_char">:</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;Process32Next<span class="hl_char">,</span><span class="hl_char">[</span>hSnapshot<span class="hl_char">]</span><span class="hl_char">,</span>prcs</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cmp</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_number">0</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jne</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">.</span><span class="hl_function">loop</span></li><li class="hl_l0"><span class="hl_function">ret</span></li><li class="hl_l1"><span class="hl_function">endp</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>proc</b></span>&nbsp;kill1</li><li class="hl_l0"><span class="hl_function">pushad</span></li><li class="hl_l1"><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span>prcs<span class="hl_char">.</span>szExeFile</li><li class="hl_l0"><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_char">[</span><span class="hl_registr">eax</span><span class="hl_char">]</span></li><li class="hl_l1"><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span><span class="hl_char">[</span>count<span class="hl_char">]</span></li><li class="hl_l0"><span class="hl_function"><b>shl</b></span>&nbsp;<span class="hl_registr">ecx</span><span class="hl_char">,</span><span class="hl_number">1</span></li><li class="hl_l1"><span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span><span class="hl_char">[</span>memhandle2<span class="hl_char">]</span></li><li class="hl_l0"><span class="hl_function"><b>repne</b></span>&nbsp;<span class="hl_function">scasd</span></li><li class="hl_l1"><span class="hl_function"><b>jz</b></span>&nbsp;end1</li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>invoke</b></span>&nbsp;OpenProcess<span class="hl_char">,</span>0x1F0FFF<span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span><span class="hl_char">[</span>prcs<span class="hl_char">.</span>th32ProcessID<span class="hl_char">]</span></li><li class="hl_l0"><span class="hl_function"><b>invoke</b></span>&nbsp;TerminateProcess<span class="hl_char">,</span><span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_function">NULL</span></li><li class="hl_l1">end1<span class="hl_char">:</span></li><li class="hl_l0"><span class="hl_function">popad</span></li><li class="hl_l1"><span class="hl_function">ret</span></li><li class="hl_l0"><span class="hl_function">endp</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_function"><b>proc</b></span>&nbsp;check</li><li class="hl_l1">start3<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;CreateToolhelp32Snapshot<span class="hl_char">,</span>&nbsp;TH32CS_SNAPPROCESS<span class="hl_char">,</span>&nbsp;<span class="hl_number">0</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_char">[</span>hSnapshot<span class="hl_char">]</span><span class="hl_char">,</span>&nbsp;<span class="hl_registr">eax</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;Process32First<span class="hl_char">,</span><span class="hl_registr">eax</span><span class="hl_char">,</span>prcs</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span><span class="hl_char">[</span>memhandle2<span class="hl_char">]</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">loop1<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;Sleep<span class="hl_char">,</span><span class="hl_number">100</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>mov</b></span>&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_char">[</span><span class="hl_registr">edi</span><span class="hl_char">]</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cmp</b></span>&nbsp;<span class="hl_function"><b>dword</b></span>&nbsp;<span class="hl_char">[</span>prcs<span class="hl_char">.</span>szExeFile<span class="hl_char">]</span><span class="hl_char">,</span><span class="hl_registr">eax</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jnz</b></span>&nbsp;kill2</li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>add</b></span>&nbsp;<span class="hl_registr">edi</span><span class="hl_char">,</span><span class="hl_number">4</span></li><li class="hl_l1">next<span class="hl_char">:</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>invoke</b></span>&nbsp;Process32Next<span class="hl_char">,</span><span class="hl_char">[</span>hSnapshot<span class="hl_char">]</span><span class="hl_char">,</span>prcs</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>cmp</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_registr">eax</span><span class="hl_char">,</span><span class="hl_number">0</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jne</b></span>&nbsp;&nbsp;&nbsp;&nbsp;loop1</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>jmp</b></span>&nbsp;start3</li><li class="hl_l0">kill2<span class="hl_char">:</span></li><li class="hl_l1"><span class="hl_function"><b>stdcall</b></span>&nbsp;kill1</li><li class="hl_l0"><span class="hl_function"><b>jmp</b></span>&nbsp;next</li><li class="hl_l1"><span class="hl_function">ret</span></li><li class="hl_l0"><span class="hl_function">endp</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_function"><b>proc</b></span>&nbsp;pause1</li><li class="hl_l1"><span class="hl_function"><b>invoke</b></span>&nbsp;SuspendThread<span class="hl_char">,</span><span class="hl_char">[</span>hthread<span class="hl_char">]</span></li><li class="hl_l0"><span class="hl_function"><b>invoke</b></span>&nbsp;MessageBoxA<span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span><span class="hl_number">0</span><span class="hl_char">,</span>caption<span class="hl_char">,</span><span class="hl_number">0</span></li><li class="hl_l1"><span class="hl_function"><b>invoke</b></span>&nbsp;Sleep<span class="hl_char">,</span><span class="hl_number">1200000</span></li><li class="hl_l0"><span class="hl_function"><b>invoke</b></span>&nbsp;ResumeThread<span class="hl_char">,</span><span class="hl_char">[</span>hthread<span class="hl_char">]</span></li><li class="hl_l1"><span class="hl_function"><b>jmp</b></span>&nbsp;start3</li><li class="hl_l0"><span class="hl_function">endp</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">start<span class="hl_char">:</span></li><li class="hl_l1"><span class="hl_function"><b>stdcall</b></span>&nbsp;init</li><li class="hl_l0"><span class="hl_function"><b>stdcall</b></span>&nbsp;check</li><li class="hl_l1"><span class="hl_function"><b>stdcall</b></span>&nbsp;pause1</li><li class="hl_l0"><span class="hl_function">ret</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_function"><b>section</b></span>&nbsp;<span class="hl_quote">'.data'</span>&nbsp;<span class="hl_function"><b>data</b></span>&nbsp;<span class="hl_function"><b>readable</b></span>&nbsp;<span class="hl_function">writeable</span></li><li class="hl_l1">caption&nbsp;<span class="hl_function"><b>db</b></span>&nbsp;<span class="hl_quote">'Пауза'</span><span class="hl_char">,</span><span class="hl_number">0</span></li><li class="hl_l0">count&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_number">0</span></li><li class="hl_l1">memhandle2&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l0">hthread&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">TH32CS_SNAPPROCESS&nbsp;<span class="hl_char">=</span>&nbsp;<span class="hl_number">2</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0">struct&nbsp;PROCESSENTRY32</li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwSize&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cntUsage&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;th32ProcessID&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;th32DefaultHeapID&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;th32ModuleID&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cntThreads&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;th32ParentProcessID&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pcPriClassBase&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwFlags&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;szExeFile&nbsp;<span class="hl_function"><b>db</b></span>&nbsp;<span class="hl_number">260</span>&nbsp;<span class="hl_function">dup</span><span class="hl_char">(</span><span class="hl_char">?</span><span class="hl_char">)</span></li><li class="hl_l1"><span class="hl_function">ends</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1">hSnapshot&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hl_function"><b>dd</b></span>&nbsp;<span class="hl_char">?</span></li><li class="hl_l0">prcs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PROCESSENTRY32</li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_function"><b>section</b></span>&nbsp;<span class="hl_quote">'.idata'</span>&nbsp;<span class="hl_function"><b>import</b></span>&nbsp;<span class="hl_function"><b>data</b></span>&nbsp;<span class="hl_function">readable</span></li><li class="hl_l1">&nbsp;</li><li class="hl_l0"><span class="hl_function"><b>library</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kernel32<span class="hl_char">,</span><span class="hl_quote">'KERNEL32.DLL'</span><span class="hl_char">,</span><span class="hl_char">\</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;advapi32<span class="hl_char">,</span><span class="hl_quote">'ADVAPI32.DLL'</span><span class="hl_char">,</span><span class="hl_char">\</span></li><li class="hl_l0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shell32<span class="hl_char">,</span><span class="hl_quote">'SHELL32.DLL'</span><span class="hl_char">,</span><span class="hl_char">\</span></li><li class="hl_l1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user32<span class="hl_char">,</span><span class="hl_quote">'USER32.DLL'</span></li><li class="hl_l0">&nbsp;</li><li class="hl_l1"><span class="hl_function"><b>include</b></span>&nbsp;<span class="hl_quote">'API\kernel32.inc'</span></li><li class="hl_l0"><span class="hl_function"><b>include</b></span>&nbsp;<span class="hl_quote">'API\advapi32.inc'</span></li><li class="hl_l1"><span class="hl_function"><b>include</b></span>&nbsp;<span class="hl_quote">'API\shell32.inc'</span></li><li class="hl_l0"><span class="hl_function"><b>include</b></span>&nbsp;<span class="hl_quote">'API\user32.inc'</span></li>        </ol>
    </div>
</div></div><br><br><span class="txtGoods"><a href="action=addthx&amp;post=332121&amp;user=26595&amp;forum_n=6&amp;topic=22201&amp;page=1&amp;anchor=20" class="addthx" data-post="332121"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="21" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 222thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 октября 2013 18:54 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#21" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22201&amp;page=1#21');return false;">#21</a> </span><div align=left><br>
1. Где код инжекта с CreateRemoteThread() ?<br>2. <I>Envy12 пишет:<br>Я немного владею олей, но как я говорил выше, она в этом случае безполезна. </I><br>Неверное решение! Поставив бряк на начало потока, созданного функцией CreateRemoteThread(), увидишь правильно ли выполняется. В частности, увидишь, что из Sleep() поток не выходит, пока не истечёт указанное время. А также, увидишь, что логика функции kill1 противоречит логике init, и много чего ещё увидишь...<br>3. <b>2 Замечания по SuspendThread().</b> Во-первых, судя по коду, ты не понял, что усыплять нужно не свой поток, а потоки процесса. Во-вторых, передавать нужно хендл потока, а не его ид.<br>4. Если необходимо усыпление потоков процесса-жертвы, то сделать это можно ещё до инжекта, но необязательно.
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=332122&amp;user=24257&amp;forum_n=6&amp;topic=22201&amp;page=1&amp;anchor=21" class="addthx" data-post="332122"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="22" onfocus="this.blur()" href="JavaScript:di('[b]Dr0p[/b]','')">Dr0p</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33727.png" alt=""><br><span class=txtSm>Ранг: 72.3 (постоянный), 133thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.5'>Активность: 0.38<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33727">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 октября 2013 19:12 <br><script type="text/javascript">QU('Dr0p','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Dr0p" target="_blank">Личное сообщение</a> &middot;  <a href="#22" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22201&amp;page=1#22');return false;">#22</a> </span><div align=left><br>
<b>DenCoder</b><br><br>&gt; Мы не рассматриваем сейчас андок функс<br><br>Это не функция а сервис, функция это стаб для него.. Она мало того что док, так есчо и опенсорс. Прототип и имя никогда не менялись и никогда не изменятся. Андоком было бы лезть в нэйтивные структуры слепка(сисинфо), они изменяются.<br><br><b>Envy12</b><br><br>&gt; А зачем toolhelp32? Я могу в хендл функцие дать результат GetCurrentThreadId? <br><br>Не могу ответить, так как не знаю что вы пытаетесь сделать, а перечитывать всё лень <img src="img/smilies/s1.gif" alt=""><br><br>В любом случае заморозка потоков ну никак не совместима с документированными манипуляциями. У вас будет дедлок, например в загрузчике, так как ваш удалённый поток первым делом в лодер и попадёт, а там синхронизации. Тоже самое относится и к принудительному завершению потоков, это вообще никогда нельзя делать.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=332124&amp;user=33727&amp;forum_n=6&amp;topic=22201&amp;page=1&amp;anchor=22" class="addthx" data-post="332124"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="23" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 222thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 октября 2013 19:26 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#23" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22201&amp;page=1#23');return false;">#23</a> </span><div align=left><br>
<I>Dr0p пишет:<br>Она мало того что док, так есчо и опенсорс. </I><br>Её нету даже в хидерах ddk, ни в 2600, ни в 7600 )).<br><br><I>Dr0p пишет:<br>Андоком было бы лезть в нэйтивные структуры слепка(сисинфо), они изменяются </I><br>Это верно, поэтому никто и не предлагает реализацию на NtQuerySystemInformation. Все вроде как согласны с toophelp ))<br><br><I>Dr0p пишет:<br>не знаю что вы пытаетесь сделать, а перечитывать всё лень </I><br>Отвечать зато не лень. И мне было поначалу лень вникать. И могу уверенно сказать, что многим лень, поэтому ответов от других здесь нет. И есть высокая вероятность, что я устану давать подсказки тс, если он не включит полезную часть моска ))<br><br><b>Envy12</b><br>5. Из всего вышенаписанного следует огромная вероятность, что приведённый выше код должен выполняться в контексте процесса-жертвы. В этом случае адреса переменных, на которые ссылаются инструкции, будут неверны, если перед запуском удалённого потока не сделать поправок. Да и вообще при инжекте код и данные удобнее располагать в одной секции.
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=332125&amp;user=24257&amp;forum_n=6&amp;topic=22201&amp;page=1&amp;anchor=23" class="addthx" data-post="332125"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="24" onfocus="this.blur()" href="JavaScript:di('[b]Dr0p[/b]','')">Dr0p</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33727.png" alt=""><br><span class=txtSm>Ранг: 72.3 (постоянный), 133thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.5'>Активность: 0.38<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33727">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 октября 2013 19:38 <br><script type="text/javascript">QU('Dr0p','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Dr0p" target="_blank">Личное сообщение</a> &middot;  <a href="#24" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22201&amp;page=1#24');return false;">#24</a> </span><div align=left><br>
<b>DenCoder</b><br><br>&gt; Её нету даже в хидерах ddk, ни в 2600, ни в 7600 )).<br><br>Ну а счего она там должна быть, это для юзанья в юзермодах, лол :s15<img src="img/smilies/s1.gif" alt="">
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=332126&amp;user=33727&amp;forum_n=6&amp;topic=22201&amp;page=1&amp;anchor=24" class="addthx" data-post="332126"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="25" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 222thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 октября 2013 19:53 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#25" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22201&amp;page=1#25');return false;">#25</a> </span><div align=left><br>
<I>Dr0p пишет:<br>Ну а счего она там должна быть </I><br>Поскольку это сервис с индексом 0xFD на XP SP3 x86 и экспортируется из ntoskrnl, а не только из ntdll, то странно что её нет.<br><br>UPD. Моя ошибка - из ntoskrnl нет экспорта.
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=332127&amp;user=24257&amp;forum_n=6&amp;topic=22201&amp;page=1&amp;anchor=25" class="addthx" data-post="332127"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="26" onfocus="this.blur()" href="JavaScript:di('[b]Dr0p[/b]','')">Dr0p</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33727.png" alt=""><br><span class=txtSm>Ранг: 72.3 (постоянный), 133thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.5'>Активность: 0.38<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33727">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 октября 2013 19:57 &middot; Поправил: Dr0p <br><script type="text/javascript">QU('Dr0p','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Dr0p" target="_blank">Личное сообщение</a> &middot;  <a href="#26" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22201&amp;page=1#26');return false;">#26</a> </span><div align=left><br>
<b>DenCoder</b><br><br>Не все сервисы можно юзать в дроверах, лишь только часть их поэтому вынесена в экспорт ядра. Нэйтив же позволяет их юзать, стаб для сервиса экспортится. С шадовом подобная ситуация, только ограничений больше - сервисы не экспортятся как стабы, для них есть винапи заглушки. Ну а идентификатор нужен для андок дёрганья нтапи, паблик имеют имя.<br><br>&gt; экспортируется из ntoskrnl<br><br>Не экспортится она ядром, я это знал вот щас проверил.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=332128&amp;user=33727&amp;forum_n=6&amp;topic=22201&amp;page=1&amp;anchor=26" class="addthx" data-post="332128"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="27" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 222thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 октября 2013 20:17 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#27" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22201&amp;page=1#27');return false;">#27</a> </span><div align=left><br>
<b>Dr0p</b><br>ок, но в sdk её нет <img src="img/smilies/s1.gif" alt=""><br><br>Более того<br><i class=x>If a function is not documented, it may disappear outright at any point in the future, or grow or lose some extra paramters, at which point your application may stop working or break in really interesting ways.<br><br>If it&#039;s not documented, it&#039;s definitely not supported and you shouldn&#039;t use it.</i><br><br><noindex><a href="http://social.msdn.microsoft.com/Forums/windowsdesktop/en-US/b5c5121c-bf48-47bd-b612-e2f61c5e5d82/ntsuspendprocess?forum=windowssdk" rel="nofollow" target="_blank">--&gt; NtSuspendProcess &lt;--</a></noindex><br><br>А её реализация основана на том же перечислении потоков (только через PsGetNextProcessThread) и последующем усыплении. Это не трудно самому реализовать и достоинства реализации налицо - работать будет гаранированно на последующих версиях.
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=332134&amp;user=24257&amp;forum_n=6&amp;topic=22201&amp;page=1&amp;anchor=27" class="addthx" data-post="332134"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="28" onfocus="this.blur()" href="JavaScript:di('[b]Dr0p[/b]','')">Dr0p</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33727.png" alt=""><br><span class=txtSm>Ранг: 72.3 (постоянный), 133thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.5'>Активность: 0.38<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33727">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 октября 2013 20:29 <br><script type="text/javascript">QU('Dr0p','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Dr0p" target="_blank">Личное сообщение</a> &middot;  <a href="#28" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22201&amp;page=1#28');return false;">#28</a> </span><div align=left><br>
<b>DenCoder</b><br><br>Да и ваще, какая разница док оно или нет, если изменений небыло и не будет. Для вас что, лучше костыли всякие юзать типо toolhelp-api.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=332136&amp;user=33727&amp;forum_n=6&amp;topic=22201&amp;page=1&amp;anchor=28" class="addthx" data-post="332136"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="29" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 222thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 октября 2013 20:36 <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#29" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22201&amp;page=1#29');return false;">#29</a> </span><div align=left><br>
<I>Dr0p пишет:<br>Для вас что, лучше костыли всякие юзать типо toolhelp-api </I><br>Когда той информации, что оно даёт, достаточно, зачем что-то другое?
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=332137&amp;user=24257&amp;forum_n=6&amp;topic=22201&amp;page=1&amp;anchor=29" class="addthx" data-post="332137"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel2>
<td width="17%" class=caption1>
<div class=username><div><b><a name="30" onfocus="this.blur()" href="JavaScript:di('[b]Dr0p[/b]','')">Dr0p</a></b><br></div>
<img src="img/s4.gif" alt=""><br><img style="padding-top:3px;" src="av/33727.png" alt=""><br><span class=txtSm>Ранг: 72.3 (постоянный), 133thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 7.5'>Активность: 0.38<span style='color:red'>&searr;</span>0</span><br>Статус: <a href="action=userinfo&amp;user=33727">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 октября 2013 20:39 &middot; Поправил: Dr0p <br><script type="text/javascript">QU('Dr0p','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=Dr0p" target="_blank">Личное сообщение</a> &middot;  <a href="#30" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22201&amp;page=1#30');return false;">#30</a> </span><div align=left><br>
<b>DenCoder</b><br><br>Сервис блокировку использует, а вручную не будет такого. Да и про скорость - запрос слепка ооочень долгий.<br><br>&gt; работать будет гаранированно на последующих версиях.<br><br>Вот недавно вышла 8-ка, быть может вы подскажите какой там сервис пропал по отношению к 1-м версиям нт и какой прототип изменился. Я вот например не знаю.
<br><br><span class="txtGoods"><a href="action=addthx&amp;post=332138&amp;user=33727&amp;forum_n=6&amp;topic=22201&amp;page=1&amp;anchor=30" class="addthx" data-post="332138"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>

<tr valign=top class=tbCel1>
<td width="17%" class=caption1>
<div class=username><div><b><a name="31" onfocus="this.blur()" href="JavaScript:di('[b]DenCoder[/b]','')">DenCoder</a></b><br></div>
<img src="img/s7.gif" alt=""><br><img style="padding-top:3px;" src="av/24257.jpg" alt=""><br><span class=txtSm>Ранг: 324.3 (мудрец), 222thx<br><span title='Сообщений в день (с регистрации) / За последний год / Лет с регистрации: 10.42'>Активность: 0.48<span style='color:red'>&searr;</span>0.37</span><br>Статус: <a href="action=userinfo&amp;user=24257">Участник</a></span></div>
<br>
</td>
<td width="83%" class="caption1 post"><span class=txtSm>Создано: 12 октября 2013 20:57 &middot; Поправил: DenCoder <br><script type="text/javascript">QU('DenCoder','Цитата','пишет');</script> &middot; <a href="?step=sendmsg&amp;action=pmail&amp;userto=DenCoder" target="_blank">Личное сообщение</a> &middot;  <a href="#31" onClick="prompt('Ссылка на сообщение', 'https://exelab.ru/f/action=vthread&amp;forum=6&amp;topic=22201&amp;page=1#31');return false;">#31</a> </span><div align=left><br>
Убедительно! И тем более она действительно есть на всех версиях, включая 8. Тогда действительно хочется знать реальную причину, почему она андок (официально)?
<br><br><font size="1"><i>-----<br>IZ.RU</i></font><br><br><span class="txtGoods"><a href="action=addthx&amp;post=332139&amp;user=24257&amp;forum_n=6&amp;topic=22201&amp;page=1&amp;anchor=31" class="addthx" data-post="332139"><img src="img/tu.png" border=0 title="Полезное сообщение"></a><span class="have_thx" style="display:none"> | Сообщение посчитали полезным: <span class="total_thx"></span></span></span><br></div></td>
</tr>


</table>
<table class=tbTransparent><tr><td class=tbTransparent><span class=txtSm><b> <a href="action=vthread&amp;forum=6&amp;topic=22201&amp;page=0.html">&lt;&lt;</a> .  <a href="action=vthread&amp;forum=6&amp;topic=22201&amp;page=0.html">1</a> . <b>2</b> . <a href="action=vthread&amp;forum=6&amp;topic=22201&amp;page=2.html">3</a> . <a href="action=vthread&amp;forum=6&amp;topic=22201&amp;page=3.html">4</a> . <a href="action=vthread&amp;forum=6&amp;topic=22201&amp;page=2.html">&gt;&gt;</a></b></span></td></tr></table>
<table class=forums><tr>
<td width=16 valign=top class=caption3><img src="./img/forum_icons/p.gif" width=16 height=16 alt=""></td>
<td width="100%" class=caption3><span class=header>&nbsp;<a href="../index.html"><b>eXeL@B</b></a> <b class=bulletHead>&#8212;&#8250;</b> <a href="action=vtopic&amp;forum=6&sortBy=0&page=0.html"><b>Программирование</b></a> <b class=bulletHead>&#8212;&#8250;</b> Программа работает только внутри отладчика</span></td>
</tr></table>
</div>
<a name=newreply></a>
<script type="text/javascript">
function check_form(f)
{
  f.elements['b1'].value = 'Отправка...';
  f.elements['b1'].disabled = true;
  return true;
}
</script>

<div align="center">
<form name="postMsg" action="#32" method="post" class="formStyle" enctype="multipart/form-data" onsubmit="return check_form(this);" onkeydown="ctrle(event, this)">
<table class="forums">

<tr>
<td class="caption2">
<span class="txtSm"><b>:: Ваш ответ</b></span>
</td>
</tr>
<tr>
<td class="caption7">

<img class="toolButton" src="./img/button_bold.gif" width="23" height="22" border="0" title="Жирный" alt="Жирный" onmouseover="window.status='Жирный'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[b]','[/b]');">&nbsp;
<img class="toolButton" src="./img/button_italic.gif" width="23" height="22" border="0" title="Курсив" alt="Курсив" onmouseover="window.status='Курсив'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[t]','[/t]');">&nbsp;
<img class="toolButton" src="./img/button_underlined.gif" width="23" height="22" border="0" title="Подчеркнутый" alt="Подчеркнутый" onmouseover="window.status='Подчеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[u]','[/u]');">&nbsp;
<img class="toolButton" src="./img/button_strike.gif" width="23" height="22" border="0" title="Перечеркнутый" alt="Перечеркнутый" onmouseover="window.status='Перечеркнутый'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[s]','[/s]');">&nbsp;
<img class="toolButton" src="./img/button_code.gif" width="23" height="22" border="0" title="Код" alt="{mpf5}" onmouseover="window.status='Код'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[ASM]','[/ASM]');">&nbsp;
<img class="toolButton" src="./img/button_image.gif" width="23" height="22" border="0" title="Ссылка на картинку" alt="Код" onmouseover="window.status='Ссылка на картинку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[img]','[/img]');">&nbsp;
<img class="toolButton" src="./img/button_url.gif" width="23" height="22" border="0" title="Вставить ссылку" alt="Вставить ссылку" onmouseover="window.status='Вставить ссылку'; return true" onmouseout="window.status=''; return true" onclick="JavaScript:di('[url=',']--&gt; Link &lt;--[/url]');">&nbsp;

<!-- mod by arnix start 
<select style="position: relative; top: -7; width: 150px;" id="addHighlightedCode" onchange="insertHl(this);">
<option value="0">Подсветка кода...</option>
<option value="asm">Assembler</option>
<option value="c">C</option>
<option value="cpp">C++</option>
<option value="pascal">Pascal</option>
<option value="delphi">Delphi</option>
<option value="php">PHP</option>
<option value="vb">Visual Basic</option>
</select>&nbsp;
 mod by arnix end -->

<br>
<a href="JavaScript:di(':s1:','');"><img src="./img/smilies/s1.gif" border="0" alt=":s1:"></a>
<a href="JavaScript:di(':s2:','');"><img src="./img/smilies/s2.gif" border="0" alt=":s2:"></a>
<a href="JavaScript:di(':s3:','');"><img src="./img/smilies/s3.gif" border="0" alt=":s3:"></a>
<a href="JavaScript:di(':s4:','');"><img src="./img/smilies/s4.gif" border="0" alt=":s4:"></a>
<a href="JavaScript:di(':s5:','');"><img src="./img/smilies/s5.gif" border="0" alt=":s5:"></a>
<a href="JavaScript:di(':s6:','');"><img src="./img/smilies/s6.gif" border="0" alt=":s6:"></a>
<a href="JavaScript:di(':s7:','');"><img src="./img/smilies/s7.gif" border="0" alt=":s7:"></a>
<a href="JavaScript:di(':s8:','');"><img src="./img/smilies/s8.gif" border="0" alt=":s8:"></a>
<a href="JavaScript:di(':s9:','');"><img src="./img/smilies/s9.gif" border="0" alt=":s9:"></a>
<a href="JavaScript:di(':s10:','');"><img src="./img/smilies/s10.gif" border="0" alt=":s10:"></a>
<a href="JavaScript:di(':s11:','');"><img src="./img/smilies/s11.gif" border="0" alt=":s11:"></a>
<a href="JavaScript:di(':s12:','');"><img src="./img/smilies/s12.gif" border="0" alt=":s12:"></a>
<a href="JavaScript:di(':s13:','');"><img src="./img/smilies/s13.gif" border="0" alt=":s13:"></a>
<a href="JavaScript:di(':s14:','');"><img src="./img/smilies/s14.gif" border="0" alt=":s14:"></a>
<a href="JavaScript:di(':s15:','');"><img src="./img/smilies/s15.gif" border="0" alt=":s15:"></a>
<a href="JavaScript:di(':s16:','');"><img src="./img/smilies/s16.gif" border="0" alt=":s16:"></a>
</td></tr>
<tr>
<td class="caption5"><textarea name="postText" rows="10" class="textForm" tabindex="2" style="width:100%"></textarea>
<BR><INPUT class="textForm" type="file" name="fileAttach"><BR><SMALL>Максимальный размер аттача: <b>500KB</b>.</SMALL>
<br><span class="txtSm"> </span>
</td>
</tr>
<tr>
<td class="caption7">
<table class=tbTransparent>
<tr valign=middle>
<td class=tbTransparent><span class=txtSm>Ваш логин: <b><a href="https://exelab.ru/f/action=userinfo&amp;user=55973">german1505</a></b>  &raquo; <a href="mode=logout">Выход</a> &raquo; <a href="?action=pmail"><b>ЛС</b></a></span></td>
</tr>
</table>

</td>
</tr>


<tr>
<td class="caption5"><input type="submit" value="Отправить сообщение" class="inputButton" name="b1" tabindex="5"></td>
</tr>
</table>
<input type="hidden" name="action" value="pthread">
<input type="hidden" name="forum" value="6">
<input type="hidden" name="topic" value="22201">
</form>
</div>
<script type="text/javascript" src="templates/vthread_logged.js"></script>
<div align=center><table class=tbTransparent><tr>
<td class=tbTransparent><span class=txtSm>      &nbsp;&nbsp;&nbsp;<a href="/f/forprint.php?topic_id=22201" title="Версия для печати"><img src="img/forprint.gif" border="0" alt="Для печати"> Для печати</a>&nbsp;</span></td>
</tr></table></div>
<br>
 
<br><br><br></center>

</div>
<div id="footer">Вы находитесь на EXELAB.rU</div>
<div id="footer_btns">
<a href="http://www.reactos.org" rel="nofollow" target="_blank"><img src="./images/react.png" height="31" width="88" border="0" title="" alt=""></a> <script type="text/javascript"><!--
document.write("<img src='//counter.yadro.ru/hit?t44.2;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+";"+Math.random()+
"' "+
"border='0' width='31' height='31'>")
//--></script>
</div>
</div>

</body></html>
